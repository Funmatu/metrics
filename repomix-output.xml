This file is a merged representation of a subset of the codebase, containing files not matching ignore patterns, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching these patterns are excluded: **/*.svg, **/*.geojson, **/*.css, **/*.ejs, **/*.html
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.github/
  actions/
    ghcr-clean/
      delete_ghcr_dangling_images.sh
      delete_workflows.sh
    spelling/
      advice.md
      allow.txt
      candidate.patterns
      excludes.txt
      expect.txt
      line_forbidden.patterns
      patterns.txt
      README.md
      reject.txt
  config/
    codeql.yml
    dprint.json
    label.yml
  ISSUE_TEMPLATE/
    config.yml
  readme/
    imgs/
      about_metrics_are_html.png
      about_metrics_marker.png
      example_action_update.dark.png
      example_action_update.light.png
      example_github_profile.dark.png
      example_github_profile.light.png
      features_embed.gif
      features_insights.gif
      plugin_16personalities_profile.png
      plugin_achievements_ranks.png
      plugin_chess_lichess_token_0.png
      plugin_chess_lichess_token_1.png
      plugin_chess_lichess_token_2.png
      plugin_music_playlist_apple.png
      plugin_music_playlist_spotify.png
      plugin_music_recent_spotify_token_0.png
      plugin_music_recent_spotify_token_1.png
      plugin_music_recent_spotify_token_2.png
      plugin_music_recent_youtube_cookie_1.png
      plugin_music_recent_youtube_cookie_2.png
      plugin_projects_create.png
      plugin_projects_repositories.png
      plugin_projects_setup.png
      plugin_projects_track_progress.png
      plugin_splatoon_auth.png
      plugin_splatoon_script.png
      plugin_splatoon_statink.png
      plugin_stackoverflow_user_id.png
      plugin_steam_userid.png
      plugin_steam_webtoken.png
      plugin_stock_token.png
      plugin_tweets_secrets.png
      plugin_wakatime_token.png
      setup_personal_repository.dark.png
      setup_personal_repository.light.png
      setup_personal_token.dark.png
      setup_personal_token.light.png
      setup_private_contributions.dark.png
      setup_private_contributions.light.png
      setup_public_membership_org.dark.png
      setup_public_membership_org.light.png
      setup_repository_secret.dark.png
      setup_repository_secret.light.png
      setup_selfhosted_create.dark.png
      setup_selfhosted_create.light.png
      setup_shared.dark.png
      setup_shared.light.png
      setup_token_org_read_scope.dark.png
      setup_token_org_read_scope.light.png
      setup_token_repo_scope.dark.png
      setup_token_repo_scope.light.png
      setup_workflow_permissions.dark.png
      setup_workflow_permissions.light.png
    partials/
      documentation/
        setup/
          action.md
          docker.md
          local.md
          shared.md
          web.md
        compatibility.md
        contributing.md
        inspirations.md
        organizations.md
        selfhosted.md
        setup.md
      templated/
        compatibility.md
        documentation.md
        introduction.md
        plugins.community.md
        plugins.md
        README.md
        templates.md
      license.md
  scripts/
    files/
      examples.yml
    quickstart/
      plugin/
        examples.yml
        index.mjs
        metadata.yml
        README.md
      template/
        partials/
          _.json
        metadata.yml
        README.md
      index.mjs
    build.mjs
    markdown_example.mjs
    presets_examples.mjs
    preview.mjs
    release.mjs
  workflows/
    branches.yml
    ci.yml
    clean.yml
    examples.presets.yml
    examples.yml
    label.yml
    publish-docker.yml
    spelling.yml
    stale.yml
    test.presets.yml
    test.yml
  dependabot.yml
  FUNDING.yml
  pull_request_template.md
source/
  app/
    action/
      action.yml
      index.mjs
      run.sh
    metrics/
      index.mjs
      metadata.mjs
      presets.mjs
      setup.mjs
      utils.mjs
    web/
      statics/
        embed/
          placeholders/
            screenshot.png
            skyline.png
          app.js
          app.placeholder.js
        insights/
          script.js
        oauth/
          script.js
        app.js
        favicon.png
        opengraph.png
      index.mjs
      instance.mjs
      settings.example.json
  plugins/
    achievements/
      list/
        index.mjs
        organizations.mjs
        users.mjs
      queries/
        achievements.graphql
        metrics.graphql
        octocat.graphql
        organizations.graphql
        ranking.graphql
        total.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    activity/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    anilist/
      queries/
        characters.graphql
        favorites.graphql
        medias.graphql
        statistics.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    base/
      queries/
        calendar.graphql
        contributions.graphql
        field.graphql
        field.repositories.graphql
        organization.graphql
        organization.x.graphql
        repositories.graphql
        repository.graphql
        user.graphql
        user.x.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    calendar/
      queries/
        calendar.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    code/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    community/
      16personalities/
        examples.yml
        index.mjs
        metadata.yml
        README.md
      chess/
        examples.yml
        index.mjs
        metadata.yml
        README.md
      crypto/
        examples.yml
        index.mjs
        metadata.yml
        README.md
      fortune/
        examples.yml
        index.mjs
        metadata.yml
        README.md
      nightscout/
        examples.yml
        index.mjs
        metadata.yml
        README.md
      poopmap/
        examples.yml
        index.mjs
        metadata.yml
        README.md
      screenshot/
        examples.yml
        index.mjs
        metadata.yml
        README.md
      splatoon/
        s3si/
          mocks/
            u_coop.json
            u_summary.json
            u_vs.json
          .gitignore
          index.ts
          LICENSE.md
        assets.mjs
        examples.yml
        index.mjs
        metadata.yml
        README.md
        token.ts
      stock/
        examples.yml
        index.mjs
        metadata.yml
        README.md
      README.md
    contributors/
      queries/
        commit.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    core/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    discussions/
      queries/
        categories.graphql
        comments.graphql
        statistics.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    followup/
      queries/
        repository.collaborators.graphql
        repository.graphql
        user.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    gists/
      queries/
        gists.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    habits/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    introduction/
      queries/
        organization.graphql
        repository.graphql
        user.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    isocalendar/
      queries/
        calendar.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    languages/
      analyzer/
        analyzer.mjs
        cli.mjs
        indepth.mjs
        recent.mjs
      analyzers.mjs
      colorsets.json
      examples.yml
      index.mjs
      metadata.yml
      README.md
    leetcode/
      queries/
        languages.graphql
        problems.graphql
        recent.graphql
        skills.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    licenses/
      queries/
        licenses.graphql
        repository.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    lines/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    music/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    notable/
      queries/
        commits.graphql
        contributions.graphql
        issues.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    pagespeed/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    people/
      queries/
        people.graphql
        repository.graphql
        sponsors.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    posts/
      queries/
        hashnode.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    projects/
      queries/
        repository.graphql
        repository.legacy.graphql
        user.graphql
        user.legacy.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    reactions/
      queries/
        reactions.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    repositories/
      queries/
        pinned.graphql
        random.graphql
        repository.graphql
        starred.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    rss/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    skyline/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    sponsors/
      queries/
        active.graphql
        all.graphql
        description.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    sponsorships/
      queries/
        all.graphql
        sponsorships.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    stackoverflow/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    stargazers/
      queries/
        stargazers.graphql
      worldmap/
        atlas/
          LICENSE.md
        index.mjs
      examples.yml
      index.mjs
      metadata.yml
      README.md
    starlists/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    stars/
      queries/
        stars.graphql
      examples.yml
      index.mjs
      metadata.yml
      README.md
    steam/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    support/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    topics/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    traffic/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    tweets/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    wakatime/
      examples.yml
      index.mjs
      metadata.yml
      README.md
    README.md
  templates/
    classic/
      partials/
        _.json
      examples.yml
      metadata.yml
      README.md
      template.mjs
    community/
      examples.yml
      metadata.yml
      README.md
    markdown/
      partials/
        _.json
      example.md
      example.pdf.md
      examples.yml
      metadata.yml
      README.md
      template.mjs
    repository/
      partials/
        _.json
      examples.yml
      metadata.yml
      README.md
      template.mjs
    terminal/
      partials/
        _.json
      examples.yml
      metadata.yml
      README.md
      template.mjs
    README.md
  .eslintrc.yml
tests/
  cases/
    16personalities.plugin.yml
    achievements.plugin.yml
    activity.plugin.yml
    anilist.plugin.yml
    base.plugin.yml
    calendar.plugin.yml
    chess.plugin.yml
    classic.template.yml
    code.plugin.yml
    community.template.yml
    contributors.plugin.yml
    core.plugin.yml
    crypto.plugin.yml
    discussions.plugin.yml
    followup.plugin.yml
    fortune.plugin.yml
    gists.plugin.yml
    habits.plugin.yml
    introduction.plugin.yml
    isocalendar.plugin.yml
    languages.plugin.yml
    leetcode.plugin.yml
    licenses.plugin.yml
    lines.plugin.yml
    markdown.template.yml
    music.plugin.yml
    nightscout.plugin.yml
    notable.plugin.yml
    pagespeed.plugin.yml
    people.plugin.yml
    poopmap.plugin.yml
    posts.plugin.yml
    projects.plugin.yml
    reactions.plugin.yml
    repositories.plugin.yml
    repository.template.yml
    rss.plugin.yml
    screenshot.plugin.yml
    skyline.plugin.yml
    splatoon.plugin.yml
    sponsors.plugin.yml
    sponsorships.plugin.yml
    stackoverflow.plugin.yml
    stargazers.plugin.yml
    starlists.plugin.yml
    stars.plugin.yml
    steam.plugin.yml
    stock.plugin.yml
    support.plugin.yml
    terminal.template.yml
    topics.plugin.yml
    traffic.plugin.yml
    tweets.plugin.yml
    wakatime.plugin.yml
  mocks/
    api/
      axios/
        get/
          lastfm.mjs
          lichess.mjs
          nightscout.mjs
          pagespeed.mjs
          poopmap.mjs
          spotify.mjs
          stackoverflow.mjs
          steam.mjs
          twitter.mjs
          wakatime.mjs
          yahoo.mjs
        post/
          anilist.mjs
          hashnode.mjs
          leetcode.mjs
          spotify.mjs
          youtubemusic.mjs
      github/
        graphql/
          achievements.default.mjs
          achievements.metrics.mjs
          achievements.octocat.mjs
          achievements.organizations.mjs
          achievements.ranking.mjs
          achievements.total.mjs
          base.calendar.mjs
          base.contributions.mjs
          base.field.mjs
          base.field.repositories.mjs
          base.repositories.mjs
          base.repository.mjs
          base.user.mjs
          calendar.default.mjs
          contributors.commit.mjs
          discussions.categories.mjs
          discussions.comments.mjs
          discussions.statistics.mjs
          followup.repository.collaborators.mjs
          followup.repository.mjs
          followup.user.mjs
          gists.default.mjs
          introduction.organization.mjs
          introduction.repository.mjs
          introduction.user.mjs
          isocalendar.calendar.mjs
          licenses.default.mjs
          licenses.repository.mjs
          notable.contributions.mjs
          notable.issues.mjs
          people.default.mjs
          people.repository.mjs
          people.sponsors.mjs
          projects.repository.legacy.mjs
          projects.repository.mjs
          projects.user.legacy.mjs
          projects.user.mjs
          reactions.default.mjs
          repositories.pinned.mjs
          repositories.random.mjs
          repositories.repository.mjs
          repositories.starred.mjs
          sponsors.active.mjs
          sponsors.all.mjs
          sponsors.description.mjs
          sponsorships.all.mjs
          sponsorships.default.mjs
          stargazers.default.mjs
          stars.default.mjs
        rest/
          activity/
            listEventsForAuthenticatedUser.mjs
            listRepoEvents.mjs
          emojis/
            get.mjs
          rateLimit/
            get.mjs
          repos/
            get.mjs
            getContributorsStats.mjs
            getViews.mjs
            listCommits.mjs
            listContributors.mjs
          users/
            getByUsername.mjs
            listGpgKeysForUser.mjs
          request.mjs
    .eslintrc.yml
    index.mjs
  ci.test.js
  metrics.test.js
  presets.test.js
  secrets.json
.dockerignore
.editorconfig
.gitattributes
.gitignore
action.yml
ARCHITECTURE.md
CODE_OF_CONDUCT.md
CONTRIBUTING.md
Dockerfile
LICENSE
package.json
README.md
SECURITY.md
settings.example.json
vercel.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".github/actions/ghcr-clean/delete_ghcr_dangling_images.sh">
#!/bin/bash
set -e

# Simple script to remove dangling images from GHCR
# You need to be logged to 'gh' first.

# package_name syntax. i.e: jellyfin-vue
owner="$1"
container="$2"
temp_file="ghcr_prune.ids"
rm -rf $temp_file

echo "Fetching dangling images from GHCR..."
gh api /users/${owner}/packages/container/${container}/versions --paginate > $temp_file

ids_to_delete=$(cat "$temp_file" | jq -r '.[] | select(.metadata.container.tags==[]) | .id')

if [ "${ids_to_delete}" = "" ]
then
	echo "There are no dangling images to remove for this package"
	exit 0
fi

echo -e "\nDeleting dangling images..."
while read -r line; do
	id="$line"
	echo "Processing image $id"
	## Workaround for https://github.com/cli/cli/issues/4286 and https://github.com/cli/cli/issues/3937
	set +e
	echo -n | gh api --method DELETE /users/${owner}/packages/container/${container}/versions/${id} --input -
	test $? -eq 0 && echo Dangling image with ID $id deleted successfully
	set -e
done <<< $ids_to_delete

rm -rf $temp_file
echo -e "\nAll the dangling images have been removed successfully"
exit 0
</file>

<file path=".github/actions/ghcr-clean/delete_workflows.sh">
#!/bin/bash
set -e

# Simple script to remove workflows that are not successful or failed (with completion status like skipped, cancelled, etc.)
# It also removes successful or failed workflows that doesn't have artifacts or logs.
# You need to be logged to 'gh' first

# owner/repo syntax
repo="$1"

temp_file="workflow_runs.payload"
rm -rf $temp_file

echo "Fetching workflows..."
echo $(gh api /repos/${repo}/actions/runs --paginate | jq '{count: .total_count, runs: [.workflow_runs[] | select(.status=="completed") | {id, conclusion}]}') | jq '.' > $temp_file

ids_to_delete=$(cat "$temp_file" | jq -r '.runs | .[] | select((.conclusion!="success") and (.conclusion!="failure")) | .id')

if [ "${ids_to_delete}" = "" ]
then
	echo "All workflows are exited successfully or failed. Nothing to remove"
else
	echo "Removing all the workflows that are not successful or failed..."
	while read -r line; do
		id="$line"
		echo "Processing workflow $id"
		## Workaround for https://github.com/cli/cli/issues/4286 and https://github.com/cli/cli/issues/3937
		echo -n | gh api --method DELETE /repos/${repo}/actions/runs/${id} --input -

		echo "Stale workflow run with ID $id deleted successfully!"
	done <<< $ids_to_delete
fi

ids_to_delete=$(cat "$temp_file" | jq -r '.runs | .[] | select((.conclusion=="success") or (.conclusion=="failure")) | .id')

if [ "${ids_to_delete}" = "" ]
then
	echo "No workflows to check for logs or artifacts. Exiting..."
else
	echo -e "\nDeleting workflows without logs and artifacts..."
	while read -r line; do
		id="$line"
		echo "Processing workflow $id"
		artifact_count=$(gh api /repos/${repo}/actions/runs/${id}/artifacts | jq -r '.total_count')
		if [ "${artifact_count}" = "0" ]
		then
			gh api --silent /repos/${repo}/actions/runs/${id}/logs || \
				echo -n | gh api --method DELETE /repos/${repo}/actions/runs/${id} --input - && \
				echo "Workflow run without logs and artifacts with ID $id deleted successfully!"
		fi
	done <<< $ids_to_delete
fi

rm -rf $temp_file
echo -e "\n\nFinished the workflow run cleaning process"
exit 0
</file>

<file path=".github/actions/spelling/advice.md">
<!-- See https://github.com/check-spelling/check-spelling/wiki/Configuration-Examples%3A-advice --> <!-- markdownlint-disable MD033 MD041 -->
<details><summary>If the flagged items are false positives</summary>

If items relate to a ...
* binary file (or some other file you wouldn't want to check at all).

  Please add a file path to the `excludes.txt` file matching the containing file.

  File paths are Perl 5 Regular Expressions - you can [test](
https://www.regexplanet.com/advanced/perl/) yours before committing to verify it will match your files.

  `^` refers to the file's path from the root of the repository, so `^README\.md$` would exclude [README.md](
../tree/HEAD/README.md) (on whichever branch you're using).

* well-formed pattern.

  If you can write a [pattern](https://github.com/check-spelling/check-spelling/wiki/Configuration-Examples:-patterns) that would match it,
  try adding it to the `patterns.txt` file.

  Patterns are Perl 5 Regular Expressions - you can [test](
https://www.regexplanet.com/advanced/perl/) yours before committing to verify it will match your lines.

  Note that patterns can't match multiline strings.

</details>
</file>

<file path=".github/actions/spelling/candidate.patterns">
# Apple music
\bembed\.music\.apple\.com/fr/playlist/usr-share/[-\w.]+
# Spotify
\bopen\.spotify\.com/embed/playlist/\w+
</file>

<file path=".github/actions/spelling/expect.txt">
ABCDEFGHIJKLMNOPQRSTUVWXY
activeline
allowtransparency
alse
amd
anilist
apidojo
apostrophecms
argv
arobase
asi
audioscrobbler
Autoloaded
automator
backreference
Bizau
blankslate
blog
brackethighlighter
btn
cacheable
cakeday
captcha
charsets
chmod
chown
chrisbottin
cloudinary
cmake
codelines
codemirror
codeql
colorsets
Consolas
coord
csso
CVE
cwd
datapoints
dded
dependabot
deployer
deps
dessant
destructuring
Dexcom
dflag
diffs
diffstat
dirname
domcontentloaded
DOUBLEDOWN
DOUBLEUP
downvotes
dprint
dryrun
dto
ecma
Edg
eleased
eleted
emails
emoji
emojipedia
endgroup
endyear
ENOENT
entrypoint
eopened
eqeqeq
erged
esm
eugeneware
eviewed
expr
expressjs
extracter
extralarge
facebook
favicon
favourites
FEmusic
filesize
filesloop
Firefox
firstname
Fnc
foliojs
forkee
FORTYFIVEDOWN
FORTYFIVEUP
freefont
fss
FTg
fullyear
gemoji
geocodes
geopath
getrecenttracks
gettopartists
gettoptracks
ghactions
ghcr
ghquery
gifencoder
gionkunz
Gister
githubs
githubusercontent
gitted
globals
Gmap
gnupg
gnuplot
Gollum
google
googlechrome
gpg
grep
guttermarker
hackernews
hardcode
hashnode
hashtag
herokuapp
highalert
highlighter
homepage
honzaap
htmlescape
htmlsanitize
htmlunescape
hubot
hyperlinks
identicon
ies
iframes
imagga
imgb
indepth
infographics
infographile
installable
instanceof
instantier
Intelli
invertocat
Ionica
ipafont
ipsum
isaacs
isocalendar
itemprop
itunes
jellyfin
jshemas
kacst
keyup
Kotlin
largeable
lastfm
lastname
leaderboard
lecoq
legoandmars
libgconf
libssl
libx
libxml
libxmljs
libxss
libxtst
lichess
linux
lng
localhost
localstorage
logline
losed
lovell
lowalert
lowercased
lowlighter
lsb
lstat
mangas
markedjs
marudor
matchingbracket
matievisthekat
maxage
maxusers
mbid
mde
mergeability
mergeable
middlewares
mkdir
mockresize
mozilla
MSFT
myplugin
myquery
ncal
networkidle
newplugin
newyear
nfriedly
nightscout
Nixinova
NOASSERTION
nocase
nodeca
nodejs
notoken
octicon
OCTO
octocat
octokit
octonaut
octoraw
oid
ommented
opengraph
optimizable
orked
pageerror
pagespeed
pagespeedonline
panosoft
params
patchnote
pdated
pened
PGP
playcount
playlists
plugin
poopmap
practicaldev
prettylights
previewable
prismjs
producthunt
ptarjan
puppeteergif
purgecss
pwa
qmake
rankeds
rapidapi
ratelimit
ratelimiter
rbmok
rbren
rcopy
readdir
readme
readonly
reated
recenttracks
regexp
rlreset
rssi
runsh
SAPISID
SAPISIDHASH
scorecalc
screenshots
SDKs
Segoe
selfhosted
seo
Serializer
sgit
sgv
shipit
shm
SIGKILL
SINGLEDOWN
SINGLEUP
sourced
spamming
spams
spdx
sponsorable
spotify
stackexchange
stackoverflow
stagazers
standalone
starlist
stderr
stdin
stdio
stdout
steveukx
streamable
stripemojis
stroustrup
sublimelinter
substr
sudo
sysadmin
systemctl
systemd
tempdir
templating
testapp
testcase
Thu
timeline
tlwg
tmpdir
todo
topartists
toptracks
tracklist
transfonter
trollface
TSLA
twemoji
uapi
uconf
uid
uncache
Unconfigured
undef
underlinenav
Unescape
upcase
upvote
urgenthighalert
urgentlowalert
uri
urlencoded
URLTo
usermod
usernames
ushed
usr
utf
utm
vercel
vnd
vuejs
waifus
wakapi
wakatime
wasm
webserver
websites
wget
whitelisted
whoami
wiki
wikipedia
wontfix
workaround
WORKDIR
worldmap
wqy
wsl
xcb
Xcode
xkcd
xmlformat
ycombinator
ymd
yoda
youtube
ytd
ytmusic
Zabcdefghijklmnopqrstuvwxyz
zenhei
zenorocha
</file>

<file path=".github/actions/spelling/line_forbidden.patterns">
# reject `m_data` as there's a certain OS which has evil defines that break things if it's used elsewhere
# \bm_data\b

# s.b. GitHub
\bGithub\b

# s.b. GitLab
\bGitlab\b

# s.b. JavaScript
\bJavascript\b

# s.b. Microsoft
\bMicroSoft\b

# s.b. another
\ban[- ]other\b

# s.b. greater than
\bgreater then\b

# s.b. less than
\bless then\b

# s.b. otherwise
\bother[- ]wise\b

# s.b. nonexistent
\bnon existing\b
\b[Nn]o[nt][- ]existent\b

# s.b. preexisting
[Pp]re-existing

# s.b. preempt
[Pp]re-empt\b

# s.b. preemptively
[Pp]re-emptively

# s.b. reentrancy
[Rr]e-entrancy

# s.b. reentrant
[Rr]e-entrant

# Reject duplicate words
\s([A-Z]{3,}|[A-Z][a-z]{2,}|[a-z]{3,})\s\g{-1}\s
</file>

<file path=".github/actions/spelling/patterns.txt">
# See https://github.com/check-spelling/check-spelling/wiki/Configuration-Examples:-patterns

# hit-count: 506 file-count: 66
# w3
\bw3\.org/[-0-9a-zA-Z/#.]+

# hit-count: 414 file-count: 136
# GitHub SHAs (markdown)
(?:\[`?[0-9a-f]+`?\]\(https:/|)/(?:www\.|)github\.com(?:/[^/ ]+){2,}(?:/[^/ )]+/[0-9a-f]+(?:[-0-9a-zA-Z/#.]*|)\b|)

# hit-count: 69 file-count: 26
\.replace\(/[^/]*/[gim]*\s*,

# hit-count: 66 file-count: 31
# JavaScript regular expressions
/[^/]*/[gim]*\.test\(

# hit-count: 41 file-count: 14
# URL escaped characters
\%[0-9A-F]{2}

# hit-count: 29 file-count: 19
# githubusercontent
/[-a-z0-9]+\.githubusercontent\.com/[-a-zA-Z0-9?&=_\/.]*

# hit-count: 18 file-count: 6
# data url in quotes
([`'"])data:.*?(?:[A-Z]{3,}|[A-Z][a-z]{2,}|[a-z]{3,}).*\g{-1}

# hit-count: 12 file-count: 4
# Contributor
\[[^\]]+\]\(https://github\.com/[^/ ]+\)

# hit-count: 1 file-count: 1
# YouTube music
\bmusic\.youtube\.com/youtubei/v1/browse(?:[?&]\w+=[-a-zA-Z0-9?&=_]*)

# hit-count: 6 file-count: 5
# While you could try to match `http://` and `https://` by using `s?` in `https?://`, sometimes there
# YouTube url
\b(?:(?:www\.|)youtube\.com|youtu.be)/(?:channel/|embed/|playlist\?list=|watch\?v=|v/|)[-a-zA-Z0-9?&=_]*

# hit-count: 1 file-count: 1
# AWS S3
\b\w*\.s3[^.]*\.amazonaws\.com/[-\w/&#%_?:=]*

# hit-count: 1 file-count: 1
# GitHub SHAs
\bgithub\.com(?:/[^/ ]+){2}[@#][0-9a-f]+\b

# hit-count: 1 file-count: 1
# hex runs
\b[0-9a-fA-F]{16,}\b

# hit-count: 1 file-count: 1
# hex in url queries
=[0-9a-fA-F]*?(?:[A-F]{3,}|[a-f]{3,})[0-9a-fA-F]*?&

# Automatically suggested patterns
# hit-count: 970 file-count: 25
# hex digits including css/html color classes:
(?:[\\0][xX]|\\u|[uU]\+|#x?|\%23)[0-9a-fA-FgGrR_]{2,}(?:[uUlL]{0,3}|u\d+)\b

# Automatically suggested patterns
# hit-count: 4 file-count: 4
# Apple music
\bembed\.music\.apple\.com/fr/playlist/usr-share/[-\w.]+

# hit-count: 4 file-count: 4
# Spotify
\bopen\.spotify\.com/embed/playlist/\w+

computed\.avatar = await avatar \|\| ".*"
place_id: ".*"
(?:answer|question|user): "[^"]*"

# acceptable duplicates
# ls directory listings
[-bcdlpsw](?:[-r][-w][-sx]){3}\s+\d+\s+(\S+)\s+\g{-1}\s+\d+\s+
# C types
\s(long|LONG) \g{-1}\s
# javadoc / .net
(?:[\\@](?:groupname|param)|(?:public|private)(?:\s+static|\s+readonly)*)\s+(\w+)\s+\g{-1}\s

# Commit message -- Signed-off-by and friends
^\s*(?:(?:Based-on-patch|Co-authored|Helped|Mentored|Reported|Reviewed|Signed-off)-by|Thanks-to): (?:[^<]*<[^>]*>|[^<]*)\s*$

# Autogenerated revert commit message
^This reverts commit [0-9a-f]{40}\.$

# ignore long runs of a single character:
\b([A-Za-z])\g{-1}{3,}\b

# Chess patterns
\brnbqkbnr\b
\bRNBQKBNR\b
\bpgn\b
</file>

<file path=".github/actions/spelling/README.md">
# check-spelling/check-spelling configuration

File | Purpose | Format | Info
-|-|-|-
[dictionary.txt](dictionary.txt) | Replacement dictionary (creating this file will override the default dictionary) | one word per line | [dictionary](https://github.com/check-spelling/check-spelling/wiki/Configuration#dictionary)
[allow.txt](allow.txt) | Add words to the dictionary | one word per line (only letters and `'`s allowed) | [allow](https://github.com/check-spelling/check-spelling/wiki/Configuration#allow)
[reject.txt](reject.txt) | Remove words from the dictionary (after allow) | grep pattern matching whole dictionary words | [reject](https://github.com/check-spelling/check-spelling/wiki/Configuration-Examples%3A-reject)
[excludes.txt](excludes.txt) | Files to ignore entirely | perl regular expression | [excludes](https://github.com/check-spelling/check-spelling/wiki/Configuration-Examples%3A-excludes)
[only.txt](only.txt) | Only check matching files (applied after excludes) | perl regular expression | [only](https://github.com/check-spelling/check-spelling/wiki/Configuration-Examples%3A-only)
[patterns.txt](patterns.txt) | Patterns to ignore from checked lines | perl regular expression (order matters, first match wins) | [patterns](https://github.com/check-spelling/check-spelling/wiki/Configuration-Examples%3A-patterns)
[line_forbidden.patterns](line_forbidden.patterns) | Patterns to flag in checked lines | perl regular expression (order matters, first match wins) | [patterns](https://github.com/check-spelling/check-spelling/wiki/Configuration-Examples%3A-patterns)
[expect.txt](expect.txt) | Expected words that aren't in the dictionary | one word per line (sorted, alphabetically) | [expect](https://github.com/check-spelling/check-spelling/wiki/Configuration#expect)
[advice.md](advice.md) | Supplement for GitHub comment when unrecognized words are found | GitHub Markdown | [advice](https://github.com/check-spelling/check-spelling/wiki/Configuration-Examples%3A-advice)

Note: you can replace any of these files with a directory by the same name (minus the suffix)
and then include multiple files inside that directory (with that suffix) to merge multiple files together.
</file>

<file path=".github/actions/spelling/reject.txt">
^attache$
benefitting
occurences?
^dependan.*
^oer$
Sorce
^[Ss]pae.*
^untill$
^untilling$
^wether.*
</file>

<file path=".github/config/codeql.yml">
name: CodeQL config
queries:
  - uses: security-and-quality
paths-ignore:
  - copyrighted/**
  - .github/scripts/quickstart/**
  - source/plugins/community/splatoon/s3si/**
</file>

<file path=".github/config/dprint.json">
{
  "incremental": true,
  "indentWidth": 2,
  "typescript": {
    "lineWidth": 360,
    "semiColons": "asi",
    "quoteStyle": "preferDouble",
    "useBraces": "preferNone",
    "singleBodyPosition": "nextLine",
    "arrowFunction.useParentheses": "preferNone",
    "commentLine.forceSpaceAfterSlashes": false,
    "taggedTemplate.spaceBeforeLiteral": false,
    "nextControlFlowPosition": "nextLine",
    "spaceSurroundingProperties": false
  },
  "includes": ["**/*.{js,mjs}"],
  "excludes": [
    "node_modules/**/*",
    ".github/scripts/quickstart/**/*"
  ],
  "plugins": [
    "https://plugins.dprint.dev/typescript-0.83.0.wasm"
  ]
}
</file>

<file path=".github/config/label.yml">
üìä metrics embed:
  - source/app/action/**
  - source/app/web/**
‚ú® metrics insights:
  - source/app/web/statics/insights/**

üß© plugins:
  - source/plugins/**
üñºÔ∏è templates:
  - source/templates/**

üóÉÔ∏è base:
  - source/plugins/base/**
üß± core:
  - source/app/metrics/**
  - source/plugins/core/**

üé≤ community plugins:
  - source/plugins/community/**

üèÜ plugin achievements:
  - source/plugins/achievements/**
üì∞ plugin activity:
  - source/plugins/activity/**
üå∏ plugin anilist:
  - source/plugins/anilist/**
üìÜ plugin calendar:
  - source/plugins/calendar/**
‚ôê plugin code:
  - source/plugins/code/**
üèÖ plugin contributors:
  - source/plugins/contributors/**
üí¨ plugin discussions:
  - source/plugins/discussions/**
üéüÔ∏è plugin followup:
  - source/plugins/followup/**
üé´ plugin gists:
  - source/plugins/gists/**
üí° plugin habits:
  - source/plugins/habits/**
üôã plugin introduction:
  - source/plugins/introduction/**
üìÖ plugin isocalendar:
  - source/plugins/isocalendar/**
üà∑Ô∏è plugin languages:
  - source/plugins/languages/**
üó≥Ô∏è plugin leetcode:
  - source/plugins/leetcode/**
üìú plugin licenses:
  - source/plugins/licenses/**
üë®‚Äçüíª plugin lines:
  - source/plugins/lines/**
üéº plugin music:
  - source/plugins/music/**
üé© plugin notable:
  - source/plugins/notable/**
‚è±Ô∏è plugin pagespeed:
  - source/plugins/pagespeed/**
üßë‚Äçü§ù‚Äçüßë plugin people:
  - source/plugins/people/**
‚úíÔ∏è plugin posts:
  - source/plugins/posts/**
üóÇÔ∏è plugin projects:
  - source/plugins/projects/**
üé≠ plugin reactions:
  - source/plugins/reactions/**
üìì plugin repositories:
  - source/plugins/repositories/**
üóº plugin rss:
  - source/plugins/rss/**
üåá plugin skyline:
  - source/plugins/skyline/**
üíï plugin sponsors:
  - source/plugins/sponsors/**
üó®Ô∏è plugin stackoverflow:
  - source/plugins/stackoverflow/**
‚ú® plugin stargazers:
  - source/plugins/stargazers/**
üí´ plugin starlists:
  - source/plugins/starlists/**
üåü plugin stars:
  - source/plugins/stars/**
üí≠ plugin support:
  - source/plugins/support/**
üìå plugin topics:
  - source/plugins/topics/**
üßÆ plugin traffic:
  - source/plugins/traffic/**
üê§ plugin tweets:
  - source/plugins/tweets/**
‚è∞ plugin wakatime:
  - source/plugins/wakatime/**
</file>

<file path=".github/ISSUE_TEMPLATE/config.yml">
blank_issues_enabled: false
contact_links:
  - name: üôè Request help with setup or report a possible issue
    url: https://github.com/lowlighter/metrics/discussions/new?category=q-a
    about: Post here when having trouble with setup or configuration
  - name: üí° Suggest new features
    url: https://github.com/lowlighter/metrics/discussions/new?category=ideas
    about: Submit ideas to help us improve
  - name: üí¨ Start a discussion
    url: https://github.com/lowlighter/metrics/discussions/new?category=general
    about: Ask other questions related to this project here
</file>

<file path=".github/readme/partials/documentation/setup/docker.md">
# üê≥ Using command line with docker (~2 min)

## 0Ô∏è Prepare your machine

A machine with a recent version of [docker](https://www.docker.com/) is required.

## 1Ô∏è Run docker image

The command to use is similar to the following:
```shell
docker run --rm --env INPUT_TOKEN=**** --env INPUT_USER=user --volume=/tmp:/renders ghcr.io/lowlighter/metrics:latest
```

To pass parameters, pass environment variable with the same name as the corresponding action option but in uppercase and prefixed with `INPUT_`.

Generated files will be created in the mounted `/renders` directory.

> üí° When running *metrics* with docker, [`output_action`](/source/plugins/core/README.md#-configuring-output-action) will automatically default to `none` instead. To use a different output action, both `GITHUB_REPOSITORY` (notice the absence of `INPUT_` prefix) and `INPUT_COMMITTER_TOKEN` (with sufficient permissions) environment variables must be set.
</file>

<file path=".github/readme/partials/documentation/setup/local.md">
# üîß Local setup for development (~20 min)

## 0Ô∏è Prepare your machine

A machine with a recent version of [NodeJS](https://nodejs.org) is required (see used version in [Dockerfile](/Dockerfile#L1-L2)).

## 1Ô∏è Clone repository and install dependencies

Run the following command to clone this repository and install dependencies.

```shell
git clone https://github.com/lowlighter/metrics.git
cd metrics/
npm install
cp settings.example.json settings.json
```

## 2Ô∏è Setup and configure *metrics*

Follow [üèóÔ∏è Deploying a web instance (~20 min)](/.github/readme/partials/documentation/setup/web.md) guide except docker-related sections.

Once read, start local instance using the following command:
```shell
npm start
```

## 3Ô∏è Start hacking!

Connect to your web server using `http://localhost:{port}` and start hacking!

For quick testing, it is advised to directly craft URLs, rather than using the web interface.

*Example: test a new plugin*
```shell
https://localhost:{port}/username?base=0&newplugin=1&newplugin.option1=hello&newplugin.option2=world)
```

## *Ô∏è‚É£ Testing changes

Testing is done through [jest](https://github.com/facebook/jest) framework.

To avoid consuming APIs requests and causing additional charges on external services, data are [mocked](/tests/mocks/index.mjs) using [JavaScript Proxies](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy) and [Faker.js](https://github.com/faker-js/faker) with randomly generated data.

Since tests are pretty long to run, it is advised to just let GitHub Actions do the testing.
</file>

<file path=".github/readme/partials/documentation/setup/shared.md">
# üíï Using the shared instance (~1 min)

For convenience, a free shared instance is available at [metrics.lecoq.io](https://metrics.lecoq.io) without any additional setup.

## 0Ô∏è Setup a personal repository

Create a repository with the same name as your GitHub login (if it doesn't exist).

![Setup personal repository](/.github/readme/imgs/setup_personal_repository.light.png#gh-light-mode-only)
![Setup personal repository](/.github/readme/imgs/setup_personal_repository.dark.png#gh-dark-mode-only)

Its `README.md` will be displayed on your user profile:

![GitHub Profile Example](/.github/readme/imgs/example_github_profile.light.png#gh-light-mode-only)
![GitHub Profile Example](/.github/readme/imgs/example_github_profile.dark.png#gh-dark-mode-only)

## 2Ô∏è Configure *metrics*

Visit [metrics.lecoq.io](https://metrics.lecoq.io) and start playing around!

> ‚ö†Ô∏è Some plugins are not available on the web instance. Consider using [GitHub action](https://github.com/marketplace/actions/metrics-embed) to enjoy all features!

> ‚ÑπÔ∏è [metrics.lecoq.io](https://metrics.lecoq.io) always run on [latest release](https://github.com/lowlighter/metrics/releases/latest). To test upcoming releases, use [beta-metrics.lecoq.io](https://beta-metrics.lecoq.io), which always run on `@master` instead.

![metrics.lecoq.io](/.github/readme/imgs/setup_shared.light.png#gh-light-mode-only)
![metrics.lecoq.io](/.github/readme/imgs/setup_shared.dark.png#gh-dark-mode-only)

> ‚ö†Ô∏è This service is hosted on a small server that I rent. It is provided free of charge so please be gentle with it üòÖ Availability not guaranteed!

> üíï If you really enjoy this service, consider [sponsoring me](https://github.com/sponsors/lowlighter) to help me cover server costs!

## 3Ô∏è Add images to your profile `README.md`

Update profile `README.md` to include rendered image.

*Example: add rendered image with markdown*
```markdown
![Metrics](https://metrics.lecoq.io/username)
```

> ‚ö†Ô∏è Images are cached for 1 hour after being rendered. They **won't be updated** during this time window when queried again. However it is possible to manually update them by using [metrics.lecoq.io](https://metrics.lecoq.io) again
</file>

<file path=".github/readme/partials/documentation/setup/web.md">
# üèóÔ∏è Deploying a web instance (~20 min)

Setup a *metrics* web instance on your server.

## 0Ô∏è Prepare your server

A server with a recent version of [docker](https://www.docker.com/) is required.

## 1Ô∏è Create a GitHub personal token

From the `Developer settings` of your account settings, select `Personal access tokens` to create a new token.

No additional scopes are required.

> üí° For security reasons, it is advised to use a scope-less token for web instances.

![Setup a GitHub personal token](/.github/readme/imgs/setup_personal_token.light.png#gh-light-mode-only)
![Setup a GitHub personal token](/.github/readme/imgs/setup_personal_token.dark.png#gh-dark-mode-only)

## 2Ô∏è Configure *metrics*

Fetch a copy of [`settings.example.json`](/settings.example.json) and rename it `settings.json`
```shell
wget https://raw.githubusercontent.com/lowlighter/metrics/master/settings.example.json
mv settings.example.json settings.json
```

Edit `settings.json` to configure your instance.

*Example: minimal configuration*
```javascript
{
  "token": "GITHUB_TOKEN",
}
```

### 2Ô∏è.1Ô∏è Restricting access to your web instance

If you intend to make your web instance public, it is advised to restrict access using an access list or rate-limiting it.

Only authorized users will be able to generate images.

*Example: restricted access server*
```javascript
{
  "restricted": ["user1", "user2", "user3"],
  "maxusers": 2,
  "ratelimiter": {
    "windowMs": 900000,
	  "max": 100
  }
}
```

### 2Ô∏è.2Ô∏è Global configuration

Configuration file also contains settings about enabled templates, plugins and features.

*Example: additional server configuration*
```javascript
{
  "cached": 3600000,
  "port": 3000,
  "templates": {
    "default": "classic",
    "enabled": ["classic", "terminal"],
  },
  "community": {
    "templates": ["user/repo@main:custom-theme"],
  },
  "hosted": {
    "by": "me",
    "link": "https://user.me",
  },
  "plugins": {
    "isocalendar":{
      "enabled": false
    }
  }
}
```

### 2Ô∏è.3Ô∏è Extra features configuration

Extra features are a way to enable and control advanced functionality in plugins, which are usually either CPU or API intensive, require access to filesystem or binaries, and sometimes also allow remote code execution.

> ‚ö†Ô∏è Please understand that some extras features may compromise container integrity or security.
> Never use them if outside a containerized or development environment!
>
> Use at your own risk, *metrics* and its authors cannot be held responsible for any damage caused.

*Example: extra features server configuration*
```javascript
{
  "extras": {
    "features": [
      "metrics.setup.community.templates",
      "metrics.api.github.overuse",
      "metrics.cpu.overuse",
      "metrics.run.puppeteer.scrapping",
    ]
  }
}
```

The following extra features are supported:
| Extra feature identifier            | Description                                               |
| ----------------------------------- | --------------------------------------------------------- |
| `metrics.setup.community.templates` | Allow community templates download                        |
| `metrics.setup.community.presets`   | Allow community presets usage                             |
| `metrics.api.github.overuse`        | Allow GitHub API intensive requests                       |
| `metrics.api.*`                     | Allow use of external API requests                        |
| `metrics.cpu.overuse`               | Allow CPU intensive requests                              |
| `metrics.run.tempdir`               | Allow access to temporary directory (including I/O)       |
| `metrics.run.git`                   | Allow to run git                                          |
| `metrics.run.licensed`              | Allow to run licensed                                     |
| ‚ö†Ô∏è `metrics.run.user.cmd`           | Allow to run ANY command by user (USE WITH CAUTION! May result in token leaks by malicious users)                                                                |
| `metrics.run.puppeteer.scrapping`   | Allow to run puppeteer to scrape data                     |
| `metrics.run.puppeteer.user.css`    | Allow to run CSS by user during puppeteer render          |
| `metrics.run.puppeteer.user.js`     | Allow to run JavaScript by user during puppeteer render   |
| ‚ö†Ô∏è `metrics.npm.optional.*`        | Allow use of specified dependency (CONSULT RESPECTIVE DEPENDENCY CVE FIRST) |

If a plugin is used without sufficient permissions, it will result in an error.

## 3Ô∏è Start docker container

Docker images are published on [GitHub Container Registry](https://github.com/lowlighter/metrics/pkgs/container/metrics).

Configure the following variables (or hardcode them in the command in the next block):
```shell
# Select an existing docker image tag
VERSION=latest
# Path to configured `settings.json`
SETTINGS=/path/to/settings.json
# Port used internally (use the same one than in `settings.json`)
SERVICE_PORT=3000
# Port to publish
PUBLISHED_PORT=80
```

And start the container using the following command:
```shell
docker run --rm --entrypoint="" -p=127.0.0.1:$PUBLISHED_PORT:$SERVICE_PORT --volume=$SETTINGS:/metrics/settings.json ghcr.io/lowlighter/metrics:$VERSION npm start
```

## 4Ô∏è Add images to your profile `README.md`

Update profile `README.md` to include rendered image.

*Example: add rendered image with markdown*
```markdown
![Metrics](https://my.server.com/username)
```

### 4Ô∏è.1Ô∏è URL parameters syntax

The GitHub action and the web instance uses the same engine behind the hood.

It is actually possible to generate image directly from url without passing by the web ui by knowing how to pass parameters.

Parameters for the web instance:
- use dots (`.`) instead of underscores (`_`)
- does not use `plugin_` prefixes
- special characters need to be url [encoded](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent)

*Example: configuring `‚è±Ô∏è pagespeed` plugin for [https://example.org](https://example.org/)*
```html
<img src="https://my.server.com/username?pagespeed=1&pagespeed.detailed=1&pagespeed.url=https%3A%2F%2Fexample.com">
```

`üóÉÔ∏è base` plugin use a slightly different notation where sections are configured through `base.<section>` param.

*Example: configuring `üóÉÔ∏è base` plugin to display only repositories section*
```html
<img src="https://my.server.com/username?base=0&base.repositories=1">
```

## *Ô∏è‚É£ Create a service (optional)

To ensure that service will restart after reboots or crashes, it is advised to setup it as a service.
This is described below for Linux-like systems which support *systemd*.

Create a new service file `/etc/systemd/system/github_metrics.service` and paste the following:
```ini
[Unit]
Description=Metrics
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
ExecStart=# docker command #

[Install]
WantedBy=multi-user.target
```

Reload services, enable it, start it and check if it is up and running:
```shell
systemctl daemon-reload
systemctl enable github_metrics
systemctl start github_metrics
systemctl status github_metrics
```
</file>

<file path=".github/readme/partials/documentation/compatibility.md">
# üß∞ Template/Plugin compatibility matrix

<table>
  <tr>
    <th nowrap="nowrap">Template/Plugin</th>    
    <th nowrap="nowrap" align="center" title="üóÉÔ∏è Base content">üóÉÔ∏è</th>
    <th nowrap="nowrap" align="center" title="üìÖ Isometric commit calendar">üìÖ</th>
    <th nowrap="nowrap" align="center" title="üà∑Ô∏è Languages activity">üà∑Ô∏è</th>
    <th nowrap="nowrap" align="center" title="‚ú® Stargazers">‚ú®</th>
    <th nowrap="nowrap" align="center" title="üë®‚Äçüíª Lines of code changed">üë®‚Äçüíª</th>
    <th nowrap="nowrap" align="center" title="üìå Starred topics">üìå</th>
    <th nowrap="nowrap" align="center" title="üåü Recently starred repositories">üåü</th>
    <th nowrap="nowrap" align="center" title="üìú Repository licenses">üìú</th>
    <th nowrap="nowrap" align="center" title="üí° Coding habits and activity">üí°</th>
    <th nowrap="nowrap" align="center" title="üèÖ Repository contributors">üèÖ</th>
    <th nowrap="nowrap" align="center" title="üéüÔ∏è Follow-up of issues and pull requests">üéüÔ∏è</th>
    <th nowrap="nowrap" align="center" title="üé≠ Comment reactions">üé≠</th>
    <th nowrap="nowrap" align="center" title="üßë‚Äçü§ù‚Äçüßë People">üßë‚Äçü§ù‚Äçüßë</th>
    <th nowrap="nowrap" align="center" title="üíù GitHub Sponsorships">üíù</th>
    <th nowrap="nowrap" align="center" title="üíï GitHub Sponsors">üíï</th>
    <th nowrap="nowrap" align="center" title="üìì Featured repositories">üìì</th>
    <th nowrap="nowrap" align="center" title="üí¨ Discussions">üí¨</th>
    <th nowrap="nowrap" align="center" title="üí´ Star lists">üí´</th>
    <th nowrap="nowrap" align="center" title="üìÜ Commit calendar">üìÜ</th>
    <th nowrap="nowrap" align="center" title="üèÜ Achievements">üèÜ</th>
    <th nowrap="nowrap" align="center" title="üé© Notable contributions">üé©</th>
    <th nowrap="nowrap" align="center" title="üì∞ Recent activity">üì∞</th>
    <th nowrap="nowrap" align="center" title="üßÆ Repositories traffic">üßÆ</th>
    <th nowrap="nowrap" align="center" title="‚ôê Random code snippet">‚ôê</th>
    <th nowrap="nowrap" align="center" title="üé´ Gists">üé´</th>
    <th nowrap="nowrap" align="center" title="üóÇÔ∏è GitHub projects">üóÇÔ∏è</th>
    <th nowrap="nowrap" align="center" title="üôã Introduction">üôã</th>
    <th nowrap="nowrap" align="center" title="üåá GitHub Skyline">üåá</th>
    <th nowrap="nowrap" align="center" title="üí≠ GitHub Community Support">üí≠</th>
    <th nowrap="nowrap" align="center" title="‚è±Ô∏è Google PageSpeed">‚è±Ô∏è</th>
    <th nowrap="nowrap" align="center" title="üê§ Latest tweets">üê§</th>
    <th nowrap="nowrap" align="center" title="üó®Ô∏è Stack Overflow">üó®Ô∏è</th>
    <th nowrap="nowrap" align="center" title="üå∏ Anilist watch list and reading list">üå∏</th>
    <th nowrap="nowrap" align="center" title="üéº Music activity and suggestions">üéº</th>
    <th nowrap="nowrap" align="center" title="‚úíÔ∏è Recent posts">‚úíÔ∏è</th>
    <th nowrap="nowrap" align="center" title="üóº Rss feed">üóº</th>
    <th nowrap="nowrap" align="center" title="‚è∞ WakaTime">‚è∞</th>
    <th nowrap="nowrap" align="center" title="üó≥Ô∏è Leetcode">üó≥Ô∏è</th>
    <th nowrap="nowrap" align="center" title="üïπÔ∏è Steam">üïπÔ∏è</th>
  </tr>  
  <tr>
    <td nowrap="nowrap">üìó Classic template</td>    
    <td nowrap="nowrap" align="center" data-plugin="base">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="isocalendar">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="languages">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="stargazers">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="lines">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="topics">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="stars">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="licenses">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="habits">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="contributors">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="followup">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="reactions">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="people">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="sponsorships">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="sponsors">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="repositories">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="discussions">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="starlists">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="calendar">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="achievements">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="notable">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="activity">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="traffic">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="code">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="gists">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="projects">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="introduction">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="skyline">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="support">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="pagespeed">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="tweets">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="stackoverflow">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="anilist">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="music">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="posts">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="rss">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="wakatime">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="leetcode">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="steam">‚úîÔ∏è</td>
  </tr>
  <tr>
    <td nowrap="nowrap">üìò Repository template</td>    
    <td nowrap="nowrap" align="center" data-plugin="base">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="isocalendar">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="languages">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="stargazers">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="lines">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="topics">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="stars">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="licenses">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="habits">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="contributors">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="followup">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="reactions">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="people">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="sponsorships">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="sponsors">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="repositories">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="discussions">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="starlists">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="calendar">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="achievements">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="notable">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="activity">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="traffic">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="code">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="gists">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="projects">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="introduction">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="skyline">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="support">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="pagespeed">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="tweets">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="stackoverflow">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="anilist">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="music">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="posts">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="rss">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="wakatime">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="leetcode">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="steam">‚ùå</td>
  </tr>
  <tr>
    <td nowrap="nowrap">üìô Terminal template</td>    
    <td nowrap="nowrap" align="center" data-plugin="base">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="isocalendar">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="languages">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="stargazers">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="lines">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="topics">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="stars">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="licenses">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="habits">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="contributors">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="followup">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="reactions">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="people">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="sponsorships">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="sponsors">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="repositories">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="discussions">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="starlists">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="calendar">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="achievements">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="notable">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="activity">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="traffic">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="code">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="gists">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="projects">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="introduction">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="skyline">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="support">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="pagespeed">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="tweets">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="stackoverflow">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="anilist">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="music">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="posts">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="rss">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="wakatime">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="leetcode">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="steam">‚ùå</td>
  </tr>
  <tr>
    <td nowrap="nowrap">üìí Markdown template</td>    
    <td nowrap="nowrap" align="center" data-plugin="base">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="isocalendar">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="languages">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="stargazers">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="lines">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="topics">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="stars">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="licenses">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="habits">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="contributors">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="followup">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="reactions">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="people">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="sponsorships">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="sponsors">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="repositories">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="discussions">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="starlists">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="calendar">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="achievements">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="notable">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="activity">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="traffic">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="code">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="gists">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="projects">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="introduction">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="skyline">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="support">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="pagespeed">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="tweets">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="stackoverflow">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="anilist">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="music">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="posts">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="rss">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="wakatime">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="leetcode">‚úì</td>
    <td nowrap="nowrap" align="center" data-plugin="steam">‚úì</td>
  </tr>
  <tr>
    <td colspan="39"></td>
  </tr>
  <tr>
    <th nowrap="nowrap">Mode/Plugin</th>    
    <th nowrap="nowrap" align="center" title="üóÉÔ∏è Base content">üóÉÔ∏è</th>
    <th nowrap="nowrap" align="center" title="üìÖ Isometric commit calendar">üìÖ</th>
    <th nowrap="nowrap" align="center" title="üà∑Ô∏è Languages activity">üà∑Ô∏è</th>
    <th nowrap="nowrap" align="center" title="‚ú® Stargazers">‚ú®</th>
    <th nowrap="nowrap" align="center" title="üë®‚Äçüíª Lines of code changed">üë®‚Äçüíª</th>
    <th nowrap="nowrap" align="center" title="üìå Starred topics">üìå</th>
    <th nowrap="nowrap" align="center" title="üåü Recently starred repositories">üåü</th>
    <th nowrap="nowrap" align="center" title="üìú Repository licenses">üìú</th>
    <th nowrap="nowrap" align="center" title="üí° Coding habits and activity">üí°</th>
    <th nowrap="nowrap" align="center" title="üèÖ Repository contributors">üèÖ</th>
    <th nowrap="nowrap" align="center" title="üéüÔ∏è Follow-up of issues and pull requests">üéüÔ∏è</th>
    <th nowrap="nowrap" align="center" title="üé≠ Comment reactions">üé≠</th>
    <th nowrap="nowrap" align="center" title="üßë‚Äçü§ù‚Äçüßë People">üßë‚Äçü§ù‚Äçüßë</th>
    <th nowrap="nowrap" align="center" title="üíù GitHub Sponsorships">üíù</th>
    <th nowrap="nowrap" align="center" title="üíï GitHub Sponsors">üíï</th>
    <th nowrap="nowrap" align="center" title="üìì Featured repositories">üìì</th>
    <th nowrap="nowrap" align="center" title="üí¨ Discussions">üí¨</th>
    <th nowrap="nowrap" align="center" title="üí´ Star lists">üí´</th>
    <th nowrap="nowrap" align="center" title="üìÜ Commit calendar">üìÜ</th>
    <th nowrap="nowrap" align="center" title="üèÜ Achievements">üèÜ</th>
    <th nowrap="nowrap" align="center" title="üé© Notable contributions">üé©</th>
    <th nowrap="nowrap" align="center" title="üì∞ Recent activity">üì∞</th>
    <th nowrap="nowrap" align="center" title="üßÆ Repositories traffic">üßÆ</th>
    <th nowrap="nowrap" align="center" title="‚ôê Random code snippet">‚ôê</th>
    <th nowrap="nowrap" align="center" title="üé´ Gists">üé´</th>
    <th nowrap="nowrap" align="center" title="üóÇÔ∏è GitHub projects">üóÇÔ∏è</th>
    <th nowrap="nowrap" align="center" title="üôã Introduction">üôã</th>
    <th nowrap="nowrap" align="center" title="üåá GitHub Skyline">üåá</th>
    <th nowrap="nowrap" align="center" title="üí≠ GitHub Community Support">üí≠</th>
    <th nowrap="nowrap" align="center" title="‚è±Ô∏è Google PageSpeed">‚è±Ô∏è</th>
    <th nowrap="nowrap" align="center" title="üê§ Latest tweets">üê§</th>
    <th nowrap="nowrap" align="center" title="üó®Ô∏è Stack Overflow">üó®Ô∏è</th>
    <th nowrap="nowrap" align="center" title="üå∏ Anilist watch list and reading list">üå∏</th>
    <th nowrap="nowrap" align="center" title="üéº Music activity and suggestions">üéº</th>
    <th nowrap="nowrap" align="center" title="‚úíÔ∏è Recent posts">‚úíÔ∏è</th>
    <th nowrap="nowrap" align="center" title="üóº Rss feed">üóº</th>
    <th nowrap="nowrap" align="center" title="‚è∞ WakaTime">‚è∞</th>
    <th nowrap="nowrap" align="center" title="üó≥Ô∏è Leetcode">üó≥Ô∏è</th>
    <th nowrap="nowrap" align="center" title="üïπÔ∏è Steam">üïπÔ∏è</th>
  </tr>  
  <tr>
    <td nowrap="nowrap">üë§ User</td>    
    <td nowrap="nowrap" align="center" data-plugin="base">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="isocalendar">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="languages">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="stargazers">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="lines">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="topics">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="stars">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="licenses">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="habits">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="contributors">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="followup">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="reactions">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="people">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="sponsorships">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="sponsors">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="repositories">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="discussions">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="starlists">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="calendar">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="achievements">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="notable">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="activity">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="traffic">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="code">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="gists">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="projects">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="introduction">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="skyline">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="support">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="pagespeed">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="tweets">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="stackoverflow">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="anilist">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="music">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="posts">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="rss">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="wakatime">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="leetcode">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="steam">‚úîÔ∏è</td>
  </tr>
  <tr>
    <td nowrap="nowrap">üë• Organization</td>    
    <td nowrap="nowrap" align="center" data-plugin="base">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="isocalendar">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="languages">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="stargazers">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="lines">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="topics">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="stars">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="licenses">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="habits">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="contributors">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="followup">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="reactions">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="people">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="sponsorships">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="sponsors">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="repositories">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="discussions">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="starlists">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="calendar">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="achievements">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="notable">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="activity">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="traffic">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="code">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="gists">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="projects">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="introduction">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="skyline">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="support">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="pagespeed">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="tweets">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="stackoverflow">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="anilist">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="music">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="posts">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="rss">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="wakatime">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="leetcode">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="steam">‚úîÔ∏è</td>
  </tr>
  <tr>
    <td nowrap="nowrap">üìì Repository</td>    
    <td nowrap="nowrap" align="center" data-plugin="base">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="isocalendar">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="languages">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="stargazers">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="lines">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="topics">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="stars">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="licenses">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="habits">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="contributors">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="followup">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="reactions">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="people">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="sponsorships">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="sponsors">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="repositories">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="discussions">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="starlists">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="calendar">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="achievements">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="notable">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="activity">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="traffic">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="code">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="gists">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="projects">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="introduction">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="skyline">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="support">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="pagespeed">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="tweets">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="stackoverflow">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="anilist">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="music">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="posts">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="rss">‚úîÔ∏è</td>
    <td nowrap="nowrap" align="center" data-plugin="wakatime">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="leetcode">‚ùå</td>
    <td nowrap="nowrap" align="center" data-plugin="steam">‚ùå</td>
  </tr>
</table>

*Note: **markdown template** can actually render any kind of SVG metrics using [`embed` function](https://github.com/lowlighter/metrics/blob/master/source/templates/markdown/example.md#embedding-svg-metrics)*
</file>

<file path=".github/readme/partials/documentation/contributing.md">
## üí™ Contributing

If you are interested in contributing, the following resources may interest you:

* [üí™ Contribution guide](/CONTRIBUTING.md)
* [üß¨ Architecture](/ARCHITECTURE.md)
* [üìú License](/LICENSE)
* **:octocat: GitHub resources**
  * [üìñ GitHub GraphQL API](https://docs.github.com/en/graphql)
  * [üìñ GitHub GraphQL Explorer](https://docs.github.com/en/free-pro-team@latest/graphql/overview/explorer)
  * [üìñ GitHub Rest API](https://docs.github.com/en/rest)
  * [üìñ GitHub Octicons](https://github.com/primer/octicons)

Use [`üí¨ discussions`](https://github.com/lowlighter/metrics/discussions) for feedback, new features suggestions, bugs reports or to request help for installation.
</file>

<file path=".github/readme/partials/documentation/inspirations.md">
# ‚ú® Inspirations

* [anuraghazra/github-readme-stats](https://github.com/anuraghazra/github-readme-stats)
* [jstrieb/github-stats](https://github.com/jstrieb/github-stats)
* [ankurparihar/readme-pagespeed-insights](https://github.com/ankurparihar/readme-pagespeed-insights)
* [jasonlong/isometric-contributions](https://github.com/jasonlong/isometric-contributions)
* [jamesgeorge007/github-activity-readme](https://github.com/jamesgeorge007/github-activity-readme)
* [vvo/sourcekarma](https://github.com/vvo/sourcekarma)
* [ryo-ma/github-profile-trophy](https://github.com/ryo-ma/github-profile-trophy)
* [teoxoy/profile-readme-stats](https://github.com/teoxoy/profile-readme-stats)
* [dyatko/worldstar](https://github.com/dyatko/worldstar)
</file>

<file path=".github/readme/partials/documentation/organizations.md">
# üè¶ Configure metrics for organizations

While *metrics* targets mainly user accounts, it's possible to render metrics for organization accounts.

![Metrics (organization account)](https://github.com/lowlighter/metrics/blob/examples/metrics.organization.svg)

## *Ô∏è‚É£ Using *metrics* on organization

Setup is mostly the same as for user accounts. A personal access token from an user account is required excepted that `read:org` scope must be enabled, **whether you are member of the target organization or not**.

![Add read:org scope to personal token](/.github/readme/imgs/setup_token_org_read_scope.light.png#gh-light-mode-only)
![Add read:org scope to personal token](/.github/readme/imgs/setup_token_org_read_scope.dark.png#gh-dark-mode-only)

`user` option will need to be set to organization name instead.

*Example: render metrics for `github` organization*
```yaml
- uses: lowlighter/metrics@latest
  with:
    token: ${{ secrets.METRICS_TOKEN }}
    user: github
```

> üí° If your organization using single sign-on, you may need to [authorize your personal token access](https://docs.github.com/en/free-pro-team@latest/github/authenticating-to-github/authorizing-a-personal-access-token-for-use-with-saml-single-sign-on)

> üí° Plugins supporting organizations account are labeled with `üë• Organizations`. Note that rendering consume way more API requests and huge organization may not actually be able to use a given plugin.

> üí° To support private repositories, add `repo` scope

It is possible to host workflows in the `.github` repository of organizations, and display *metrics* on [organization profiles](https://docs.github.com/en/organizations/collaborating-with-groups-in-organizations/customizing-your-organizations-profile).

## *Ô∏è‚É£ Organizations memberships for user accounts

By default, GitHub only display public memberships.
Membership visibility can be managed in the `People` tab of your organization.

![Publish organization membership](/.github/readme/imgs/setup_public_membership_org.light.png#gh-light-mode-only)
![Publish organization membership](/.github/readme/imgs/setup_public_membership_org.dark.png#gh-dark-mode-only)

> ‚ö†Ô∏è Seeing your organization membership in your profile **does not** mean that it is visible from other users! You can check this by viewing your profile in an private browser window.
</file>

<file path=".github/readme/partials/documentation/selfhosted.md">
# üè† Run metrics on self-hosted runners

## 0Ô∏è Setup a self-hosted runner

Learn more about hosting runners on [GitHub documentation](https://docs.github.com/en/actions/hosting-your-own-runners).

> ‚ö†Ô∏è To run *metrics* on a self-hosted runner, the following dependencies needs to be installed on runner:
> - [docker](https://www.docker.com)
> - [jq](https://github.com/stedolan/jq)

Go to repository settings, and select `Runners` under the `Actions` side tab.

![Add a self-hosted runner](/.github/readme/imgs/setup_selfhosted_create.light.png#gh-light-mode-only)
![Add a self-hosted runner](/.github/readme/imgs/setup_selfhosted_create.dark.png#gh-dark-mode-only)

> ‚ö†Ô∏è Working user **must be able** to run docker. If *metrics* is run with an unprivileged user, ensure it can open `/var/run/docker.sock`
>
> Use the following workaround when receiving the following error: `dial unix /var/run/docker.sock: connect: permission denied`
> ```bash
> usermod -a -G docker $USER
> chown root:docker /var/run/docker.sock
> ```

## 1Ô∏è Update workflows to use self-hosted runners

To run *metrics* action on a self-hosted runner, uses `runs-on: self-hosted`.

*Example: render metrics for `github` organization*
```yaml
runs-on: self-hosted
steps:
  - uses: lowlighter/metrics@latest
    with:
      token: ${{ secrets.METRICS_TOKEN }}
```

> üí° To easily debug workflow errors, use [`debug: yes`](https://github.com/lowlighter/metrics/tree/master/source/plugins/core#debug) option
</file>

<file path=".github/readme/partials/documentation/setup.md">
## ü¶Æ Setup

There are several ways to setup metrics, each having its advantages and disadvantages:

* [‚öôÔ∏è Using GitHub Action on a profile repository *(~10 min)*](/.github/readme/partials/documentation/setup/action.md)
  * ‚úîÔ∏è All features
  * ‚úîÔ∏è High availability (no downtimes)
  * ‚ûñ Configuration can be a bit time-consuming
* [üíï Using the shared instance *(~1 min)*](/.github/readme/partials/documentation/setup/shared.md)
  * ‚úîÔ∏è Easily configurable and previewable
  * ‚ûñ Limited features *(compute-intensive features are disabled)*
* [üèóÔ∏è Deploying a web instance *(~20 min)*](/.github/readme/partials/documentation/setup/web.md)
  * ‚úîÔ∏è Create another shared instance
  * ‚ûñ Requires some sysadmin knowledge
* [üê≥ Using command line with docker *(~2 min)*](/.github/readme/partials/documentation/setup/docker.md)
  * ‚úîÔ∏è Suited for one-time rendering
* [üîß Local setup for development *(~20 min)*](/.github/readme/partials/documentation/setup/local.md)

Additional resources for setup:
* [üè¶ Configure metrics for organizations](/.github/readme/partials/documentation/organizations.md)
* [üè† Run metrics on self-hosted runners](/.github/readme/partials/documentation/selfhosted.md)
* [üß∞ Template/Plugin compatibility matrix](/.github/readme/partials/documentation/compatibility.md)
</file>

<file path=".github/readme/partials/templated/compatibility.md">
# üß∞ Template/Plugin compatibility matrix

<table>
  <tr>
    <th nowrap="nowrap">Template/Plugin</th><%# -%>
    <% for (const [plugin, {name, icon}] of Object.entries(plugins).filter(([key, value]) => (value)&&(!["core"].includes(key))&&(value.category !== "community"))) { %>
    <th nowrap="nowrap" align="center" title="<%= name %>"><%= icon %></th><% } %>
  </tr><%# -%>
  <% for (const [template, {name, readme}] of Object.entries(templates).filter(([key, value]) => (value)&&(!["community"].includes(key)))) { %>
  <tr>
    <td nowrap="nowrap"><%- name %></td><%# -%>
    <% for (const [plugin] of Object.entries(plugins).filter(([key, value]) => (value)&&(!["core"].includes(key))&&(value.category !== "community"))) { %>
    <td nowrap="nowrap" align="center" data-plugin="<%= plugin %>"><%= {true:"‚úîÔ∏è", false:"‚ùå", embed:"‚úì"}[readme.compatibility[plugin]] %></td><% } %>
  </tr><% } %>
  <tr>
    <td colspan="<%= Object.entries(plugins).filter(([key, value]) => (value)&&(!["core"].includes(key))&&(value.category !== "community")).length %>"></td>
  </tr>
  <tr>
    <th nowrap="nowrap">Mode/Plugin</th><%# -%>
    <% for (const [plugin, {name, icon}] of Object.entries(plugins).filter(([key, value]) => (value)&&(!["core"].includes(key))&&(value.category !== "community"))) { %>
    <th nowrap="nowrap" align="center" title="<%= name %>"><%= icon %></th><% } %>
  </tr><%# -%>
  <% for (const {mode, icon} of [{mode:"user", icon:"üë§"}, {mode:"organization", icon:"üë•"}, {mode:"repository", icon:"üìì"}]) { %>
  <tr>
    <td nowrap="nowrap"><%= icon %> <%- `${mode.charAt(0).toLocaleUpperCase()}${mode.substring(1)}` %></td><%# -%>
    <% for (const [plugin, {supports}] of Object.entries(plugins).filter(([key, value]) => (value)&&(!["core"].includes(key))&&(value.category !== "community"))) {%>
    <td nowrap="nowrap" align="center" data-plugin="<%= plugin %>"><%= supports.includes(mode) ? "‚úîÔ∏è" : "‚ùå" %></td><% } %>
  </tr><% } %>
</table>

*Note: **markdown template** can actually render any kind of SVG metrics using [`embed` function](https://github.com/lowlighter/metrics/blob/master/source/templates/markdown/example.md#embedding-svg-metrics)*
</file>

<file path=".github/readme/partials/templated/documentation.md">
# üìö Documentation

<% if (/[.]0-beta$/.test(packaged.version)) { %>
> <sup>*‚ö†Ô∏è This is the documentation of **v<%= packaged.version.replace(/[.]0-beta$/, "") %>-beta** (`@master`/`@main` branches) which includes [unreleased features](https://github.com/lowlighter/metrics/compare/latest...master) planned for next release. See documentation for current released version [**v<%= (Number(packaged.version.replace(/[.]0-beta$/, ""))-0.01).toFixed(2).replace(/[.]0/, ".") %>** (`@latest` branch) here](https://github.com/lowlighter/metrics/blob/latest/README.md).* </sup>
<% } %>

<% for (const partial of ["documentation/setup", "templated/templates", "templated/plugins", "documentation/contributing"]) { %>
<%- await include(`/partials/${partial}.md`) -%>
<% } %>
</file>

<file path=".github/readme/partials/templated/introduction.md">
Generate metrics that can be embedded everywhere, including your GitHub profile readme! Supports users, organizations, and even repositories!

<table>
  <tr>
    <th align="center">For user accounts</th>
    <th align="center">For organization accounts</th>
  </tr>
  <tr>
    <%- plugins.base.readme.demo?.replace(/<img src=/g, `<img alt="" width="400" src=`) %>
  </tr>
<% {
  let cell = 0
  const elements = Object.entries(plugins).filter(([key, value]) => (value)&&(!["base", "core"].includes(key)&&(value.category !== "community")&&(!value.deprecation)))
-%>
  <tr>
    <th colspan="2" align="center">
      <h3><a href="/README.md#-plugins">üß© Customizable with <%= Object.entries(plugins).filter(([key, value]) => (value)&&(!["base", "core"].includes(key))).length %> plugins and <%= Object.entries(descriptor.inputs).length %> options!</a></h3>
    </th>
  </tr>
<%  if (elements.length%2)
      elements.push(["", {readme:{demo:`<td align="center"><img width="900" height="1" alt=""></td>`}}])
    for (let i = 0; i < elements.length; i+=2) {
    const cells = [["even", elements[i]], ["odd", elements[i+1]]]
      for (const [cell, [plugin, {name, readme}]] of cells) {
        if (cell === "even") {
-%>
  <tr>
<% } %>    <th><% if (plugin) { %><a href="source/plugins/<%= plugin %>/README.md"><%= name -%></a><% } %></th>
<%      if (cell === "odd") {
-%>  </tr>
<% }}
      for (const [cell, [plugin, {name, readme}]] of cells) {
        if (cell === "even") {
-%>
  <tr>
<% } %>    <%- readme.demo.replace(/<img src=/g, `<img alt="" width="400" src=`)?.split("\n")?.map((x, i) => i ? `  ${x}` : x)?.join("\n") %>
<%      if (cell === "odd") {
-%>  </tr>
<% }}}} {
  let cell = 0
  const elements = Object.entries(plugins).filter(([key, value]) => (value.category === "community")&&(!value.deprecation))
  if (elements.length%2)
    elements.push(["", {readme:{demo:`<td align="center"><img width="900" height="1" alt=""></td>`}}])
-%>
  <tr>
    <th colspan="2" align="center">
      <a href="/source/plugins/community/README.md">üé≤ See also community plugins</a>
    </th>
  </tr>
<%
  for (let i = 0; i < elements.length; i+=2) {
    const cells = [["even", elements[i]], ["odd", elements[i+1]]]
      for (const [cell, [plugin, {name, readme, authors}]] of cells) {
        if (cell === "even") {
-%>
  <tr>
<% } %>    <th><% if (plugin) { %><a href="source/plugins/community/<%= plugin %>/README.md"><%= name -%></a><br><sup>by <%- authors.map(author => `<a href="https://github.com/${author}">@${author}</a>`).join(" ") %></sup>
<%- readme.demo.replace(/<td.*?>([\s\S]+?)<\/td>/, `  <details><summary>Render example</summary>$1</details>`).replace(/<img src=/g, `<img alt="" width="400" src=`)?.split("\n")?.map((x, i) => i ? `  ${x}` : x)?.join("\n") %><% } %>
    </th>
<%      if (cell === "odd") {
-%>  </tr>
<% }}}} %><%# -%>
<% {
  let cell = 0
  const elements = Object.entries(templates).filter(([key, value]) => (value)&&(!["community"].includes(key)))
-%>
  <tr>
    <th colspan="2" align="center">
      <h3><a href="/README.md#%EF%B8%8F-templates">üñºÔ∏è And even more with <%= elements.length %>+ templates!</a></h3>
    </th>
  </tr>
<%  if (elements.length%2)
      elements.push(["", {readme:{demo:`<td align="center"><img width="900" height="1" alt=""></td>`}}])
    for (let i = 0; i < elements.length; i+=2) {
    const cells = [["even", elements[i]], ["odd", elements[i+1]]]
      for (const [cell, [template, {name, readme}]] of cells) {
        if (cell === "even") {
-%>
  <tr>
<% } %>    <th><a href="/source/templates/<%= template %>/README.md"><%- name -%></a></th>
<%      if (cell === "odd") {
-%>  </tr>
<% }}
    for (const [cell, [template, {name, readme}]] of cells) {
        if (cell === "even") {
-%>
  <tr>
<% } %>    <%- readme.demo.replace(/<img src=/g, `<img alt="" width="400" src=`)?.split("\n")?.map((x, i) => i ? `  ${x}` : x)?.join("\n") %>
<%      if (cell === "odd") {
-%>  </tr>
<% }}} -%>
  <tr>
    <th colspan="2"><a href="/source/templates/community/README.md">üìï See also community templates</a></th>
  </tr>
  <tr>
    <th colspan="2"><h2>ü¶ë Try it now!</h2></th>
  </tr>
  <tr>
    <th><a href="https://metrics.lecoq.io/embed">üìä Metrics embed</a></th>
    <th><a href="https://metrics.lecoq.io/insights">‚ú® Metrics insights</a></th>
  </tr>
  <tr>
    <td align="center">
      Embed metrics images on your profile or blog!<br>
      Use <a href="https://github.com/marketplace/actions/metrics-embed">GitHub actions</a> for even more features!<br>
      <img src="/.github/readme/imgs/features_embed.gif" width="360">
    </td>
    <td align="center">
      Share your metrics with friends and on social medias!<br>
      No configuration needed!<br>
      <img src="/.github/readme/imgs/features_insights.gif" width="360">
    </td>
  </tr>
  <tr>
    <td align="center" colspan="2">
      Test latest features and patches on <code><a href="https://beta-metrics.lecoq.io">üß™ Metrics beta</a></code>!
    </td>
  </tr>
  <tr>
    <td align="center" colspan="2">
      <b>Power user?</b><br>
      <a href="https://github.com/lowlighter/metrics/fork">Fork this repository</a> and edit HTML, CSS, JS and <a href="https://github.com/mde/ejs">EJS</a> for even more customization!
    </td>
  </tr>
</table>
<% } %>
</file>

<file path=".github/readme/partials/templated/plugins.community.md">
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üé≤ Community plugins</h3></th></tr>
  <tr><td colspan="2" align="center">Additional plugins maintained by community for even more features!</td></tr>
<% {
  let cell = 0
  const elements = Object.entries(plugins).filter(([key, value]) => (value)&&(value.category === "community"))
  if (elements.length%2)
    elements.push(["", {readme:{demo:`<td align="center"><img width="900" height="1" alt=""></td>`}}])
  for (let i = 0; i < elements.length; i+=2) {
    const cells = [["even", elements[i]], ["odd", elements[i+1]]]
    for (const [cell, [plugin, {name, readme, authors}]] of cells) {
      if (cell === "even") { %>  <tr><% } %>
    <th><% if (plugin) { %><a href="/source/plugins/community/<%= plugin %>/README.md"><%= name -%></a><br><sup>by <%- authors.map(author => `<a href="https://github.com/${author}">@${author}</a>`).join(" ") %></sup><% } %></th><%
    if (cell === "odd") { %>
  </tr>
<% }}
    for (const [cell, [plugin, {name, readme}]] of cells) {
      if (cell === "even") { %>  <tr><% } %>
<%- readme.demo.replace(/<img src=/g, `<img alt="" width="400" src=`) %><%
      if (cell === "odd") { %>
  </tr><% }}}} %>
</table>

## üì™ Creating community plugins

Plugins creation requires you to be comfortable with JavaScript, HTML, CSS and [EJS](https://github.com/mde/ejs).

### üí¨ Before creating a new plugin

Be sure to read [contribution guide](/CONTRIBUTING.md) and [architecture](/ARCHITECTURE.md) first.

> ‚ÑπÔ∏è *metrics* maintainers have no obligation towards community plugins support and may redirect any help, feature or fix requests from other users to you. Of course you are not bound to work on it, but it would be great if you plan to merge a plugin in the main repository

Please respect the following guidelines:

- A plugin should be independent and should not rely on other plugins
  - [üß± core](/source/plugins/core/README.md) and [üóÉÔ∏è base](/source/plugins/base/README.md) output can be reused though
- A plugin should never edit its original arguments, as it is shared amongst other plugins and would create unattended side effects
- Use `imports.metadata.plugins.{plugin-name}.inputs()` to automatically type check and default user inputs through defined `metadata.yml`
- Plugin options should respect the "lexical field" of existing option to keep consistency
- Plugin errors should be handled gracefully by partials with error message
- New dependencies should be avoided, consider using existing `imports`
- Spawning sub-process should be avoided, unless absolute necessity
  - Use `imports.which()` to detect whether a command is available
  - Use `imports.run()` to run a command
    - Pass `{prefixed: true}` to wrap automatically command with [WSL](https://docs.microsoft.com/windows/wsl/about) on Windows
  - It is required to work on Linux Ubuntu (as the GitHub action run on it)

> üí° While the following guide intend to explain the creation process of new plugin, it may also be a good idea to see what existing plugins looks like and see if you want to embark on the adventure!

### üí¨ Quick-start

To create a new plugin, clone and setup this repository first:
```shell
git clone https://github.com/lowlighter/metrics.git
cd metrics/
npm install
```

Find a cool name and an [unused emoji](https://emojipedia.org) for your new plugin and run the following:
```shell
npm run quickstart plugin <plugin_name>
```

> ‚ö†Ô∏è Community plugins cannot have the same name as official plugins. *metrics* maintainers may also reserve a plugin name for future usage and may ask you to rename it in case of conflicts

It will create a new directory in `/source/plugins/community` with the following file structure:
* `/source/plugins/community/{plugin-name}`
  * `README.md`
  * `metadata.yml`
  * `examples.mjs`
  * `index.mjs`

Plugins are auto-loaded based on their folder existence, so there's no need to register them somewhere.

### üí¨ Filling `metadata.yml`

`metadata.yml` is a required file which describes supported account types, output formats, scopes, etc.

The default file looks like below:
```yaml
name: "üß© Plugin name"
category: community
description: Short description
examples:
  default: https://via.placeholder.com/468x60?text=No%20preview%20available
authors:
  - octocat
supports:
  - user
  - organization
  - repository
scopes: []
inputs:

  plugin_{name}:
    description: Enable {name} plugin
    type: boolean
    default: no
```

> üí° It is important to correctly define `metadata.yml` because *metrics* will use its content for various usage

[`üß± core`](/source/plugins/core/README.md) plugin (which is always called) will automatically verify user inputs against `supports` and `inputs` values and throw an error in case of incompatibility.

`name`, `description`, `scopes`, `examples` are used to auto-generate documentation in the `README.md`. For community plugins, `examples` should be set with auto-generated examples of your own profile.

`authors` should contain your GitHub username

`category` should be set to `community`.

Because of GitHub Actions original limitations, only strings, numbers and boolean were actually supported by `action.yml`. *metrics* implemented its own `inputs` validator to circumvent this. It should be pretty simple to use.

*Example: boolean type, defaults to `false`*
```yml
  plugin_{name}_{option}:
    description: Boolean type
    type: boolean
    default: no
```

```yml
  plugin_{name}_{option}:
    description: String type
    type: string
    default: .user.login
```

> üí° `.user.login`, `.user.twitter` and `.user.website` are special default values that will be respectively replaced by user's login, Twitter username and attached website. Note that these are not available if `token: NOT_NEEDED` is set by user

*Example: string type, defaults to `foo` with `foo` or `bar` as allowed values*
```yml
  plugin_{name}_{option}:
    description: Select type
    type: string
    values:
      - foo
      - bar
    default: foo
```

> üí° `values` restricts what can be passed by user

*Example: number type, defaults to `1` and expected to be between `0` and `100`*
```yml
  plugin_{name}_{option}:
    description: Number type
    type: number
    default: 1
    min: 0
    max: 100
```

> üí° `min` and `max` restricts what can be passed by user. Omit these to respectively remove lower and upper limits.

> üí° Zero may have a special behaviour (usually to disable limitations), if that's the case add a `zero` attribute (e.g. `zero: disable`) to reference this in documentation

*Example: array type, with comma-separated elements*
```yml
  plugin_{name}_{option}:
    description: Array type
    type: array
    format: comma-separated
    values:
      - foo
      - bar
    default: foo, bar
```

> üí° An array can be either `comma-separated` or `space-separated`, and will split user input by mentioned separator. Each value is trimmed and lowercased.

*Example: json type*
```yml
  plugin_{name}_{option}:
    description: JSON type
    type: json
    default: |
      {
        "foo": "bar"
      }
```

> üí° JSON types should be avoided when possible, as they're usually kind of unpractical to write within a YAML document

For complex inputs, pass an `example` that will be displayed as a placeholder on web instances.

When calling `imports.metadata.plugins.{plugin-name}.inputs({data, account, q})`, an object with verified user inputs and correct typing will be returned.

Any invalid input will use have the `default` value instead.

> ‚ö†Ô∏è Returned object will use the web syntax for options rather than the action one. It means that `plugin_` prefix is dropped, and all underscores (`_`) are replaced by dots (`.`)

*Example: validating user inputs*
```javascript
let {limit, "limit.field":limit_field} = imports.metadata.plugins.myplugin.inputs({data, account, q})
console.assert(limit === true)
```

### üí¨ Filling `index.mjs`

Plugins use [JavaScript modules](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules).

The default exported module of `index.mjs` will be auto-loaded when *metrics* start.

Below is a breakdown of basic `index.mjs` content
```js
export default async function(
  //Shared inputs
  {
    login, //GitHub username
    q, //Raw user inputs (dot notation without plugin_ prefix, don't use it directly)
    imports, //Various utilities (axios, puppeteer, fs, etc., see /source/app/metrics/utils.mjs)
    data, //Raw data from core/base plugin
    computed, //Computed data from core/base plugin
    rest, //Rest authenticated GitHub octokit
    graphql, //Graph QL authenticated GitHub octokit
    queries, //Autoloaded queries from ./queries
    account, //Account type ("user" or "organization")
  },
  //Settings and tokens
  {
    enabled = false,
    extras = false,
  } = {}) {
    //Plugin execution
    try {
      //Check if plugin is enabled and requirements are met
      if ((!q.my_plugin)||(imports.metadata.plugins.my_plugin.enabled(enabled, {extras})))
        return null

      //Automatically validate user inputs
      //An error will be thrown if `account` type is not supported
      //Inputs will have correct typing from `metadata.yml` and unset or invalid options will be set to default
      let {option} = imports.metadata.plugins.my_plugin.inputs({data, account, q})

      //Automatically template query from /source/plugins/myplugin/queries/myquery.graph ql
      const {[account]:stuff} = await graphql(queries.myplugin.myquery({login, account, option}))

      //Results
      return {stuff}
    }
    //Handle errors
    catch (error) {
      throw imports.format.error(error)
    }
}
```

> ‚ö†Ô∏è Remember, a plugin should never edit its original arguments, as it is shared amongst other plugins and would create unattended side effects

### üí¨ Creating partials

Just create a new `.ejs` file in `partials` folder from templates you wish to support, and reference it into their `partials/_.json`.

Plugin partials should be able to handle gracefully their own state and errors.

Below is a minimal snippet of a partial:
```ejs
<<%= "%" %> if (plugins.{plugin_name}) { <%= "%" %>>
  <<%= "%" %> if (plugins.{plugin_name}.error) { <%= "%" %>>
    <<%= "%=" %> plugins.{plugin_name}.error.message <%= "%" %>>
  <<%= "%" %> } else { <%= "%" %>>
    <<%= "%#" %> content <%= "%" %>>
  <<%= "%" %> } <%= "%" %>>
<<%= "%" %> } <%= "%" %>>
```

Partials should have the match the same name as plugin handles, as they're used to display plugin compatibility in auto-generated header.

[EJS](https://github.com/mde/ejs) framework is used to template content through templating tags (`<% %>`).

### üí¨ Filling `README.md`

`README.md` is used as documentation.

Most of it will is auto-generated by `metadata.yml` and `examples.yml` content, so usually it is not required to manually edit it.

The default content looks like below:
```markdown
<«É--header-->
<«É--/header-->

## ‚û°Ô∏è Available options

<«É--options-->
<«É--/options-->

## ‚ÑπÔ∏è Examples workflows

<«É--examples-->
<«É--/examples-->
```

- `<«É--header-->` will be replaced by an auto-generated header containing plugin name, supported features and output examples based on `metadata.yml`
- `<«É--options-->` will be replaced by an auto-generated table containing all referenced option from `metadata.yml`
- `<«É--examples-->` will be replaced by workflows from `examples.yml`

> ‚ö†Ô∏è Do not replace these auto-generated placeholder yet! They will be built by the ci workflow and will help making your pull request easier to read

When a plugin requires a token, please add a `## üóùÔ∏è Obtaining a {service} token` section after the available options section.

Complex features may also be documented in additional sections after available options section options if required.

Try to respect current format of `README.md` from other plugins and use a neutral and impersonal writing style if possible.

### üí¨ Filling `examples.yml`

Workflow examples from `examples.yml` are used as unit testing and to auto-generate documentation in the `README.md`.

It uses the same syntax as GitHub action and looks like below:
```yml
- name: Test name
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.{name}.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_{name}: yes
  prod:
    skip: true
  test:
    timeout: 1800000
    modes:
      - action
      - web
      - placeholder
```

> üí° Tests are executed in a mocked environment to avoid causing charges on external services. It may be required to create mock testing files.

`test` is usually not needed and optional but can be set to set a custom timeout (for plugins with a high execution time) and `modes` can be used to restrict which environment should be used.

`prod` should keep `skip: true` as you should use your own render outputs as examples.

### üí¨ Testing locally and creating mocked data

The easiest way to test a new plugin is to setup a web instance locally ([see documentation](.github/readme/partials/documentation/setup/local.md)).

Once server is started, open a browser and try to generate an output with your new plugin enabled and check if it works as expected:
```
http://localhost:3000/username?base=0&my-plugin=1
```

> üí° You may need to configure your server first by editing `settings.json`. Ensure that:
> - `token` is correctly set when working with GitHub APIs
> - `plugins.default` is set to `true` as plugins are disabled by default
>   - or enable your plugins by manually in `plugins`.`my-plugin`.`enabled`
> -  `debug` is set to `true` for more verbose output

When your plugin is finalized, you may need to create mocked data if it either uses GitHub APIs or any external service.

They must be created in `tests/mocks/api`:
- use `github` directory for all related GitHub APIs data
- use `axios` directory for all external service that you call using `imports.axios`

> üí° Files from these directories are auto-loaded, so it is just required to create them with faked data.

Finally [/source/app/web/statics/app.placeholder.js](/source/app/web/statics/app.placeholder.js) to add mocked placeholder data to make users using the shared instance able to preview a render locally without any server computation.

### üí¨ Submitting a pull request

If you made it until there, congratulations ü•≥!

You're almost done, review the following checklist before submitting a pull request:
- [x] I have correctly filled `metadata.yml`
  - [x] `name` is set with an unused emoji and plugin name
  - [x] `category` is set to `community`
  - [x] `examples` contains links towards a rendered output hosted by you
  - [x] `authors` contains my GitHub username
  - [x] `supports` list which account type are supported
  - [x] `scopes` are correctly listed with their associated names on GitHub (leave an empty array if not applicable)
  - [x] `inputs` are correctly filled
- [x] I have implemented my plugin
  - [x] `index.mjs` respects the plugins guidelines
- [x] I have tested my plugin locally
  - [x] `tests/mocks` ... have been created
  - [x] `app.placeholder.js` has been updated for preview from web instances
  - [x] `examples.yml` contains workflows examples (at least one is required)
    - [x] `skip: true` has been set for `prod` attribute in each test
  - [x] `npm run linter` yields no errors
- [x] I have documented my plugin
  - [x] `README.md` eventually describes complex setup or options (if applicable)
- [x] I am ready!
  - [x] Checkout any generated files (in fact, don't run `npm run build`)
  - [x] Commit and push your changes (commits are squashed, no need to rebase)
  - [x] Open a new [pull request](https://github.com/lowlighter/metrics/pulls)
  - [x] Post a screenshot or a render in the pull request so it can be previewed

> üí° A pull request **will need** to have passing builds and an example screenshot if you want to get it merged.
> Maintainers may request changes in some cases

> üéä Thanks a lot for your contribution!
</file>

<file path=".github/readme/partials/templated/plugins.md">
## üß© Plugins

Plugins provide additional content and lets you customize rendered metrics.

**üì¶ Maintained by core team**
<% { let previous = null; for (const [plugin, {name, category, deprecation, authors = []}] of Object.entries(plugins).filter(([key, value]) => (value)&&(value.category !== "community")).sort(([an, a], [bn, b]) => a.category === b.category ? an.localeCompare(bn) : 0)) { %>
<% if (previous !== category) { previous = category -%>
* **<%= `${category === "github" ? "GitHub" : `${category.charAt(0).toLocaleUpperCase()}${category.substring(1)}`} plugins` %>**
<% } -%>
  * [<%- name %> <sub>`<%= plugin %>`</sub>](/source/plugins/<%= plugin %>/README.md)<%# -%><% if (deprecation) { %> <sub>`‚ö†Ô∏è deprecated`</sub><% } %><%# -%>
<% }} %>

**üé≤ Maintained by community**
* **[Community plugins](/source/plugins/community/README.md)**
<% { let previous = null; for (const [plugin, {name, category, authors = []}] of Object.entries(plugins).filter(([key, value]) => (value)&&(value.category === "community")).sort(([an, a], [bn, b]) => a.category === b.category ? an.localeCompare(bn) : 0)) { %><%# -%>
  * [<%- name %> <sub>`<%= plugin %>`</sub>](/source/plugins/community/<%= plugin %>/README.md) by <%- authors.map(author => `[@${author}](https://github.com/${author})`).join(" ") %>
<% }} %>
</file>

<file path=".github/readme/partials/templated/README.md">
# üìä Metrics [<img src="https://api.producthunt.com/widgets/embed-image/v1/featured.svg?post_id=280144&theme=dark" alt="" align="right" width="190" height="41">](https://www.producthunt.com/posts/github-metrics?utm_source=badge-featured&utm_medium=badge&utm_source=badge-github-metrics)

[![Continuous integration](https://github.com/lowlighter/metrics/actions/workflows/ci.yml/badge.svg)](https://github.com/lowlighter/metrics/actions/workflows/ci.yml)

<% for (const partial of ["templated/introduction", "templated/documentation", "license"]) { -%>
<%- await include(`/partials/${partial}.md`) %>
<% } %>
</file>

<file path=".github/readme/partials/templated/templates.md">
## üñºÔ∏è Templates

Templates lets you change general appearance of rendered metrics.

<% for (const [template, {name}] of Object.entries(templates).filter(([key, value]) => value)) { %>
* [<%- name %> <sub>`<%= template %>`</sub>](/source/templates/<%= template %>/README.md)<%# -%>
<% } %>
</file>

<file path=".github/readme/partials/license.md">
## üìú License

```
MIT License
Copyright (c) 2020-present lowlighter
```

![Sponsors](https://github.com/lowlighter/metrics/blob/examples/metrics.sponsors.svg)
</file>

<file path=".github/scripts/files/examples.yml">
# THIS WORKFLOW IS AUTO-GENERATED
name: Publish examples
on:
  schedule:
    - cron: "0 8 1/2 * *"
  workflow_dispatch:
  workflow_call:
    secrets:
      METRICS_TOKEN:
        required: true
      METRICS_TOKEN_WITH_SCOPES:
        required: true
      METRICS_TOKEN_PERSONAL:
        required: true
      CHESS_TOKEN:
        required: true
      PAGESPEED_TOKEN:
        required: true
      GOOGLE_MAP_TOKEN:
        required: true
      SPLATOON_TOKEN:
        required: true
      SPLATOON_STATINK_TOKEN:
        required: true
      SIXTEEN_PERSONALITIES_URL:
        required: true
      SPOTIFY_TOKENS:
        required: true
      STOCK_TOKEN:
        required: true
      TWITTER_TOKEN:
        required: true
      WAKATIME_TOKEN:
        required: true
jobs:

# ======================================================================================
# Examples renders
# ======================================================================================

  examples:
    runs-on: ubuntu-latest
    if: "github.repository == 'lowlighter/metrics'"
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Checkout examples
        run: git checkout examples

<%- steps.split("\n").map(line => `      ${line}`).join("\n") %>

      - name: Screenshot markdown example
        if: ${{ success() || failure() }}
        run: |
          docker run --rm --entrypoint="" --volume=/tmp:/tmp ghcr.io/lowlighter/metrics:master node /metrics/.github/scripts/markdown_example.mjs
          sudo mv /tmp/metrics.markdown.png /metrics_renders/
      - name: Publish examples
        if: ${{ success() || failure() }}
        run: |
          set +e
          sudo rm -rf /metrics_renders/github-metrics.*
          sudo mv /metrics_renders/* ./
          git config user.name github-actions[bot]
          git config user.email 41898282+github-actions[bot]@users.noreply.github.com
          git pull
          git reset --soft c8d364ee752ad090945b7e104873d24d011b521e
          git add --all
          git commit -m "chore: update examples"
          git push --force

# ======================================================================================
# Special job used to render lowlighter/metrics repository assets
# ======================================================================================

  repository:
    runs-on: ubuntu-latest
    needs: [ examples ]
    if: "github.repository == 'lowlighter/metrics'"
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Checkout examples
        run: git checkout examples

      - name: Contributors
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@master
        with:
          filename: metrics.contributors.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          template: repository
          user: lowlighter
          repo: metrics
          plugin_people: yes
          plugin_people_types: contributors
          plugins_errors_fatal: yes
          config_display: large
          output_action: none
          delay: 120
      - name: Sponsors
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@master
        with:
          filename: metrics.sponsors.svg
          token: ${{ secrets.METRICS_TOKEN_PERSONAL }}
          base: ""
          user: lowlighter
          plugin_sponsors: yes
          plugin_sponsors_past: yes
          plugin_sponsors_sections: list
          plugin_sponsors_size: 32
          plugins_errors_fatal: yes
          config_display: large
          output_action: none
          delay: 120
      - name: Licenses
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@master
        with:
          filename: metrics.licenses.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          template: repository
          user: lowlighter
          repo: metrics
          plugin_licenses: yes
          plugin_licenses_setup: npm ci
          plugin_licenses_legal: yes
          plugin_licenses_ratio: yes
          plugins_errors_fatal: yes
          output_action: none
          delay: 120

      - name: Publish examples
        if: ${{ success() || failure() }}
        run: |
          set +e
          git config user.name github-actions[bot]
          git config user.email 41898282+github-actions[bot]@users.noreply.github.com
          git pull
          sudo cp /metrics_renders/* ./
          git add --all
          git commit -m "chore: update examples"
          git push --force
</file>

<file path=".github/scripts/quickstart/plugin/examples.yml">
- name: Example
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.<%= name %>.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_<%= name %>: yes
  prod:
    skip: true
</file>

<file path=".github/scripts/quickstart/plugin/index.mjs">
//Setup
export default async function({login, q, imports, data, computed, rest, graphql, queries, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.<%= name %>) || (!imports.metadata.plugins.<%= name %>.enabled(enabled, {extras})))
      return null
    //Results
    return {}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path=".github/scripts/quickstart/plugin/metadata.yml">
name: üß© <%= `${name.charAt(0).toLocaleUpperCase()}${name.substring(1)}` %>
category: community
description: |
  Short description
examples:
  default: https://via.placeholder.com/468x60?text=No%20preview%20available
authors:
  - octocat
supports:
  - user
  - organization
  - repository
scopes: []
inputs:

  plugin_<%= name %>:
    description: |
      Enable <%= name %> plugin
    type: boolean
    default: no
</file>

<file path=".github/scripts/quickstart/plugin/README.md">
<!--header-->
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
<!--/examples-->
</file>

<file path=".github/scripts/quickstart/template/metadata.yml">
name: üñºÔ∏è Template name
extends: classic
description: |
  Short description
examples:
  default: https://via.placeholder.com/468x60?text=No%20preview%20available
authors:
  - octocat
supports:
  - user
  - organization
  - repository
formats:
  - svg
  - png
  - jpeg
  - json
  - markdown
  - markdown-pdf
</file>

<file path=".github/scripts/quickstart/template/README.md">
<!--header-->
<!--/header-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
<!--/examples-->
</file>

<file path=".github/scripts/quickstart/index.mjs">
//Imports
import fs from "fs"
import paths from "path"
import url from "url"
import ejs from "ejs"

//Mode
const [mode, name] = process.argv.slice(2)

//Paths
const __metrics = paths.join(paths.dirname(url.fileURLToPath(import.meta.url)), "../../..")
const __quickstart = paths.join(__metrics, ".github/scripts/quickstart")

//Check arguments
if ((!mode)||(!name))
  throw new Error(`Usage is "npm run quickstart -- <mode> <name>"`)
if (!["plugin", "template"].includes(mode))
  throw new Error(`Unsupported mode ${mode}`)

//Check if target directory already exists
const target = paths.join(__metrics, `source/${{plugin:"plugins/community", template:"templates"}[mode]}`, name)
if (fs.existsSync(target))
  throw new Error(`A ${mode} named ${name} already exists!`)

//Copy quickstart content
console.log(`quickstart for ${mode}`)
await fs.promises.mkdir(target)
await rcopy(paths.join(__quickstart, mode), target)

//Recursive copy
async function rcopy(from, to) {
  for (const file of await fs.promises.readdir(from)) {
    const path = paths.join(from, file)
    if ((await fs.promises.lstat(path)).isDirectory()) {
      await fs.promises.mkdir(paths.join(to, file))
      await rcopy(path, paths.join(to, file))
    }
    else {
      console.log(`copying ${path} to ${paths.join(to, file)}`)
      await fs.promises.writeFile(paths.join(to, file), await ejs.renderFile(path, {name}, {async:true}))
    }
  }
}
</file>

<file path=".github/scripts/build.mjs">
//Imports
import ejs from "ejs"
import fss from "fs"
import fs from "fs/promises"
import yaml from "js-yaml"
import paths from "path"
import sgit from "simple-git"
import url from "url"
import metadata from "../../source/app/metrics/metadata.mjs"

//Mode
const [mode = "dryrun"] = process.argv.slice(2)
console.log(`Mode: ${mode}`)

//Paths
const __metrics = paths.join(paths.dirname(url.fileURLToPath(import.meta.url)), "../..")
const __action = paths.join(__metrics, "source/app/action")
const __web = paths.join(__metrics, "source/app/web")
const __readme = paths.join(__metrics, ".github/readme")
const __documentation = paths.join(__metrics, ".github/readme/partials/templated")
const __templates = paths.join(paths.join(__metrics, "source/templates/"))
const __plugins = paths.join(paths.join(__metrics, "source/plugins/"))
const __test_cases = paths.join(paths.join(__metrics, "tests/cases"))
const __test_secrets = paths.join(paths.join(__metrics, "tests/secrets.json"))

//Git setup
const git = sgit(__metrics)
const staged = new Set()
const secrets = Object.assign(JSON.parse(`${await fs.readFile(__test_secrets)}`), {$regex: /\$\{\{\s*secrets\.(?<secret>\w+)\s*\}\}/})
const {plugins, templates} = await metadata({log: false, diff: true})
const workflow = []

//Plugins
for (const id of Object.keys(plugins)) {
  const {examples, options, readme, tests, header, community} = await plugin(id)

  //Readme
  console.log(`Generating source/plugins/${community ? "community/" : ""}${id}/README.md`)
  await fs.writeFile(
    readme.path,
    readme.content
      .replace(/(<!--header-->)[\s\S]*(<!--\/header-->)/g, `$1\n${header}\n$2`)
      .replace(/(<!--examples-->)[\s\S]*(<!--\/examples-->)/g, `$1\n${examples.map(({test, prod, ...step}) => ["```yaml", yaml.dump(step, {quotingType: '"', noCompatMode: true}), "```"].join("\n")).join("\n")}\n$2`)
      .replace(/(<!--options-->)[\s\S]*(<!--\/options-->)/g, `$1\n${options}\n$2`),
  )
  staged.add(readme.path)

  //Tests
  console.log(`Generating tests/plugins/${community ? "community/" : ""}${id}.yml`)
  workflow.push(...examples.map(example => testcase(plugins[id].name, "prod", example)).filter(t => t))
  await fs.writeFile(tests.path, yaml.dump(examples.map(example => testcase(plugins[id].name, "test", example)).filter(t => t)))
  staged.add(tests.path)
}

//Templates
for (const id of Object.keys(templates)) {
  const {examples, readme, tests, header} = await template(id)

  //Readme
  console.log(`Generating source/templates/${id}/README.md`)
  await fs.writeFile(
    readme.path,
    readme.content
      .replace(/(<!--header-->)[\s\S]*(<!--\/header-->)/g, `$1\n${header}\n$2`)
      .replace(/(<!--examples-->)[\s\S]*(<!--\/examples-->)/g, `$1\n${examples.map(({test, prod, ...step}) => ["```yaml", yaml.dump(step, {quotingType: '"', noCompatMode: true}), "```"].join("\n")).join("\n")}\n$2`),
  )
  staged.add(readme.path)

  //Tests
  console.log(`Generating tests/templates/${id}.yml`)
  workflow.push(...examples.map(example => testcase(templates[id].name, "prod", example)).filter(t => t))
  await fs.writeFile(tests.path, yaml.dump(examples.map(example => testcase(templates[id].name, "test", example)).filter(t => t), {quotingType: '"', noCompatMode: true}))
  staged.add(tests.path)
}

//Config and general documentation auto-generation
for (const step of ["config", "documentation"]) {
  switch (step) {
    case "config":
      await update({source: paths.join(__action, "action.yml"), output: "action.yml", context: {runsh: `${await fs.readFile(paths.join(__action, "run.sh"), "utf8")}`}})
      await update({source: paths.join(__web, "settings.example.json"), output: "settings.example.json"})
      break
    case "documentation":
      await update({source: paths.join(__documentation, "README.md"), output: "README.md", options: {root: __readme}})
      await update({source: paths.join(__documentation, "plugins.md"), output: "source/plugins/README.md"})
      await update({source: paths.join(__documentation, "plugins.community.md"), output: "source/plugins/community/README.md"})
      await update({source: paths.join(__documentation, "templates.md"), output: "source/templates/README.md"})
      await update({source: paths.join(__documentation, "compatibility.md"), output: ".github/readme/partials/documentation/compatibility.md"})
      break
  }
}

//Example workflows
await update({source: paths.join(__metrics, ".github/scripts/files/examples.yml"), output: ".github/workflows/examples.yml", context: {steps: yaml.dump(workflow, {quotingType: '"', noCompatMode: true})}})

//Commit and push
if (mode === "publish") {
  console.log(`Pushing staged changes: \n${[...staged].map(file => `  - ${file}`).join("\n")}`)
  const gitted = await git
    .addConfig("user.name", "github-actions[bot]")
    .addConfig("user.email", "41898282+github-actions[bot]@users.noreply.github.com")
    .add([...staged])
    .commit("ci: auto-regenerate files")
    .push("origin", "master")
  console.log(gitted)
}
console.log("Success!")

//==================================================================================

//Update generated files
async function update({source, output, context = {}, options = {}}) {
  console.log(`Generating ${output}`)
  const {plugins, templates, packaged, descriptor} = await metadata({log: false})
  const content = await ejs.renderFile(source, {plugins, templates, packaged, descriptor, ...context}, {async: true, ...options})
  const file = paths.join(__metrics, output)
  await fs.writeFile(file, content.replace(/^[ ]+$/gm, ""))
  staged.add(file)
}

//Get plugin infos
async function plugin(id) {
  const path = paths.join(__plugins, plugins[id].community ? "community" : "", id)
  const readme = paths.join(path, "README.md")
  const examples = paths.join(path, "examples.yml")
  const tests = paths.join(__test_cases, `${id}.plugin.yml`)
  return {
    community: plugins[id].community,
    readme: {
      path: readme,
      content: `${await fs.readFile(readme)}`,
    },
    tests: {
      path: tests,
    },
    examples: fss.existsSync(examples) ? yaml.load(await fs.readFile(examples), "utf8") ?? [] : [],
    options: plugins[id].readme.table,
    header: plugins[id].readme.header,
  }
}

//Get template infos
async function template(id) {
  const path = paths.join(__templates, id)
  const readme = paths.join(path, "README.md")
  const examples = paths.join(path, "examples.yml")
  const tests = paths.join(__test_cases, `${id}.template.yml`)
  return {
    readme: {
      path: readme,
      content: `${await fs.readFile(readme)}`,
    },
    tests: {
      path: tests,
    },
    examples: fss.existsSync(examples) ? yaml.load(await fs.readFile(examples), "utf8") ?? [] : [],
    header: templates[id].readme.header,
  }
}

//Testcase generator
function testcase(name, env, args) {
  const {prod = {}, test = {}, ...step} = JSON.parse(JSON.stringify(args))
  const context = {prod, test}[env] ?? {}
  const {with: overrides} = context
  if (context.skip)
    return null

  Object.assign(step.with, context.with ?? {})
  delete context.with
  const result = {...step, ...context, name: `${name} - ${step.name ?? "(unnamed)"}`}
  for (const [k, v] of Object.entries(result.with)) {
    if ((env === "test") && (secrets.$regex.test(v)))
      result.with[k] = v.replace(secrets.$regex, secrets[v.match(secrets.$regex)?.groups?.secret])
  }

  if (env === "prod") {
    result.if = "${{ success() || failure() }}"
    result.uses = "lowlighter/metrics@master"
    Object.assign(result.with, {output_action: "none", delay: 120})

    for (const {property, value} of [{property: "user", value: "lowlighter"}, {property: "plugins_errors_fatal", value: "yes"}]) {
      if (!(property in result.with))
        result.with[property] = value
    }
    if ((overrides?.output_action) && (overrides?.committer_branch === "examples"))
      Object.assign(result.with, {output_action: overrides.output_action, committer_branch: "examples"})
  }

  if (env === "test") {
    if (!result.with.base)
      delete result.with.base
    delete result.with.filename
    Object.assign(result.with, {use_mocked_data: "yes", verify: "yes"})
  }

  return result
}
</file>

<file path=".github/scripts/preview.mjs">
//Imports
import fs from "fs/promises"
import paths from "path"
import url from "url"
import setup from "../../source/app/metrics/setup.mjs"

//Paths
const __metrics = paths.join(paths.dirname(url.fileURLToPath(import.meta.url)), "../..")
const __templates = paths.join(paths.join(__metrics, "source/templates/"))
const __node_modules = paths.join(paths.join(__metrics, "node_modules"))
const __web = paths.join(paths.join(__metrics, "source/app/web/statics"))

const __preview = paths.join(paths.join(__web, "preview"))
const __preview_js = paths.join(__preview, ".js")
const __preview_css = paths.join(__preview, ".css")
const __preview_templates = paths.join(__preview, ".templates")
const __preview_templates_ = paths.join(__preview, ".templates_")

//Extract from web server
const {conf, Templates} = await setup({log: false})
const templates = Object.entries(Templates).map(([name]) => ({name, enabled: true}))
const metadata = Object.fromEntries(
  Object.entries(conf.metadata.plugins)
    .map(([key, value]) => [key, Object.fromEntries(Object.entries(value).filter(([key]) => ["name", "icon", "category", "web", "supports", "scopes"].includes(key)))])
    .map(([key, value]) => [key, key === "core" ? {...value, web: Object.fromEntries(Object.entries(value.web).filter(([key]) => /^config[.]/.test(key)).map(([key, value]) => [key.replace(/^config[.]/, ""), value]))} : value]),
)
const enabled = Object.entries(metadata).filter(([_name, {category}]) => category !== "core").map(([name]) => ({name, category: metadata[name]?.category ?? "community", enabled: true}))

//Directories
await fs.mkdir(__preview, {recursive: true})
await fs.mkdir(__preview_js, {recursive: true})
await fs.mkdir(__preview_css, {recursive: true})
await fs.mkdir(__preview_templates, {recursive: true})
await fs.mkdir(__preview_templates_, {recursive: true})

//Web
fs.copyFile(paths.join(__web, "index.html"), paths.join(__preview, "index.html"))
fs.copyFile(paths.join(__web, "favicon.png"), paths.join(__preview, ".favicon.png"))
fs.copyFile(paths.join(__web, "opengraph.png"), paths.join(__preview, ".opengraph.png"))
//Plugins and templates
fs.writeFile(paths.join(__preview, ".plugins"), JSON.stringify(enabled))
fs.writeFile(paths.join(__preview, ".plugins.base"), JSON.stringify(conf.settings.plugins.base.parts))
fs.writeFile(paths.join(__preview, ".plugins.metadata"), JSON.stringify(metadata))
fs.writeFile(paths.join(__preview, ".templates__"), JSON.stringify(templates))
for (const template in conf.templates) {
  fs.writeFile(paths.join(__preview_templates_, template), JSON.stringify(conf.templates[template]))
  const __partials = paths.join(__templates, template, "partials")
  const __preview_partials = paths.join(__preview_templates, template, "partials")
  await fs.mkdir(__preview_partials, {recursive: true})
  for (const file of await fs.readdir(__partials))
    fs.copyFile(paths.join(__partials, file), paths.join(__preview_partials, file))
}
//Styles
fs.copyFile(paths.join(__web, "style.css"), paths.join(__preview_css, "style.css"))
fs.copyFile(paths.join(__web, "style.vars.css"), paths.join(__preview_css, "style.vars.css"))
fs.copyFile(paths.join(__node_modules, "prismjs/themes/prism-tomorrow.css"), paths.join(__preview_css, "style.prism.css"))
//Scripts
fs.writeFile(paths.join(__preview_js, "app.js"), `${await fs.readFile(paths.join(__web, "app.js"))}`)
fs.copyFile(paths.join(__node_modules, "ejs/ejs.min.js"), paths.join(__preview_js, "ejs.min.js"))
fs.writeFile(paths.join(__preview_js, "faker.min.js"), "import {faker} from '/.js/faker/index.mjs';globalThis.faker=faker;globalThis.placeholder.init(globalThis)")
for (const path of [[], ["locale"]]) {
  await fs.mkdir(paths.join(__preview_js, "faker", ...path), {recursive: true})
  for (const file of await fs.readdir(paths.join(__node_modules, "@faker-js/faker/dist/esm", ...path))) {
    if (file.endsWith(".mjs"))
      fs.copyFile(paths.join(__node_modules, "@faker-js/faker/dist/esm", ...path, file), paths.join(__preview_js, "faker", ...path, file))
  }
}
fs.copyFile(paths.join(__node_modules, "axios/dist/axios.min.js"), paths.join(__preview_js, "axios.min.js"))
fs.copyFile(paths.join(__node_modules, "axios/dist/axios.min.js.map"), paths.join(__preview_js, "axios.min.js.map"))
fs.copyFile(paths.join(__node_modules, "vue/dist/vue.min.js"), paths.join(__preview_js, "vue.min.js"))
fs.copyFile(paths.join(__node_modules, "vue-prism-component/dist/vue-prism-component.min.js"), paths.join(__preview_js, "vue.prism.min.js"))
fs.copyFile(paths.join(__node_modules, "vue-prism-component/dist/vue-prism-component.min.js.map"), paths.join(__preview_js, "vue-prism-component.min.js.map"))
fs.copyFile(paths.join(__node_modules, "prismjs/prism.js"), paths.join(__preview_js, "prism.min.js"))
fs.copyFile(paths.join(__node_modules, "prismjs/components/prism-yaml.min.js"), paths.join(__preview_js, "prism.yaml.min.js"))
fs.copyFile(paths.join(__node_modules, "prismjs/components/prism-markdown.min.js"), paths.join(__preview_js, "prism.markdown.min.js"))
fs.copyFile(paths.join(__node_modules, "clipboard/dist/clipboard.min.js"), paths.join(__preview_js, "clipboard.min.js"))
//Meta
fs.writeFile(paths.join(__preview, ".modes"), JSON.stringify(["embed", "insights"]))
fs.writeFile(paths.join(__preview, ".version"), JSON.stringify(`${conf.package.version}-preview`))
fs.writeFile(paths.join(__preview, ".hosted"), JSON.stringify({by: "metrics", link: "https://github.com/lowlighter/metrics"}))
//Embed
{
  const __web_embed = paths.join(paths.join(__web, "embed"))
  const __web_embed_placeholders = paths.join(__web_embed, "placeholders")
  const __preview_embed = paths.join(__preview, "embed")
  const __preview_embed_placeholders = paths.join(__preview, ".placeholders")
  const __preview_embed_js = paths.join(__preview_js, "embed")
  await fs.mkdir(__preview_embed, {recursive: true})
  await fs.mkdir(__preview_embed_placeholders, {recursive: true})
  await fs.mkdir(__preview_embed_js, {recursive: true})
  fs.writeFile(paths.join(__preview_embed, "index.html"), `${await fs.readFile(paths.join(__web_embed, "index.html"))}`)
  fs.writeFile(paths.join(__preview_embed_js, "app.js"), `${await fs.readFile(paths.join(__web_embed, "app.js"))}`)
  fs.writeFile(paths.join(__preview_embed_js, "app.placeholder.js"), `${await fs.readFile(paths.join(__web_embed, "app.placeholder.js"))}`)
  for (const file of await fs.readdir(__web_embed_placeholders))
    fs.copyFile(paths.join(__web_embed_placeholders, file), paths.join(__preview_embed_placeholders, file))
}
//Insights
for (const insights of ["insights", "about"]) {
  const __web_insights = paths.join(paths.join(__web, "insights"))
  const __preview_insights = paths.join(__preview, `${insights}/.statics`)
  await fs.mkdir(__preview_insights, {recursive: true})
  fs.copyFile(paths.join(__web_insights, "index.html"), paths.join(__preview, insights, "index.html"))
  for (const file of await fs.readdir(__web_insights)) {
    if (file !== ".statics")
      fs.copyFile(paths.join(__web_insights, file), paths.join(__preview_insights, file))
  }
}
</file>

<file path=".github/scripts/release.mjs">
//Imports
import github from "@actions/github"
import paths from "path"
import sgit from "simple-git"
import url from "url"

//Git setup
const __metrics = paths.join(paths.dirname(url.fileURLToPath(import.meta.url)), "../..")
const git = sgit(__metrics)

//Setup octokit
const token = process.env.GITHUB_TOKEN
const rest = github.getOctokit(token).rest

//Environment
const maintainer = "lowlighter"
const repository = process.env.GITHUB_REPOSITORY.match(/^(?<owner>[\s\S]+)[/](?<name>[\s\S]+)$/)?.groups ?? null
const version = process.env.GITHUB_COMMIT_MESSAGE.match(/(?<version>v\d+[.]\d+)/)?.groups?.version ?? null

//Check arguments
if ((!repository) || (!repository.name) || (!repository.owner))
  throw new Error(`Could not parse repository "${process.env.GITHUB_REPOSITORY}"`)
console.log(`Repository: ${repository.owner}/${repository.name}`)
if (!version)
  throw new Error(`Could not parse version from "${process.env.GITHUB_COMMIT_MESSAGE}"`)
console.log(`Version: ${version}`)

//Load related pr
const {data: {items: prs}} = await rest.search.issuesAndPullRequests({
  q: `repo:${repository.owner}/${repository.name} is:pr is:merged author:${maintainer} assignee:${maintainer} Release ${version} in:title`,
})

//Ensure that there is exactly one pr matching
if (prs.length < 1)
  throw new Error(`No matching prs found`)
if (prs.length > 1)
  throw new Error(`Multiple prs found (${prs.length} matching)`)
const [patchnote] = prs
console.log(`Using pr#${patchnote.number}: ${patchnote.title}`)

//Check whether release already exists
try {
  const {data: {id}} = await rest.repos.getReleaseByTag({owner: repository.owner, repo: repository.name, tag: version})
  console.log(`Release ${version} already exists (#${id}), will replace it`)
  await rest.repos.deleteRelease({owner: repository.owner, repo: repository.name, release_id: id})
  console.log(`Deleting tag ${version}`)
  await git.push(["--delete", "origin", version])
  await new Promise(solve => setTimeout(solve, 15 * 1000))
}
catch {
  console.log(`Release ${version} does not exists yet, will create it`)
}

//Publish release
await rest.repos.createRelease({owner: repository.owner, repo: repository.name, tag_name: version, name: `Version ${version.replace(/^v/g, "")}`, body: patchnote.body})
console.log(`Successfully published`)
</file>

<file path=".github/workflows/branches.yml">
name: Check automated branches

on:
  pull_request_target:
    branches:
      - main
      - latest
      - examples

jobs:
  notice:
    name: Notice for automated branches
    runs-on: ubuntu-latest
    steps:
      - name: Comment on pull request
        uses: actions/github-script@v6
        with:
          script: |
            const {issue:{number:issue_number}, repo:{owner, repo}} = context
            github.rest.issues.createComment({issue_number, owner, repo, body:[
              "Hello there üëã!",
              "",
              "It seems you have opened a pull request on either `main`, `latest` or `examples`.",
              "These branches are fully-automated and do not accept human contributions.",
              "",
              "* To contribute to *metrics* code, open a pull request to `master` branch",
              "* To contribute to *metrics* presets, open a pull request to `presets` branch",
              "",
              "Thanks for your cooperation ü¶æ!"
            ].join("\n")})
      - name: Change base branch
        run: exit 1
</file>

<file path=".github/workflows/clean.yml">
name: Clean untagged docker images

on:
  release:
    types:
      - published
  workflow_dispatch:

jobs:
  clean:
    name: Clean untagged docker images
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Run script
        run: ./delete_ghcr_dangling_images.sh lowlighter metrics
        working-directory: .github/actions/ghcr-clean
        env:
          GITHUB_TOKEN: ${{ secrets.GHCR_BOT_TOKEN }}
</file>

<file path=".github/workflows/label.yml">
name: Label issue and pull requests

on: pull_request_target

jobs:
  label:
    name: Label issue and pull requests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/labeler@v4
        with:
          repo-token: "${{ secrets.GITHUB_TOKEN }}"
          configuration-path: .github/config/label.yml
          sync-labels: yes
</file>

<file path=".github/workflows/spelling.yml">
name: Check Spelling

# Updating pull request branches is managed via comment handling.
# For details, see: https://github.com/check-spelling/check-spelling/wiki/Feature:-Update-expect-list
#
# These elements work together to make it happen:
#
# `on.issue_comment`
#   This event listens to comments by users asking to update the metadata.
#
# `jobs.update`
#   This job runs in response to an issue_comment and will push a new commit
#   to update the spelling metadata.
#
# `with.experimental_apply_changes_via_bot`
#   Tells the action to support and generate messages that enable it
#   to make a commit to update the spelling metadata.
#
# `with.ssh_key`
#   In order to trigger workflows when the commit is made, you can provide a
#   secret (typically, a write-enabled github deploy key).
#
#   For background, see: https://github.com/check-spelling/check-spelling/wiki/Feature:-Update-with-deploy-key

on:
  push:
    branches: ["**"]
    tags-ignore: ["**"]
  pull_request_target:
  issue_comment:
    types: [created]

jobs:
  spelling:
    name: Check Spelling
    permissions:
      contents: read
      pull-requests: read
      actions: read
    outputs:
      followup: ${{ steps.spelling.outputs.followup }}
    runs-on: ubuntu-latest
    if: "contains(github.event_name, 'pull_request') || github.event_name == 'push'"
    concurrency:
      group: spelling-${{ github.event.pull_request.number || github.ref }}
      # note: If you use only_check_changed_files, you do not want cancel-in-progress
      cancel-in-progress: true
    steps:
    - name: check-spelling
      id: spelling
      uses: check-spelling/check-spelling@v0.0.20
      with:
        experimental_apply_changes_via_bot: ${{ github.repository_owner != 'lowlighter' && 1 || 0 }}
        suppress_push_for_open_pull_request: 1
        checkout: true
        post_comment: 0
        extra_dictionaries:
          cspell:html/html.txt
          cspell:filetypes/filetypes.txt
          cspell:css/css.txt
          cspell:fullstack/fullstack.txt
          cspell:django/django.txt
          cspell:npm/npm.txt
          cspell:aws/aws.txt
        check_extra_dictionaries: ''

  comment:
    name: Report
    runs-on: ubuntu-latest
    needs: spelling
    permissions:
      contents: write
      pull-requests: write
    if: (success() || failure()) && needs.spelling.outputs.followup
    steps:
    - name: comment
      uses: check-spelling/check-spelling@v0.0.20
      with:
        checkout: true
        task: ${{ needs.spelling.outputs.followup }}
        experimental_apply_changes_via_bot: ${{ github.repository_owner != 'lowlighter' && 1 || 0 }}

  update:
    name: Update PR
    permissions:
      contents: write
      pull-requests: write
    runs-on: ubuntu-latest
    if: ${{
        github.repository_owner != 'lowlighter' &&
        github.event_name == 'issue_comment' &&
        github.event.issue.pull_request &&
        contains(github.event.comment.body, '@check-spelling-bot apply')
      }}
    concurrency:
      group: spelling-update-${{ github.event.issue.number }}
      cancel-in-progress: false
    steps:
    - name: apply spelling updates
      uses: check-spelling/check-spelling@v0.0.20
      with:
        experimental_apply_changes_via_bot: ${{ github.repository_owner != 'lowlighter' && 1 || 0 }}
        checkout: true
        ssh_key: "${{ secrets.CHECK_SPELLING }}"
</file>

<file path=".github/FUNDING.yml">
# These are supported funding model platforms
github: lowlighter
</file>

<file path=".github/pull_request_template.md">
<!--

  üëã Hi there!
  Thanks for contributing to metrics and helping us to improve!

  Please:
    - Read CONTRIBUTING.md first
    - Check you're not duplicating another existing pull request
    - Provide a clear and concise description

  Note that:
    - Your code will be automatically formatted by github-actions
    - Head branches are automatically deleted when merged

-->
</file>

<file path="source/app/action/action.yml">
# ====================================================================================
# Inputs and configuration

inputs:
<% for (const [plugin, {name, action}] of Object.entries(plugins)) { %>
  # ====================================================================================
  # <%- name %>
  <% for (const [input, {descriptor}] of Object.entries(action)) { %>
  <%- descriptor.split("\n").map((line, i) => `${i ? "  " : ""}${line}`).join("\n") -%>
<% }} %>

# ====================================================================================
# Action metadata
name: Metrics embed
author: lowlighter
description: An infographics generator with 40+ plugins and 300+ options to display stats about your GitHub account!
branding:
  icon: user-check
  color: gray-dark

# The action will parse its name to check if it's the official action or if it's a forked one
# On the official action, it'll use the docker image published on GitHub registry when using a released version, allowing faster runs
# On a forked action, it'll rebuild the docker image from Dockerfile to take into account changes you made
runs:
  using: composite
  steps:
    - run: |
        <%- runsh.split("\n").map((line, i) => `${i ? "        " : ""}${line}`).join("\n") %>
      shell: bash
      env:
        METRICS_ACTION: ${{ github.action }}
        METRICS_ACTION_PATH: ${{ github.action_path }}
        METRICS_USE_PREBUILT_IMAGE: ${{ inputs.use_prebuilt_image }}
        INPUTS: ${{ toJson(inputs) }}
        TZ: ${{ inputs.config_timezone }}
</file>

<file path="source/app/action/index.mjs">
//Imports
import core from "@actions/core"
import github from "@actions/github"
import octokit from "@octokit/graphql"
import processes from "child_process"
import fs from "fs/promises"
import paths from "path"
import sgit from "simple-git"
import util from "util"
import mocks from "../../../tests/mocks/index.mjs"
import metrics from "../metrics/index.mjs"
import presets from "../metrics/presets.mjs"
import setup from "../metrics/setup.mjs"
process.on("unhandledRejection", error => {
  throw error
})

//Debug message buffer
let DEBUG = true
const debugged = []

//Preset
const preset = {}

//Info logger
const info = (left, right, {token = false} = {}) =>
  console.log(`${`${left}`.padEnd(63 + 9 * (/0m$/.test(left)))} ‚îÇ ${
    Array.isArray(right)
      ? right.join(", ") || "(none)"
      : right === undefined
      ? "(default)"
      : token
      ? /^MOCKED/.test(right) ? "(MOCKED TOKEN)" : /^NOT_NEEDED$/.test(right) ? "(NOT NEEDED)" : (right ? "(provided)" : "(missing)")
      : typeof right === "object"
      ? JSON.stringify(right)
      : right
  }`)
info.section = (left = "", right = " ") => info(`\x1b[36m${left}\x1b[0m`, right)
info.group = ({metadata, name, inputs}) => {
  info.section(metadata.plugins[name]?.name?.match(/(?<section>[\w\s]+)/i)?.groups?.section?.trim(), " ")
  for (const [input, value] of Object.entries(inputs))
    info(metadata.plugins[name]?.inputs[input]?.description?.split("\n")[0] ?? metadata.plugins[name]?.inputs[input]?.description ?? input, `${input in preset ? "*" : ""}${value}`, {token: metadata.plugins[name]?.inputs[input]?.type === "token"})
}
info.break = () => console.log("‚îÄ".repeat(88))

//Waiter
async function wait(seconds) {
  await new Promise(solve => setTimeout(solve, seconds * 1000))
}

//Retry wrapper
async function retry(func, {retries = 1, delay = 0} = {}) {
  let error = null
  for (let attempt = 1; attempt <= retries; attempt++) {
    try {
      console.debug(`::group::Attempt ${attempt}/${retries}`)
      const result = await func()
      console.debug("::endgroup::")
      return result
    }
    catch (_error) {
      error = _error
      console.debug("::endgroup::")
      console.debug(`::warning::${error.message}`)
      await wait(delay)
    }
  }
  if (error)
    throw error
  return null
}

//Process exit
function quit(reason) {
  const code = {success: 0, skipped: 0, failed: 1}[reason] ?? 0
  process.exit(code)
} //=====================================================================================================
//Runner

;(async function() {
  try {
    //Initialization
    info.break()
    info.section("Metrics")

    //Skip process if needed
    if ((github.context.eventName === "push") && (github.context.payload?.head_commit)) {
      if (/\[Skip GitHub Action\]/.test(github.context.payload.head_commit.message)) {
        console.log("Skipped because [Skip GitHub Action] is in commit message")
        quit("skipped")
      }
      if (/Auto-generated metrics for run #\d+/.test(github.context.payload.head_commit.message)) {
        console.log("Skipped because this seems to be an automated pull request merge")
        quit("skipped")
      }
    }

    //Load configuration
    const {conf, Plugins, Templates} = await setup({log: false, community: {templates: core.getInput("setup_community_templates")}, extras: true})
    const {metadata} = conf
    conf.settings.extras = {default: true}
    info("Setup", "complete")
    info("Version", conf.package.version)

    //Docker run environment default values
    if (!metadata.env.ghactions) {
      info("Docker environment", "(enabled)")
      process.env.INPUT_OUTPUT_ACTION = process.env.INPUT_OUTPUT_ACTION ?? "none"
      process.env.INPUT_COMMITTER_TOKEN = process.env.INPUT_COMMITTER_TOKEN ?? process.env.INPUT_TOKEN
      process.env.GITHUB_REPOSITORY = process.env.GITHUB_REPOSITORY ?? "octocat/hello-world"
    }

    //Core inputs
    Object.assign(preset, await presets(core.getInput("config_presets"), {log: false, core}))
    const {
      user: _user,
      repo: _repo,
      token,
      template,
      query,
      "setup.community.templates": _templates,
      filename: _filename,
      optimize,
      verify,
      "markdown.cache": _markdown_cache,
      debug,
      "debug.flags": dflags,
      "debug.print": dprint,
      "use.mocked.data": mocked,
      dryrun,
      "plugins.errors.fatal": die,
      "committer.token": _token,
      "committer.branch": _branch,
      "committer.message": _message,
      "committer.gist": _gist,
      "use.prebuilt.image": _image,
      retries,
      "retries.delay": retries_delay,
      "retries.output.action": retries_output_action,
      "retries.delay.output.action": retries_delay_output_action,
      "output.action": _action,
      "output.condition": _output_condition,
      delay,
      "quota.required.rest": _quota_required_rest,
      "quota.required.graphql": _quota_required_graphql,
      "quota.required.search": _quota_required_search,
      "notice.release": _notice_releases,
      "clean.workflows": _clean_workflows,
      "github.api.rest": _github_api_rest,
      "github.api.graphql": _github_api_graphql,
      ...config
    } = metadata.plugins.core.inputs.action({core, preset})
    const q = {...query, ...(_repo ? {repo: _repo} : null), template}
    const _output = ["svg", "jpeg", "png", "json", "markdown", "markdown-pdf", "insights"].includes(config["config.output"]) ? config["config.output"] : metadata.templates[template]?.formats?.[0] ?? null
    const filename = _filename.replace(/[*]/g, {jpeg: "jpg", markdown: "md", "markdown-pdf": "pdf", insights: "html"}[_output] ?? _output ?? "*")

    //Docker image
    if (_image)
      info("Using prebuilt image", _image)

    //Debug mode and flags
    info("Debug mode", debug)
    if (!debug) {
      console.debug = message => debugged.push(message)
      DEBUG = false
    }
    info("Debug flags", dflags)
    q["debug.flags"] = dflags.join(" ")

    //Token for data gathering
    info("GitHub token", token, {token: true})
    //A GitHub token should start with "gh" along an additional letter for type
    //See https://github.blog/2021-04-05-behind-githubs-new-authentication-token-formats
    info("GitHub token format", /^github_pat_/.test(token) ? "fine-grained" : /^gh[pousr]_/.test(token) ? "classic" : "legacy or invalid")
    if (!token)
      throw new Error("You must provide a valid GitHub personal token to gather your metrics (see https://github.com/lowlighter/metrics/blob/master/.github/readme/partials/documentation/setup/action.md for more informations)")
    if (/^github_pat_/.test(token))
      throw new Error("It seems you're trying to use a fine-grained personal access token. These are currently unsupported as GitHub does not support them (yet?) for GraphQL API authentication (see https://docs.github.com/fr/graphql/guides/forming-calls-with-graphql#authenticating-with-graphql for more informations). Use a classic token instead.")
    conf.settings.token = token
    const api = {}
    const resources = {}
    api.graphql = octokit.graphql.defaults({headers: {authorization: `token ${token}`}, baseUrl: _github_api_graphql || undefined})
    info("GitHub GraphQL API", "ok")
    info("GitHub GraphQL API endpoint", api.graphql.baseUrl)
    const octoraw = github.getOctokit(token, {baseUrl: _github_api_rest || undefined})
    api.rest = octoraw.rest
    api.rest.request = octoraw.request
    info("GitHub REST API", "ok")
    info("GitHub REST API endpoint", api.rest.baseUrl)
    //Apply mocking if needed
    if (mocked) {
      Object.assign(api, await mocks(api))
      info("Use mocked API", true)
    }
    //Test token validity and requests count
    else if (!/^NOT_NEEDED$/.test(token)) {
      //Check rate limit
      let ratelimit = false
      const {data} = await api.rest.rateLimit.get().catch(() => ({data: {resources: {}}}))
      Object.assign(resources, data.resources)
      for (const type of ["core", "graphql", "search"]) {
        const name = {core: "REST", graphql: "GraphQL", search: "Search"}[type]
        const quota = {core: _quota_required_rest, graphql: _quota_required_graphql, search: _quota_required_search}[type] ?? 1
        info(`API requests (${name})`, resources[type] ? `${resources[type].remaining}/${resources[type].limit}${quota ? ` (${quota}+ required)` : ""}` : "(unknown)")
        if ((resources[type]) && (resources[type].remaining < quota))
          ratelimit = true
      }
      if (ratelimit) {
        console.warn("::warning::It seems you have reached your API requests limit or configured quota. Please retry later.")
        info.break()
        console.log("Nothing can be done currently, thanks for using metrics!")
        quit("skipped")
      }
      //Check scopes
      try {
        const {headers} = await api.rest.request("HEAD /")
        if (!("x-oauth-scopes" in headers)) {
          throw new Error(
            'GitHub API did not send any "x-oauth-scopes" header back from provided "token". It means that your token may not be valid or you\'re using GITHUB_TOKEN which cannot be used since metrics will fetch data outside of this repository scope. Use a personal access token instead (see https://github.com/lowlighter/metrics/blob/master/.github/readme/partials/documentation/setup/action.md for more informations).',
          )
        }
        info("Token validity", "seems ok")
      }
      catch {
        info("Token validity", "(could not verify)")
      }
    }
    //Extract octokits
    const {graphql, rest} = api

    //Check for new versions
    if (_notice_releases) {
      const {data: [{tag_name: tag}]} = await rest.repos.listReleases({owner: "lowlighter", repo: "metrics"})
      const current = Number(conf.package.version.match(/(\d+\.\d+)/)?.[1] ?? 0)
      const latest = Number(tag.match(/(\d+\.\d+)/)?.[1] ?? 0)
      if (latest > current)
        console.info(`::notice::A new version of metrics (v${latest}) has been released, check it out for even more features!`)
    }

    //GitHub user
    let authenticated
    try {
      authenticated = (await rest.users.getAuthenticated()).data.login
    }
    catch {
      authenticated = github.context.repo.owner
    }
    conf.authenticated = authenticated
    const user = _user || authenticated
    info("GitHub account", user)
    if (q.repo)
      info("GitHub repository", `${user}/${q.repo}`)

    //Current repository
    if (metadata.env.ghactions)
      info("Current repository", `${github.context.repo.owner}/${github.context.repo.repo}`)

    //Committer
    const committer = {}
    if ((!dryrun) && (_action !== "none")) {
      //Compute committer informations
      committer.token = _token || token
      committer.gist = _action === "gist" ? _gist : null
      committer.commit = true
      committer.message = _message.replace(/[$][{]filename[}]/g, filename)
      committer.pr = /^pull-request/.test(_action)
      committer.merge = _action.match(/^pull-request-(?<method>merge|squash|rebase)$/)?.groups?.method ?? null
      committer.branch = _branch || github.context.ref.replace(/^refs[/]heads[/]/, "")
      committer.head = committer.pr ? `metrics-run-${github.context.runId}` : committer.branch
      info("Committer token", committer.token, {token: true})
      if (!committer.token)
        throw new Error("You must provide a valid GitHub token to commit your metrics")
      info("Committer branch", committer.branch)
      info("Committer head branch", committer.head)
      //Gist
      if (committer.gist)
        info("Committer Gist id", committer.gist)
      //Instantiate API for committer
      committer.rest = github.getOctokit(committer.token).rest
      info("Committer REST API", "ok")
      try {
        info("Committer account", (await committer.rest.users.getAuthenticated()).data.login)
      }
      catch {
        info("Committer account", "(github-actions)")
      }
      //Create head branch if needed
      try {
        await committer.rest.git.getRef({...github.context.repo, ref: `heads/${committer.head}`})
        info("Committer head branch status", "ok")
      }
      catch (error) {
        console.debug(error)
        if (/not found/i.test(`${error}`)) {
          const {data: {object: {sha}}} = await committer.rest.git.getRef({...github.context.repo, ref: `heads/${committer.branch}`})
          info("Committer branch current sha", sha)
          await committer.rest.git.createRef({...github.context.repo, ref: `refs/heads/${committer.head}`, sha})
          info("Committer head branch status", "(created)")
        }
        else {
          throw error
        }
      }
      //Retrieve previous render SHA to be able to update file content through API
      committer.sha = null
      try {
        const {repository: {object: {oid}}} = await graphql(
          `
            query Sha {
              repository(owner: "${github.context.repo.owner}", name: "${github.context.repo.repo}") {
                object(expression: "${committer.head}:${filename}") { ... on Blob { oid } }
              }
            }
          `,
          {headers: {authorization: `token ${committer.token}`}},
        )
        committer.sha = oid
      }
      catch (error) {
        console.debug(error)
      }
      info("Previous render sha", committer.sha ?? "(none)")
      //Compatibility check
      if ((_action === "gist") && (["png", "jpeg", "markdown-pdf"].includes(_output)))
        throw new Error(`"config_output: ${_output}" is not supported with "config_action: ${_action}"`)
    }
    else if (dryrun) {
      info("Dry-run", true)
    }

    //SVG file
    conf.settings.optimize = optimize
    info("SVG output", filename)
    info("SVG optimization", optimize)
    info("SVG verification after generation", verify)

    //Template
    info.break()
    info.section("Templates")
    info("Community templates", _templates)
    info("Template used", template)
    info("Query additional params", query)

    //Core config
    info.break()
    info.group({metadata, name: "core", inputs: config})
    info("Plugin errors", die ? "(exit with error)" : "(displayed in generated image)")
    const convert = _output || null
    Object.assign(q, config)
    if (/markdown/.test(convert))
      info("Markdown cache", _markdown_cache)
    if (/insights/.test(convert)) {
      try {
        await new Promise(async (solve, reject) => {
          let stdout = ""
          setTimeout(() => reject("Timeout while waiting for Insights webserver"), 5 * 60 * 1000)
          const web = await processes.spawn("node", ["/metrics/source/app/web/index.mjs"], {env: {...process.env}})
          web.stdout.on("data", data => (console.debug(`web > ${data}`), stdout += data, /Server ready !/.test(stdout) ? solve() : null))
          web.stderr.on("data", data => console.debug(`web > ${data}`))
        })
        info("Insights webserver", "ok")
      }
      catch (error) {
        info("Insights webserver", "(failed to initialize)")
        throw error
      }
    }

    //Base content
    info.break()
    const {base: parts, repositories: _repositories, indepth: _base_indepth, ...base} = metadata.plugins.base.inputs.action({core, preset})
    conf.settings.repositories = _repositories
    info.group({metadata, name: "base", inputs: {repositories: conf.settings.repositories, indepth: _base_indepth, ...base}})
    info("Base sections", parts)
    base.base = false
    for (const part of conf.settings.plugins.base.parts)
      base[`base.${part}`] = parts.includes(part)
    base["base.indepth"] = _base_indepth
    Object.assign(q, base)

    //Additional plugins
    const plugins = {}
    for (const name of Object.keys(Plugins).filter(key => !["base", "core"].includes(key))) {
      //Parse inputs
      const {[name]: enabled, ...inputs} = metadata.plugins[name].inputs.action({core, preset})
      plugins[name] = {enabled}
      //Register user inputs
      if (enabled) {
        info.break()
        info.group({metadata, name, inputs})
        q[name] = true
        for (const [key, value] of Object.entries(inputs)) {
          //Store token in plugin configuration
          if (metadata.plugins[name].inputs[key].type === "token")
            plugins[name][key] = value
          //Store value in query
          else
            q[`${name}.${key}`] = value
        }
      }
    }

    //Render metrics
    info.break()
    info.section("Rendering")
    let {rendered, mime} = await retry(async () => {
      const {rendered, mime, errors} = await metrics({login: user, q}, {graphql, rest, plugins, conf, die, verify, convert}, {Plugins, Templates})
      if (errors.length) {
        console.warn(`::group::${errors.length} error(s) occurred`)
        console.warn(util.inspect(errors, {depth: Infinity, maxStringLength: 256}))
        console.warn("::endgroup::")
      }
      return {rendered, mime}
    }, {retries, delay: retries_delay})
    if (!rendered)
      throw new Error("Could not render metrics")
    info("Status", "complete")
    info("MIME type", mime)
    const buffer = {
      _content: null,
      get content() {
        return this._content
      },
      set content(value) {
        this._content = Buffer.isBuffer(value) ? value : Buffer.from(typeof value === "object" ? JSON.stringify(value) : `${value}`)
      },
    }
    buffer.content = rendered

    //Debug print
    if (dprint) {
      info.break()
      info.section("Debug print")
      console.log(rendered)
    }

    //Output condition
    info.break()
    info.section("Saving")
    if (_output === "svg") {
      info("Output condition", _output_condition)
      if ((_output_condition === "data-changed") && ((committer.commit) || (committer.pr))) {
        const {svg} = await import("../metrics/utils.mjs")
        let data = ""
        await retry(async () => {
          try {
            data = `${Buffer.from((await committer.rest.repos.getContent({...github.context.repo, ref: `heads/${committer.head}`, path: filename})).data.content, "base64")}`
          }
          catch (error) {
            if (error.response.status !== 404)
              throw error
          }
        }, {retries: retries_output_action, delay: retries_delay_output_action})
        const previous = await svg.hash(data)
        info("Previous hash", previous)
        const current = await svg.hash(rendered)
        info("Current hash", current)
        const changed = previous !== current
        info("Content changed", changed)
        if (!changed)
          committer.commit = false
      }
    }
    else {
      info("Output condition", `Not applicable for ${_output}`)
    }

    //Save output to renders output folder
    if (dryrun)
      info("Actions to perform", "(none)")
    else {
      await fs.mkdir(paths.dirname(paths.join("/renders", filename)), {recursive: true})
      await fs.writeFile(paths.join("/renders", filename), buffer.content)
      info(`Save to /metrics_renders/${filename}`, "ok")
      info("Output action", _action)
    }

    //No output action apart from file on runner
    if (_action === "none") {
      info.break()
      console.log("Success, thanks for using metrics!")
    }
    //Perform output action
    else {
      //Cache embed svg for markdown outputs
      if (/markdown/.test(convert)) {
        const regex = /(?<match><img class="metrics-cacheable" data-name="(?<name>[\s\S]+?)" src="data:image[/](?<format>(?:svg[+]xml)|jpeg|png);base64,(?<content>[/+=\w]+?)">)/
        let matched = null
        while (matched = regex.exec(rendered)?.groups) { //eslint-disable-line no-cond-assign
          await retry(async () => {
            const {match, name, format, content} = matched
            let path = `${_markdown_cache}/${name}.${format.replace(/[+].*$/g, "")}`
            console.debug(`Processing ${path}`)
            let sha = null
            try {
              const {repository: {object: {oid}}} = await graphql(
                `
                  query Sha {
                    repository(owner: "${github.context.repo.owner}", name: "${github.context.repo.repo}") {
                      object(expression: "${committer.head}:${path}") { ... on Blob { oid } }
                    }
                  }
                `,
                {headers: {authorization: `token ${committer.token}`}},
              )
              sha = oid
            }
            catch (error) {
              console.debug(error)
            }
            finally {
              await committer.rest.repos.createOrUpdateFileContents({
                ...github.context.repo,
                path,
                content,
                message: `${committer.message} (cache)`,
                ...(sha ? {sha} : {}),
                branch: committer.pr ? committer.head : committer.branch,
              })
              rendered = rendered.replace(match, `<img src="https://github.com/${github.context.repo.owner}/${github.context.repo.repo}/blob/${committer.branch}/${path}">`)
              info(`Saving ${path}`, "ok")
            }
          }, {retries: retries_output_action, delay: retries_delay_output_action})
        }
        buffer.content = rendered
        await fs.writeFile(paths.join("/renders", filename), buffer.content)
        info(`Update /metrics_renders/${filename}`, "ok")
      }

      //Check changes
      if ((committer.commit) || (committer.pr)) {
        const git = sgit()
        const sha = await git.hashObject(paths.join("/renders", filename))
        info("Current render sha", sha)
        if (committer.sha === sha) {
          info(`Commit to branch ${committer.branch}`, "(no changes)")
          committer.commit = false
        }
      }

      //Upload to gist (this is done as user since committer_token may not have gist rights)
      if (committer.gist) {
        await retry(async () => {
          await rest.gists.update({gist_id: committer.gist, files: {[filename]: {content: buffer.content.toString()}}})
          info(`Upload to gist ${committer.gist}`, "ok")
          committer.commit = false
        }, {retries: retries_output_action, delay: retries_delay_output_action})
      }

      //Commit metrics
      if (committer.commit) {
        await retry(async () => {
          await committer.rest.repos.createOrUpdateFileContents({
            ...github.context.repo,
            path: filename,
            message: committer.message,
            content: buffer.content.toString("base64"),
            branch: committer.pr ? committer.head : committer.branch,
            ...(committer.sha ? {sha: committer.sha} : {}),
          })
          info(`Commit to branch ${committer.branch}`, "ok")
        }, {retries: retries_output_action, delay: retries_delay_output_action})
      }

      //Pull request
      if (committer.pr) {
        //Create pull request
        let number = null
        await retry(async () => {
          try {
            ;({data: {number}} = await committer.rest.pulls.create({...github.context.repo, head: committer.head, base: committer.branch, title: `Auto-generated metrics for run #${github.context.runId}`, body: " ", maintainer_can_modify: true}))
            info(`Pull request from ${committer.head} to ${committer.branch}`, "(created)")
          }
          catch (error) {
            console.debug(error)
            //Check if pull request has already been created previously
            if (/A pull request already exists/.test(error)) {
              info(`Pull request from ${committer.head} to ${committer.branch}`, "(already existing)")
              const q = `repo:${github.context.repo.owner}/${github.context.repo.repo}+type:pr+state:open+Auto-generated metrics for run #${github.context.runId}+in:title`
              const prs = (await committer.rest.search.issuesAndPullRequests({q})).data.items.filter(({user: {login}}) => login === "github-actions[bot]")
              if (prs.length < 1)
                throw new Error("0 matching prs. Cannot proceed.")
              if (prs.length > 1)
                throw new Error(`Found more than one matching prs: ${prs.map(({number}) => `#${number}`).join(", ")}. Cannot proceed.`)
              ;({number} = prs.shift())
            }
            //Check if pull request could not been created because there are no diff between head and base
            else if (/No commits between/.test(error)) {
              info(`Pull request from ${committer.head} to ${committer.branch}`, "(no diff)")
              committer.merge = false
              number = "(none)"
            }
            else {
              throw error
            }
          }
          info("Pull request number", number)
        }, {retries: retries_output_action, delay: retries_delay_output_action})
        //Merge pull request
        if (committer.merge) {
          info("Merge method", committer.merge)
          let attempts = 240
          do {
            const success = await retry(async () => {
              //Check pull request mergeability (https://octokit.github.io/rest.js/v18#pulls-get)
              const {data: {mergeable, mergeable_state: state}} = await committer.rest.pulls.get({...github.context.repo, pull_number: number})
              console.debug(`Pull request #${number} mergeable state is "${state}"`)
              if (mergeable === null) {
                await wait(15)
                return false
              }
              if (!mergeable)
                throw new Error(`Pull request #${number} is not mergeable (state is "${state}")`)
              //Merge pull request
              await committer.rest.pulls.merge({...github.context.repo, pull_number: number, merge_method: committer.merge})
              info(`Merge #${number} to ${committer.branch}`, "ok")
              return true
            }, {retries: retries_output_action, delay: retries_delay_output_action})
            if (!success)
              continue
            //Delete head branch
            await retry(async () => {
              try {
                await wait(15)
                await committer.rest.git.deleteRef({...github.context.repo, ref: `heads/${committer.head}`})
              }
              catch (error) {
                console.debug(error)
                if (!/reference does not exist/i.test(`${error}`))
                  throw error
              }
              info(`Branch ${committer.head}`, "(deleted)")
            }, {retries: retries_output_action, delay: retries_delay_output_action})
            break
          }
          while (--attempts)
        }
      }

      //Clean workflows
      if (_clean_workflows.length) {
        try {
          //Get workflow metadata
          const run_id = github.context.runId
          const {data: {workflow_id}} = await rest.actions.getWorkflowRun({...github.context.repo, run_id})
          const {data: {path}} = await rest.actions.getWorkflow({...github.context.repo, workflow_id})
          const workflow = paths.basename(path)
          info.break()
          info.section("Cleaning workflows")
          info("Current workflow run id", run_id)
          info("Current workflow file", workflow)

          //Fetch workflows runs to clean
          info("States to clean", _clean_workflows)
          const runs = []
          let pages = 1
          for (let page = 1; page <= pages; page++) {
            try {
              console.debug(`Fetching page ${page}/${pages} of workflow ${workflow}`)
              const {data: {workflow_runs, total_count}} = await rest.actions.listWorkflowRuns({...github.context.repo, workflow_id: workflow, branch: committer.branch, status: "completed", page})
              pages = total_count / 100
              runs.push(...workflow_runs.filter(({conclusion}) => (_clean_workflows.includes("all")) || (_clean_workflows.includes(conclusion))).map(({id}) => ({id})))
            }
            catch (error) {
              console.debug(error)
              break
            }
          }
          info("Runs to clean", runs.length)

          //Clean workflow runs
          let cleaned = 0
          for (const {id} of runs) {
            try {
              await rest.actions.deleteWorkflowRun({...github.context.repo, run_id: id})
              cleaned++
            }
            catch (error) {
              console.debug(error)
              continue
            }
          }
          info("Runs cleaned", cleaned)
        }
        catch (error) {
          if (error.response.status === 404)
            console.log('::warning::Workflow data could not be fetched. If this is a private repository, you may need to grant full "repo" scope.')
          console.debug(error)
        }
      }
    }

    //Consumed API requests
    if ((!mocked) && (!/^NOT_NEEDED$/.test(token))) {
      info.break()
      info.section("Consumed API requests")
      info("  * provided that no other app used your quota during execution", "")
      const {data: current} = await rest.rateLimit.get().catch(() => ({data: {resources: {}}}))
      for (const type of ["core", "graphql", "search"]) {
        const used = resources[type].remaining - current.resources[type].remaining
        info({core: "REST API", graphql: "GraphQL API", search: "Search API"}[type], (Number.isFinite(used) && (used >= 0)) ? used : "(unknown)")
      }
    }

    //Delay
    if (delay) {
      info.break()
      info("Delay before ending job", `${delay}s`)
      await new Promise(solve => setTimeout(solve, delay * 1000))
    }

    //Success
    info.break()
    console.log("Success, thanks for using metrics!")
    quit("success")
  }
  //Errors
  catch (error) {
    console.error(error)
    //Print debug buffer if debug was not enabled (if it is, it's already logged on the fly)
    if (!DEBUG) {
      for (const log of [info.break(), "An error occurred, logging debug message :", ...debugged])
        console.log(log)
    }
    core.setFailed(error.message)
    quit("failed")
  }
})()
</file>

<file path="source/app/action/run.sh">
# Check runner compatibility
echo "::group::Metrics docker image setup"
echo "GitHub action: $METRICS_ACTION ($METRICS_ACTION_PATH)"
cd $METRICS_ACTION_PATH
for DEPENDENCY in docker jq; do
  if ! which $DEPENDENCY > /dev/null 2>&1; then
    echo "::error::\"$DEPENDENCY\" is not installed on current runner but is needed to run metrics"
    MISSING_DEPENDENCIES=1
  fi
done
if [[ $MISSING_DEPENDENCIES == "1" ]]; then
  echo "Runner compatibility: missing dependencies"
  exit 1
else
  echo "Runner compatibility: compatible"
fi

# Create environment file from inputs and GitHub variables
touch .env
for INPUT in $(echo $INPUTS | jq -r 'to_entries|map("INPUT_\(.key|ascii_upcase)=\(.value|@uri)")|.[]'); do
  echo $INPUT >> .env
done
env | grep -E '^(GITHUB|ACTIONS|CI|TZ)' >> .env
echo "Environment variables: loaded"

# Renders output folder
METRICS_RENDERS="/metrics_renders"
sudo mkdir -p $METRICS_RENDERS
echo "Renders output folder: $METRICS_RENDERS"

# Source repository (picked from action name)
METRICS_SOURCE=$(echo $METRICS_ACTION | sed -E 's/metrics.*?$//g' | sed -E 's/_//g')
echo "Source: $METRICS_SOURCE"

# Version (picked from package.json)
METRICS_VERSION=$(grep -Po '(?<="version": ").*(?=")' package.json)
echo "Version: $METRICS_VERSION"

# Image tag (extracted from version or from env)
METRICS_TAG=v$(echo $METRICS_VERSION | sed -r 's/^([0-9]+[.][0-9]+).*/\1/')
echo "Image tag: $METRICS_TAG"

# Image name
# Official action
if [[ $METRICS_SOURCE == "lowlighter" ]]; then
  # Use registry with pre-built images
  if [[ ! $METRICS_USE_PREBUILT_IMAGE =~ ^([Ff]alse|[Oo]ff|[Nn]o|0)$ ]]; then
    # Is released version
    set +e
    METRICS_IS_RELEASED=$(expr $(expr match $METRICS_VERSION .*-beta) == 0)
    set -e
    echo "Is released version: $METRICS_IS_RELEASED"
    if [[ "$METRICS_IS_RELEASED" -eq "0" ]]; then
      METRICS_TAG="$METRICS_TAG-beta"
      echo "Image tag (updated): $METRICS_TAG"
    fi
    METRICS_IMAGE=ghcr.io/lowlighter/metrics:$METRICS_TAG
    echo "Using pre-built version $METRICS_TAG, will pull docker image from GitHub registry"
    if ! docker image pull $METRICS_IMAGE; then
      echo "Failed to fetch docker image from GitHub registry, will rebuild it locally"
      METRICS_IMAGE=metrics:$METRICS_VERSION
    fi
  # Rebuild image
  else
    echo "Using an unreleased version ($METRICS_VERSION)"
    METRICS_IMAGE=metrics:$METRICS_VERSION
  fi
# Forked action
else
  echo "Using a forked version"
  METRICS_IMAGE=metrics:forked-$METRICS_VERSION
fi
echo "Image name: $METRICS_IMAGE"

# Build image if necessary
set +e
docker image inspect $METRICS_IMAGE
METRICS_IMAGE_NEEDS_BUILD="$?"
set -e
if [[ "$METRICS_IMAGE_NEEDS_BUILD" -gt "0" ]]; then
  echo "Image $METRICS_IMAGE is not present locally, rebuilding it from Dockerfile"
  docker build -t $METRICS_IMAGE .
else
  echo "Image $METRICS_IMAGE is present locally"
fi
echo "::endgroup::"

# Run docker image with current environment
docker run --init --rm --volume $GITHUB_EVENT_PATH:$GITHUB_EVENT_PATH --volume $METRICS_RENDERS:/renders --env-file .env $METRICS_IMAGE
rm .env
</file>

<file path="source/app/metrics/index.mjs">
//Imports
import ejs from "ejs"
import util from "util"
import * as utils from "./utils.mjs"

//Setup
export default async function metrics({login, q}, {graphql, rest, plugins, conf, die = false, verify = false, convert = null, callbacks = null, warnings = []}, {Plugins, Templates}) {
  //Compute rendering
  try {
    //Debug
    login = login.replace(/[\n\r]/g, "")
    console.debug(`metrics/compute/${login} > start`)
    console.debug(util.inspect(q, {depth: Infinity, maxStringLength: 256}))

    //Load template
    const template = q.template || conf.settings.templates.default
    if ((!(template in Templates)) || (!(template in conf.templates)) || ((conf.settings.templates.enabled.length) && (!conf.settings.templates.enabled.includes(template))))
      throw new Error("unsupported template")
    const {image, style, fonts, views, partials} = conf.templates[template]
    const computer = Templates[template].default || Templates[template]
    convert = convert ?? conf.metadata.templates[template]?.formats?.[0] ?? null
    console.debug(`metrics/compute/${login} > output format set to ${convert}`)

    //Initialization
    const pending = []
    const {queries} = conf
    const imports = {
      plugins: Plugins,
      templates: Templates,
      metadata: conf.metadata,
      ...utils,
      ...utils.formatters({timeZone: q["config.timezone"]}),
      ...(/markdown/.test(convert)
        ? {
          imgb64(url, options) {
            return options?.force ? utils.imgb64(...arguments) : url
          },
        }
        : null),
    }
    const {"debug.flags": dflags, "experimental.features": _experimental, "config.order": _partials} = imports.metadata.plugins.core.inputs({account: "bypass", q})
    const extras = {css: imports.metadata.plugins.core.extras("extras_css", {...conf.settings, error: false}) ? q["extras.css"] ?? "" : "", js: imports.metadata.plugins.core.extras("extras_js", {...conf.settings, error: false}) ? q["extras.js"] ?? "" : ""}
    const data = {q, animated: true, large: false, base: {}, config: {}, errors: [], warnings, plugins: {}, computed: {}, extras, postscripts: []}
    const experimental = new Set(_experimental)
    if (conf.settings["debug.headless"]) {
      imports.puppeteer.headless = false
      console.debug(`metrics/compute/${login} > disabled puppeteer headless mode`)
    }
    if ((conf.settings.debug) || (process.env.GITHUB_ACTIONS)) {
      if (dflags.includes("--puppeteer-disable-headless")) {
        imports.puppeteer.headless = false
        console.debug(`metrics/compute/${login} > disabled puppeteer headless mode`)
      }
      if (dflags.includes("--puppeteer-debug")) {
        process.env.DEBUG = "puppeteer:*"
        console.debug(`metrics/compute/${login} > enabled puppeteer debugging`)
      }
      if (dflags.find(flag => flag.startsWith("--puppeteer-wait-"))) {
        imports.puppeteer.events = dflags.filter(flag => flag.startsWith("--puppeteer-wait-")).map(flag => flag.replace("--puppeteer-wait-", ""))
        console.debug(`metrics/compute/${login} > overridden puppeteer wait events [${imports.puppeteer.events}]`)
      }
    }

    //Metrics insights
    if (convert === "insights")
      return metrics.insights.output({login, imports, conf}, {graphql, rest, Plugins, Templates})

    //Partial parts
    {
      data.partials = new Set([
        ..._partials.filter(partial => partials.includes(partial)),
        ...partials,
      ])
      console.debug(`metrics/compute/${login} > content order : ${[...data.partials]}`)
    }

    //Executing base plugin and compute metrics
    console.debug(`metrics/compute/${login} > compute`)
    await Plugins.base({login, q, data, rest, graphql, plugins, queries, pending, imports, callbacks}, conf)
    await computer({login, q}, {conf, data, rest, graphql, plugins, queries, account: data.account, convert, template, callbacks}, {pending, imports})
    const promised = await Promise.all(pending)

    //Check plugins errors
    const errors = [...promised.filter(({result = null}) => result?.error), ...data.errors]
    if (errors.length) {
      console.debug(`metrics/compute/${login} > ${errors.length} errors !`)
      if (die)
        throw new Error("An error occurred during rendering, dying")
      else
        console.debug(util.inspect(errors, {depth: Infinity, maxStringLength: 256}))
    }

    //JSON output
    if (convert === "json") {
      console.debug(`metrics/compute/${login} > json output`)
      const cache = new WeakSet()
      const rendered = JSON.parse(JSON.stringify(data, (key, value) => {
        if ((value instanceof Set) || (Array.isArray(value)))
          return [...value]
        if (value instanceof Map)
          return Object.fromEntries(value)
        if ((typeof value === "object") && (value)) {
          if (cache.has(value))
            return Object.fromEntries(Object.entries(value).map(([k, v]) => [k, cache.has(v) ? "[Circular]" : v]))
          cache.add(value)
        }
        return value
      }))
      return {rendered, mime: "application/json", errors}
    }

    //Markdown output
    if (/markdown/.test(convert)) {
      //Retrieving template source
      console.debug(`metrics/compute/${login} > markdown render`)
      let source = image
      try {
        let template = `${q.markdown}`.replace(/\n/g, "")
        if (!/^https:/.test(template)) {
          const {data: {default_branch: branch, full_name: repo}} = await rest.repos.get({owner: login, repo: q.repo || login})
          console.debug(`metrics/compute/${login} > on ${repo} with default branch ${branch}`)
          template = `https://raw.githubusercontent.com/${repo}/${branch}/${template}`
        }
        console.debug(`metrics/compute/${login} > fetching ${template}`)
        ;({data: source} = await imports.axios.get(template, {headers: {Accept: "text/plain"}}))
      }
      catch (error) {
        console.debug(error)
      }
      //Embed method
      const _q = q
      const embed = async (name, q = {}) => {
        //Check arguments
        console.debug(`metrics/compute/${login}/embed > ${name} >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>`)
        if ((!name) || (typeof q !== "object") || (q === null)) {
          if (die)
            throw new Error("An error occurred during embed rendering, dying")
          return "<p>‚ö†Ô∏è Failed to execute embed function: invalid arguments</p>"
        }
        console.debug(`metrics/compute/${login} > embed called with`)
        console.debug(q)
        let {base} = q
        q = {..._q, ...Object.fromEntries(Object.keys(Plugins).map(key => [key, false])), ...Object.fromEntries(conf.settings.plugins.base.parts.map(part => [`base.${part}`, false])), template: q.repo ? "repository" : "classic", ...q}
        //Translate action syntax to web syntax
        let parts = []
        if (base === true)
          q = {...q, ...Object.fromEntries(Object.entries(_q).filter(([key]) => /^base[.]?/.test(key)))}
        if (typeof base === "string")
          parts = base.split(",").map(x => x.trim())
        if (Array.isArray(base))
          parts = base
        for (const part of parts)
          q[`base.${part}`] = true
        if (convert === "markdown-pdf") {
          q["config.animations"] = false
          q.config_animations = false
        }
        q = Object.fromEntries([...Object.entries(q).map(([key, value]) => [key.replace(/^plugin_/, "").replace(/_/g, "."), value]), ["base", false]])
        //Check users errors
        const warnings = []
        if ((!Object.keys(Plugins).filter(key => q[key]).length) && (!parts.length))
          warnings.push({warning: {message: "No plugin were selected"}})
        const ineffective = Object.keys(q).filter(key => (key.includes(".")) && (key.split(".").at(0) !== "base") && (!(key in imports.metadata.plugins.base.inputs)) && (key.split(".").at(0) in Plugins)).filter(key => !q[key.split(".").at(0)])
        warnings.push(...ineffective.map(key => ({warning: {message: `"${key}" has no effect because "${key.split(".").at(0)}: true" is not set`}})))
        //Compute rendering
        const {rendered} = await metrics({login, q}, {...arguments[1], convert: ["svg", "png", "jpeg"].includes(q["config.output"]) ? q["config.output"] : null, warnings}, arguments[2])
        console.debug(`metrics/compute/${login}/embed > ${name} > success >>>>>>>>>>>>>>>>>>>>>>`)
        return `<img class="metrics-cacheable" data-name="${name}" src="data:image/${{png: "png", jpeg: "jpeg"}[q["config.output"]] ?? "svg+xml"};base64,${Buffer.from(rendered).toString("base64")}">`
      }
      //Rendering template source
      let rendered = source.replace(/\{\{ (?<content>[\s\S]*?) \}\}/g, "{%= $<content> %}")
      console.debug(rendered)
      for (const delimiters of [{openDelimiter: "<", closeDelimiter: ">"}, {openDelimiter: "{", closeDelimiter: "}"}])
        rendered = await ejs.render(rendered, {...data, s: imports.s, f: imports.format, embed}, {views, async: true, ...delimiters})
      console.debug(`metrics/compute/${login} > success`)
      //Output
      if (convert === "markdown-pdf") {
        return imports.svg.pdf(rendered, {
          paddings: q["config.padding"] || conf.settings.padding,
          style: extras.css,
          twemojis: q["config.twemoji"],
          gemojis: q["config.gemoji"],
          octicons: q["config.octicon"],
          rest,
          errors,
        })
      }
      return {rendered, mime: "text/html", errors}
    }

    //Rendering
    console.debug(`metrics/compute/${login} > render`)
    let rendered = await ejs.render(image, {...data, s: imports.s, f: imports.format, style, fonts}, {views, async: true})

    //Additional transformations
    if (q["config.twemoji"])
      rendered = await imports.svg.twemojis(rendered)
    if (q["config.gemoji"])
      rendered = await imports.svg.gemojis(rendered, {rest})
    if (q["config.octicon"])
      rendered = await imports.svg.octicons(rendered)
    //Optimize rendering
    if ((conf.settings?.optimize === true) || (conf.settings?.optimize?.includes?.("css")))
      rendered = await imports.svg.optimize.css(rendered)
    if ((conf.settings?.optimize === true) || (conf.settings?.optimize?.includes?.("xml")))
      rendered = await imports.svg.optimize.xml(rendered, q)
    if ((conf.settings?.optimize === true) || (conf.settings?.optimize?.includes?.("svg")))
      rendered = await imports.svg.optimize.svg(rendered, q, experimental)
    //Verify svg
    if ((verify) && (imports.metadata.plugins.core.extras("verify", {...conf.settings, error: false}))) {
      console.debug(`metrics/compute/${login} > verify SVG`)
      let libxmljs = null
      try {
        libxmljs = (await import("libxmljs2")).default
      }
      catch (error) {
        console.debug(`metrics/compute/${login} > failed to import libxmljs2 (${error}), ignoring SVG verification`)
      }
      if (!libxmljs) {
        const parsed = libxmljs.parseXml(rendered)
        if (parsed.errors.length)
          throw new Error(`Malformed SVG : \n${parsed.errors.join("\n")}`)
        console.debug(`metrics/compute/${login} > verified SVG, no parsing errors found`)
      }
    }
    //Resizing
    const {resized, mime} = await imports.svg.resize(rendered, {paddings: q["config.padding"] || conf.settings.padding, convert: convert === "svg" ? null : convert, scripts: [...data.postscripts, extras.js || null].filter(x => x)})
    rendered = resized

    //Result
    console.debug(`metrics/compute/${login} > success`)
    return {rendered, mime, errors}
  }
  //Internal error
  catch (error) {
    //User not found
    if (((Array.isArray(error.errors)) && (error.errors[0].type === "NOT_FOUND")))
      throw new Error("user not found")
    //Generic error
    throw error
  }
}

//Metrics insights
metrics.insights = async function({login}, {graphql, rest, conf, callbacks}, {Plugins, Templates}) {
  return metrics({login, q: metrics.insights.q}, {graphql, rest, plugins: metrics.insights.plugins, conf, callbacks, convert: "json"}, {Plugins, Templates})
}
metrics.insights.q = {
  template: "classic",
  achievements: true,
  "achievements.threshold": "X",
  isocalendar: true,
  "isocalendar.duration": "full-year",
  languages: true,
  "languages.limit": 0,
  activity: true,
  "activity.limit": 100,
  "activity.days": 0,
  "activity.timestamps": true,
  notable: true,
  "notable.repositories": true,
  followup: true,
  "followup.sections": "repositories, user",
  introduction: true,
  topics: true,
  "topics.mode": "icons",
  "topics.limit": 0,
  stars: true,
  "stars.limit": 6,
  reactions: true,
  "reactions.details": "percentage",
  repositories: true,
  "repositories.pinned": 6,
  sponsors: true,
  calendar: true,
  "calendar.limit": 0,
}
metrics.insights.plugins = {
  achievements: {enabled: true},
  isocalendar: {enabled: true},
  languages: {enabled: true, extras: false},
  activity: {enabled: true, markdown: "extended"},
  notable: {enabled: true},
  followup: {enabled: true},
  introduction: {enabled: true},
  topics: {enabled: true},
  stars: {enabled: true},
  reactions: {enabled: true},
  repositories: {enabled: true},
  sponsors: {enabled: true},
  calendar: {enabled: true},
}

//Metrics insights static render
metrics.insights.output = async function({login, imports, conf}, {graphql, rest, Plugins, Templates}) {
  //Server
  console.debug(`metrics/compute/${login} > insights`)
  const server = `http://localhost:${conf.settings.port}`
  console.debug(`metrics/compute/${login} > insights > server on port ${conf.settings.port}`)

  //Data processing
  const browser = await imports.puppeteer.launch()
  const page = await browser.newPage()
  console.debug(`metrics/compute/${login} > insights > generating data`)
  const result = await metrics.insights({login}, {graphql, rest, conf}, {Plugins, Templates})
  const json = JSON.stringify(result)
  await page.goto(`${server}/insights/${login}?embed=1&localstorage=1`)
  await page.evaluate(async json => localStorage.setItem("local.metrics", json), json) //eslint-disable-line no-undef
  await page.goto(`${server}/insights/${login}?embed=1&localstorage=1`)
  await page.waitForSelector(".container .user", {timeout: 10 * 60 * 1000})

  //Rendering
  console.debug(`metrics/compute/${login} > insights > rendering data`)
  const rendered = `
    <html>
      <head>
        <meta charset="utf-8">
        <title>Metrics insights: ${login}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
      </head>
      <body>
        ${await page.evaluate(() => document.querySelector("main").outerHTML)}
        ${(await Promise.all([".css/style.vars.css", ".css/style.css", "insights/.statics/style.css"].map(path => utils.axios.get(`${server}/${path}`)))).map(({data: style}) => `<style>${style}</style>`).join("\n")}
      </body>
    </html>`
  await browser.close()
  return {mime: "text/html", rendered, errors: result.errors}
}
</file>

<file path="source/app/metrics/setup.mjs">
//Imports
import OctokitRest from "@octokit/rest"
import processes from "child_process"
import fs from "fs"
import yaml from "js-yaml"
import path from "path"
import url from "url"
import util from "util"
import metadata from "./metadata.mjs"

//Templates and plugins
const Templates = {}
const Plugins = {}

/**Setup */
export default async function({log = true, sandbox = false, community = {}, extras = false} = {}) {
  //Paths
  const __metrics = path.join(path.dirname(url.fileURLToPath(import.meta.url)), "../../..")
  const __statics = path.join(__metrics, "source/app/web/statics")
  const __templates = path.join(__metrics, "source/templates")
  const __plugins = path.join(__metrics, "source/plugins")
  const __package = path.join(__metrics, "package.json")
  const __settings = path.join(__metrics, "settings.json")
  const __modules = path.join(__metrics, "node_modules")

  //Init
  const logger = log ? console.debug : () => null
  logger("metrics/setup > setup")
  const conf = {
    authenticated: null,
    templates: {},
    queries: {},
    settings: {port: 3000},
    metadata: {},
    paths: {
      statics: __statics,
      templates: __templates,
      node_modules: __modules,
    },
  }

  //Load settings
  {
    logger("metrics/setup > load settings.json")
    let fd
    try {
      fd = await fs.promises.open(__settings, "r")
      if (sandbox)
        logger("metrics/setup > load settings.json > skipped because in sandbox is enabled")
      else {
        conf.settings = JSON.parse(`${await fs.promises.readFile(fd)}`)
        logger("metrics/setup > load settings.json > success")
      }
    }
    catch (error) {
      if (error?.code === "ENOENT")
        logger("metrics/setup > load settings.json > (missing)")
      else
        logger(`metrics/setup > load settings.json > (error : ${error})`)
    }
    finally {
      await fd?.close()
    }
  }

  if (!conf.settings.templates)
    conf.settings.templates = {default: "classic", enabled: []}
  if (!conf.settings.plugins)
    conf.settings.plugins = {}
  conf.settings.community = {...conf.settings.community, ...community}
  conf.settings.plugins.base = {parts: ["header", "activity", "community", "repositories", "metadata"]}
  if (conf.settings.debug)
    logger(util.inspect(conf.settings, {depth: Infinity, maxStringLength: 256}))

  //Load package settings
  logger("metrics/setup > load package.json")
  conf.package = JSON.parse(`${await fs.promises.readFile(__package)}`)
  logger("metrics/setup > load package.json > success")

  //Load community templates
  if ((conf.settings.extras?.features?.includes?.("metrics.setup.community.templates")) || (conf.settings.extras?.features === true) || (conf.settings.extras?.default) || (extras) || (sandbox)) {
    if ((typeof conf.settings.community.templates === "string") && (conf.settings.community.templates.length)) {
      logger("metrics/setup > parsing community templates list")
      conf.settings.community.templates = [...new Set([...decodeURIComponent(conf.settings.community.templates).split(",").map(v => v.trim().toLocaleLowerCase()).filter(v => v)])]
    }
    if ((Array.isArray(conf.settings.community.templates)) && (conf.settings.community.templates.length)) {
      //Clean remote repository
      logger(`metrics/setup > ${conf.settings.community.templates.length} community templates to install`)
      await fs.promises.rm(path.join(__templates, ".community"), {recursive: true, force: true})
      //Download community templates
      for (const template of conf.settings.community.templates) {
        try {
          //Parse community template
          logger(`metrics/setup > load community template ${template}`)
          const {repo, branch, name, trust = false} = template.match(/^(?<repo>[\s\S]+?)@(?<branch>[\s\S]+?):(?<name>[\s\S]+?)(?<trust>[+]trust)?$/)?.groups ?? null
          const command = `git clone --single-branch --branch ${branch} https://github.com/${repo}.git ${path.join(__templates, ".community")}`
          logger(`metrics/setup > run ${command}`)
          //Clone remote repository
          processes.execSync(command, {stdio: "ignore"})
          //Extract template
          logger(`metrics/setup > extract ${name} from ${repo}@${branch}`)
          await fs.promises.rm(path.join(__templates, `@${name}`), {recursive: true, force: true})
          await fs.promises.rename(path.join(__templates, ".community/source/templates", name), path.join(__templates, `@${name}`))
          //JavaScript file
          if (trust)
            logger(`metrics/setup > keeping @${name}/template.mjs (unsafe mode is enabled)`)
          else if (fs.existsSync(path.join(__templates, `@${name}`, "template.mjs"))) {
            logger(`metrics/setup > removing @${name}/template.mjs`)
            await fs.promises.unlink(path.join(__templates, `@${name}`, "template.mjs"))
            const inherit = yaml.load(`${fs.promises.readFile(path.join(__templates, `@${name}`, "metadata.yml"))}`).extends ?? null
            if (inherit) {
              logger(`metrics/setup > @${name} extends from ${inherit}`)
              if (fs.existsSync(path.join(__templates, inherit, "template.mjs"))) {
                logger(`metrics/setup > @${name} extended from ${inherit}`)
                await fs.promises.copyFile(path.join(__templates, inherit, "template.mjs"), path.join(__templates, `@${name}`, "template.mjs"))
              }
              else {
                logger(`metrics/setup > @${name} could not extends ${inherit} as it does not exist`)
              }
            }
          }
          else {
            logger(`metrics/setup > @${name}/template.mjs does not exist`)
          }

          //Clean remote repository
          logger(`metrics/setup > clean ${repo}@${branch}`)
          await fs.promises.rm(path.join(__templates, ".community"), {recursive: true, force: true})
          logger(`metrics/setup > loaded community template ${name}`)
        }
        catch (error) {
          logger(`metrics/setup > failed to load community template ${template}`)
          logger(error)
        }
      }
    }
    else {
      logger("metrics/setup > no community templates to install")
    }
  }
  else {
    logger("metrics/setup > community templates are disabled")
  }

  //Load templates
  for (const name of await fs.promises.readdir(__templates)) {
    //Search for templates
    const directory = path.join(__templates, name)
    if ((!(await fs.promises.lstat(directory)).isDirectory()) || (!fs.existsSync(path.join(directory, "partials/_.json"))))
      continue
    logger(`metrics/setup > load template [${name}]`)
    //Cache templates files
    const files = ["image.svg", "style.css", "fonts.css"].map(file => path.join(__templates, fs.existsSync(path.join(directory, file)) ? name : "classic", file))
    const [image, style, fonts] = await Promise.all(files.map(async file => `${await fs.promises.readFile(file)}`))
    const partials = JSON.parse(`${await fs.promises.readFile(path.join(directory, "partials/_.json"))}`)
    conf.templates[name] = {image, style, fonts, partials, views: [directory]}

    //Cache templates scripts
    Templates[name] = await (async () => {
      const template = path.join(directory, "template.mjs")
      const fallback = path.join(__templates, "classic", "template.mjs")
      return (await import(url.pathToFileURL(fs.existsSync(template) ? template : fallback).href)).default
    })()
    logger(`metrics/setup > load template [${name}] > success`)
    //Debug
    if (conf.settings.debug) {
      Object.defineProperty(conf.templates, name, {
        get() {
          logger(`metrics/setup > reload template [${name}]`)
          const [image, style, fonts] = files.map(file => `${fs.readFileSync(file)}`)
          const partials = JSON.parse(`${fs.readFileSync(path.join(directory, "partials/_.json"))}`)
          logger(`metrics/setup > reload template [${name}] > success`)
          return {image, style, fonts, partials, views: [directory]}
        },
      })
    }
  }

  //Load plugins
  for (const name of await fs.promises.readdir(__plugins)) {
    switch (name) {
      case "community": {
        const ___plugins = path.join(__plugins, "community")
        for (const name of await fs.promises.readdir(___plugins))
          await load.plugin(name, {__plugins: ___plugins, Plugins, conf, logger})
        continue
      }
      default:
        await load.plugin(name, {__plugins, Plugins, conf, logger})
    }
  }

  //Load metadata
  conf.metadata = await metadata({log})

  //Modes
  if ((!conf.settings.modes) || (!conf.settings.modes.length))
    conf.settings.modes = ["embed", "insights"]
  logger(`metrics/setup > setup > enabled modes ${JSON.stringify(conf.settings.modes)}`)

  //Allowed outputs formats
  if ((!conf.settings.outputs) || (!conf.settings.outputs.length))
    conf.settings.outputs = metadata.inputs.config_output.values
  else
    conf.settings.outputs = conf.settings.outputs.filter(format => metadata.inputs.config_output.values.includes(format))
  logger(`metrics/setup > setup > allowed outputs ${JSON.stringify(conf.settings.outputs)}`)

  //Store authenticated user
  if (conf.settings.token) {
    try {
      conf.authenticated = (await (new OctokitRest.Octokit({auth: conf.settings.token})).users.getAuthenticated()).data.login
      logger(`metrics/setup > setup > authenticated as ${conf.authenticated}`)
    }
    catch (error) {
      logger(`metrics/setup > setup > could not verify authentication : ${error}`)
    }
  }

  //Set no token property
  Object.defineProperty(conf.settings, "notoken", {
    get() {
      return conf.settings.token === "NOT_NEEDED"
    },
  })

  //Conf
  logger("metrics/setup > setup > success")
  return {Templates, Plugins, conf}
}

const load = {
  async plugin(name, {__plugins, Plugins, conf, logger}) {
    //Search for plugins
    const directory = path.join(__plugins, name)
    if (!(await fs.promises.lstat(directory)).isDirectory())
      return
    //Cache plugins scripts
    logger(`metrics/setup > load plugin [${name}]`)
    Plugins[name] = (await import(url.pathToFileURL(path.join(directory, "index.mjs")).href)).default
    logger(`metrics/setup > load plugin [${name}] > success`)
    //Register queries
    const __queries = path.join(directory, "queries")
    if (fs.existsSync(__queries)) {
      //Alias for default query
      const queries = function() {
        if (!queries[name])
          throw new ReferenceError(`Default query for ${name} undefined`)
        return queries[name](...arguments)
      }
      conf.queries[name] = queries
      //Load queries
      for (const file of await fs.promises.readdir(__queries)) {
        //Cache queries
        const query = file.replace(/[.]graphql$/, "")
        logger(`metrics/setup > load query [${name}/${query}]`)
        queries[`_${query}`] = `${await fs.promises.readFile(path.join(__queries, file))}`
        logger(`metrics/setup > load query [${name}/${query}] > success`)
        //Debug
        if (conf.settings.debug) {
          Object.defineProperty(queries, `_${query}`, {
            get() {
              logger(`metrics/setup > reload query [${name}/${query}]`)
              const raw = `${fs.readFileSync(path.join(__queries, file))}`
              logger(`metrics/setup > reload query [${name}/${query}] > success`)
              return raw
            },
          })
        }
      }
      //Create queries formatters
      Object.keys(queries).map(query =>
        queries[query.substring(1)] = (vars = {}) => {
          let queried = queries[query]
          for (const [key, value] of Object.entries(vars))
            queried = queried.replace(new RegExp(`[$]${key}`, "g"), value)
          return queried
        }
      )
    }
  },
}
</file>

<file path="source/app/web/statics/embed/app.js">
;(async function() {
  //Init
  const {data: metadata} = await axios.get("/.plugins.metadata")
  delete metadata.core.web.output
  delete metadata.core.web.twemojis
  //App
  return new Vue({
    //Initialization
    el: "main",
    async mounted() {
      //Interpolate config from browser
      try {
        this.config.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone
        this.palette = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light"
        if (localStorage.getItem("session.metrics"))
          axios.defaults.headers.common["x-metrics-session"] = localStorage.getItem("session.metrics")
      }
      catch (error) {}
      //Init
      await Promise.all([
        //GitHub limit tracker
        (async () => {
          const {data: requests} = await axios.get("/.requests")
          this.requests = requests
          if (!requests.login) {
            localStorage.removeItem("session.metrics")
            delete axios.defaults.headers.common["x-metrics-session"]
          }
        })(),
        //Templates
        (async () => {
          const {data: templates} = await axios.get("/.templates")
          templates.sort((a, b) => (a.name.startsWith("@") ^ b.name.startsWith("@")) ? (a.name.startsWith("@") ? 1 : -1) : a.name.localeCompare(b.name))
          this.templates.list = templates
          this.templates.selected = templates[0]?.name || "classic"
        })(),
        //Plugins
        (async () => {
          const {data: plugins} = await axios.get("/.plugins")
          this.plugins.list = plugins.filter(({name}) => metadata[name]?.supports.includes("user") || metadata[name]?.supports.includes("organization"))
          const categories = [...new Set(this.plugins.list.map(({category}) => category))]
          this.plugins.categories = Object.fromEntries(categories.map(category => [category, this.plugins.list.filter(value => category === value.category)]))
        })(),
        //Base
        (async () => {
          const {data: base} = await axios.get("/.plugins.base")
          this.plugins.base = base
          this.plugins.enabled.base = Object.fromEntries(base.map(key => [key, true]))
        })(),
        //Extras
        (async () => {
          const {data: extras} = await axios.get("/.extras")
          this.extras = extras
        })(),
        //Version
        (async () => {
          const {data: version} = await axios.get("/.version")
          this.version = `v${version}`
        })(),
        //Hosted
        (async () => {
          const {data: hosted} = await axios.get("/.hosted")
          this.hosted = hosted
        })(),
        //OAuth
        (async () => {
          const {data: enabled} = await axios.get("/.oauth/enabled")
          this.oauth = enabled
        })(),
      ])
      //Generate placeholder
      this.mock({timeout: 200})
      setInterval(() => {
        const marker = document.querySelector("#metrics-end")
        if (marker) {
          this.mockresize()
          marker.remove()
        }
      }, 100)
    },
    components: {Prism: PrismComponent},
    //Watchers
    watch: {
      tab: {
        immediate: true,
        handler(current) {
          if (current === "markdown")
            this.clipboard = new ClipboardJS(".copy-markdown")
          else if (current === "action")
            this.clipboard = new ClipboardJS(".copy-action")
          else
            this.clipboard?.destroy()
        },
      },
      palette: {
        immediate: true,
        handler(current, previous) {
          document.querySelector("body").classList.remove(previous)
          document.querySelector("body").classList.add(current)
        },
      },
    },
    //Data initialization
    data: {
      version: "",
      user: new URLSearchParams(location.search).get("user") || "",
      tab: "overview",
      palette: "light",
      clipboard: null,
      requests: {rest: {limit: 0, used: 0, remaining: 0, reset: NaN}, graphql: {limit: 0, used: 0, remaining: 0, reset: NaN}, search: {limit: 0, used: 0, remaining: 0, reset: NaN}},
      cached: new Map(),
      config: Object.fromEntries(Object.entries(metadata.core.web).map(([key, {defaulted}]) => [key, defaulted])),
      metadata: Object.fromEntries(Object.entries(metadata).map(([key, {web}]) => [key, web])),
      hosted: null,
      extras: false,
      oauth: false,
      docs: {
        overview: {
          link: "https://github.com/lowlighter/metrics#-documentation",
          name: "Complete documentation",
        },
        markdown: {
          link: "https://github.com/lowlighter/metrics/blob/master/.github/readme/partials/documentation/setup/shared.md",
          name: "Setup using the shared instance",
        },
        action: {
          link: "https://github.com/lowlighter/metrics/blob/master/.github/readme/partials/documentation/setup/action.md",
          name: "Setup using GitHub Action on a profile repository",
        },
      },
      plugins: {
        base: {},
        list: [],
        categories: [],
        enabled: {},
        descriptions: {
          base: "üóÉÔ∏è Base content",
          "base.header": "Header",
          "base.activity": "Account activity",
          "base.community": "Community stats",
          "base.repositories": "Repositories metrics",
          "base.metadata": "Metadata",
          ...Object.fromEntries(Object.entries(metadata).map(([key, {name}]) => [key, name])),
        },
        options: {
          descriptions: {...(Object.assign({}, ...Object.entries(metadata).flatMap(([key, {web}]) => web)))},
          ...(Object.fromEntries(
            Object.entries(
              Object.assign({}, ...Object.entries(metadata).flatMap(([key, {web}]) => web)),
            )
              .map(([key, {defaulted}]) => [key, defaulted]),
          )),
        },
      },
      templates: {
        list: [],
        selected: "classic",
        placeholder: {
          timeout: null,
          image: "",
        },
        descriptions: {
          classic: "Classic template",
          terminal: "Terminal template",
          markdown: "(hidden)",
          repository: "(hidden)",
        },
      },
      generated: {
        pending: false,
        content: "",
        error: false,
      },
    },
    //Computed data
    computed: {
      //URL parameters
      params() {
        return new URLSearchParams({from: location.href})
      },
      //Unusable plugins
      unusable() {
        const plugins = Object.entries(this.plugins.enabled).filter(([key, value]) => (value == true) && (!this.plugins.list.filter(({name}) => name === key)[0]?.enabled)).map(([key]) => key)
        const options = this.edited.filter(option => !this.supports(this.plugins.options.descriptions[option]))
        return [...plugins, ...options].sort()
      },
      //Edited plugins options
      edited() {
        return Object.keys(this.plugins.enabled).flatMap(plugin => Object.keys(this.options({name: plugin})).filter(key => this.plugins.options[key] !== metadata[plugin]?.web[key]?.defaulted))
      },
      //User's avatar
      avatar() {
        return this.generated.content ? `https://github.com/${this.user}.png` : null
      },
      //User's repository
      repo() {
        return `https://github.com/${this.user}/${this.user}`
      },
      //Endpoint to use for computed metrics
      url() {
        //Plugins enabled
        const plugins = Object.entries(this.plugins.enabled)
          .flatMap(([key, value]) => key === "base" ? Object.entries(value).map(([key, value]) => [`base.${key}`, value]) : [[key, value]])
          .filter(([key, value]) => /^base[.]\w+$/.test(key) ? !value : value)
          .map(([key, value]) => `${key}=${+value}`)
        //Plugins options
        const options = Object.entries(this.plugins.options)
          .filter(([key, value]) => `${value}`.length)
          .filter(([key, value]) => this.plugins.enabled[key.split(".")[0]])
          .map(([key, value]) => `${key}=${encodeURIComponent(value)}`)
        //Base options
        const base = Object.entries(this.plugins.options).filter(([key, value]) => (key in metadata.base.web) && (value !== metadata.base.web[key]?.defaulted)).map(([key, value]) => `${key}=${encodeURIComponent(value)}`)
        //Config
        const config = Object.entries(this.config).filter(([key, value]) => (value) && (value !== metadata.core.web[key]?.defaulted)).map(([key, value]) => `config.${key}=${encodeURIComponent(value)}`)
        //Template
        const template = (this.templates.selected !== this.templates.list[0]) ? [`template=${this.templates.selected}`] : []
        //Generated url
        const params = [...template, ...base, ...plugins, ...options, ...config].join("&")
        return `${window.location.protocol}//${window.location.host}/${this.user}${params.length ? `?${params}` : ""}`
      },
      //Embedded generated code
      embed() {
        return `![Metrics](${this.url})`
      },
      //Token scopes
      scopes() {
        return new Set([
          ...Object.entries(this.plugins.enabled).filter(([key, value]) => (key !== "base") && (value)).flatMap(([key]) => metadata[key].scopes),
          ...(Object.entries(this.plugins.enabled.base).filter(([key, value]) => value).length ? metadata.base.scopes : []),
        ])
      },
      //GitHub action auto-generated code
      action() {
        return [
          `# Visit https://github.com/lowlighter/metrics#-documentation for full reference`,
          `name: Metrics`,
          `on:`,
          `  # Schedule updates (each hour)`,
          `  schedule: [{cron: "0 * * * *"}]`,
          `  # Lines below let you run workflow manually and on each commit`,
          `  workflow_dispatch:`,
          `  push: {branches: ["master", "main"]}`,
          `jobs:`,
          `  github-metrics:`,
          `    runs-on: ubuntu-latest`,
          `    permissions:`,
          `      contents: write`,
          `    steps:`,
          `      - uses: lowlighter/metrics@latest`,
          `        with:`,
          ...(this.scopes.size
            ? [
              `          # Your GitHub token`,
              `          # The following scopes are required:`,
              ...[...this.scopes].map(scope => `          #  - ${scope}${scope === "public_access" ? " (default scope)" : ""}`),
              `          # The following additional scopes may be required:`,
              `          #  - read:org      (for organization related metrics)`,
              `          #  - read:user     (for user related data)`,
              `          #  - read:packages (for some packages related data)`,
              `          #  - repo          (optional, if you want to include private repositories)`,
            ]
            : [
              `          # Current configuration doesn't require a GitHub token`,
            ]),
          `          token: ${this.scopes.size ? `${"$"}{{ secrets.METRICS_TOKEN }}` : "NOT_NEEDED"}`,
          ``,
          `          # Options`,
          ...(this.user ? [`          user: ${this.user}`] : []),
          `          template: ${this.templates.selected}`,
          `          base: ${Object.entries(this.plugins.enabled.base).filter(([key, value]) => value).map(([key]) => key).join(", ") || '""'}`,
          ...[
            ...Object.entries(this.plugins.options).filter(([key, value]) => (key in metadata.base.web) && (value !== metadata.base.web[key]?.defaulted)).map(([key, value]) => `          ${key.replace(/[.]/g, "_")}: ${typeof value === "boolean" ? {true: "yes", false: "no"}[value] : value}`),
            ...Object.entries(this.plugins.enabled).filter(([key, value]) => (key !== "base") && (value)).map(([key]) => `          plugin_${key}: yes`),
            ...Object.entries(this.plugins.options).filter(([key, value]) => (value) && (!(key in metadata.base.web))).filter(([key, value]) => this.plugins.enabled[key.split(".")[0]]).map(([key, value]) => `          plugin_${key.replace(/[.]/g, "_")}: ${typeof value === "boolean" ? {true: "yes", false: "no"}[value] : value}`),
            ...Object.entries(this.config).filter(([key, value]) => (value) && (value !== metadata.core.web[key]?.defaulted)).map(([key, value]) => `          config_${key.replace(/[.]/g, "_")}: ${typeof value === "boolean" ? {true: "yes", false: "no"}[value] : value}`),
          ].sort(),
        ].join("\n")
      },
      //Is in preview mode
      preview() {
        return /-preview$/.test(this.version)
      },
      //Is in beta mode
      beta() {
        return /-beta$/.test(this.version)
      },
      //Rate limit reset
      rlreset() {
        const reset = new Date(Math.max(this.requests.graphql.reset, this.requests.rest.reset))
        return `${reset.getHours()}:${reset.getMinutes()}`
      },
    },
    //Methods
    methods: {
      //Refresh computed properties
      async refresh() {
        const keys = {action: ["scopes", "action"], markdown: ["url", "embed"]}[this.tab]
        if (keys) {
          for (const key of keys)
            this._computedWatchers[key]?.run()
          this.$forceUpdate()
        }
      },
      //Load and render placeholder image
      async mock({timeout = 600} = {}) {
        this.refresh()
        clearTimeout(this.templates.placeholder.timeout)
        this.templates.placeholder.timeout = setTimeout(async () => {
          this.templates.placeholder.image = await placeholder(this)
          this.generated.content = ""
          this.generated.error = null
        }, timeout)
      },
      //Resize mock image
      mockresize() {
        const svg = document.querySelector(".preview .image svg")
        if ((svg) && (svg.getAttribute("height") == 99999)) {
          const height = svg.querySelector("#metrics-end")?.getBoundingClientRect()?.y - svg.getBoundingClientRect()?.y
          if (Number.isFinite(height))
            svg.setAttribute("height", height)
        }
      },
      //Generate metrics and flush cache
      async generate() {
        //Avoid requests spamming
        if (this.generated.pending)
          return
        this.generated.pending = true
        //Compute metrics
        try {
          await axios.get(`/.uncache?&token=${(await axios.get(`/.uncache?user=${this.user}`)).data.token}`)
          this.generated.content = (await axios.get(this.url)).data
          this.generated.error = null
        }
        catch (error) {
          this.generated.error = {code: error.response.status, message: error.response.data}
        }
        finally {
          this.generated.pending = false
          try {
            const {data: requests} = await axios.get("/.requests")
            this.requests = requests
          }
          catch {}
        }
      },
      //Get available options from plugin
      options({name}) {
        return Object.fromEntries(Object.entries(this.plugins.options.descriptions).filter(([key]) => ((key.startsWith(`${name}.`)) || (key === name)) && (!(key in metadata.base.web))))
      },
      //Check if option is supported
      supports(option) {
        if (!option)
          return false
        const {extras: required = null} = option
        if (!Array.isArray(required))
          return true
        if (!Array.isArray(this.extras))
          return this.extras
        return required.filter(permission => !this.extras.includes(permission)).length === 0
      },
    },
  })
})()
</file>

<file path="source/app/web/statics/insights/script.js">
;(async function() {
  //App
  return new Vue({
    //Initialization
    el: "main",
    async mounted() {
      //Palette
      try {
        this.palette = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light"
        if (localStorage.getItem("session.metrics"))
          axios.defaults.headers.common["x-metrics-session"] = localStorage.getItem("session.metrics")
      }
      catch (error) {}
      //Embed
      this.embed = !!(new URLSearchParams(location.search).get("embed"))
      //From local storage
      this.localstorage = !!(new URLSearchParams(location.search).get("localstorage"))
      //User
      const user = location.pathname.split("/").pop()
      if ((user) && (!["about", "insights"].includes(user))) {
        this.user = user
        await this.search()
      }
      else {
        const user = new URLSearchParams(location.search).get("user")
        this.searchable = true
        if (user) {
          this.user = user
          this.search()
        }
      }
      //Init
      await Promise.all([
        //GitHub limit tracker
        (async () => {
          const {data: requests} = await axios.get("/.requests")
          this.requests = requests
          if (!requests.login) {
            localStorage.removeItem("session.metrics")
            delete axios.defaults.headers.common["x-metrics-session"]
          }
        })(),
        //Version
        (async () => {
          const {data: version} = await axios.get("/.version")
          this.version = `v${version}`
        })(),
        //Hosted
        (async () => {
          const {data: hosted} = await axios.get("/.hosted")
          this.hosted = hosted
        })(),
        //OAuth
        (async () => {
          const {data: enabled} = await axios.get("/.oauth/enabled")
          this.oauth = enabled
        })(),
      ])
    },
    //Watchers
    watch: {
      palette: {
        immediate: true,
        handler(current, previous) {
          document.querySelector("body").classList.remove(previous)
          document.querySelector("body").classList.add(current)
        },
      },
    },
    //Methods
    methods: {
      format(type, value, options) {
        switch (type) {
          case "plural":
            if (options?.y)
              return (value !== 1) ? "ies" : "y"
            return (value !== 1) ? "s" : ""
          case "number":
            return new Intl.NumberFormat(navigator.lang, options).format(value)
          case "date":
            return new Intl.DateTimeFormat(navigator.lang, options).format(new Date(value))
          case "comment":
            const baseUrl = String.raw`https?:\/\/(?:www\.)?github.com\/([\w.-]+\/[\w.-]+)\/`
            return value
              .replace(
                RegExp(baseUrl + String.raw`(?:issues|pull|discussions)\/(\d+)(?:\?[\w-]+)?(#[\w-]+)?(?=<)`, "g"),
                (_, repo, id, comment) => (options?.repo === repo ? "" : repo) + `#${id}` + (comment ? ` (comment)` : ""),
              ) // -> 'lowlighter/metrics#123'
              .replace(
                RegExp(baseUrl + String.raw`commit\/([\da-f]+)(?=<)`, "g"),
                (_, repo, sha) => (options?.repo === repo ? "" : repo + "@") + sha,
              ) // -> 'lowlighter/metrics@123abc'
              .replace(
                RegExp(baseUrl + String.raw`compare\/([\w-.]+...[\w-.]+)(?=<)`, "g"),
                (_, repo, tags) => (options?.repo === repo ? "" : repo + "@") + tags,
              ) // -> 'lowlighter/metrics@1.0...1.1'
              .replace(
                /[^&]#(\d+)/g,
                (_, id) => `<a href="https://github.com/${options?.repo}/issues/${id}">#${id}</a>`,
              ) // -> #123
              .replace(
                /@([-\w]+)/g,
                (_, user) => `<a href="https://github.com/${user}">@${user}</a>`,
              ) // -> @user
        }
        return value
      },
      async search() {
        try {
          this.error = null
          this.metrics = null
          this.pending = true
          if (this.localstorage) {
            this.metrics = JSON.parse(localStorage.getItem("local.metrics") ?? "null")
            this.loaded = ["base", ...Object.keys(this.metrics?.rendered?.plugins ?? {})]
            return
          }
          const {processing, ...data} = (await axios.get(`/insights/query/${this.user}`)).data
          if (processing) {
            let completed = 0
            this.progress = 1 / (data.plugins.length + 1)
            this.loaded = []
            const retry = async (plugin, attempts = 60, interval = 10) => {
              if (this.loaded.includes(plugin))
                return
              do {
                try {
                  const {data} = await axios.get(`/insights/query/${this.user}/${plugin}`)
                  if (!data)
                    throw new Error(`${plugin}: no data`)
                  if (plugin === "base")
                    this.metrics = {rendered: data, mime: "application/json", errors: []}
                  else
                    Object.assign(this.metrics.rendered.plugins, {[plugin]: data})
                  break
                }
                catch {
                  console.warn(`${plugin}: no data yet, retrying in ${interval} seconds`)
                  await new Promise(solve => setTimeout(solve, interval * 1000))
                }
              }
              while (--attempts)
              completed++
              this.progress = completed / (data.plugins.length + 1)
              this.loaded.push(plugin)
            }
            await retry("base", 30, 5)
            await Promise.allSettled(data.plugins.map(plugin => retry(plugin)))
          }
          else {
            this.metrics = data
            this.loaded = ["base", ...Object.keys(this.metrics?.rendered?.plugins ?? {})]
          }
        }
        catch (error) {
          this.error = {code: error.response.status, message: error.response.data}
        }
        finally {
          this.pending = false
          try {
            const {data: requests} = await axios.get("/.requests")
            this.requests = requests
          }
          catch {}
        }
      },
    },
    //Computed properties
    computed: {
      params() {
        return new URLSearchParams({from: location.href})
      },
      warnings() {
        return Object.entries(this.metrics?.rendered.plugins ?? {}).map(([_, value]) => value?.error).filter(value => value)
      },
      stats() {
        return this.metrics?.rendered.user ?? null
      },
      sponsors() {
        return this.metrics?.rendered.plugins?.sponsors ?? null
      },
      ranked() {
        return this.metrics?.rendered.plugins?.achievements?.list?.filter(({leaderboard}) => leaderboard).sort((a, b) => a.leaderboard.type.localeCompare(b.leaderboard.type)) ?? []
      },
      achievements() {
        return this.metrics?.rendered.plugins?.achievements?.list?.filter(({leaderboard}) => !leaderboard).filter(({title}) => !/(?:automator|octonaut|infographile)/i.test(title)) ?? []
      },
      introduction() {
        return this.metrics?.rendered.plugins?.introduction?.text ?? ""
      },
      followup() {
        return this.metrics?.rendered.plugins?.followup ?? null
      },
      calendar() {
        if (this.metrics?.rendered.plugins?.calendar) {
          return Object.assign(this.metrics?.rendered.plugins?.calendar, {
            color(c) {
              return {
                "#ebedf0": "var(--color-calendar-graph-day-bg)",
                "#9be9a8": "var(--color-calendar-graph-day-L1-bg)",
                "#40c463": "var(--color-calendar-graph-day-L2-bg)",
                "#30a14e": "var(--color-calendar-graph-day-L3-bg)",
                "#216e39": "var(--color-calendar-graph-day-L4-bg)",
              }[c] ?? c
            },
          })
        }
        return null
      },
      isocalendar() {
        return (this.metrics?.rendered.plugins?.isocalendar?.svg ?? "")
          .replace(/#ebedf0/gi, "var(--color-calendar-graph-day-bg)")
          .replace(/#9be9a8/gi, "var(--color-calendar-graph-day-L1-bg)")
          .replace(/#40c463/gi, "var(--color-calendar-graph-day-L2-bg)")
          .replace(/#30a14e/gi, "var(--color-calendar-graph-day-L3-bg)")
          .replace(/#216e39/gi, "var(--color-calendar-graph-day-L4-bg)")
      },
      languages() {
        return Object.assign(this.metrics?.rendered.plugins?.languages?.favorites ?? [], {total: this.metrics?.rendered.plugins?.languages.total})
      },
      reactions() {
        return this.metrics?.rendered.plugins?.reactions ?? null
      },
      repositories() {
        return this.metrics?.rendered.plugins?.repositories?.list ?? []
      },
      stars() {
        return {repositories: this.metrics?.rendered.plugins?.stars?.repositories.map(({node, starredAt}) => ({...node, starredAt})) ?? []}
      },
      topics() {
        return this.metrics?.rendered.plugins?.topics?.list ?? []
      },
      activity() {
        return this.metrics?.rendered.plugins?.activity?.events ?? []
      },
      contributions() {
        return this.metrics?.rendered.plugins?.notable?.contributions ?? []
      },
      account() {
        if (!this.metrics)
          return null
        const {login, name} = this.metrics?.rendered.user
        return {login, name, avatar: this.metrics?.rendered.computed.avatar, type: this.metrics?.rendered.account}
      },
      url() {
        return `${window.location.protocol}//${window.location.host}/insights/${this.user}`
      },
      preview() {
        return /-preview$/.test(this.version)
      },
      beta() {
        return /-beta$/.test(this.version)
      },
      rlreset() {
        const reset = new Date(Math.max(this.requests.graphql.reset, this.requests.rest.reset))
        return `${reset.getHours()}:${reset.getMinutes()}`
      },
    },
    //Data initialization
    data: {
      version: "",
      hosted: null,
      user: "",
      embed: false,
      localstorage: false,
      searchable: false,
      requests: {rest: {limit: 0, used: 0, remaining: 0, reset: NaN}, graphql: {limit: 0, used: 0, remaining: 0, reset: NaN}, search: {limit: 0, used: 0, remaining: 0, reset: NaN}},
      palette: "light",
      metrics: null,
      pending: false,
      oauth: false,
      error: null,
      config: {},
      progress: 0,
      loaded: [],
    },
  })
})()
</file>

<file path="source/app/web/statics/oauth/script.js">
;(async function() {
  //App
  return new Vue({
    //Initialization
    el: "main",
    async mounted() {
      //Palette
      try {
        this.palette = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light"
        if (localStorage.getItem("session.metrics")) {
          this.session = localStorage.getItem("session.metrics")
          axios.defaults.headers.common["x-metrics-session"] = localStorage.getItem("session.metrics")
        }
      }
      catch (error) {}
      //Init
      await Promise.all([
        //GitHub limit tracker
        (async () => {
          const {data: requests} = await axios.get("/.requests")
          this.requests = requests
          if (!requests.login) {
            localStorage.removeItem("session.metrics")
            delete axios.defaults.headers.common["x-metrics-session"]
          }
        })(),
        //Version
        (async () => {
          const {data: version} = await axios.get("/.version")
          this.version = `v${version}`
        })(),
        //Hosted
        (async () => {
          const {data: hosted} = await axios.get("/.hosted")
          this.hosted = hosted
        })(),
        //OAuth
        (async () => {
          const {data: enabled} = await axios.get("/.oauth/enabled")
          this.oauth = enabled
        })(),
        //OAuth
        (async () => {
          const {data: extras} = await axios.get("/.extras.logged")
          this.extras = extras
        })(),
      ])
    },
    //Watchers
    watch: {
      palette: {
        immediate: true,
        handler(current, previous) {
          document.querySelector("body").classList.remove(previous)
          document.querySelector("body").classList.add(current)
        },
      },
    },
    //Computed properties
    computed: {
      params() {
        return new URLSearchParams({from: new URLSearchParams(location.search).get("from"), scopes: this.scopes.join(" ")})
      },
      preview() {
        return /-preview$/.test(this.version)
      },
      beta() {
        return /-beta$/.test(this.version)
      },
    },
    //Data initialization
    data: {
      version: "",
      hosted: null,
      requests: {rest: {limit: 0, used: 0, remaining: 0, reset: NaN}, graphql: {limit: 0, used: 0, remaining: 0, reset: NaN}, search: {limit: 0, used: 0, remaining: 0, reset: NaN}},
      palette: "light",
      oauth: false,
      scopes: [],
      extras: [],
      session: null,
      supported: (() => {
        try {
          const storage = window.localStorage
          const test = "__storage_test__"
          storage.setItem(test, test)
          if (storage.getItem(test) !== test)
            throw new Error("localStorage value mismatch")
          storage.removeItem(test)
          return true
        }
        catch (error) {
          console.error(error)
          return false
        }
      })(),
    },
  })
})()
</file>

<file path="source/app/web/statics/app.js">
;(async function() {
  //App
  return new Vue({
    //Initialization
    el: "main",
    async mounted() {
      //Interpolate config from browser
      try {
        this.palette = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light"
        if (localStorage.getItem("session.metrics"))
          axios.defaults.headers.common["x-metrics-session"] = localStorage.getItem("session.metrics")
      }
      catch (error) {}
      //Init
      await Promise.all([
        //GitHub limit tracker
        (async () => {
          const {data: requests} = await axios.get("/.requests")
          this.requests = requests
          if (!requests.login) {
            localStorage.removeItem("session.metrics")
            delete axios.defaults.headers.common["x-metrics-session"]
          }
        })(),
        //Version
        (async () => {
          const {data: version} = await axios.get("/.version")
          this.version = `v${version}`
        })(),
        //Hosted
        (async () => {
          const {data: hosted} = await axios.get("/.hosted")
          this.hosted = hosted
        })(),
        //Modes
        (async () => {
          const {data: modes} = await axios.get("/.modes")
          this.modes = modes
        })(),
        //OAuth
        (async () => {
          const {data: enabled} = await axios.get("/.oauth/enabled")
          this.oauth = enabled
        })(),
      ])
    },
    //Watchers
    watch: {
      palette: {
        immediate: true,
        handler(current, previous) {
          document.querySelector("body").classList.remove(previous)
          document.querySelector("body").classList.add(current)
        },
      },
    },
    //Data initialization
    data: {
      version: "",
      user1: "",
      user2: "",
      palette: "light",
      requests: {rest: {limit: 0, used: 0, remaining: 0, reset: NaN}, graphql: {limit: 0, used: 0, remaining: 0, reset: NaN}, search: {limit: 0, used: 0, remaining: 0, reset: NaN}},
      hosted: null,
      modes: [],
      oauth: false,
    },
    //Computed data
    computed: {
      //URL parameters
      params() {
        return new URLSearchParams({from: location.href})
      },
      //Is in preview mode
      preview() {
        return /-preview$/.test(this.version)
      },
      //Is in beta mode
      beta() {
        return /-beta$/.test(this.version)
      },
      //Rate limit reset
      rlreset() {
        const reset = new Date(Math.max(this.requests.graphql.reset, this.requests.rest.reset))
        return `${reset.getHours()}:${reset.getMinutes()}`
      },
    },
    //Methods
    methods: {
      //Metrics insights
      async insights() {
        window.location.href = `/insights?user=${this.user1}`
      },
      //Metrics embed
      async embed() {
        window.location.href = `/embed?user=${this.user2}`
      },
    },
  })
})()
</file>

<file path="source/app/web/index.mjs">
import app from "./instance.mjs"
;(async function() {
  await app({sandbox: process.env.SANDBOX})
})()
</file>

<file path="source/app/web/settings.example.json">
{
  "//": "Example of configuration for metrics web instance",
  "//": "====================================================================",

  "token": "GITHUB API TOKEN",          "//": "GitHub Personal Token (required)",
  "modes": ["embed", "insights"],       "//": "Web instance enabled modes",
  "restricted": [],                     "//": "Authorized users (empty to disable)",
  "maxusers": 0,                        "//": "Maximum users, (0 to disable)",
  "cached": 3600000,                    "//": "Cache time rendered metrics (0 to disable)",
  "ratelimiter": null,                  "//": "Rate limiter (see express-rate-limit documentation)",
  "port": 3000,                         "//": "Listening port",
  "optimize": true,                     "//": "SVG optimization",
  "debug": false,                       "//": "Debug logs",
  "debug.headless": false,              "//": "Debug puppeteer process",
  "mocked": false,                      "//": "Use mocked data instead of live APIs (use 'force' to use mocked token even if real token are defined)",
  "repositories": 100,                  "//": "Number of repositories to use",
  "padding": ["0", "8 + 11%"],          "//": "Image padding (default)",
  "outputs": ["svg", "png", "json"],    "//": "Image output formats (empty to enable all)",
  "hosted": {
    "by": "",                           "//": "Web instance host (displayed in footer)",
    "link": "",                         "//": "Web instance host link (displayed in footer)"
  },
  "oauth":{
    "id": null,                         "//": "GitHub OAUTH client id",
    "secret": null,                     "//": "GitHub OAUTH client secret",
    "url":"https://example.com",        "//": "GitHub OAUTH callback url (must be the same as the web instance host)"
  },
  "api":{
    "rest": null,                       "//": "GitHub REST API custom endpoint",
    "graphql": null,                    "//": "GitHub GraphQL API custom endpoint"
  },
  "control":{
    "token": null,                      "//": "Control token (can be used by external services to perform actions on instance, such as stopping it for redeploys)"
  },
  "community": {
    "templates": [],                    "//": "Additional community templates to setup"
  },
  "templates": {
    "default": "classic",               "//": "Default template",
    "enabled": [],                      "//": "Enabled templates (empty to enable all)"
  },
  "extras": {
    "default": false,                   "//": "Default extras state (advised to let 'false' unless in debug mode)",
    "features": false,                  "//": "Enable extra features (advised to let 'false' on web instances), see below for supported features",
                                        "//": "________________________________________________________________________",
                                        "//": "metrics.setup.community.templates | Allow community templates download",
                                        "//": "metrics.setup.community.presets   | Allow community presets usage",
                                        "//": "metrics.api.github.overuse        | Allow GitHub API intensive requests",
                                        "//": "metrics.api.*                     | Allow use of external API requests",
                                        "//": "metrics.cpu.overuse               | Allow CPU intensive requests",
                                        "//": "metrics.run.tempdir               | Allow access to temporary directory (I/O operations may be performed)",
                                        "//": "metrics.run.git                   | Allow to run git",
                                        "//": "metrics.run.licensed              | Allow to run licensed",
                                        "//": "metrics.run.user.cmd              | Allow to run ANY command by user (USE WITH CAUTION!)",
                                        "//": "metrics.run.puppeteer.scrapping   | Allow to run puppeteer to scrape data",
                                        "//": "metrics.run.puppeteer.user.css    | Allow to run CSS by user during puppeteer render",
                                        "//": "metrics.run.puppeteer.user.js     | Allow to run JavaScript by user during puppeteer render",
                                        "//": "metrics.npm.optional.*            | Allow use of specified dependency",
                                        "//": "________________________________________________________________________",
                                        "//": "Additional extra features when user is logged with GitHub",
    "logged": [
      "metrics.api.github.overuse"
    ]
  },
  "plugins.default": false,             "//": "Default plugin state (advised to let 'false' unless in debug mode)",
  "plugins": {                          "//": "Global plugin configuration",
    <% for (const name of Object.keys(plugins).filter(v => !["base", "core"].includes(v))) { -%>
"<%= name %>":{
      <%- JSON.stringify(Object.fromEntries(Object.entries(plugins[name].inputs).filter(([key, {type}]) => (type === "token")&&(!key.includes("_"))).map(([key, {description:value}]) => [key.replace(new RegExp(`^plugin_${name}_`), ""), value.split("\n")[0].trim()])), null, 6).replace(/^[{]/gm, "").replace(/^\s*[}]$/gm, "").replace(/(?:([a-z0-9.]+)(?=[.]))(.*)": "/gm, (_, k, r) => `${k}${r}${'": null,'.padEnd(27 - (k.length ? k.length+1 : 0))} "//": "`).replace(/"$/gm, '",').trimStart().replace(/\n$/gm, "\n      ") %>"enabled": false,                 "//": "<%= plugins[name].inputs[`plugin_${name}`].description.trim() %>"
    },
    <% } %>"//": ""
  }
}
</file>

<file path="source/plugins/achievements/list/index.mjs">
//Exports
export { default as organization } from "./organizations.mjs"
export { default as user } from "./users.mjs"
</file>

<file path="source/plugins/achievements/list/organizations.mjs">
/**Achievements list for users accounts */
export default async function({list, login, data, computed, imports, graphql, queries, rest, rank, leaderboard}) {
  //Initialization
  const {organization} = await graphql(queries.achievements.organizations({login}))
  const scores = {followers: 0, created: organization.repositories.totalCount, stars: organization.popular.nodes?.[0]?.stargazers?.totalCount ?? 0, forks: Math.max(0, ...data.user.repositories.nodes.map(({forkCount}) => forkCount))}
  const ranks = await graphql(queries.achievements.ranking(scores))
  const requirements = {stars: 5, followers: 3, forks: 1, created: 1}

  //Developers
  {
    const value = organization.repositories.totalCount
    const unlock = organization.repositories.nodes?.shift()
    list.push({
      title: "Developers",
      text: `Published ${value} public repositor${imports.s(value, "y")}`,
      icon:
        '<g stroke-linecap="round" stroke-width="2" fill="none" fill-rule="evenodd"><g stroke="#primary"><path d="M20 24l-3.397 3.398a.85.85 0 000 1.203L20.002 32M37.015 24l3.399 3.398a.85.85 0 010 1.203L37.014 32" stroke-linejoin="round"/><path d="M31.029 21.044L25.976 35.06"/></g><path stroke="#secondary" stroke-linejoin="round" d="M23.018 10h8.984M26 47h5M8 16h16m9 0h15.725M8 41h13"/><path d="M5.027 34.998c.673 2.157 1.726 4.396 2.81 6.02m43.38-19.095C50.7 19.921 49.866 17.796 48.79 16" stroke="#secondary"/><path stroke="#primary" stroke-linejoin="round" d="M26 41h17"/><path d="M7.183 16C5.186 19.582 4 23.619 4 28M42.608 47.02c2.647-1.87 5.642-5.448 7.295-9.18C51.52 34.191 52.071 30.323 52 28" stroke="#primary"/><path stroke="#primary" stroke-linejoin="round" d="M7.226 16H28M13.343 47H21"/><path d="M13.337 47.01a24.364 24.364 0 006.19 3.45 24.527 24.527 0 007.217 1.505c2.145.108 4.672-.05 7.295-.738" stroke="#primary"/><path stroke="#primary" stroke-linejoin="round" d="M36 47h6.647M12 10h6M37 10h6.858"/><path d="M43.852 10c-4.003-3.667-9.984-6.054-16.047-6-2.367.021-4.658.347-6.81 1.045" stroke="#primary"/><path stroke="#secondary" stroke-linejoin="round" d="M5.041 35h4.962M47 22h4.191"/></g>',
      ...rank(value, [1, 50, 100, 200, 300]),
      value,
      unlock: new Date(unlock?.createdAt),
      leaderboard: leaderboard({user: ranks.created_rank.userCount, requirement: scores.created >= requirements.created, type: "users"}),
    })
  }

  //Forkers
  {
    const value = organization.forks.totalCount
    const unlock = organization.forks.nodes?.shift()
    list.push({
      title: "Forkers",
      text: `Forked ${value} public repositor${imports.s(value, "y")}`,
      icon:
        '<g stroke-width="2" fill="none" fill-rule="evenodd"><path d="M37.303 21.591a5.84 5.84 0 00-1.877-1.177 6.138 6.138 0 00-4.432 0 5.822 5.822 0 00-1.879 1.177L28 22.638l-1.115-1.047c-1.086-1.018-2.559-1.59-4.094-1.59-1.536 0-3.008.572-4.094 1.59-1.086 1.02-1.696 2.4-1.696 3.84 0 1.441.61 2.823 1.696 3.841l1.115 1.046L28 38l8.189-7.682 1.115-1.046a5.422 5.422 0 001.256-1.761 5.126 5.126 0 000-4.157 5.426 5.426 0 00-1.256-1.763z" stroke="#primary" stroke-linecap="round" stroke-linejoin="round"/><path d="M15.967 42.705A18.922 18.922 0 0028 47a18.92 18.92 0 0011.076-3.56m-.032-30.902A18.914 18.914 0 0028 9c-4.09 0-7.876 1.292-10.976 3.49" stroke="#secondary" stroke-linecap="round"/><g transform="translate(7 10)" stroke="#primary"><path d="M6 0v7c0 2.21-1.343 3-3 3s-3-.79-3-3V0" stroke-linecap="round" stroke-linejoin="round"/><path stroke-linecap="round" d="M3 0v19.675"/><rect stroke-linejoin="round" x="1" y="20" width="4" height="16" rx="2"/></g><g transform="translate(43 10)" stroke="#primary"><path stroke-linecap="round" d="M2 15.968v3.674"/><path d="M4 15.642H0L.014 4.045A4.05 4.05 0 014.028 0L4 15.642z" stroke-linecap="round" stroke-linejoin="round"/><rect stroke-linejoin="round" y="19.968" width="4" height="16" rx="2"/></g><path d="M41.364 8.062A23.888 23.888 0 0028 4a23.89 23.89 0 00-11.95 3.182M4.75 22.021A24.045 24.045 0 004 28c0 1.723.182 3.404.527 5.024m10.195 14.971A23.888 23.888 0 0028 52c4.893 0 9.444-1.464 13.239-3.979m9-10.98A23.932 23.932 0 0052 28c0-2.792-.477-5.472-1.353-7.964" stroke="#secondary" stroke-linecap="round"/></g>',
      ...rank(value, [1, 10, 30, 50, 100]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Managers
  {
    const value = organization.projects.totalCount
    const unlock = organization.projects.nodes?.shift()

    list.push({
      title: "Managers",
      text: `Created ${value} user project${imports.s(value)}`,
      icon:
        '<g stroke-width="2" fill="none" fill-rule="evenodd"><path d="M29 16V8.867C29 7.705 29.627 7 30.692 7h18.616C50.373 7 51 7.705 51 8.867v38.266C51 48.295 50.373 49 49.308 49H30.692C29.627 49 29 48.295 29 47.133V39m-4-23V9c0-1.253-.737-2-2-2H7c-1.263 0-2 .747-2 2v34c0 1.253.737 2 2 2h16c1.263 0 2-.747 2-2v-4" stroke="#secondary" stroke-linecap="round"/><path stroke="#secondary" d="M51.557 12.005h-22M5 12.005h21"/><path d="M14 33V22c0-1.246.649-2 1.73-2h28.54c1.081 0 1.73.754 1.73 2v11c0 1.246-.649 2-1.73 2H15.73c-1.081 0-1.73-.754-1.73-2z" stroke="#primary" stroke-linecap="round" stroke-linejoin="round"/><path d="M19 29v-3c0-.508.492-1 1-1h3c.508 0 1 .492 1 1v3c0 .508-.492 1-1 1h-3c-.508-.082-1-.492-1-1z" stroke="#primary"/><path stroke="#primary" stroke-linecap="round" stroke-linejoin="round" d="M28.996 27.998h12M9.065 20.04a7.062 7.062 0 00-.023 1.728m.775 2.517c.264.495.584.954.954 1.369"/></g>',
      ...rank(value, [1, 2, 4, 8, 10]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Packagers
  {
    const value = organization.packages.totalCount + ((await rest.packages.listPackagesForOrganization({package_type: "container", org: login}).catch(() => ({data: []})))?.data?.length || 0)
    const unlock = organization.packages.nodes?.shift()

    list.push({
      title: "Packagers",
      text: `Created ${value} package${imports.s(value)}`,
      icon:
        '<g fill="none"><path fill="#secondary" d="M28.53 27.64l-11.2 6.49V21.15l11.23-6.48z"/><path d="M40.4 34.84c-.17 0-.34-.04-.5-.13l-11.24-6.44a.99.99 0 01-.37-1.36.99.99 0 011.36-.37l11.24 6.44c.48.27.65.89.37 1.36-.17.32-.51.5-.86.5z" fill="#primary"/><path d="M29.16 28.4c-.56 0-1-.45-1-1.01l.08-12.47c0-.55.49-1 1.01-.99.55 0 1 .45.99 1.01l-.08 12.47c0 .55-.45.99-1 .99z" fill="#primary"/><path d="M18.25 34.65a.996.996 0 01-.5-1.86l10.91-6.25a.997.997 0 11.99 1.73l-10.91 6.25c-.15.09-.32.13-.49.13z" fill="#primary"/><path d="M29.19 41.37c-.17 0-.35-.04-.5-.13l-11.23-6.49c-.31-.18-.5-.51-.5-.87V20.91c0-.36.19-.69.5-.87l11.23-6.49c.31-.18.69-.18 1 0l11.23 6.49c.31.18.5.51.5.87v12.97c0 .36-.19.69-.5.87l-11.23 6.49c-.15.08-.32.13-.5.13zm-10.23-8.06l10.23 5.91 10.23-5.91V21.49l-10.23-5.91-10.23 5.91v11.82zM40.5 11.02c-1.75 0-3.18-1.43-3.18-3.18 0-1.75 1.43-3.18 3.18-3.18 1.75 0 3.18 1.43 3.18 3.18 0 1.75-1.43 3.18-3.18 3.18zm0-4.36c-.65 0-1.18.53-1.18 1.18 0 .65.53 1.18 1.18 1.18.65 0 1.18-.53 1.18-1.18 0-.65-.53-1.18-1.18-1.18zm-23.19 4.36c-1.75 0-3.18-1.43-3.18-3.18 0-1.75 1.43-3.18 3.18-3.18 1.75 0 3.18 1.43 3.18 3.18 0 1.75-1.42 3.18-3.18 3.18zm0-4.36c-.65 0-1.18.53-1.18 1.18 0 .65.53 1.18 1.18 1.18.65 0 1.18-.53 1.18-1.18 0-.65-.53-1.18-1.18-1.18zm23.37 43.8c-1.75 0-3.18-1.43-3.18-3.18 0-1.75 1.43-3.18 3.18-3.18 1.75 0 3.18 1.43 3.18 3.18 0 1.75-1.42 3.18-3.18 3.18zm0-4.35c-.65 0-1.18.53-1.18 1.18 0 .65.53 1.18 1.18 1.18.65 0 1.18-.53 1.18-1.18 0-.65-.53-1.18-1.18-1.18zm-23.06 4.11c-1.75 0-3.18-1.43-3.18-3.18 0-1.75 1.43-3.18 3.18-3.18 1.75 0 3.18 1.43 3.18 3.18 0 1.75-1.43 3.18-3.18 3.18zm0-4.36c-.65 0-1.18.53-1.18 1.18 0 .65.53 1.18 1.18 1.18.65 0 1.18-.53 1.18-1.18 0-.65-.53-1.18-1.18-1.18zM6.18 30.72C4.43 30.72 3 29.29 3 27.54c0-1.75 1.43-3.18 3.18-3.18 1.75 0 3.18 1.43 3.18 3.18 0 1.75-1.43 3.18-3.18 3.18zm0-4.36c-.65 0-1.18.53-1.18 1.18 0 .65.53 1.18 1.18 1.18.65 0 1.18-.53 1.18-1.18 0-.65-.53-1.18-1.18-1.18zm45.64 4.36c-1.75 0-3.18-1.43-3.18-3.18 0-1.75 1.43-3.18 3.18-3.18 1.75 0 3.18 1.43 3.18 3.18 0 1.75-1.43 3.18-3.18 3.18zm0-4.36c-.65 0-1.18.53-1.18 1.18 0 .65.53 1.18 1.18 1.18.65 0 1.18-.53 1.18-1.18 0-.65-.53-1.18-1.18-1.18z" fill="#primary"/><path d="M29.1 10.21c-.55 0-1-.45-1-1V3.52c0-.55.45-1 1-1s1 .45 1 1v5.69c0 .56-.45 1-1 1zM7.44 20.95c-.73 0-1.32-.59-1.32-1.32v-5.38l4.66-2.69c.63-.37 1.44-.15 1.8.48.36.63.15 1.44-.48 1.8l-3.34 1.93v3.86c0 .73-.59 1.32-1.32 1.32zm4 22.68c-.22 0-.45-.06-.66-.18l-4.66-2.69v-5.38c0-.73.59-1.32 1.32-1.32.73 0 1.32.59 1.32 1.32v3.86l3.34 1.93c.63.36.85 1.17.48 1.8-.24.42-.68.66-1.14.66zm17.64 10.39l-4.66-2.69c-.63-.36-.85-1.17-.48-1.8.36-.63 1.17-.85 1.8-.48l3.34 1.93 3.34-1.93a1.32 1.32 0 011.8.48c.36.63.15 1.44-.48 1.8l-4.66 2.69zm17.64-10.39a1.32 1.32 0 01-.66-2.46l3.34-1.93v-3.86c0-.73.59-1.32 1.32-1.32.73 0 1.32.59 1.32 1.32v5.38l-4.66 2.69c-.21.12-.44.18-.66.18zm4-22.68c-.73 0-1.32-.59-1.32-1.32v-3.86l-3.34-1.93c-.63-.36-.85-1.17-.48-1.8.36-.63 1.17-.85 1.8-.48l4.66 2.69v5.38c0 .73-.59 1.32-1.32 1.32z" fill="#secondary"/><path d="M33.08 6.15c-.22 0-.45-.06-.66-.18l-3.34-1.93-3.34 1.93c-.63.36-1.44.15-1.8-.48a1.32 1.32 0 01.48-1.8L29.08 1l4.66 2.69c.63.36.85 1.17.48 1.8a1.3 1.3 0 01-1.14.66zm-3.99 47.3c-.55 0-1-.45-1-1v-7.13c0-.55.45-1 1-1s1 .45 1 1v7.13c0 .55-.44 1-1 1zM13.86 19.71c-.17 0-.34-.04-.5-.13L7.2 16a1 1 0 011-1.73l6.17 3.58c.48.28.64.89.36 1.37-.19.31-.52.49-.87.49zm36.63 21.23c-.17 0-.34-.04-.5-.13l-6.17-3.57a.998.998 0 01-.36-1.37c.28-.48.89-.64 1.37-.36L51 39.08c.48.28.64.89.36 1.37-.19.31-.52.49-.87.49zM44.06 19.8c-.35 0-.68-.18-.87-.5-.28-.48-.11-1.09.36-1.37l6.17-3.57c.48-.28 1.09-.11 1.37.36.28.48.11 1.09-.36 1.37l-6.17 3.57c-.16.1-.33.14-.5.14zM7.43 41.03c-.35 0-.68-.18-.87-.5-.28-.48-.11-1.09.36-1.37l6.17-3.57c.48-.28 1.09-.11 1.37.36.28.48.11 1.09-.36 1.37l-6.17 3.57c-.15.09-.33.14-.5.14z" fill="#secondary"/></g>',
      ...rank(value, [1, 20, 50, 100, 250]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Maintainers
  {
    const value = organization.popular.nodes?.shift()?.stargazers?.totalCount ?? 0
    const unlock = null

    list.push({
      title: "Maintainers",
      text: `Maintaining a repository with ${value} star${imports.s(value)}`,
      icon:
        '<g transform="translate(4 4)" fill="none" fill-rule="evenodd"><path d="M39 15h.96l4.038 3-.02-3H45a2 2 0 002-2V3a2 2 0 00-2-2H31a2 2 0 00-2 2v4.035" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M36 5.014l-3 3 3 3M40 5.014l3 3-3 3"/><path d="M6 37a1 1 0 110 2 1 1 0 010-2m7 0a1 1 0 110 2 1 1 0 010-2m-2.448 1a1 1 0 11-2 0 1 1 0 012 0z" fill="#primary"/><path d="M1.724 15.05A23.934 23.934 0 000 24c0 .686.029 1.366.085 2.037m19.92 21.632c1.3.218 2.634.331 3.995.331a23.92 23.92 0 009.036-1.76m13.207-13.21A23.932 23.932 0 0048 24c0-1.363-.114-2.7-.332-4M25.064.022a23.932 23.932 0 00-10.073 1.725" stroke="#secondary" stroke-width="2" stroke-linecap="round"/><path d="M19 42.062V43a2 2 0 01-2 2H9.04l-4.038 3 .02-3H3a2 2 0 01-2-2V33a2 2 0 012-2h4.045" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M6 0a6 6 0 110 12A6 6 0 016 0z" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path stroke="#primary" stroke-width="2" stroke-linecap="round" d="M6 3v6M3 6h6"/><path d="M42 36a6 6 0 110 12 6 6 0 010-12z" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M44.338 40.663l-3.336 3.331-1.692-1.686M31 31c-.716-2.865-3.578-5-7-5-3.423 0-6.287 2.14-7 5"/><path d="M24 16a5 5 0 110 10 5 5 0 010-10z" stroke="#primary" stroke-width="2" stroke-linecap="round"/><circle stroke="#primary" stroke-width="2" cx="24" cy="24" r="14"/></g>',
      ...rank(value, [1, 5000, 10000, 30000, 50000]),
      value,
      unlock: new Date(unlock?.createdAt),
      leaderboard: leaderboard({user: ranks.repo_rank.repositoryCount, requirement: scores.stars >= requirements.stars, type: "repositories"}),
    })
  }

  //Inspirers
  {
    const value = Math.max(0, ...data.user.repositories.nodes.map(({forkCount}) => forkCount))
    const unlock = null
    list.push({
      title: "Inspirers",
      text: `Maintaining or created a repository which has been forked ${value} time${imports.s(value)}`,
      icon:
        '<g transform="translate(4 4)" fill="none" fill-rule="evenodd"><path d="M20.065 47.122c.44-.525.58-1.448.58-1.889 0-2.204-1.483-3.967-3.633-4.187.447-1.537.58-2.64.397-3.31-.25-.92-.745-1.646-1.409-2.235m-5.97-7.157c.371-.254.911-.748 1.62-1.48a8.662 8.662 0 001.432-2.366M47 22h-7c-1.538 0-2.749-.357-4-1h-5c-1.789.001-3-1.3-3-2.955 0-1.656 1.211-3.04 3-3.045h2c.027-1.129.513-2.17 1-3m3.082 32.004C34.545 43.028 34.02 40.569 34 39v-1h-1c-2.603-.318-5-2.913-5-5.997S30.397 26 33 26h9c2.384 0 4.326 1.024 5.27 3" stroke="#secondary" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/><g transform="translate(36)" stroke="#primary" stroke-width="2"><path fill="#primary" stroke-linecap="round" stroke-linejoin="round" d="M5.395 5.352L6.009 4l.598 1.348L8 5.408l-1.067 1.12.425 1.47-1.356-.908-1.35.91.404-1.469L4 5.41z"/><circle cx="6" cy="6" r="6"/></g><g transform="translate(0 31)" stroke="#primary" stroke-width="2"><circle cx="6" cy="6" r="6"/><g stroke-linecap="round"><path d="M6 4v4M4 6h4"/></g></g><circle stroke="#primary" stroke-width="2" cx="10.5" cy="10.5" r="10.5"/><g stroke-linecap="round"><path d="M32.01 1.37A23.96 23.96 0 0024 0c-.999 0-1.983.061-2.95.18M.32 20.072a24.21 24.21 0 00.015 7.948M12.42 45.025A23.892 23.892 0 0024 48c13.255 0 24-10.745 24-24 0-2.811-.483-5.51-1.371-8.016" stroke="#secondary" stroke-width="2"/><path stroke="#primary" stroke-width="2" d="M8.999 7.151v5.865"/><path d="M9 3a2 2 0 110 4 2 2 0 010-4zm0 10.8a2 2 0 11-.001 4 2 2 0 01.001-4z" stroke="#primary" stroke-width="1.8"/><path d="M9.622 11.838c.138-.007.989.119 1.595-.05.607-.169 1.584-.539 1.829-1.337" stroke="#primary" stroke-width="2"/><path d="M14.8 7.202a2 2 0 110 4 2 2 0 010-4z" stroke="#primary" stroke-width="1.8"/></g></g>',
      ...rank(value, [1, 500, 1000, 3000, 5000]),
      value,
      unlock: new Date(unlock?.createdAt),
      leaderboard: leaderboard({user: ranks.forks_rank.repositoryCount, requirement: scores.forks >= requirements.forks, type: "repositories"}),
    })
  }

  //Polyglots
  {
    const value = new Set(data.user.repositories.nodes.flatMap(repository => repository.languages.edges.map(({node: {name}}) => name))).size
    const unlock = null

    list.push({
      title: "Polyglots",
      text: `Using ${value} different programming language${imports.s(value)}`,
      icon:
        '<g stroke-linecap="round" stroke-width="2" fill="none" fill-rule="evenodd"><path d="M17.135 7.988l-3.303.669a2 2 0 00-1.586 2.223l4.708 35.392a1.498 1.498 0 01-1.162 1.66 1.523 1.523 0 01-1.775-1.01L4.951 19.497a2 2 0 011.215-2.507l2.946-1.072" stroke="#secondary" stroke-linejoin="round"/><path d="M36.8 48H23a2 2 0 01-2-2V7a2 2 0 012-2h26a2 2 0 012 2v32.766" stroke="#primary"/><path d="M29 20.955l-3.399 3.399a.85.85 0 000 1.202l3.399 3.4M43.014 20.955l3.399 3.399a.85.85 0 010 1.202l-3.4 3.4" stroke="#primary" stroke-linejoin="round"/><path stroke="#primary" d="M38.526 18l-5.053 14.016"/><path d="M44 36a8 8 0 110 16 8 8 0 010-16z" stroke="#primary" stroke-linejoin="round"/><path d="M43.068 40.749l3.846 2.396a1 1 0 01-.006 1.7l-3.846 2.36a1 1 0 01-1.523-.853v-4.755a1 1 0 011.529-.848z" stroke="#primary" stroke-linejoin="round"/></g>',
      ...rank(value, [1, 8, 16, 32, 64]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Sponsors
  {
    const value = organization.sponsorshipsAsSponsor.totalCount
    const unlock = null

    list.push({
      title: "Sponsors",
      text: `Sponsoring ${value} user${imports.s(value)} or organization${imports.s(value)}`,
      icon:
        '<g xmlns="http://www.w3.org/2000/svg" fill="none" fill-rule="evenodd"><path d="M24 32c.267-1.727 1.973-3 4-3 2.08 0 3.787 1.318 4 3m-4-9a3 3 0 110 6 3 3 0 010-6z" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M28 18c5.523 0 10 4.477 10 10s-4.477 10-10 10-10-4.477-10-10 4.477-10 10-10z" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M46.138 15c-1.033 0-1.454.822-1.634 1.413-.019.06-.024.06-.042 0-.182-.591-.707-1.413-1.655-1.413C41.347 15 41 16.117 41 17.005c0 1.676 2.223 3.228 3.091 3.845.272.197.556.194.817 0 .798-.593 3.092-2.17 3.092-3.845 0-.888-.261-2.005-1.862-2.005zm-31-5c-1.033 0-1.454.822-1.634 1.413-.019.06-.024.06-.042 0-.182-.591-.707-1.413-1.655-1.413C10.347 10 10 11.117 10 12.005c0 1.676 2.223 3.228 3.091 3.845.272.197.556.194.817 0 .798-.593 3.092-2.17 3.092-3.845 0-.888-.261-2.005-1.862-2.005zm6 32c-1.033 0-1.454.822-1.634 1.413-.019.06-.024.06-.042 0-.182-.591-.707-1.413-1.655-1.413C16.347 42 16 43.117 16 44.005c0 1.676 2.223 3.228 3.091 3.845.272.197.556.194.817 0 .798-.593 3.092-2.17 3.092-3.845 0-.888-.261-2.005-1.862-2.005z" fill="#secondary"/><path d="M8.003 29a3 3 0 110 6 3 3 0 010-6zM32.018 5.005a3 3 0 110 6 3 3 0 010-6z" stroke="#secondary" stroke-width="2" stroke-linecap="round"/><path stroke="#secondary" stroke-width="2" d="M29.972 18.026L31.361 11M18.063 29.987l-7.004 1.401"/><path d="M22.604 11.886l.746 2.164m-9.313 9.296l-2.156-.712" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M21.304 9a1 1 0 100-2 1 1 0 000 2zM8.076 22.346a1 1 0 100-2 1 1 0 000 2z" fill="#primary"/><path d="M33.267 44.17l-.722-2.146m9.38-9.206l2.147.743" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M34.544 49.031a1 1 0 100-2 1 1 0 000 2zm13.314-13.032a1 1 0 100-2 1 1 0 000 2z" fill="#primary"/><path d="M48.019 51.004a3 3 0 100-6 3 3 0 000 6zM35.194 35.33l10.812 11.019" stroke="#secondary" stroke-width="2"/></g>',
      ...rank(value, [1, 5, 10, 20, 50]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Organization
  {
    const value = organization.membersWithRole.totalCount
    const unlock = null

    list.push({
      title: "Organization",
      text: `Has ${value} member${imports.s(value)}`,
      icon:
        '<g xmlns="http://www.w3.org/2000/svg" fill="none" fill-rule="evenodd"><path d="M6 42c.45-3.415 3.34-6 7-6 1.874 0 3.752.956 5 3m-6-13a5 5 0 110 10 5 5 0 010-10zm38 16c-.452-3.415-3.34-6-7-6-1.874 0-3.752.956-5 3m6-13a5 5 0 100 10 5 5 0 000-10z" stroke="#primary" stroke-width="2" stroke-linecap="round"/><path d="M37 51c-.92-4.01-4.6-7-9-7-4.401 0-8.083 2.995-9 7" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M28.01 31.004a6.5 6.5 0 110 13 6.5 6.5 0 010-13z" stroke="#secondary" stroke-width="2" stroke-linecap="round"/><path d="M28 14.011a5 5 0 11-5 4.998 5 5 0 015-4.998z" stroke="#primary" stroke-width="2" stroke-linecap="round"/><path d="M22 26c1.558-1.25 3.665-2 6-2 2.319 0 4.439.761 6 2" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M51 9V8c0-1.3-1.574-3-3-3h-8c-1.426 0-3 1.7-3 3v13l4-4h6c2.805-.031 4-1.826 4-4V9zM5 9V8c0-1.3 1.574-3 3-3h8c1.426 0 3 1.7 3 3v13l-4-4H9c-2.805-.031-4-1.826-4-4V9z" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M43 11a1 1 0 11-2 0 1 1 0 012 0zm4 0a1 1 0 11-2 0 1 1 0 012 0zm-36 0a1 1 0 11-2 0 1 1 0 012 0zm4 0a1 1 0 11-2 0 1 1 0 012 0z" fill="#secondary"/></g>',
      ...rank(value, [1, 100, 500, 1000, 2500]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Member
  {
    const {years: value} = computed.registered
    const unlock = null

    list.push({
      title: "Member",
      text: `Registered ${Math.floor(value)} year${imports.s(Math.floor(value))} ago`,
      icon:
        '<g xmlns="http://www.w3.org/2000/svg" transform="translate(5 4)" fill="none" fill-rule="evenodd"><path d="M46 44.557v1a2 2 0 01-2 2H2a2 2 0 01-2-2v-1" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M.75 40.993l.701.561a2.323 2.323 0 002.903 0l1.675-1.34a3 3 0 013.748 0l1.282 1.026a3 3 0 003.71.03l1.4-1.085a3 3 0 013.75.061l1.103.913a3 3 0 003.787.031l1.22-.976a3 3 0 013.748 0l1.282 1.026a3 3 0 003.71.03l1.4-1.085a3 3 0 013.75.061l1.429 1.182a2.427 2.427 0 003.103-.008l.832-.695A2 2 0 0046 39.191v-1.634a2 2 0 00-2-2H2a2 2 0 00-2 2v1.875a2 2 0 00.75 1.561z" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M42 31.609v.948m-38 0v-.992m25.04-15.008H35a2 2 0 012 2v1m-28 0v-1a2 2 0 012-2h6.007" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 8.557h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6a1 1 0 011-1z" stroke="#primary" stroke-width="2" stroke-linejoin="round"/><path d="M4.7 10.557c.316 1.122.572 1.372 1.71 1.678-1.136.314-1.39.566-1.7 1.69-.317-1.121-.573-1.372-1.71-1.679 1.135-.313 1.389-.566 1.7-1.689zm35-8c.316 1.122.572 1.372 1.71 1.678-1.136.314-1.39.566-1.7 1.69-.317-1.121-.573-1.372-1.71-1.679 1.135-.313 1.389-.566 1.7-1.689z" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M23 5.557a2 2 0 002-2C25 2.452 24.433 0 22.273 0c-.463 0 .21 1.424-.502 1.979A2 2 0 0023 5.557z" stroke="#primary" stroke-width="2"/><path d="M4.78 27.982l1.346 1.076a3 3 0 003.748 0l1.252-1.002a3 3 0 013.748 0l1.282 1.026a3 3 0 003.711.03l1.4-1.085a3 3 0 013.75.061l1.102.913a3 3 0 003.787.031l1.22-.976a3 3 0 013.748 0l1.281 1.025a3 3 0 003.712.029l1.358-1.053a2 2 0 00.775-1.58v-.97a1.95 1.95 0 00-1.95-1.95H5.942a1.912 1.912 0 00-1.912 1.912v.951a2 2 0 00.75 1.562z" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle stroke="#secondary" cx="16.5" cy="2.057" r="1"/><circle stroke="#secondary" cx="14.5" cy="12.057" r="1"/><circle stroke="#secondary" cx="31.5" cy="9.057" r="1"/></g>',
      ...rank(value, [1, 3, 5, 10, 15]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }
}
</file>

<file path="source/plugins/achievements/queries/metrics.graphql">
query AchievementsMetrics {
 	repository(owner: "lowlighter", name: "metrics") {
    viewerHasStarred
  }
  viewer {
    login
  }
}
</file>

<file path="source/plugins/achievements/queries/octocat.graphql">
query AchievementsOctocat {
  user(login: "octocat") {
    viewerIsFollowing
  }
  viewer {
    login
  }
}
</file>

<file path="source/plugins/achievements/queries/organizations.graphql">
query AchievementsOrganizations {
  organization(login: "$login") {
    repositories(first: 1, privacy: PUBLIC, affiliations: OWNER, orderBy: {field: CREATED_AT, direction: ASC}) {
      nodes {
        createdAt
        nameWithOwner
      }
      totalCount
    }
    forks:repositories(first: 1, privacy: PUBLIC, isFork: true, orderBy: {field: CREATED_AT, direction: ASC}) {
      nodes {
        createdAt
        nameWithOwner
      }
      totalCount
    }
    popular:repositories(first:1, orderBy: {field: STARGAZERS, direction: DESC}) {
      nodes {
        stargazers {
          totalCount
        }
      }
    }
    projects(first: 1, orderBy: {field: CREATED_AT, direction: ASC}) {
      totalCount
    }
    packages(first: 1, orderBy: {direction: ASC, field: CREATED_AT}) {
      totalCount
    }
    membersWithRole {
      totalCount
    }
    sponsorshipsAsSponsor {
      totalCount
    }
  }
}
</file>

<file path="source/plugins/achievements/queries/ranking.graphql">
query AchievementsRanking {
  repo_rank:search(query: "stars:>$stars", type: REPOSITORY, first: 0) {
    repositoryCount
  }
  user_rank:search(query: "followers:>$followers", type: USER, first: 0) {
    userCount
  }
  forks_rank:search(query: "forks:>$forks", type: REPOSITORY, first: 0) {
    repositoryCount
  }
  created_rank:search(query: "repos:>$created", type: USER, first: 0) {
    userCount
  }
}
</file>

<file path="source/plugins/achievements/examples.yml">
- name: Detailed display
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.achievements.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_achievements: yes
    plugin_achievements_only: sponsor, maintainer, octonaut
  test:
    timeout: 1800000

- name: Compact display
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.achievements.compact.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_achievements: yes
    plugin_achievements_only: polyglot, stargazer, sponsor, deployer, member, maintainer, developer, scripter, packager, explorer, infographile, manager
    plugin_achievements_display: compact
    plugin_achievements_threshold: X
  test:
    timeout: 1800000
</file>

<file path="source/plugins/achievements/metadata.yml">
name: üèÜ Achievements
category: github
description: |
  This plugin displays several highlights about what an account has achieved on GitHub.
examples:
  +compact display: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.achievements.compact.svg
  detailed display: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.achievements.svg
index: 19
supports:
  - user
  - organization
scopes:
  - public_access
inputs:

  plugin_achievements:
    description: |
      Enable achievements plugin
    type: boolean
    default: no
    extras:
      - metrics.run.puppeteer.scrapping

  plugin_achievements_threshold:
    description: |
      Rank threshold filter

      Use `X` to display achievements not yet unlocked
    type: string
    default: C
    values:
      - S
      - A
      - B
      - C
      - X

  plugin_achievements_secrets:
    description: |
      Secrets achievements
    type: boolean
    default: yes

  plugin_achievements_display:
    description: |
      Display style

      - `detailed`: display icon, name, description and ranking
      - `compact`: display icon, name and value
    type: string
    default: detailed
    values:
      - detailed
      - compact

  plugin_achievements_limit:
    description: |
      Display limit
    type: number
    default: 0
    min: 0
    zero: disable

  plugin_achievements_ignored:
    description: |
      Ignored achievements

      Use achievements names without their rank adjective (i.e. without "great", "super" or "master")
    type: array
    format: comma-separated
    default: ""
    example: octonaut, automator, explorer

  plugin_achievements_only:
    description: |
      Showcased achievements

      Use achievements names without their rank adjective (i.e. without "great", "super" or "master")

      This option is equivalent to [`plugin_achievements_ignored`](/source/plugins/achievements/README.md#plugin_achievements_ignored) with all existing achievements except the ones listed in this option
    type: array
    format: comma-separated
    default: ""
    example: octonaut, automator, explorer
</file>

<file path="source/plugins/activity/examples.yml">
- name: Recent activity
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.activity.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_activity: yes
    plugin_activity_limit: 5
    plugin_activity_days: 0
    plugin_activity_filter: issue, pr, release, fork, review, ref/create
</file>

<file path="source/plugins/activity/index.mjs">
//Setup
export default async function({login, data, rest, q, account, imports}, {enabled = false, markdown = "inline", extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.activity) || (!imports.metadata.plugins.activity.enabled(enabled, {extras})))
      return null

    //Context
    let context = {mode: "user"}
    if (q.repo) {
      console.debug(`metrics/compute/${login}/plugins > activity > switched to repository mode`)
      const {owner, repo} = data.user.repositories.nodes.map(({name: repo, owner: {login: owner}}) => ({repo, owner})).shift()
      context = {...context, mode: "repository", owner, repo}
    }

    //Load inputs
    let {limit, load, days, filter, visibility, timestamps, skipped, ignored} = imports.metadata.plugins.activity.inputs({data, q, account})
    if (!days)
      days = Infinity
    skipped.push(...data.shared["repositories.skipped"])
    ignored.push(...data.shared["users.ignored"])
    const pages = Math.ceil(load / 100)
    const codelines = 2

    //Get user recent activity
    console.debug(`metrics/compute/${login}/plugins > activity > querying api`)
    const events = []
    try {
      for (let page = 1; page <= pages; page++) {
        console.debug(`metrics/compute/${login}/plugins > activity > loading page ${page}/${pages}`)
        events.push(...(context.mode === "repository" ? await rest.activity.listRepoEvents({owner: context.owner, repo: context.repo}) : await rest.activity.listEventsForAuthenticatedUser({username: login, per_page: 100, page})).data)
      }
    }
    catch {
      console.debug(`metrics/compute/${login}/plugins > activity > no more page to load`)
    }
    console.debug(`metrics/compute/${login}/plugins > activity > ${events.length} events loaded`)

    //Extract activity events
    const activity = (await Promise.all(
      events
        .filter(({actor}) => account === "organization" ? true : actor.login?.toLocaleLowerCase() === login.toLocaleLowerCase())
        .filter(({created_at}) => Number.isFinite(days) ? new Date(created_at) > new Date(Date.now() - days * 24 * 60 * 60 * 1000) : true)
        .filter(event => visibility === "public" ? event.public : true)
        .map(async ({type, payload, actor: {login: actor}, repo: {name: repo}, created_at}) => {
          //See https://docs.github.com/en/free-pro-team@latest/developers/webhooks-and-events/github-event-types
          const timestamp = new Date(created_at)
          if (!imports.filters.repo(repo, skipped))
            return null
          switch (type) {
            //Commented on a commit
            case "CommitCommentEvent": {
              if (!["created"].includes(payload.action))
                return null
              const {comment: {user: {login: user}, commit_id: sha, body: content}} = payload
              if (!imports.filters.text(user, ignored))
                return null
              return {type: "comment", on: "commit", actor, timestamp, repo, content: await imports.markdown(content, {mode: markdown, codelines}), user, mobile: null, number: sha.substring(0, 7), title: ""}
            }
            //Created a git branch or tag
            case "CreateEvent": {
              const {ref: name, ref_type: type} = payload
              return {type: "ref/create", actor, timestamp, repo, ref: {name, type}}
            }
            //Deleted a git branch or tag
            case "DeleteEvent": {
              const {ref: name, ref_type: type} = payload
              return {type: "ref/delete", actor, timestamp, repo, ref: {name, type}}
            }
            //Forked repository
            case "ForkEvent": {
              const {forkee: {full_name: forked}} = payload
              return {type: "fork", actor, timestamp, repo, forked}
            }
            //Wiki changes
            case "GollumEvent": {
              const {pages} = payload
              return {type: "wiki", actor, timestamp, repo, pages: pages.map(({title}) => title)}
            }
            //Commented on an issue
            case "IssueCommentEvent": {
              if (!["created"].includes(payload.action))
                return null
              const {issue: {user: {login: user}, title, number}, comment: {body: content, performed_via_github_app: mobile}} = payload
              if (!imports.filters.text(user, ignored))
                return null
              return {type: "comment", on: "issue", actor, timestamp, repo, content: await imports.markdown(content, {mode: markdown, codelines}), user, mobile, number, title}
            }
            //Issue event
            case "IssuesEvent": {
              if (!["opened", "closed", "reopened"].includes(payload.action))
                return null
              const {action, issue: {user: {login: user}, title, number, body: content}} = payload
              if (!imports.filters.text(user, ignored))
                return null
              return {type: "issue", actor, timestamp, repo, action, user, number, title, content: await imports.markdown(content, {mode: markdown, codelines})}
            }
            //Activity from repository collaborators
            case "MemberEvent": {
              if (!["added"].includes(payload.action))
                return null
              const {member: {login: user}} = payload
              if (!imports.filters.text(user, ignored))
                return null
              return {type: "member", actor, timestamp, repo, user}
            }
            //Made repository public
            case "PublicEvent": {
              return {type: "public", actor, timestamp, repo}
            }
            //Pull requests events
            case "PullRequestEvent": {
              if (!["opened", "closed"].includes(payload.action))
                return null
              const {action, pull_request: {user: {login: user}, title, number, body: content, additions: added, deletions: deleted, changed_files: changed, merged}} = payload
              if (!imports.filters.text(user, ignored))
                return null
              return {type: "pr", actor, timestamp, repo, action: (action === "closed") && (merged) ? "merged" : action, user, title, number, content: await imports.markdown(content, {mode: markdown, codelines}), lines: {added, deleted}, files: {changed}}
            }
            //Reviewed a pull request
            case "PullRequestReviewEvent": {
              const {review: {state: review}, pull_request: {user: {login: user}, number, title}} = payload
              if (!imports.filters.text(user, ignored))
                return null
              return {type: "review", actor, timestamp, repo, review, user, number, title}
            }
            //Commented on a pull request
            case "PullRequestReviewCommentEvent": {
              if (!["created"].includes(payload.action))
                return null
              const {pull_request: {user: {login: user}, title, number}, comment: {body: content, performed_via_github_app: mobile}} = payload
              if (!imports.filters.text(user, ignored))
                return null
              return {type: "comment", on: "pr", actor, timestamp, repo, content: await imports.markdown(content, {mode: markdown, codelines}), user, mobile, number, title}
            }
            //Pushed commits
            case "PushEvent": {
              let {size, commits, ref} = payload
              commits = commits.filter(({author: {email}}) => imports.filters.text(email, ignored))
              if (!commits.length)
                return null
              if (commits.slice(-1).pop()?.message.startsWith("Merge branch "))
                commits = commits.slice(-1)
              return {type: "push", actor, timestamp, repo, size, branch: ref.match(/refs.heads.(?<branch>.*)/)?.groups?.branch ?? null, commits: commits.reverse().map(({sha, message}) => ({sha: sha.substring(0, 7), message}))}
            }
            //Released
            case "ReleaseEvent": {
              if (!["published"].includes(payload.action))
                return null
              const {action, release: {name, tag_name, prerelease, draft, body: content}} = payload
              return {type: "release", actor, timestamp, repo, action, name: name || tag_name, prerelease, draft, content: await imports.markdown(content, {mode: markdown, codelines})}
            }
            //Starred a repository
            case "WatchEvent": {
              if (!["started"].includes(payload.action))
                return null
              const {action} = payload
              return {type: "star", actor, timestamp, repo, action}
            }
            //Unknown event
            default: {
              return null
            }
          }
        }),
    ))
      .filter(event => event)
      .filter(event => filter.includes("all") || filter.includes(event.type))
      .slice(0, limit)

    //Results
    return {timestamps, events: activity}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/activity/metadata.yml">
name: üì∞ Recent activity
category: github
description: |
  This plugin displays recent activity on GitHub.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.activity.svg
index: 21
supports:
  - user
  - organization
  - repository
scopes:
  - public_access
inputs:

  plugin_activity:
    description: |
      Enable activity plugin
    type: boolean
    default: no

  plugin_activity_limit:
    description: |
      Display limit
    type: number
    default: 5
    min: 1
    max: 1000

  plugin_activity_load:
    description: |
      Events to load
    type: number
    default: 300
    min: 100
    max: 1000

  plugin_activity_days:
    description: |
      Events maximum age
    type: number
    default: 14
    min: 0
    max: 365
    zero: disable

  plugin_activity_visibility:
    description: |
      Events visibility

      Can be used to toggle private activity visibility when using a token with `repo` scope
    type: string
    default: all
    values:
      - public
      - all

  plugin_activity_timestamps:
    description: |
      Events timestamps
    type: boolean
    default: no

  plugin_activity_skipped:
    description: |
      Skipped repositories
    type: array
    format: 
      - newline-separated
      - comma-separated
    default: ""
    example: my-repo-1, my-repo-2, owner/repo-3, ...
    inherits: repositories_skipped

  plugin_activity_ignored:
    description: |
      Ignored users

      Can be used to ignore bots activity
    type: array
    format: comma-separated
    default: ""
    example: user1, user2, ...
    inherits: users_ignored

  plugin_activity_filter:
    description: |
      Events types

      These are fetched from [GitHub events API](https://docs.github.com/en/free-pro-team@latest/developers/webhooks-and-events/github-event-types) and the following types are currently supported:
      - `push`: Push of commits
      - `issue`: Opening/Reopening/Closing of issues
      - `pr`: Opening/Closing of pull requests
      - `ref/create`: Creation of git tags or git branches
      - `ref/delete`: Deletion of git tags or git branches
      - `release`: Publication of new releases
      - `review`: Review of pull requests
      - `comment`: Comments on commits, issues and pull requests
      - `wiki`: Changes of wiki pages
      - `fork`: Forking of repositories
      - `star`: Starring of repositories
      - `public`: Repositories made public
      - `member`: Addition of new collaborator in repository
    type: array
    format: comma-separated
    default: all
    example: issue, pr, review, wiki, star
    values:
      - all
      - comment
      - ref/create
      - ref/delete
      - release
      - push
      - issue
      - pr
      - review
      - wiki
      - fork
      - star
      - member
      - public
</file>

<file path="source/plugins/anilist/queries/characters.graphql">
query FavoritesCharacters ($name: String, $page:Int) {
  User(name: $name) {
    favourites {
      characters(page: $page) {
        nodes {
          name {
            full
            native
          }
          image {
            medium
          }
        }
        pageInfo {
          currentPage
          hasNextPage
        }
      }
    }
  }
}
</file>

<file path="source/plugins/anilist/queries/favorites.graphql">
query Favorites ($name: String, $page:Int) {
  User(name: $name) {
    favourites {
      $type(page: $page) {
        nodes {
          title {
            romaji
            english
            native
          }
          description
          type
          status(version: 2)
          episodes
          volumes
          chapters
          averageScore
          countryOfOrigin
          genres
          coverImage {
            medium
          }
          startDate {
            year
          }
        }
        pageInfo {
          currentPage
          hasNextPage
        }
      }
    }
  }
}
</file>

<file path="source/plugins/anilist/queries/medias.graphql">
query Medias ($name: String, $type: MediaType) {
  MediaListCollection(userName: $name, type: $type) {
    lists {
      name
      isCustomList
      entries {
        ...mediaListEntry
      }
    }
  }
}

fragment mediaListEntry on MediaList {
  status
  progress
  progressVolumes
  score
  startedAt {
    year
    month
    day
  }
  completedAt {
    year
    month
    day
  }
  media {
    title {
      romaji
      english
      native
    }
    description
    type
    status(version: 2)
    episodes
    volumes
    chapters
    averageScore
    countryOfOrigin
    genres
    coverImage {
      medium
    }
    startDate {
      year
    }
  }
}
</file>

<file path="source/plugins/anilist/queries/statistics.graphql">
query Statistics ($name: String) {
  User(name: $name) {
    id
    name
    about
   	statistics {
      anime {
        count
        minutesWatched
        episodesWatched
        genres(limit: 4) {
          genre
        }
      }
      manga {
        count
        chaptersRead
        volumesRead
        genres(limit: 4) {
          genre
        }
      }
    }
  }
}
</file>

<file path="source/plugins/anilist/examples.yml">
- name: Favorites anime and currently watching
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.anilist.svg
    token: NOT_NEEDED
    base: ""
    plugin_anilist: yes
    plugin_anilist_medias: anime
    plugin_anilist_sections: favorites, watching
    plugin_anilist_limit: 1

- name: Favorites manga and currently reading
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.anilist.manga.svg
    token: NOT_NEEDED
    base: ""
    plugin_anilist: yes
    plugin_anilist_medias: manga
    plugin_anilist_sections: favorites, reading
    plugin_anilist_limit: 1

- name: Favorites characters
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.anilist.characters.svg
    token: NOT_NEEDED
    base: ""
    plugin_anilist: yes
    plugin_anilist_sections: characters
    plugin_anilist_limit_characters: 22
</file>

<file path="source/plugins/anilist/index.mjs">
//Setup
export default async function({login, data, queries, imports, q, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.anilist) || (!imports.metadata.plugins.anilist.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {limit, "limit.characters": limit_characters, medias, sections, shuffle, user} = imports.metadata.plugins.anilist.inputs({data, account, q})

    //Initialization
    const result = {user: {name: user, stats: null, genres: []}, lists: Object.fromEntries(medias.map(type => [type, {}])), characters: [], sections}

    //User statistics
    for (let retried = false; !retried; retried = true) {
      try {
        //Query API
        console.debug(`metrics/compute/${login}/plugins > anilist > querying api (user statistics)`)
        const {data: {data: {User: {statistics: stats}}}} = await imports.axios.post("https://graphql.anilist.co", {variables: {name: user}, query: queries.anilist.statistics()})
        //Format and save results
        result.user.stats = stats
        result.user.genres = [...new Set([...stats.anime.genres.map(({genre}) => genre), ...stats.manga.genres.map(({genre}) => genre)])]
      }
      catch (error) {
        await retry({login, imports, error})
      }
    }

    //Medias lists
    if ((sections.includes("watching")) || (sections.includes("reading"))) {
      for (const type of medias) {
        for (let retried = false; !retried; retried = true) {
          try {
            //Query API
            console.debug(`metrics/compute/${login}/plugins > anilist > querying api (medias lists - ${type})`)
            const {data: {data: {MediaListCollection: {lists}}}} = await imports.axios.post("https://graphql.anilist.co", {variables: {name: user, type: type.toLocaleUpperCase()}, query: queries.anilist.medias()})
            //Format and save results
            for (const {name, entries} of lists) {
              //Format results
              const list = await Promise.all(entries.map(media => format({media, imports})))
              result.lists[type][name.toLocaleLowerCase()] = shuffle ? imports.shuffle(list) : list
              //Limit results
              if (limit > 0) {
                console.debug(`metrics/compute/${login}/plugins > anilist > keeping only ${limit} medias`)
                result.lists[type][name.toLocaleLowerCase()].splice(limit)
              }
            }
          }
          catch (error) {
            await retry({login, imports, error})
          }
        }
      }
    }

    //Favorites anime/manga
    if (sections.includes("favorites")) {
      for (const type of medias) {
        //Query API
        console.debug(`metrics/compute/${login}/plugins > anilist > querying api (favorites ${type}s)`)
        const list = []
        let page = 1
        let next = false
        do {
          try {
            console.debug(`metrics/compute/${login}/plugins > anilist > querying api (favorites ${type}s - page ${page})`)
            const {data: {data: {User: {favourites: {[type]: {nodes, pageInfo: cursor}}}}}} = await imports.axios.post("https://graphql.anilist.co", {variables: {name: user, page}, query: queries.anilist.favorites({type})})
            page++
            next = cursor.hasNextPage
            list.push(...await Promise.all(nodes.map(media => format({media: {progress: null, score: null, media}, imports}))))
          }
          catch (error) {
            if (await retry({login, imports, error}))
              continue
          }
        }
        while (next)
        //Format and save results
        result.lists[type].favorites = shuffle ? imports.shuffle(list) : list
        //Limit results
        if (limit > 0) {
          console.debug(`metrics/compute/${login}/plugins > anilist > keeping only ${limit} medias`)
          result.lists[type].favorites.splice(limit)
        }
      }
    }

    //Favorites characters
    if (sections.includes("characters")) {
      //Query API
      console.debug(`metrics/compute/${login}/plugins > anilist > querying api (favorites characters)`)
      const characters = []
      let page = 1
      let next = false
      do {
        try {
          console.debug(`metrics/compute/${login}/plugins > anilist > querying api (favorites characters - page ${page})`)
          const {data: {data: {User: {favourites: {characters: {nodes, pageInfo: cursor}}}}}} = await imports.axios.post("https://graphql.anilist.co", {variables: {name: user, page}, query: queries.anilist.characters()})
          page++
          next = cursor.hasNextPage
          for (const {name: {full: name}, image: {medium: artwork}} of nodes) {
            console.debug(`metrics/compute/${login}/plugins > anilist > processing ${name}`)
            characters.push({name, artwork: await imports.imgb64(artwork)})
          }
        }
        catch (error) {
          if (await retry({login, imports, error}))
            continue
        }
      }
      while (next)
      //Format and save results
      result.characters = shuffle ? imports.shuffle(characters) : characters
      //Limit results
      if (limit_characters > 0) {
        console.debug(`metrics/compute/${login}/plugins > anilist > keeping only ${limit_characters} characters`)
        result.characters.splice(limit_characters)
      }
    }

    //Results
    return result
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}

/**Media formatter */
async function format({media, imports}) {
  const {progress, score: userScore, media: {title, description, status, startDate: {year: release}, genres, averageScore, episodes, chapters, type, coverImage: {medium: artwork}}} = media
  return {
    name: title.romaji,
    type,
    status,
    release,
    genres,
    progress,
    description: description?.replace(/<br\s*\\?>/g, " ") ?? "",
    scores: {user: userScore, community: averageScore},
    released: type === "ANIME" ? episodes : chapters,
    artwork: await imports.imgb64(artwork),
  }
}

/**Rate-limiter handler */
async function retry({login, imports, error}) {
  if ((error.isAxiosError) && (error.response.status === 429)) {
    const delay = Number(error.response.headers["retry-after"]) + 5
    console.debug(`metrics/compute/${login}/plugins > anilist > reached requests limit, retrying in ${delay}s`)
    await imports.wait(delay)
    return true
  }
  throw error
}
</file>

<file path="source/plugins/anilist/metadata.yml">
name: üå∏ Anilist watch list and reading list
category: social
description: |
  This plugin displays favorites animes, mangas and characters from a [AniList](https://anilist.co) account.
disclaimer: |
  This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with [AniList](https://anilist.co).
  All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.
examples:
  +for anime watchers: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.anilist.svg
  for manga readers: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.anilist.manga.svg
  +for waifus simp: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.anilist.characters.svg
index: 4
supports:
  - user
  - organization
scopes: []
inputs:

  plugin_anilist:
    description: |
      Enable aniList plugin
    type: boolean
    default: no
    extras:
      - metrics.run.puppeteer.scrapping

  plugin_anilist_user:
    type: string
    description: |
      AniList login
    default: .user.login
    preset: no

  plugin_anilist_medias:
    description: |
      Medias types
    type: array
    format: comma-separated
    default: anime, manga
    values:
      - anime
      - manga

  plugin_anilist_sections:
    description: |
      Displayed sections

      - `favorites` will display favorites from `plugin_anilist_medias`
      - `watching` will display animes currently in watching list
      - `reading` will display manga currently in reading list
      - `characters` will display liked characters
    type: array
    format: comma-separated
    default: favorites
    example: favorites, watching, characters
    values:
      - favorites
      - watching
      - reading
      - characters

  plugin_anilist_limit:
    description: |
      Display limit (medias)
    type: number
    default: 2
    min: 0
    zero: disable

  plugin_anilist_limit_characters:
    description: |
      Display limit (characters)
    type: number
    default: 22
    min: 0
    zero: disable

  plugin_anilist_shuffle:
    description: |
      Shuffle data

      Can be used to create varied outputs
    type: boolean
    default: yes
</file>

<file path="source/plugins/base/queries/calendar.graphql">
query BaseCalendar {
  user(login: "$login") {
    calendar:contributionsCollection(from: "$calendar.from", to: "$calendar.to") {
      contributionCalendar {
        weeks {
          contributionDays {
            color
          }
        }
      }
    }
  }
}
</file>

<file path="source/plugins/base/queries/contributions.graphql">
query BaseContributions {
  user(login: "$login") {
    contributionsCollection$range {
      $field
    }
  }
}
</file>

<file path="source/plugins/base/queries/field.graphql">
query BaseField {
  $account(login: "$login") {
    $field {
      totalCount
    }
  }
}
</file>

<file path="source/plugins/base/queries/field.repositories.graphql">
query BaseFieldRepositories{
  $account(login: "$login") {
    repositories(last: 0 $affiliations) {
      $field
    }
  }
}
</file>

<file path="source/plugins/base/queries/organization.graphql">
query BaseOrganization {
  organization(login: "$login") {
    databaseId
    name
    login
    location
    createdAt
    avatarUrl
    websiteUrl
    isVerified
    twitterUsername
  }
}
</file>

<file path="source/plugins/base/queries/organization.x.graphql">
query BaseOrganizationX {
  organization(login: "$login") {
    packages {
      totalCount
    }
    sponsorshipsAsSponsor {
      totalCount
    }
    sponsorshipsAsMaintainer {
      totalCount
    }
    membersWithRole {
      totalCount
    }
    repositories(last: 0 $affiliations) {
      totalCount
      totalDiskUsage
    }
  }
}
</file>

<file path="source/plugins/base/queries/repositories.graphql">
query BaseRepositories {
  $account(login: "$login") {
    $type($after first: $repositories $forks $affiliations $constraints, orderBy: {field: UPDATED_AT, direction: DESC}) {
      edges {
        cursor
      }
      nodes {
        updatedAt
        name
        owner {
          login
        }
        isFork
        forkCount
        watchers {
          totalCount
        }
        stargazers {
          totalCount
        }
        releases {
          totalCount
        }
        deployments {
          totalCount
        }
        environments {
          totalCount
        }
        languages(first: 8) {
          edges {
            size
            node {
              color
              name
            }
          }
        }
        licenseInfo {
          name
          spdxId
        }
        issues_open: issues(states: OPEN) {
          totalCount
        }
        issues_closed: issues(states: CLOSED) {
          totalCount
        }
        pr_open: pullRequests(states: OPEN) {
          totalCount
        }
        pr_closed: pullRequests(states: CLOSED) {
          totalCount
        }
        pr_merged: pullRequests(states: MERGED) {
          totalCount
        }
      }
    }
  }
}
</file>

<file path="source/plugins/base/queries/repository.graphql">
query BaseRepository {
  $account(login: "$login") {
    repository(name: "$repo") {
      name
      createdAt
      diskUsage
      homepageUrl
      owner {
        login
      }
      isFork
      forkCount
      watchers {
        totalCount
      }
      stargazers {
        totalCount
      }
      releases {
        totalCount
      }
      deployments {
        totalCount
      }
      environments {
        totalCount
      }
      languages(first: 8) {
        edges {
          size
          node {
            color
            name
          }
        }
      }
      licenseInfo {
        name
        spdxId
      }
      issues_open: issues(states: OPEN) {
        totalCount
      }
      issues_closed: issues(states: CLOSED) {
        totalCount
      }
      pr_open: pullRequests(states: OPEN) {
        totalCount
      }
      pr_closed: pullRequests(states: CLOSED) {
        totalCount
      }
      pr_merged: pullRequests(states: MERGED) {
        totalCount
      }
    }
  }
}
</file>

<file path="source/plugins/base/queries/user.graphql">
query BaseUser {
  user(login: "$login") {
    databaseId
    name
    login
    location
    createdAt
    avatarUrl
    websiteUrl
    twitterUsername
  }
}
</file>

<file path="source/plugins/base/queries/user.x.graphql">
query BaseUserX {
  user(login: "$login") {
    packages {
      totalCount
    }
    starredRepositories {
      totalCount
    }
    watching {
      totalCount
    }
    sponsorshipsAsSponsor {
      totalCount
    }
    sponsorshipsAsMaintainer {
      totalCount
    }
    followers {
      totalCount
    }
    following {
      totalCount
    }
    issueComments {
      totalCount
    }
    organizations {
      totalCount
    }
    repositoriesContributedTo(includeUserRepositories: true) {
      totalCount
    }
    repositories(last: 0 $affiliations) {
      totalCount
      totalDiskUsage
    }
    contributionsCollection {
      totalRepositoriesWithContributedCommits
      totalCommitContributions
      restrictedContributionsCount
      totalIssueContributions
      totalPullRequestContributions
      totalPullRequestReviewContributions
    }
    calendar:contributionsCollection(from: "$calendar.from", to: "$calendar.to") {
      contributionCalendar {
        weeks {
          contributionDays {
            color
          }
        }
      }
    }
  }
}
</file>

<file path="source/plugins/base/examples.yml">
- name: Default metrics
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.base.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: header, activity, community, repositories, metadata
</file>

<file path="source/plugins/base/index.mjs">
/**
 * Base plugin is a special plugin because of historical reasons.
 * It populates initial data object directly instead of returning a result like others plugins
 */

//Setup
export default async function({login, graphql, rest, data, q, queries, imports, callbacks}, conf) {
  //Load inputs
  console.debug(`metrics/compute/${login}/base > started`)
  let {indepth, hireable, skip, "repositories.forks": _forks, "repositories.affiliations": _affiliations, "repositories.batch": _batch} = imports.metadata.plugins.base.inputs({data, q, account: "bypass"})
  const repositories = conf.settings.repositories || 100
  const forks = _forks ? "" : ", isFork: false"
  const affiliations = _affiliations?.length ? `, ownerAffiliations: [${_affiliations.map(x => x.toLocaleUpperCase()).join(", ")}]${conf.authenticated === login ? `, affiliations: [${_affiliations.map(x => x.toLocaleUpperCase()).join(", ")}]` : ""}` : ""
  console.debug(`metrics/compute/${login}/base > affiliations constraints ${affiliations}`)

  //Skip initial data gathering if not needed
  if ((conf.settings.notoken) || (skip)) {
    await callbacks?.plugin?.(login, "base", true, data).catch(error => console.debug(`metrics/compute/${login}/plugins/callbacks > base > ${error}`))
    return (postprocess.skip({login, data, imports}), {})
  }

  //Base parts (legacy handling for web instance)
  const defaulted = ("base" in q) ? legacy.converter(q.base) ?? true : true
  for (const part of conf.settings.plugins.base.parts)
    data.base[part] = `base.${part}` in q ? legacy.converter(q[`base.${part}`]) : defaulted

  //Iterate through account types
  for (const account of ["user", "organization"]) {
    try {
      //Query data from GitHub API
      console.debug(`metrics/compute/${login}/base > account ${account}`)
      const queried = await graphql(queries.base[account]({login}))
      Object.assign(data, {user: queried[account]})
      postprocess?.[account]({login, data})
      try {
        Object.assign(data.user, (await graphql(queries.base[`${account}.x`]({login, account, "calendar.from": new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(), "calendar.to": (new Date()).toISOString(), affiliations})))[account])
        console.debug(`metrics/compute/${login}/base > successfully loaded bulk query`)
      }
      catch {
        console.debug(`metrics/compute/${login}/base > failed to load bulk query, falling back to unit queries`)
        //Query basic fields
        const fields = {
          user: ["packages", "starredRepositories", "watching", "sponsorshipsAsSponsor", "sponsorshipsAsMaintainer", "followers", "following", "issueComments", "organizations", "repositoriesContributedTo(includeUserRepositories: true)"],
          organization: ["packages", "sponsorshipsAsSponsor", "sponsorshipsAsMaintainer", "membersWithRole"],
        }[account] ?? []
        for (const field of fields) {
          try {
            Object.assign(data.user, (await graphql(queries.base.field({login, account, field})))[account])
          }
          catch {
            console.debug(`metrics/compute/${login}/base > failed to retrieve ${field}`)
            data.user[field] = {totalCount: NaN}
          }
        }
        //Query repositories fields
        for (const field of ["totalCount", "totalDiskUsage"]) {
          try {
            Object.assign(data.user.repositories, (await graphql(queries.base["field.repositories"]({login, account, field, affiliations})))[account].repositories)
          }
          catch (error) {
            console.debug(`metrics/compute/${login}/base > failed to retrieve repositories.${field}`)
            data.user.repositories[field] = NaN
          }
        }
        //Query user account fields
        if (account === "user") {
          //Query contributions collection
          {
            const fields = ["totalRepositoriesWithContributedCommits", "totalCommitContributions", "restrictedContributionsCount", "totalIssueContributions", "totalPullRequestContributions", "totalPullRequestReviewContributions"]
            for (const field of fields) {
              try {
                Object.assign(data.user.contributionsCollection, (await graphql(queries.base.contributions({login, account, field, range: ""})))[account].contributionsCollection)
              }
              catch {
                console.debug(`metrics/compute/${login}/base > failed to retrieve contributionsCollection.${field}`)
                data.user.contributionsCollection[field] = NaN
              }
            }
          }
          //Query calendar
          try {
            Object.assign(data.user, (await graphql(queries.base.calendar({login, "calendar.from": new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(), "calendar.to": (new Date()).toISOString()})))[account])
          }
          catch {
            console.debug(`metrics/compute/${login}/base > failed to retrieve contributions calendar`)
            data.user.calendar = {contributionCalendar: {weeks: []}}
          }
        }
      }
      //Query contributions collection over account lifetime instead of last year
      if (account === "user") {
        if ((indepth) && (imports.metadata.plugins.base.extras("indepth", {...conf.settings, error: false}))) {
          const fields = ["totalRepositoriesWithContributedCommits", "totalCommitContributions", "restrictedContributionsCount", "totalIssueContributions", "totalPullRequestContributions", "totalPullRequestReviewContributions"]
          const start = new Date(data.user.createdAt)
          const end = new Date()
          const collection = {}
          for (const field of fields) {
            collection[field] = 0
            //Load contribution calendar
            for (let from = new Date(start); from < end;) {
              //Set date range
              let to = new Date(from)
              to.setUTCHours(+6 * 4 * 7 * 24)
              if (to > end)
                to = end
              //Ensure that date ranges are not overlapping by setting it to previous day at 23:59:59.999
              const dto = new Date(to)
              dto.setUTCHours(-1)
              dto.setUTCMinutes(59)
              dto.setUTCSeconds(59)
              dto.setUTCMilliseconds(999)
              //Fetch data from api
              try {
                console.debug(`metrics/compute/${login}/plugins > base > loading contributions collections for ${field} from "${from.toISOString()}" to "${dto.toISOString()}"`)
                const {[account]: {contributionsCollection}} = await graphql(queries.base.contributions({login, account, field, range: `(from: "${from.toISOString()}", to: "${dto.toISOString()}")`}))
                collection[field] += contributionsCollection[field]
              }
              catch {
                console.debug(`metrics/compute/${login}/plugins > base > failed to load contributions collections for ${field} from "${from.toISOString()}" to "${dto.toISOString()}"`)
              }
              //Set next date range start
              from = new Date(to)
            }
            data.user.contributionsCollection[field] = Math.max(collection[field], data.user.contributionsCollection[field])
          }
        }
        //Fallback to load whole commit history rather than last year
        else {
          try {
            console.debug(`metrics/compute/${login}/base > loading user commits history`)
            const {data: {total_count: total = 0}} = await rest.search.commits({q: `author:${login}`})
            data.user.contributionsCollection.totalCommitContributions = Math.max(total, data.user.contributionsCollection.totalCommitContributions)
          }
          catch {
            console.debug(`metrics/compute/${login}/base > falling back to last year commits history`)
          }
        }
        //Hireable status
        if (hireable) {
          console.debug(`metrics/compute/${login}/base > is hireable`)
          data.user.isHireable = hireable
        }
      }
      //Query repositories from GitHub API
      for (const type of ({user: ["repositories", "repositoriesContributedTo"], organization: ["repositories"]}[account] ?? [])) {
        //Iterate through repositories
        let cursor = null
        let pushed = 0
        const options = {repositories: {forks, affiliations, constraints: ""}, repositoriesContributedTo: {forks: "", affiliations: "", constraints: ", includeUserRepositories: false, contributionTypes: COMMIT"}}[type] ?? null
        data.user[type] = data.user[type] ?? {}
        data.user[type].nodes = data.user[type].nodes ?? []
        do {
          console.debug(`metrics/compute/${login}/base > retrieving ${type} after ${cursor}`)
          const request = {}
          try {
            Object.assign(request, await graphql(queries.base.repositories({login, account, type, after: cursor ? `after: "${cursor}"` : "", repositories: Math.min(repositories, {user: _batch, organization: Math.min(25, _batch)}[account]), ...options})))
          }
          catch (error) {
            console.debug(`metrics/compute/${login}/base > failed to retrieve ${_batch} repositories after ${cursor}, this is probably due to an API timeout, halving batch`)
            _batch = Math.floor(_batch / 2)
            if (_batch < 1) {
              console.debug(`metrics/compute/${login}/base > failed to retrieve repositories, cannot halve batch anymore`)
              throw error
            }
            continue
          }
          const {[account]: {[type]: {edges = [], nodes = []} = {}}} = request
          cursor = edges?.[edges?.length - 1]?.cursor
          data.user[type].nodes.push(...nodes)
          pushed = nodes.length
          console.debug(`metrics/compute/${login}/base > retrieved ${pushed} ${type} after ${cursor}`)
          if (pushed < repositories) {
            console.debug(`metrics/compute/${login}/base > retrieved less repositories than expected, probably no more to fetch`)
            break
          }
        }
        while ((pushed) && (cursor) && ((data.user.repositories?.nodes?.length ?? 0) + (data.user.repositoriesContributedTo?.nodes?.length ?? 0) < repositories))
        //Limit repositories
        console.debug(`metrics/compute/${login}/base > keeping only ${repositories} ${type}`)
        data.user[type].nodes.splice(repositories)
        console.debug(`metrics/compute/${login}/base > loaded ${data.user[type].nodes.length} ${type}`)
      }
      //Fetch missing packages count from ghcr.io using REST API (as GraphQL API does not support it yet)
      try {
        console.debug(`metrics/compute/${login}/base > patching packages count if possible`)
        const {data: packages} = await rest.packages[{user: "listPackagesForUser", organization: "listPackagesForOrganization"}[account]]({package_type: "container", org: login, username: login})
        data.user.packages.totalCount += packages.length
        console.debug(`metrics/compute/${login}/base > patched packages count (added ${packages.length} from ghcr.io)`)
      }
      catch {
        console.debug(`metrics/compute/${login}/base > failed to patch packages count, maybe read:packages scope was not provided`)
      }
      //Shared options
      let {"repositories.skipped": skipped, "users.ignored": ignored, "commits.authoring": authoring} = imports.metadata.plugins.base.inputs({data, q, account: "bypass"})
      data.shared = {"repositories.skipped": skipped, "users.ignored": ignored, "commits.authoring": authoring, "repositories.batch": _batch}
      console.debug(`metrics/compute/${login}/base > shared options > ${JSON.stringify(data.shared)}`)
      //Success
      console.debug(`metrics/compute/${login}/base > graphql query > account ${account} > success`)
      await callbacks?.plugin?.(login, "base", true, data).catch(error => console.debug(`metrics/compute/${login}/plugins/callbacks > base > ${error}`))
      return {}
    }
    catch (error) {
      console.debug(`metrics/compute/${login}/base > account ${account} > failed : ${error}`)
      if (/Could not resolve to a User with the login of/.test(error.message)) {
        console.debug(`metrics/compute/${login}/base > got a "user not found" error for account type "${account}" and user "${login}"`)
        console.debug(`metrics/compute/${login}/base > checking next account type`)
        continue
      }
      throw error
    }
  }
  //Not found
  console.debug(`metrics/compute/${login}/base > no more account type`)
  await callbacks?.plugin?.(login, "base", false, data).catch(error => console.debug(`metrics/compute/${login}/plugins/callbacks > base > ${error}`))
  throw new Error("user not found")
}

//Query post-processing
const postprocess = {
  //User
  user({login, data}) {
    console.debug(`metrics/compute/${login}/base > applying postprocessing`)
    data.account = "user"
    Object.assign(data.user, {
      isHireable: false,
      isVerified: false,
      repositories: {},
      contributionsCollection: {},
    })
  },
  //Organization
  organization({login, data}) {
    console.debug(`metrics/compute/${login}/base > applying postprocessing`)
    data.account = "organization"
    Object.assign(data.user, {
      isHireable: false,
      repositories: {},
      starredRepositories: {totalCount: NaN},
      watching: {totalCount: NaN},
      contributionsCollection: {
        totalRepositoriesWithContributedCommits: NaN,
        totalCommitContributions: NaN,
        restrictedContributionsCount: NaN,
        totalIssueContributions: NaN,
        totalPullRequestContributions: NaN,
        totalPullRequestReviewContributions: NaN,
      },
      calendar: {contributionCalendar: {weeks: []}},
      repositoriesContributedTo: {totalCount: NaN, nodes: []},
      followers: {totalCount: NaN},
      following: {totalCount: NaN},
      issueComments: {totalCount: NaN},
      organizations: {totalCount: NaN},
    })
  },
  //Skip base content query and instantiate an empty user instance
  skip({login, data, imports}) {
    data.user = {}
    data.shared = imports.metadata.plugins.base.inputs({data, q: {}, account: "bypass"})
    for (const account of ["user", "organization"])
      postprocess?.[account]({login, data})
    data.account = "bypass"
    Object.assign(data.user, {
      databaseId: NaN,
      name: login,
      login,
      createdAt: new Date(),
      avatarUrl: `https://github.com/${login}.png`,
      websiteUrl: null,
      twitterUsername: login,
      repositories: {totalCount: NaN, totalDiskUsage: NaN, nodes: []},
      packages: {totalCount: NaN},
      repositoriesContributedTo: {totalCount: NaN, nodes: []},
    })
  },
}

//Legacy functions
const legacy = {
  converter(value) {
    if (/^(?:[Tt]rue|[Oo]n|[Yy]es|1)$/.test(value))
      return true
    if (/^(?:[Ff]alse|[Oo]ff|[Nn]o|0)$/.test(value))
      return false
    if (Number.isFinite(Number(value)))
      return !!(Number(value))
  },
}
</file>

<file path="source/plugins/base/metadata.yml">
name: üóÉÔ∏è Base content
category: core
description:
examples:
  default1: https://github.com/lowlighter/metrics/blob/examples/metrics.classic.svg
  default2: https://github.com/lowlighter/metrics/blob/examples/metrics.organization.svg
supports:
  - user
  - organization
  - repository
scopes:
  - public_access
inputs:

  base:
    description: |
      Base content

      The following sections are supported:
      - `header`, which usually contains username, two-weeks commits calendars and a few additional data
      - `activity`, which contains recent activity (commits, pull requests, issues, etc.)
      - `community`, which contains community stats (following, sponsors, organizations, etc.)
      - `repositories`, which contains repository stats (license, forks, stars, etc.)
      - `metadata`, which contains information about generated metrics

      These are all enabled by default, but it is possible to explicitly opt out from them.
    type: array
    format: comma-separated
    default: header, activity, community, repositories, metadata
    values:
      - header
      - activity
      - community
      - repositories
      - metadata

  base_indepth:
    description: |
      Indepth mode

      Enabling this will consume additional API queries to fetch more data.
      This currently improves the accuracy of the following statistics:
        - total commits
        - total issues
        - total pull requests
        - total pull requests reviews
        - total repositories contributed to
    type: boolean
    default: no
    extras:
      - metrics.api.github.overuse

  base_hireable:
    description: |
      Show `Available for hire!` in header section
    type: boolean
    default: no

  base_skip:
    description: |
      Skip base content

      > ‚ö†Ô∏è Any plugin that relies on base content data may break!
      > Only use this option when using a plugin that can be configured with [`token: NOT_NEEDED`](/source/plugins/core/README.md#token)
    type: boolean
    default: no

  repositories:
    description: |
      Fetched repositories

      A higher value result in more accurate metrics but can hit GitHub API rate-limit more easily (especially with a lot of plugins enabled)
    type: number
    default: 100
    min: 0

  repositories_batch:
    description: |
      Fetched repositories per query

      If you receive `Something went wrong while executing your query` (which is usually caused by API timeouts), lowering this value may help.
      This setting may not be supported by all plugins.
    type: number
    default: 100
    max: 100
    min: 1

  repositories_forks:
    description: |
      Include forks
    type: boolean
    default: no

  repositories_affiliations:
    description: |
      Repositories affiliations

      - `owner`: owned repositories
      - `collaborator`: repositories with push access
      - `organization_member`: repositories from an organization where user is a member

      Some plugin outputs may be affected by this setting too.

      Set to `""` to disable and fetch all repositories related to given account.
      Broad affiliations will result in less representative metrics.
    type: array
    format: comma-separated
    default: owner
    values:
      - owner
      - collaborator
      - organization_member

  repositories_skipped:
    description: |
      Default skipped repositories
    type: array
    format:
      - newline-separated
      - comma-separated
    default: ""
    example: my-repo-1, my-repo-2, owner/repo-3, ...
    global: yes

  users_ignored:
    description: |
      Default ignored users

      Note that emails are only supported in commits-related elements.
    type: array
    format: comma-separated
    default: github-actions[bot], dependabot[bot], dependabot-preview[bot], actions-user, action@github.com
    global: yes

  commits_authoring:
    description: |
      Identifiers that has been used for authoring commits

      Specify names, surnames, username, email addresses that has been used in the past that can be used to detect commits ownerships in some plugins
    type: array
    format: comma-separated
    default: .user.login
    example: lowlighter, lowlighter@users.noreply.github.com
    global: yes
    preset: no
</file>

<file path="source/plugins/calendar/queries/calendar.graphql">
query CalendarDefault {
  user(login: "$login") {
    calendar:contributionsCollection(from: "$from", to: "$to") {
      contributionCalendar {
        weeks {
          contributionDays {
            contributionCount
            color
            date
          }
        }
      }
    }
  }
}
</file>

<file path="source/plugins/calendar/examples.yml">
- name: Current year calendar
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.calendar.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_calendar: yes

- name: Full history calendar
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.calendar.full.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_calendar: yes
    plugin_calendar_limit: 0
</file>

<file path="source/plugins/calendar/index.mjs">
//Setup
export default async function({login, q, data, imports, graphql, queries, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.calendar) || (!imports.metadata.plugins.calendar.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {limit} = imports.metadata.plugins.calendar.inputs({data, account, q})

    //Compute boundaries
    const registration = new Date(data.user.createdAt)
    const end = new Date().getFullYear()
    const start = (limit > 0 ? new Date(end - limit + 1, 0) : limit < 0 ? new Date(new Date(registration).setFullYear(registration.getFullYear() + limit)) : registration).getFullYear()

    //Load contribution calendar
    console.debug(`metrics/compute/${login}/plugins > calendar > processing years ${start} to ${end}`)
    const calendar = {years: []}
    for (let year = start; year <= end; year++) {
      console.debug(`metrics/compute/${login}/plugins > calendar > processing year ${year}`)
      const weeks = []
      const newyear = new Date(year, 0, 1)
      const endyear = (year === end) ? new Date() : new Date(year, 11, 31)
      for (let from = new Date(newyear); from < endyear;) {
        //Set date range and ensure we start on sundays
        let to = new Date(from)
        to.setUTCHours(+4 * 7 * 24)
        if (to.getUTCDay())
          to.setUTCHours(-to.getUTCDay() * 24)
        if (to > endyear)
          to = endyear

        //Ensure that date ranges are not overlapping by setting it to previous day at 23:59:59.999
        const dto = new Date(to)
        dto.setUTCHours(-1)
        dto.setUTCMinutes(59)
        dto.setUTCSeconds(59)
        dto.setUTCMilliseconds(999)
        //Fetch data from api
        console.debug(`metrics/compute/${login}/plugins > calendar > loading calendar from "${from.toISOString()}" to "${dto.toISOString()}"`)
        const {user: {calendar: {contributionCalendar}}} = await graphql(queries.isocalendar.calendar({login, from: from.toISOString(), to: dto.toISOString()}))
        weeks.push(...contributionCalendar.weeks)
        //Set next date range start
        from = new Date(to)
      }
      calendar.years.unshift({year, weeks})
    }

    //Results
    return calendar
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/calendar/metadata.yml">
name: üìÜ Commit calendar
category: github
description: |
  This plugin can display commit calendar across several years.
examples:
  current year: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.calendar.svg
  +full history: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.calendar.full.svg
index: 17
supports:
  - user
scopes:
  - public_access
inputs:

  plugin_calendar:
    description: |
      Enable calendar plugin
    type: boolean
    default: no

  plugin_calendar_limit:
    description: |
      Years to display

      This option has different behaviours depending on its value:
      - `n > 0` will display the last `n` years, relative to current year
      - `n == 0` will display all years starting from GitHub account registration date
      - `n < 0` will display all years plus `n` additional years, relative to GitHub account registration date
        - Use this when there are commits pushed before GitHub registration
    type: number
    default: 1
    zero: disable
</file>

<file path="source/plugins/code/examples.yml">
- name: JavaScript or TypeScript snippet of the day
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.code.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_code: yes
    plugin_code_languages: javascript, typescript
    plugin_code_load: 400
</file>

<file path="source/plugins/code/index.mjs">
//Setup
export default async function({login, q, imports, data, rest, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.code) || (!imports.metadata.plugins.code.enabled(enabled, {extras})))
      return null

    //Context
    let context = {mode: "user"}
    if (q.repo) {
      console.debug(`metrics/compute/${login}/plugins > code > switched to repository mode`)
      const {owner, repo} = data.user.repositories.nodes.map(({name: repo, owner: {login: owner}}) => ({repo, owner})).shift()
      context = {...context, mode: "repository", owner, repo}
    }

    //Load inputs
    let {load, days, lines, visibility, languages, skipped} = imports.metadata.plugins.code.inputs({data, q, account})
    if (!days)
      days = Infinity
    skipped.push(...data.shared["repositories.skipped"])
    const pages = Math.ceil(load / 100)

    //Get user recent code
    console.debug(`metrics/compute/${login}/plugins > code > querying api`)
    const events = []
    try {
      for (let page = 1; page <= pages; page++) {
        console.debug(`metrics/compute/${login}/plugins > code > loading page ${page}/${pages}`)
        events.push(
          ...[
            ...await Promise.all([
              ...(context.mode === "repository"
                ? await rest.activity.listRepoEvents({owner: context.owner, repo: context.repo})
                : await rest.activity.listEventsForAuthenticatedUser({username: login, per_page: 100, page})).data
                .filter(({type}) => type === "PushEvent")
                .filter(({actor}) => account === "organization" ? true : actor.login?.toLocaleLowerCase() === login.toLocaleLowerCase())
                .filter(({repo: {name: repo}}) => imports.filters.repo(repo, skipped))
                .filter(event => visibility === "public" ? event.public : true)
                .filter(({created_at}) => Number.isFinite(days) ? new Date(created_at) > new Date(Date.now() - days * 24 * 60 * 60 * 1000) : true)
                .flatMap(({created_at: created, payload}) => Promise.all(payload.commits.map(async commit => ({created: new Date(created), ...(await rest.request(commit.url)).data})))),
            ]),
          ]
            .flat()
            .filter(({parents}) => parents.length <= 1)
            .filter(({author}) => data.shared["commits.authoring"].filter(authoring => author?.login?.toLocaleLowerCase().includes(authoring) || author?.email?.toLocaleLowerCase().includes(authoring) || author?.name?.toLocaleLowerCase().includes(authoring)).length),
        )
      }
    }
    catch {
      console.debug(`metrics/compute/${login}/plugins > code > no more page to load`)
    }
    console.debug(`metrics/compute/${login}/plugins > code > ${events.length} events loaded`)

    //Search for a random snippet
    let files = events
      .flatMap(({created, sha, commit: {message, url}, files}) => files.map(({filename, status, additions, deletions, patch}) => ({created, sha, message, filename, status, additions, deletions, patch, repo: url.match(/repos[/](?<repo>[\s\S]+)[/]git[/]commits/)?.groups?.repo})))
      .filter(({patch}) => (patch ? (patch.match(/\n/mg)?.length ?? 1) : Infinity) < lines)
    for (const file of files)
      file.language = await imports.language({...file, prefix: login}).catch(() => "unknown")
    files = files.filter(({language}) => (!languages.length) || (languages.includes(language.toLocaleLowerCase())))
    const snippet = files[Math.floor(Math.random() * files.length)] ?? null
    if (snippet) {
      //Trim common indent from content and change line feed
      if (!snippet.patch.split("\n").shift().endsWith("@@"))
        snippet.patch = snippet.patch.replace(/^(?<coord>@@.*?@@).*/, "$<coord>")
      const indent = Math.min(...(snippet.patch.match(/^.\s+/mg) ?? [0]).map(line => line.length - 1)) || 0
      const content = imports.htmlescape(snippet.patch.replace(new RegExp(`^(.)[\\t ]{0,${indent}}`, "mg"), "$1"))

      //Format patch
      snippet.patch = imports.htmlunescape(await imports.highlight(content, "diff"))
        .trim()
        .replace(/\r?\n/g, "<br/>")
        .replace(/<span class="token prefix unchanged"> <\/span>/g, '<span class="token prefix unchanged">¬∑</span>')
    }

    //Results
    return {snippet}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/code/metadata.yml">
name: ‚ôê Random code snippet
category: github
description: |
  This plugin displays a random code snippet from recent activity history.
notes: |
  > ‚ö†Ô∏è When improperly configured, this plugin could display private code.
  > If you work with sensitive data or company code, it is advised to keep this plugin disabled.
  > Use at your own risk, *metrics* and its authors cannot be held responsible for any resulting code leaks.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.code.svg
index: 23
supports:
  - user
  - organization
scopes:
  - public_access
inputs:

  plugin_code:
    description: |
      Enable code plugin
    type: boolean
    default: no

  plugin_code_lines:
    description: |
      Display limit (lines per code snippets)
    type: number
    default: 12
    min: 1
    max: 128

  plugin_code_load:
    description: |
      Events to load
    type: number
    default: 400
    min: 100
    max: 1000

  plugin_code_days:
    description: |
      Events maximum age
    type: number
    default: 3
    min: 0
    max: 365
    zero: disable

  plugin_code_visibility:
    description: |
      Events visibility

      Can be used to toggle private activity visibility when using a token with `repo` scope
    type: string
    default: public
    values:
      - public
      - all

  plugin_code_skipped:
    description: |
      Skipped repositories
    type: array
    format: 
      - newline-separated
      - comma-separated
    default: ""
    example: my-repo-1, my-repo-2, owner/repo-3, ...
    inherits: repositories_skipped

  plugin_code_languages:
    description: |
      Showcased languages
    type: array
    format: comma-separated
    default: ""
    example: javascript, typescript, ...
</file>

<file path="source/plugins/community/16personalities/examples.yml">
- name: MBTI Personality profile
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.16personalities.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_16personalities: yes
    plugin_16personalities_url: ${{ secrets.SIXTEEN_PERSONALITIES_URL }}
    plugin_16personalities_sections: personality, traits
    plugin_16personalities_scores: no
</file>

<file path="source/plugins/community/16personalities/index.mjs">
//Setup
export default async function({login, q, imports, data, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q["16personalities"]) || (!imports.metadata.plugins["16personalities"].enabled(enabled, {extras})))
      return null

    //Load inputs
    let {url, sections, scores} = imports.metadata.plugins["16personalities"].inputs({data, account, q})
    if (!url)
      throw {error: {message: "URL is not set"}}

    //Start puppeteer and navigate to page
    console.debug(`metrics/compute/${login}/plugins > 16personalities > starting browser`)
    const browser = await imports.puppeteer.launch()
    console.debug(`metrics/compute/${login}/plugins > 16personalities > started ${await browser.version()}`)
    const page = await browser.newPage()
    console.debug(`metrics/compute/${login}/plugins > 16personalities > loading ${url}`)
    await page.goto(url, {waitUntil: imports.puppeteer.events})

    //Fetch raw data
    const raw = await page.evaluate(() => ({
      color: getComputedStyle(document.querySelector(".card__bg")).backgroundColor, //eslint-disable-line no-undef
      type: document.querySelector(".type__code").innerText,
      personality: [...document.querySelectorAll(".personality-cards .sp-personality-card")].map(card => ({
        category: card.querySelector(".card__title").innerText,
        value: card.querySelector(".card__subtitle").innerText,
        image: card.querySelector(".card__image").src,
        text: card.querySelector(".card__text").innerText,
      })),
      traits: [...document.querySelectorAll("#traits .card__body")].map(card => ({
        category: card.querySelector(".card__title").innerText,
        value: card.querySelector(".card__subtitle").innerText,
        score: card.querySelector(".center__num").innerText,
        text: card.querySelector("p").innerText,
      })),
    }))

    //Format data
    const {color} = raw
    const type = raw.type.replace("(", "").replace(")", "").trim()
    const personality = await Promise.all(raw.personality.map(async ({category, value, image, text}) => ({
      category,
      value: value.replace(`(${type})`, "").trim(),
      image: await imports.imgb64(image),
      text: text.replace(`${category}\n${value}\n`, "").trim(),
    })))
    const traits = raw.traits.map(({category, value, score, text}) => ({
      category,
      value: `${value[0]}${value.substring(1).toLocaleLowerCase()}`,
      score: scores ? Number(score.replace("%", "")) / 100 : NaN,
      text: text.split(".").slice(1).join("."),
    }))

    //Results
    return {sections, color, type, personality, traits}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/community/16personalities/metadata.yml">
name: üß† 16personalities
category: community
description: |
  This plugin displays personality profile from a [16personalities profile](https://www.16personalities.com/profile).
disclaimer: |
  This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with [16personalities](https://www.16personalities.com).
  All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.16personalities.svg
authors:
  - lowlighter
supports:
  - user
scopes: []
inputs:

  plugin_16personalities:
    description: |
      Enable 16personalities plugin
    type: boolean
    default: no
    extras:
      - metrics.run.puppeteer.scrapping

  plugin_16personalities_url:
    description: |
      Profile URL

      This can be obtained after doing the [test on 16personalities](https://www.16personalities.com/free-personality-test) and registering an email.
      Login with the generated password received in your mailbox and copy the link that is displayed when sharing the profile.

      <img src="/.github/readme/imgs/plugin_16personalities_profile.png" width="800" />

    type: string
    default: ""
    example: https://www.16personalities.com/profiles/xxxxxxxxxxxxx

  plugin_16personalities_sections:
    description: |
      Displayed sections

      - `personality` will display personality type
      - `profile` will display role and strategy
      - `traits` will display mind, energy, nature, tactics and identity traits
    type: array
    format: comma-separated
    default: personality
    example: personality, profile, traits
    values:
      - personality
      - profile
      - traits

  plugin_16personalities_scores:
    description: |
      Display traits scores
    type: boolean
    default: yes
</file>

<file path="source/plugins/community/chess/examples.yml">
- name: Last chess game from lichess.org
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.chess.svg
    token: NOT_NEEDED
    base: ""
    plugin_chess: yes
    plugin_chess_token: ${{ secrets.CHESS_TOKEN }}
    plugin_chess_platform: lichess.org
</file>

<file path="source/plugins/community/chess/index.mjs">
//Imports
import { Chess } from "chess.js"

//Setup
export default async function({login, q, imports, data, account}, {enabled = false, token = "", extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.chess) || (!imports.metadata.plugins.chess.enabled(enabled, {extras})))
      return null

    //Load inputs
    const {user, platform, animation} = imports.metadata.plugins.chess.inputs({data, account, q})
    for (const [key, defaulted] of Object.entries({size: 40, delay: 1, duration: 4})) {
      if (Number.isNaN(Number(animation[key])))
        animation[key] = defaulted
      if (animation[key] < 0)
        animation[key] = defaulted
    }

    //Fetch PGN
    console.debug(`metrics/compute/${login}/plugins > chess > fetching last game from ${platform}`)
    let PGN
    switch (platform) {
      case "lichess.org":
        PGN = (await imports.axios.get(`https://lichess.org/api/games/user/${user}?max=1`, {headers: {Authorization: `Bearer ${token}`}})).data
        break
      case "":
        throw {error: {message: "Unspecified platform"}}
      default:
        throw {error: {message: `Unsupported platform "${platform}"`}}
    }

    //Parse PGN
    const board = new Chess()
    board.loadPgn(PGN)
    const moves = board.history({verbose: true})
    const meta = board.header()
    const result = Object.fromEntries(meta.Result.split("-").map((score, i) => [i ? "black" : "white", Number(score) || 0]))

    //Results
    return {platform, meta, moves, animation, result}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/community/chess/metadata.yml">
name: ‚ôüÔ∏è Chess
category: community
description: |
  This plugin displays the last game you played on a supported chess platform.
disclaimer: |
  This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with any of the supported provider.
  All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.chess.svg
authors:
  - lowlighter
supports:
  - user
  - organization
  - repository
scopes: []
inputs:

  plugin_chess:
    description: |
      Enable chess plugin
    type: boolean
    default: no

  plugin_chess_token:
    description: |
      Chess platform token
    type: token
    default: ""
    extras:
      - metrics.api.chess.any

  plugin_chess_user:
    description: |
      Chess platform login
    type: string
    default: .user.login
    preset: no

  plugin_chess_platform:
    description: |
      Chess platform
    type: string
    default: ""
    values:
      - lichess.org

  plugin_chess_animation:
    description: |
      Animation settings

      - `size` is the size of a single chessboard square in pixels (board will be 8 times larger)
      - `delay` is the delay before starting animation (in seconds)
      - `duration` is the duration of the animation of a move (in seconds)
    type: json
    default: |
      {
        "size": 40,
        "delay": 3,
        "duration": 0.6
      }
</file>

<file path="source/plugins/community/fortune/examples.yml">
- name: Fortune
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.fortune.svg
    token: NOT_NEEDED
    base: ""
    plugin_fortune: yes
</file>

<file path="source/plugins/community/fortune/index.mjs">
//Setup
export default async function({q, data, imports, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.fortune) || (!imports.metadata.plugins.fortune.enabled(enabled, {extras})))
      return null

    //Load inputs
    imports.metadata.plugins.fortune.inputs({data, account, q})

    //Fortunes list
    const fortunes = [
      {chance: .06, color: "#F51C6A", text: "Reply hazy"},
      {chance: .03, color: "#FD4D32", text: "Excellent Luck"},
      {chance: .16, color: "#E7890C", text: "Good Luck"},
      {chance: .24, color: "#BAC200", text: "Average Luck"},
      {chance: .16, color: "#7FEC11", text: "Bad Luck"},
      {chance: .06, color: "#43FD3B", text: "Good news will come to you by mail"},
      {chance: .06, color: "#16F174", text: "Ôºà„ÄÄ¬¥_„Çù`ÔºâÔæåÔΩ∞Ôæù "},
      {chance: .06, color: "#00CBB0", text: "ÔΩ∑ÔæÄ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ(Ôæü‚àÄÔæü)‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ !!!!"},
      {chance: .06, color: "#0893E1", text: "You will meet a dark handsome stranger"},
      {chance: .06, color: "#2A56FB", text: "Better not tell you now"},
      {chance: .06, color: "#6023F8", text: "Outlook good"},
      {chance: .04, color: "#9D05DA", text: "Very Bad Luck"},
      {chance: .01, color: "#D302A7", text: "Godly Luck"},
    ]

    //Result
    let [fortune] = fortunes
    const x = Math.random()
    for (let i = 0, r = 0; i < fortunes.length; i++) {
      if (x <= r) {
        fortune = fortunes[i]
        break
      }
      r += fortunes[i].chance
    }
    return {...fortune}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/community/fortune/metadata.yml">
name: ü•† Fortune
category: community
description: |
  This plugins displays a random fortune message
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.fortune.svg
authors:
  - lowlighter
supports:
  - user
scopes: []
inputs:

  plugin_fortune:
    description: |
      Enable fortune plugin
    type: boolean
    default: no
</file>

<file path="source/plugins/community/nightscout/examples.yml">
- uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_nightscout: yes
    plugin_nightscout_url: ${{ secrets.NIGHTSCOUT_URL }}
  prod:
    skip: true
</file>

<file path="source/plugins/community/nightscout/index.mjs">
//Setup
export default async function({q, imports, data, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.nightscout) || (!imports.metadata.plugins.nightscout.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {url, datapoints, lowalert, highalert, urgentlowalert, urgenthighalert} = imports.metadata.plugins.nightscout.inputs({data, account, q})

    if (!url || url === "https://example.herokuapp.com")
      throw {error: {message: "Nightscout URL is not set"}}
    if (url.substring(url.length - 1) !== "/")
      url += "/"
    if (url.substring(0, 7) === "http://")
      url = `https://${url.substring(7)}`
    if (url.substring(0, 8) !== "https://")
      url = `https://${url}`
    if (datapoints <= 0)
      datapoints = 1
    //Get nightscout data from axios
    const resp = await imports.axios.get(`${url}api/v1/entries.json?count=${datapoints}`)
    for (let i = 0; i < resp.data.length; i++) {
      const {sgv} = resp.data[i]
      //Add human readable timestamps and arrows
      const date = new Date(resp.data[i].dateString)
      resp.data[i].arrowHumanReadable = directionArrow(resp.data[i].direction)
      resp.data[i].timeUTCHumanReadable = `${addZero(date.getUTCHours())}:${addZero(date.getUTCMinutes())}`
      /*
       * Add colors and alert names
       * TODO: Maybe make colors better themed instead of just the "github style" - red and yellow could fit better than darker shades of green
       */
      let color = "#40c463"
      let alertName = "Normal"
      if (sgv >= urgenthighalert || sgv <= urgentlowalert) {
        color = "#216e39"
        alertName = sgv >= urgenthighalert ? "Urgent High" : "Urgent Low"
      }
      else if (sgv >= highalert || sgv <= lowalert) {
        color = "#30a14e"
        alertName = sgv >= highalert ? "High" : "Low"
      }
      resp.data[i].color = color
      resp.data[i].alert = alertName
    }
    return {data: resp.data.reverse()}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}

function addZero(i) {
  if (i < 10)
    i = `0${i}`

  return i
}

function directionArrow(direction) {
  const dir = direction.toUpperCase()
  switch (dir) {
    case "NONE":
      return ""
    case "DOUBLEUP":
      return "‚Üë‚Üë"
    case "SINGLEUP":
      return "‚Üë"
    case "FORTYFIVEUP":
      return "‚Üó"
    case "FLAT":
      return "‚Üí"
    case "FORTYFIVEDOWN":
      return "‚Üò"
    case "SINGLEDOWN":
      return "‚Üì"
    case "DOUBLEDOWN":
      return "‚Üì‚Üì"
    case "NOT COMPUTABLE":
      return ""
    case "RATE OUT OF RANGE":
      return ""
    default:
      return ""
  }
}
</file>

<file path="source/plugins/community/nightscout/metadata.yml">
name: üíâ Nightscout
category: community
description: |
  This plugin displays blood sugar values from a [Nightscout](http://nightscout.info) site.
disclaimer: |
  This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with [Nightscout](http://nightscout.info).
  All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.
examples:
  default: https://github.com/legoandmars/legoandmars/blob/master/metrics.plugin.nightscout.svg
authors:
  - legoandmars
supports:
  - user
scopes: []
inputs:

  plugin_nightscout:
    description: |
      Enable nightscout plugin
    type: boolean
    default: no

  plugin_nightscout_url:
    description: |
      Nightscout URL
    type: string
    default: https://example.herokuapp.com

  plugin_nightscout_datapoints:
    description: |
      Number of datapoints shown the graph
    type: number
    default: 12
    min: 0
    zero: disable

  plugin_nightscout_lowalert:
    description: |
      Threshold for low blood sugar
    type: number
    default: 80
    min: 0

  plugin_nightscout_highalert:
    description: |
      Threshold for high blood sugar
    type: number
    default: 180
    min: 0

  plugin_nightscout_urgentlowalert:
    description: |
      Threshold for urgently low blood sugar
    type: number
    default: 50
    min: 0

  plugin_nightscout_urgenthighalert:
    description: |
      Threshold for urgently high blood sugar
    type: number
    default: 250
    min: 0
</file>

<file path="source/plugins/community/poopmap/examples.yml">
- uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_poopmap_token: ${{ secrets.POOPMAP_TOKEN }}
    plugin_poopmap: yes
  prod:
    skip: true
</file>

<file path="source/plugins/community/poopmap/index.mjs">
//Setup
export default async function({q, imports, data, account}, {enabled = false, token = "", extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.poopmap) || (!imports.metadata.plugins.poopmap.enabled(enabled, {extras})))
      return null

    if (!token)
      return {poops: [], days: 7}

    const {days} = imports.metadata.plugins.poopmap.inputs({data, account, q})
    const {data: {poops}} = await imports.axios.get(`https://api.poopmap.net/api/v1/public_links/${token}`)

    const filteredPoops = poops.filter(poop => {
      const createdAt = new Date(poop.created_at)
      poop.created_at = createdAt.toString()
      return createdAt > new Date().getTime() - days * 24 * 60 * 60 * 1000
    })

    const hours = {max: 0}
    for (let i = 0; i < filteredPoops.length; i++) {
      const poop = filteredPoops[i]
      const hour = new Date(poop.created_at).getHours()
      hours[hour] = (hours[hour] ?? 0) + 1

      hours.max = Math.max(hours[hour], hours.max)
    }

    //Results
    return {poops: hours, days}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/community/poopmap/metadata.yml">
name: üí© PoopMap plugin
category: community
description: |
  This plugin displays statistics from a [PoopMap](https://poopmap.net) account.
disclaimer: |
  This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with [PoopMap](https://poopmap.net).
  All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.
examples:
  default: https://github.com/matievisthekat/matievisthekat/blob/master/metrics.plugin.poopmap.svg
authors:
  - matievisthekat
supports:
  - user
scopes: []
inputs:

  plugin_poopmap:
    description: |
      Enable poopmap plugin
    type: boolean
    default: no

  plugin_poopmap_token:
    description: |
      PoopMap API token
    type: token
    default: ""

  plugin_poopmap_days:
    description: |
      Time range
    type: number
    values:
      - 7
      - 30
      - 180
      - 365
    default: 7
</file>

<file path="source/plugins/community/screenshot/examples.yml">
- name: XKCD of the day
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.screenshot.svg
    token: NOT_NEEDED
    base: ""
    plugin_screenshot: yes
    plugin_screenshot_title: XKCD of the day
    plugin_screenshot_url: https://xkcd.com
    plugin_screenshot_selector: "#comic img"
  test:
    timeout: 1800000
    modes:
      - action
</file>

<file path="source/plugins/community/screenshot/index.mjs">
//Setup
export default async function({login, q, imports, data, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.screenshot) || (!imports.metadata.plugins.screenshot.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {url, selector, title, background, viewport, wait, mode} = imports.metadata.plugins.screenshot.inputs({data, account, q})
    if (!url)
      throw {error: {message: "URL is not set"}}

    //Start puppeteer and navigate to page
    console.debug(`metrics/compute/${login}/plugins > screenshot > starting browser`)
    const browser = await imports.puppeteer.launch()
    console.debug(`metrics/compute/${login}/plugins > screenshot > started ${await browser.version()}`)
    const page = await browser.newPage()
    await page.setViewport(viewport)
    console.debug(`metrics/compute/${login}/plugins > screenshot > loading ${url}`)
    await page.goto(url, {waitUntil: ["domcontentloaded", "networkidle2"]})
    if (wait)
      await new Promise(solve => setTimeout(solve, wait))

    //Screenshot
    let content = null
    let image = null
    const metadata = {height: null, width: null}
    await page.waitForSelector(selector)
    switch (mode) {
      case "image": {
        const clip = await page.evaluate(selector => {
          const {x, y, width, height} = document.querySelector(selector).getBoundingClientRect()
          return {x, y, width, height}
        }, selector)
        console.debug(`metrics/compute/${login}/plugins > screenshot > coordinates ${JSON.stringify(clip)}`)
        const [buffer] = await imports.record({page, ...clip, frames: 1, background})
        const screenshot = await imports.sharp(Buffer.from(buffer.split(",").pop(), "base64")).resize({width: Math.min(454 * (1 + data.large), clip.width)})
        image = `data:image/png;base64,${(await screenshot.toBuffer()).toString("base64")}`
        Object.assign(metadata, await screenshot.metadata())
        break
      }
      case "text": {
        content = await page.evaluate(selector => document.querySelector(selector)?.innerText ?? "", selector)
        break
      }
      default:
        throw {error: {message: `Unsupported mode "${mode}"`}}
    }

    await browser.close()

    //Results
    return {mode, image, content, title, height: metadata.height, width: metadata.width, url}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error, {title: "Screenshot error"})
  }
}
</file>

<file path="source/plugins/community/screenshot/metadata.yml">
name: üì∏ Website screenshot
category: community
description: |
  This plugin displays a screenshot from any website.

  It can either show the full page or a portion restricted by a [CSS selector](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors).
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.screenshot.svg
authors:
  - lowlighter
supports:
  - user
  - organization
  - repository
scopes: []
inputs:

  plugin_screenshot:
    description: |
      Enable screenshot plugin
    type: boolean
    default: no
    extras:
      - metrics.run.puppeteer.scrapping

  plugin_screenshot_title:
    description: |
      Title caption
    type: string
    default: Screenshot

  plugin_screenshot_url:
    description: |
      Website URL
    type: string
    default: ""
    example: https://metrics.lecoq.io

  plugin_screenshot_selector:
    description: |
      CSS Selector
    type: string
    default: body

  plugin_screenshot_mode:
    description: |
      Output mode

      - `image`: screenshot of selected element
      - `text`: keep [`innerText`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/innerText) of selected element
        - *‚ö†Ô∏è Any CSS style applied to text such as font size, weight or color will be removed*
    type: string
    default: image
    values:
      - image
      - text

  plugin_screenshot_viewport:
    description: |
      Viewport options
    type: json
    default: |
      {
        "width": 1280,
        "height": 1280
      }

  plugin_screenshot_wait:
    description: |
      Wait time before taking screenshot (ms)
    type: number
    min: 0
    default: 0

  plugin_screenshot_background:
    description: |
      Background
    type: boolean
    default: yes
</file>

<file path="source/plugins/community/splatoon/s3si/mocks/u_coop.json">
{
  "type": "COOP",
  "exportTime": "2023-01-19T00:00:00.000Z",
  "data": {
    "type": "CoopInfo",
    "listNode": {
      "weapons": [
        {
          "name": "Random",
          "image": {
            "url": {
              "pathname": "#"
            }
          }
        },
        {
          "name": "Random",
          "image": {
            "url": {
              "pathname": "#"
            }
          }
        },
        {
          "name": "Random",
          "image": {
            "url": {
              "pathname": "#"
            }
          }
        },
        {
          "name": "Random",
          "image": {
            "url": {
              "pathname": "#"
            }
          }
        }
      ],
      "nextHistoryDetail": {},
      "previousHistoryDetail": {},
      "resultWave": 3,
      "coopStage": {
        "name": "Marooner's Bay"
      },
      "afterGrade": {
        "name": "Eggsecutive VP"
      },
      "afterGradePoint": 100,
      "gradePointDiff": "KEEP",
      "bossResult": null,
      "myResult": {
        "deliverCount": 999,
        "goldenDeliverCount": 88
      },
      "memberResults": [
        {
          "deliverCount": 0,
          "goldenDeliverCount": 0
        },
        {
          "deliverCount": 0,
          "goldenDeliverCount": 0
        },
        {
          "deliverCount": 0,
          "goldenDeliverCount": 0
        }
      ]
    },
    "groupInfo": {
      "startTime": "2022-12-12T00:00:00Z",
      "endTime": "2022-12-13T16:00:00Z",
      "mode": "REGULAR",
      "rule": "REGULAR",
      "highestResult": {
        "grade": {
          "name": "Eggsecutive VP"
        },
        "gradePoint": 150,
        "jobScore": 120
      }
    },
    "detail": {
      "__typename": "CoopHistoryDetail",
      "afterGrade": {
        "name": "Eggsecutive VP"
      },
      "myResult": {
        "player": {
          "__isPlayer": "CoopPlayer",
          "byname": "The Usual Off the Hook Fan",
          "name": "Pearl",
          "nameId": "0000",
          "nameplate": {
            "badges": [
              null,
              null,
              null
            ],
            "background": {
              "textColor": {
                "a": 1,
                "b": 1,
                "g": 1,
                "r": 1
              },
              "image": {
                "url": {
                  "pathname": "#"
                }
              }
            }
          },
          "uniform": {
            "name": "Pink Slopsuit",
            "image": {
              "url": {
                "pathname": "#"
              }
            }
          },
          "species": "INKLING"
        },
        "weapons": [
          {
            "name": "Splat Dualies",
            "image": {
              "url": {
                "pathname": "#"
              }
            }
          },
          {
            "name": "Dark Tetra Dualies",
            "image": {
              "url": {
                "pathname": "#"
              }
            }
          },
          {
            "name": "Dapple Dualies",
            "image": {
              "url": {
                "pathname": "#"
              }
            }
          }
        ],
        "specialWeapon": {
          "name": "Booyah Bomb",
          "image": {
            "url": {
              "pathname": "#"
            }
          },
          "weaponId": 20006
        },
        "defeatEnemyCount": 16,
        "deliverCount": 777,
        "goldenAssistCount": 0,
        "goldenDeliverCount": 22,
        "rescueCount": 3,
        "rescuedCount": 2
      },
      "memberResults": [
        {
          "player": {
            "__isPlayer": "CoopPlayer",
            "byname": "",
            "name": "Player",
            "nameId": "0000",
            "nameplate": {
              "badges": [
                null,
                null,
                null
              ],
              "background": {
                "textColor": {
                  "a": 1,
                  "b": 1,
                  "g": 1,
                  "r": 1
                },
                "image": {
                  "url": {
                    "pathname": "#"
                  }
                }
              }
            },
            "uniform": {
              "name": "Orange Slopsuit",
              "image": {
                "url": {
                  "pathname": "#"
                }
              }
            },
            "species": "INKLING"
          },
          "weapons": [
            {
              "name": "Jet Squelcher",
              "image": {
                "url": {
                  "pathname": "#"
                }
              }
            },
            {
              "name": "Explosher",
              "image": {
                "url": {
                  "pathname": "#"
                }
              }
            },
            {
              "name": "Dark Tetra Dualies",
              "image": {
                "url": {
                  "pathname": "#"
                }
              }
            }
          ],
          "specialWeapon": {
            "name": "Unknown",
            "image": {
              "url": {
                "pathname": "#"
              }
            }
          },
          "defeatEnemyCount": 0,
          "deliverCount": 0,
          "goldenAssistCount": 0,
          "goldenDeliverCount": 0,
          "rescueCount": 0,
          "rescuedCount": 0
        }
      ],
      "bossResult": null,
      "enemyResults": [
        {
          "defeatCount": 1,
          "teamDefeatCount": 1,
          "popCount": 1,
          "enemy": {
            "name": "Flyfish",
            "image": {
              "url": {
                "pathname": "#"
              }
            }
          }
        },
        {
          "defeatCount": 2,
          "teamDefeatCount": 0,
          "popCount": 2,
          "enemy": {
            "name": "Scrapper",
            "image": {
              "url": {
                "pathname": "#"
              }
            }
          }
        },
        {
          "defeatCount": 1,
          "teamDefeatCount": 0,
          "popCount": 1,
          "enemy": {
            "name": "Steel Eel",
            "image": {
              "url": {
                "pathname": "#"
              }
            }
          }
        },
        {
          "defeatCount": 1,
          "teamDefeatCount": 0,
          "popCount": 1,
          "enemy": {
            "name": "Stinger",
            "image": {
              "url": {
                "pathname": "#"
              }
            }
          }
        },
        {
          "defeatCount": 3,
          "teamDefeatCount": 0,
          "popCount": 3,
          "enemy": {
            "name": "Drizzler",
            "image": {
              "url": {
                "pathname": "#"
              }
            }
          }
        },
        {
          "defeatCount": 2,
          "teamDefeatCount": 1,
          "popCount": 2,
          "enemy": {
            "name": "Slammin' Lid",
            "image": {
              "url": {
                "pathname": "#"
              }
            }
          }
        },
        {
          "defeatCount": 6,
          "teamDefeatCount": 8,
          "popCount": 6,
          "enemy": {
            "name": "Mudmouth",
            "image": {
              "url": {
                "pathname": "#"
              }
            }
          }
        }
      ],
      "waveResults": [
        {
          "waveNumber": 1,
          "waterLevel": 1,
          "eventWave": {
            "name": "Mudmouth Eruptions"
          },
          "deliverNorm": 21,
          "goldenPopCount": 63,
          "teamDeliverCount": 54,
          "specialWeapons": []
        },
        {
          "waveNumber": 2,
          "waterLevel": 1,
          "eventWave": {
            "name": "The Mothership"
          },
          "deliverNorm": 22,
          "goldenPopCount": 30,
          "teamDeliverCount": 26,
          "specialWeapons": [
            {
              "name": "Inkjet",
              "image": {
                "url": {
                  "pathname": "#"
                }
              }
            },
            {
              "name": "Inkjet",
              "image": {
                "url": {
                  "pathname": "#"
                }
              }
            },
            {
              "name": "Crab Tank",
              "image": {
                "url": {
                  "pathname": "#"
                }
              }
            }
          ]
        },
        {
          "waveNumber": 3,
          "waterLevel": 0,
          "eventWave": null,
          "deliverNorm": 24,
          "goldenPopCount": 28,
          "teamDeliverCount": 17,
          "specialWeapons": []
        }
      ],
      "resultWave": 3,
      "playedTime": "2022-12-12T00:00:00Z",
      "rule": "REGULAR",
      "coopStage": {
        "name": "Marooner's Bay",
        "image": {
          "url": {
            "pathname": "#"
          }
        }
      },
      "dangerRate": 2.22,
      "scenarioCode": null,
      "smellMeter": 0,
      "weapons": [
        {
          "name": "Random",
          "image": {
            "url": {
              "pathname": "#"
            }
          }
        },
        {
          "name": "Random",
          "image": {
            "url": {
              "pathname": "#"
            }
          }
        },
        {
          "name": "Random",
          "image": {
            "url": {
              "pathname": "#"
            }
          }
        },
        {
          "name": "Random",
          "image": {
            "url": {
              "pathname": "#"
            }
          }
        }
      ],
      "afterGradePoint": 100,
      "scale": null,
      "jobPoint": 0,
      "jobScore": 0,
      "jobRate": 1,
      "jobBonus": 0,
      "nextHistoryDetail": {},
      "previousHistoryDetail": {}
    }
  }
}
</file>

<file path="source/plugins/community/splatoon/s3si/mocks/u_summary.json">
{
  "type": "SUMMARY",
  "exportTime": "2023-01-19T00:00:00.000Z",
  "data": {
    "ConfigureAnalyticsQuery": {
      "playHistory": {
        "udemaeMax": "S+0",
        "paintPointTotal": 999999,
        "gameStartTime": "2022-09-09T00:00:00Z",
        "battleNumTotal": 333,
        "xMatchMaxAr": {
          "rank": null
        },
        "xMatchMaxCl": {
          "rank": null
        },
        "xMatchMaxGl": {
          "rank": null
        },
        "xMatchMaxLf": {
          "rank": null
        }
      }
    },
    "HistoryRecordQuery": {
      "currentPlayer": {
        "__isPlayer": "CurrentPlayer",
        "byname": "The Usual Off the Hook Fan",
        "name": "Pearl",
        "nameId": "0000",
        "nameplate": {
          "badges": [
            null,
            null,
            {
              "image": {
                "url": "https://cdn.wikimg.net/en/splatoonwiki/images/d/d4/S3_Banner_11076.png"
              }
            }
          ],
          "background": {
            "textColor": {
              "a": 1,
              "b": 1,
              "g": 1,
              "r": 1
            },
            "image": {
              "url": "https://cdn.wikimg.net/en/splatoonwiki/images/6/6a/S3_Banner_901.png"
            }
          }
        },
        "weapon": {
          "name": "Splat Dualies",
          "image": {
            "url": "https://cdn.wikimg.net/en/splatoonwiki/images/e/ec/S3_Weapon_Main_Splat_Dualies_Flat.png"
          },
          "subWeapon": {
            "name": "Suction Bomb",
            "image": {
              "url": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/f/f2/S3_Weapon_Sub_Suction_Bomb_Flat.png/24px-S3_Weapon_Sub_Suction_Bomb_Flat.png"
            }
          },
          "specialWeapon": {
            "name": "Crab Tank",
            "image": {
              "url": "https://cdn.wikimg.net/en/splatoonwiki/images/8/88/S3_Weapon_Special_Crab_Tank.png"
            }
          }
        },
        "headGear": {
          "__isGear": "HeadGear",
          "name": "Pearlescent Crown",
          "image": {
            "url": "https://cdn.wikimg.net/en/splatoonwiki/images/3/3c/S3_Gear_Headgear_Pearlescent_Crown_S.png"
          },
          "primaryGearPower": {
            "name": "Last-Ditch Effort",
            "image": {
              "url": "https://cdn.wikimg.net/en/splatoonwiki/images/c/c7/S3_Ability_Last-Ditch_Effort.png"
            }
          },
          "additionalGearPowers": [
            {
              "name": "Quick Respawn",
              "image": {
                "url": "https://cdn.wikimg.net/en/splatoonwiki/images/9/98/S3_Ability_Quick_Respawn.png"
              }
            },
            {
              "name": "Quick Respawn",
              "image": {
                "url": "https://cdn.wikimg.net/en/splatoonwiki/images/9/98/S3_Ability_Quick_Respawn.png"
              }
            },
            {
              "name": "Quick Respawn",
              "image": {
                "url": "https://cdn.wikimg.net/en/splatoonwiki/images/9/98/S3_Ability_Quick_Respawn.png"
              }
            }
          ]
        },
        "clothingGear": {
          "__isGear": "ClothingGear",
          "name": "Pearlescent Hoodie",
          "image": {
            "url": "https://cdn.wikimg.net/en/splatoonwiki/images/4/42/S3_Gear_Clothing_Pearlescent_Hoodie.png"
          },
          "primaryGearPower": {
            "name": "Respawn Punisher",
            "image": {
              "url": "https://cdn.wikimg.net/en/splatoonwiki/images/6/68/S3_Ability_Respawn_Punisher.png"
            }
          },
          "additionalGearPowers": [
            {
              "name": "Quick Respawn",
              "image": {
                "url": "https://cdn.wikimg.net/en/splatoonwiki/images/9/98/S3_Ability_Quick_Respawn.png"
              }
            },
            {
              "name": "Quick Respawn",
              "image": {
                "url": "https://cdn.wikimg.net/en/splatoonwiki/images/9/98/S3_Ability_Quick_Respawn.png"
              }
            },
            {
              "name": "Quick Respawn",
              "image": {
                "url": "https://cdn.wikimg.net/en/splatoonwiki/images/9/98/S3_Ability_Quick_Respawn.png"
              }
            }
          ]
        },
        "shoesGear": {
          "__isGear": "ShoesGear",
          "name": "Pearlescent Kicks",
          "image": {
            "url": "https://cdn.wikimg.net/en/splatoonwiki/images/6/64/S3_Gear_Shoes_Pearlescent_Kicks.png"
          },
          "primaryGearPower": {
            "name": "Stealth Jump",
            "image": {
              "url": "https://cdn.wikimg.net/en/splatoonwiki/images/5/5a/S3_Ability_Stealth_Jump.png"
            }
          },
          "additionalGearPowers": [
            {
              "name": "Quick Super Jump",
              "image": {
                "url": "https://cdn.wikimg.net/en/splatoonwiki/images/d/d5/S3_Ability_Quick_Super_Jump.png"
              }
            },
            {
              "name": "Ink Resistance Up",
              "image": {
                "url": "https://cdn.wikimg.net/en/splatoonwiki/images/6/6d/S3_Ability_Ink_Resistance_Up.png"
              }
            },
            {
              "name": "Sub Resistance Up",
              "image": {
                "url": "https://cdn.wikimg.net/en/splatoonwiki/images/d/d4/S3_Ability_Sub_Resistance_Up.png"
              }
            }
          ]
        },
        "userIcon": {
          "url": "https://cdn-image-e0d67c509fb203858ebcb2fe3f88c2aa.baas.nintendo.com/1/3d2fd3bbdd21df80"
        }
      },
      "playHistory": {
        "currentTime": "2023-01-01T00:00:00Z",
        "gameStartTime": "2022-09-09T00:00:00Z",
        "rank": 50,
        "udemae": "S+0",
        "xMatchRankAr": null,
        "xMatchRankCl": null,
        "xMatchRankGl": null,
        "xMatchRankLf": null,
        "udemaeMax": "S+0",
        "xMatchMaxAr": {
          "power": null,
          "rank": null,
          "rankUpdateSeasonName": null,
          "powerUpdateTime": null
        },
        "xMatchMaxCl": {
          "power": null,
          "rank": null,
          "rankUpdateSeasonName": null,
          "powerUpdateTime": null
        },
        "xMatchMaxGl": {
          "power": null,
          "rank": null,
          "rankUpdateSeasonName": null,
          "powerUpdateTime": null
        },
        "xMatchMaxLf": {
          "power": null,
          "rank": null,
          "rankUpdateSeasonName": null,
          "powerUpdateTime": null
        },
        "winCountTotal": 333,
        "frequentlyUsedWeapons": [
          {
            "name": "Splat Dualies",
            "image": {
              "url": "https://cdn.wikimg.net/en/splatoonwiki/images/e/ec/S3_Weapon_Main_Splat_Dualies_Flat.png"
            }
          }
        ],
        "paintPointTotal": 999999,
        "badges": [],
        "weaponHistory": {
          "nodes": [
            {
              "seasonName": "Chill Season 2022",
              "isMonthly": true,
              "startTime": "2022-12-01T00:00:00Z",
              "endTime": "2022-12-12T01:18:48Z",
              "weaponCategories": [
                {
                  "weaponCategory": {
                    "name": "Dualies",
                    "category": "Maneuver"
                  },
                  "utilRatio": 1,
                  "weapons": [
                    {
                      "weapon": {
                        "name": "Splat Dualies",
                        "image": {
                          "url": "https://cdn.wikimg.net/en/splatoonwiki/images/e/ec/S3_Weapon_Main_Splat_Dualies_Flat.png"
                        },
                        "weaponCategory": {
                          "category": "Maneuver"
                        }
                      },
                      "utilRatio": 0.846
                    },
                    {
                      "weapon": {
                        "name": "Dark Tetra Dualies",
                        "image": {
                          "url": "https://cdn.wikimg.net/en/splatoonwiki/images/2/2a/S3_Weapon_Main_Dark_Tetra_Dualies_Flat.png"
                        },
                        "weaponCategory": {
                          "category": "Maneuver"
                        }
                      },
                      "utilRatio": 0.154
                    }
                  ]
                }
              ],
              "weapons": [
                {
                  "weapon": {
                    "name": "Splat Dualies",
                    "image": {
                      "url": "https://cdn.wikimg.net/en/splatoonwiki/images/e/ec/S3_Weapon_Main_Splat_Dualies_Flat.png"
                    }
                  },
                  "utilRatio": 0.846
                },
                {
                  "weapon": {
                    "name": "Dark Tetra Dualies",
                    "image": {
                      "url": "https://cdn.wikimg.net/en/splatoonwiki/images/2/2a/S3_Weapon_Main_Dark_Tetra_Dualies_Flat.png"
                    }
                  },
                  "utilRatio": 0.154
                }
              ]
            }
          ]
        },
        "recentBadges": [
          {
            "id": "QmFkZ2UtNTEwMDAwMQ==",
            "image": {
              "url": "https://cdn.wikimg.net/en/splatoonwiki/images/2/20/S3_Badge_Grizzco_100K.png"
            },
            "description": "100,000 Grizzco Point Club"
          }
        ],
        "allBadges": [
          {
            "image": {
              "url": "https://cdn.wikimg.net/en/splatoonwiki/images/4/4a/S3_Badge_Splat_Dualies_5.png"
            },
            "description": "5‚òÖ Splat Dualies User"
          },
          {
            "image": {
              "url": "https://cdn.wikimg.net/en/splatoonwiki/images/4/47/S3_Badge_Rank_S%2B.png"
            },
            "description": "S+ Rank Reached!"
          },
          {
            "image": {
              "url": "https://cdn.wikimg.net/en/splatoonwiki/images/2/20/S3_Badge_Grizzco_100K.png"
            },
            "description": "100,000 Grizzco Point Club"
          }
        ]
      }
    },
    "CoopHistoryQuery": {
      "coopResult": {
        "historyGroupsOnlyFirst": {
          "nodes": []
        },
        "regularAverageClearWave": 2,
        "regularGrade": {
          "name": "Eggsecutive VP"
        },
        "regularGradePoint": 100,
        "monthlyGear": {
          "__typename": "HeadGear",
          "name": "Bream-Brim Cap",
          "image": {
            "url": "https://cdn.wikimg.net/en/splatoonwiki/images/6/6d/S3_Gear_Headgear_Bream-Brim_Cap.png"
          }
        },
        "scale": {
          "gold": 0,
          "silver": 0,
          "bronze": 0
        },
        "pointCard": {
          "defeatBossCount": 199,
          "deliverCount": 1234567,
          "goldenDeliverCount": 34567,
          "playCount": 444,
          "rescueCount": 1234,
          "regularPoint": 0,
          "totalPoint": 100000
        },
        "historyGroups": {
          "nodes": []
        }
      }
    }
  }
}
</file>

<file path="source/plugins/community/splatoon/s3si/mocks/u_vs.json">
{
  "type": "VS",
  "exportTime": "2023-01-19T00:00:00.000Z",
  "data": {
    "type": "VsInfo",
    "bankaraMatchChallenge": {
      "winCount": 3,
      "loseCount": 0,
      "maxWinCount": 5,
      "maxLoseCount": 3,
      "state": "INPROGRESS",
      "isPromo": false,
      "isUdemaeUp": null,
      "udemaeAfter": null,
      "earnedUdemaePoint": null
    },
    "listNode": {
      "vsMode": {
        "mode": "BANKARA"
      },
      "vsRule": {
        "name": "Splat Zones"
      },
      "vsStage": {
        "name": "Inkblot Art Academy",
        "image": {}
      },
      "judgement": "WIN",
      "player": {
        "weapon": {
          "name": "Splat Dualies",
          "image": {}
        }
      },
      "knockout": "WIN",
      "myTeam": {
        "result": {
          "paintPoint": null,
          "paintRatio": null,
          "score": 100
        }
      },
      "udemae": "S+0",
      "bankaraMatch": {
        "earnedUdemaePoint": null
      },
      "nextHistoryDetail": null,
      "previousHistoryDetail": {}
    },
    "challengeProgress": {
      "index": 0,
      "winCount": 3,
      "loseCount": 0
    },
    "rankState": null,
    "rankBeforeState": null,
    "detail": {
      "__typename": "VsHistoryDetail",
      "vsRule": {
        "name": "Splat Zones",
        "rule": "AREA"
      },
      "vsMode": {
        "mode": "BANKARA"
      },
      "player": {
        "__isPlayer": "VsPlayer",
        "byname": "The Usual Off the Hook Fan",
        "name": "Pearl",
        "nameId": "0000",
        "nameplate": {
          "badges": [
            null,
            null,
            null
          ],
          "background": {
            "textColor": {
              "a": 1,
              "b": 1,
              "g": 1,
              "r": 1
            },
            "image": {}
          }
        },
        "headGear": {
          "name": "Pearlescent Crown",
          "image": {},
          "__isGear": "HeadGear",
          "primaryGearPower": {
            "name": "Last-Ditch Effort",
            "image": {}
          },
          "additionalGearPowers": [
            {
              "name": "Quick Respawn",
              "image": {}
            },
            {
              "name": "Quick Respawn",
              "image": {}
            },
            {
              "name": "Quick Respawn",
              "image": {}
            }
          ],
          "originalImage": {},
          "brand": {
            "name": "amiibo",
            "image": {},
            "usualGearPower": {
              "name": "Unknown",
              "desc": "Unlock this ability by battling while wearing this gear.",
              "image": {},
              "isEmptySlot": true
            }
          }
        },
        "clothingGear": {
          "name": "Pearlescent Hoodie",
          "image": {},
          "__isGear": "ClothingGear",
          "primaryGearPower": {
            "name": "Respawn Punisher",
            "image": {}
          },
          "additionalGearPowers": [
            {
              "name": "Quick Respawn",
              "image": {}
            },
            {
              "name": "Quick Respawn",
              "image": {}
            },
            {
              "name": "Quick Respawn",
              "image": {}
            }
          ],
          "originalImage": {},
          "brand": {
            "name": "amiibo",
            "image": {},
            "usualGearPower": {
              "name": "Unknown",
              "desc": "Unlock this ability by battling while wearing this gear.",
              "image": {},
              "isEmptySlot": true
            }
          }
        },
        "shoesGear": {
          "name": "Pearlescent Kicks",
          "image": {},
          "__isGear": "ShoesGear",
          "primaryGearPower": {
            "name": "Stealth Jump",
            "image": {}
          },
          "additionalGearPowers": [
            {
              "name": "Quick Super Jump",
              "image": {}
            },
            {
              "name": "Ink Resistance Up",
              "image": {}
            },
            {
              "name": "Sub Resistance Up",
              "image": {}
            }
          ],
          "originalImage": {},
          "brand": {
            "name": "amiibo",
            "image": {},
            "usualGearPower": {
              "name": "Unknown",
              "desc": "Unlock this ability by battling while wearing this gear.",
              "image": {},
              "isEmptySlot": true
            }
          }
        },
        "paint": 888
      },
      "judgement": "WIN",
      "myTeam": {
        "color": {
          "a": 1,
          "b": 0.454901993,
          "g": 0.176470593,
          "r": 0.756862819
        },
        "judgement": "WIN",
        "result": {
          "paintRatio": null,
          "score": 100,
          "noroshi": null
        },
        "tricolorRole": null,
        "festTeamName": null,
        "players": [
          {
            "nameId": "0000",
            "name": "Pearl",
            "isMyself": true,
            "byname": "The Usual Off the Hook Fan",
            "weapon": {
              "name": "Splat Dualies",
              "image": {},
              "specialWeapon": {
                "maskingImage": {
                  "width": 100,
                  "height": 100
                },
                "name": "Crab Tank",
                "image": {}
              },
              "image3d": {},
              "image2d": {},
              "image3dThumbnail": {},
              "image2dThumbnail": {},
              "subWeapon": {
                "name": "Suction Bomb",
                "image": {}
              }
            },
            "species": "INKLING",
            "__isPlayer": "VsPlayer",
            "nameplate": {
              "badges": [
                null,
                null,
                null
              ],
              "background": {
                "textColor": {
                  "a": 1,
                  "b": 1,
                  "g": 1,
                  "r": 1
                },
                "image": {}
              }
            },
            "headGear": {
              "name": "Pearlescent Crown",
              "image": {},
              "__isGear": "HeadGear",
              "primaryGearPower": {
                "name": "Last-Ditch Effort",
                "image": {}
              },
              "additionalGearPowers": [
                {
                  "name": "Quick Respawn",
                  "image": {}
                },
                {
                  "name": "Quick Respawn",
                  "image": {}
                },
                {
                  "name": "Quick Respawn",
                  "image": {}
                }
              ],
              "originalImage": {},
              "brand": {
                "name": "amiibo",
                "image": {},
                "usualGearPower": {
                  "name": "Unknown",
                  "desc": "Unlock this ability by battling while wearing this gear.",
                  "image": {},
                  "isEmptySlot": true
                }
              }
            },
            "clothingGear": {
              "name": "Pearlescent Hoodie",
              "image": {},
              "__isGear": "ClothingGear",
              "primaryGearPower": {
                "name": "Respawn Punisher",
                "image": {}
              },
              "additionalGearPowers": [
                {
                  "name": "Quick Respawn",
                  "image": {}
                },
                {
                  "name": "Quick Respawn",
                  "image": {}
                },
                {
                  "name": "Quick Respawn",
                  "image": {}
                }
              ],
              "originalImage": {},
              "brand": {
                "name": "amiibo",
                "image": {},
                "usualGearPower": {
                  "name": "Unknown",
                  "desc": "Unlock this ability by battling while wearing this gear.",
                  "image": {},
                  "isEmptySlot": true
                }
              }
            },
            "shoesGear": {
              "name": "Pearlescent Kicks",
              "image": {},
              "__isGear": "ShoesGear",
              "primaryGearPower": {
                "name": "Stealth Jump",
                "image": {}
              },
              "additionalGearPowers": [
                {
                  "name": "Quick Super Jump",
                  "image": {}
                },
                {
                  "name": "Ink Resistance Up",
                  "image": {}
                },
                {
                  "name": "Sub Resistance Up",
                  "image": {}
                }
              ],
              "originalImage": {},
              "brand": {
                "name": "amiibo",
                "image": {},
                "usualGearPower": {
                  "name": "Unknown",
                  "desc": "Unlock this ability by battling while wearing this gear.",
                  "image": {},
                  "isEmptySlot": true
                }
              }
            },
            "paint": 888,
            "result": {
              "kill": 8,
              "death": 3,
              "assist": 4,
              "special": 1,
              "noroshiTry": null
            },
            "festDragonCert": "NONE",
            "__typename": "VsPlayer"
          }
        ],
        "order": 1
      },
      "vsStage": {
        "name": "Inkblot Art Academy",
        "image": {}
      },
      "festMatch": null,
      "knockout": "WIN",
      "otherTeams": [
        {
          "judgement": "LOSE",
          "color": {
            "a": 1,
            "b": 0.133333296,
            "g": 0.721568584,
            "r": 0.172549993
          },
          "result": {
            "paintRatio": null,
            "score": 0,
            "noroshi": null
          },
          "tricolorRole": null,
          "players": [
            {
              "nameId": "0000",
              "name": "Marina",
              "isMyself": false,
              "byname": "",
              "weapon": {
                "name": "Splattershot",
                "image": {},
                "specialWeapon": {
                  "maskingImage": {
                    "width": 100,
                    "height": 100
                  },
                  "name": "Trizooka",
                  "image": {}
                },
                "image3d": {},
                "image2d": {},
                "image3dThumbnail": {},
                "image2dThumbnail": {},
                "subWeapon": {
                  "name": "Suction Bomb",
                  "image": {}
                }
              },
              "species": "OCTOLING",
              "__isPlayer": "VsPlayer",
              "nameplate": {
                "badges": [
                  null,
                  null,
                  null
                ],
                "background": {
                  "textColor": {
                    "a": 1,
                    "b": 1,
                    "g": 1,
                    "r": 1
                  },
                  "image": {}
                }
              },
              "headGear": {
                "name": "Unknown",
                "thumbnailImage": {},
                "__isGear": "HeadGear",
                "primaryGearPower": {
                  "name": "Unknown",
                  "image": {}
                },
                "additionalGearPowers": [
                  {
                    "name": "Unknown",
                    "image": {}
                  },
                  {
                    "name": "Unknown",
                    "image": {}
                  },
                  {
                    "name": "Unknown",
                    "image": {}
                  }
                ],
                "originalImage": {},
                "brand": {
                  "name": "amiibo",
                  "image": {},
                  "usualGearPower": {
                    "name": "Unknown",
                    "desc": "Unlock this ability by battling while wearing this gear.",
                    "image": {},
                    "isEmptySlot": true
                  }
                }
              },
              "clothingGear": {
                "name": "Unknown",
                "thumbnailImage": {},
                "__isGear": "ClothingGear",
                "primaryGearPower": {
                  "name": "Unknown",
                  "image": {}
                },
                "additionalGearPowers": [
                  {
                    "name": "Unknown",
                    "image": {}
                  },
                  {
                    "name": "Unknown",
                    "image": {}
                  },
                  {
                    "name": "Unknown",
                    "image": {}
                  }
                ],
                "originalImage": {},
                "brand": {
                  "name": "amiibo",
                  "image": {},
                  "usualGearPower": {
                    "name": "Unknown",
                    "desc": "Unlock this ability by battling while wearing this gear.",
                    "image": {},
                    "isEmptySlot": true
                  }
                }
              },
              "shoesGear": {
                "name": "Unknown",
                "thumbnailImage": {},
                "__isGear": "ShoesGear",
                "primaryGearPower": {
                  "name": "Unknown",
                  "image": {}
                },
                "additionalGearPowers": [
                  {
                    "name": "Unknown",
                    "image": {}
                  },
                  {
                    "name": "Unknown",
                    "image": {}
                  },
                  {
                    "name": "Unknown",
                    "image": {}
                  }
                ],
                "originalImage": {},
                "brand": {
                  "name": "amiibo",
                  "image": {},
                  "usualGearPower": {
                    "name": "Unknown",
                    "desc": "Unlock this ability by battling while wearing this gear.",
                    "image": {},
                    "isEmptySlot": true
                  }
                }
              },
              "paint": 0,
              "result": {
                "kill": 0,
                "death": 0,
                "assist": 0,
                "special": 0,
                "noroshiTry": null
              },
              "festDragonCert": "NONE",
              "__typename": "VsPlayer"
            }
          ],
          "order": 2,
          "festTeamName": null
        }
      ],
      "bankaraMatch": {
        "earnedUdemaePoint": null,
        "mode": "CHALLENGE"
      },
      "xMatch": null,
      "duration": 69,
      "playedTime": "2023-01-19T00:00:00.000Z",
      "awards": [
        {
          "name": "#1 Popular Target",
          "rank": "GOLD"
        },
        {
          "name": "#1 Score Booster",
          "rank": "GOLD"
        },
        {
          "name": "#1 Damage Taker",
          "rank": "SILVER"
        }
      ],
      "leagueMatch": null,
      "nextHistoryDetail": null,
      "previousHistoryDetail": {}
    }
  }
}
</file>

<file path="source/plugins/community/splatoon/s3si/.gitignore">
cache
export
profile.json
</file>

<file path="source/plugins/community/splatoon/s3si/LICENSE.md">
GNU GENERAL PUBLIC LICENSE
                       Version 3, 29 June 2007

 Copyright (C) 2007 Free Software Foundation, Inc. <https://fsf.org/>
 Everyone is permitted to copy and distribute verbatim copies
 of this license document, but changing it is not allowed.

                            Preamble

  The GNU General Public License is a free, copyleft license for
software and other kinds of works.

  The licenses for most software and other practical works are designed
to take away your freedom to share and change the works.  By contrast,
the GNU General Public License is intended to guarantee your freedom to
share and change all versions of a program--to make sure it remains free
software for all its users.  We, the Free Software Foundation, use the
GNU General Public License for most of our software; it applies also to
any other work released this way by its authors.  You can apply it to
your programs, too.

  When we speak of free software, we are referring to freedom, not
price.  Our General Public Licenses are designed to make sure that you
have the freedom to distribute copies of free software (and charge for
them if you wish), that you receive source code or can get it if you
want it, that you can change the software or use pieces of it in new
free programs, and that you know you can do these things.

  To protect your rights, we need to prevent others from denying you
these rights or asking you to surrender the rights.  Therefore, you have
certain responsibilities if you distribute copies of the software, or if
you modify it: responsibilities to respect the freedom of others.

  For example, if you distribute copies of such a program, whether
gratis or for a fee, you must pass on to the recipients the same
freedoms that you received.  You must make sure that they, too, receive
or can get the source code.  And you must show them these terms so they
know their rights.

  Developers that use the GNU GPL protect your rights with two steps:
(1) assert copyright on the software, and (2) offer you this License
giving you legal permission to copy, distribute and/or modify it.

  For the developers' and authors' protection, the GPL clearly explains
that there is no warranty for this free software.  For both users' and
authors' sake, the GPL requires that modified versions be marked as
changed, so that their problems will not be attributed erroneously to
authors of previous versions.

  Some devices are designed to deny users access to install or run
modified versions of the software inside them, although the manufacturer
can do so.  This is fundamentally incompatible with the aim of
protecting users' freedom to change the software.  The systematic
pattern of such abuse occurs in the area of products for individuals to
use, which is precisely where it is most unacceptable.  Therefore, we
have designed this version of the GPL to prohibit the practice for those
products.  If such problems arise substantially in other domains, we
stand ready to extend this provision to those domains in future versions
of the GPL, as needed to protect the freedom of users.

  Finally, every program is threatened constantly by software patents.
States should not allow patents to restrict development and use of
software on general-purpose computers, but in those that do, we wish to
avoid the special danger that patents applied to a free program could
make it effectively proprietary.  To prevent this, the GPL assures that
patents cannot be used to render the program non-free.

  The precise terms and conditions for copying, distribution and
modification follow.

                       TERMS AND CONDITIONS

  0. Definitions.

  "This License" refers to version 3 of the GNU General Public License.

  "Copyright" also means copyright-like laws that apply to other kinds of
works, such as semiconductor masks.

  "The Program" refers to any copyrightable work licensed under this
License.  Each licensee is addressed as "you".  "Licensees" and
"recipients" may be individuals or organizations.

  To "modify" a work means to copy from or adapt all or part of the work
in a fashion requiring copyright permission, other than the making of an
exact copy.  The resulting work is called a "modified version" of the
earlier work or a work "based on" the earlier work.

  A "covered work" means either the unmodified Program or a work based
on the Program.

  To "propagate" a work means to do anything with it that, without
permission, would make you directly or secondarily liable for
infringement under applicable copyright law, except executing it on a
computer or modifying a private copy.  Propagation includes copying,
distribution (with or without modification), making available to the
public, and in some countries other activities as well.

  To "convey" a work means any kind of propagation that enables other
parties to make or receive copies.  Mere interaction with a user through
a computer network, with no transfer of a copy, is not conveying.

  An interactive user interface displays "Appropriate Legal Notices"
to the extent that it includes a convenient and prominently visible
feature that (1) displays an appropriate copyright notice, and (2)
tells the user that there is no warranty for the work (except to the
extent that warranties are provided), that licensees may convey the
work under this License, and how to view a copy of this License.  If
the interface presents a list of user commands or options, such as a
menu, a prominent item in the list meets this criterion.

  1. Source Code.

  The "source code" for a work means the preferred form of the work
for making modifications to it.  "Object code" means any non-source
form of a work.

  A "Standard Interface" means an interface that either is an official
standard defined by a recognized standards body, or, in the case of
interfaces specified for a particular programming language, one that
is widely used among developers working in that language.

  The "System Libraries" of an executable work include anything, other
than the work as a whole, that (a) is included in the normal form of
packaging a Major Component, but which is not part of that Major
Component, and (b) serves only to enable use of the work with that
Major Component, or to implement a Standard Interface for which an
implementation is available to the public in source code form.  A
"Major Component", in this context, means a major essential component
(kernel, window system, and so on) of the specific operating system
(if any) on which the executable work runs, or a compiler used to
produce the work, or an object code interpreter used to run it.

  The "Corresponding Source" for a work in object code form means all
the source code needed to generate, install, and (for an executable
work) run the object code and to modify the work, including scripts to
control those activities.  However, it does not include the work's
System Libraries, or general-purpose tools or generally available free
programs which are used unmodified in performing those activities but
which are not part of the work.  For example, Corresponding Source
includes interface definition files associated with source files for
the work, and the source code for shared libraries and dynamically
linked subprograms that the work is specifically designed to require,
such as by intimate data communication or control flow between those
subprograms and other parts of the work.

  The Corresponding Source need not include anything that users
can regenerate automatically from other parts of the Corresponding
Source.

  The Corresponding Source for a work in source code form is that
same work.

  2. Basic Permissions.

  All rights granted under this License are granted for the term of
copyright on the Program, and are irrevocable provided the stated
conditions are met.  This License explicitly affirms your unlimited
permission to run the unmodified Program.  The output from running a
covered work is covered by this License only if the output, given its
content, constitutes a covered work.  This License acknowledges your
rights of fair use or other equivalent, as provided by copyright law.

  You may make, run and propagate covered works that you do not
convey, without conditions so long as your license otherwise remains
in force.  You may convey covered works to others for the sole purpose
of having them make modifications exclusively for you, or provide you
with facilities for running those works, provided that you comply with
the terms of this License in conveying all material for which you do
not control copyright.  Those thus making or running the covered works
for you must do so exclusively on your behalf, under your direction
and control, on terms that prohibit them from making any copies of
your copyrighted material outside their relationship with you.

  Conveying under any other circumstances is permitted solely under
the conditions stated below.  Sublicensing is not allowed; section 10
makes it unnecessary.

  3. Protecting Users' Legal Rights From Anti-Circumvention Law.

  No covered work shall be deemed part of an effective technological
measure under any applicable law fulfilling obligations under article
11 of the WIPO copyright treaty adopted on 20 December 1996, or
similar laws prohibiting or restricting circumvention of such
measures.

  When you convey a covered work, you waive any legal power to forbid
circumvention of technological measures to the extent such circumvention
is effected by exercising rights under this License with respect to
the covered work, and you disclaim any intention to limit operation or
modification of the work as a means of enforcing, against the work's
users, your or third parties' legal rights to forbid circumvention of
technological measures.

  4. Conveying Verbatim Copies.

  You may convey verbatim copies of the Program's source code as you
receive it, in any medium, provided that you conspicuously and
appropriately publish on each copy an appropriate copyright notice;
keep intact all notices stating that this License and any
non-permissive terms added in accord with section 7 apply to the code;
keep intact all notices of the absence of any warranty; and give all
recipients a copy of this License along with the Program.

  You may charge any price or no price for each copy that you convey,
and you may offer support or warranty protection for a fee.

  5. Conveying Modified Source Versions.

  You may convey a work based on the Program, or the modifications to
produce it from the Program, in the form of source code under the
terms of section 4, provided that you also meet all of these conditions:

    a) The work must carry prominent notices stating that you modified
    it, and giving a relevant date.

    b) The work must carry prominent notices stating that it is
    released under this License and any conditions added under section
    7.  This requirement modifies the requirement in section 4 to
    "keep intact all notices".

    c) You must license the entire work, as a whole, under this
    License to anyone who comes into possession of a copy.  This
    License will therefore apply, along with any applicable section 7
    additional terms, to the whole of the work, and all its parts,
    regardless of how they are packaged.  This License gives no
    permission to license the work in any other way, but it does not
    invalidate such permission if you have separately received it.

    d) If the work has interactive user interfaces, each must display
    Appropriate Legal Notices; however, if the Program has interactive
    interfaces that do not display Appropriate Legal Notices, your
    work need not make them do so.

  A compilation of a covered work with other separate and independent
works, which are not by their nature extensions of the covered work,
and which are not combined with it such as to form a larger program,
in or on a volume of a storage or distribution medium, is called an
"aggregate" if the compilation and its resulting copyright are not
used to limit the access or legal rights of the compilation's users
beyond what the individual works permit.  Inclusion of a covered work
in an aggregate does not cause this License to apply to the other
parts of the aggregate.

  6. Conveying Non-Source Forms.

  You may convey a covered work in object code form under the terms
of sections 4 and 5, provided that you also convey the
machine-readable Corresponding Source under the terms of this License,
in one of these ways:

    a) Convey the object code in, or embodied in, a physical product
    (including a physical distribution medium), accompanied by the
    Corresponding Source fixed on a durable physical medium
    customarily used for software interchange.

    b) Convey the object code in, or embodied in, a physical product
    (including a physical distribution medium), accompanied by a
    written offer, valid for at least three years and valid for as
    long as you offer spare parts or customer support for that product
    model, to give anyone who possesses the object code either (1) a
    copy of the Corresponding Source for all the software in the
    product that is covered by this License, on a durable physical
    medium customarily used for software interchange, for a price no
    more than your reasonable cost of physically performing this
    conveying of source, or (2) access to copy the
    Corresponding Source from a network server at no charge.

    c) Convey individual copies of the object code with a copy of the
    written offer to provide the Corresponding Source.  This
    alternative is allowed only occasionally and noncommercially, and
    only if you received the object code with such an offer, in accord
    with subsection 6b.

    d) Convey the object code by offering access from a designated
    place (gratis or for a charge), and offer equivalent access to the
    Corresponding Source in the same way through the same place at no
    further charge.  You need not require recipients to copy the
    Corresponding Source along with the object code.  If the place to
    copy the object code is a network server, the Corresponding Source
    may be on a different server (operated by you or a third party)
    that supports equivalent copying facilities, provided you maintain
    clear directions next to the object code saying where to find the
    Corresponding Source.  Regardless of what server hosts the
    Corresponding Source, you remain obligated to ensure that it is
    available for as long as needed to satisfy these requirements.

    e) Convey the object code using peer-to-peer transmission, provided
    you inform other peers where the object code and Corresponding
    Source of the work are being offered to the general public at no
    charge under subsection 6d.

  A separable portion of the object code, whose source code is excluded
from the Corresponding Source as a System Library, need not be
included in conveying the object code work.

  A "User Product" is either (1) a "consumer product", which means any
tangible personal property which is normally used for personal, family,
or household purposes, or (2) anything designed or sold for incorporation
into a dwelling.  In determining whether a product is a consumer product,
doubtful cases shall be resolved in favor of coverage.  For a particular
product received by a particular user, "normally used" refers to a
typical or common use of that class of product, regardless of the status
of the particular user or of the way in which the particular user
actually uses, or expects or is expected to use, the product.  A product
is a consumer product regardless of whether the product has substantial
commercial, industrial or non-consumer uses, unless such uses represent
the only significant mode of use of the product.

  "Installation Information" for a User Product means any methods,
procedures, authorization keys, or other information required to install
and execute modified versions of a covered work in that User Product from
a modified version of its Corresponding Source.  The information must
suffice to ensure that the continued functioning of the modified object
code is in no case prevented or interfered with solely because
modification has been made.

  If you convey an object code work under this section in, or with, or
specifically for use in, a User Product, and the conveying occurs as
part of a transaction in which the right of possession and use of the
User Product is transferred to the recipient in perpetuity or for a
fixed term (regardless of how the transaction is characterized), the
Corresponding Source conveyed under this section must be accompanied
by the Installation Information.  But this requirement does not apply
if neither you nor any third party retains the ability to install
modified object code on the User Product (for example, the work has
been installed in ROM).

  The requirement to provide Installation Information does not include a
requirement to continue to provide support service, warranty, or updates
for a work that has been modified or installed by the recipient, or for
the User Product in which it has been modified or installed.  Access to a
network may be denied when the modification itself materially and
adversely affects the operation of the network or violates the rules and
protocols for communication across the network.

  Corresponding Source conveyed, and Installation Information provided,
in accord with this section must be in a format that is publicly
documented (and with an implementation available to the public in
source code form), and must require no special password or key for
unpacking, reading or copying.

  7. Additional Terms.

  "Additional permissions" are terms that supplement the terms of this
License by making exceptions from one or more of its conditions.
Additional permissions that are applicable to the entire Program shall
be treated as though they were included in this License, to the extent
that they are valid under applicable law.  If additional permissions
apply only to part of the Program, that part may be used separately
under those permissions, but the entire Program remains governed by
this License without regard to the additional permissions.

  When you convey a copy of a covered work, you may at your option
remove any additional permissions from that copy, or from any part of
it.  (Additional permissions may be written to require their own
removal in certain cases when you modify the work.)  You may place
additional permissions on material, added by you to a covered work,
for which you have or can give appropriate copyright permission.

  Notwithstanding any other provision of this License, for material you
add to a covered work, you may (if authorized by the copyright holders of
that material) supplement the terms of this License with terms:

    a) Disclaiming warranty or limiting liability differently from the
    terms of sections 15 and 16 of this License; or

    b) Requiring preservation of specified reasonable legal notices or
    author attributions in that material or in the Appropriate Legal
    Notices displayed by works containing it; or

    c) Prohibiting misrepresentation of the origin of that material, or
    requiring that modified versions of such material be marked in
    reasonable ways as different from the original version; or

    d) Limiting the use for publicity purposes of names of licensors or
    authors of the material; or

    e) Declining to grant rights under trademark law for use of some
    trade names, trademarks, or service marks; or

    f) Requiring indemnification of licensors and authors of that
    material by anyone who conveys the material (or modified versions of
    it) with contractual assumptions of liability to the recipient, for
    any liability that these contractual assumptions directly impose on
    those licensors and authors.

  All other non-permissive additional terms are considered "further
restrictions" within the meaning of section 10.  If the Program as you
received it, or any part of it, contains a notice stating that it is
governed by this License along with a term that is a further
restriction, you may remove that term.  If a license document contains
a further restriction but permits relicensing or conveying under this
License, you may add to a covered work material governed by the terms
of that license document, provided that the further restriction does
not survive such relicensing or conveying.

  If you add terms to a covered work in accord with this section, you
must place, in the relevant source files, a statement of the
additional terms that apply to those files, or a notice indicating
where to find the applicable terms.

  Additional terms, permissive or non-permissive, may be stated in the
form of a separately written license, or stated as exceptions;
the above requirements apply either way.

  8. Termination.

  You may not propagate or modify a covered work except as expressly
provided under this License.  Any attempt otherwise to propagate or
modify it is void, and will automatically terminate your rights under
this License (including any patent licenses granted under the third
paragraph of section 11).

  However, if you cease all violation of this License, then your
license from a particular copyright holder is reinstated (a)
provisionally, unless and until the copyright holder explicitly and
finally terminates your license, and (b) permanently, if the copyright
holder fails to notify you of the violation by some reasonable means
prior to 60 days after the cessation.

  Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.

  Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, you do not qualify to receive new licenses for the same
material under section 10.

  9. Acceptance Not Required for Having Copies.

  You are not required to accept this License in order to receive or
run a copy of the Program.  Ancillary propagation of a covered work
occurring solely as a consequence of using peer-to-peer transmission
to receive a copy likewise does not require acceptance.  However,
nothing other than this License grants you permission to propagate or
modify any covered work.  These actions infringe copyright if you do
not accept this License.  Therefore, by modifying or propagating a
covered work, you indicate your acceptance of this License to do so.

  10. Automatic Licensing of Downstream Recipients.

  Each time you convey a covered work, the recipient automatically
receives a license from the original licensors, to run, modify and
propagate that work, subject to this License.  You are not responsible
for enforcing compliance by third parties with this License.

  An "entity transaction" is a transaction transferring control of an
organization, or substantially all assets of one, or subdividing an
organization, or merging organizations.  If propagation of a covered
work results from an entity transaction, each party to that
transaction who receives a copy of the work also receives whatever
licenses to the work the party's predecessor in interest had or could
give under the previous paragraph, plus a right to possession of the
Corresponding Source of the work from the predecessor in interest, if
the predecessor has it or can get it with reasonable efforts.

  You may not impose any further restrictions on the exercise of the
rights granted or affirmed under this License.  For example, you may
not impose a license fee, royalty, or other charge for exercise of
rights granted under this License, and you may not initiate litigation
(including a cross-claim or counterclaim in a lawsuit) alleging that
any patent claim is infringed by making, using, selling, offering for
sale, or importing the Program or any portion of it.

  11. Patents.

  A "contributor" is a copyright holder who authorizes use under this
License of the Program or a work on which the Program is based.  The
work thus licensed is called the contributor's "contributor version".

  A contributor's "essential patent claims" are all patent claims
owned or controlled by the contributor, whether already acquired or
hereafter acquired, that would be infringed by some manner, permitted
by this License, of making, using, or selling its contributor version,
but do not include claims that would be infringed only as a
consequence of further modification of the contributor version.  For
purposes of this definition, "control" includes the right to grant
patent sublicenses in a manner consistent with the requirements of
this License.

  Each contributor grants you a non-exclusive, worldwide, royalty-free
patent license under the contributor's essential patent claims, to
make, use, sell, offer for sale, import and otherwise run, modify and
propagate the contents of its contributor version.

  In the following three paragraphs, a "patent license" is any express
agreement or commitment, however denominated, not to enforce a patent
(such as an express permission to practice a patent or covenant not to
sue for patent infringement).  To "grant" such a patent license to a
party means to make such an agreement or commitment not to enforce a
patent against the party.

  If you convey a covered work, knowingly relying on a patent license,
and the Corresponding Source of the work is not available for anyone
to copy, free of charge and under the terms of this License, through a
publicly available network server or other readily accessible means,
then you must either (1) cause the Corresponding Source to be so
available, or (2) arrange to deprive yourself of the benefit of the
patent license for this particular work, or (3) arrange, in a manner
consistent with the requirements of this License, to extend the patent
license to downstream recipients.  "Knowingly relying" means you have
actual knowledge that, but for the patent license, your conveying the
covered work in a country, or your recipient's use of the covered work
in a country, would infringe one or more identifiable patents in that
country that you have reason to believe are valid.

  If, pursuant to or in connection with a single transaction or
arrangement, you convey, or propagate by procuring conveyance of, a
covered work, and grant a patent license to some of the parties
receiving the covered work authorizing them to use, propagate, modify
or convey a specific copy of the covered work, then the patent license
you grant is automatically extended to all recipients of the covered
work and works based on it.

  A patent license is "discriminatory" if it does not include within
the scope of its coverage, prohibits the exercise of, or is
conditioned on the non-exercise of one or more of the rights that are
specifically granted under this License.  You may not convey a covered
work if you are a party to an arrangement with a third party that is
in the business of distributing software, under which you make payment
to the third party based on the extent of your activity of conveying
the work, and under which the third party grants, to any of the
parties who would receive the covered work from you, a discriminatory
patent license (a) in connection with copies of the covered work
conveyed by you (or copies made from those copies), or (b) primarily
for and in connection with specific products or compilations that
contain the covered work, unless you entered into that arrangement,
or that patent license was granted, prior to 28 March 2007.

  Nothing in this License shall be construed as excluding or limiting
any implied license or other defenses to infringement that may
otherwise be available to you under applicable patent law.

  12. No Surrender of Others' Freedom.

  If conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot convey a
covered work so as to satisfy simultaneously your obligations under this
License and any other pertinent obligations, then as a consequence you may
not convey it at all.  For example, if you agree to terms that obligate you
to collect a royalty for further conveying from those to whom you convey
the Program, the only way you could satisfy both those terms and this
License would be to refrain entirely from conveying the Program.

  13. Use with the GNU Affero General Public License.

  Notwithstanding any other provision of this License, you have
permission to link or combine any covered work with a work licensed
under version 3 of the GNU Affero General Public License into a single
combined work, and to convey the resulting work.  The terms of this
License will continue to apply to the part which is the covered work,
but the special requirements of the GNU Affero General Public License,
section 13, concerning interaction through a network will apply to the
combination as such.

  14. Revised Versions of this License.

  The Free Software Foundation may publish revised and/or new versions of
the GNU General Public License from time to time.  Such new versions will
be similar in spirit to the present version, but may differ in detail to
address new problems or concerns.

  Each version is given a distinguishing version number.  If the
Program specifies that a certain numbered version of the GNU General
Public License "or any later version" applies to it, you have the
option of following the terms and conditions either of that numbered
version or of any later version published by the Free Software
Foundation.  If the Program does not specify a version number of the
GNU General Public License, you may choose any version ever published
by the Free Software Foundation.

  If the Program specifies that a proxy can decide which future
versions of the GNU General Public License can be used, that proxy's
public statement of acceptance of a version permanently authorizes you
to choose that version for the Program.

  Later license versions may give you additional or different
permissions.  However, no additional obligations are imposed on any
author or copyright holder as a result of your choosing to follow a
later version.

  15. Disclaimer of Warranty.

  THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT
HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY
OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,
THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM
IS WITH YOU.  SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF
ALL NECESSARY SERVICING, REPAIR OR CORRECTION.

  16. Limitation of Liability.

  IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS
THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY
GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE
USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF
DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD
PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS),
EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF
SUCH DAMAGES.

  17. Interpretation of Sections 15 and 16.

  If the disclaimer of warranty and limitation of liability provided
above cannot be given local legal effect according to their terms,
reviewing courts shall apply local law that most closely approximates
an absolute waiver of all civil liability in connection with the
Program, unless a warranty or assumption of liability accompanies a
copy of the Program in return for a fee.

                     END OF TERMS AND CONDITIONS

            How to Apply These Terms to Your New Programs

  If you develop a new program, and you want it to be of the greatest
possible use to the public, the best way to achieve this is to make it
free software which everyone can redistribute and change under these terms.

  To do so, attach the following notices to the program.  It is safest
to attach them to the start of each source file to most effectively
state the exclusion of warranty; and each file should have at least
the "copyright" line and a pointer to where the full notice is found.

    <one line to give the program's name and a brief idea of what it does.>
    Copyright (C) <year>  <name of author>

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.

Also add information on how to contact you by electronic and paper mail.

  If the program does terminal interaction, make it output a short
notice like this when it starts in an interactive mode:

    <program>  Copyright (C) <year>  <name of author>
    This program comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
    This is free software, and you are welcome to redistribute it
    under certain conditions; type `show c' for details.

The hypothetical commands `show w' and `show c' should show the appropriate
parts of the General Public License.  Of course, your program's commands
might be different; for a GUI interface, you would use an "about box".

  You should also get your employer (if you work as a programmer) or school,
if any, to sign a "copyright disclaimer" for the program, if necessary.
For more information on this, and how to apply and follow the GNU GPL, see
<https://www.gnu.org/licenses/>.

  The GNU General Public License does not permit incorporating your program
into proprietary programs.  If your program is a subroutine library, you
may consider it more useful to permit linking proprietary applications with
the library.  If this is what you want to do, use the GNU Lesser General
Public License instead of this License.  But first, please read
<https://www.gnu.org/licenses/why-not-lgpl.html>.
</file>

<file path="source/plugins/community/splatoon/assets.mjs">
//Assets
export default {
  //Stages icons
  stages: {
    //Salmon run
    "Sockeye Station": "https://cdn.wikimg.net/en/splatoonwiki/images/1/1d/S3_Stage_Sockeye_Station.png",
    "Gone Fission Hydroplant": "https://cdn.wikimg.net/en/splatoonwiki/images/7/7c/S3_Stage_Gone_Fission_Hydroplant.png",
    "Spawning Grounds": "https://cdn.wikimg.net/en/splatoonwiki/images/f/f4/S3_Stage_Spawning_Grounds.png",
    "Marooner's Bay": "https://cdn.wikimg.net/en/splatoonwiki/images/0/01/S3_Stage_Marooner%27s_Bay.png",
    //Versus
    "Scorch Gorge": "https://cdn.wikimg.net/en/splatoonwiki/images/1/1c/S3_Stage_Scorch_Gorge.png",
    "Eeltail Alley": "https://cdn.wikimg.net/en/splatoonwiki/images/7/7d/S3_Stage_Eeltail_Alley.png",
    "Hagglefish Market": "https://cdn.wikimg.net/en/splatoonwiki/images/a/ad/S3_Stage_Hagglefish_Market.png",
    "Undertow Spillway": "https://cdn.wikimg.net/en/splatoonwiki/images/a/ad/S3_Stage_Undertow_Spillway.png",
    "Mincemeat Metalworks": "https://cdn.wikimg.net/en/splatoonwiki/images/d/d1/S3_Stage_Mincemeat_Metalworks.png",
    "Hammerhead Bridge": "https://cdn.wikimg.net/en/splatoonwiki/images/9/94/S3_Stage_Hammerhead_Bridge.png",
    "Museum d'Alfonsino": "https://cdn.wikimg.net/en/splatoonwiki/images/6/6a/S3_Stage_Museum_d%27Alfonsino.png",
    "Mahi-Mahi Resort": "https://cdn.wikimg.net/en/splatoonwiki/images/6/6b/S3_Stage_Mahi-Mahi_Resort.png",
    "Inkblot Art Academy": "https://cdn.wikimg.net/en/splatoonwiki/images/4/45/S3_Stage_Inkblot_Art_Academy.png",
    "Sturgeon Shipyard": "https://cdn.wikimg.net/en/splatoonwiki/images/4/45/S3_Stage_Sturgeon_Shipyard.png",
    MakoMart: "https://cdn.wikimg.net/en/splatoonwiki/images/4/47/S3_Stage_MakoMart.png",
    "Wahoo World": "https://cdn.wikimg.net/en/splatoonwiki/images/7/71/S3_Stage_Wahoo_World.png",
    "Brinewater Springs": "https://cdn.wikimg.net/en/splatoonwiki/images/b/bf/S3_Brinewater_Springs.png",
    "Flounder Heights": "https://cdn.wikimg.net/en/splatoonwiki/images/2/23/S3_Stage_Flounder_Heights.png",
    "Um'ami Ruins": "https://cdn.wikimg.net/en/splatoonwiki/images/9/95/S3_Stage_Um%27ami_Ruins.png",
    "Manta Maria": "https://cdn.wikimg.net/en/splatoonwiki/images/8/86/S3_Stage_Manta_Maria.png",
  },
  //Game modes
  modes: {
    "Splat Zones": "https://cdn.wikimg.net/en/splatoonwiki/images/3/38/S3_icon_Splat_Zones.png",
    "Tower Control": "https://cdn.wikimg.net/en/splatoonwiki/images/b/bc/S3_icon_Tower_Control.png",
    Rainmaker: "https://cdn.wikimg.net/en/splatoonwiki/images/1/12/S3_icon_Rainmaker.png",
    "Clam Blitz": "https://cdn.wikimg.net/en/splatoonwiki/images/e/e3/S3_icon_Clam_Blitz.png",
    "Turf War": "https://cdn.wikimg.net/en/splatoonwiki/images/7/7e/S3_Badge_Turf_War_50.png",
  },
  //Flat weapons icons
  weapons: {
    ".52 Gal": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/e/e3/S3_Weapon_Main_.52_Gal_Flat.png/120px-S3_Weapon_Main_.52_Gal_Flat.png",
    ".96 Gal": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/8/88/S3_Weapon_Main_.96_Gal_Flat.png/120px-S3_Weapon_Main_.96_Gal_Flat.png",
    ".96 Gal Deco": "https://cdn.wikimg.net/en/splatoonwiki/images/0/05/S3_Weapon_Main_.96_Gal_Deco_Flat.png",
    "Aerospray MG": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/0/0e/S3_Weapon_Main_Aerospray_MG_Flat.png/120px-S3_Weapon_Main_Aerospray_MG_Flat.png",
    "Aerospray RG": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/2/27/S3_Weapon_Main_Aerospray_RG_Flat.png/120px-S3_Weapon_Main_Aerospray_RG_Flat.png",
    "Ballpoint Splatling": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/7/78/S3_Weapon_Main_Ballpoint_Splatling_Flat.png/120px-S3_Weapon_Main_Ballpoint_Splatling_Flat.png",
    "Bamboozler 14 Mk I": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/a/a1/S3_Weapon_Main_Bamboozler_14_Mk_I_Flat.png/120px-S3_Weapon_Main_Bamboozler_14_Mk_I_Flat.png",
    "Big Swig Roller": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/7/71/S3_Weapon_Main_Big_Swig_Roller_Flat.png/120px-S3_Weapon_Main_Big_Swig_Roller_Flat.png",
    Blaster: "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/9/94/S3_Weapon_Main_Blaster_Flat.png/120px-S3_Weapon_Main_Blaster_Flat.png",
    Bloblobber: "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/d/dd/S3_Weapon_Main_Bloblobber_Flat.png/120px-S3_Weapon_Main_Bloblobber_Flat.png",
    "Carbon Roller Deco": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/a/a7/S3_Weapon_Main_Carbon_Roller_Deco_Flat.png/120px-S3_Weapon_Main_Carbon_Roller_Deco_Flat.png",
    "Carbon Roller": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/7/77/S3_Weapon_Main_Carbon_Roller_Flat.png/120px-S3_Weapon_Main_Carbon_Roller_Flat.png",
    "Clash Blaster": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/a/a3/S3_Weapon_Main_Clash_Blaster_Flat.png/120px-S3_Weapon_Main_Clash_Blaster_Flat.png",
    "Clash Blaster Neo": "https://cdn.wikimg.net/en/splatoonwiki/images/e/ef/S3_Weapon_Main_Clash_Blaster_Neo_Flat.png",
    "Classic Squiffer": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/4/48/S3_Weapon_Main_Classic_Squiffer_Flat.png/120px-S3_Weapon_Main_Classic_Squiffer_Flat.png",
    "Custom Splattershot Jr.": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/2/24/S3_Weapon_Main_Custom_Splattershot_Jr._Flat.png/120px-S3_Weapon_Main_Custom_Splattershot_Jr._Flat.png",
    "Custom Jet Squelcher": "https://cdn.wikimg.net/en/splatoonwiki/images/f/fc/S3_Weapon_Main_Custom_Jet_Squelcher_Flat.png",
    "Dapple Dualies": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/a/a0/S3_Weapon_Main_Dapple_Dualies_Flat.png/120px-S3_Weapon_Main_Dapple_Dualies_Flat.png",
    "Dapple Dualies Nouveau": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/a/a5/S3_Weapon_Main_Dapple_Dualies_Nouveau_Flat.png/120px-S3_Weapon_Main_Dapple_Dualies_Nouveau_Flat.png",
    "Dark Tetra Dualies": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/2/2a/S3_Weapon_Main_Dark_Tetra_Dualies_Flat.png/120px-S3_Weapon_Main_Dark_Tetra_Dualies_Flat.png",
    "Dualie Squelchers": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/0/05/S3_Weapon_Main_Dualie_Squelchers_Flat.png/120px-S3_Weapon_Main_Dualie_Squelchers_Flat.png",
    "Dynamo Roller": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/0/0d/S3_Weapon_Main_Dynamo_Roller_Flat.png/120px-S3_Weapon_Main_Dynamo_Roller_Flat.png",
    "E-liter 4K": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/a/ad/S3_Weapon_Main_E-liter_4K_Flat.png/120px-S3_Weapon_Main_E-liter_4K_Flat.png",
    "E-liter 4K Scope": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/4/41/S3_Weapon_Main_E-liter_4K_Scope_Flat.png/120px-S3_Weapon_Main_E-liter_4K_Scope_Flat.png",
    Explosher: "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/7/77/S3_Weapon_Main_Explosher_Flat.png/120px-S3_Weapon_Main_Explosher_Flat.png",
    "Flingza Roller": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/f/f3/S3_Weapon_Main_Flingza_Roller_Flat.png/120px-S3_Weapon_Main_Flingza_Roller_Flat.png",
    "Forge Splattershot Pro": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/3/34/S3_Weapon_Main_Forge_Splattershot_Pro_Flat.png/120px-S3_Weapon_Main_Forge_Splattershot_Pro_Flat.png",
    "Glooga Dualies": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/8/8a/S3_Weapon_Main_Glooga_Dualies_Flat.png/120px-S3_Weapon_Main_Glooga_Dualies_Flat.png",
    "Goo Tuber": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/a/a0/S3_Weapon_Main_Goo_Tuber_Flat.png/120px-S3_Weapon_Main_Goo_Tuber_Flat.png",
    "Grizzco Blaster": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/c/ca/S3_Weapon_Main_Grizzco_Blaster_Flat.png/120px-S3_Weapon_Main_Grizzco_Blaster_Flat.png",
    "Grizzco Brella": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/1/18/S3_Weapon_Main_Grizzco_Brella_Flat.png/120px-S3_Weapon_Main_Grizzco_Brella_Flat.png",
    "Grizzco Charger": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/5/5f/S3_Weapon_Main_Grizzco_Charger_Flat.png/120px-S3_Weapon_Main_Grizzco_Charger_Flat.png",
    "Grizzco Slosher": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/8/83/S3_Weapon_Main_Grizzco_Slosher_Flat.png/120px-S3_Weapon_Main_Grizzco_Slosher_Flat.png",
    "Grizzco Splatana": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/e/eb/S3_Weapon_Main_Grizzco_Splatana_Flat.png/120px-S3_Weapon_Main_Grizzco_Splatana_Flat.png",
    "Grizzco Stringer": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/6/64/S3_Weapon_Main_Grizzco_Stringer_Flat.png/120px-S3_Weapon_Main_Grizzco_Stringer_Flat.png",
    "H-3 Nozzlenose": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/e/e6/S3_Weapon_Main_H-3_Nozzlenose_Flat.png/120px-S3_Weapon_Main_H-3_Nozzlenose_Flat.png",
    "Heavy Splatling": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/e/e4/S3_Weapon_Main_Heavy_Splatling_Flat.png/120px-S3_Weapon_Main_Heavy_Splatling_Flat.png",
    "Hero Shot Level 1": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/3/38/S3_Weapon_Main_Hero_Shot_Level_1_Flat.png/120px-S3_Weapon_Main_Hero_Shot_Level_1_Flat.png",
    "Hero Shot Replica": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/4/49/S3_Weapon_Main_Hero_Shot_Replica_Flat.png/120px-S3_Weapon_Main_Hero_Shot_Replica_Flat.png",
    "Hydra Splatling": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/b/b3/S3_Weapon_Main_Hydra_Splatling_Flat.png/120px-S3_Weapon_Main_Hydra_Splatling_Flat.png",
    Inkbrush: "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/e/e8/S3_Weapon_Main_Inkbrush_Flat.png/120px-S3_Weapon_Main_Inkbrush_Flat.png",
    "Inkbrush Nouveau": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/4/47/S3_Weapon_Main_Inkbrush_Nouveau_Flat.png/120px-S3_Weapon_Main_Inkbrush_Nouveau_Flat.png",
    "Jet Squelcher": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/8/80/S3_Weapon_Main_Jet_Squelcher_Flat.png/120px-S3_Weapon_Main_Jet_Squelcher_Flat.png",
    "Krak-On Splat Roller": "https://cdn.wikimg.net/en/splatoonwiki/images/b/bc/S3_Weapon_Main_Krak-On_Splat_Roller_Flat.png",
    "L-3 Nozzlenose": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/b/bd/S3_Weapon_Main_L-3_Nozzlenose_Flat.png/120px-S3_Weapon_Main_L-3_Nozzlenose_Flat.png",
    "L-3 Nozzlenose D": "https://cdn.wikimg.net/en/splatoonwiki/images/b/bd/S3_Weapon_Main_L-3_Nozzlenose_D_Flat.png",
    "Luna Blaster": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/8/8e/S3_Weapon_Main_Luna_Blaster_Flat.png/120px-S3_Weapon_Main_Luna_Blaster_Flat.png",
    "Luna Blaster Neo": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/7/73/S3_Weapon_Main_Luna_Blaster_Neo_Flat.png/120px-S3_Weapon_Main_Luna_Blaster_Neo_Flat.png",
    "Mini Splatling": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/1/16/S3_Weapon_Main_Mini_Splatling_Flat.png/120px-S3_Weapon_Main_Mini_Splatling_Flat.png",
    "N-ZAP '85": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/9/97/S3_Weapon_Main_N-ZAP_%2785_Flat.png/120px-S3_Weapon_Main_N-ZAP_%2785_Flat.png",
    "N-ZAP '89": "https://cdn.wikimg.net/en/splatoonwiki/images/b/b2/S3_Weapon_Main_N-ZAP_%2789_Flat.png",
    "Nautilus 47": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/b/be/S3_Weapon_Main_Nautilus_47_Flat.png/120px-S3_Weapon_Main_Nautilus_47_Flat.png",
    "Neo Splash-o-matic": "https://cdn.wikimg.net/en/splatoonwiki/images/a/a9/S3_Weapon_Main_Neo_Splash-o-matic_Flat.png",
    Octobrush: "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/9/9a/S3_Weapon_Main_Octobrush_Flat.png/120px-S3_Weapon_Main_Octobrush_Flat.png",
    "Range Blaster": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/7/7c/S3_Weapon_Main_Range_Blaster_Flat.png/120px-S3_Weapon_Main_Range_Blaster_Flat.png",
    "Rapid Blaster": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/d/dc/S3_Weapon_Main_Rapid_Blaster_Flat.png/120px-S3_Weapon_Main_Rapid_Blaster_Flat.png",
    "Rapid Blaster Deco": "https://cdn.wikimg.net/en/splatoonwiki/images/c/c8/S3_Weapon_Main_Rapid_Blaster_Deco_Flat.png",
    "Rapid Blaster Pro": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/7/71/S3_Weapon_Main_Rapid_Blaster_Pro_Flat.png/120px-S3_Weapon_Main_Rapid_Blaster_Pro_Flat.png",
    "REEF-LUX 450": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/6/68/S3_Weapon_Main_REEF-LUX_450_Flat.png/120px-S3_Weapon_Main_REEF-LUX_450_Flat.png",
    "Slosher Deco": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/7/71/S3_Weapon_Main_Slosher_Deco_Flat.png/120px-S3_Weapon_Main_Slosher_Deco_Flat.png",
    Slosher: "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/b/b8/S3_Weapon_Main_Slosher_Flat.png/120px-S3_Weapon_Main_Slosher_Flat.png",
    "Sloshing Machine": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/8/8c/S3_Weapon_Main_Sloshing_Machine_Flat.png/120px-S3_Weapon_Main_Sloshing_Machine_Flat.png",
    "Snipewriter 5H": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/3/31/S3_Weapon_Main_Snipewriter_5H_Flat.png/120px-S3_Weapon_Main_Snipewriter_5H_Flat.png",
    "Splash-o-matic": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/8/85/S3_Weapon_Main_Splash-o-matic_Flat.png/120px-S3_Weapon_Main_Splash-o-matic_Flat.png",
    "Splat Brella": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/0/02/S3_Weapon_Main_Splat_Brella_Flat.png/120px-S3_Weapon_Main_Splat_Brella_Flat.png",
    "Splat Charger": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/4/43/S3_Weapon_Main_Splat_Charger_Flat.png/120px-S3_Weapon_Main_Splat_Charger_Flat.png",
    "Splat Dualies": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/e/ec/S3_Weapon_Main_Splat_Dualies_Flat.png/120px-S3_Weapon_Main_Splat_Dualies_Flat.png",
    "Splat Roller": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/c/c7/S3_Weapon_Main_Splat_Roller_Flat.png/120px-S3_Weapon_Main_Splat_Roller_Flat.png",
    "Splatana Stamper": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/5/52/S3_Weapon_Main_Splatana_Stamper_Flat.png/120px-S3_Weapon_Main_Splatana_Stamper_Flat.png",
    "Splatana Wiper": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/6/67/S3_Weapon_Main_Splatana_Wiper_Flat.png/120px-S3_Weapon_Main_Splatana_Wiper_Flat.png",
    Splatterscope: "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/8/82/S3_Weapon_Main_Splatterscope_Flat.png/120px-S3_Weapon_Main_Splatterscope_Flat.png",
    Splattershot: "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/9/9c/S3_Weapon_Main_Splattershot_Flat.png/120px-S3_Weapon_Main_Splattershot_Flat.png",
    "Splattershot Jr.": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/0/04/S3_Weapon_Main_Splattershot_Jr._Flat.png/120px-S3_Weapon_Main_Splattershot_Jr._Flat.png",
    "Splattershot Nova": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/1/1a/S3_Weapon_Main_Splattershot_Nova_Flat.png/120px-S3_Weapon_Main_Splattershot_Nova_Flat.png",
    "Splattershot Pro": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/b/bd/S3_Weapon_Main_Splattershot_Pro_Flat.png/120px-S3_Weapon_Main_Splattershot_Pro_Flat.png",
    "Sploosh-o-matic": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/0/01/S3_Weapon_Main_Sploosh-o-matic_Flat.png/120px-S3_Weapon_Main_Sploosh-o-matic_Flat.png",
    Squeezer: "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/0/05/S3_Weapon_Main_Squeezer_Flat.png/120px-S3_Weapon_Main_Squeezer_Flat.png",
    "Tenta Brella": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/5/53/S3_Weapon_Main_Tenta_Brella_Flat.png/120px-S3_Weapon_Main_Tenta_Brella_Flat.png",
    "Tentatek Splattershot": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/8/83/S3_Weapon_Main_Tentatek_Splattershot_Flat.png/120px-S3_Weapon_Main_Tentatek_Splattershot_Flat.png",
    "Tri-Slosher": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/0/0e/S3_Weapon_Main_Tri-Slosher_Flat.png/120px-S3_Weapon_Main_Tri-Slosher_Flat.png",
    "Tri-Slosher Nouveau": "https://cdn.wikimg.net/en/splatoonwiki/images/0/05/S3_Weapon_Main_Tri-Slosher_Nouveau_Flat.png",
    "Tri-Stringer": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/a/a9/S3_Weapon_Main_Tri-Stringer_Flat.png/120px-S3_Weapon_Main_Tri-Stringer_Flat.png",
    "Undercover Brella": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/8/8c/S3_Weapon_Main_Undercover_Brella_Flat.png/120px-S3_Weapon_Main_Undercover_Brella_Flat.png",
    "Z+F Splat Charger": "https://cdn.wikimg.net/en/splatoonwiki/images/b/ba/S3_Weapon_Main_Z%2BF_Splat_Charger_Flat.png",
    "Z+F Splatterscope": "https://cdn.wikimg.net/en/splatoonwiki/images/b/b4/S3_Weapon_Main_Z%2BF_Splatterscope_Flat.png",
    "Zink Mini Splatling": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/6/65/S3_Weapon_Main_Zink_Mini_Splatling_Flat.png/120px-S3_Weapon_Main_Zink_Mini_Splatling_Flat.png",
  },
  //Subweapons icons
  subweapons: {
    "Angle Shooter": "https://cdn.wikimg.net/en/splatoonwiki/images/3/3a/S3_Weapon_Sub_Angle_Shooter_Flat.png",
    Autobomb: "https://cdn.wikimg.net/en/splatoonwiki/images/6/6d/S3_Weapon_Sub_Autobomb_Flat.png",
    "Burst Bomb": "https://cdn.wikimg.net/en/splatoonwiki/images/3/3a/S3_Weapon_Sub_Burst_Bomb_Flat.png",
    "Curling Bomb": "https://cdn.wikimg.net/en/splatoonwiki/images/1/11/S3_Weapon_Sub_Curling_Bomb_Flat.png",
    "Fizzy Bomb": "https://cdn.wikimg.net/en/splatoonwiki/images/c/c4/S3_Weapon_Sub_Fizzy_Bomb_Flat.png",
    "Ink Mine": "https://cdn.wikimg.net/en/splatoonwiki/images/9/90/S3_Weapon_Sub_Ink_Mine_Flat.png",
    "Point Sensor": "https://cdn.wikimg.net/en/splatoonwiki/images/d/dd/S3_Weapon_Sub_Point_Sensor_Flat.png",
    "Splash Wall": "https://cdn.wikimg.net/en/splatoonwiki/images/e/e8/S3_Weapon_Sub_Splash_Wall_Flat.png",
    "Splat Bomb": "https://cdn.wikimg.net/en/splatoonwiki/images/8/81/S3_Weapon_Sub_Splat_Bomb_Flat.png",
    Sprinkler: "https://cdn.wikimg.net/en/splatoonwiki/images/d/de/S3_Weapon_Sub_Sprinkler_Flat.png",
    "Squid Beakon": "https://cdn.wikimg.net/en/splatoonwiki/images/f/f1/S3_Weapon_Sub_Squid_Beakon_Flat.png",
    "Suction Bomb": "https://cdn.wikimg.net/en/splatoonwiki/images/f/f2/S3_Weapon_Sub_Suction_Bomb_Flat.png",
    Torpedo: "https://cdn.wikimg.net/en/splatoonwiki/images/0/06/S3_Weapon_Sub_Torpedo_Flat.png",
    "Toxic Mist": "https://cdn.wikimg.net/en/splatoonwiki/images/6/6f/S3_Weapon_Sub_Toxic_Mist_Flat.png",
  },
  //Specials icons
  specials: {
    "Big Bubbler": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/e/ef/S3_Weapon_Special_Big_Bubbler.png/120px-S3_Weapon_Special_Big_Bubbler.png",
    "Booyah Bomb": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/0/00/S3_Weapon_Special_Booyah_Bomb.png/120px-S3_Weapon_Special_Booyah_Bomb.png",
    "Crab Tank": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/8/88/S3_Weapon_Special_Crab_Tank.png/120px-S3_Weapon_Special_Crab_Tank.png",
    "Ink Storm": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/6/69/S3_Weapon_Special_Ink_Storm.png/120px-S3_Weapon_Special_Ink_Storm.png",
    "Ink Vac": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/c/cf/S3_Weapon_Special_Ink_Vac.png/120px-S3_Weapon_Special_Ink_Vac.png",
    Inkjet: "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/8/80/S3_Weapon_Special_Inkjet.png/120px-S3_Weapon_Special_Inkjet.png",
    "Killer Wail 5.1": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/1/1a/S3_Weapon_Special_Killer_Wail_5.1.png/120px-S3_Weapon_Special_Killer_Wail_5.1.png",
    "Kraken Royale": "https://cdn.wikimg.net/en/splatoonwiki/images/c/c1/S3_Weapon_Special_Kraken_Royale.png",
    Rainmaker: "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/b/b8/S3_Weapon_Special_Rainmaker.png/120px-S3_Weapon_Special_Rainmaker.png",
    Reefslider: "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/1/10/S3_Weapon_Special_Reefslider.png/120px-S3_Weapon_Special_Reefslider.png",
    Splashdown: "https://cdn.wikimg.net/en/splatoonwiki/images/2/23/S3_Weapon_Special_Splashdown.png",
    "Super Chump": "https://cdn.wikimg.net/en/splatoonwiki/images/8/8c/S3_Weapon_Special_Super_Chump.png",
    Tacticooler: "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/c/c0/S3_Weapon_Special_Tacticooler.png/120px-S3_Weapon_Special_Tacticooler.png",
    "Tenta Missiles": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/3/3b/S3_Weapon_Special_Tenta_Missiles.png/120px-S3_Weapon_Special_Tenta_Missiles.png",
    "Triple Inkstrike": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/3/3a/S3_Weapon_Special_Triple_Inkstrike.png/120px-S3_Weapon_Special_Triple_Inkstrike.png",
    Trizooka: "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/9/93/S3_Weapon_Special_Trizooka.png/120px-S3_Weapon_Special_Trizooka.png",
    "Ultra Stamp": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/7/70/S3_Weapon_Special_Ultra_Stamp.png/120px-S3_Weapon_Special_Ultra_Stamp.png",
    "Wave Breaker": "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/6/67/S3_Weapon_Special_Wave_Breaker.png/120px-S3_Weapon_Special_Wave_Breaker.png",
    Zipcaster: "https://cdn.wikimg.net/en/splatoonwiki/images/thumb/9/96/S3_Weapon_Special_Zipcaster.png/120px-S3_Weapon_Special_Zipcaster.png",
  },
  //Salmon boss icons
  salmon: {
    "Big Shot": "https://cdn.wikimg.net/en/splatoonwiki/images/9/92/S3_Big_Shot_icon.png",
    Drizzler: "https://cdn.wikimg.net/en/splatoonwiki/images/0/09/S3_Drizzler_icon.png",
    Cohozuna: "https://cdn.wikimg.net/en/splatoonwiki/images/7/7a/S3_Cohozuna_icon.png",
    "Fish Stick": "https://cdn.wikimg.net/en/splatoonwiki/images/a/a5/S3_Fish_Stick_icon.png",
    "Flipper-Flopper": "https://cdn.wikimg.net/en/splatoonwiki/images/6/65/S3_Flipper-Flopper_icon.png",
    Flyfish: "https://cdn.wikimg.net/en/splatoonwiki/images/2/24/S3_Flyfish_icon.png",
    Goldie: "https://cdn.wikimg.net/en/splatoonwiki/images/b/bc/S3_Goldie_icon.png",
    Griller: "https://cdn.wikimg.net/en/splatoonwiki/images/4/49/S3_Griller_icon.png",
    Horrorboros: "https://cdn.wikimg.net/en/splatoonwiki/images/0/0a/S3_Horrorboros_icon.png",
    Maws: "https://cdn.wikimg.net/en/splatoonwiki/images/8/83/S3_Maws_icon.png",
    Mudmouth: "https://cdn.wikimg.net/en/splatoonwiki/images/0/07/S3_Mudmouth_icon.png",
    Scrapper: "https://cdn.wikimg.net/en/splatoonwiki/images/8/8c/S3_Scrapper_icon.png",
    "Slammin' Lid": "https://cdn.wikimg.net/en/splatoonwiki/images/f/fa/S3_Slammin%27_Lid_icon.png",
    "Steel Eel": "https://cdn.wikimg.net/en/splatoonwiki/images/6/62/S3_Steel_Eel_icon.png",
    Steelhead: "https://cdn.wikimg.net/en/splatoonwiki/images/9/9a/S3_Steelhead_icon.png",
    Stinger: "https://cdn.wikimg.net/en/splatoonwiki/images/b/b5/S3_Stinger_icon.png",
  },
  //Exposed icons (use base64 when no link is available)
  icons: {
    medal_gold: "https://cdn.wikimg.net/en/splatoonwiki/images/9/95/S3_Icon_Medal_Gold.png",
    medal_silver: "https://cdn.wikimg.net/en/splatoonwiki/images/c/cf/S3_Icon_Medal_Silver.png",
    golden_egg: "https://cdn.wikimg.net/en/splatoonwiki/images/c/cf/S2_Icon_Golden_Egg.png",
    eggs: "https://cdn.wikimg.net/en/splatoonwiki/images/7/75/SplatNet_3_icon_Power_Egg.png",
    salmon_run: "https://cdn.wikimg.net/en/splatoonwiki/images/2/21/S3_SRNW_logo.png",
    splatoon: "https://cdn.wikimg.net/en/splatoonwiki/images/a/a3/S3_logo_JP_alt.png",
    rescues:
      "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAAbCAIAAABX14BcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAN/0lEQVR42m1YCXRU9dV/WLYks7x5+z6ThAASA1lmfTPz3myZrCSEJGQzgbAvQVAUgewkgIAgVCm1wMGltbWUg0u1R0pdD5Vapa0fiEoRRQqRTTQQQkh4330zCe3X8+X8TjJ5y/3//vfe/733N4jCWgABGgeoDK6wAIuP0y+qjCXAoCE6DhMgwOhQWRPcUljUxycqXCLcDdAWL0d6OTz2vEm/xYFNMkTBFZOPM9klPFvCHSLuFuLGUbAQM4L7WBxejMPDWwBezuJj40zw+API/8tSpwiGWDTOMkyb4ggxhgBjAJawjMKZAmxiiEkEHvC8myc9PB5/WI2xBFNgM769OKE4YBV9/yMrqjSpMOR/3BqhwZBx+Fjyv1nGnrDcIwpOGvElGvelTpGLsdT3ECetcwKKI75E474EU7rZmHfDFBqmwBQsNLzWCEiATvT/7GGE+gjusdQxEgU9KPGgx14bvhi/7o3BNwzUy+uEfPGtj2RLLGp4POKxF4ejARtQh2MdczOlAz4oetD1tyAf3LHdgjUges+1/81yhEo8Ucg4PDG4edrF0w5Bhx7f+HUej3vxXhy8/2apAz7AZnIpQ5SC3DBAHOK7ihMNA1Hacm9vMeDxPY9Q1FkNswzzcMMcligPbfKKpJO1+G2cnSHcAuMQGLdNmO521OVFtzWv/f1LL77/+ivvHny53OP2spyHJH1WFp73kaYAaYaw5sO/RJIi4AEW89FmmcX8rLGQGp+LjQoJCaFUSxY93iPh8IACxw5eAddQkEtoRCAU3QIeZSmFtCg0FuFplUL9hGmYZZDHvKQhAI5hzC4O80h0Dkeqk1IXlhS+uvfZ0x/+ub+nR7tzR+u/rd0Z1IbuaH033v7tASfOhnjJIzAu1lwgEkUsmmtKKGHxKGdWyYSogKq0UeUseYxp5RSp25dRbTPLKKIkW7KpRL+Ag1OAHDhIz3XGGGT1xA1bUNVoiIqsn4oVGbhyz5cBiAKcRJGA9bw2ujYoH9i9o+/bM9pAnzbQr5MbGNQG7mh3NR1Dd7W7Q309PQHrRC/B2kk0YiPyTD8pTkQaeGxXZdEaJbPAcl8Rfl8ePkbBxtVZyXdqZx5vrH1pZl4lnVggYoqAyYwZEOAxP2+ROaNHMEGKqxwWpokox/oZzEWYghweFel8kRphyWIhkQSWpVn3H3n+F9qVCy9se6LQlZUpsiU++Ve7d2v9A9rtASB348deDX7uDml9/XPzSlTB5uexfCZxqYRuzUmbT45vzUpeaDVuUtJfqo7sKvaWUOOqqfFHa2d8OrfqjdkzK6gE2TRKFfWIBwUC1vVSRjdn9tkIO2d0MiYPjgZ5RmYJSFA/R4A7/ZhhhCVPAndFpM6+f0T74VJTZWmOxM6bUfja/j2/3vX0gsrKZfX1d2/0anfv6PwAt29BAmxZ1+yy8gHOuHgi9UFV4YnZJS9Pdy9hkM507NiCki8Wln/4YOEc5r4KHOnMIPcVOR5123KFsbLV4OBN+kGmsRCJBindoz4o+xDMCaKHY+wk7hFZyDo4nQGR9pEoMlxuWCpsE6ITUs68e2RvR4tTZJ7tbNX6e4++cmB3d8dn77/XvnL5tvYW7fbNwRs/aIO3taEBbXDg0PPPTdPL4dhn8nLOL6r8uirypzLHorHIb9Tkf9Sp56pCfy+VGxOQehxpYpCFLBJMQgLCaI/N4LJhsl5VyFwci1IYBNrOGF02ZkFZ4aLS6dUBxT851W5jnRzlpjHgNszSzzFO3GLHLEUZ6QUZU/KnpWu3eo+/+ZpDZMFbedPSP//gbe/klFXz6z88/Nqlb77UtH5t6NaJd99RBaqIH/N0ePJnFfKlGuVY3uTn0kafqnZdnBPoqXAf9Vo3W8e8OUs5vqB0n3/SbH7sdDHBTYz1QTqSeISiogQJh9rLYFms2ZOe0v7I0qc6Wp9Ys+bp7vbuVU2rG2oDqVaFZ4cj7qcJ+EcROJ/IORiia9F87cb11/fszobDbmWcKfyJdw4/Pr/h2Y0d8Lss5H1hzy7t1o/XPvsUgpWLIe1TLRcbo1fLXd/VyueqnN/U5FxqkC+V23uq/SfrQ5/MK/pkTtHhurxqYlTIgoTF2Mlg2SBJRSkqgGFQIN3JrHdq2uMrF29ub32qe/3mjuan1rfsbFvjTRFlnkL8jDnW7objrvC0IjJLivO12723LnxVHlUc6SktjyzReq/2nPzHzzva3tq39/Tb7xY4nK/u3zN0+azPag5YkJXS+FNl7t5q36VK15UG+Vx95vn6zGtV8uWawOmG0EcNobdqgkulcYXMqJCY5KINfoGG6CkUFWFoFcdCPJXDmCvz1Y6WVVs62p5c37m1q2Nj65r2lUuyJRKKKyQKCnUBSle8jco07oRUSLWe/eioNtA7+MPlC2c+G+y9Ahn5YGF+lsC7efHYgYM7H18XzZqqDV71pqEFwriFJPJ5tfp9tRdwucZ+ri7966r7r9fIPTPlM7XKnsnGlYnIciGhgBrloX7itxJulnBgUCn5IEnkspSHMCip3LJ5s7raH93S3vxkW+vODRue6u5oqiufypndkgWBxgAVyw0dVmIzLYZQWnJ9JOBNtRbYs947dODGv8799chb187+8+aFb6d7PZmSkMEyL27f9vGh152S8O3JY8EHaHcC0pnFfT43/+tyx7Uaz8XyjCsNmVfqs65W2K/XKJfqg58WOU7MjLxTnjdPMkXY8TnUeI9AhDguiJMRTO80Motm27CmJdUzigPNTQu2r1u76bHHdrS11EUUt0h4rTjipaGbYT6e8EpMeFLq/k1dg9/9a1dXZ06y1Z6SkiXZAB++8YY2MPDq/n0FsmvN0kU3v/3m4I6funjux3Mnc6cKix22g/XRvzVGLzZGLlU6euuc58rSemqmXW/w9FS5v6l2n6kLn3pw+gf1ZXOt5kKr2c6a9FxnqKBVCnI8lEanjVQyU5cvqL7fStqtXDZDlzqcDZFwMC3ZzWFQ7RGVN0ONdVFmGCCe29ylDdzQeq9Dlbl+/vwfDx1qaVqRY5vQuXyFBsUcmtDALW2wb/DShTq/Wu32aN9frHBNemHJrH3FrsMz3F/VBq9VuPuqXL3zfedqpl2YI5+us/8227w9bdz6TK4pnS2iE3yMwTVBLC+OrlrR9NjDD7WtXf3w4nmVhZHZJXlVql+WRBfL+0VbDk64GEqfdVjUy5qRoIDLMDUKFDS6L987Avk38P1l7e7A7d5evWXfvL1yzrws0fryrp9pfTehYZ7++OiSWTMUyfre/ucGz5728+YiZky1BVlqQo5XqZer/N/Pcp0sfeBso/eLOsfpRt+v7NiyBKTOjDzqSmvMsMFaa5fN3b61e8OGrvXdnes7W7c+0fXkhvbN6x6r8ctOmnSRlCpKIUlyWdCIlYXRAs43VCJUJg1ewhzg6C0PLd27ecMfX/mdNngLurWOoaGLZ77KdTizJfEBmsjLnOIUKegKe1ubYeA4vOdZRSQUbnQuhdQyyM5sAdz5XX3oGQl5PTThi/rgqbrg/zQWrE5CDoadx5oa99WUPJIvb+98uKt9VXluKJw1zT95UpHb/sji2Ts2rutcPjd3SrJPoqBOARmX2ajLCdoMLRSBIQNqXoQnfbQlh7DIKdKXH/9Fu9P/yV/+fAdGDWiJgwMX//nlivoa/0Sbnbb4BV3fhFJti/KjAUGAgqxICSqHRHFkTTp9ak7xiargH8q9D+PIR3Pyj88vObqwoj2V2DiBfz4/sCiVW12oPrN+9ca2Va7UFAcvuDghm2MKVOfWrjXbmlfkZ0yQBQwCCwNRENojjwM38CMyrA04i59BYXknT+xseXxL8+rXfv0idMKh/hta/4+Qiz2n/qZOtELPkImksBCbjllaoWD+w3SBBlWGTarBx/2pLPLFkrrf1OQ3iont2dLPS33t0ZxidvwM3hg2j46SprIpad1Ni3+2qXt7c/vCsln1hSVzyio2tjVvW9+2ecVD+RPTPBTho4bn37gcAAyzdJFJwWS9IoCrZJF1iiyMlVdPn9rR1ar1XdMGe9/85S/cIoxbuvQJwbmLTfIqDUQh4iaVNwZ5tJgyLMMSN2WkLM9IjqD3RQxIMZ0QZo0ylejjDREbFhYJaDMljqxH58ze0dK2s6UTuP60u3tLe+vaRQtm2u0yRdkxNDdFindEON0xxRKbNuCPmky5BdSOJ8IMonKEGzNPT78famdxzlSt7/r5T46We7NcPAo7cWPj9GGUxzwxd+p6Q9crqF3Sjc4gEmtpUx6WGOUsuYSxmKfCuCXKEn4ywUuNduFjAjY8mzN50oT8rPS5BbkPzSxdVloMq+ROSc3Ck9Rk2sEanbrq0Ml5eB0gUeIsLXAPVgqnsJCtQYYoEDmXKTHPxqsCU+d35KenekTMbyU9rCkvhdVP27BojAsjHMb7LBHL4c1BwpRHmrx4EkyrXsIY5igVJ0IUGWTNuTbUzyYBSwdt8NlIJ4NCLYRiCXBQlph+sig2UpZQWTTHWQIlwL9Zwoju5lAXBQIACzIYyJEIDEqYAbjq8gWyVsD1x0iDX5+uwTqUMTT2zYKuFUFMwZJgQVeGIMMlvWHYaRAnBMwK+k4ofQ7XU58wejFDhCHBF5AtPogGS6s2EXqKDHoLxBOLRUQqpp5RXVIKlv/41oDXh2eZNML8DIdDxg15EgOyCKQWfNBNE7ENSEx8WAZ5BMVW/44AVDZFByhaH6xg1hRpN2m2M4k5bCK4X+8cou42GGJgoITDC8aLBSaCm4MUGoBMEHQh6qIsAHgMhvMgiamYEfRQLOK6qoR69L/gvb/ft522kQAAAABJRU5ErkJggg==",
    rescued:
      "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAAbCAIAAABX14BcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAMhElEQVR42n1YCXAUVRqO6wohmaPvu3tmQkI4Esgxmenume7pmclNkgEm3JAYLkFOuQIBBAwQBQVxSzy2XHfLskqLXV1Ka3dL1i2vki1dUBfcXVQUKC5lAQMEQq7ev2eGIWC5VX89munX733ve//x/cnQWTRtISZhLHKP6QkLcmja7kz+v5ZcFuYHOFThrTH9eXrH9JzktNuGB1k8vV1GanYS0KClf2pBDknbXaf6GXDpva3teQQs/W16pkHf+QReJadZh2Fx3bLUOveiTK3O4ndZarPkNo6E/SzQe/Dd/a11J2l8abv94WAWLJTJ1WBMoTR4TGOcBm8B8uI2w8WV4I6gyCgcqbs4P+XUBHiFqIwjxDs13plYy9peYxCw9KHhGRZJo1RZJPEhGmCdUYm0toBnwh6iEJ1EwwwBo0HjYQYzWAxehawFnUHaEWIAIp48AIwplDKeBWv5SJvuZhSB0jyil6d9IhsakbM8Hts6rykgkvA26qF1IJKxpe7lbicDCwsEoPRjWbqAGxLpp+yAUmWcAcoepOw64wzzWFQgdRoYxTUKtaCwBIxB0qHitgBpgyuNikSCYzxNdgplxXDOOreL1nL48aXj1jw4841fP3fi00Nmzw3z4oWzR/6uuhg/Cyyifnxo1IWrnFO57WqhBAfpUFNJW0QkdAGDyTDKlC0k4kZiAuADKIAJbjMqcgES0xkgGK7R4jLCE2AwU6ccg/0hhRL4KCOyVYF4fXfHf7/8zELW223eumn23jJ7unsv/dB99lQgV1JF0kjcGtA5GKWezga0EzaAsVwigTmFyA7DddMOPUEPEAkoA5RDoZAAIBPoALiTyMCo0ngggRU4tmimnfe4bAplkCcCErP/mafMnusWxL5es6fHHOg3B3rN7q6+yxeXTI/7eEJl4fSWbyXjMenpFm7GaS1NOio4vEaiNSw7QiNRHjcYpNJNW28ZVEazgjQacbGAT+WpEhINuHgvQ/g5IiDQIfiKI4JwThoBRu+JxYxkRCsMXsaSi+Mx81YX8GfhM80ewGqa/be6z5/4+rV9z5SAA0k0rAK+lQ7GNMQw5YxSiIHbNUdmBYVUcUQli8OPQTQrwmFhDi93WTjKCLuXRsvH5JZJjFekZQ9fwpPjKLSMwYApmJDOG4NzRQqll0QgYmJqmdl5GS66v7+3zzQB403rX/NW55V/HfoI4ins5uGgQcIWssLcobEQEPYQbY/QjgoWqWbRKXlSPIevYdAoYYvg2TBWMUg0QWREJOGQZQwyMxLY1bqiY/WyrSsWzYvXxQ3FKMhT3KwiWHeVzhiD8jyeQhnkKR9Lanme05//w+zrAQZ7BvoBJWAcGOjruvTDxW+O1xQVyDSmUU7gxvJxKEhM4oJotILBaziijkOfm9X46qLmWuyBejJzBodMJrN31BoTGXuMtZcTmRrtCLjplS3Tf7Xj0Z2b1z/dvmnvlvW7N6zZ8ciS1qbpsw21PM+dcFAEICXLVdKSMW5FnA9HZZY6+MrLZu8NK3TAIwcAbm9/9/VzX//bvHq5KRKynJ1wAiyIkggkXorQKSpC0NU0F8EcM3PY/S1Tfj+7bhqZsV3L/WM8/KI6el0euSYXf1oZuUi013BZiofc0Lpk67ZNHds2P7Vt85621qlasHZsYTR/xGTFt6WlaX5E161SQgKFfgH1i4hfdKQykR/JjghsNEfcPLfZvH7F7Lx09cypv7315qOrlsfKjWDhyI8O7N/XtlZ3CTpPQxBY7ijgMniqKIRItpoTFNvQGJm1grOvpe+fj2U8G+S+Wtjwfq13dVbGW/X+I/NjL4QLK+wZlQWuJ5/YsnPP49vaN3ds2hDXA0snTphtRJqjkcqCMVNk3/Z5zVU5gs7QAFS2UDpk0ZZCqdCOiIcro53REe7tD8+dFlLh9ksl3ueRSkTO6+Laly06/t5BcHM9R/JJRGgUX+RyyiM4r5sto3CVQKMi1kAN3ZJPvl1X+rLGvVg07KuZgTNN4f1jsY8avMcWxH4TLZpIDWnSi7e1PbJx4+rFcx9sMLTJhlY9bkwhiVeNK1zbNMsvsROKCwIQhRRt0KR16YIjyNtSmQiKRFAiACUk9pCHhcLoJTHNLZRSmJ+nFbcwMxo6/8/DVSWFE3X5+Y7N7x545egnB49/fujT995544V988ZXhvKYCH7f48XS0UUTv1hQ/sVs37kW4+wM5dxs7esZ2qczo7tL3TH0F4ui8p6NayKK98FJsUVT4+vnNUfH5Je6hVhQ3r5yiTbCrbk5iPQIRYIlsDkgPadQht20KmAhiZQpu4/IhioXEWkfmm35hwCBSVQXFXSd/ubLj983u66YfeC418yB7t6bN8yBRC7o7n73rdfjpbmTh2Vsd9v+VFt4rDn4bVPgRGPJhenK2ebI0bn1rZIthty3ujrUKHtn1VQYhaPKcoSVTVN3rXtk3aI5HW2rWxe2yHlSMfDF4gmU+F0orTpO2f1QQzkMniMCDsFoxTLUK55UGNTHUQ/FxoOzJhJ+T2/nFcj5Ny5c6L9+04TEemvA7L5lmtd/OPbxa3Mb/9JYfqS5/D/NBqC8OEe/MkP9Li4faal9wpfbSGQ+Gqsqz3G3P7zADyndzc6uMRZMri8Z6RqTw6vjRqmjPFoeb7iYRBHHb8vF2yihtla7eEubQFFKlDjQBwpth8qpuZnKwpF9508nIf547uzLe/dOUTTdleuVPNVy4PUXXzJvXDfNa2bXqcM72w40BN428r+arX3bpJycUtw5texyU/STefVvzo1vKVcei9dPSkRJx+KFD8frH1uxwD/aUzTKU1wwYlqstn310idXLaka5Unqy0QyQsAykrkeRJSK2g0CHjBIMap16VhQQEMeugDN3DCvySruXV1ws4019UXu4TLDqwyruHKKBGms5Dp9/Fhf/yWz59zRve2t1JCtjowjk+RvWkInZ8pn6seem2U8XkBPQjKmuKm2+uqlVZW6S5xTEd6+5KElMyaMkciJtZEdWzfs3r5l18bWZze2Lp9YA2koCVEWLEvlyxBNggHJgwqoVQAho8oitW5uk1U2obLfuLl4zvxCz3CfJPkEvkQSiz2etuVLB252Wlxe+e7P65e9WqP/rjT3WEvdZ3Mq9g3/5YmpwcOTtYfYByrR+6EOTcgf3t7cPKm0WOZpv0T7hgtVaknHo+uf2Lxp16aNT65fE/eX1hfkBQcReSerg4KCFAVjUn6mKymcKZQjVI0d3XPurNnTa/b193Re//Cdg892bNu5Ye0bv33p4slv+67+CJEEfnnq8AdzRw+fTzp2F43466y65yNjtubbjy2e/IcGtQHNMIihcFGg1sbn5/toEiISUNbJxTvXr9y1qW1v+2MLGhvb5szRJD54u5e4rWnSaoMjFS4hpVjLbaG6JE2nMT+BhHKk9S3Nvd9/b116f0IomT0Wsv4eE+poX2//taufH/oAhGklgY/PypyUPbRZwGP0kAnCkM3G2OmSLcpkQukPCUyAoUpRxM+QIMF8PFZXVrhnw+r25cuWTp8xu7xKESSNZ0HCWRIdZH9Kq+N3UMo8ZFEymERJ4VEKBYOHKjfvxRA/z0yLGh++faDz/Fnz5nVzoMvsvdbXefHG+TMnvzjStnCBnOdRBKacoholoQLJMtChERGE+jBDzFKpITq4F+1QwKkkUYVLEzgQ/17G7mWRpgp9WWPcL0oB0aVLLh+JWIKfAXmApMii8FS+VHgcDO43GUxpLhUkK8JTKpDq4kA0lYhMtGh0y4SaVS1TV86auGpKwyRvgZ/DZEhhQsJPkKwwlhVhbFGXU+EyZTFLdmX7hWyZc4LeCbB0gIbSR8ukU2EduoQmAxQqSIDldEEEphPZGgNNnQBqYYgmUaZl0k/bQlDXoEytDoZwgDSEygRCEEQ75F7dTVlak8PDLirsIi39QSM1IOZpm9W+CU4fNUxzY6HhNAQpdCOQBcOSIGOowdGW2uUcYdEZ4u3QgYR5Bn4H4QKiJ9ED2pL6PynXU1wmyLMYBvih1B8IUq0xnBUODf+1OkDaARNqXYyCZUOTCQJKRuAXyks5wEIcATflxbP8PKK6CD/0pTQZxnEdw0MUAaXZahjAHXE8zJGJNsimkg9o1NAoaDN7Vr3HHWYoWFkT7GEPFuAdybhJBvcdlKC0YRyMUhmEEpK81SEQ2RHcXg4xyNNlOFoucICyjEKNHC4kUNDQANkQE5bRWBUvlONUFKOiNAONokqCpCfhE4hIOHCYd4DjGuAbjLMCegkE2l+sQqJlOlPlskFkKOk2lcX/B7BYbp3+HFb4AAAAAElFTkSuQmCC",
    kills:
      "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAXCAIAAAAdhyFBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAHIklEQVR42k2Wd0wVWRTGZ15HOooI2FjRrBhNCEhiN5oV7D0rIvYSW2KJRnExGsRCLIklRo3GHg1iQRDRCGIj6K6QDf61K4JsCBqNiiDlPZ77mzmP4d1MJvfNu/ec737fd86MoigWLpPZqigmhtmkOOxWVVGsZgt3LrNq4m5SVO4yLBaLqqpms5k5E3Yx4afNZvP19bVarbLGbrfzLxMe+vv7BwYGBgUFMed5ly5dWK92hGS/SbYpekq5SKulNynG8PPzk0yy08jkcDjkIU989EECkz6Yh4SEDBgwYPTo0dOmTUtISOjTpw8gCMVGFmihVJNFIpr1YTGrdpvn9DLp37//nDlzdu/efffu3erq6k+fPpWVlfXo0UMIED6Ekm7dunXt2jU8PDwyMjI4OJjcvXv3HjFixK5du86fP3/69Oljx47Nnj2b9CADruzVDsHQTmPWgFgtGudBgf5Jib8dPJhVX1/37ds3t9vtcrmcTqf750+55qekCnlCDxEJEhYWFhsbu3z5cuCuXr16zJgxI0eOPHDgwLVr1/Lz82/cuHHmzJmNGzeGhoaKWKimdmrbQX5EeFj6H2n/1dbk5+Xm5GS/fv0niX92jDaXU7uc7UXFJVabQ6wjPkDmuLi4zMzMc+fOXbp06dSpU9u2bZsxY0Z2dvbDhw+Li4tv3bp19epV6OzevTu2AEGnFURv7vOTf//4sb6srLRXr8iAAL/o6Oi+fftOnjy5pqaGcze3tnB3utzc//m3ytcvQJNQdxwg4ByGL1++nJeXx4kvXLiwYcOG9evX3759m9wFBQXA2r59+8CBAxFIOBD5NC1tFqtYj6NXVv4dHByYkBBfXv4Xiauqqvbt2zd+/PiGxu8ud7urXZOgtc3V8L0p6pdobZNeC5wGBFu3br158+aDBw+ePHmC6vPmzTt8+DAc3Lt37+LFi+vWrcMTIOjXrx964QYPB1qZeQylZGZmTJo0qWfPnjiurq4O6w4ePBj9OMqKFSsaGhowRGtrqyjCv/BHIYCA7XC7Zs0aOCgpKSkqKjpy5Agq5ObmQgkP586dO3To0LFjxy5YsGDTpk1ogUlFCEVVOgsuJCSIR6mpqWQ6ceKElBz2JigTigKXVVZWuvSxcOFCoVBcDberVq26fv06hL98+fLRo0dogQOgBP7Xrl2LB/fu3YsrgSUMSWOgGVmFRgMH2Nva2tAvICCAn5TW27dv09PT8dH+/fspObgF4p49e1TFiqIsoxZYlpKSkpOTU1hYSHqYZ0J6sSE/yY0h7t+/D6mwAiAalFaGJsXT2hBFOgxCQPKPHz8yMjKWLl1aXl4OIKxAGroKcQFRUVHBOfABD1GUJ3h2yZIld+7cIWWBPgr1gSKlpaWwCBNXrlwBIlAOHTqUmJgIdK2O4KCjx5kFBMyw06jApqamFy9eCDjub968GTduHLpCsqKXI9txA+aCJzbynHxMHj9+LFVA4pUrV86cOZOsNAn8iBlxLv1Aa6x2q0Oycvf19Zk6dapDH4sWLaKZkOnr16+fP3+mm0pjrq+vX7x4MSCwvcNBEBvI6INTpkzB8PAP8yBgwunBgRMRniZBfdIZd+7cOWvWrIiICAiQgtScSBSix8XF1tbWtLe348GYmBgE5iH+wnrNzc3v3r1LS0t79eoVrNDnKX0ywQvLhg8fvmPHDjyI2BDA0alG7iBgfb4+nj59igPQCBWQABBwhoK0pk4fVFS8djpbMTk5SPnhwweWYlfU5SHIeE5/PHr0KEw8e/bs+PHjqmKjUigK+MfncEbfJQ25nz9/Dg4mpIcbhGACaOGD3sBG0GvcSzViARpwdXUVSMnk1vqelm/ZsmX8S1vkfFgM/lmZnJzc0tJCZfNOhz+OghMhNioqivcCkgOCZLgHCShgOgENGwoxL1Aw+LBhw9jl6Yn4QBp7TMyvYWGh79+/JzcJuDc2Nn758oXuIR6UQTLKCaCYX4Pf8V6QvoS/Ro0axZsJBwjtsJKUlEQvQbv4+PgJEyagGuLKes0AogKmII6Pjx3+qX4Yk0KADEqRlEA2ysHzJtMrSGpBXvYM4kAGdsanBIEDJtCOr3Erby/IlzYgL3QtoBzDiEuvHTJkSG1tLcIjJIXAhI7GX3hC9DKasYdG/QA8ZwERwYqRs7KyMB3VCA28GmhltCwRXr4H5IWipVb1t4seWmtKEgK1KJvp06cjB25AXe+m6TU3GadnAg5BCckTJ07ke4Ted/LkybNnz27evJmjS/+26sM4g+Kw+XgHFTSAQCH43LJlC7GMv4yPOdbrWW0SVBBIdJZxVvoHuOnTFB6iDBo0CAlYRlhhizWy0VMLHTKbvNEY6njLZIDQvzBVORDbhQkSEJ1ypdyRnLbD0f30Id+rxiedhwD5PPH2l/cRvVOKbMZ+47NK3GQcSL695FsUKNIxZa98lQhQ+SaVgP8Dg/9nWA6RL40AAAAASUVORK5CYII=",
    deaths:
      "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAXCAIAAAAdhyFBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAF7ElEQVR42mWWSUiWWxjHX4frUOYsZOJAoWbmwmHjEBEO1cIKoxARWoiLRGqjJhqikIKhKQoRbTRqUaRGmmaaWZp6r40m4cZFBKarcAiLNLs/3//nSe59Fuc733nPeZ7/83+GcyxnZ2dXV9e/tomTk5OLiwvrHh4eWnF3d+cv656enmYzi2xgkRVG5q62uLm5cZyvzDnFXydbWNROJjt37ty1a5fWrf8gcLFFhwVCu9FoWZbTlgCFFfaziA1BZPOOHTs8bfHy8hIm9jBx2RJWGGVLXllyAmEfS+YzK2hnRJ3ckt8+Pj78BZb28JVtcoOvrLPCyB5tkGi/oYGv4m8Tgc4buqTI8Mno5+fHCj4dOXKkrq7u7t27lZWVERERLPr6+goErvPX29sbM25bworICwgIiIyMDAwMVIgFmomDAyEwDBukHIiLi8NqVFQUlg4dOjQ0NDQ8PPzixYvnz5/X19dDhrDKb9kGCvZCQkLi4+Pz8/Nv3Ljx4MGDR48eLSwsLC0tZWRkyApY5bYjCpgUDpMvoaGhBQUFDx8+HB8f7+7uRuP169f/tgUQg4ODV65cQYsijXmFb/fu3ceOHbt27RpWR0dHGXt7ex8/fvzy5cvftvT19clDRc0RBQcPlmWqAD+OHz+OirGxsSFboAEtExMTEMB47969gwcPettiwpybm4sB7MEQ2z5//syRp0+fcpwjQvDlyxd/f3/lrBzetK6cFChoBArctrS0PHv2jJNouXTpUkpKCnr5i8arV6/GxMTIPIqUdx0dHevr69iYn58HB4nCHB9giyNv3rwRgh8/fhBZFcgfBMa8qkX51d7e/o8tHE5OTq6pqZmcnHzy5ElRURH5ERQUlJ6ejtMHDhwAASFbW1uTDfaH2jI7O0vIcKO/v39qaur3lpw7d06BM5RbiocKGttkPlFoamriPCcxTCzevXuHIrwhlYqLi4kC+UFCdHV1keSk5K1bt9D+8+fPnp4eVUFVVdWnT5/gg23fv3/nq0hqbGw0HUjFYsl11SjQUIeXZWVlr169wvyHDx8wD58AIhBoBJDoRXCR1OM40AcGBjCwsrJC0mAgLCyMiMzNza2urhoCoAo31O4YqfDNylQDUF0BglVwEXvMw8Hr169lEqfJg9Et4S8pQoGYiggPDycBP378CHqUsNLc3Pz7fzI9Pa1MNJ3QQoUaiKICFOC3tbVheGRkBATgePv2LX+JcWFhYXBwcEJCQootxAtjpvPLM3UhSOYr3Ozfv//w4cMnT54sKSkhE2FUO9XONyfqoKooJuR5Q0MDJYSLMI9hAkks3r9/r5xgxFfiXV5eTvMRmShSDzbRNBeHLjPkzJkzRIHgKgeVeZy15AR4qdTLly+TZXfu3KH1YhgQSkMmjPChWKgtAiIzM1PZVFFRcfv27draWhylRrKzs0kmXWlpaWlJSUl79+6lVRAFnJH3yr9NDkxzYF9qauqePXuIC1QfPXqUbjhmC7aZU4p0WdHDiEYhoCIU442NDeU8RZGXl4f3qOIrrn/9+lW1AAJzy6sCrO13kpqrCORwVlYW5rFHJ+js7ExMTMQzCrK1tfX+/fsXLlyANs4uLy9/+/aNtJcNCZZU9KdPn15cXDTrRBZiFB3RYMnq9qeEeWKQRzdv3qTkqDRO4vSpU6doGGJY9yEUVldXE2PasCl6hHuIQmUPxoBeWlo6MzMDFNqlqT4HB/oxyaw00csA7eQwvYiokxY0A5ggTOjlk7TIAS5r6h4DasC/fv1iJF3MM4mRTrNv3z6OKFVNC7B0I8uwHlu6qXWJQQOckwQwQUTofVyAAs0o1UpsrsSzZ88Sb2yLdnBER0frNWAeXSYNccPRD+SxQWDIMJc12FGdk5Nz4sSJ2NhYBUuPEfOYILTUFPScP3/+4sWLPCZKbCFRVJkyoVedseXAZEIiEUXbH1iwopZF7Le/JPTXdHg94PRWQKTTvDHVKsyjSOH+g8C8gE1O6PoSAj1+dFJvRhN+7TQvUj2WjCUlPNwYBNvvIFMB/wLwEC0Q4BVDzAAAAABJRU5ErkJggg==",
  },
}
</file>

<file path="source/plugins/community/splatoon/examples.yml">
- name: Splatnet data
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.splatoon.svg
    token: NOT_NEEDED
    base: ""
    plugin_splatoon: yes
    plugin_splatoon_token: ${{ secrets.SPLATOON_TOKEN }}
  test:
    skip: true
  prod:
    skip: true

- name: Splatnet data with stat.ink integration
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.splatoon.svg
    token: NOT_NEEDED
    base: ""
    plugin_splatoon: yes
    plugin_splatoon_token: ${{ secrets.SPLATOON_TOKEN }}
    plugin_splatoon_statink: yes
    plugin_splatoon_statink_token: ${{ secrets.SPLATOON_STATINK_TOKEN }}
    extras_css: |
      h2 { display: none !important; }
  test:
    skip: true
  prod:
    skip: true
</file>

<file path="source/plugins/community/splatoon/metadata.yml">
name: ü¶ë Splatoon
category: community
description: |
  This plugin displays your Splatoon 3 recent matches based on data fetched from Splatnet.
disclaimer: |
  This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with [Nintendo](https://www.nintendo.com) or [Splatoon](https://splatoon.nintendo.com).
  All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.

  This specific plugin is licensed under GPL-3.0 rather than MIT to comply with [spacemeowx2/s3si.ts](https://github.com/spacemeowx2/s3si.ts) license.

  Note that *Nintendo Switch Online* web tokens usage are not explicitly allowed by *Nintendo*, use at your own risk.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.splatoon.svg
authors:
  - lowlighter
supports:
  - user
  - organization
scopes: []
inputs:

  plugin_splatoon:
    description: |
      Enable splatoon plugin
    type: boolean
    default: no

  plugin_splatoon_token:
    description: |
      Splatnet token
    type: token
    default: ""
    extras:
      - metrics.api.nintendo.splatnet

  plugin_splatoon_sections:
    description: |
      Displayed sections

      - `player` for overall player recap
      - `versus` for *Turf war* and *Anarchy battle* matches
      - `salmon-run` for *Salmon run next wave* matches
    type: array
    format: comma-separated
    default: player, versus, salmon-run
    options:
      - player
      - versus
      - salmon-run

  plugin_splatoon_versus_limit:
    description: |
      Display limit (Versus)
    type: number
    default: 1
    min: 0
    max: 6

  plugin_splatoon_salmon_limit:
    description: |
      Display limit (Salmon run)
    type: number
    default: 1
    min: 0
    max: 6

  plugin_splatoon_statink:
    description: |
      stat.ink integration

      If set, fetched data will also be uploaded to stat.ink
      Requires [`plugin_splatoon_statink_token`](/source/plugins/community/splatoon/README.md#plugin_splatoon_statink_token) to be set
    type: boolean
    default: no
    extras:
      - metrics.api.statink

  plugin_splatoon_statink_token:
    description: |
      stat.ink token
    type: token
    default: ""

  # ====================================================================================
  # üöß Options below are mostly used for testing

  plugin_splatoon_source:
    description: |
      Source

      - `splatnet` will fetch data from Splatnet using [spacemeowx2/s3si.ts](https://github.com/spacemeowx2/s3si.ts) tool
      - `local` will assume `s3si/export` directory already exists and is populated (use this when developping new features for this plugin to save network resources and time)
      - `mocks` will use `s3si/mocks` directory (use this when developping new features for this plugin to avoid setting up a NSO token)
    type: string
    default: splatnet
    values:
      - splatnet
      - local
      - mocks
    testing: yes
    preset: no
</file>

<file path="source/plugins/community/splatoon/token.ts">
#!/usr/bin/env -S deno run --allow-run --allow-read=profile.json --allow-write=profile.json --unstable
import { cyan, green, yellow, magenta, bgWhite, black, italic, red, white } from "https://deno.land/std@0.165.0/fmt/colors.ts";
console.log([
  "",
  yellow('THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.'),
  "",
  cyan(`This script will help you to create ${italic("Nintendo API")} token that can be used to access data from ${italic("Nintendo Switch Online")} such as ${italic("Splatnet 3")}. While these tokens are read-only and cannot perform any action on your behave, their usage is not explicitely allowed by ${italic("Nintendo")}`),
  "",
].join("\n"))
const agreement = prompt("I understand the risks and I understand that I will not be able to held the script authors as responsible for any damage caused by the usage of this script\nAgree? [y/n]");
if (agreement !== "y")
  Deno.exit(1)

//Generate token
console.log([
  "",
  bgWhite(black(`0. Follow the instructions below to generate a new token`)),
  "",
].join("\n"))
const allowed = {
  files:["profile.json", "profile.json.swap", "cache", "export"],
  net:["api.imink.app", "accounts.nintendo.com", "api.accounts.nintendo.com", "api-lp1.znc.srv.nintendo.net", "api.lp1.av5ja.srv.nintendo.net"]
}
const script = import.meta.resolve("./s3si/index.ts")
const args = [
  "run", "--no-prompt",
  `--allow-read="${allowed.files}"`,
  `--allow-write="${allowed.files}"`,
  `--allow-net="${allowed.net}"`,
  script,
  '--exporter=none'
]
try {
  const command = new Deno.Command("deno", {
    args,
    stdin: "inherit",
    stdout: "inherit",
    stderr: "inherit",
    windowsRawArguments:true
  })
  await command.output()
}
catch (error) { console.log(error) }

//Extract profile.json and print instructions
try {
  const profile = JSON.parse(await Deno.readTextFile("profile.json"))
  console.log([
    "",
    green(`Succesfully authenticated to ${italic("Nintendo API")}!`),
    green(`Complete your integration with ${italic("metrics")} by performing the following steps:`),
    "",
    bgWhite(black(`1. Create a new secret ${cyan("SPLATOON_TOKEN")} in your repository and set its value to:`)),
    "",
    yellow(JSON.stringify(profile)),
    "",
    "",
    bgWhite(black(`2. Add the following to your ${cyan("workflow.yml")}:`)),
    "",
    cyan("with"),
    `  ${cyan("plugin_splatoon")}: ${magenta("yes")}`,
    `  ${cyan("plugin_splatoon_token")}: ${magenta("${{ secrets.SPLATOON_TOKEN }}")}`,
    "",
  ].join("\n"))
  await Deno.remove("profile.json")
}
catch (error) {
  console.log([
    red(`Failed to authenticate to ${italic("Nintendo API")}!`),
    red(`${error}`),
  ].join("\n"))
}
</file>

<file path="source/plugins/community/stock/examples.yml">
- name: Stock prices from Tesla
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.stock.svg
    token: NOT_NEEDED
    base: ""
    plugin_stock: yes
    plugin_stock_token: ${{ secrets.STOCK_TOKEN }}
    plugin_stock_symbol: TSLA
</file>

<file path="source/plugins/community/stock/index.mjs">
//Setup
export default async function({login, q, imports, data, account}, {enabled = false, extras = false, token} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.stock) || (!imports.metadata.plugins.stock.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {symbol, interval, duration} = imports.metadata.plugins.stock.inputs({data, account, q})
    if (!token)
      throw {error: {message: "API token is not set"}}
    if (!symbol)
      throw {error: {message: "Company stock symbol is not set"}}
    symbol = symbol.toLocaleUpperCase()

    //Query API for company informations
    console.debug(`metrics/compute/${login}/plugins > stock > querying api for company`)
    const {data: {quoteType: {shortName: company} = {shortName: symbol}}} = await imports.axios.get("https://yh-finance.p.rapidapi.com/stock/v2/get-profile", {
      params: {symbol, region: "US"},
      headers: {"x-rapidapi-key": token},
    })

    //Query API for stock charts
    console.debug(`metrics/compute/${login}/plugins > stock > querying api for stock`)
    const {data: {chart: {result: [{meta, timestamp, indicators: {quote: [{close}]}}]}}} = await imports.axios.get("https://yh-finance.p.rapidapi.com/stock/v2/get-chart", {
      params: {interval, symbol, range: duration, region: "US"},
      headers: {"x-rapidapi-key": token},
    })
    const {currency, regularMarketPrice: price, previousClose: previous} = meta

    //Generating chart
    console.debug(`metrics/compute/${login}/plugins > stock > generating chart`)
    const chart = imports.Graph.timeline(close.map((y, i) => ({x: new Date(timestamp[i] * 1000), y})), {low: Math.min(...close), high: Math.max(...close), points: false, text: false, width: 480 * (1 + data.large), height: 200})

    //Results
    return {chart, currency, price, previous, delta: price - previous, symbol, company, interval, duration}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/community/stock/metadata.yml">
name: üíπ Stock prices
category: community
description: |
  This plugin displays the stock market price of a given company.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stock.svg
authors:
  - lowlighter
supports:
  - user
  - organization
  - repository
scopes: []
inputs:

  plugin_stock:
    description: |
      Enable stock plugin
    type: boolean
    default: no
    extras:
      - metrics.npm.optional.d3
      - metrics.api.yahoo.finance

  plugin_stock_token:
    description: |
      Yahoo Finance token
    type: token
    default: ""

  plugin_stock_symbol:
    description: |
      Company stock symbol
    type: string
    default: ""
    example: MSFT

  plugin_stock_duration:
    description: |
      Time range

      - `1d`: Today
      - `5d`: 5 days
      - `1mo`: 1 month
      - `3mo`: 3 months
      - `6mo`: 6 months
      - `1y`: 1 year
      - `2y`: 2 years
      - `5y`: 5 years
      - `10y`: 10 years
      - `ytd`: Year to date
      - `max`: All time

      This is relative to current date
    type: string
    default: 1d
    values:
      - 1d
      - 5d
      - 1mo
      - 3mo
      - 6mo
      - 1y
      - 2y
      - 5y
      - 10y
      - ytd
      - max

  plugin_stock_interval:
    description: |
      Time interval between points

      - `1m`: 1 minute
      - `2m`: 2 minutes
      - `5m`: 5 minutes
      - `15m`: 15 minutes
      - `60m`: 60 minutes
      - `1d`: 1 day
    type: string
    default: 5m
    values:
      - 1m
      - 2m
      - 5m
      - 15m
      - 60m
      - 1d
</file>

<file path="source/plugins/contributors/queries/commit.graphql">
query ContributorsCommit {
  repository(owner: "$owner" name: "$repo") {
    object(expression: "$expression") {
      ... on Commit {
        oid
        abbreviatedOid
        messageHeadline
        committedDate
      }
    }
  }
}
</file>

<file path="source/plugins/contributors/examples.yml">
- name: Contributors with contributions count
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.contributors.contributions.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    template: repository
    repo: metrics
    plugin_contributors: yes
    plugin_contributors_contributions: yes

- name: Contributors by categories
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.contributors.categories.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    template: repository
    repo: metrics
    plugin_contributors: yes
    plugin_contributors_sections: categories
    plugin_contributors_categories: |
      {
        "üß© Plugins / üñºÔ∏è templates":["source/plugins/**", "source/templates/**"],
        "üìö Documentation":["README.md", "**/README.md", "**/metadata.yml"],
        "üíª Code (other)":["source/**", "Dockerfile"]
      }
</file>

<file path="source/plugins/contributors/index.mjs">
//Setup
export default async function({login, q, imports, data, rest, graphql, queries, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.contributors) || (!imports.metadata.plugins.contributors.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {head, base, ignored, contributions, sections, categories} = imports.metadata.plugins.contributors.inputs({data, account, q})
    const repo = {owner: data.repo.owner.login, repo: data.repo.name}
    ignored.push(...data.shared["users.ignored"])

    //Retrieve head and base commits
    console.debug(`metrics/compute/${login}/plugins > contributors > querying api head and base commits`)
    const ref = {
      head: (await graphql(queries.contributors.commit({...repo, expression: head}))).repository.object,
      base: (await graphql(queries.contributors.commit({...repo, expression: base}))).repository.object,
    }

    //Get commit activity
    console.debug(`metrics/compute/${login}/plugins > contributors > querying api for commits between [${ref.base?.abbreviatedOid ?? null}] and [${ref.head?.abbreviatedOid ?? null}]`)
    const commits = []
    for (let page = 1;; page++) {
      console.debug(`metrics/compute/${login}/plugins > contributors > loading page ${page}`)
      try {
        const {data: loaded} = await rest.repos.listCommits({...repo, per_page: 100, page})
        if (loaded.map(({sha}) => sha).includes(ref.base?.oid)) {
          console.debug(`metrics/compute/${login}/plugins > contributors > reached ${ref.base?.oid}`)
          commits.push(...loaded.slice(0, loaded.map(({sha}) => sha).indexOf(ref.base.oid)))
          break
        }
        if (!loaded.length) {
          console.debug(`metrics/compute/${login}/plugins > contributors > no more page to load`)
          break
        }
        commits.push(...loaded.filter(commit => commit?.author?.login))
      }
      catch (error) {
        if (/Git Repository is empty/.test(error))
          break
        throw error
      }
    }

    //Remove commits after head
    const start = Math.max(0, commits.map(({sha}) => sha).indexOf(ref.head?.oid))
    commits.splice(0, start)
    console.debug(`metrics/compute/${login}/plugins > contributors > ${commits.length} commits loaded (${start} removed)`)

    //Compute contributors and contributions
    let contributors = {}
    for (const {author: {login, avatar_url: avatar}, commit: {message = "", author: {email = ""} = {}}} of commits) {
      if ((!login) || (!imports.filters.text(login, ignored)) || (!imports.filters.text(email, ignored))) {
        console.debug(`metrics/compute/${login}/plugins > contributors > ignored contributor "${login}"`)
        continue
      }
      if (!(login in contributors))
        contributors[login] = {avatar: await imports.imgb64(avatar), contributions: 1, pr: []}
      else {
        contributors[login].contributions++
        contributors[login].pr.push(...(message.match(/(?<=[(])#\d+(?=[)])/g) ?? []))
      }
    }
    contributors = Object.fromEntries(Object.entries(contributors).sort(([_an, a], [_bn, b]) => b.contributions - a.contributions))

    //Filter pull requests
    for (const contributor of Object.values(contributors))
      contributor.pr = [...new Set(contributor.pr)]

    //Contributions categories
    const types = Object.fromEntries([...new Set(Object.keys(categories))].map(type => [type, new Set()]))
    if ((sections.includes("categories")) && (imports.metadata.plugins.contributors.extras("categories", {extras}))) {
      //Temporary directory
      const repository = `${repo.owner}/${repo.repo}`
      const path = imports.paths.join(imports.os.tmpdir(), `${repository.replace(/[^\w]/g, "_")}`)
      console.debug(`metrics/compute/${login}/plugins > contributors > cloning ${repository} to temp dir ${path}`)

      try {
        //Git clone into temporary directory
        await imports.fs.rm(path, {recursive: true, force: true})
        await imports.fs.mkdir(path, {recursive: true})
        const git = await imports.git(path)
        await git.clone(`https://github.com/${repository}`, ".").status()

        //Analyze contributors' contributions
        for (const contributor in contributors) {
          //Load edited files by contributor
          const files = []
          await imports.spawn("git", ["--no-pager", "log", `--author="${contributor}"`, "--regexp-ignore-case", "--no-merges", "--name-only", '--pretty=format:""'], {cwd: path}, {
            stdout(line) {
              if (line.trim().length)
                files.push(line)
            },
          })
          //Search for contributions type in specified categories
          filesloop:
          for (const file of files) {
            for (const [category, globs] of Object.entries(categories)) {
              for (const glob of [globs].flat(Infinity)) {
                if (imports.minimatch(file, glob, {nocase: true})) {
                  types[category].add(contributor)
                  continue filesloop
                }
              }
            }
          }
        }
      }
      catch (error) {
        console.debug(error)
        console.debug(`metrics/compute/${login}/plugins > contributors > an error occurred while processing ${repository}`)
      }
      finally {
        //Cleaning
        console.debug(`metrics/compute/${login}/plugins > contributors > cleaning temp dir ${path}`)
        await imports.fs.rm(path, {recursive: true, force: true})
      }
    }

    //Results
    return {head, base, ref, list: contributors, categories: types, contributions, sections}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/contributors/metadata.yml">
name: üèÖ Repository contributors
category: github
description: |
  This plugin display repositories contributors from a commit range along with additional stats.
examples:
  +by contribution types: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.contributors.categories.svg
  by number of contributions: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.contributors.contributions.svg
index: 8
supports:
  - repository
scopes:
  - public_access
inputs:

  plugin_contributors:
    description: |
      Enable contributors plugin
    type: boolean
    default: no

  plugin_contributors_base:
    description: |
      Base reference

      Can be a commit, tag, branch, etc.
    type: string
    default: ""
    example: commit, tag or branch

  plugin_contributors_head:
    description: |
      Head reference

      Can be a commit, tag, branch, etc.
    type: string
    default: master

  plugin_contributors_ignored:
    description: |
      Ignored users

      Can be used to ignore bots activity
    type: array
    format: comma-separated
    default: ""
    inherits: users_ignored

  plugin_contributors_contributions:
    description: |
      Contributions count
    type: boolean
    default: no

  plugin_contributors_sections:
    description: |
      Displayed sections

      - `contributors`: all contributors
      - `categories`: contributors sorted by contributions categories (must be configured with [`plugin_contributors_categories`](/source/plugins/contributors/README.md#plugin_contributors_categories))
    type: array
    format: comma-separated
    default: contributors
    example: contributors
    values:
      - contributors
      - categories

  plugin_contributors_categories:
    description: |
      Contribution categories

      This option requires [`plugin_contributors_sections`](/source/plugins/contributors/README.md#plugin_contributors_sections) to have `categories` in it to be effective.
      Pass a JSON object mapping category with file globs
    type: json
    default: |
      {
        "üìö Documentation": ["README.md", "docs/**"],
        "üíª Code": ["source/**", "src/**"],
        "#Ô∏è‚É£ Others": ["*"]
      }
    extras:
      - metrics.run.tempdir
      - metrics.run.git
</file>

<file path="source/plugins/core/examples.yml">
- name: Organization
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.organization.svg
    user: github
    token: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}
    base: header, repositories

- name: Large display
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.large.svg
    token: ${{ secrets.METRICS_TOKEN }}
    config_display: large

- name: JSON metrics
  if: ${{ success() || failure() }}
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.example.json
    token: ${{ secrets.METRICS_TOKEN }}
    config_output: json

- name: PNG metrics
  if: ${{ success() || failure() }}
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.example.png
    token: ${{ secrets.METRICS_TOKEN }}
    config_output: png

- name: Metrics insights
  if: ${{ success() || failure() }}
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.insights.html
    token: ${{ secrets.METRICS_TOKEN }}
    config_output: insights

- name: Presets
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.presets.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: header, repositories
    config_presets: https://raw.githubusercontent.com/lowlighter/metrics/presets/lunar-red/preset.yaml
  prod:
    skip: true
  test:
    modes:
      - web

- name: Plugin error example
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.error.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_projects: yes
  prod:
    with:
      plugins_errors_fatal: no
  test:
    skip: true
</file>

<file path="source/plugins/core/metadata.yml">
name: üß± Core
category: core
description: Global configuration and options
supports:
  - user
  - organization
  - repository
scopes: []
inputs:

  token:
    description: |
      GitHub Personal Access Token

      No scopes are required by default, though some plugins and features may require additional scopes.

      When using a configuration which does not requires a GitHub PAT, it is possible to pass `NOT_NEEDED` instead.
      When doing so, any settings which defaults on user fetched values will not be templated (e.g. `.user.*`) and will usually need to be set manually.
    type: token
    required: true

  user:
    description: |
      GitHub username

      Defaults to [`token`](/source/plugins/core/README.md#token) owner username.
    type: string
    default: ""
    preset: no

  repo:
    description: |
      GitHub repository

      This option is only revelant for repositories templates
    type: string
    default: ""
    preset: no

  committer_token:
    description: |
      GitHub Token used to commit metrics

      Leave this to `${{ github.token }}` or `${{ secrets.GITHUB_TOKEN }}`, which is a special auto-generated token restricted to current repository scope.

      > üí° When using [`output_action: gist`](/source/plugins/core/README.md#output_action), it will use [`token`](/source/plugins/core/README.md#token) instead, since gists are outside of scope
    type: token
    default: ${{ github.token }}

  committer_branch:
    description: |
      Target branch

      Defaults to current repository default branch
    type: string
    default: ""

  committer_message:
    description: |
      Commit message

      Use `${filename}` to display filename
    type: string
    default: Update ${filename} - [Skip GitHub Action]

  committer_gist:
    description: |
      Gist id

      Specify an existing gist id (can be retrieved from its URL) when using [`output_action: gist`](/source/plugins/core/README.md#output_action).
    type: string
    default: ""
    preset: no

  filename:
    description: |
      Output path

      When using an asterisk (`*`), correct extension will automatically be applied according to [`config_output`](/source/plugins/core/README.md#config_output) value
    type: string
    default: github-metrics.*

  markdown:
    description: |
      Markdown template path

      It can be either a local path or a full link (e.g. https://raw.githubusercontent.com)
    type: string
    default: TEMPLATE.md

  markdown_cache:
    description: |
      Markdown file cache
    type: string
    default: .cache

  output_action:
    description: |
      Output action
      - `none`: just create file in `/metrics_renders` directory of action runner
      - `commit`: push output to `committer_branch`
      - `pull-request`: push output to a new branch and open a pull request to `committer_branch`
      - `pull-request-merge`: same as `pull-request` and additionally merge pull request
      - `pull-request-squash`: same as `pull-request` and additionally squash and merge pull request
      - `pull-request-rebase`: same as `pull-request` and additionally rebase and merge pull request
      - `gist`: push output to `committer_gist`

      > üí° When using `pull-request`, you will need to set the last job with a `pull-request-*` action instead, else it won't be merged

      > ‚ö†Ô∏è As GitHub gists API does not support binary files upload, `gist` does not support [`config_output`](/source/plugins/core/README.md#config_output) set to either `png`, `jpeg` or `markdown-pdf`
    type: string
    default: commit
    values:
      - none
      - commit
      - pull-request
      - pull-request-merge
      - pull-request-squash
      - pull-request-rebase
      - gist

  output_condition:
    description: |
      Output condition
      - `always`: always try to push changes
      - `data-changed`: skip changes if no data changed (e.g. like when only metadata changed)

      > ‚ÑπÔ∏è This option is only revelant when [`config_output: svg`](/source/plugins/core/README.md#config_output) is set
    type: string
    default: always
    values:
      - always
      - data-changed

  optimize:
    description: |
      Optimization features
      - `css`: purge and minify CSS styles
      - `xml`: pretty-print XML (useful to reduce diff)
      - `svg`: optimization with SVGO (experimental, requires [`experimental_features: --optimize-svg`](/source/plugins/core/README.md#experimental_features))

      Templates may not always honour all provided options
    type: array
    default: css, xml
    format: comma-separated
    values:
      - css
      - xml
      - svg

  setup_community_templates:
    description: |
      Community templates to setup

      See [community templates guide](https://github.com/lowlighter/metrics/blob/master/source/templates/community/README.md) for more informations
    type: array
    format: comma-separated
    default: ""
    extras:
      - metrics.setup.community.templates

  template:
    description: |
      Template

      Community templates must be prefixed by at sign (`@`)
      See [list of supported templates](https://github.com/lowlighter/metrics/blob/master/README.md#%EF%B8%8F-templates)
    type: string
    default: classic

  query:
    description: |
      Query parameters

      Pass additional parameters to templates.
      This is mostly useful for custom templates.

      > ‚ö†Ô∏è **Do not** use this option to pass other existing parameters, they will be overwritten
    type: json
    default: "{}"

  extras_css:
    description: |
      Extra CSS

      Custom CSS that will be injected in used template.
      Useful to avoid creating a new template just to tweak some styling

      > üí° *metrics* tends to avoid using `!important` rules, which means that most styling can be overridden by this option when using `!important`
    type: string
    default: ""
    extras:
      - metrics.run.puppeteer.user.css

  extras_js:
    description: |
      Extra JavaScript

      Custom JavaScript that will be executed during puppeteer rendering.
      Useful to avoid creating a new template just to tweak some content.

      > ‚ö†Ô∏è Note that is it executed within puppeteer context and **not** within *metrics* context.
      > No access to fetched data or configuration will be offered through this context.
      > It is run after transformations and optimizations, but just before resizing.
    type: string
    default: ""
    extras:
      - metrics.run.puppeteer.user.js

  github_api_rest:
    description: |
      GitHub REST API endpoint

      Can be used to support [GitHub enterprises server](https://github.com/enterprise).
      Leave empty to use default endpoint.
    type: string
    default: ""
    example: https://api.github.com
    global: yes

  github_api_graphql:
    description: |
      GitHub GraphQL API endpoint

      Can be used to support [GitHub enterprises server](https://github.com/enterprise).
      Leave empty to use default endpoint.

      > ‚ÑπÔ∏è GraphQL octokit will automatically append `/graphql` to provided endpoint
    type: string
    default: ""
    example: https://api.github.com
    global: yes

  config_timezone:
    description: |
      Timezone for dates

      See [list of supported timezone](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)
    type: string
    default: ""
    global: yes

  config_order:
    description: |
      Plugin order

      By default, templates use `partials/_.json` ordering.
      You can override the content order by using this setting.

      If some partials are omitted, they will be appended at the end with default ordering
    type: array
    format: comma-separated
    default: ""
    example: base.header, base.repositories
    global: yes

  config_twemoji:
    description: |
      Use twemojis

      Replace emojis by [twemojis]([twemojis](https://github.com/twitter/twemoji)) to have a consistent render across all platforms
      May increase filesize.
    type: boolean
    default: no
    global: yes

  config_gemoji:
    description: |
      Use GitHub custom emojis

      GitHub supports additional emojis which are not registered in Unicode standard (:octocat:, :shipit:, :trollface:, ...)
      See full list at https://api.github.com/emojis.

      This option has no effect when [`token: NOT_NEEDED``](/source/plugins/core/README.md#token) is set.

      May increase filesize
    type: boolean
    default: yes
    global: yes

  config_octicon:
    description: |
      Use GitHub octicons

      Octicons are open-sourced icons provided by GitHub.
      See full list at https://primer.style/octicons.

      To include an octicon, use the following syntax: `:octicon-{name}-{size}:`.
      Size must be a supported icon size (12, 16 or 24).
      16px octicons can omit size and directly use `:octicon-{name}:` syntax.

      May increase filesize
    type: boolean
    default: no
    global: yes

  config_display:
    description: |
      Display width (for image output formats)

      - `regular`: 480px width
      - `large`: 960px width (may not be supported by all templates)
      - `columns`: Full width with auto-sizing (two columns for desktops, and one column for mobile)
        - known issue: https://github.com/lowlighter/metrics/issues/374
    type: string
    default: regular
    values:
      - regular
      - large
      - columns
    global: yes

  config_animations:
    description: |
      Use CSS animations
    type: boolean
    default: yes
    global: yes

  config_base64:
    description: |
      Base64-encoded images

      Enable this option to make self-contained output (i.e. with no external links)
    type: boolean
    default: yes
    global: yes

  config_padding:
    description: |
      Output padding

      Although *metrics* try to auto-guess resulting height, rendering is still dependent on OS and browser settings.
      It can result in cropped or oversized outputs.

      This settings let you manually adjust padding with the following format:
      - 1 value for both width and height
      - 2 values for width fist and height second, separated by a comma (`,`)

      Each value need to respect the following format:
      - `{number}`
      - `{number} + {number}%`
      - `{number}%`

      Percentage are relative to computed dimensions
    type: string
    default: 0, 8 + 11%

  config_output:
    description: |
      Output format
      - `auto`: Template default (usually `svg` or `markdown`)
      - `svg`: SVG image
      - `png`: PNG image (animations not supported)
      - `jpeg`: JPEG image (animations and transparency not supported)
      - `json`: JSON data dump
      - `markdown`: Markdown rendered file
      - `markdown-pdf`: PDF from markdown rendered file
      - `insights`: Metrics Insights self-contained HTML file (not configurable)
    type: string
    default: auto
    values:
      - auto
      - svg
      - png
      - jpeg
      - json
      - markdown
      - markdown-pdf
      - insights

  config_presets:
    description: |
      Configuration presets
    type: array
    format: comma-separated
    default: ""
    preset: no
    example: "@lunar-red"
    extras:
      - metrics.setup.community.presets

  retries:
    description: |
      Retries in case of failures (for rendering)
    type: number
    default: 3
    min: 1
    max: 10

  retries_delay:
    description: |
      Delay between each retry (in seconds, for rendering)
    type: number
    default: 300
    min: 0
    max: 3600

  retries_output_action:
    description: |
      Retries in case of failures (for output action)
    type: number
    default: 5
    min: 1
    max: 10

  retries_delay_output_action:
    description: |
      Delay between each retry (in seconds, for output action)
    type: number
    default: 120
    min: 0
    max: 3600

  clean_workflows:
    description: |
      Clean previous workflows jobs

      This can be used to clean up Action tabs from previous workflows runs.

      Use `all` to clean up workflows runs in any state.

      > ‚ö†Ô∏è When reporting issues, it is **required** to provide logs so it can be investigated and reproduced.
      > Be sure to disable this option when asking for help or submitting bug reports.
    type: array
    format: comma-separated
    default: ""
    preset: no
    example: ""
    values:
      - cancelled
      - failure
      - success
      - skipped
      - startup_failure
      - timed_out
      - all

  delay:
    description: |
      Job delay

      This can be used to avoid triggering GitHub abuse mechanics on large workflows
    type: number
    default: 0
    min: 0
    max: 3600

  quota_required_rest:
    description: |
      Minimum GitHub REST API requests quota required to run

      Action will cancel itself without any errors if requirements are not met

      This option has no effect when [`token: NOT_NEEDED`](/source/plugins/core/README.md#token) is set
    type: number
    default: 200
    min: 0
    max: 5000

  quota_required_graphql:
    description: |
      Minimum GitHub GraphQL API requests quota required to run

      Action will cancel itself without any errors if requirements are not met

      This option has no effect when [`token: NOT_NEEDED`](/source/plugins/core/README.md#token) is set
    type: number
    default: 200
    min: 0
    max: 5000

  quota_required_search:
    description: |
      Minimum GitHub Search API requests quota required to run

      Action will cancel itself without any errors if requirements are not met

      This option has no effect when [`token: NOT_NEEDED`](/source/plugins/core/README.md#token) is set
    type: number
    default: 0
    min: 0
    max: 30

  notice_releases:
    description: |
      Notice about new releases of metrics
    type: boolean
    default: yes

  # ====================================================================================
  # üöß Options below are mostly used for testing

  use_prebuilt_image:
    description: |
      Use pre-built docker image from [GitHub container registry](https://github.com/lowlighter/metrics/pkgs/container/metrics)

      It allows to save build time and make job significantly faster, and there is almost no reason to disable this settings.
      This option has no effects on forks (images will always be rebuilt from Dockerfile)
    type: boolean
    default: yes
    testing: yes
    preset: no

  plugins_errors_fatal:
    description: |
      Fatal plugin errors

      When enabled, the job will fail in case of plugin errors, else it will be handled gracefully in output with an error message
    type: boolean
    default: no
    testing: yes
    preset: no

  debug:
    description: |
      Debug mode

      This setting is automatically enable if a job fail (useful with [`plugins_errors_fatal: yes`](/source/plugins/core/README.md#plugins_errors_fatal))
    type: boolean
    default: no
    testing: yes
    preset: no

  verify:
    description: |
      SVG validity check
    type: boolean
    default: no
    testing: yes
    preset: no
    extras:
      - metrics.npm.optional.libxml2

  debug_flags:
    description: |
      Debug flags
      - `--cakeday`: simulate registration anniversary
      - `--halloween`: enable halloween colors *(only first color scheme will be applied if multiple are specified)*
      - `--winter`: enable winter colors *(only first color scheme will be applied if multiple are specified)*
      - `--error`: force render error
      - `--puppeteer-debug`: enable puppeteer debug mode\*
      - `--puppeteer-disable-headless`: disable puppeteer headless mode *(requires a graphical environment)*\*
      - `--puppeteer-wait-load`: override puppeteer wait events\*
      - `--puppeteer-wait-domcontentloaded`: override puppeteer wait events\*
      - `--puppeteer-wait-networkidle0`: override puppeteer wait events\*
      - `--puppeteer-wait-networkidle2`: override puppeteer wait events\*

      > *\* üåê Web instances needs to have [`debug`](/source/plugins/core/README.md#debug) set in `settings.json` for these flags to be supported.*

      > ‚ö†Ô∏è No backward compatibility is guaranteed for these features, they are only meant for debugging purposes.
    type: array
    format: space-separated
    default: ""
    values:
      - --cakeday
      - --halloween
      - --winter
      - --error
      - --puppeteer-debug
      - --puppeteer-disable-headless
      - --puppeteer-wait-load
      - --puppeteer-wait-domcontentloaded
      - --puppeteer-wait-networkidle0
      - --puppeteer-wait-networkidle2
    testing: yes
    preset: no

  debug_print:
    description: |
      Print output in console
    type: boolean
    default: no
    testing: yes
    preset: no

  dryrun:
    description: |
      Dry-run

      > ‚ö†Ô∏è Unlike [`output_action: none`](/source/plugins/core/README.md#output_action), output file won't be available in `/metrics_renders` directory
    type: boolean
    default: no
    testing: yes
    preset: no

  experimental_features:
    description: |
      Experimental features

      > ‚ö†Ô∏è No backward compatibility is guaranteed for these features
    type: array
    format: space-separated
    default: ""
    values:
      - --optimize-svg
    testing: yes
    preset: no

  use_mocked_data:
    description: |
      Use mocked data instead of live APIs
    type: boolean
    default: no
    testing: yes
    preset: no
</file>

<file path="source/plugins/discussions/queries/categories.graphql">
query DiscussionsCategories {
  user(login: "$login") {
    repositoryDiscussions($after first: 100, orderBy: {field: CREATED_AT, direction: DESC}) {
      edges {
        cursor
      }
      nodes {
        upvoteCount
        category {
          emoji
          name
        }
      }
    }
  }
}
</file>

<file path="source/plugins/discussions/queries/comments.graphql">
query DiscussionsComments {
  user(login: "$login") {
    repositoryDiscussionComments($after first: 100) {
      edges {
        cursor
      }
      nodes {
        upvoteCount
      }
    }
  }
}
</file>

<file path="source/plugins/discussions/queries/statistics.graphql">
query DiscussionsStatistics {
  user(login: "$login") {
    started: repositoryDiscussions {
      totalCount
    }
    comments: repositoryDiscussionComments {
      totalCount
    }
    answers: repositoryDiscussionComments(onlyAnswers: true) {
      totalCount
    }
  }
}
</file>

<file path="source/plugins/discussions/examples.yml">
- name: GitHub Discussions
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.discussions.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_discussions: yes
    plugin_discussions_categories_limit: 8
</file>

<file path="source/plugins/discussions/index.mjs">
//Setup
export default async function({login, q, imports, graphql, queries, data, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.discussions) || (!imports.metadata.plugins.discussions.enabled(enabled, {extras})))
      return null

    //Load inputs
    const {categories: _categories, "categories.limit": _categories_limit} = imports.metadata.plugins.discussions.inputs({data, account, q})
    const discussions = {categories: {}, upvotes: {discussions: 0, comments: 0}}
    discussions.display = {categories: _categories ? {limit: _categories_limit || Infinity} : null}

    //Fetch general statistics
    const stats = Object.fromEntries(Object.entries((await graphql(queries.discussions.statistics({login}))).user).map(([key, value]) => [key, value.totalCount]))
    Object.assign(discussions, stats)

    //Load started discussions
    {
      const fetched = []
      const categories = {}
      let cursor = null
      let pushed = 0
      do {
        console.debug(`metrics/compute/${login}/discussions > retrieving discussions after ${cursor}`)
        const {user: {repositoryDiscussions: {edges = [], nodes = []} = {}}} = await graphql(queries.discussions.categories({login, after: cursor ? `after: "${cursor}"` : ""}))
        cursor = edges?.[edges?.length - 1]?.cursor
        fetched.push(...nodes)
        pushed = nodes.length
        console.debug(`metrics/compute/${login}/discussions > retrieved ${pushed} discussions after ${cursor}`)
      }
      while ((pushed) && (cursor))

      //Compute upvotes
      fetched.map(({upvoteCount}) => discussions.upvotes.discussions += upvoteCount)

      //Compute favorite category
      for (const category of [...fetched.map(({category: {emoji, name}}) => `${imports.emoji.get(emoji) ?? emoji} ${name}`)])
        categories[category] = (categories[category] ?? 0) + 1
      const categoryEntries = Object.entries(categories).sort((a, b) => b[1] - a[1])
      discussions.categories.stats = Object.fromEntries(categoryEntries)
      discussions.categories.favorite = categoryEntries[0]?.[0] ?? null
    }

    //Load comments
    {
      const fetched = []
      let cursor = null
      let pushed = 0
      do {
        console.debug(`metrics/compute/${login}/discussions > retrieving comments after ${cursor}`)
        const {user: {repositoryDiscussionComments: {edges = [], nodes = []} = {}}} = await graphql(queries.discussions.comments({login, after: cursor ? `after: "${cursor}"` : ""}))
        cursor = edges?.[edges?.length - 1]?.cursor
        fetched.push(...nodes)
        pushed = nodes.length
        console.debug(`metrics/compute/${login}/discussions > retrieved ${pushed} comments after ${cursor}`)
      }
      while ((pushed) && (cursor))

      //Compute upvotes
      fetched.map(({upvoteCount}) => discussions.upvotes.comments += upvoteCount)
    }

    //Results
    return discussions
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/discussions/metadata.yml">
name: üí¨ Discussions
category: github
description: |
  This plugin displays GitHub discussions stats.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.discussions.svg
index: 15
supports:
  - user
scopes:
  - public_access
inputs:

  plugin_discussions:
    description: |
      Enable discussions plugin
    type: boolean
    default: no

  plugin_discussions_categories:
    description: |
      Discussion categories
    type: boolean
    default: yes

  plugin_discussions_categories_limit:
    description: |
      Display limit (categories)

      Note that categories are sorted from highest to lowest count
    type: number
    default: 0
    zero: disable
</file>

<file path="source/plugins/followup/queries/repository.collaborators.graphql">
query FollowupRepositoryCollaborators {
  repository(name: "$repo", owner: "$owner") {
    collaborators {
      nodes {
        login
      }
    }
  }
}
</file>

<file path="source/plugins/followup/queries/repository.graphql">
query FollowupRepository {
  issues_open:search(query: "repo:$owner/$repo is:issue $collaborators is:open", type: ISSUE, first: 0) {
    issueCount
  }
  issues_drafts:search(query: "repo:$owner/$repo is:issue $collaborators draft:true", type: ISSUE, first: 0) {
    issueCount
  }
  issues_skipped:search(query: "repo:$owner/$repo is:issue $collaborators is:closed label:wontfix,duplicate", type: ISSUE, first: 0) {
    issueCount
  }
  issues_closed:search(query: "repo:$owner/$repo is:issue $collaborators is:closed", type: ISSUE, first: 0) {
    issueCount
  }
  pr_open:search(query: "repo:$owner/$repo is:pr $collaborators is:open draft:false", type: ISSUE, first: 0) {
    issueCount
  }
  pr_drafts:search(query: "repo:$owner/$repo is:pr $collaborators draft:true", type: ISSUE, first: 0) {
    issueCount
  }
  pr_closed:search(query: "repo:$owner/$repo is:pr $collaborators is:unmerged is:closed draft:false", type: ISSUE, first: 0) {
    issueCount
  }
  pr_merged:search(query: "repo:$owner/$repo is:pr $collaborators is:merged", type: ISSUE, first: 0) {
    issueCount
  }
}
</file>

<file path="source/plugins/followup/queries/user.graphql">
query FollowupUser {
  issues_open:search(query: "is:issue author:$login is:open $archived", type: ISSUE, first: 0) {
    issueCount
  }
  issues_drafts:search(query: "is:issue author:$login draft:true $archived", type: ISSUE, first: 0) {
    issueCount
  }
  issues_skipped:search(query: "is:issue author:$login is:closed label:wontfix,duplicate $archived", type: ISSUE, first: 0) {
    issueCount
  }
  issues_closed:search(query: "is:issue author:$login is:closed $archived", type: ISSUE, first: 0) {
    issueCount
  }
  pr_open:search(query: "is:pr author:$login is:open draft:false $archived", type: ISSUE, first: 0) {
    issueCount
  }
  pr_drafts:search(query: "is:pr author:$login draft:true $archived", type: ISSUE, first: 0) {
    issueCount
  }
  pr_closed:search(query: "is:pr author:$login is:unmerged is:closed draft:false $archived", type: ISSUE, first: 0) {
    issueCount
  }
  pr_merged:search(query: "is:pr author:$login is:merged $archived", type: ISSUE, first: 0) {
    issueCount
  }
}
</file>

<file path="source/plugins/followup/examples.yml">
- name: Opened on user's repositories
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.followup.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_followup: yes

- name: Opened by user
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.followup.user.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_followup: yes
    plugin_followup_sections: user

- name: Indepth analysis
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.followup.indepth.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_followup: yes
    plugin_followup_indepth: yes

- name: Exclude Archived
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.followup.archived.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_followup: yes
    plugin_followup_archived: no
  prod:
    skip: true
</file>

<file path="source/plugins/followup/index.mjs">
//Setup
export default async function({login, data, computed, imports, q, graphql, queries, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.followup) || (!imports.metadata.plugins.followup.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {sections, indepth, archived} = imports.metadata.plugins.followup.inputs({data, account, q})

    archived = archived === false ? "archived:false" : ""

    //Define getters
    const followup = {
      sections,
      issues: {
        get count() {
          return this.open + this.closed + this.drafts + this.skipped
        },
        get open() {
          return computed.repositories.issues_open
        },
        get closed() {
          return computed.repositories.issues_closed
        },
        drafts: 0,
        skipped: 0,
        collaborators: {
          open: 0,
          closed: 0,
          drafts: 0,
          skipped: 0,
        },
      },
      pr: {
        get count() {
          return this.open + this.closed + this.merged + this.drafts
        },
        get open() {
          return computed.repositories.pr_open
        },
        get closed() {
          return computed.repositories.pr_closed
        },
        get merged() {
          return computed.repositories.pr_merged
        },
        drafts: 0,
        collaborators: {
          open: 0,
          closed: 0,
          merged: 0,
          drafts: 0,
        },
      },
    }

    //Indepth mode
    if ((indepth) && (imports.metadata.plugins.followup.extras("indepth", {extras}))) {
      console.debug(`metrics/compute/${login}/plugins > followup > indepth`)
      followup.indepth = {repositories: {}}

      //Process repositories
      for (const {name: repo, owner: {login: owner}} of data.user.repositories.nodes) {
        try {
          console.debug(`metrics/compute/${login}/plugins > followup > processing ${owner}/${repo}`)
          followup.indepth.repositories[`${owner}/${repo}`] = {stats: {}}
          //Fetch users with push access
          let {repository: {collaborators: {nodes: collaborators}}} = await graphql(queries.followup["repository.collaborators"]({repo, owner})).catch(() => ({repository: {collaborators: {nodes: [{login: owner}]}}}))
          console.debug(`metrics/compute/${login}/plugins > followup > found ${collaborators.length} collaborators`)
          followup.indepth.repositories[`${owner}/${repo}`].collaborators = collaborators.map(({login}) => login)
          //Fetch issues and pull requests created by collaborators
          collaborators = collaborators.map(({login}) => `-author:${login}`).join(" ")
          const stats = await graphql(queries.followup.repository({repo, owner, collaborators}))
          followup.indepth.repositories[`${owner}/${repo}`] = stats
          //Aggregate global stats
          for (const [key, {issueCount: count}] of Object.entries(stats)) {
            const [section, type] = key.split("_")
            followup[section].collaborators[type] += count
          }
        }
        catch (error) {
          console.debug(error)
          console.debug(`metrics/compute/${login}/plugins > followup > an error occurred while processing ${owner}/${repo}, skipping...`)
        }
      }
    }

    //Load user issues and pull requests
    if ((account === "user") && (sections.includes("user"))) {
      const search = await graphql(queries.followup.user({login, archived}))
      followup.user = {
        issues: {
          get count() {
            return this.open + this.closed + this.drafts + this.skipped
          },
          open: search.issues_open.issueCount,
          closed: search.issues_closed.issueCount,
          drafts: search.issues_drafts.issueCount,
          skipped: search.issues_skipped.issueCount,
        },
        pr: {
          get count() {
            return this.open + this.closed + this.merged + this.drafts
          },
          open: search.pr_open.issueCount,
          closed: search.pr_closed.issueCount,
          merged: search.pr_merged.issueCount,
          drafts: search.pr_drafts.issueCount,
        },
      }
    }

    //Results
    return followup
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/followup/metadata.yml">
name: üéüÔ∏è Follow-up of issues and pull requests
category: github
description: |
  This plugin displays the ratio of open/closed issues and the ratio of open/merged pull requests across repositories.
examples:
  +indepth analysis: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.followup.indepth.svg
  created on a user's repositories: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.followup.svg
  created by a user: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.followup.user.svg
index: 9
supports:
  - user
  - organization
  - repository
scopes:
  - public_access
inputs:

  plugin_followup:
    description: |
      Enable followup plugin
    type: boolean
    default: no

  plugin_followup_sections:
    description: |
      Displayed sections

      - `repositories`: overall status of issues and pull requests on your repositories
      - `user`: overall status of issues and pull requests you have created on GitHub
    type: array
    format: comma-separated
    default: repositories
    values:
      - repositories
      - user

  plugin_followup_indepth:
    description: |
      Indepth analysis
    type: boolean
    default: no
    extras:
      - metrics.api.github.overuse

  plugin_followup_archived:
    description: |
      Include archived repositories
    type: boolean
    default: yes
</file>

<file path="source/plugins/gists/queries/gists.graphql">
query GistsDefault {
  user(login: "$login") {
    gists($after first: 100, orderBy: {field: UPDATED_AT, direction: DESC}) {
      edges {
        cursor
      }
      totalCount
      nodes {
        stargazerCount
        isFork
        forks {
          totalCount
        }
        files {
          name
        }
        comments {
          totalCount
        }
      }
    }
  }
}
</file>

<file path="source/plugins/gists/examples.yml">
- name: Gists
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.gists.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_gists: yes
</file>

<file path="source/plugins/gists/index.mjs">
//Setup
export default async function({login, data, graphql, q, imports, queries, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.gists) || (!imports.metadata.plugins.gists.enabled(enabled, {extras})))
      return null

    //Load inputs
    imports.metadata.plugins.gists.inputs({data, account, q})

    //Query gists from GitHub API
    const gists = []
    {
      //Iterate through gists
      let cursor = null
      let pushed = 0
      do {
        console.debug(`metrics/compute/${login}/plugins > gists > retrieving gists after ${cursor}`)
        const {user: {gists: {edges, nodes, totalCount}}} = await graphql(queries.gists({login, after: cursor ? `after: "${cursor}"` : ""}))
        cursor = edges?.[edges?.length - 1]?.cursor
        gists.push(...nodes)
        gists.totalCount = totalCount
        pushed = nodes.length
      }
      while ((pushed) && (cursor))
      console.debug(`metrics/compute/${login}/plugins > gists > loaded ${gists.length} gists`)
    }

    //Iterate through gists
    console.debug(`metrics/compute/${login}/plugins > gists > processing ${gists.length} gists`)
    let comments = 0, files = 0, forks = 0, stargazers = 0
    for (const gist of gists) {
      //Skip forks
      if (gist.isFork)
        continue
      //Compute stars, forks, comments and files count
      stargazers += gist.stargazerCount
      forks += gist.forks.totalCount
      comments += gist.comments.totalCount
      files += gist.files.length
    }

    //Results
    return {totalCount: gists.totalCount, stargazers, forks, files, comments}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/gists/metadata.yml">
name: üé´ Gists
category: github
description: |
  This plugin displays [gists](https://gist.github.com) stats.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.gists.svg
index: 24
supports:
  - user
scopes:
  - public_access
inputs:

  plugin_gists:
    description: |
      Enable gists plugin
    type: boolean
    default: no
</file>

<file path="source/plugins/habits/examples.yml">
- name: Mildly interesting facts
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.habits.facts.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_habits: yes
    plugin_habits_facts: yes
    plugin_habits_charts: no
    config_timezone: Europe/Paris

- name: Recent activity charts
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.habits.charts.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_habits: yes
    plugin_habits_facts: no
    plugin_habits_charts: yes
    config_timezone: Europe/Paris
</file>

<file path="source/plugins/habits/metadata.yml">
name: üí° Coding habits and activity
category: github
description: |
  This plugin displays coding habits based on recent activity, such as active hours and languages recently used.
examples:
  +recent activity charts: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.habits.charts.svg
  +mildly interesting facts: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.habits.facts.svg
index: 7
supports:
  - user
  - organization
scopes:
  - public_access
inputs:

  plugin_habits:
    description: |
      Enable habits plugin
    type: boolean
    default: no

  plugin_habits_from:
    description: |
      Events to use

      A higher number will increase stats accuracy
    type: number
    default: 200
    min: 1
    max: 1000

  plugin_habits_skipped:
    description: |
      Skipped repositories
    type: array
    format: 
      - newline-separated
      - comma-separated
    default: ""
    example: my-repo-1, my-repo-2, owner/repo-3, ...
    inherits: repositories_skipped

  plugin_habits_days:
    description: |
      Event maximum age
    type: number
    default: 14
    min: 1
    max: 30

  plugin_habits_facts:
    description: |
      Mildly interesting facts

      It includes indentation type, average number of characters per line of code, and most active time and day
    type: boolean
    default: yes

  plugin_habits_charts:
    description: |
      Charts

      It includes commit activity per hour of day and commit activity per day of week
      Recent language activity may also displayed (it requires extras features to be enabled for web instances) for historical reasons
    type: boolean
    default: no
    extras:
      - metrics.api.github.overuse
      - metrics.run.tempdir
      - metrics.run.git

  plugin_habits_charts_type:
    description: |
      Charts display type

      - `classic`: `<div>` based charts, simple and lightweight
      - `graph`: `<svg>` based charts, smooth

      > ‚ö†Ô∏è `chartist` option has been deprecated and is now equivalent to `graph`
    type: string
    default: classic
    values:
      - classic
      - graph
      - chartist
    extras:
      - metrics.npm.optional.d3

  plugin_habits_trim:
    description: |
      Trim unused hours on charts
    type: boolean
    default: no

  plugin_habits_languages_limit:
    description: |
      Display limit (languages)
    type: number
    default: 8
    min: 0
    max: 8
    zero: disable

  plugin_habits_languages_threshold:
    description: |
      Display threshold (percentage)
    type: string
    default: 0%
</file>

<file path="source/plugins/introduction/queries/organization.graphql">
query IntroductionOrganization {
  organization(login: "$login") {
    description
  }
}
</file>

<file path="source/plugins/introduction/queries/repository.graphql">
query IntroductionRepository {
  repository(name: "$repo", owner: "$owner") {
    description
  }
}
</file>

<file path="source/plugins/introduction/queries/user.graphql">
query IntroductionUser {
  user(login: "$login") {
    bio
  }
}
</file>

<file path="source/plugins/introduction/examples.yml">
- name: Organization introduction
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.introduction.svg
    token: ${{ secrets.METRICS_TOKEN }}
    user: github
    base: header
    plugin_introduction: yes
  prod:
    with:
      token: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}

- name: Repository introduction
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.introduction.repository.svg
    token: ${{ secrets.METRICS_TOKEN }}
    template: repository
    repo: metrics
    base: header
    plugin_introduction: yes
</file>

<file path="source/plugins/introduction/index.mjs">
//Setup
export default async function({login, q, imports, data, graphql, queries, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.introduction) || (!imports.metadata.plugins.introduction.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {title} = imports.metadata.plugins.introduction.inputs({data, account, q})

    //Context
    let context = {mode: account, login}
    if (q.repo) {
      console.debug(`metrics/compute/${login}/plugins > people > switched to repository mode`)
      const {owner, repo} = data.user.repositories.nodes.map(({name: repo, owner: {login: owner}}) => ({repo, owner})).shift()
      context = {...context, mode: "repository", owner, repo}
    }

    //Querying API
    console.debug(`metrics/compute/${login}/plugins > introduction > querying api`)
    const text = (await graphql(queries.introduction[context.mode](context)))[context.mode][{user: "bio", organization: "description", repository: "description"}[context.mode]]

    //Results
    return {mode: context.mode, title, text}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/introduction/metadata.yml">
name: "üôã Introduction"
category: github
description: |
  This plugin displays account bio or organization/repository description.

  Since account bio is already displayed on account profile, this plugin is mostly intended for external usage.
examples:
  +for a user or an organization: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.introduction.svg
  for a repository: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.introduction.repository.svg
index: 26
supports:
  - user
  - organization
  - repository
scopes:
  - public_access
inputs:

  plugin_introduction:
    description: |
      Enable introduction plugin
    type: boolean
    default: no

  plugin_introduction_title:
    description: |
      Section title
    type: boolean
    default: yes
</file>

<file path="source/plugins/isocalendar/queries/calendar.graphql">
query IsocalendarCalendar {
  user(login: "$login") {
    calendar:contributionsCollection(from: "$from", to: "$to") {
      contributionCalendar {
        weeks {
          contributionDays {
            contributionCount
            color
            date
          }
        }
      }
    }
  }
}
</file>

<file path="source/plugins/isocalendar/examples.yml">
- name: Half-year calendar
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.isocalendar.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_isocalendar: yes

- name: Full-year calendar
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.isocalendar.fullyear.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_isocalendar: yes
    plugin_isocalendar_duration: full-year
</file>

<file path="source/plugins/isocalendar/index.mjs">
//Setup
export default async function({login, data, graphql, q, imports, queries, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.isocalendar) || (!imports.metadata.plugins.isocalendar.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {duration} = imports.metadata.plugins.isocalendar.inputs({data, account, q})

    //Compute start day
    const now = new Date()
    const start = new Date(now)
    if (duration === "full-year")
      start.setUTCFullYear(now.getUTCFullYear() - 1)
    else
      start.setUTCHours(-180 * 24)

    //Ensure start day is a sunday, and that time is set to 00:00:00.000
    if (start.getUTCDay())
      start.setUTCHours(-start.getUTCDay() * 24)
    start.setUTCMilliseconds(0)
    start.setUTCSeconds(0)
    start.setUTCMinutes(0)
    start.setUTCHours(0)

    //Compute contribution calendar, highest contributions in a day, streaks and average commits per day
    console.debug(`metrics/compute/${login}/plugins > isocalendar > computing stats`)
    const calendar = {weeks: []}
    const {streak, max, average} = await statistics({login, graphql, queries, start, end: now, calendar})
    const reference = Math.max(...calendar.weeks.flatMap(({contributionDays}) => contributionDays.map(({contributionCount}) => contributionCount)))

    //Compute SVG
    console.debug(`metrics/compute/${login}/plugins > isocalendar > computing svg render`)
    const size = 6
    let i = 0, j = 0
    let svg = `
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" style="margin-top: -130px;" viewBox="0,0 480,${duration === "full-year" ? 270 : 170}">
              ${
      [1, 2].map(k => `
                <filter id="brightness${k}">
                  <feComponentTransfer>
                    ${[..."RGB"].map(channel => `<feFunc${channel} type="linear" slope="${1 - k * 0.4}" />`).join("")}
                  </feComponentTransfer>
                </filter>`)
        .join("")
    }
              <g transform="scale(4) translate(12, 0)">`
    //Iterate through weeks
    for (const week of calendar.weeks) {
      svg += `<g transform="translate(${i * 1.7}, ${i})">`
      j = 0
      //Iterate through days
      for (const day of week.contributionDays) {
        const ratio = (day.contributionCount / reference) || 0
        svg += `
                    <g transform="translate(${j * -1.7}, ${j + (1 - ratio) * size})">
                      <path fill="${day.color}" d="M1.7,2 0,1 1.7,0 3.4,1 z" />
                      <path fill="${day.color}" filter="url(#brightness1)" d="M0,1 1.7,2 1.7,${2 + ratio * size} 0,${1 + ratio * size} z" />
                      <path fill="${day.color}" filter="url(#brightness2)" d="M1.7,2 3.4,1 3.4,${1 + ratio * size} 1.7,${2 + ratio * size} z" />
                    </g>`
        j++
      }
      svg += "</g>"
      i++
    }
    svg += "</g></svg>"

    //Results
    return {streak, max, average, svg, duration}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}

/**Compute max and current streaks */
async function statistics({login, graphql, queries, start, end, calendar}) {
  let average = 0, max = 0, streak = {max: 0, current: 0}, values = []
  //Load contribution calendar
  for (let from = new Date(start); from < end;) {
    //Set date range
    let to = new Date(from)
    to.setUTCHours(+4 * 7 * 24)
    if (to > end)
      to = end
    //Ensure that date ranges are not overlapping by setting it to previous day at 23:59:59.999
    const dto = new Date(to)
    dto.setUTCHours(-1)
    dto.setUTCMinutes(59)
    dto.setUTCSeconds(59)
    dto.setUTCMilliseconds(999)
    //Fetch data from api
    console.debug(`metrics/compute/${login}/plugins > isocalendar > loading calendar from "${from.toISOString()}" to "${dto.toISOString()}"`)
    const {user: {calendar: {contributionCalendar: {weeks}}}} = await graphql(queries.isocalendar.calendar({login, from: from.toISOString(), to: dto.toISOString()}))
    calendar.weeks.push(...weeks)
    //Set next date range start
    from = new Date(to)
  }
  //Compute streaks
  for (const week of calendar.weeks) {
    for (const day of week.contributionDays) {
      values.push(day.contributionCount)
      max = Math.max(max, day.contributionCount)
      streak.current = day.contributionCount ? streak.current + 1 : 0
      streak.max = Math.max(streak.max, streak.current)
    }
  }
  //Compute average
  average = (values.reduce((a, b) => a + b, 0) / values.length).toFixed(2).replace(/[.]0+$/, "")
  return {streak, max, average}
}
</file>

<file path="source/plugins/isocalendar/metadata.yml">
name: üìÖ Isometric commit calendar
category: github
description: |
  This plugin displays an isometric view of a user commit calendar along with a few additional statistics like current streak and average number of commit per day.
examples:
  +full year calendar: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.isocalendar.fullyear.svg
  half year calendar: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.isocalendar.svg
index: 0
supports:
  - user
scopes:
  - public_access
inputs:

  plugin_isocalendar:
    description: |
      Enable isocalendar plugin
    type: boolean
    default: no

  plugin_isocalendar_duration:
    description: |
      Time range

      - `half-year`: 180 days
      - `full-year`: 1 year
    type: string
    default: half-year
    values:
      - half-year
      - full-year
</file>

<file path="source/plugins/languages/analyzer/cli.mjs">
//Imports
import OctokitRest from "@octokit/rest"
import yargsparser from "yargs-parser"
import { IndepthAnalyzer } from "./indepth.mjs"
import { RecentAnalyzer } from "./recent.mjs"

const help = `

`.trim()

/**Cli */
export async function cli() {
  //Parse inputs
  console.log("== metrics indepth analyzer cli ====================")
  const argv = yargsparser(process.argv.slice(2))
  if (argv.help) {
    console.log(help)
    return null
  }
  const {default: setup} = await import("../../../app/metrics/setup.mjs")
  const {conf: {metadata}} = await setup({log: false})
  const {login, _: repositories, mode = "indepth"} = argv
  const {
    "commits.authoring": authoring,
  } = await metadata.plugins.base.inputs({
    q: {
      "commits.authoring": argv["commits-authoring"] || login,
    },
    account: "bypass",
  })
  const {
    categories,
    "analysis.timeout": _timeout_global,
    "analysis.timeout.repositories": _timeout_repositories,
    "recent.load": _recent_load,
    "recent.days": _recent_days,
  } = await metadata.plugins.languages.inputs({
    q: {
      categories: argv.categories || "",
      "analysis.timeout": argv["timeout-global"] || "",
      "analysis.timeout.repositories": argv["timeout-repositories"] || "",
      "recent.load": argv["recent-load"] || "",
      "recent.days": argv["recent-days"] || "",
    },
    account: "bypass",
  })

  //Prepare call
  const imports = await import("../../../app/metrics/utils.mjs")
  const rest = argv.token ? new OctokitRest.Octokit({auth: argv.token, baseUrl: argv["api-url"]}) : null

  //Language analysis
  console.log(`analysis mode             | ${mode}`)
  console.log(`login                     | ${login}`)
  console.log(`rest token                | ${rest ? "(provided)" : "(none)"}`)
  console.log(`commits authoring         | ${authoring}`)
  console.log(`analysis timeout (global) | ${_timeout_global}`)
  switch (mode) {
    case "recent": {
      console.log(`events to load            | ${_recent_load}`)
      console.log(`events maximum age        | ${_recent_days}`)
      return new RecentAnalyzer(login, {rest, shell: imports, authoring, categories, timeout: {global: _timeout_global, repositories: _timeout_repositories}, load: _recent_load, days: _recent_days}).run({})
    }
    case "indepth": {
      console.log(`repositories              | ${repositories}`)
      return new IndepthAnalyzer(login, {rest, shell: imports, authoring, categories, timeout: {global: _timeout_global, repositories: _timeout_repositories}}).run({repositories})
    }
  }
}
</file>

<file path="source/plugins/languages/analyzer/indepth.mjs">
//Imports
import fs from "fs/promises"
import linguist from "linguist-js"
import os from "os"
import paths from "path"
import { Analyzer } from "./analyzer.mjs"

/**Indepth analyzer */
export class IndepthAnalyzer extends Analyzer {
  /**Constructor */
  constructor() {
    super(...arguments)
    this.manual = {repositories: []}
    Object.assign(this.results, {verified: {signature: 0}})
  }

  /**Run analyzer */
  run({repositories}) {
    this.manual.repositories = repositories.filter(repo => typeof repo === "string")
    return super.run(async () => {
      await this.gpgarmor()
      for (const repository of repositories) {
        if (this.results.partial.global)
          break
        if (this.ignore(repository))
          continue
        if (await this.clone(repository)) {
          const {path, ref} = this.parse(repository)
          await this.analyze(path, {ref})
          await this.clean(path)
        }
      }
    })
  }

  /**Whether to skip a repository or not (bypass filter if repository was manually specified)*/
  ignore(repository) {
    if (this.manual.repositories.includes(repository)) {
      this.debug(`${repository} has been specified manually, not skipping`)
      return false
    }
    return super.ignore(repository)
  }

  /**Populate gpg keys */
  async gpgarmor() {
    //Fetch gpg keys (web-flow is GitHub's public key when making changes from web ui)
    try {
      this.debug("fetching gpg keys")
      for (const username of [this.login, "web-flow"]) {
        const {data: keys} = await this.rest.users.listGpgKeysForUser({username})
        this.gpg.push(...keys.map(({key_id: id, raw_key: pub, emails}) => ({id, pub, emails})))
        if (username === this.login) {
          for (const {email} of this.gpg.flatMap(({emails}) => emails)) {
            this.debug(`auto-adding ${email} to commits_authoring (fetched from gpg)`)
            this.authoring.push(email)
          }
        }
      }
      this.debug(`fetched ${this.gpg.length} gpg keys`)
    }
    catch (error) {
      this.debug(`an error occurred while fetching gpg keys (${error})`)
    }

    //Import gpg keys
    for (const {id, pub} of this.gpg) {
      const path = paths.join(os.tmpdir(), `${this.uid}.${id}.gpg`)
      try {
        this.debug(`saving gpg ${id} to ${path}`)
        await fs.writeFile(path, pub)
        await this.shell.run(`gpg ${path}`)
        if (process.env.GITHUB_ACTIONS) {
          this.debug(`importing gpg ${id}`)
          await this.shell.run(`gpg --import ${path}`)
        }
        else {
          this.debug("skipping import of gpg keys as we are not in GitHub Actions environment")
        }
      }
      catch (error) {
        this.debug(`an error occurred while importing gpg ${id}, skipping...`)
      }
      finally {
        this.debug(`cleaning ${path}`)
        await fs.rm(path, {recursive: true, force: true}).catch(error => this.debug(`failed to clean ${path} (${error})`))
      }
    }
  }

  /**Filter related commits in repository */
  async filter(path, {ref}) {
    const commits = new Set()
    try {
      this.debug(`filtering commits authored by ${this.login} in ${path}`)
      for (const author of this.authoring) {
        //Search by --author
        {
          const output = await this.shell.run(`git log --author='${author}' --pretty=format:"%H" --regexp-ignore-case --no-merges`, {cwd: path, env: {LANG: "en_GB"}}, {log: false, debug: false, prefixed: false})
          const hashes = output.split("\n").map(line => line.trim()).filter(line => this.markers.hash.test(line))
          hashes.forEach(hash => commits.add(hash))
          this.debug(`found ${hashes.length} for ${author} (using --author)`)
        }
        //Search by --grep
        {
          const output = await this.shell.run(`git log --grep='${author}' --pretty=format:"%H"  --regexp-ignore-case --no-merges`, {cwd: path, env: {LANG: "en_GB"}}, {log: false, debug: false, prefixed: false})
          const hashes = output.split("\n").map(line => line.trim()).filter(line => this.markers.hash.test(line))
          hashes.forEach(hash => commits.add(hash))
          this.debug(`found ${hashes.length} for ${author} (using --grep)`)
        }
      }
      //Apply ref range if specified
      if (ref) {
        this.debug(`filtering commits referenced by ${ref} in ${path}`)
        const output = await this.shell.run(`git rev-list --boundary ${ref}`, {cwd: path, env: {LANG: "en_GB"}}, {log: false, debug: false, prefixed: false})
        const hashes = output.split("\n").map(line => line.trim()).filter(line => this.markers.hash.test(line))
        commits.forEach(commit => !hashes.includes(commit) ? commits.delete(commit) : null)
      }
      this.debug(`found ${commits.size} unique commits authored by ${this.login} in ${path}`)
    }
    catch (error) {
      this.debug(`an error occurred during filtering of commits authored by ${this.login} in ${path} (${error})`)
    }
    return [...commits]
  }

  /**Filter commits in repository */
  async commits(path, {ref}) {
    const shas = await this.filter(path, {ref})
    const commits = []
    for (const sha of shas) {
      try {
        commits.push({
          sha,
          name: await this.shell.run(`git log ${sha} --format="%s (authored by %an on %cI)" --max-count=1`, {cwd: path, env: {LANG: "en_GB"}}, {log: false, debug: false, prefixed: false}),
          verified: ("verified" in this.results) ? await this.shell.run(`git verify-commit ${sha}`, {cwd: path, env: {LANG: "en_GB"}}, {log: false, debug: false, prefixed: false}).then(() => true).catch(() => null) : null,
          editions: await this.editions(path, {sha}),
        })
      }
      catch (error) {
        this.debug(`skipping commit ${sha} (${error})`)
      }
    }
    return commits
  }

  /**Fetch commit patch and format it by files*/
  async editions(path, {sha}) {
    const editions = []
    let edition = null
    let cursor = 0
    await this.shell.spawn("git", ["log", sha, "--format=''", "--max-count=1", "--patch"], {cwd: path, env: {LANG: "en_GB"}}, {
      debug: false,
      stdout: line => {
        try {
          //Ignore empty lines or unneeded lines
          cursor++
          if ((!/^[-+]/.test(line)) || (!line.trim().length))
            return

          //File marker
          if (this.markers.file.test(line)) {
            edition = {
              path: `${path}/${line.match(this.markers.file)?.groups?.file}`.replace(/\\/g, "/"),
              added: {lines: 0, bytes: 0},
              deleted: {lines: 0, bytes: 0},
            }
            editions.push(edition)
            return
          }

          //Line markers
          if ((edition) && (this.markers.line.test(line))) {
            const {op = "+", content = ""} = line.match(this.markers.line)?.groups ?? {}
            const size = Buffer.byteLength(content, "utf-8")
            edition[{"+": "added", "-": "deleted"}[op]].bytes += size
            edition[{"+": "added", "-": "deleted"}[op]].lines++
            return
          }
        }
        catch (error) {
          this.debug(`skipping line ${sha}#${cursor} (${error})`)
        }
      },
    })
    return editions
  }

  /**Analyze a repository */
  async analyze(path, {ref} = {}) {
    const commits = await this.commits(path, {ref})
    return super.analyze(path, {commits})
  }

  /**Run linguist against a commit and compute edited lines and bytes*/
  async linguist(path, {commit, cache}) {
    const result = {total: 0, files: 0, missed: {lines: 0, bytes: 0}, lines: {}, stats: {}}
    const edited = new Set()
    const seen = new Set()
    for (const edition of commit.editions) {
      edited.add(edition.path)

      //Guess file language with linguist (only run it once per sha)
      if ((!(edition.path in cache.files)) && (!seen.has(commit.sha))) {
        this.debug(`language for file ${edition.path} is not in cache, running linguist at ${commit.sha}`)
        await this.shell.run(`git checkout ${commit.sha}`, {cwd: path, env: {LANG: "en_GB"}}, {log: false, debug: false, prefixed: false})
        const {files: {results: files}, languages: {results: languages}} = await linguist(path)
        Object.assign(cache.files, files)
        Object.assign(cache.languages, languages)
        seen.add(commit.sha)
      }
      if (!(edition.path in cache.files))
        cache.files[edition.path] = "<unknown>"

      //Aggregate statistics
      const language = cache.files[edition.path]
      edition.language = language
      result.total += edition.added.bytes
      if (language === "<unknown>") {
        result.missed.lines += edition.added.lines
        result.missed.bytes += edition.added.bytes
      }
      else {
        result.lines[language] = (result.lines[language] ?? 0) + edition.added.lines
        result.stats[language] = (result.stats[language] ?? 0) + edition.added.bytes
      }
    }
    result.files = edited.size
    return result
  }
}
</file>

<file path="source/plugins/languages/analyzer/recent.mjs">
//Imports
import linguist from "linguist-js"
import { filters } from "../../../app/metrics/utils.mjs"
import { Analyzer } from "./analyzer.mjs"

/**Recent analyzer */
export class RecentAnalyzer extends Analyzer {
  /**Constructor */
  constructor() {
    super(...arguments)
    this.days = arguments[1]?.days ?? 0
    this.load = arguments[1]?.load ?? 0
    Object.assign(this.results, {days: this.days})
  }

  /**Run analyzer */
  run() {
    return super.run(async () => {
      await this.analyze("/dev/null")
    })
  }

  /**Analyze a repository */
  async analyze(path) {
    const patches = await this.patches()
    return super.analyze(path, {commits: patches})
  }

  /**Fetch patches */
  async patches() {
    //Fetch commits from recent activity
    this.debug(`fetching patches from last ${this.days || ""} days up to ${this.load || "‚àû"} events`)
    const commits = [], pages = Math.ceil((this.load || Infinity) / 100)
    if (this.context.mode === "repository") {
      try {
        const {data: {default_branch: branch}} = await this.rest.repos.get(this.context)
        this.context.branch = branch
        this.results.branch = branch
        this.debug(`default branch for ${this.context.owner}/${this.context.repo} is ${branch}`)
      }
      catch (error) {
        this.debug(`failed to get default branch for ${this.context.owner}/${this.context.repo} (${error})`)
      }
    }
    try {
      for (let page = 1; page <= pages; page++) {
        this.debug(`fetching events page ${page}`)
        commits.push(
          ...(await (this.context.mode === "repository" ? this.rest.activity.listRepoEvents(this.context) : this.rest.activity.listEventsForAuthenticatedUser({username: this.login, per_page: 100, page}))).data
            .filter(({type, payload}) => (type === "PushEvent") && ((this.context.mode !== "repository") || ((this.context.mode === "repository") && (payload?.ref?.includes?.(`refs/heads/${this.context.branch}`)))))
            .filter(({actor}) => (this.account === "organization") || (this.context.mode === "repository") ? true : !filters.text(actor.login, [this.login], {debug: false}))
            .filter(({repo: {name: repo}}) => !this.ignore(repo))
            .filter(({created_at}) => ((!this.days) || (new Date(created_at) > new Date(Date.now() - this.days * 24 * 60 * 60 * 1000)))),
        )
      }
    }
    catch {
      this.debug("no more page to load")
    }
    this.debug(`fetched ${commits.length} commits`)
    this.results.latest = Math.round((new Date().getTime() - new Date(commits.slice(-1).shift()?.created_at).getTime()) / (1000 * 60 * 60 * 24))
    this.results.commits = commits.length

    //Retrieve edited files and filter edited lines (those starting with +/-) from patches
    this.debug("fetching patches")
    const patches = [
      ...await Promise.allSettled(
        commits
          .flatMap(({payload}) => payload.commits)
          .filter(({committer}) => filters.text(committer?.email, this.authoring, {debug: false}))
          .map(commit => commit.url)
          .map(async commit => (await this.rest.request(commit)).data),
      ),
    ]
      .filter(({status}) => status === "fulfilled")
      .map(({value}) => value)
      .filter(({parents}) => parents.length <= 1)
      .map(({sha, commit: {message, committer}, verification, files}) => ({
        sha,
        name: `${message} (authored by ${committer.name} on ${committer.date})`,
        verified: verification?.verified ?? null,
        editions: files.map(({filename, patch = ""}) => {
          const edition = {
            path: filename,
            added: {lines: 0, bytes: 0},
            deleted: {lines: 0, bytes: 0},
            patch,
          }
          for (const line of patch.split("\n")) {
            if ((!/^[-+]/.test(line)) || (!line.trim().length))
              continue
            if (this.markers.line.test(line)) {
              const {op = "+", content = ""} = line.match(this.markers.line)?.groups ?? {}
              const size = Buffer.byteLength(content, "utf-8")
              edition[{"+": "added", "-": "deleted"}[op]].bytes += size
              edition[{"+": "added", "-": "deleted"}[op]].lines++
              continue
            }
          }
          return edition
        }),
      }))
    return patches
  }

  /**Run linguist against a commit and compute edited lines and bytes*/
  async linguist(_, {commit, cache: {languages}}) {
    const cache = {files: {}, languages}
    const result = {total: 0, files: 0, missed: {lines: 0, bytes: 0}, lines: {}, stats: {}, languages: {}}
    const edited = new Set()
    for (const edition of commit.editions) {
      edited.add(edition.path)

      //Guess file language with linguist
      const {files: {results: files}, languages: {results: languages}, unknown} = await linguist(edition.path, {fileContent: edition.patch})
      Object.assign(cache.files, files)
      Object.assign(cache.languages, languages)
      if (!(edition.path in cache.files))
        cache.files[edition.path] = "<unknown>"

      //Aggregate statistics
      const language = cache.files[edition.path]
      edition.language = language
      const numbers = edition.patch
        .split("\n")
        .filter(line => this.markers.line.test(line))
        .map(line => Buffer.byteLength(line.substring(1).trimStart(), "utf-8"))
      const added = numbers.reduce((a, b) => a + b, 0)
      result.total += added
      if (language === "<unknown>") {
        result.missed.lines += numbers.length
        result.missed.bytes += unknown.bytes
      }
      else {
        result.lines[language] = (result.lines[language] ?? 0) + numbers.length
        result.stats[language] = (result.stats[language] ?? 0) + added
      }
    }
    result.files = edited.size
    result.languages = cache.languages
    return result
  }
}
</file>

<file path="source/plugins/languages/analyzers.mjs">
//Imports
import { cli } from "./analyzer/cli.mjs"
import { IndepthAnalyzer } from "./analyzer/indepth.mjs"
import { RecentAnalyzer } from "./analyzer/recent.mjs"

/**Indepth analyzer */
export async function indepth({login, data, imports, rest, context, repositories}, {skipped, categories, timeout}) {
  return new IndepthAnalyzer(login, {shell: imports, uid: data.user.databaseId, skipped, authoring: data.shared["commits.authoring"], timeout, rest, context, categories}).run({repositories})
}

/**Recent languages activity */
export async function recent({login, data, imports, rest, context, account}, {skipped = [], categories, days = 0, load = 0, timeout}) {
  return new RecentAnalyzer(login, {shell: imports, uid: data.user.databaseId, skipped, authoring: data.shared["commits.authoring"], timeout, account, rest, context, days, categories, load}).run()
}

//import.meta.main
if (/languages.analyzers.mjs$/.test(process.argv[1])) {
  ;(async () => {
    console.log(await cli())
    process.exit(0)
  })()
}
</file>

<file path="source/plugins/languages/colorsets.json">
{
  "rainbow":["0:#ff0000", "1:#ffa500", "2:#ffff00", "3:#008000", "4:#0000ff", "5:#4b0082", "6:#ee82ee", "7:#162221"],
  "complementary":["0:#ff0000", "1:#008000", "2:#ffa500", "3:#0000ff", "4:#ffff00", "5:#4b0082", "6:#162221", "7:#ee82ee"]
}
</file>

<file path="source/plugins/languages/examples.yml">
- name: Most used
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.languages.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_languages: yes
    plugin_languages_ignored: html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell, gnuplot
    plugin_languages_limit: 4

- name: Most used (with details)
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.languages.details.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_languages: yes
    plugin_languages_ignored: html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell, gnuplot
    plugin_languages_details: bytes-size, percentage
    plugin_languages_limit: 4

- name: Recently used
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.languages.recent.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_languages: yes
    plugin_languages_ignored: html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell, gnuplot
    plugin_languages_sections: recently-used
    plugin_languages_details: bytes-size, percentage
    plugin_languages_limit: 4

- name: Indepth analysis
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.languages.indepth.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_languages: yes
    plugin_languages_ignored: html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell, gnuplot
    plugin_languages_indepth: yes
    plugin_languages_details: lines, bytes-size
    plugin_languages_limit: 4
    plugin_languages_analysis_timeout: 15
  test:
    skip: true
</file>

<file path="source/plugins/languages/metadata.yml">
name: üà∑Ô∏è Languages activity
category: github
description: |
  This plugin can display which languages you use across all repositories you contributed to.
examples:
  +indepth analysis (clone and analyze repositories): https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.languages.indepth.svg
  +recently used (analyze recent activity events): https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.languages.recent.svg
  default algorithm: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.languages.svg
  default algorithm (with details): https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.languages.details.svg
index: 1
supports:
  - user
  - organization
  - repository
scopes:
  - public_access
inputs:

  plugin_languages:
    description: |
      Enable languages plugin
    type: boolean
    default: no

  plugin_languages_ignored:
    description: |
      Ignored languages
    type: array
    format: comma-separated
    default: ""
    example: html, css, ...

  plugin_languages_skipped:
    description: |
      Skipped repositories
    type: array
    format: 
      - newline-separated
      - comma-separated
    default: ""
    example: my-repo-1, my-repo-2, owner/repo-3, ...
    inherits: repositories_skipped

  plugin_languages_limit:
    description: |
      Display limit
    type: number
    default: 8
    min: 0
    max: 8
    zero: disable

  plugin_languages_threshold:
    description: |
      Display threshold (percentage)
    type: string
    default: 0%

  plugin_languages_other:
    description: |
      Group unknown, ignored and over-limit languages into "Other" category

      If this option is enabled, "Other" category will not be subject to [`plugin_languages_threshold`](/source/plugins/languages/README.md#plugin_languages_threshold).
      It will be automatically hidden if empty.
    type: boolean
    default: no

  plugin_languages_colors:
    description: |
      Custom languages colors
    type: array
    format: comma-separated
    default: github
    example: javascript:red, 0:blue, 1:#ff00aa

  plugin_languages_aliases:
    description: |
      Custom languages names
    type: string
    default: ""
    example: javascript:JS, typescript:TS

  plugin_languages_sections:
    description: |
      Displayed sections

      Note that `recently-used` is only available when [`plugin_languages_indepth`](/source/plugins/languages/README.md#plugin_languages_indepth) is enabled
    type: array
    format: comma-separated
    default: most-used
    example: most-used, recently-used
    values:
      - most-used
      - recently-used

  plugin_languages_details:
    description: |
      Additional details

      Note that `lines` is only available when [`plugin_languages_indepth`](/source/plugins/languages/README.md#plugin_languages_indepth) is enabled
    type: array
    format: comma-separated
    values:
      - bytes-size
      - percentage
      - lines
    default: ""
    example: bytes-size, percentage

  plugin_languages_indepth:
    description: |
      Indepth mode

      > ‚ö†Ô∏è read documentation first
    type: boolean
    default: false
    extras:
      - metrics.cpu.overuse
      - metrics.run.tempdir
      - metrics.run.git

  plugin_languages_indepth_custom:
    description: |
      Indepth mode - Custom repositories

      Specify a list of additional repositories to analyze.

      Below are the supported syntax formats:
      - `owner/repo` (e.g. `lowlighter/metrics`)
      - `owner/repo@branch` (e.g. `lowlighter/metrics@main`)
      - `owner/repo@branch:commits` (e.g. `lowlighter/metrics@main:v1.0..v1.1`)
        - See [`git rev-list`](https://git-scm.com/docs/git-rev-list#_description) documentation for more information about `commits` syntax

      It is possible to specify repositories that are not hosted on [github.com](https://github.com) by passing a full url instead.
      In this case the repository must be accessible directly.

      > ‚ÑπÔ∏è This option bypass [`plugin_languages_skipped`](/source/plugins/languages/README.md#plugin_languages_skipped)
    type: array
    format: comma-separated
    default: ""
    example: lowlighter/metrics, lowlighter/metrics@main, lowlighter/metrics@latest:v1.0..v1.1

  plugin_languages_analysis_timeout:
    description: |
      Indepth mode - Analysis timeout
    type: number
    default: 15
    min: 1
    max: 60

  plugin_languages_analysis_timeout_repositories:
    description: |
       Indepth mode - Analysis timeout (repositories)
    type: number
    default: 7.5
    min: 0
    max: 15
    zero: disable

  plugin_languages_categories:
    description: |
      Indepth mode - Displayed categories (most-used section)
    type: array
    format: comma-separated
    values:
      - data
      - markup
      - programming
      - prose
    default: markup, programming

  plugin_languages_recent_categories:
    description: |
      Indepth mode - Displayed categories (recently-used section)
    type: array
    format: comma-separated
    values:
      - data
      - markup
      - programming
      - prose
    default: markup, programming

  plugin_languages_recent_load:
    description: |
      Indepth mode - Events to load (recently-used section)
    type: number
    default: 300
    min: 100
    max: 1000

  plugin_languages_recent_days:
    description: |
      Indepth mode - Events maximum age (day, recently-used section)
    type: number
    default: 14
    min: 0
    max: 365
    zero: disable
</file>

<file path="source/plugins/leetcode/queries/languages.graphql">
query Languages ($username: String!) {
  matchedUser(username: $username) {
    languageProblemCount {
      languageName
      problemsSolved
    }
  }
}
</file>

<file path="source/plugins/leetcode/queries/problems.graphql">
query Problems ($username: String!) {
  allQuestionsCount {
    difficulty
    count
  }
  matchedUser(username: $username) {
    problemsSolvedBeatsStats {
      difficulty
      percentage
    }
    submitStatsGlobal {
      acSubmissionNum {
        difficulty
        count
      }
    }
  }
}
</file>

<file path="source/plugins/leetcode/queries/recent.graphql">
query Recent ($username: String!, $limit: Int!) {
  recentAcSubmissionList(username: $username, limit: $limit) {
    id
    title
    titleSlug
    timestamp
  }
}
</file>

<file path="source/plugins/leetcode/queries/skills.graphql">
query Skills ($username: String!) {
  matchedUser(username: $username) {
    tagProblemCounts {
      advanced {
        tagName
        problemsSolved
      }
      intermediate {
        tagName
        problemsSolved
      }
      fundamental {
        tagName
        problemsSolved
      }
    }
  }
}
</file>

<file path="source/plugins/leetcode/examples.yml">
- name: LeetCode
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.leetcode.svg
    token: NOT_NEEDED
    base: ""
    plugin_leetcode: yes
    plugin_leetcode_sections: solved, skills, recent
</file>

<file path="source/plugins/leetcode/index.mjs">
//Setup
export default async function({login, q, imports, data, queries, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.leetcode) || (!imports.metadata.plugins.leetcode.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {user, sections, "limit.skills": _limit_skills, "ignored.skills": _ignored_skills, "limit.recent": _limit_recent} = imports.metadata.plugins.leetcode.inputs({data, account, q})
    const result = {user, sections, languages: [], skills: [], problems: {}, recent: []}

    //Languages stats
    {
      console.debug(`metrics/compute/${login}/plugins > leetcode > querying api (languages statistics)`)
      const {data: {data: {matchedUser: {languageProblemCount: languages}}}} = await imports.axios.post("https://leetcode.com/graphql", {variables: {username: user}, query: queries.leetcode.languages()})
      result.languages = languages.map(({languageName: language, problemsSolved: solved}) => ({language, solved}))
    }

    //Skills stats
    {
      console.debug(`metrics/compute/${login}/plugins > leetcode > querying api (skills statistics)`)
      const {data: {data: {matchedUser: {tagProblemCounts: skills}}}} = await imports.axios.post("https://leetcode.com/graphql", {variables: {username: user}, query: queries.leetcode.skills()})
      for (const category in skills)
        result.skills.push(...skills[category].map(({tagName: name, problemsSolved: solved}) => ({name, solved, category})))
      result.skills.sort((a, b) => b.solved - a.solved)
      result.skills = result.skills.filter(({name, category}) => (imports.filters.text(name, _ignored_skills)) && (imports.filters.text(category, _ignored_skills)))
      result.skills = result.skills.slice(0, _limit_skills || Infinity)
    }

    //Problems
    {
      console.debug(`metrics/compute/${login}/plugins > leetcode > querying api (problems statistics)`)
      const {data: {data: {allQuestionsCount: all, matchedUser: {submitStatsGlobal: {acSubmissionNum: submissions}}}}} = await imports.axios.post("https://leetcode.com/graphql", {variables: {username: user}, query: queries.leetcode.problems()})
      for (const {difficulty, count} of all)
        result.problems[difficulty] = {count, solved: 0}
      for (const {difficulty, count: solved} of submissions)
        result.problems[difficulty].solved = solved
    }

    //Recent submissions
    {
      console.debug(`metrics/compute/${login}/plugins > leetcode > querying api (recent submissions statistics)`)
      const {data: {data: {recentAcSubmissionList: submissions}}} = await imports.axios.post("https://leetcode.com/graphql", {variables: {username: user, limit: _limit_recent}, query: queries.leetcode.recent()})
      result.recent = submissions.map(({title, timestamp}) => ({title, date: new Date(timestamp * 1000)}))
    }

    //Results
    return result
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/leetcode/metadata.yml">
name: üó≥Ô∏è Leetcode
category: social
description: |
  This plugin displays statistics from a [LeetCode](https://leetcode.com) account.
disclaimer: |
  This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with [LeetCode](https://leetcode.com).
  All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.leetcode.svg
index: 9
supports:
  - user
scopes: []
inputs:

  plugin_leetcode:
    description: |
      Enable leetcode plugin
    type: boolean
    default: no

  plugin_leetcode_user:
    type: string
    description: |
      LeetCode login
    default: .user.login
    preset: no

  plugin_leetcode_sections:
    description: |
      Displayed sections

      - `solved` will display solved problems scores
      - `skills` will display solved problems tagged skills
      - `recent` will display recent submissions
    type: array
    format: comma-separated
    default: solved
    example: solved, skills, recent
    values:
      - solved
      - skills
      - recent

  plugin_leetcode_limit_skills:
    description: |
      Display limit (skills)
    type: number
    default: 10
    min: 0
    zero: disable

  plugin_leetcode_ignored_skills:
    description: |
      Ignored skills

      It is possible to ignore entires categories by passing `fundamental`, `intermediate` or `advanced`
    type: array
    default: ""
    example: hash table, string, divide and conquer, fundamental

  plugin_leetcode_limit_recent:
    description: |
      Display limit (recent)
    type: number
    default: 2
    min: 1
    max: 15
</file>

<file path="source/plugins/licenses/queries/licenses.graphql">
query LicensesDefault {
  licenses {
    spdxId
    name
    nickname
    key
    limitations {
      key
      label
    }
    conditions {
      key
      label
    }
    permissions {
      key
      label
    }
  }
}
</file>

<file path="source/plugins/licenses/queries/repository.graphql">
query LicensesRepository {
  $account(login: "$owner") {
    repository(name: "$name") {
      licenseInfo {
        spdxId
        name
        nickname
        key
      }
      url
      databaseId
    }
  }
}
</file>

<file path="source/plugins/licenses/examples.yml">
- name: Licenses and permissions
  with:
    filename: metrics.plugin.licenses.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    template: repository
    repo: metrics
    plugin_licenses: yes
    plugin_licenses_setup: "bash -c '[[ -f package.json ]] && npm ci || true'"
  test:
    timeout: 1800000
    modes:
      - action

- name: Licenses with open-source ratio graphs
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.licenses.ratio.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    template: repository
    repo: metrics
    plugin_licenses: yes
    plugin_licenses_setup: "bash -c '[[ -f package.json ]] && npm ci || true'"
    plugin_licenses_legal: no
    plugin_licenses_ratio: yes
  test:
    skip: true
</file>

<file path="source/plugins/licenses/index.mjs">
//Setup
export default async function({login, q, imports, data, graphql, queries, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.licenses) || (!imports.metadata.plugins.licenses.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {setup, ratio, legal} = imports.metadata.plugins.licenses.inputs({data, account, q})

    //Initialization
    const {user: {repository}} = await graphql(queries.licenses.repository({owner: data.repo.owner.login, name: data.repo.name, account}))
    const result = {ratio, legal, default: repository.licenseInfo, licensed: {available: false}, text: {}, list: [], used: {}, dependencies: [], known: 0, unknown: 0}
    const {used, text} = result

    //Register existing licenses properties
    const licenses = Object.fromEntries((await graphql(queries.licenses())).licenses.map(license => [license.key, license]))
    for (const license of Object.values(licenses)) {
      //dprint-ignore
      [...license.limitations, ...license.conditions, ...license.permissions].flat().map(({key, label}) => text[key] = label)
    }
    colors(licenses)

    //Check if licensed exists
    if (await imports.which("licensed")) {
      //Setup for licensed
      console.debug(`metrics/compute/${login}/plugins > licenses > searching dependencies licenses using licensed`)
      const path = imports.paths.join(imports.os.tmpdir(), `${repository.databaseId}`)
      //Create temporary directory
      console.debug(`metrics/compute/${login}/plugins > licenses > creating temp dir ${path}`)
      await imports.fs.rm(path, {recursive: true, force: true})
      await imports.fs.mkdir(path, {recursive: true})
      //Clone repository
      console.debug(`metrics/compute/${login}/plugins > licenses > cloning temp git repository ${repository.url} to ${path}`)
      const git = imports.git(path)
      await git.clone(repository.url, path)
      //Run setup
      if (setup) {
        console.debug(`metrics/compute/${login}/plugins > licenses > running setup [${setup}]`)
        await imports.run(setup, {cwd: path}, {prefixed: false})
      }
      //Create configuration file if needed
      if (!(await imports.fs.stat(imports.paths.join(path, ".licensed.yml")).then(() => 1).catch(() => 0))) {
        console.debug(`metrics/compute/${login}/plugins > licenses > building .licensed.yml configuration file`)
        await imports.fs.writeFile(
          imports.paths.join(path, ".licensed.yml"),
          [
            "cache_path: .licensed",
          ].join("\n"),
        )
      }
      else {
        console.debug(`metrics/compute/${login}/plugins > licenses > a .licensed.yml configuration file already exists`)
      }

      //Spawn licensed process
      console.debug(`metrics/compute/${login}/plugins > licenses > running licensed`)
      JSON.parse(await imports.run("licensed list --format=json --licenses", {cwd: path})).apps
        .map(({sources}) =>
          sources?.flatMap(source =>
            source.dependencies?.map(({dependency, license}) => {
              used[license] = (used[license] ?? 0) + 1
              result.dependencies.push(dependency)
              result.known += license in licenses
              result.unknown += !(license in licenses)
            })
          )
        )
      //Cleaning
      console.debug(`metrics/compute/${login}/plugins > licensed > cleaning temp dir ${path}`)
      await imports.fs.rm(path, {recursive: true, force: true})
    }
    else {
      console.debug(`metrics/compute/${login}/plugins > licenses > licensed not available`)
    }

    //List licenses properties
    console.debug(`metrics/compute/${login}/plugins > licenses > compute licenses properties`)
    const base = {permissions: new Set(), limitations: new Set(), conditions: new Set()}
    const combined = {permissions: new Set(), limitations: new Set(), conditions: new Set()}
    const detected = Object.entries(used).map(([key, _value]) => ({key}))
    for (const properties of Object.keys(base)) {
      //Base license
      if (repository.licenseInfo)
        licenses[repository.licenseInfo.key]?.[properties]?.map(({key}) => base[properties].add(key))
      //Combined licenses
      for (const {key} of detected)
        licenses[key]?.[properties]?.map(({key}) => combined[properties].add(key))
    }

    //Merge limitations and conditions
    for (const properties of ["limitations", "conditions"])
      result[properties] = [[...base[properties]].map(key => ({key, text: text[key], inherited: false})), [...combined[properties]].filter(key => !base[properties].has(key)).map(key => ({key, text: text[key], inherited: true}))].flat()
    //Remove base permissions conflicting with inherited limitations
    result.permissions = [...base.permissions].filter(key => !combined.limitations.has(key)).map(key => ({key, text: text[key]}))

    //Count used licenses
    console.debug(`metrics/compute/${login}/plugins > licenses > computing ratio`)
    const total = Object.values(used).reduce((a, b) => a + b, 0)
    //Format used licenses and compute positions
    const list = Object.entries(used).map(([key, count]) => ({name: licenses[key]?.spdxId ?? `${key.charAt(0).toLocaleUpperCase()}${key.substring(1)}`, key, count, value: count / total, x: 0, color: licenses[key]?.color ?? "#6e7681", order: licenses[key]?.order ?? -1})).sort((
      a,
      b,
    ) => a.order === b.order ? b.count - a.count : b.order - a.order)
    for (let i = 0; i < list.length; i++)
      list[i].x = (list[i - 1]?.x ?? 0) + (list[i - 1]?.value ?? 0)
    //Save ratios
    result.list = list

    //Results
    return result
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}

/**Licenses colorizer (based on category) */
function colors(licenses) {
  for (const [license, value] of Object.entries(licenses)) {
    const [permissions, conditions] = [value.permissions, value.conditions].map(properties => properties.map(({key}) => key))
    switch (true) {
      //Other licenses
      case (license === "other"): {
        value.color = "#8b949e"
        value.order = 0
        break
      }
      //Strongly protective licenses and network protective
      case ((conditions.includes("disclose-source")) && (conditions.includes("same-license")) && (conditions.includes("network-use-disclose"))): {
        value.color = "#388bfd"
        value.order = 1
        break
      }
      //Strongly protective licenses
      case ((conditions.includes("disclose-source")) && (conditions.includes("same-license"))): {
        value.color = "#79c0ff"
        value.order = 2
        break
      }
      //Weakly protective licenses
      case ((conditions.includes("disclose-source")) && (conditions.includes("same-license--library"))): {
        value.color = "#7ee787"
        value.order = 3
        break
      }
      //Permissive license
      case ((permissions.includes("private-use")) && (permissions.includes("commercial-use")) && (permissions.includes("modifications")) && (permissions.includes("distribution"))): {
        value.color = "#56d364"
        value.order = 4
        break
      }
      //Unknown
      default: {
        value.color = "#6e7681"
        value.order = -1
      }
    }
  }
}
</file>

<file path="source/plugins/licenses/metadata.yml">
name: üìú Repository licenses
category: github
description: |
  This plugin display repository license informations like permissions, limitations and conditions along with additional stats about dependencies.
notes: |
  > ‚ö†Ô∏è This is **NOT** legal advice, use at your own risk

  > üí£ This plugin **SHOULD NOT** be enabled on web instances, since it allows raw command injection.
  > This could result in compromised server!
examples:
  +permissions, limitations and conditions: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.licenses.svg
  +licenses overview: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.licenses.ratio.svg
index: 6
supports:
  - repository
scopes:
  - public_access
inputs:

  plugin_licenses:
    description: |
      Enable licenses plugin
    type: boolean
    default: no
    extras:
      - metrics.cpu.overuse
      - metrics.run.tempdir
      - metrics.run.git
      - metrics.run.licensed
      - metrics.run.user.cmd

  plugin_licenses_setup:
    description: |
      Setup command

      > ‚ÑπÔ∏è Depending on the project, this may not be required.
      > The example command is intended for NodeJs projects that use `npm` to install their dependencies.
    type: string
    default: ""
    example: "bash -c '[[ -f package.json ]] && npm ci || true'"

  plugin_licenses_ratio:
    description: |
      Used licenses ratio
    type: boolean
    default: no

  plugin_licenses_legal:
    description: |
      Permissions, limitations and conditions about used licenses
    type: boolean
    default: yes
</file>

<file path="source/plugins/music/examples.yml">
- name: Apple Music - Random track from playlist
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.music.playlist.svg
    token: NOT_NEEDED
    base: ""
    plugin_music: yes
    plugin_music_playlist: https://embed.music.apple.com/fr/playlist/usr-share/pl.u-V9D7m8Etjmjd0D
    plugin_music_limit: 2

- name: Spotify - Random track from playlist
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.music.playlist.spotify.svg
    token: NOT_NEEDED
    base: ""
    plugin_music: yes
    plugin_music_playlist: https://open.spotify.com/embed/playlist/3nfA87oeJw4LFVcUDjRcqi

- name: Spotify - Recently listed
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.music.recent.svg
    token: NOT_NEEDED
    base: ""
    plugin_music: yes
    plugin_music_provider: spotify
    plugin_music_mode: recent
    plugin_music_token: ${{ secrets.SPOTIFY_TOKENS }}
    plugin_music_limit: 2

- name: Spotify - Top tracks
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    base: ""
    plugin_music: yes
    plugin_music_mode: top
    plugin_music_provider: spotify
    plugin_music_token: ${{ secrets.SPOTIFY_TOKENS }}
    plugin_music_time_range: short
    plugin_music_top_type: tracks

- name: Spotify - Top artists
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    base: ""
    plugin_music: yes
    plugin_music_mode: top
    plugin_music_provider: spotify
    plugin_music_token: ${{ secrets.SPOTIFY_TOKENS }}
    plugin_music_time_range: long
    plugin_music_top_type: artists

- name: Youtube Music - Random track from playlist
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    base: ""
    plugin_music: yes
    plugin_music_playlist: https://music.youtube.com/playlist?list=OLAK5uy_kU_uxp9TUOl9zVdw77xith8o9AknVwz9U

- name: Youtube Music - Recently listed
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    base: ""
    plugin_music_token: ${{ secrets.YOUTUBE_MUSIC_TOKENS }}
    plugin_music: yes
    plugin_music_mode: recent
    plugin_music_provider: youtube
  prod:
    skip: true

- name: Last.fm  - Recently listed
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    base: ""
    plugin_music_token: ${{ secrets.LASTFM_TOKEN }}
    plugin_music: yes
    plugin_music_provider: lastfm
    plugin_music_user: RJ
  prod:
    skip: true
</file>

<file path="source/plugins/music/index.mjs">
//Imports
import crypto from "crypto"

//Supported providers
const providers = {
  apple: {
    name: "Apple Music",
    embed: /^https:..embed.music.apple.com.\w+.playlist/,
  },
  spotify: {
    name: "Spotify",
    embed: /^https:..open.spotify.com.embed.playlist/,
  },
  lastfm: {
    name: "Last.fm",
    embed: /^\b$/,
  },
  youtube: {
    name: "YouTube Music",
    embed: /^https:..music.youtube.com.playlist/,
  },
}
//Supported modes
const modes = {
  playlist: "Suggested tracks",
  recent: "Recently played",
  top: "Top played",
}

//Setup
export default async function({login, imports, data, q, account}, {enabled = false, token = "", sandbox = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.music) || (!imports.metadata.plugins.music.enabled(enabled, {extras})))
      return null

    //Initialization
    const raw = {
      get provider() {
        return providers[provider]?.name ?? ""
      },
      get mode() {
        return modes[mode] ?? "Unconfigured music plugin"
      },
    }
    let tracks = null

    //Load inputs
    let {provider, mode, playlist, limit, user, "played.at": played_at, "time.range": time_range, "top.type": top_type, token: _token} = imports.metadata.plugins.music.inputs({data, account, q})
    if ((sandbox) && (_token)) {
      token = _token
      console.debug(`metrics/compute/${login}/plugins > music > overridden token value through user inputs as sandbox mode is enabled`)
    }
    if (!imports.metadata.plugins.music.extras("token", {extras, error: false}))
      token = ""

    //Auto-guess parameters
    if (!mode) {
      if (playlist) {
        mode = "playlist"
        if (!provider) {
          for (const [name, {embed}] of Object.entries(providers)) {
            if (embed.test(playlist))
              provider = name
          }
        }
      }
      else if ("music.top.type" in q || "music.time.range" in q)
        mode = "top"
      else
        mode = "recent"
    }
    //Provider
    if (!(provider in providers))
      throw {error: {message: provider ? `Unsupported provider "${provider}"` : "Provider is not set"}, ...raw}
    //Mode
    if (!(mode in modes))
      throw {error: {message: `Unsupported mode "${mode}"`}, ...raw}
    //Playlist mode
    if (mode === "playlist") {
      if (!playlist)
        throw {error: {message: "Playlist URL is not set"}, ...raw}
      if (!providers[provider].embed.test(playlist))
        throw {error: {message: "Unsupported playlist URL format"}, ...raw}
    }
    //Limit
    limit = Math.max(1, Math.min(100, Number(limit)))

    //Handle mode
    console.debug(`metrics/compute/${login}/plugins > music > processing mode ${mode} with provider ${provider}`)
    switch (mode) {
      //Playlist mode
      case "playlist": {
        //Start puppeteer and navigate to playlist
        console.debug(`metrics/compute/${login}/plugins > music > starting browser`)
        const browser = await imports.puppeteer.launch()
        console.debug(`metrics/compute/${login}/plugins > music > started ${await browser.version()}`)
        const page = await browser.newPage()
        console.debug(`metrics/compute/${login}/plugins > music > loading page`)
        await page.setUserAgent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.55 Safari/537.36 Edg/96.0.1054.34")
        await page.goto(playlist)
        const frame = page.mainFrame()
        //Handle provider
        switch (provider) {
          //Apple music
          case "apple": {
            //Parse tracklist
            await frame.waitForFunction(() => !!document.querySelector("embed-root").shadowRoot.querySelector(".audio-tracklist"))
            //Apple music do a lot of lazy-loading preventing the use of networkIdle
            await new Promise(solve => setTimeout(solve, 10 * 1000))
            tracks = [
              ...await frame.evaluate(() => {
                const tracklist = document.querySelector("embed-root").shadowRoot.querySelector(".audio-tracklist")
                return [...tracklist.querySelectorAll("embed-audio-tracklist-item")].map(item => ({
                  name: item.querySelector(".audio-tracklist-item__metadata h3").innerText,
                  artist: item.querySelector(".audio-tracklist-item__metadata h4").innerText,
                  artwork: item.querySelector("apple-music-artwork")?.shadowRoot?.querySelector("picture source")?.srcset?.split(",")?.[0]?.replace(/\s+\d+x$/, ""),
                }))
              }),
            ]
            break
          }
          //Spotify
          case "spotify": {
            //Parse tracklist
            await frame.waitForSelector("ol")
            tracks = [
              ...await frame.evaluate(() =>
                [...document.querySelectorAll("ol li")].map(tr => ({
                  name: tr.querySelector("h3").innerText,
                  artist: tr.querySelector("h4").innerText,
                  //Spotify doesn't provide artworks so we fallback on playlist artwork instead
                  artwork: window.getComputedStyle(document.querySelector("div[style^='--image-src:']") ?? null)?.backgroundImage.match(/^url\("(?<url>https:...+)"\)$/)?.groups?.url ?? null,
                }))
              ),
            ]
            break
          }
          //YouTube Music
          case "youtube": {
            while (await frame.evaluate(() => document.querySelector("yt-next-continuation")?.children.length ?? 0))
              await frame.evaluate(() => window.scrollBy(0, window.innerHeight))
            //Parse tracklist
            tracks = [
              ...await frame.evaluate(() =>
                [...document.querySelectorAll("ytmusic-playlist-shelf-renderer ytmusic-responsive-list-item-renderer")].map(item => ({
                  name: item.querySelector("yt-formatted-string.title > a")?.innerText ?? "",
                  artist: item.querySelector(".secondary-flex-columns > yt-formatted-string > a")?.innerText ?? "",
                  artwork: item.querySelector("img").src,
                }))
              ),
            ]
            break
          }
          //Unsupported
          default:
            throw {error: {message: `Unsupported mode "${mode}" for provider "${provider}"`}, ...raw}
        }
        //Close browser
        console.debug(`metrics/compute/${login}/plugins > music > closing browser`)
        await browser.close()
        //Format tracks
        if (Array.isArray(tracks)) {
          //Tracks
          console.debug(`metrics/compute/${login}/plugins > music > found ${tracks.length} tracks`)
          console.debug(imports.util.inspect(tracks, {depth: Infinity, maxStringLength: 256}))
          //Shuffle tracks
          tracks = imports.shuffle(tracks)
        }
        break
      }
      //Recently played
      case "recent": {
        //Handle provider
        switch (provider) {
          //Spotify
          case "spotify": {
            //Prepare credentials
            const [client_id, client_secret, refresh_token] = token.split(",").map(part => part.trim())
            if ((!client_id) || (!client_secret) || (!refresh_token))
              throw {error: {message: "Token must contain client id, client secret and refresh token"}}
            //API call and parse tracklist
            try {
              //Request access token
              console.debug(`metrics/compute/${login}/plugins > music > requesting access token with spotify refresh token`)
              const {data: {access_token: access}} = await imports.axios.post("https://accounts.spotify.com/api/token", `${new imports.url.URLSearchParams({grant_type: "refresh_token", refresh_token, client_id, client_secret})}`, {
                headers: {
                  "Content-Type": "application/x-www-form-urlencoded",
                },
              })
              console.debug(`metrics/compute/${login}/plugins > music > got access token`)
              //Retrieve tracks
              console.debug(`metrics/compute/${login}/plugins > music > querying spotify api`)
              tracks = []
              for (let hours = .5; hours <= 24; hours++) {
                //Load track half-hour by half-hour
                const timestamp = Date.now() - hours * 60 * 60 * 1000
                const loaded = (await imports.axios.get(`https://api.spotify.com/v1/me/player/recently-played?after=${timestamp}`, {
                  headers: {
                    "Content-Type": "application/json",
                    Accept: "application/json",
                    Authorization: `Bearer ${access}`,
                  },
                })).data.items.map(({track, played_at}) => ({
                  name: track.name,
                  artist: track.artists[0].name,
                  artwork: track.album.images[0].url,
                  played_at: played_at ? `${imports.format.date(played_at, {time: true})} on ${imports.format.date(played_at, {date: true})}` : null,
                }))
                //Ensure no duplicate are added
                for (const track of loaded) {
                  if (!tracks.map(({name}) => name).includes(track.name))
                    tracks.push(track)
                }
                //Early break
                if (tracks.length >= limit)
                  break
              }
            }
            //Handle errors
            catch (error) {
              if (error.isAxiosError) {
                const status = error.response?.status
                const description = error.response.data?.error_description ?? null
                const message = `API returned ${status}${description ? ` (${description})` : ""}`
                error = error.response?.data ?? null
                throw {error: {message, instance: error}, ...raw}
              }
              throw error
            }
            break
          }
          //Last.fm
          case "lastfm": {
            //API call and parse tracklist
            try {
              console.debug(`metrics/compute/${login}/plugins > music > querying lastfm api`)
              tracks = (await imports.axios.get(`https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${user}&api_key=${token}&limit=${limit}&format=json`, {
                headers: {
                  "User-Agent": "lowlighter/metrics",
                  Accept: "application/json",
                },
              })).data.recenttracks.track.map(track => ({
                name: track.name,
                artist: track.artist["#text"],
                artwork: track.image.reverse()[0]["#text"],
              }))
            }
            //Handle errors
            catch (error) {
              if (error.isAxiosError) {
                const status = error.response?.status
                const description = error.response.data?.message ?? null
                const message = `API returned ${status}${description ? ` (${description})` : ""}`
                error = error.response?.data ?? null
                throw {error: {message, instance: error}, ...raw}
              }
              throw error
            }
            break
          }
          case "youtube": {
            //Prepare credentials
            let date = new Date().getTime()
            let [, cookie] = token.split("; ").find(part => part.startsWith("SAPISID=")).split("=")
            let sha1 = str => crypto.createHash("sha1").update(str).digest("hex")
            let SAPISIDHASH = `SAPISIDHASH ${date}_${sha1(`${date} ${cookie} https://music.youtube.com`)}`
            //API call and parse tracklist
            try {
              //Request access token
              console.debug(`metrics/compute/${login}/plugins > music > requesting access token with youtube refresh token`)
              const res = await imports.axios.post("https://music.youtube.com/youtubei/v1/browse?alt=json&key=AIzaSyC9XL3ZjWddXya6X74dJoCTL-WEYFDNX30", {
                browseEndpointContextSupportedConfigs: {
                  browseEndpointContextMusicConfig: {
                    pageType: "MUSIC_PAGE_TYPE_PLAYLIST",
                  },
                },
                context: {
                  client: {
                    clientName: "WEB_REMIX",
                    clientVersion: "1.20211129.00.01",
                    gl: "US",
                    hl: "en",
                  },
                },
                browseId: "FEmusic_history",
              }, {
                headers: {
                  Authorization: SAPISIDHASH,
                  Cookie: token,
                  "x-origin": "https://music.youtube.com",
                },
              })
              //Retrieve tracks
              console.debug(`metrics/compute/${login}/plugins > music > querying youtube api`)
              tracks = []
              let parsedHistory = get_all_with_key(res.data, "musicResponsiveListItemRenderer")

              for (let i = 0; i < parsedHistory.length; i++) {
                let track = parsedHistory[i]
                tracks.push({
                  name: track.flexColumns[0].musicResponsiveListItemFlexColumnRenderer.text.runs[0].text,
                  artist: track.flexColumns[1].musicResponsiveListItemFlexColumnRenderer.text.runs[0].text,
                  artwork: track.thumbnail.musicThumbnailRenderer.thumbnail.thumbnails[0].url,
                })
                //Early break
                if (tracks.length >= limit)
                  break
              }
            }
            //Handle errors
            catch (error) {
              throw imports.format.error(error)
            }
            break
          }
          //Unsupported
          default:
            throw {error: {message: `Unsupported mode "${mode}" for provider "${provider}"`}, ...raw}
        }
        break
      }
      case "top": {
        let time_msg
        switch (time_range) {
          case "short":
            time_msg = "from the last month"
            break
          case "medium":
            time_msg = "from the last 6 months"
            break
          case "long":
            time_msg = "overall"
            break
          default:
            throw {error: {message: `Unsupported time range "${time_range}"`}, ...raw}
        }

        if (top_type === "artists") {
          Object.defineProperty(modes, "top", {
            get() {
              return `Top played artists ${time_msg}`
            },
          })
        }
        else {
          Object.defineProperty(modes, "top", {
            get() {
              return `Top played tracks ${time_msg}`
            },
          })
        }

        //Handle provider
        switch (provider) {
          //Spotify
          case "spotify": {
            //Prepare credentials
            const [client_id, client_secret, refresh_token] = token.split(",").map(part => part.trim())
            if ((!client_id) || (!client_secret) || (!refresh_token))
              throw {error: {message: "Token must contain client id, client secret and refresh token"}}
            else if (limit > 50)
              throw {error: {message: "Top limit cannot exceed 50 for this provider"}}

            //API call and parse tracklist
            try {
              //Request access token
              console.debug(`metrics/compute/${login}/plugins > music > requesting access token with spotify refresh token`)
              const {data: {access_token: access}} = await imports.axios.post("https://accounts.spotify.com/api/token", `${new imports.url.URLSearchParams({grant_type: "refresh_token", refresh_token, client_id, client_secret})}`, {
                headers: {
                  "Content-Type": "application/x-www-form-urlencoded",
                },
              })
              console.debug(`metrics/compute/${login}/plugins > music > got access token`)
              //Retrieve tracks
              console.debug(`metrics/compute/${login}/plugins > music > querying spotify api`)
              tracks = []
              const loaded = top_type === "artists"
                ? (
                  await imports.axios.get(
                    `https://api.spotify.com/v1/me/top/artists?time_range=${time_range}_term&limit=${limit}`,
                    {
                      headers: {
                        "Content-Type": "application/json",
                        Accept: "application/json",
                        Authorization: `Bearer ${access}`,
                      },
                    },
                  )
                ).data.items.map(({name, genres, images}) => ({
                  name,
                  artist: genres.join(" ‚Ä¢ "),
                  artwork: images[0].url,
                }))
                : (
                  await imports.axios.get(
                    `https://api.spotify.com/v1/me/top/tracks?time_range=${time_range}_term&limit=${limit}`,
                    {
                      headers: {
                        "Content-Type": "application/json",
                        Accept: "application/json",
                        Authorization: `Bearer ${access}`,
                      },
                    },
                  )
                ).data.items.map(({name, artists, album}) => ({
                  name,
                  artist: artists[0].name,
                  artwork: album.images[0].url,
                }))
              //Ensure no duplicate are added
              for (const track of loaded) {
                if (!tracks.map(({name}) => name).includes(track.name))
                  tracks.push(track)
              }
            }
            //Handle errors
            catch (error) {
              throw imports.format.error(error)
            }
            break
          }
          //Last.fm
          case "lastfm": {
            //API call and parse tracklist
            try {
              console.debug(`metrics/compute/${login}/plugins > music > querying lastfm api`)
              const period = time_range === "short" ? "1month" : time_range === "medium" ? "6month" : "overall"
              tracks = top_type === "artists"
                ? (
                  await imports.axios.get(
                    `https://ws.audioscrobbler.com/2.0/?method=user.gettopartists&user=${user}&api_key=${token}&limit=${limit}&period=${period}&format=json`,
                    {
                      headers: {
                        "User-Agent": "lowlighter/metrics",
                        Accept: "application/json",
                      },
                    },
                  )
                ).data.topartists.artist.map(artist => ({
                  name: artist.name,
                  artist: `Play count: ${artist.playcount}`,
                  artwork: artist.image.reverse()[0]["#text"],
                }))
                : (
                  await imports.axios.get(
                    `https://ws.audioscrobbler.com/2.0/?method=user.gettoptracks&user=${user}&api_key=${token}&limit=${limit}&period=${period}&format=json`,
                    {
                      headers: {
                        "User-Agent": "lowlighter/metrics",
                        Accept: "application/json",
                      },
                    },
                  )
                ).data.toptracks.track.map(track => ({
                  name: track.name,
                  artist: track.artist.name,
                  artwork: track.image.reverse()[0]["#text"],
                }))
            }
            //Handle errors
            catch (error) {
              throw imports.format.error(error)
            }
            break
          }
          //Unsupported
          default:
            throw {error: {message: `Unsupported mode "${mode}" for provider "${provider}"`}, ...raw}
        }
        break
      }
      //Unsupported
      default:
        throw {error: {message: `Unsupported mode "${mode}"`}, ...raw}
    }

    //Format tracks
    if (Array.isArray(tracks)) {
      //Limit tracklist
      if (limit > 0) {
        console.debug(`metrics/compute/${login}/plugins > music > keeping only ${limit} tracks`)
        tracks.splice(limit)
      }
      //Convert artworks to base64
      console.debug(`metrics/compute/${login}/plugins > music > loading artworks`)
      for (const track of tracks) {
        console.debug(`metrics/compute/${login}/plugins > music > processing ${track.name}`)
        track.artwork = await imports.imgb64(track.artwork)
      }
      //Save results
      return {...raw, user, tracks, played_at}
    }

    //Unhandled error
    throw {error: {message: "Failed to retrieve tracks"}}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}

//get all objects that have the given key name with recursively
function get_all_with_key(obj, key) {
  const result = []
  if (obj instanceof Object) {
    if (key in obj)
      result.push(obj[key])
    for (const i in obj)
      result.push(...get_all_with_key(obj[i], key))
  }
  return result
}
</file>

<file path="source/plugins/music/metadata.yml">
name: üéº Music activity and suggestions
category: social
description: |
  This plugin can display top and recently listened music tracks or titles from a random playlist.

  Different music providers are supported.
disclaimer: |
  This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with any of the supported provider.
  All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.
examples:
  +random tracks from a playlist: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.music.playlist.svg
  +recently listened: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.music.recent.svg
index: 5
supports:
  - user
  - organization
scopes: []
inputs:

  plugin_music:
    description: |
      Enable music plugin
    type: boolean
    default: no
    extras:
      - metrics.run.puppeteer.scrapping

  plugin_music_provider:
    description: |
      Music provider

      - `apple`: Apple Music
      - `spotify`: Spotify
      - `lastfm`: Last.fm
      - `youtube`: YouTube Music

      This setting is optional when using [`plugin_music_mode: playlist`](/source/plugins/music/README.md#plugin_music_mode) (provider will be auto-detected from [`plugin_music_playlist`](/source/plugins/music/README.md#plugin_music_playlist) URL)
    type: string
    default: ""
    values:
      - apple
      - spotify
      - lastfm
      - youtube

  plugin_music_token:
    description: |
      Music provider token

      Below is the expected token format for each provider:
      - `apple`: *(not supported)*
      - `spotify`: "client_id, client_secret, refresh_token"
      - `lastfm`: "api_key"
      - `youtube`: "cookie"
    type: token
    default: ""
    extras:
      - metrics.api.music.any

  plugin_music_user:
    description: |
      Music provider username
    type: string
    default: .user.login
    preset: no

  plugin_music_mode:
    description: |
      Display mode

      - `playlist`: display random tracks from an URL playlist
      - `recent`: display recently listened tracks
      - `top`: display top listened artists/tracks

      If [`plugin_music_playlist`](/source/plugins/music/README.md#plugin_music_playlist) is specified, the default value is `playlist`, else it is `recent`
    type: string
    default: ""
    values:
      - playlist
      - recent
      - top

  plugin_music_playlist:
    description: |
      Playlist URL

      It must be from an "embed url" (i.e. music player iframes that can be integrated in other websites)
    type: string
    default: ""
    example: https://embed.music.apple.com/--/playlist/--------/--------
    preset: no

  plugin_music_limit:
    description: |
      Display limit
    type: number
    default: 4
    min: 1
    max: 100

  plugin_music_played_at:
    description: |
      Recently played - Last played timestamp
    type: boolean
    default: no

  plugin_music_time_range:
    description: |
      Top tracks - Time range

      - `short`: 4 weeks
      - `medium`: 6 months
      - `long`: several years
    type: string
    default: short
    values:
      - short
      - medium
      - long

  plugin_music_top_type:
    description: |
      Top tracks - Display type

      - `tracks`: display track
      - `artists`: display artists
    type: string
    default: tracks
    values:
      - tracks
      - artists
</file>

<file path="source/plugins/notable/queries/commits.graphql">
{
  repository(owner: "$owner", name: "$repo") {
    ...RepoFragment
  }
}

fragment RepoFragment on Repository {
  name
  defaultBranchRef {
    name
    target {
      ... on Commit {
        id
        history(first: 0) {
          totalCount
        }
      }
    }
  }
}
</file>

<file path="source/plugins/notable/queries/contributions.graphql">
query NotableContributions {
  user(login: "$login") {
    repositoriesContributedTo($after first: $repositories, contributionTypes: [$types], includeUserRepositories: $self, orderBy: { field: STARGAZERS, direction: DESC }) {
      edges {
        cursor
        node {
          isInOrganization
          owner {
            login
            avatarUrl
          }
          nameWithOwner
          watchers {
            totalCount
          }
          forks {
            totalCount
          }
          stargazers {
            totalCount
          }
          issues {
            totalCount
          }
          pullRequests {
            totalCount
          }
        }
      }
    }
  }
}
</file>

<file path="source/plugins/notable/queries/issues.graphql">
query NotableIssues {
  user(login: "$login") {
    $type($after first: 100, orderBy: {field: CREATED_AT, direction: DESC}) {
      totalCount
      edges {
        cursor
        node {
          repository {
            nameWithOwner
          }
        }
      }
    }
  }
}
</file>

<file path="source/plugins/notable/examples.yml">
- name: Contributions
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.notable.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_notable: yes

- name: Indepth analysis
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.notable.indepth.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_notable: yes
    plugin_notable_indepth: yes
    plugin_notable_repositories: yes
</file>

<file path="source/plugins/notable/index.mjs">
//Setup
export default async function({login, q, imports, rest, graphql, data, account, queries}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.notable) || (!imports.metadata.plugins.notable.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {filter, skipped, repositories, types, from, indepth, self} = imports.metadata.plugins.notable.inputs({data, account, q})
    skipped.push(...data.shared["repositories.skipped"])

    //Iterate through contributed repositories
    let contributions = []
    {
      let cursor = null
      let pushed = 0
      do {
        console.debug(`metrics/compute/${login}/plugins > notable > retrieving contributed repositories after ${cursor}`)
        const {user: {repositoriesContributedTo: {edges}}} = await graphql(queries.notable.contributions({login, types: types.map(x => x.toLocaleUpperCase()).join(", "), after: cursor ? `after: "${cursor}"` : "", self, repositories: data.shared["repositories.batch"] || 100}))
        cursor = edges?.[edges?.length - 1]?.cursor
        edges
          .filter(({node}) => imports.filters.repo(node, skipped))
          .filter(({node}) => ({all: true, organization: node.isInOrganization, user: !node.isInOrganization}[from]))
          .filter(({node}) => imports.filters.github(filter, {name: node.nameWithOwner, user: node.owner.login, stars: node.stargazers.totalCount, watchers: node.watchers.totalCount, forks: node.forks.totalCount}))
          .map(({node}) => contributions.push({handle: node.nameWithOwner, stars: node.stargazers.totalCount, issues: node.issues.totalCount, pulls: node.pullRequests.totalCount, organization: node.isInOrganization, avatarUrl: node.owner.avatarUrl}))
        pushed = edges.length
      }
      while ((pushed) && (cursor))
    }

    //Set contributions
    contributions = await Promise.all(contributions.map(async ({handle, stars, issues, pulls, avatarUrl, organization}) => ({name: handle.split("/").shift(), handle, stars, issues, pulls, avatar: await imports.imgb64(avatarUrl), organization})))
    console.debug(`metrics/compute/${login}/plugins > notable > found ${contributions.length} notable contributions`)

    //Indepth
    if ((indepth) && (imports.metadata.plugins.notable.extras("indepth", {extras}))) {
      console.debug(`metrics/compute/${login}/plugins > notable > indepth`)

      //Fetch issues
      const issues = {}
      if (types.includes("issue")) {
        let cursor = null
        let pushed = 0
        do {
          console.debug(`metrics/compute/${login}/plugins > notable > retrieving user issues after ${cursor}`)
          const {user: {issues: {edges}}} = await graphql(queries.notable.issues({login, type: "issues", after: cursor ? `after: "${cursor}"` : ""}))
          cursor = edges?.[edges?.length - 1]?.cursor
          edges.map(({node: {repository: {nameWithOwner: repository}}}) => issues[repository] = (issues[repositories] ?? 0) + 1)
          pushed = edges.length
        }
        while ((pushed) && (cursor))
      }

      //Fetch pull requests
      const pulls = {}
      if (types.includes("pull_request")) {
        let cursor = null
        let pushed = 0
        do {
          console.debug(`metrics/compute/${login}/plugins > notable > retrieving user pull requests after ${cursor}`)
          const {user: {pullRequests: {edges}}} = await graphql(queries.notable.issues({login, type: "pullRequests", after: cursor ? `after: "${cursor}"` : ""}))
          cursor = edges?.[edges?.length - 1]?.cursor
          edges.map(({node: {repository: {nameWithOwner: repository}}}) => pulls[repository] = (pulls[repositories] ?? 0) + 1)
          pushed = edges.length
        }
        while ((pushed) && (cursor))
      }

      //Fetch commits
      for (const contribution of contributions) {
        //Prepare data
        const {handle, stars} = contribution
        const [owner, repo] = handle.split("/")
        try {
          //Count total commits on repository
          const {repository: {defaultBranchRef: {target: {history}}}} = await graphql(queries.notable.commits({owner, repo}))
          contribution.history = history.totalCount

          //Load maintainers (errors probably means that token is not allowed to list contributors hence not a maintainer of said repo)
          const {data: collaborators} = await rest.repos.listCollaborators({owner, repo}).catch(() => ({data: []}))
          const maintainers = collaborators.filter(({role_name: role}) => ["admin", "maintain", "write"].includes(role)).map(({login}) => login)

          //Count total commits of user
          const {data: contributions = []} = await rest.repos.getContributorsStats({owner, repo})
          const commits = contributions?.filter(({author}) => author.login.toLocaleLowerCase() === login.toLocaleLowerCase()).reduce((a, {total: b}) => a + b, 0) ?? NaN

          //Save user data
          contribution.user = {
            commits,
            percentage: commits / contribution.history,
            maintainer: maintainers.includes(login),
            issues: issues[handle] ?? 0,
            pulls: pulls[handle] ?? 0,
            get stars() {
              return Math.round(this.maintainer ? stars : this.percentage * stars)
            },
          }
          console.debug(`metrics/compute/${login}/plugins > notable > indepth > successfully processed ${owner}/${repo}`)
        }
        catch (error) {
          console.debug(error)
          console.debug(`metrics/compute/${login}/plugins > notable > indepth > failed to compute for ${owner}/${repo}`)
        }
      }
    }

    //Aggregate contributions
    console.debug(`metrics/compute/${login}/plugins > notable > aggregating results`)
    const aggregated = new Map()
    for (const {name, handle, avatar, organization = handle.split("/").shift() ?? "", stars, ..._extras} of contributions) {
      const key = repositories ? handle : name
      if (aggregated.has(key)) {
        const aggregate = aggregated.get(key)
        aggregate.aggregated++
        if (indepth) {
          const {history = 0, user: {commits = 0, percentage = 0, maintainer = false} = {}} = _extras
          aggregate.history = aggregate.history ?? 0
          aggregate.history += history
          aggregate.user = aggregate.user ?? {}
          aggregate.user.commits += commits
          aggregate.user.percentage += percentage
          aggregate.user.maintainer = aggregate.user.maintainer || maintainer
        }
      }
      else {
        aggregated.set(key, {name: key, handle, avatar, organization, stars, aggregated: 1, ..._extras})
      }
    }
    contributions = [...aggregated.values()]
    if (indepth) {
      //Normalize contribution percentage
      contributions.map(aggregate => aggregate.user ? aggregate.user.percentage /= aggregate.aggregated : null)
      //Additional filtering (no user commits means that API wasn't able to answer back, considering it as matching by default)
      contributions = contributions.filter(({handle, user}) => !user?.commits ? true : imports.filters.github(filter, {handle, commits: contributions.history, "commits.user": user.commits, "commits.user%": user.percentage * 100, maintainer: user.maintainer}))
      //Sort contribution by maintainer first and then by contribution percentage
      contributions = contributions.sort((a, b) => ((b.user?.percentage + b.user?.maintainer) || 0) - ((a.user?.percentage + a.user?.maintainer) || 0))
    }

    //Results
    return {contributions, types}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/notable/metadata.yml">
name: üé© Notable contributions
category: github
description: |
  This plugin displays badges for notable contributions on repositories.
examples:
  +indepth analysis: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.notable.indepth.svg
  contributions in organizations only: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.notable.svg
index: 20
supports:
  - user
scopes:
  - public_access
inputs:

  plugin_notable:
    description: |
      Enable notable plugin
    type: boolean
    default: no

  plugin_notable_filter:
    description: |
      Query filter

      Based on [GitHub search syntax](https://docs.github.com/en/search-github/getting-started-with-searching-on-github/understanding-the-search-syntax).
      Supported fields are `stars`, `forks` and `watchers`

      If [`plugin_notable_indepth`](/source/plugins/notable/README.md#plugin_notable_indepth) is enabled, `commits`, `commits.user`, `commits.user%` and `maintainer` fields are also supported.
      Some repositories may not be able to reported advanced stats and in the case the default behaviour will be to bypass filtering
    type: string
    default: ""
    example: stars:>500 forks:>100 maintainer:true commits.user%:>5

  plugin_notable_skipped:
    description: |
      Skipped repositories
    type: array
    format: 
      - newline-separated
      - comma-separated
    default: ""
    example: my-repo-1, my-repo-2, owner/repo-3, ...
    inherits: repositories_skipped

  plugin_notable_from:
    description: |
      Repository owner account type filter

      - `all`: no filtering
      - `organization`: only organization accounts repositories
      - `user`: only user accounts repositories
    type: string
    default: organization
    values:
      - all
      - organization
      - user

  plugin_notable_repositories:
    description: |
      Repository name

      Repositories hosted by user account will always have their full handle displayed
    type: boolean
    default: no

  plugin_notable_indepth:
    description: |
      Indepth mode
    type: boolean
    default: no
    extras:
      - metrics.api.github.overuse

  plugin_notable_types:
    description: |
      Contribution types filter

      Use a combination of below values to include repositories where:
      - `commit`: a commit on default branch was made
      - `pull_request`: a pull request was opened
      - `issue`: an issue was opened
    type: array
    format: comma-separated
    default: commit
    example: commit, pull_request
    values:
      - commit
      - pull_request
      - issue

  plugin_notable_self:
    description: |
      Include own repositories
    type: boolean
    default: no
</file>

<file path="source/plugins/pagespeed/examples.yml">
- name: Succinct report
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.pagespeed.svg
    token: NOT_NEEDED
    base: ""
    plugin_pagespeed: yes
    plugin_pagespeed_token: ${{ secrets.PAGESPEED_TOKEN }}
    plugin_pagespeed_url: https://lecoq.io

- name: Detailed report
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.pagespeed.detailed.svg
    token: NOT_NEEDED
    base: ""
    plugin_pagespeed: yes
    plugin_pagespeed_detailed: yes
    plugin_pagespeed_token: ${{ secrets.PAGESPEED_TOKEN }}
    plugin_pagespeed_url: https://lecoq.io

- name: Screenshot
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.pagespeed.screenshot.svg
    token: NOT_NEEDED
    base: ""
    plugin_pagespeed: yes
    plugin_pagespeed_screenshot: yes
    plugin_pagespeed_token: ${{ secrets.PAGESPEED_TOKEN }}
    plugin_pagespeed_url: https://lecoq.io

- name: Succinct report with PWA
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.pagespeed.svg
    token: NOT_NEEDED
    base: ""
    plugin_pagespeed: yes
    plugin_pagespeed_token: ${{ secrets.PAGESPEED_TOKEN }}
    plugin_pagespeed_url: https://lecoq.io
    plugin_pagespeed_pwa: yes
  prod:
    skip: true
</file>

<file path="source/plugins/pagespeed/index.mjs">
//Setup
export default async function({login, imports, data, q, account}, {enabled = false, token = null, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.pagespeed) || (!imports.metadata.plugins.pagespeed.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {detailed, screenshot, url, pwa} = imports.metadata.plugins.pagespeed.inputs({data, account, q})
    if (!imports.metadata.plugins.pagespeed.extras("token", {extras, error: false}))
      token = ""

    //Format url if needed
    if (!url)
      throw {error: {message: "Website URL is not set"}}
    if (!/^https?:[/][/]/.test(url))
      url = `https://${url}`
    const {protocol, host} = imports.url.parse(url)
    const result = {url: `${protocol}//${host}`, detailed, scores: [], metrics: {}}

    //Load scores from API
    console.debug(`metrics/compute/${login}/plugins > pagespeed > querying api for ${result.url}`)
    const categories = ["performance", "accessibility", "best-practices", "seo"]
    if (pwa)
      categories.push("pwa")
    let categories_required = ""
    for (const category of categories)
      categories_required += `&category=${category}`

    //Perform audit
    console.debug(`metrics/compute/${login}/plugins > pagespeed > performing audit ${categories_required}`)
    const request = await imports.axios.get(`https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=${url}${categories_required}${token ? `&key=${token}` : ""}`)
    for (const category of categories) {
      const {score, title} = request.data.lighthouseResult.categories[category]
      result.scores.push({score, title})
      console.debug(`metrics/compute/${login}/plugins > pagespeed > performed audit ${category} (status code ${request.status})`)
    }

    //Store screenshot
    if (screenshot)
      result.screenshot = request.data.lighthouseResult.audits["final-screenshot"].details.data

    //Detailed metrics
    if (detailed) {
      console.debug(`metrics/compute/${login}/plugins > pagespeed > performing detailed audit`)
      const request = await imports.axios.get(`https://www.googleapis.com/pagespeedonline/v5/runPagespeed?&url=${url}${token ? `&key=${token}` : ""}`)
      Object.assign(result.metrics, ...request.data.lighthouseResult.audits.metrics.details.items)
      console.debug(`metrics/compute/${login}/plugins > pagespeed > performed detailed audit (status code ${request.status})`)
    }

    //Results
    return result
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error, {
      descriptions: {
        "429": '(consider using "plugin_pagespeed_token")',
        custom(error) {
          const description = error.response?.data?.error?.message?.match(/Lighthouse returned error: (?<description>[A-Z_]+)/)?.groups?.description ?? null
          if (description) {
            const status = error.response?.status
            return `API error: ${status} (${description})`
          }
          return null
        },
      },
    })
  }
}
</file>

<file path="source/plugins/pagespeed/metadata.yml">
name: ‚è±Ô∏è Google PageSpeed
category: social
description: |
  This plugin displays performance statistics of a website.

  It uses [Google's PageSpeed API](https://developers.google.com/speed/docs/insights/v5/get-started) (same as [web.dev](https://web.dev)), see [performance scoring](https://web.dev/performance-scoring/) and [score calculator](https://googlechrome.github.io/lighthouse/scorecalc/) for more informations about results.
disclaimer: |
  This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with [Google PageSpeed](https://pagespeed.web.dev/).
  All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.
examples:
  +PageSpeed scores: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.pagespeed.svg
  PageSpeed scores with detailed report: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.pagespeed.detailed.svg
  PageSpeed scores with a website screenshot: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.pagespeed.screenshot.svg
index: 0
supports:
  - user
  - organization
  - repository
scopes: []
inputs:

  plugin_pagespeed:
    description: |
      Enable pagespeed plugin
    type: boolean
    default: no

  plugin_pagespeed_token:
    description: |
      PageSpeed token

      > ‚ö†Ô∏è While not mandatory, it is strongly advised pass a token to avoid triggering the rate limiter. See [PageSpeed documentation](https://developers.google.com/speed/docs/insights/v5/get-started) for more informations.
    type: token
    default: ""
    extras:
      - metrics.api.google.pagespeed

  plugin_pagespeed_url:
    description: |
      Audited website
    type: string
    default: .user.website
    preset: no

  plugin_pagespeed_detailed:
    description: |
      Detailed results

      The following additional stats will be displayed:
      - First Contentful Paint
      - Speed Index
      - Largest Contentful Paint
      - Time to Interactive
      - Total Blocking Time
      - Cumulative Layout Shift
    type: boolean
    default: no

  plugin_pagespeed_screenshot:
    description: |
      Website screenshot

      Significantly increase filesize
    type: boolean
    default: no

  plugin_pagespeed_pwa:
    description: |
      PWA Status
    type: boolean
    default: no
</file>

<file path="source/plugins/people/queries/people.graphql">
query PeopleDefault {
  $account(login: "$login") {
    login
    $type($after first: 100) {
      edges {
        cursor
        node {
          login
          avatarUrl(size: $size)
        }
      }
    }
  }
}
</file>

<file path="source/plugins/people/queries/repository.graphql">
query PeopleRepository {
  $account(login: "$login") {
    repository(name: "$repository") {
      $type($after first: 100) {
        edges {
          cursor
          node {
            login
            avatarUrl(size: $size)
          }
        }
      }
    }
  }
}
</file>

<file path="source/plugins/people/queries/sponsors.graphql">
query PeopleSponsors {
  $account(login: "$login") {
    login
    $type($after first: 100) {
      edges {
        cursor
        node {
          $target {
            ... on User {
              login
              avatarUrl(size: $size)
            }
          }
        }
      }
    }
  }
}
</file>

<file path="source/plugins/people/examples.yml">
- name: Followers
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.people.followers.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_people: yes
    plugin_people_types: followers

- name: Contributors and sponsors
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.people.repository.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    template: repository
    repo: metrics
    plugin_people: yes
    plugin_people_types: contributors, stargazers, watchers, sponsors
</file>

<file path="source/plugins/people/index.mjs">
//Setup
export default async function({login, data, graphql, rest, q, queries, imports, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.people) || (!imports.metadata.plugins.people.enabled(enabled, {extras})))
      return null

    //Context
    let context = {
      mode: "user",
      types: account === "organization" ? ["sponsorshipsAsMaintainer", "sponsorshipsAsSponsor", "membersWithRole", "thanks"] : ["followers", "following", "sponsorshipsAsMaintainer", "sponsorshipsAsSponsor", "thanks"],
      default: "followers, following",
      alias: {followed: "following", sponsors: "sponsorshipsAsMaintainer", sponsored: "sponsorshipsAsSponsor", sponsoring: "sponsorshipsAsSponsor", members: "membersWithRole"},
      sponsorships: {sponsorshipsAsMaintainer: "sponsorEntity", sponsorshipsAsSponsor: "sponsorable"},
    }
    if (q.repo) {
      console.debug(`metrics/compute/${login}/plugins > people > switched to repository mode`)
      const {owner, repo} = data.user.repositories.nodes.map(({name: repo, owner: {login: owner}}) => ({repo, owner})).shift()
      context = {...context, mode: "repository", types: ["contributors", "stargazers", "watchers", "sponsorshipsAsMaintainer", "thanks"], default: "stargazers, watchers", owner, repo}
    }

    //Load inputs
    let {limit, types, size, identicons, "identicons.hide": _identicons_hide, thanks, shuffle, "sponsors.custom": _sponsors} = imports.metadata.plugins.people.inputs({data, account, q}, {types: context.default})
    //Filter types
    types = [...new Set([...types].map(type => (context.alias[type] ?? type)).filter(type => context.types.includes(type)) ?? [])]
    if ((types.includes("sponsorshipsAsMaintainer")) && (_sponsors?.length)) {
      types.unshift("sponsorshipsCustom")
      data.user.sponsorshipsAsMaintainer.totalCount += _sponsors.length
    }

    //Retrieve followers from graphql api
    console.debug(`metrics/compute/${login}/plugins > people > querying api`)
    const result = Object.fromEntries(types.map(type => [type, []]))
    for (const type of types) {
      //Iterate through people
      console.debug(`metrics/compute/${login}/plugins > people > retrieving ${type}`)
      //Rest
      if (type === "contributors") {
        const {owner, repo} = context
        const {data: nodes} = await rest.repos.listContributors({owner, repo})
        result[type].push(...nodes.map(({login, avatar_url}) => ({login, avatarUrl: avatar_url})))
      }
      else if ((type === "thanks") || (type === "sponsorshipsCustom")) {
        const users = {thanks, sponsorshipsCustom: _sponsors}[type] ?? []
        const nodes = await Promise.all(users.map(async username => (await rest.users.getByUsername({username})).data))
        result[{sponsorshipsCustom: "sponsorshipsAsMaintainer"}[type] ?? type].push(...nodes.map(({login, avatar_url}) => ({login, avatarUrl: avatar_url})))
      }
      //GraphQL
      else {
        let cursor = null
        let pushed = 0
        do {
          console.debug(`metrics/compute/${login}/plugins > people > retrieving ${type} after ${cursor}`)
          const {[type]: {edges}} = type in context.sponsorships
            ? (await graphql(queries.people.sponsors({login: context.owner ?? login, type, size, after: cursor ? `after: "${cursor}"` : "", target: context.sponsorships[type], account})))[account]
            : context.mode === "repository"
            ? (await graphql(queries.people.repository({login: context.owner, repository: context.repo, type, size, after: cursor ? `after: "${cursor}"` : "", account})))[account].repository
            : (await graphql(queries.people({login, type, size, after: cursor ? `after: "${cursor}"` : "", account})))[account]
          cursor = edges?.[edges?.length - 1]?.cursor
          result[type].push(...edges.map(({node}) => node[context.sponsorships[type]] ?? node))
          pushed = edges.length
        }
        while ((pushed) && (cursor) && ((limit === 0) || (result[type].length <= (shuffle ? 10 * limit : limit))))
      }
      //Shuffle
      if (shuffle) {
        console.debug(`metrics/compute/${login}/plugins > people > shuffling`)
        imports.shuffle(result[type])
      }
      //Filter out identicons if not wanted
      if (_identicons_hide) {
        console.debug(`metrics/compute/${login}/plugins > people > filtering out user without custom avatarUrl`)
        result[type] = result[type].filter(user => user.avatarUrl?.includes("&u="))
      }
      //Limit people
      if (limit > 0) {
        console.debug(`metrics/compute/${login}/plugins > people > keeping only ${limit} ${type}`)
        result[type].splice(limit)
      }
      //Hide real avatar with identicons if enabled
      if (identicons) {
        console.debug(`metrics/compute/${login}/plugins > people > using identicons`)
        result[type].map(user => user.avatarUrl = `https://github.com/identicons/${user.login}.png`)
      }
      //Convert avatars to base64
      console.debug(`metrics/compute/${login}/plugins > people > loading avatars`)
      await Promise.all(result[type].map(async user => user.avatar = await imports.imgb64(user.avatarUrl)))
    }

    //Special type handling
    if (types.includes("sponsorshipsCustom")) {
      types.splice(types.indexOf("sponsorshipsCustom"), 1)
      const unique = [...new Map(result.sponsorshipsAsMaintainer.reverse().map(user => [user.login, user])).values()].reverse()
      data.user.sponsorshipsAsMaintainer.totalCount -= result.sponsorshipsAsMaintainer.length - unique.length
      result.sponsorshipsAsMaintainer = unique
    }

    //Results
    return {types, size, ...result}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/people/metadata.yml">
name: üßë‚Äçü§ù‚Äçüßë People
category: github
description: |
  This plugin can display relationships with users, such as followers, sponsors, contributors, stargazers, watchers, members, etc.
examples:
  +related to a user: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.people.followers.svg
  related to a repository: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.people.repository.svg
index: 11
supports:
  - user
  - organization
  - repository
scopes:
  - public_access
inputs:

  plugin_people:
    description: |
      Enable people plugin
    type: boolean
    default: no

  plugin_people_limit:
    description: |
      Display limit
    type: number
    default: 24
    min: 0
    zero: disable

  plugin_people_identicons:
    description: |
      Force identicons pictures

      Can be used to mask profile pictures for privacy
    type: boolean
    default: no

  plugin_people_identicons_hide:
    description: |
      Hide identicons pictures

      Can be used to mask users without a personal profile picture.

      When used with [`plugin_people_identicons`](/source/plugins/people/README.md#plugin_people_identicons), users without a personal profile picture will still be filtered out, but their picture will be replaced by an identicon instead
    type: boolean
    default: no

  plugin_people_size:
    description: |
      Profile picture display size
    type: number
    default: 28
    min: 8
    max: 64

  plugin_people_types:
    description: |
      Displayed sections

      User and organization accounts support the following values:
      - `followers`
      - `following`/`followed`
      - `sponsoring`/`sponsored`
      - `sponsors`
      - `members` (organization only)
      - `thanks`(to be configured with [`plugin_people_thanks`](/source/plugins/people/README.md#plugin_people_thanks))

      Repositories support the following values:
      - `sponsors` (same as owner sponsors)
      - `contributors`
      - `stargazers`
      - `watchers`
      - `thanks`(to be configured with [`plugin_people_thanks`](/source/plugins/people/README.md#plugin_people_thanks))

      Specified order is honored
    type: array
    format: comma-separated
    default: followers, following
    example: follower, following, sponsors, sponsoring
    values:
      - followers
      - following
      - followed
      - sponsoring
      - members
      - sponsored
      - sponsors
      - contributors
      - stargazers
      - watchers
      - thanks

  plugin_people_thanks:
    description: |
      Special thanks

      Can be used to thank specific users
    type: array
    format: comma-separated
    default: ""
    example: octocat, hubot
    preset: no

  plugin_people_sponsors_custom:
    description: |
      Custom sponsors

      This list can be used to add users from unsupported GitHub sponsors sources.
      The option [`plugin_people_types`](/source/plugins/people/README.md#plugin_people_types) must contain the `sponsors` section in order for this setting to be effective
    type: array
    format: comma-separated
    default: ""
    example: octocat, hubot
    preset: no

  plugin_people_shuffle:
    description: |
      Shuffle data

      Can be used to create varied outputs
      This will fetch additional data (10 times [`plugin_people_limit`](/source/plugins/people/README.md#plugin_people_limit)) to ensure output is always different
    type: boolean
    default: no
</file>

<file path="source/plugins/posts/queries/hashnode.graphql">
query PostsHashnode {
  user(username: "$user"){
    publication{
      posts(page: 0) {
        slug
        title
        brief
        coverImage
        dateAdded
      }
    }
  }
}
</file>

<file path="source/plugins/posts/examples.yml">
- name: Recent posts
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.posts.svg
    token: NOT_NEEDED
    base: ""
    plugin_posts: yes
    plugin_posts_source: dev.to

- name: Recent posts with descriptions and cover images
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.posts.full.svg
    token: NOT_NEEDED
    base: ""
    plugin_posts: yes
    plugin_posts_source: dev.to
    plugin_posts_limit: 2
    plugin_posts_descriptions: yes
    plugin_posts_covers: yes
</file>

<file path="source/plugins/posts/index.mjs">
//Setup
export default async function({login, data, imports, q, queries, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.posts) || (!imports.metadata.plugins.posts.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {source, descriptions, covers, limit, user} = imports.metadata.plugins.posts.inputs({data, account, q})
    //Retrieve posts
    console.debug(`metrics/compute/${login}/plugins > posts > processing with source ${source}`)
    let posts = null
    let link = null
    switch (source) {
      //Dev.to
      case "dev.to": {
        user = user.toLowerCase()
        console.debug(`metrics/compute/${login}/plugins > posts > querying api`)
        posts = (await imports.axios.get(`https://dev.to/api/articles?username=${user}&state=fresh`)).data.map(({title, description, published_at: date, cover_image: image, url: link}) => ({title, description, date, image, link}))
        link = `https://dev.to/${user}`
        break
      }
      //Hashnode
      case "hashnode": {
        posts = (await imports.axios.post("https://api.hashnode.com", {query: queries.posts.hashnode({user})}, {headers: {"Content-type": "application/json"}})).data.data.user.publication.posts.map((
          {title, brief: description, dateAdded: date, coverImage: image, slug},
        ) => ({title, description, date, image, link: `https://hashnode.com/post/${slug}`}))
        link = `https://hashnode.com/@${user}`
        break
      }
      //Unsupported
      default:
        throw {error: {message: `Unsupported source "${source}"`}}
    }

    //Format posts
    if (Array.isArray(posts)) {
      //Limit posts
      if (limit > 0) {
        console.debug(`metrics/compute/${login}/plugins > posts > keeping only ${limit} posts`)
        posts.splice(limit)
      }
      //Cover images
      if (covers) {
        console.debug(`metrics/compute/${login}/plugins > posts > formatting cover images`)
        posts = await Promise.all(posts.map(async ({image, ...post}) => ({image: await imports.imgb64(image, {width: 144, height: -1}), ...post})))
      }
      //Results
      return {user, source, link, descriptions, covers, list: posts}
    }

    //Unhandled error
    throw {error: {message: "Failed to retrieve posts"}}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/posts/metadata.yml">
name: ‚úíÔ∏è Recent posts
category: social
description: |
  This plugin displays recent articles from a specified and supported external source.
examples:
  +latest posts width description and cover image: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.posts.full.svg
  latest posts: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.posts.svg
index: 6
supports:
  - user
  - organization
  - repository
scopes: []
inputs:

  plugin_posts:
    description: |
      Enable posts plugin
    type: boolean
    default: no

  plugin_posts_source:
    description: |
      External source

      - `dev.to`: [dev.to](https://dev.to)
      - `hashnode`: [hashnode.com](https://hashnode.com)
    type: string
    default: ""
    values:
      - dev.to
      - hashnode

  plugin_posts_user:
    description: |
      External source username
    type: string
    default: .user.login
    preset: no

  plugin_posts_descriptions:
    description: |
      Posts descriptions
    type: boolean
    default: no

  plugin_posts_covers:
    description: |
      Posts cover images
    type: boolean
    default: no

  plugin_posts_limit:
    description: |
      Display limit
    type: number
    default: 4
    min: 1
    max: 30
</file>

<file path="source/plugins/projects/queries/repository.graphql">
query ProjectsRepository {
  $account(login: "$user") {
    repository(name: "$repository") {
      projectV2(number: $id) {
        name: title
        body: shortDescription
        updatedAt
        items(first: 4, orderBy: {field: POSITION, direction: ASC}) {
          totalCount
          nodes {
            type
            isArchived
            fieldValues(last: 100) {
              nodes {
                ... on ProjectV2ItemFieldTextValue {
                  text
                }
              }
            }
          }
        }
      }
    }
  }
}
</file>

<file path="source/plugins/projects/queries/repository.legacy.graphql">
query ProjectsRepositoryLegacy {
  $account(login: "$user") {
    repository(name: "$repository") {
      project(number: $id) {
        name
        body
        updatedAt
        progress {
          doneCount
          inProgressCount
          todoCount
          enabled
        }
      }
    }
  }
}
</file>

<file path="source/plugins/projects/queries/user.graphql">
query ProjectsUser {
  $account(login: "$login") {
    projectsV2(last: $limit, orderBy: {field: UPDATED_AT, direction: DESC}) {
      totalCount
      nodes {
        name: title
        body: shortDescription
        updatedAt
        items(first: 4, orderBy: {field: POSITION, direction: ASC}) {
          totalCount
          nodes {
            type
            isArchived
            fieldValues(last: 100) {
              nodes {
                ... on ProjectV2ItemFieldTextValue {
                  text
                }
              }
            }
          }
        }
      }
    }
  }
}
</file>

<file path="source/plugins/projects/queries/user.legacy.graphql">
query ProjectsUserLegacy {
  $account(login: "$login") {
    projects(last: $limit, states: OPEN, orderBy: {field: UPDATED_AT, direction: DESC}) {
      totalCount
      nodes {
        name
        body
        updatedAt
        progress {
          doneCount
          inProgressCount
          todoCount
          enabled
        }
      }
    }
  }
}
</file>

<file path="source/plugins/projects/examples.yml">
- name: Project from a repository
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.projects.svg
    token: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}
    base: ""
    plugin_projects: yes
    plugin_projects_repositories: lowlighter/metrics/projects/1
    plugin_projects_descriptions: yes
</file>

<file path="source/plugins/projects/index.mjs">
//Setup
export default async function({login, data, imports, graphql, q, queries, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.projects) || (!imports.metadata.plugins.projects.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {limit, repositories, descriptions} = imports.metadata.plugins.projects.inputs({data, account, q})
    //Repositories projects
    repositories = repositories.filter(repository => /[-\w]+[/][-\w]+[/]projects[/]\d+/.test(repository))
    //Update limit if repositories projects were specified manually
    limit = Math.max(repositories.length, limit)

    //Retrieve user owned projects from graphql api
    console.debug(`metrics/compute/${login}/plugins > projects > querying api`)
    const {[account]: {projects}} = await graphql(queries.projects["user.legacy"]({login, limit, account}))
    const {[account]: {projectsV2}} = await graphql(queries.projects.user({login, limit, account}))
    projects.nodes.unshift(...projectsV2.nodes)
    projects.totalCount += projectsV2.totalCount

    //Retrieve repositories projects from graphql api
    for (const identifier of repositories) {
      //Querying repository project
      console.debug(`metrics/compute/${login}/plugins > projects > querying api for ${identifier}`)
      const {user, repository, id} = identifier.match(/(?<user>[-\w]+)[/](?<repository>[-\w]+)[/]projects[/](?<id>\d+)/)?.groups ?? {}
      let project = null
      for (const account of ["user", "organization"]) {
        //Try projects beta
        try {
          project = (await graphql(queries.projects.repository({user, repository, id, account})))[account].repository.projectV2
          if (project)
            break
        }
        catch (error) {
          console.debug(error)
        }
        //Try projects classic
        try {
          console.debug(`metrics/compute/${login}/plugins > projects > falling back to projects classic for ${identifier}`)
          ;({project} = (await graphql(queries.projects["repository.legacy"]({user, repository, id, account})))[account].repository)
          if (project)
            break
        }
        catch (error) {
          console.debug(error)
        }
      }
      if (!project)
        throw new Error(`Could not load project ${user}/${repository}`)
      //Adding it to projects list
      console.debug(`metrics/compute/${login}/plugins > projects > registering ${identifier}`)
      project.name = `${project.name} (${user}/${repository})`
      projects.nodes.unshift(project)
      projects.totalCount++
    }

    //Iterate through projects and format them
    console.debug(`metrics/compute/${login}/plugins > projects > processing ${projects.nodes.length} projects`)
    const list = []
    for (const project of projects.nodes) {
      //Format date
      const time = (Date.now() - new Date(project.updatedAt).getTime()) / (24 * 60 * 60 * 1000)
      let updated = new Date(project.updatedAt).toDateString().substring(4)
      if (time < 1)
        updated = "less than 1 day ago"
      else if (time < 30)
        updated = `${Math.floor(time)} day${time >= 2 ? "s" : ""} ago`
      //Format progress
      const {enabled = false, todoCount: todo = NaN, inProgressCount: doing = NaN, doneCount: done = NaN} = project.progress ?? {}
      let total = todo + doing + done
      //Format items (v2)
      const items = []
      if (project.items) {
        items.push(...project.items.nodes.map(({type, fieldValues: {nodes: fields}}) => ({type, text: fields.filter(field => field.text).shift()?.text ?? ""})))
        total = project.items.totalCount
      }
      //Append
      list.push({name: project.name, updated, description: project.body, progress: {enabled, todo, doing, done, total}, items})
    }

    //Limit
    console.debug(`metrics/compute/${login}/plugins > projects > keeping only ${limit} projects`)
    list.splice(limit)

    //Results
    return {list, totalCount: projects.totalCount, descriptions}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error, {
      descriptions: {
        custom(error) {
          if (error.errors?.map(({type}) => type)?.includes("INSUFFICIENT_SCOPES"))
            return "Insufficient token scopes"
          return null
        },
      },
    })
  }
}
</file>

<file path="source/plugins/projects/metadata.yml">
name: üóÇÔ∏è GitHub projects
category: github
description: |
  This plugin displays progress of profile and repository projects.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.projects.svg
index: 25
supports:
  - user
  - organization
  - repository
scopes:
  - public_access
  - public_repo
  - read:project
inputs:

  plugin_projects:
    description: |
      Enable projects plugin
    type: boolean
    default: no

  plugin_projects_limit:
    description: |
      Display limit

      Projects defined by [`plugin_projects_repositories`](/source/plugins/projects/README.md#plugin_projects_repositories) are not affected by this option
    type: number
    default: 4
    min: 0
    max: 100

  plugin_projects_repositories:
    description: |
      Featured repositories projects

      Use the following syntax for each project `:user/:repo/projects/:project_id`

      > ‚ÑπÔ∏è [GitHub projects (beta)](https://docs.github.com/en/issues/trying-out-the-new-projects-experience/about-projects) needs to use the same syntax as above and repository must specified repository must be linked to given project.
    type: array
    example: username/repo/projects/1, username/repo/projects/2, ...
    format: comma-separated
    default: ""
    preset: no

  plugin_projects_descriptions:
    description: |
      Projects descriptions
    type: boolean
    default: no
</file>

<file path="source/plugins/reactions/queries/reactions.graphql">
query ReactionsDefault {
  user(login: "$login") {
    login
    $type($before last: 50) {
      edges {
        cursor
        node {
          createdAt
          reactions(last: 100, orderBy: {field: CREATED_AT, direction: DESC}) {
            nodes {
              content
              user {
                login
              }
            }
          }
        }
      }
    }
  }
}
</file>

<file path="source/plugins/reactions/examples.yml">
- name: Comment reactions
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.reactions.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_reactions: yes
    plugin_reactions_limit: 100
    plugin_reactions_details: percentage
</file>

<file path="source/plugins/reactions/index.mjs">
//Setup
export default async function({login, q, imports, data, graphql, queries, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.reactions) || (!imports.metadata.plugins.reactions.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {limit: _limit1, "limit.issues": _limit2, "limit.discussions": _limit3, "limit.discussions.comments": _limit4, days, details, display, ignored} = imports.metadata.plugins.reactions.inputs({data, account, q})
    ignored.push(...data.shared["users.ignored"])

    //Load issue comments
    const comments = []
    for (const {type, limit} of [{type: "issueComments", limit: _limit1}, {type: "issues", limit: _limit2}, {type: "repositoryDiscussionComments", limit: _limit3}, {type: "repositoryDiscussions", limit: _limit4}].filter(({limit}) => limit)) {
      let cursor = null, pushed = 0
      const fetched = []
      try {
        do {
          //Load issue comments
          console.debug(`metrics/compute/${login}/plugins > reactions > retrieving ${type} before ${cursor}`)
          const {user: {[type]: {edges}}} = await graphql(queries.reactions({login, type, before: cursor ? `before: "${cursor}"` : ""}))
          cursor = edges?.[0]?.cursor
          //Save issue comments
          const filtered = edges
            .flatMap(({node: {createdAt: created, reactions: {nodes: reactions}}}) => ({created: new Date(created), reactions: reactions.filter(({user = {}}) => imports.filters.text(user.login, ignored)).map(({content}) => content)}))
            .filter(comment => Number.isFinite(days) ? comment.created < new Date(Date.now() - days * 24 * 60 * 60 * 1000) : true)
          pushed = filtered.length
          fetched.push(...filtered)
          console.debug(`metrics/compute/${login}/plugins > reactions > currently at ${fetched.length} ${type} comments`)
          //Applying limit
          if ((fetched.length >= limit) || (filtered.length < edges.length)) {
            fetched.splice(limit)
            console.debug(`metrics/compute/${login}/plugins > reactions > keeping only ${fetched.length} ${type} comments`)
          }
        }
        while ((cursor) && (pushed) && (fetched.length < limit))
        comments.push(...fetched)
      }
      catch (error) {
        console.debug(error)
        console.debug(`metrics/compute/${login}/plugins > reactions > an error occurred while retrieving ${type}`)
      }
    }
    console.debug(`metrics/compute/${login}/plugins > reactions > fetched ${comments.length} comments`)

    //Format reactions list
    const list = {}
    const reactions = comments.flatMap(({reactions}) => reactions)
    for (const reaction of reactions)
      list[reaction] = (list[reaction] ?? 0) + 1
    const max = Math.max(...Object.values(list))
    for (const [key, value] of Object.entries(list))
      list[key] = {value, percentage: value / reactions.length, score: value / (display === "relative" ? max : reactions.length)}

    //Compute total reactions
    const total = Object.values(list).map(({value}) => value).reduce((a, b) => a + b, 0)

    //Results
    return {list, total, comments: comments.length, details, days, twemoji: q["config.twemoji"]}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/reactions/metadata.yml">
name: üé≠ Comment reactions
category: github
description: |
  This plugin displays overall user reactions on recent issues, comments and discussions.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.reactions.svg
index: 10
supports:
  - user
scopes:
  - public_access
inputs:

  plugin_reactions:
    description: |
      Enable reactions plugin
    type: boolean
    default: no

  plugin_reactions_limit:
    description: |
      Display limit (issues and pull requests comments)
    type: number
    default: 200
    min: 0
    max: 1000

  plugin_reactions_limit_issues:
    description: |
      Display limit (issues and pull requests, first comment)
    type: number
    default: 100
    min: 0
    max: 1000

  plugin_reactions_limit_discussions:
    description: |
      Display limit (discussions, first comment)
    type: number
    default: 100
    min: 0
    max: 1000

  plugin_reactions_limit_discussions_comments:
    description: |
      Display limit (discussions comments)
    type: number
    default: 100
    min: 0
    max: 1000

  plugin_reactions_days:
    description: |
      Comments maximum age
    type: number
    default: 0
    min: 0
    zero: disable

  plugin_reactions_display:
    description: |
      Display mode

      - `absolute`: scale percentages using total reactions count
      - `relative`: scale percentages using highest reaction count
    type: string
    default: absolute
    values:
      - absolute
      - relative

  plugin_reactions_details:
    description: |
      Additional details
    type: array
    format: comma-separated
    default: ""
    example: count, percentage
    values:
      - count
      - percentage

  plugin_reactions_ignored:
    description: |
      Ignored users

      Can be used to ignore bots activity
    type: array
    format: comma-separated
    default: ""
    inherits: users_ignored
</file>

<file path="source/plugins/repositories/queries/pinned.graphql">
query RepositoriesPinned {
  user(login: "$login") {
    pinnedItems(types: REPOSITORY, first: $limit) {
      edges {
        node {
          ... on Repository {
            createdAt
            description
            forkCount
            isFork
            issues {
              totalCount
            }
            nameWithOwner
            openGraphImageUrl
            licenseInfo {
              nickname
              spdxId
              name
            }
            pullRequests {
              totalCount
            }
            stargazerCount
            primaryLanguage {
              color
              name
            }
          }
        }
      }
    }
  }
}
</file>

<file path="source/plugins/repositories/queries/random.graphql">
query RepositoriesRandom {
  user(login: "$login") {
    repositories(
      orderBy: {field: UPDATED_AT, direction: DESC}
      first: 100
      privacy: PUBLIC
      $affiliations
      $forks
    ) {
      nodes {
        nameWithOwner
      }
    }
  }
}
</file>

<file path="source/plugins/repositories/queries/repository.graphql">
query RepositoriesRepository {
  repository(owner: "$owner", name: "$name") {
    createdAt
    description
    forkCount
    isFork
    issues {
      totalCount
    }
    nameWithOwner
    openGraphImageUrl
    licenseInfo {
      nickname
      spdxId
      name
    }
    pullRequests {
      totalCount
    }
    stargazerCount
    primaryLanguage {
      color
      name
    }
  }
}
</file>

<file path="source/plugins/repositories/queries/starred.graphql">
query RepositoriesStarred {
  user(login: "$login") {
    repositories(
      orderBy: {field: STARGAZERS, direction: DESC}
      first: $limit
      privacy: PUBLIC
      $affiliations
      $forks
    ) {
      nodes {
        nameWithOwner
      }
    }
  }
}
</file>

<file path="source/plugins/repositories/examples.yml">
- name: Featured repositories
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.repositories.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_repositories: yes
    plugin_repositories_featured: lowlighter/metrics

- name: Pinned repositories
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.repositories.pinned.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_repositories: yes
    plugin_repositories_pinned: 2
</file>

<file path="source/plugins/repositories/index.mjs">
//Setup
export default async function({login, q, imports, graphql, queries, data, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.repositories) || (!imports.metadata.plugins.repositories.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {featured, pinned, starred, random, order, affiliations: _affiliations, forks: _forks} = imports.metadata.plugins.repositories.inputs({data, account, q})
    const affiliations = _affiliations?.length ? `ownerAffiliations: [${_affiliations.map(x => x.toLocaleUpperCase()).join(", ")}]` : ""
    const forks = _forks ? "" : "isFork: false"

    //Initialization
    const repositories = {list: []}
    const processed = new Set()

    //Featured repositories
    for (const repo of featured) {
      const {owner = login, name} = repo.match(/^(?:(?<owner>[\s\S]*)[/])?(?<name>[\s\S]+)$/)?.groups ?? {}
      const {repository} = await graphql(queries.repositories.repository({owner, name}))
      repositories.list.push(format(repository, {sorting: "featured"}))
      processed.add(repository.nameWithOwner)
    }

    //Fetch pinned repositories
    if (pinned) {
      const {user: {pinnedItems: {edges}}} = await graphql(queries.repositories.pinned({login, limit: 6}))
      repositories.list.push(
        ...edges.map(({node}) => {
          if (processed.has(node.nameWithOwner))
            return null
          processed.add(node.nameWithOwner)
          return format(node, {sorting: "pinned"})
        }).filter(repository => repository).slice(0, pinned),
      )
    }

    //Fetch starred repositories
    if (starred) {
      const {user: {repositories: {nodes}}} = await graphql(queries.repositories.starred({login, limit: Math.min(starred + 10, 100), affiliations, forks}))
      let count = 0
      for (const node of nodes) {
        if (processed.has(node.nameWithOwner))
          continue
        const [owner, name] = node.nameWithOwner.split("/")
        const {repository} = await graphql(queries.repositories.repository({owner, name}))
        repositories.list.push(format(repository, {sorting: "starred"}))
        processed.add(repository.nameWithOwner)
        if (++count >= starred)
          break
      }
    }

    //Fetch random repositories
    if (random) {
      const {user: {repositories: {nodes}}} = await graphql(queries.repositories.random({login, affiliations, forks}))
      let count = 0
      for (const node of imports.shuffle(nodes)) {
        if (processed.has(node.nameWithOwner))
          continue
        const [owner, name] = node.nameWithOwner.split("/")
        const {repository} = await graphql(queries.repositories.repository({owner, name}))
        repositories.list.push(format(repository, {sorting: "random"}))
        processed.add(repository.nameWithOwner)
        if (++count >= random)
          break
      }
    }

    //Sorting
    repositories.list = repositories.list.sort((a, b) => order.indexOf(a.sorting) - order.indexOf(b.sorting))

    //Results
    return repositories
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}

/**Format repository data */
function format(repository, {sorting} = {}) {
  //Format date
  const time = (Date.now() - new Date(repository.createdAt).getTime()) / (24 * 60 * 60 * 1000)
  let created = new Date(repository.createdAt).toDateString().substring(4)
  if (time < 1)
    created = `${Math.ceil(time * 24)} hour${Math.ceil(time * 24) >= 2 ? "s" : ""} ago`
  else if (time < 30)
    created = `${Math.floor(time)} day${time >= 2 ? "s" : ""} ago`
  repository.created = created

  //Sorting
  if (sorting)
    repository.sorting = sorting

  return repository
}
</file>

<file path="source/plugins/repositories/metadata.yml">
name: üìì Featured repositories
category: github
description: |
  This plugin displays a list of chosen featured repositories.

  Since it is possible to [pin repositories](https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-profile/customizing-your-profile/pinning-items-to-your-profile) on GitHub, this plugin is mostly intended for external usage.
notes: |
  > ‚ö†Ô∏è Due to limitations of using SVG images inside `<img>` tags, clicking on a repository card will not redirect to repository page.
examples:
  +featured: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.repositories.svg
  pinned: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.repositories.pinned.svg
index: 14
supports:
  - user
  - organization
scopes:
  - public_access
inputs:

  plugin_repositories:
    description: |
      Enable repositories plugin
    type: boolean
    default: no

  plugin_repositories_featured:
    description: |
      Featured repositories

      Current [`user`](/source/plugins/core/README.md#user) will be used when no owner is specified
    type: array
    format: comma-separated
    default: ""
    example: metrics, lowlighter/metrics
    preset: no

  plugin_repositories_pinned:
    description: |
      Pinned repositories
    type: number
    default: 0
    min: 0
    max: 6

  plugin_repositories_starred:
    description: |
      Featured most starred repositories
    type: number
    default: 0
    min: 0
    max: 100

  plugin_repositories_random:
    description: |
      Featured random repositories
    type: number
    default: 0
    min: 0
    max: 100

  plugin_repositories_order:
    description: |
      Featured repositories display order
    type: array
    values:
      - featured
      - pinned
      - starred
      - random
    default: featured, pinned, starred, random

  plugin_repositories_forks:
    description: |
      Include repositories forks
    type: boolean
    default: no

  plugin_repositories_affiliations:
    description: |
      Repositories affiliations

      - `owner`: owned repositories
      - `collaborator`: repositories with push access
      - `organization_member`: repositories from an organization where user is a member

      Set to `""` to disable and fetch all repositories related to given account.

      This option changes which repositories will be fetched by [`plugin_repositories_starred`](/source/plugins/projects/README.md#plugin_repositories_starred) and [`plugin_repositories_random`](/source/plugins/projects/README.md#plugin_repositories_random) options
    type: array
    format: comma-separated
    default: owner
    values:
      - owner
      - collaborator
      - organization_member
</file>

<file path="source/plugins/rss/examples.yml">
- name: News from hackernews
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.rss.svg
    token: NOT_NEEDED
    base: ""
    plugin_rss: yes
    plugin_rss_source: https://news.ycombinator.com/rss
    plugin_rss_limit: 4
</file>

<file path="source/plugins/rss/index.mjs">
//Imports
import rss from "rss-parser"

//Setup
export default async function({login, q, imports, data, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.rss) || (!imports.metadata.plugins.rss.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {source, limit} = imports.metadata.plugins.rss.inputs({data, account, q})
    if (!source)
      throw {error: {message: "RSS feed URL is not set"}}

    //Load rss feed
    const {title, description, link, items} = await (new rss()).parseURL(source) //eslint-disable-line new-cap
    const feed = items.map(({title, link, isoDate: date}) => ({title, link, date: new Date(date)}))

    //Limit feed
    if (limit > 0) {
      console.debug(`metrics/compute/${login}/plugins > rss > keeping only ${limit} items`)
      feed.splice(limit)
    }

    //Results
    return {source: title, description, link, feed}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/rss/metadata.yml">
name: üóº Rss feed
category: social
description: |
  This plugin displays news from a given RSS feed.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.rss.svg
index: 7
supports:
  - user
  - organization
  - repository
scopes: []
inputs:

  plugin_rss:
    description: |
      Enable rss plugin
    type: boolean
    default: no

  plugin_rss_source:
    description: |
      RSS feed source
    type: string
    default: ""
    example: https://news.ycombinator.com/rss

  plugin_rss_limit:
    description: |
      Display limit
    type: number
    default: 4
    min: 0
    max: 30
    zero: disable
</file>

<file path="source/plugins/skyline/index.mjs">
//Setup
export default async function({login, q, imports, data, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.skyline) || (!imports.metadata.plugins.skyline.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {year, frames, quality, compatibility, settings} = imports.metadata.plugins.skyline.inputs({data, account, q})
    if (Number.isNaN(year)) {
      year = new Date().getFullYear()
      console.debug(`metrics/compute/${login}/plugins > skyline > year set to ${year}`)
    }
    const width = 454 * (1 + data.large)
    const height = 284

    //Load settings (force default if extras is disabled)
    const {url, ready, wait, hide} = imports.metadata.plugins.skyline.extras("settings", {extras, error: false}) ? settings : JSON.parse(imports.metadata.plugins.skyline.inputs.settings.default)

    //Start puppeteer and navigate to skyline website
    console.debug(`metrics/compute/${login}/plugins > skyline > starting browser`)
    const browser = await imports.puppeteer.launch()
    console.debug(`metrics/compute/${login}/plugins > skyline > started ${await browser.version()}`)
    const page = await browser.newPage()
    await page.setViewport({width, height})

    //Load page
    if (!url)
      throw {error: {message: "Skyline URL is not set"}}
    console.debug(`metrics/compute/${login}/plugins > skyline > loading ${url.replaceAll("${login}", login).replaceAll("${year}", year)}`)
    await page.goto(url.replaceAll("${login}", login).replaceAll("${year}", year), {timeout: 90 * 1000})
    console.debug(`metrics/compute/${login}/plugins > skyline > waiting for initial render`)
    const frame = page.mainFrame()
    if (ready)
      await page.waitForFunction(ready.replaceAll("${login}", login).replaceAll("${year}", year), {timeout: 90 * 1000})
    if ((wait) && (wait > 0))
      await new Promise(solve => setTimeout(solve, wait * 1000))
    if (hide)
      await frame.evaluate(hide => [...document.querySelectorAll(hide)].map(element => element.style.display = "none"), hide)

    //Generate gif
    console.debug(`metrics/compute/${login}/plugins > skyline > generating frames`)
    const animation = compatibility ? await imports.record({page, width, height, frames, scale: quality}) : await imports.gif({page, width, height, frames, quality: Math.max(1, quality * 20)})

    //Close puppeteer
    await browser.close()

    //Results
    return {animation, width, height, compatibility}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/skyline/metadata.yml">
name: üåá GitHub Skyline
category: github
description: |
  This plugin displays the 3D commits calendar from [skyline.github.com](https://skyline.github.com/).
notes: |
  > ‚ö†Ô∏è This plugin significantly increase file size, consider using it as standalone.
examples:
  +GitHub Skyline: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.skyline.svg
  GitHub City: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.skyline.city.svg
index: 27
supports:
  - user
scopes: []
inputs:

  plugin_skyline:
    description: |
      Enable skyline plugin
    type: boolean
    default: no
    extras:
      - metrics.cpu.overuse
      - metrics.npm.optional.gifencoder
      - metrics.run.puppeteer.scrapping

  plugin_skyline_year:
    description: |
      Displayed year
    type: number
    default: current-year
    min: 2008

  plugin_skyline_frames:
    description: |
      Frames count

      Use 120 for a full-loop and 60 for a half-loop.
      A higher number of frames will increase file size.
    type: number
    default: 60
    min: 1
    max: 120

  plugin_skyline_quality:
    description: |
      Image quality

      A higher image quality will increase file size.
    type: number
    default: 0.5
    min: 0.1
    max: 1

  plugin_skyline_compatibility:
    description: |
      Compatibility mode

      This uses CSS animations rather than embedded GIF to support a wider range of browsers, like Firefox and Safari.
      Using this mode significantly increase file size as each frame is encoded separately
    type: boolean
    default: no

  plugin_skyline_settings:
    description: |
      Advanced settings

      Can be configured to use alternate skyline websites different from [skyline.github.com](https://skyline.github.com), such as [honzaap's GitHub City](https://github.com/honzaap/GithubCity).

      - `url`: Target URL (mandatory)
      - `ready`: Readiness condition (A JS function that returns a boolean)
      - `wait`: Time to wait after readiness condition is met (in seconds)
      - `hide`: HTML elements to hide (A CSS selector)

      For `url` and `ready` options, `${login}` and `${year}` will be respectively templated to user's login and specified year
    type: json
    default: |
      {
        "url": "https://skyline.github.com/${login}/${year}",
        "ready": "[...document.querySelectorAll('span')].map(span => span.innerText).includes('Share on Twitter')",
        "wait": 1,
        "hide": "button, footer, a"
      }
    extras:
      - metrics.run.puppeteer.user.js
</file>

<file path="source/plugins/sponsors/queries/active.graphql">
query SponsorsActive {
  $account(login: "$login") {
    sponsorshipsAsMaintainer($after first: 100) {
      edges {
        cursor
      }
      nodes {
        privacyLevel
        sponsorEntity {
          ... on User {
            login
            avatarUrl(size: $size)
          }
          ... on Organization {
            login
            avatarUrl(size: $size)
            url
          }
        }
        tier {
          monthlyPriceInDollars
        }
      }
    }
  }
}
</file>

<file path="source/plugins/sponsors/queries/all.graphql">
query SponsorsAll {
  $account(login: "$login") {
    sponsorsActivities($after first: 100, period: ALL) {
      edges {
        cursor
      }
      nodes {
        sponsor {
          ... on User {
            avatarUrl(size: $size)
            login
          }
          ... on Organization {
            login
            avatarUrl(size: $size)
            url
          }
        }
        sponsorsTier {
          monthlyPriceInDollars
        }
      }
    }
  }
}
</file>

<file path="source/plugins/sponsors/queries/description.graphql">
query SponsorsDescription {
  $account(login: "$login") {
    sponsorsListing {
      fullDescription
      activeGoal {
        percentComplete
        title
        description
      }
    }
  }
}
</file>

<file path="source/plugins/sponsors/examples.yml">
- name: Sponsors goal
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.sponsors.svg
    token: ${{ secrets.METRICS_TOKEN_PERSONAL }}
    base: ""
    plugin_sponsors: yes
    plugin_sponsors_sections: goal, list
    plugin_sponsors_past: yes

- name: Sponsors introduction
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.sponsors.full.svg
    token: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}
    base: ""
    plugin_sponsors: yes
</file>

<file path="source/plugins/sponsors/index.mjs">
//Setup
export default async function({login, q, imports, data, graphql, queries, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.sponsors) || (!imports.metadata.plugins.sponsors.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {size, sections, past, title} = await imports.metadata.plugins.sponsors.inputs({data, account, q})

    //Query description and goal
    console.debug(`metrics/compute/${login}/plugins > sponsors > querying sponsors and goal`)
    const {[account]: {sponsorsListing: {fullDescription, activeGoal}}} = await graphql(queries.sponsors.description({login, account}))
    const about = await imports.markdown(fullDescription, {mode: "multiline"})
    const goal = activeGoal ? {progress: activeGoal.percentComplete, title: activeGoal.title, description: await imports.markdown(activeGoal.description)} : null
    const count = {total: {count: 0, user: 0, organization: 0}, active: {total: 0, user: 0, organization: 0}, past: {total: 0, user: 0, organization: 0}}
    if (!goal)
      sections = sections.filter(section => section.name !== "goal")

    //Query active sponsors
    let list = []
    {
      const fetched = []
      let cursor = null
      let pushed = 0
      do {
        console.debug(`metrics/compute/${login}/sponsors > retrieving sponsors after ${cursor}`)
        const {[account]: {sponsorshipsAsMaintainer: {edges, nodes}}} = await graphql(queries.sponsors.active({login, account, after: cursor ? `after: "${cursor}"` : "", size: Math.round(size * 1.5)}))
        cursor = edges?.[edges?.length - 1]?.cursor
        fetched.push(...nodes)
        pushed = nodes.length
        console.debug(`metrics/compute/${login}/sponsors > retrieved ${pushed} sponsors after ${cursor}`)
      }
      while ((pushed) && (cursor))
      list.push(...fetched.map(({privacyLevel: privacy, sponsorEntity: {login, avatarUrl, url: organization = null}, tier}) => ({login, avatarUrl, type: organization ? "organization" : "user", amount: tier?.monthlyPriceInDollars ?? null, past: false, private: privacy === "PRIVATE"})))
      await Promise.all(list.map(async user => user.avatar = await imports.imgb64(user.avatarUrl)))
      count.active.total = list.length
      count.active.user = list.filter(user => user.type === "user").length
      count.active.organization = list.filter(user => user.type === "organization").length
    }

    //Query past sponsors
    if (past) {
      console.debug(`metrics/compute/${login}/plugins > sponsors > querying past sponsors`)
      const active = new Set(list.map(({login}) => login))
      const users = []
      {
        const fetched = []
        let cursor = null
        let pushed = 0
        do {
          console.debug(`metrics/compute/${login}/sponsors > retrieving sponsors events after ${cursor}`)
          const {[account]: {sponsorsActivities: {edges, nodes}}} = await graphql(queries.sponsors.all({login, account, after: cursor ? `after: "${cursor}"` : "", size: Math.round(size * 1.5)}))
          cursor = edges?.[edges?.length - 1]?.cursor
          fetched.push(...nodes)
          pushed = nodes.length
          console.debug(`metrics/compute/${login}/sponsors > retrieved ${pushed} sponsors events after ${cursor}`)
        }
        while ((pushed) && (cursor))
        users.push(...fetched.map(({sponsor: {login, avatarUrl, url: organization = null}, sponsorsTier}) => ({login, avatarUrl, type: organization ? "organization" : "user", amount: sponsorsTier?.monthlyPriceInDollars ?? null, past: true, private: false})))
      }
      for (const user of users) {
        if (!active.has(user.login)) {
          active.add(user.login)
          list.push({...user, avatar: await imports.imgb64(user.avatarUrl)})
          count.past.total++
          count.past[user.type]++
        }
      }
    }

    //Hide private sponsors avatars
    list.filter(user => user.private).map(user =>
      user.avatar =
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKgAAACoCAIAAAD7KTLjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAALk0lEQVR42u2dZ1diWRaG61dUMhMkKoqCoqAiZgyYMCAoCqglGEGUVhFREHNoqyvN/NbZNc7U1KrmXLEkXJh3refDdI/NZfGcs8/eJ91Xr4sE4P+QV/gJIB5APIB4APEA4gHEA4gHEA8gHkA8gHgA8QDiAcQDiAcQDyAeQDyAeADxAOIBxAOIh3gA8QDiAcQDiAcQDyAeQDyAeADxAOIBxAOIBxAPIB5APID4Z1BULhFIVLJqrUqj1zSbmo19xh5L18B4z6C1vXfYYDI3GDprG1rkNQ0iWU2xQPamWAjxeczbElF5ZZW8prGlc2DM5lpc2wlFL+I3X87//OcvJO6+hU/vvP79Kedyh3m0ur5ZKK15V1YJ8XkGddkKSbVa1zYyPe/fjyWVzcEf0Uvb/IqutVssVxew/lcFprxEIJPXNk7OLkUvPp7d/+NZyn8mdvPZubyh1XeUiZUUPCCe19YFUhUN3uH4zUuU/wwNAaPTCzT8vysVQzxPR3RJVf2My5cW3z9DbcjlDagb294XVtgvBPHUHSkj8/oP0m79Bxu7Ub3JXEjuXxVAX6dibPOP48xZf2T7IG7sHiqY8T7vxau0hrWdw9Tj9iNUwhFnxL//McX/fGvvxNBhLoxCP7/FK9VNbu92qpla/NbtCwxZZ6lYbzb2NbZ2GXss/aM2u8u3e3Se4oes70Q0ehPE55JycRVZpF77pC2PL6hp7igVyikboFhNUK8lHv83/cuiciml7lPOD4mnPu309qtrxV8uVkJ8zjCYzHsnV9yedg7PjN2WisrqJ8dmagdF5RLK3td2ImSX4zMP4rfU4CA+N1TVNS182OIenpfWdujPKBVPfVSm9iGQquzu1ePLvzgSBUryaxtaIT4HdJpHI4l7DuvT8yuSKs3vJeFlIoVlYi58esf68OjFR9v8CsRnG1m1dnZxnaO70/8rVqhfkn6XChUTdg+rbdGj/XsxCicQn1Wont6NnLOU0CBdqah7edFFmYHje8z/mPRBkbM/x2wuiM8eNGaP2hZY+dfJ1ae6pvY3aZpmqdMZN6jUS/Ygyv9ppKd8EOKzBNVdVFAllRG/+eLyBtI4sUpex2Zc1LmTPm7v+Cp/U7z8E69v79tiTNAenT80GDrT+ziN3kRjByva94/aID5LmEdsh8nybYq9lHAVV8jS+7gSgYyqu6QTO7HrzwsrfojPEla7J5FsgKfKe2puOTNNbfogdpO0qVHsgfgs7ZyccXlZgbd7YDwTD23pHPDvx1j7tPJ0rTbPxAulNc7lzaQOKP4bOvoz8VCtvmN1O5x8+jZ2I5SpID7jVCrrKG9nTaGnPbN7pEZjWN4IsR4qqaqH+IwjVqgXGLVcOH6ra+vOiHgth/gb+koQn3EEUhUz1Cfu2/uGsxzq92M3FZVVEJ9xSgRyh3s1+cLJ+cPQREZWS1u7BgP78aQPDUUv3ufn5F2eiX9bIrLa3UnPSMSvP7t925nYtT047jhMtlpzevt1LXiIci5L9A1PUUqVdHmGiquKyup07/NROpc2kq4Enlz+ZXf7ID5bG286+v17MdYyubHbkt7HNbZ0sdZpIon7XssUxGdt702zZzXI2hC3srVXLEjbrG1xhdRq9xwxFmkowGCRJnsUV8jGbAs0oic/83b9mUJCuna/Uz6/GYqyGpnXv/e+DMuyWYTS7GA4wbU3Rt30cveVyjoqHU8Ym+8OT+8Gx+zYiJHtJfm5xXWOrdCU3itqG1/iXiirmXZ+YK3En9192wwdU/OC+KzypkRk6h3eP7nm2Gw5t7Sh0hh+YwWF6jfq61b2hrvHBSH6A2y2zAHSao1twct9/sEXCD/3gHuJQEahwu0NnFx9Yn0sPdQXOKA/g/jc0NTWEzxMcB+oCEUvh6yzVAiUiUi/mKOXlwrllcr6zv6xwEE8cfeVY1P93vGVeWQaBypyRqlQ0WuZ5Dj58INg+HRker62sVUgUZWKFNSti8olBBUI5Lvi+1U5DeYR2/ZB/MkDlMeXHynS0KMhPseLdTTWpnjLDTURCtETDk//qK2jb8TYY+kbnqLKkDJBjsD+SwlHf0ytJN+tvy6AY9KKWp1nNch92i0t0NDu9e9T0lAA1l8Xxo0YlOi5vIFECsdmX2J9LXioa+0qDOuvC+YOHIr5rJ05aYGsN7YUjvUCEU85mr69j1KzzImnTH5w3E65IcTzZNOttKGla2Vrn8b4dF1xxqri6BFU6fUMTZSJFBCf22W6pvnlTUrIMzq6/6I/fvN5feeoydgL8bnZXW/sHvLvnZw+87rSdCV6FPmpDiwRyCA+izusFXXjM+6D2E3WOnrSrn90/rC4tqOs1UF8Nqiua3Yubx5fPu+eWhqeQ0fnVO6PTi909o8Zuy0/MPWODIzN0GdS/Hjudcf09/69WH1TO8Rn2LpG7+JcPvn7WXm3N0CmaxtaqNYXyWrLxMpigay4QvozpUKFUKqSKOsVtTqDyWxbWDk8vUuxYVHUCYYTmub2vLv8Lm/Eq7QG6rIpWj+I3044Fut0RrFcXfL93QOi1LMHagQqjWFw3EE5fCo5BDWR3ciZVt/xNq8uOs4P8dQXU5lRf+x/5KxG20L+fnsjBnXfcrFSqdZ1D1p92+FUWttO5Eyta8ujS67zQDzVzQ7P2vHFR+5utx+7HhizU2ctF1elK/CWCuXU5kj/RiiauHsi+PsCB5Kq+nyJ+XkgfsjqCMdvOQZdqq3Xgof69r4MXThJ+imSz3/Y4l4CPr39Mu38UCGphvg0QDqDhwmOyi16/jC/vFnb0JrRc+r04RT5rXYPx+V3/z2jby3Nh6k9XosXK9Sr22GOJVeKBJOzSxSNsxBg6RH0fWg0CUUvuC9RpSSf/4M9r8VTD+NIrKjzkfUsH08XSFX9ozbKJzjcU0bC/0PzPBVP3YuKsf2Ta9bQHr14sLt8MpU2+99NKKuxTMxF2clm5Oy+wzxKmQHEP9s6ZfLLGyHW0E7Bn2p6qtly9fUkVRru999QEUhpB58zfD6KpwHSYDJzTKBuho4Npv4cjqP0aPLKOkz5OJs7MDZTzuM7E/gonoIk6+qR/5xdGreX5fpVASUCmbF7iHXUhvD69/l8pPIVD7s7xXBWTnd2/825vEmVFR++KpXstvkVjqvNuwbGeXvZLe/EUxFstbtZv+Zu5Ly1c4AnxdLbElF1ffPe8SXz9nTPmlzVAPGpnlsLHV2wuvuEY5FXt0xRwB+ZcnI0U0pWID6lCTKtvoP1O1J1p2/v41WqTJ1eXtNwdP7AWjQaGLPz83YkfokvEykt1lmO907wMHIWV0hd3gBrvmFmwUsxDOKfmqOVq5fWd1m9p6t/nH5lfhafrCkHyu35uUWHX+IpXQ+f3jKuErzm5/Gl72+xllSzJvL2jq/ae4ch/gk4BniPL6jg685GGunXdyJJO/3p7dfBcQcP30jLL/HGHgtL/Oj0glBaw1vxE44l1lSj1eERSFUQz4V5ZJol3tQ7zMMB/ke0pybLmnRyuFd5OIXHL/HjMy6WeF1LN2/XPOiLqer1rGHe7dtu6xqCeC7sjAuKafjUNPP6Hc7l4irWvD0l9jy8GI1f4h2eVcaei1t1I9/vkNw9Ok9aza8FIzx8NSG/xH9/LXiy325pPcT/C0jcvkDS/G55I9QzZIV4zlMTGsPf3/dESZPB1F9ULuW5+NbOgcPEr1sxY1efRiadyOqfPsjSbOyNnN3/dDX4p46+kRKBnOfWHxmedB6d/2+kj99+mXAsimS1mMBJoSYuFYsV6vbe4aGJ2U7zmLRa+640b97vRQV9na7NMjHn8gYm55Y0ze28PUpdIHfgAIgHEA8gHkA8gHiIBxAPIB5APIB4APEA4gHEA4gHEA8gHkA8gHgA8QDiAcQDiAcQDyAeQDyAeADxAOIhHr8CxAOIBxAPIB5APIB4APEA4gHEA4gHEA8gHkA8gHgA8QDiAcQDiAcQDyAeMPkXNlCtrDZIMnkAAAAASUVORK5CYII="
    )

    //Update counters
    count.total.count = count.active.total + count.past.total
    count.total.user = count.active.user + count.past.user
    count.total.organization = count.active.organization + count.past.organization

    //Results
    list = list.sort((a, b) => a.private === b.private ? a.past === b.past ? b.amount - a.amount : a.past - b.past : a.private - b.private)
    return {sections, about, list, count, goal, size, past, title}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/sponsors/metadata.yml">
name: üíï GitHub Sponsors
category: github
description: |
  This plugin displays sponsors and introduction text from [GitHub sponsors](https://github.com/sponsors/).
examples:
  +GitHub sponsors card: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.sponsors.svg
  GitHub sponsors full introduction: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.sponsors.full.svg
index: 13
supports:
  - user
  - organization
  - repository
scopes:
  - read:user
  - read:org
inputs:

  plugin_sponsors:
    description: |
      Enable sponsors plugin
    type: boolean
    default: no

  plugin_sponsors_sections:
    description: |
      Displayed sections

      - `goal`: display GitHub active goal
      - `about`: display GitHub sponsors introduction
      - `list`: display GitHub sponsors list
    type: array
    format: comma-separated
    default: goal, list, about
    example: goal, list, about
    values:
      - goal
      - about
      - list

  plugin_sponsors_past:
    description: |
      Past sponsorships

      A [`token`](/source/plugins/core/README.md#token) from target [`user`](/source/plugins/core/README.md#user) must be specified to use this feature, as past sponsorships are gathered from sponsors activity which is private data.

      > ‚ö†Ô∏è Past sponsorships does not respect sponsors privacy because of current GitHub API limitations. This may be fixed in a future release.
    type: boolean
    default: no

  plugin_sponsors_size:
    description: |
      Profile picture display size
    type: number
    default: 24
    min: 8
    max: 64

  plugin_sponsors_title:
    description: |
      Title caption
    type: string
    default: Sponsor Me!
</file>

<file path="source/plugins/sponsorships/queries/all.graphql">
query SponsorshipsAll {
  $account(login: "$login") {
    sponsorshipsAsSponsor($after first: 100, activeOnly: false, orderBy: {field: CREATED_AT, direction: DESC}) {
      edges {
        cursor
      }
      nodes {
        createdAt
        isActive
        isOneTimePayment
        tier {
          name
        }
        privacyLevel
        sponsorable {
          ... on User {
            avatarUrl(size: $size)
            login
          }
          ... on Organization {
            login
            avatarUrl(size: $size)
            url
          }
        }
      }
    }
  }
}
</file>

<file path="source/plugins/sponsorships/queries/sponsorships.graphql">
query SponsorshipsDefault {
  $account(login: "$login") {
    totalSponsorshipAmountAsSponsorInCents
    sponsorshipsAsSponsor(first: 1, activeOnly: false, orderBy: {field: CREATED_AT, direction: ASC}) {
      nodes {
        createdAt
      }
    }
  }
}
</file>

<file path="source/plugins/sponsorships/examples.yml">
- name: üíù GitHub Sponsorships
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.sponsorships.svg
    token: ${{ secrets.METRICS_TOKEN_PERSONAL }}
    base: ""
    plugin_sponsorships: yes
</file>

<file path="source/plugins/sponsorships/index.mjs">
//Setup
export default async function({login, q, imports, data, graphql, queries, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.sponsorships) || (!imports.metadata.plugins.sponsorships.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {sections, size} = await imports.metadata.plugins.sponsorships.inputs({data, account, q})

    //Query description and goal
    let amount = NaN, image = null, started = null
    if (sections.includes("amount")) {
      console.debug(`metrics/compute/${login}/plugins > sponsorships > querying total amount spend`)
      const {totalSponsorshipAmountAsSponsorInCents, sponsorshipsAsSponsor} = (await graphql(queries.sponsorships({login, account})))[account]
      amount = totalSponsorshipAmountAsSponsorInCents / 100
      image = "https://github.githubassets.com/images/icons/emoji/hearts_around.png"
      started = sponsorshipsAsSponsor.nodes[0]?.createdAt ? new Date(sponsorshipsAsSponsor.nodes[0]?.createdAt) : null
    }
    image = await imports.imgb64(image)

    //Query sponsorships
    const list = []
    if (sections.includes("sponsorships")) {
      console.debug(`metrics/compute/${login}/plugins > sponsorships > querying sponsorships`)
      {
        const fetched = []
        let cursor = null
        let pushed = 0
        do {
          console.debug(`metrics/compute/${login}/sponsorships > retrieving sponsorships after ${cursor}`)
          const {[account]: {sponsorshipsAsSponsor: {edges, nodes}}} = await graphql(queries.sponsorships.all({login, account, after: cursor ? `after: "${cursor}"` : "", size: Math.round(size * 1.5)}))
          cursor = edges?.[edges?.length - 1]?.cursor
          fetched.push(...nodes)
          pushed = nodes.length
          console.debug(`metrics/compute/${login}/sponsorships > retrieved ${pushed} sponsorships events after ${cursor}`)
        }
        while ((pushed) && (cursor))
        list.push(...fetched.map(({sponsorable: {login, avatarUrl, url: organization = null}, tier: {name: tier}, privacyLevel: privacy, isActive: active}) => ({login, avatarUrl, type: organization ? "organization" : "user", tier, private: privacy !== "PUBLIC", past: !active})))
      }
      await Promise.all(list.map(async user => user.avatar = await imports.imgb64(user.avatarUrl)))
    }

    //Results
    return {amount, list, sections, size, image, started}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/sponsorships/metadata.yml">
name: üíù GitHub Sponsorships
category: github
description: |
  This plugin displays sponsorships funded through [GitHub sponsors](https://github.com/sponsors/).
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.sponsorships.svg
index: 12
supports:
  - user
  - organization
scopes:
  - read:user
  - read:org
inputs:

  plugin_sponsorships:
    description: |
      Enable sponsorships plugin
    type: boolean
    default: no

  plugin_sponsorships_sections:
    description: |
      Displayed sections

      - `amount`: display total amount sponsored
      - `sponsorships`: display GitHub sponsorships
    type: array
    format: comma-separated
    default: amount, sponsorships
    example: amount, sponsorships
    values:
      - amount
      - sponsorships

  plugin_sponsorships_size:
    description: |
      Profile picture display size
    type: number
    default: 24
    min: 8
    max: 64
</file>

<file path="source/plugins/stackoverflow/examples.yml">
- name: Top answers from stackoverflow
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.stackoverflow.svg
    token: NOT_NEEDED
    base: ""
    plugin_stackoverflow: yes
    plugin_stackoverflow_user: 1
    plugin_stackoverflow_sections: answers-top
    plugin_stackoverflow_limit: 2
</file>

<file path="source/plugins/stackoverflow/index.mjs">
//Setup
export default async function({login, q, imports, data, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.stackoverflow) || (!imports.metadata.plugins.stackoverflow.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {sections, user, limit, lines, "lines.snippet": codelines} = imports.metadata.plugins.stackoverflow.inputs({data, account, q})
    if (!user)
      throw {error: {message: "Stack Overflow user id is not set"}}

    //Initialization
    //See https://api.stackexchange.com/docs
    const api = {base: "https://api.stackexchange.com/2.2", user: `https://api.stackexchange.com/2.2/users/${user}`}
    const filters = {user: "!0Z-LvgkLYnTCu1858)*D0lcx2", answer: "!7goY5TLWwCz.BaGpe)tv5C6Bks2q8siMH6", question: "!)EhwvzgX*hrClxjLzqxiZHHbTPRE5Pb3B9vvRaqCx5-ZY.vPr"}
    const result = {sections, lines}

    //Stackoverflow user metrics
    {
      //Account metrics
      console.debug(`metrics/compute/${login}/plugins > stackoverflow > querying api for user ${user}`)
      const {data: {items: [{reputation, badge_counts: {bronze, silver, gold}, answer_count: answers, question_count: questions, view_count: views}]}} = await imports.axios.get(`${api.user}?site=stackoverflow&filter=${filters.user}`)
      const {data: {total: comments}} = await imports.axios.get(`${api.user}/comments?site=stackoverflow&filter=total`)
      //Save result
      result.user = {id: user, reputation, badges: bronze + silver + gold, questions, answers, comments, views}
    }

    //Answers
    for (const {key, sort} of [{key: "answers-recent", sort: "sort=activity&order=desc"}, {key: "answers-top", sort: "sort=votes&order=desc"}].filter(({key}) => sections.includes(key))) {
      //Load and format answers
      console.debug(`metrics/compute/${login}/plugins > stackoverflow > querying api for ${key}`)
      const {data: {items}} = await imports.axios.get(`${api.user}/answers?site=stackoverflow&pagesize=${limit}&filter=${filters.answer}&${sort}`)
      result[key] = await Promise.all(items.map(item => format.answer(item, {imports, codelines})))
      console.debug(`metrics/compute/${login}/plugins > stackoverflow > loaded ${result[key].length} items`)
      //Load related questions
      const ids = result[key].map(({question_id}) => question_id).filter(id => id)
      if (ids) {
        console.debug(`metrics/compute/${login}/plugins > stackoverflow > loading ${ids.length} related items`)
        const {data: {items}} = await imports.axios.get(`${api.base}/questions/${ids.join(";")}?site=stackoverflow&filter=${filters.question}`)
        await Promise.all(items.map(item => format.question(item, {imports, codelines})))
      }
    }

    //Questions
    for (const {key, sort} of [{key: "questions-recent", sort: "sort=activity&order=desc"}, {key: "questions-top", sort: "sort=votes&order=desc"}].filter(({key}) => sections.includes(key))) {
      //Load and format questions
      console.debug(`metrics/compute/${login}/plugins > stackoverflow > querying api for ${key}`)
      const {data: {items}} = await imports.axios.get(`${api.user}/questions?site=stackoverflow&pagesize=${limit}&filter=${filters.question}&${sort}`)
      result[key] = await Promise.all(items.map(item => format.question(item, {imports, codelines})))
      console.debug(`metrics/compute/${login}/plugins > stackoverflow > loaded ${result[key].length} items`)
      //Load related answers
      const ids = result[key].map(({accepted_answer_id}) => accepted_answer_id).filter(id => id)
      if (ids) {
        console.debug(`metrics/compute/${login}/plugins > stackoverflow > loading ${ids.length} related items`)
        const {data: {items}} = await imports.axios.get(`${api.base}/answers/${ids.join(";")}?site=stackoverflow&filter=${filters.answer}`)
        await Promise.all(items.map(item => format.answer(item, {imports, codelines})))
      }
    }

    //Results
    return result
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}

//Formatters
const format = {
  /**Cached */
  cached: new Map(),
  /**Format stackoverflow code snippets */
  code(text) {
    return text.replace(/<!-- language: lang-(?<lang>\w+) -->\s*(?<snippet> {4}[\s\S]+?)(?=(?:<!-- end snippet -->)|(?:<!-- language: lang-))/g, "```$<lang>\n$<snippet>```")
  },
  /**Format answers */
  async answer({body_markdown: body, score, up_vote_count: upvotes, down_vote_count: downvotes, is_accepted: accepted, comment_count: comments = 0, creation_date, owner: {display_name: author}, link, answer_id: id, question_id}, {imports, codelines}) {
    const formatted = {
      type: "answer",
      body: await imports.markdown(format.code(imports.htmlunescape(body)), {codelines}),
      score,
      upvotes,
      downvotes,
      accepted,
      comments,
      author,
      created: imports.format.date(creation_date * 1000, {date: true}),
      link,
      id,
      question_id,
      get question() {
        return format.cached.get(`q${this.question_id}`) ?? null
      },
    }
    this.cached.set(`a${id}`, formatted)
    return formatted
  },
  /**Format questions */
  async question(
    {
      title,
      body_markdown: body,
      score,
      up_vote_count: upvotes,
      down_vote_count: downvotes,
      favorite_count: favorites,
      tags,
      is_answered: answered,
      answer_count: answers,
      comment_count: comments = 0,
      view_count: views,
      creation_date,
      owner: {display_name: author},
      link,
      question_id: id,
      accepted_answer_id = null,
    },
    {imports, codelines},
  ) {
    const formatted = {
      type: "question",
      title: await imports.markdown(title),
      body: await imports.markdown(format.code(imports.htmlunescape(body)), {codelines}),
      score,
      upvotes,
      downvotes,
      favorites,
      tags,
      answered,
      answers,
      comments,
      views,
      author,
      created: imports.format.date(creation_date * 1000, {date: true}),
      link,
      id,
      accepted_answer_id,
      get answer() {
        return format.cached.get(`a${this.accepted_answer_id}`) ?? null
      },
    }
    this.cached.set(`q${id}`, formatted)
    return formatted
  },
}
</file>

<file path="source/plugins/stackoverflow/metadata.yml">
name: üó®Ô∏è Stack Overflow
category: social
description: |
  This plugin displays stats, questions and answer from [Stack Overflow](https://stackoverflow.com/).
disclaimer: |
  This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with [Stack Overflow](https://stackoverflow.com/).
  All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stackoverflow.svg
index: 3
supports:
  - user
  - organization
scopes: []
inputs:

  plugin_stackoverflow:
    description: |
      Enable stackoverflow plugin
    type: boolean
    default: no

  plugin_stackoverflow_user:
    description: |
      Stackoverflow user id
    type: number
    default: 0
    preset: no

  plugin_stackoverflow_sections:
    description: |
      Displayed sections

      - `answers-top`: display most popular answers
      - `answers-recent`: display recent answers
      - `questions-top`: display most popular questions
      - `questions-recent`: display recent questions
    type: array
    format: comma-separated
    default: answers-top, questions-recent
    values:
      - answers-top
      - answers-recent
      - questions-top
      - questions-recent

  plugin_stackoverflow_limit:
    description: |
      Display limit (entries per section)
    type: number
    default: 2
    min: 1
    max: 30

  plugin_stackoverflow_lines:
    description: |
      Display limit (lines per questions and answers)

      Code snippets count as a single line and must be configured with [`plugin_stackoverflow_lines_snippet`](/source/plugins/stackoverflow/README.md#plugin_stackoverflow_lines_snippet) instead
    type: number
    default: 4
    min: 0
    zero: disable

  plugin_stackoverflow_lines_snippet:
    description: |
      Display limit (lines per code snippets)
    type: number
    default: 2
    min: 0
    zero: disable
</file>

<file path="source/plugins/stargazers/queries/stargazers.graphql">
query StargazersDefault {
  repository(name: "$repository", owner: "$login") {
    stargazers($after first: 100, orderBy: {field: STARRED_AT, direction: ASC}) {
      edges {
        starredAt
        cursor
        $location
      }
    }
  }
}
</file>

<file path="source/plugins/stargazers/worldmap/atlas/LICENSE.md">
See license at [npmjs.com/package/visionscarto-world-atlas](https://www.npmjs.com/package/visionscarto-world-atlas)
</file>

<file path="source/plugins/stargazers/worldmap/index.mjs">
//Imports
import { Client as Gmap } from "@googlemaps/google-maps-services-js"
import color from "color"
import * as d3 from "d3"
import { D3node } from "../../../app/metrics/utils.mjs"

/**
 * Worldmap
 * Mostly ported from https://github.com/dyatko/worldstar
 * License: https://raw.githubusercontent.com/dyatko/worldstar/master/LICENSE
 */
export default async function(login, {locations, sample, imports, token}) {
  //Parse geocodes
  let stars = new Map()
  if (token) {
    const cache = new Map()
    const get = new Gmap()
    locations = imports.shuffle(locations.filter(string => string).map(string => string.toLocaleLowerCase())).slice(0, sample || Infinity)
    for (const location of locations) {
      console.debug(`metrics/compute/${login}/plugins > stargazers > worldmap > looking for ${location}`)
      if (!cache.has(location)) {
        try {
          const {data: {results}} = await get.geocode({params: {address: location, key: token}})
          const country = results.at(0).address_components.find(({types}) => types.includes("country"))
          cache.set(location, country.short_name ?? country.long_name)
          console.debug(`metrics/compute/${login}/plugins > stargazers > worldmap > ${location} resolved to ${cache.get(location)}`)
        }
        catch (error) {
          console.debug(`metrics/compute/${login}/plugins > stargazers > worldmap > failed to resolve ${location}: ${error}`)
        }
      }
      const code = cache.get(location)
      stars.set(code, (stars.get(code) ?? 0) + 1)
    }
  }
  else {
    throw {error: {message: "Google Maps API token is not set"}}
  }

  //Generate SVG
  const d3n = new D3node()
  const svg = d3n.createSVG(480, 315)
  const countries = JSON.parse(await imports.fs.readFile(imports.paths.join(imports.__module(import.meta.url), "atlas/50m_countries.geojson")))
  const geopath = d3.geoPath(d3.geoMercator().fitWidth(svg.attr("width"), countries))
  const splits = [...new Set([0, ...stars.values()])].sort((a, b) => a - b)
  svg
    .append("g")
    .selectAll("path")
    .data(countries.features)
    .join("path")
    .attr("id", ({id}) => id)
    .style("fill", ({properties: {iso_a2, wb_a2, sov_a3}}) => {
      const code = iso_a2?.match(/[A-Z]{2}/) ? iso_a2 : wb_a2?.match(/[A-Z]{2}/) ? wb_a2 : sov_a3?.substr(0, 2) ?? ""
      const value = stars.get(code)
      return color("#216e39").mix(color("#ffffff"), 1 - Math.max(0, splits.indexOf(value)) / splits.length).hex()
    })
    .style("stroke", "#afafaf")
    .style("stroke-width", "0.6px")
    .attr("d", geopath)

  return d3n.svgString()
}
</file>

<file path="source/plugins/stargazers/examples.yml">
- name: Using classic charts
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.stargazers.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_stargazers: yes

- name: Using graph charts
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.stargazers.graph.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_stargazers: yes
    plugin_stargazers_charts_type: graph

- name: With worldmap
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.stargazers.worldmap.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_stargazers: yes
    plugin_stargazers_charts: no
    plugin_stargazers_worldmap: yes
    plugin_stargazers_worldmap_token: ${{ secrets.GOOGLE_MAP_TOKEN }}
    plugin_stargazers_worldmap_sample: 200
</file>

<file path="source/plugins/stargazers/index.mjs">
//Setup
export default async function({login, graphql, data, imports, q, queries, account}, {enabled = false, extras = false, "worldmap.token": _worldmap_token} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.stargazers) || (!imports.metadata.plugins.stargazers.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {days, charts: _charts, "charts.type": _charts_type, worldmap: _worldmap, "worldmap.sample": _worldmap_sample} = imports.metadata.plugins.stargazers.inputs({data, account, q})
    if (!days) {
      days = Math.abs(parseInt((new Date() - new Date(data.user.createdAt)) / 1000 / 60 / 60 / 24))
      console.debug(`metrics/compute/${login}/plugins > stargazers > set days to ${days}`)
    }

    //Retrieve stargazers from graphql api
    console.debug(`metrics/compute/${login}/plugins > stargazers > querying api`)
    const repositories = data.user.repositories.nodes.map(({name: repository, owner: {login: owner}}) => ({repository, owner})) ?? []
    const dates = []
    const locations = []
    for (const {repository, owner} of repositories) {
      //Iterate through stargazers
      console.debug(`metrics/compute/${login}/plugins > stargazers > retrieving stargazers of ${repository}`)
      let cursor = null
      let pushed = 0
      do {
        console.debug(`metrics/compute/${login}/plugins > stargazers > retrieving stargazers of ${repository} after ${cursor}`)
        const {repository: {stargazers: {edges}}} = await graphql(queries.stargazers({login: owner, repository, after: cursor ? `after: "${cursor}"` : "", location: _worldmap ? "node { location }" : ""}))
        cursor = edges?.[edges?.length - 1]?.cursor
        dates.push(...edges.map(({starredAt}) => new Date(starredAt)))
        if (_worldmap)
          locations.push(...edges.map(({node: {location}}) => location))
        pushed = edges.length
      }
      while ((pushed) && (cursor))
      console.debug(`metrics/compute/${login}/plugins > stargazers > loaded ${dates.length} stargazers for ${repository}`)
    }
    console.debug(`metrics/compute/${login}/plugins > stargazers > loaded ${dates.length} stargazers in total`)

    //Compute stargazers increments
    const increments = {dates: Object.fromEntries([...new Array(days).fill(null).map((_, i) => [new Date(Date.now() - i * 24 * 60 * 60 * 1000).toISOString().slice(0, 10), 0]).reverse()]), max: NaN, min: NaN}
    dates
      .map(date => date.toISOString().slice(0, 10))
      .filter(date => date in increments.dates)
      .map(date => increments.dates[date]++)
    increments.min = Math.min(...Object.values(increments.dates))
    increments.max = Math.max(...Object.values(increments.dates))

    //Compute total stargazers
    let {stargazers} = data.computed.repositories
    const total = {dates: {...increments.dates}, max: NaN, min: NaN}
    {
      const dates = Object.keys(total.dates)
      for (let i = dates.length - 1; i >= 0; i--) {
        const date = dates[i], tomorrow = dates[i + 1]
        stargazers -= increments.dates[tomorrow] ?? 0
        total.dates[date] = stargazers
      }
    }
    total.min = Math.min(...Object.values(total.dates))
    total.max = Math.max(...Object.values(total.dates))

    //Months name
    const months = ["", "Jan.", "Feb.", "Mar.", "Apr.", "May", "June", "July", "Aug.", "Sep.", "Oct.", "Nov.", "Dec."]

    //Generating charts
    let charts = _charts ? true : null
    if ((["graph", "chartist"].includes(_charts_type)) && (imports.metadata.plugins.stargazers.extras("charts.type", {extras}))) {
      console.debug(`metrics/compute/${login}/plugins > stargazers > generating charts`)
      charts = await Promise.all(
        [{data: total, low: total.min, high: total.max}, {data: increments, low: 0, high: increments.max, sign: true}].map(({data: {dates: set}, low, high, sign = false}) =>
          imports.Graph.timeline(Object.entries(set).map(([x, y]) => ({x: new Date(x), y, text: imports.format(y, {sign})})), {low, high, match: (data, ticks) => data.filter(([x]) => ticks.map(t => t.toISOString().slice(0, 10)).includes(x.toISOString().slice(0, 10)))})
        ),
      )
    }

    //Generating worldmap
    let worldmap = null
    if ((_worldmap) && (imports.metadata.plugins.stargazers.extras("worldmap", {extras}))) {
      const {default: generate} = await import("./worldmap/index.mjs")
      worldmap = await generate(login, {locations, imports, token: _worldmap_token, sample: _worldmap_sample})
    }

    //Results
    return {total, increments, months, charts, worldmap, days}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/stargazers/metadata.yml">
name: ‚ú® Stargazers
category: github
description: |
  This plugin displays stargazers evolution across affiliated repositories.
examples:
  +classic charts: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stargazers.svg
  graph charts: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stargazers.graph.svg
  +worldmap: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stargazers.worldmap.svg
index: 2
supports:
  - user
  - organization
  - repository
scopes:
  - public_access
inputs:

  plugin_stargazers:
    description: |
      Enable stargazers plugin
    type: boolean
    default: no

  plugin_stargazers_days:
    description: |
      Time range

      If set to `0` the account registration date will be used.
    type: number
    min: 0
    zero: see description
    default: 14

  plugin_stargazers_charts:
    description: |
      Charts

      It includes total number of stargazers evolution, along with the number of new stars per day over the last two weeks.
    type: boolean
    default: yes

  plugin_stargazers_charts_type:
    description: |
      Charts display type

      - `classic`: `<div>` based charts, simple and lightweight
      - `graph`: `<svg>` based charts, smooth

      > ‚ö†Ô∏è `chartist` option has been deprecated and is now equivalent to `graph`
    type: string
    default: classic
    values:
      - classic
      - graph
      - chartist
    extras:
      - metrics.npm.optional.d3

  plugin_stargazers_worldmap:
    description: |
      Stargazers worldmap
    type: boolean
    default: no
    extras:
      - metrics.api.google.maps
      - metrics.npm.optional.d3

  plugin_stargazers_worldmap_token:
    description: |
      Stargazers worldmap token
    type: token
    default: ""

  plugin_stargazers_worldmap_sample:
    description: |
      Stargazers worldmap sample

      Use this setting to randomly sample and limit your stargazers.
      Helps to avoid consuming too much Google Geocoding API requests while still being representative.
    type: number
    default: 0
    min: 0
    zero: disable
</file>

<file path="source/plugins/starlists/examples.yml">
- name: Featured star list
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.starlists.svg
    token: NOT_NEEDED
    base: ""
    plugin_starlists: yes
    plugin_starlists_limit_repositories: 2
    plugin_starlists_only: TC39
  test:
    timeout: 1800000

- name: Featured star list languages
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.starlists.languages.svg
    token: NOT_NEEDED
    base: ""
    plugin_starlists: yes
    plugin_starlists_languages: yes
    plugin_starlists_limit_languages: 8
    plugin_starlists_limit_repositories: 0
    plugin_starlists_only: Awesome
  test:
    timeout: 1800000
</file>

<file path="source/plugins/starlists/index.mjs">
//Setup
export default async function({login, q, imports, data, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.starlists) || (!imports.metadata.plugins.starlists.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {limit, ignored, only, "limit.repositories": _limit, languages, "limit.languages": _limit_languages, "languages.ignored": _languages_ignored, "languages.aliases": _languages_aliases, "shuffle.repositories": _shuffle} = imports.metadata.plugins.starlists.inputs({data, account, q})
    ignored = ignored.map(imports.stripemojis)
    only = only.map(imports.stripemojis)
    _languages_aliases = Object.fromEntries(_languages_aliases.split(",").filter(alias => /^[\s\S]+:[\s\S]+$/.test(alias)).map(alias => alias.trim().split(":")).map(([key, value]) => [key.toLocaleLowerCase(), value]))

    //Start puppeteer and navigate to star lists
    console.debug(`metrics/compute/${login}/plugins > starlists > starting browser`)
    const browser = await imports.puppeteer.launch()
    console.debug(`metrics/compute/${login}/plugins > starlists > started ${await browser.version()}`)
    const page = await browser.newPage()

    //Fetch star lists
    console.debug(`metrics/compute/${login}/plugins > starlists > fetching lists`)
    await page.goto(`https://github.com/${login}?tab=stars`)
    let lists = await page.evaluate(login =>
      [...document.querySelectorAll(`[href^='/stars/${login}/lists']`)].map(element => ({
        link: element.href,
        name: element.querySelector("h3")?.innerText ?? "",
        description: element.querySelector("span")?.innerText ?? "",
        count: Number(element.querySelector("div")?.innerText.match(/(?<count>\d+)/)?.groups.count),
        repositories: [],
      })), login)
    const count = lists.length
    console.debug(`metrics/compute/${login}/plugins > starlists > found [${lists.map(({name}) => name)}]`)
    lists = lists
      .filter(({name}) => {
        name = imports.stripemojis(name ?? "").trim().toLocaleLowerCase()
        if (only.length)
          return only.includes(name)
        return !ignored.includes(name)
      })
      .slice(0, limit)
    console.debug(`metrics/compute/${login}/plugins > starlists > extracted ${lists.length} lists`)

    //Compute lists content
    const colors = {}
    for (const list of lists) {
      //Fetch star list content
      console.debug(`metrics/compute/${login}/plugins > starlists > fetching ${list.name}`)
      const repositories = []
      for (let i = 1; i <= (languages ? 100 : 1); i++) {
        console.debug(`metrics/compute/${login}/plugins > starlists > fetching page ${i}`)
        await page.goto(`${list.link}?page=${i}`)
        repositories.push(
          ...await page.evaluate(() =>
            [...document.querySelectorAll("#user-list-repositories > div:not(.paginate-container)")].map(element => ({
              name: element.querySelector("div:first-child")?.innerText.replace(" / ", "/") ?? "",
              description: element.querySelector(".py-1")?.innerText ?? "",
              language: {
                name: element.querySelector("[itemprop='programmingLanguage']")?.innerText ?? "",
                color: element.querySelector(".repo-language-color")?.style?.backgroundColor?.match(/\d+/g)?.map(x => Number(x).toString(16).padStart(2, "0")).join("") ?? null,
              },
              stargazers: Number(element.querySelector("[href$='/stargazers']")?.innerText.trim().replace(/[^\d]/g, "") ?? NaN),
              forks: Number(element.querySelector("[href$='/network/members']")?.innerText.trim().replace(/[^\d]/g, "") ?? NaN),
            }))
          ),
        )
        if (!(await page.evaluate(() => document.querySelector(".next_page"))) || await page.evaluate(() => document.querySelector(".next_page.disabled"))) {
          console.debug(`metrics/compute/${login}/plugins > starlists > reached last page`)
          break
        }
      }
      list.repositories.push(...repositories)
      if (_shuffle)
        list.repositories = imports.shuffle(list.repositories)

      //Compute languages statistics
      if (languages) {
        list.languages = {}
        for (const {language: {name, color}} of repositories) {
          let lang = name
          if (lang && lang.toLocaleLowerCase() in _languages_aliases)
            lang = _languages_aliases[name.toLocaleLowerCase()]
          if (lang)
            list.languages[lang] = (list.languages[lang] ?? 0) + 1
          if (color)
            colors[lang] = color
        }
        list.languages = Object.entries(list.languages).filter(([name]) => !_languages_ignored.includes(name.toLocaleLowerCase())).sort((a, b) => b[1] - a[1]).slice(0, _limit_languages || Infinity)
        const visible = list.languages.map(([_, value]) => value).reduce((a, b) => a + b, 0)
        list.languages = list.languages.map(([name, value]) => ({name, value, color: name in colors ? `#${colors[name]}` : null, x: 0, p: value / visible}))
        for (let i = 1; i < list.languages.length; i++)
          list.languages[i].x = (list.languages[i - 1]?.x ?? 0) + (list.languages[i - 1]?.value ?? 0) / visible
      }

      //Limit repositories
      list.repositories = list.repositories.slice(0, _limit)
    }

    //Close browser
    console.debug(`metrics/compute/${login}/plugins > starlists > closing browser`)
    await browser.close()

    //Results
    return {lists, count}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/starlists/metadata.yml">
name: üí´ Star lists
category: github
description: |
  This plugin displays star lists.
examples:
  +repositories from star lists: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.starlists.svg
  +languages from star lists: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.starlists.languages.svg
index: 16
supports:
  - user
scopes: []
inputs:

  plugin_starlists:
    description: |
      Enable starlists plugin
    type: boolean
    default: no
    extras:
      - metrics.run.puppeteer.scrapping

  plugin_starlists_limit:
    description: |
      Display limit (star lists)
    type: number
    default: 2
    min: 1
    max: 100

  plugin_starlists_limit_repositories:
    description: |
      Display limit (repositories per star list)
    type: number
    default: 2
    min: 0
    max: 100

  plugin_starlists_languages:
    description: |
      Star lists languages statistics
    type: boolean
    default: no

  plugin_starlists_limit_languages:
    description: |
      Display limit (languages per star list)
    type: number
    default: 8
    min: 0
    zero: disable
  
  plugin_starlists_languages_ignored:
    description: |
      Ignored languages in star lists
    type: array
    format: comma-separated
    default: ""
    example: html, css, ...
  
  plugin_starlists_languages_aliases:
    description: |
      Custom languages names in star lists
    type: string
    default: ""
    example: javascript:JS, typescript:TS

  plugin_starlists_shuffle_repositories:
    description: |
      Shuffle data

      Can be used to create varied outputs
    type: boolean
    default: yes

  plugin_starlists_ignored:
    description: |
      Skipped star lists

      Case and emojis insensitive
    type: array
    format: comma-separated
    default: ""
    example: üòé list1, ü•≥ list2, ...

  plugin_starlists_only:
    description:  |
      Showcased star lists

      Case and emojis insensitive.

      Equivalent to [`plugin_starlists_ignored`](/source/plugins/starlists/README.md#plugin_starlists_ignored) with all star lists except the ones listed in this option
    type: array
    format: comma-separated
    default: ""
    example: üòé list1, ü•≥ list2, ...
</file>

<file path="source/plugins/stars/queries/stars.graphql">
query StarsDefault {
  user(login: "$login") {
    starredRepositories(first: $limit, orderBy: {field: STARRED_AT, direction: DESC}) {
      edges {
        starredAt
        node {
          description
          forkCount
          isFork
          issues {
            totalCount
          }
          nameWithOwner
          openGraphImageUrl
          licenseInfo {
            nickname
            spdxId
            name
          }
          pullRequests {
            totalCount
          }
          stargazerCount
          primaryLanguage {
            color
            name
          }
        }
      }
    }
  }
}
</file>

<file path="source/plugins/stars/examples.yml">
- name: Recently starred
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.stars.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_stars: yes
    plugin_stars_limit: 3
</file>

<file path="source/plugins/stars/index.mjs">
//Setup
export default async function({login, data, graphql, q, queries, imports, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.stars) || (!imports.metadata.plugins.stars.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {limit} = imports.metadata.plugins.stars.inputs({data, account, q})

    //Retrieve user stars from graphql api
    console.debug(`metrics/compute/${login}/plugins > stars > querying api`)
    const {user: {starredRepositories: {edges: repositories}}} = await graphql(queries.stars({login, limit}))

    //Format starred repositories
    for (const edge of repositories) {
      //Format date
      const time = (Date.now() - new Date(edge.starredAt).getTime()) / (24 * 60 * 60 * 1000)
      let updated = new Date(edge.starredAt).toDateString().substring(4)
      if (time < 1)
        updated = `${Math.ceil(time * 24)} hour${Math.ceil(time * 24) >= 2 ? "s" : ""} ago`
      else if (time < 30)
        updated = `${Math.floor(time)} day${time >= 2 ? "s" : ""} ago`
      edge.starred = updated
    }

    //Results
    return {repositories}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/stars/metadata.yml">
name: üåü Recently starred repositories
category: github
description: |
  This plugin displays recently starred repositories.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stars.svg
index: 5
supports:
  - user
scopes:
  - public_access
inputs:

  plugin_stars:
    description: |
      Enable stars plugin
    type: boolean
    default: no

  plugin_stars_limit:
    description: |
      Display limit
    type: number
    default: 4
    min: 1
    max: 100
</file>

<file path="source/plugins/steam/index.mjs">
//Setup
export default async function({login, q, imports, data, account}, {token, enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.steam) || (!imports.metadata.plugins.steam.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {user, sections, "games.ignored": _games_ignored, "games.limit": _games_limit, "recent.games.limit": _recent_games_limit, "achievements.limit": _achievements_limit, "playtime.threshold": _playtime_threshold} = imports.metadata.plugins.steam.inputs({data, account, q})

    const urls = {
      games: {
        owned: `https://api.steampowered.com/IPlayerService/GetOwnedGames/v0001/?key=${token}&steamid=${user}&format=json&include_appinfo=1`,
        schema: `https://api.steampowered.com/ISteamUserStats/GetSchemaForGame/v0002/?key=${token}&format=json`,
        details: "https://store.steampowered.com/api/appdetails?",
      },
      player: {
        summary: `https://api.steampowered.com/ISteamUser/GetPlayerSummaries/v0002/?key=${token}&steamids=${user}&format=json`,
        level: `https://api.steampowered.com/IPlayerService/GetSteamLevel/v1/?key=${token}&steamid=${user}&format=json`,
        achievement: `https://api.steampowered.com/ISteamUserStats/GetPlayerAchievements/v0001/?key=${token}&steamid=${user}&format=json&l=en`,
      },
    }
    const result = {sections, player: null, games: {count: 0, playtime: 0, achievements: 0}}

    //Fetch owned games
    console.debug(`metrics/compute/${login}/plugins > steam > fetching owned games`)
    let {data: {response: {game_count: count, games}}} = await imports.axios.get(urls.games.owned)
    result.games.count = count
    result.games.playtime = games.reduce((total, {playtime_forever: playtime}) => (total += playtime), 0) / 60

    //Fetch game achievements and order games by section
    for (const section of ["most-played", "recently-played"]) {
      if (!sections.includes(section))
        continue
      result.games[section] = await Promise.all(
        games
          .map(({appid: id, name, img_icon_url: icon, playtime_forever: playtime, rtime_last_played: played}) => ({id, name, icon: `http://media.steampowered.com/steamcommunity/public/images/apps/${id}/${icon}.jpg`, playtime: playtime / 60, played}))
          .filter(({playtime}) => (playtime >= _playtime_threshold))
          .filter(({id}) => (!_games_ignored.includes(`${id}`)))
          .sort((a, b) => ({"most-played": (b.playtime - a.playtime), "recently-played": (b.played - a.played)}[section]))
          .slice(0, ({"most-played": _games_limit, "recently-played": _recent_games_limit}[section]) || Infinity)
          .map(async game => {
            const schema = {}
            try {
              console.debug(`metrics/compute/${login}/plugins > steam > fetching schema for "${game.name}" (${game.id})`)
              const {data: {game: {availableGameStats: {achievements = []} = {}}}} = await imports.axios.get(`${urls.games.schema}&appid=${game.id}`)
              Object.assign(schema, Object.fromEntries(achievements.map(({name, icon}) => [name, {icon}])))
            }
            catch (error) {
              console.debug(`metrics/compute/${login}/plugins > steam > failed to get schema for "${game.name}" (${game.id}) > ${error}`)
            }
            const about = {}
            try {
              console.debug(`metrics/compute/${login}/plugins > steam > fetching details for "${game.name}" (${game.id})`)
              const {data: {[game.id]: {data}}} = await imports.axios.get(`${urls.games.details}&appids=${game.id}`)
              about.description = data.short_description ?? ""
              about.genres = data.genres?.map(({description}) => description) ?? []
            }
            catch (error) {
              console.debug(`metrics/compute/${login}/plugins > steam > failed to get details for "${game.name}" (${game.id}) > ${error}`)
            }

            let achievements = []
            const rate = {total: Object.keys(schema).length, achieved: 0}
            try {
              console.debug(`metrics/compute/${login}/plugins > steam > fetching player achievements "${game.name}" (${game.id})`)
              let {data: {playerstats: {achievements: list = []}}} = await imports.axios.get(`${urls.player.achievement}&appid=${game.id}`)
              achievements = await Promise.all(list.map(async ({apiname: id, achieved, unlocktime: unlocked, name, description}) => ({icon: await imports.imgb64(schema[id]?.icon ?? null, {width: 32, height: 32}), achieved: !!achieved, unlocked, name, description, id})))
              achievements = achievements.sort((a, b) => (b.unlocked - a.unlocked))
              rate.achieved = achievements.filter(({achieved}) => achieved).length
              achievements = achievements.slice(0, _achievements_limit)
            }
            catch (error) {
              console.debug(`metrics/compute/${login}/plugins > steam > failed to get player achievements for "${game.name}" (${game.id}) > ${error}`)
            }
            return {...game, ...about, icon: await imports.imgb64(game.icon, {width: 64, height: 64}), achievements, rate}
          }),
      )
    }

    //Fetch player info
    if (sections.includes("player")) {
      console.debug(`metrics/compute/${login}/plugins > steam > fetching profile info`)
      let {data: {response: {players: [info]}}} = await imports.axios.get(urls.player.summary)
      console.debug(`metrics/compute/${login}/plugins > steam > fetching profile level`)
      const {data: {response: {player_level: level}}} = await imports.axios.get(urls.player.level)
      result.player = {
        level,
        avatar: await imports.imgb64(info.avatar, {width: 64, height: 64}),
        created: info.timecreated,
        name: info.personaname,
      }
    }

    //Results
    return result
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/steam/metadata.yml">
name: üïπÔ∏è Steam
category: social
description: |
  This plugin can display your player profile and played games from your Steam account.
disclaimer: |
  This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with [Steam](https://store.steampowered.com).
  All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.
examples:
  +Recently played games: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.steam.svg
  Profile and detailed game history: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.steam.full.svg
supports:
  - user
  - organization
scopes: []
inputs:

  plugin_steam:
    description: |
      Enable steam plugin
    type: boolean
    default: no

  plugin_steam_token:
    description: |
      Steam token
    type: token
    default: ""
    extras:
      - metrics.api.steam

  plugin_steam_sections:
    description: |
      Displayed sections

      - `player`: display profile
      - `most-played`: display most played games
      - `recently-played`: display recently played games
    type: array
    format: comma-separated
    default: player, most-played, recently-played
    options:
      - player
      - most-played
      - recently-played

  plugin_steam_user:
    description: |
      Steam user id

      This can be found on your Steam user account details
    type: string
    preset: no

  plugin_steam_games_ignored:
    description: |
      Ignored games

      Use App id as they are referenced in Steam catalog
    type: array
    format: comma-separated
    default: ""
    example: 400, 620 

  plugin_steam_games_limit:
    description: |
      Display limit (Most played games)
    type: number
    min: 0
    zero: disable
    default: 1

  plugin_steam_recent_games_limit:
    description: |
      Display limit (Recently played games)
    type: number
    min: 0
    zero: disable
    default: 1

  plugin_steam_achievements_limit:
    description: |
      Display limit (Games achievements)
    type: number
    min: 0
    default: 2

  plugin_steam_playtime_threshold:
    description: |
      Display threshold (Game playtime in hours)
    type: number
    min: 0
    default: 2
</file>

<file path="source/plugins/support/examples.yml">
- name: GitHub Community Support
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.support.svg
    token: NOT_NEEDED
    base: ""
    plugin_support: yes
  prod:
    skip: true
  test:
    skip: true
</file>

<file path="source/plugins/support/index.mjs">
//Setup
export default async function({login, q, imports, data, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.support) || (!imports.metadata.plugins.support.enabled(enabled, {extras})))
      return null

    //Load inputs
    imports.metadata.plugins.stackoverflow.inputs({data, account, q})

    //Start puppeteer and navigate to github.community
    const result = {stats: {solutions: 0, posts: 0, topics: 0, received: 0}, badges: {count: 0}}
    console.debug(`metrics/compute/${login}/plugins > support > starting browser`)
    const browser = await imports.puppeteer.launch()
    console.debug(`metrics/compute/${login}/plugins > support > started ${await browser.version()}`)
    const page = await browser.newPage()

    //Check account existence
    {
      await page.goto(`https://github.community/u/${login}`)
      const frame = page.mainFrame()
      try {
        await frame.waitForSelector(".user-profile-names", {timeout: 5000})
      }
      catch {
        throw {error: {message: "Account does not exists on github.community"}}
      }
    }

    //Stats
    {
      await page.goto(`https://github.community/u/${login}/summary`)
      const frame = page.mainFrame()
      await frame.waitForSelector(".stats-section")
      Object.assign(
        result.stats,
        Object.fromEntries(
          (await frame.evaluate(() =>
            [...document.querySelectorAll(".stats-section li")].map(el => [
              el.querySelector(".label").innerText.trim().toLocaleLowerCase(),
              el.querySelector(".value").innerText.trim().toLocaleLowerCase(),
            ])
          )).map(([key, value]) => {
            switch (true) {
              case /solutions?/.test(key):
                return ["solutions", Number(value)]
              case /posts? created/.test(key):
                return ["posts", Number(value)]
              case /topics? created/.test(key):
                return ["topics", Number(value)]
              case /received/.test(key):
                return ["hearts", Number(value)]
              default:
                return null
            }
          }).filter(kv => kv),
        ),
      )
    }

    //Badges
    {
      await page.goto(`https://github.community/u/${login}/badges`)
      const frame = page.mainFrame()
      await frame.waitForSelector(".badge-group-list")
      const badges = await frame.evaluate(() => ({
        uniques: [...document.querySelectorAll(".badge-card .badge-link")].map(el => el.innerText),
        multiples: [...document.querySelectorAll(".grant-count")].map(el => Number(el.innerText)),
      }))
      badges.count = badges.uniques.length + (badges.multiples.reduce((a, b) => a + b, 0) - badges.multiples.length)
      result.badges = badges
    }

    //Close browser
    console.debug(`metrics/compute/${login}/plugins > support > closing browser`)
    await browser.close()

    //Results
    return result
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/support/metadata.yml">
name: üí≠ GitHub Community Support
category: github
description: |
  This plugin displays statistics from a [GitHub Support Community](https://github.community/) account.
deprecation: |
  GitHub Support Community has been moved to [GitHub Discussions](https://github.blog/2022-07-26-launching-github-community-powered-by-github-discussions).
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.support.svg
supports:
  - user
scopes: []
inputs:

  plugin_support:
    description: |
      Enable support plugin
    type: boolean
    default: no
    extras:
      - metrics.run.puppeteer.scrapping
</file>

<file path="source/plugins/topics/examples.yml">
- name: Labels
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.topics.svg
    token: NOT_NEEDED
    base: ""
    plugin_topics: yes
    plugin_topics_limit: 12

- name: Icons
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.topics.icons.svg
    token: NOT_NEEDED
    base: ""
    plugin_topics: yes
    plugin_topics_limit: 0
    plugin_topics_mode: icons
</file>

<file path="source/plugins/topics/index.mjs">
//Setup
export default async function({login, data, imports, q, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.topics) || (!imports.metadata.plugins.topics.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {sort, mode, limit} = imports.metadata.plugins.topics.inputs({data, account, q})
    const type = {starred: "labels", labels: "labels", mastered: "icons", icons: "icons"}[mode]
    const shuffle = sort === "random"

    //Start puppeteer and navigate to topics
    console.debug(`metrics/compute/${login}/plugins > topics > searching starred topics`)
    let topics = []
    console.debug(`metrics/compute/${login}/plugins > topics > starting browser`)
    const browser = await imports.puppeteer.launch()
    console.debug(`metrics/compute/${login}/plugins > topics > started ${await browser.version()}`)
    const page = await browser.newPage()

    //Iterate through pages
    for (let i = 1; i <= 100; i++) {
      //Load page
      console.debug(`metrics/compute/${login}/plugins > topics > loading page ${i}`)
      await page.goto(`https://github.com/stars/${login}/topics?direction=desc&page=${i}&sort=${sort}`)
      const frame = page.mainFrame()
      //Extract topics
      await Promise.race([frame.waitForSelector("ul.repo-list"), frame.waitForSelector(".blankslate")])
      const starred = await frame.evaluate(() =>
        [...document.querySelectorAll("ul.repo-list li")].map(li => ({
          name: li.querySelector(".f3").innerText,
          description: li.querySelector(".f5").innerText,
          icon: li.querySelector("img")?.src ?? null,
          url: li.querySelector("a")?.href ?? null,
        }))
      )
      console.debug(`metrics/compute/${login}/plugins > topics > extracted ${starred.length} starred topics`)
      //Check if next page exists
      if (!starred.length) {
        console.debug(`metrics/compute/${login}/plugins > topics > no more page to load`)
        break
      }
      topics.push(...starred)
    }

    //Close browser
    console.debug(`metrics/compute/${login}/plugins > topics > closing browser`)
    await browser.close()

    //Shuffle topics
    if (shuffle) {
      console.debug(`metrics/compute/${login}/plugins > topics > shuffling topics`)
      topics = imports.shuffle(topics)
    }

    //Limit topics (labels)
    if ((type === "labels") && (limit > 0)) {
      console.debug(`metrics/compute/${login}/plugins > topics > keeping only ${limit} topics`)
      const removed = topics.splice(limit)
      if (removed.length)
        topics.push({name: `And ${removed.length} more...`, description: removed.map(({name}) => name).join(", "), icon: null})
    }

    //Convert icons to base64
    console.debug(`metrics/compute/${login}/plugins > topics > loading artworks`)
    for (const topic of topics) {
      if (topic.icon) {
        console.debug(`metrics/compute/${login}/plugins > topics > processing ${topic.name}`)
        const {icon} = topic
        topic.icon = await imports.imgb64(icon)
        topic.icon24 = await imports.imgb64(icon, {force: true, width: 24, height: 24})
      }
      //Escape HTML description
      topic.description = imports.htmlescape(topic.description)
    }

    //Limit topics (icons)
    if ((type === "icons") && (limit > 0)) {
      console.debug(`metrics/compute/${login}/plugins > topics > filtering topics with icon`)
      topics = topics.filter(({icon}) => icon)
      console.debug(`metrics/compute/${login}/plugins > topics > keeping only ${limit} topics`)
      topics.splice(limit)
    }

    //Results
    return {mode, type, list: topics}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/topics/metadata.yml">
name: üìå Starred topics
category: github
description: |
  This plugin displays [starred topics](https://github.com/stars?filter=topics).

  Check out [GitHub topics](https://github.com/topics) to search interesting topics.
examples:
  +with icons: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.topics.icons.svg
  +with labels: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.topics.svg
index: 4
supports:
  - user
scopes: []
inputs:

  plugin_topics:
    description: |
      Enable topics plugin
    type: boolean
    default: no
    extras:
      - metrics.run.puppeteer.scrapping

  plugin_topics_mode:
    description: |
      Display mode

      - `labels`: display labels
      - `icons`: display icons *(topics without icons will not be displayed)*
      - `starred`: alias for `labels`
      - `mastered`: alias for `icons`
    type: string
    default: starred
    values:
      - labels
      - icons
      - starred
      - mastered

  plugin_topics_sort:
    description: |
      Sorting method

      - `stars`: sort by most stars
      - `activity`: sort by recent activity
      - `starred`: sort by starred date
      - `random`: sort randomly
    type: string
    default: stars
    values:
      - stars
      - activity
      - starred
      - random

  plugin_topics_limit:
    description: |
      Display limit
    type: number
    default: 15
    min: 0
    max: 20
    zero: disable
</file>

<file path="source/plugins/traffic/examples.yml">
- name: Repositories traffic
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.traffic.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: repositories
    plugin_traffic: yes
  prod:
    with:
      token: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}
</file>

<file path="source/plugins/traffic/index.mjs">
//Setup
export default async function({login, imports, data, rest, q, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.traffic) || (!imports.metadata.plugins.traffic.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {skipped} = imports.metadata.plugins.traffic.inputs({data, account, q})
    skipped.push(...data.shared["repositories.skipped"])

    //Repositories
    const repositories = data.user.repositories.nodes.map(({name: repo, owner: {login: owner}}) => ({repo, owner})) ?? []

    //Get views stats from repositories
    console.debug(`metrics/compute/${login}/plugins > traffic > querying api`)
    const views = {count: 0, uniques: 0}
    const promised = [...await Promise.allSettled(repositories.map(({repo, owner}) => imports.filters.repo(`${owner}/${repo}`, skipped) ? rest.repos.getViews({owner, repo}) : {}))]
    const response = promised.filter(({status}) => status === "fulfilled").map(({value}) => value)

    //Handle error if all promises were rejected
    const rejected = promised.filter(({status}) => status === "rejected")
    if (rejected.length === promised.length) {
      if (promised.map(({reason}) => reason.message).every(error => /must have push access to repository/i.test(error)))
        throw {error: {message: "Insufficient token scopes"}}
      throw new Error(promised[0].reason.message)
    }
    else if (rejected.length) {
      rejected.map(({reason}) => console.debug(`metrics/compute/${login}/plugins > traffic > warn > ${reason.message}`))
    }

    //Compute views
    console.debug(`metrics/compute/${login}/plugins > traffic > computing stats`)
    response.filter(({data}) => data).map(({data: {count, uniques}}) => (views.count += count, views.uniques += uniques))

    //Results
    return {views}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error, {descriptions: {"403": "Insufficient token scopes"}})
  }
}
</file>

<file path="source/plugins/traffic/metadata.yml">
name: üßÆ Repositories traffic
category: github
description: |
  This plugin displays the number of page views across affiliated repositories.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.traffic.svg
index: 22
supports:
  - user
  - organization
  - repository
scopes:
  - repo
inputs:

  plugin_traffic:
    description: |
      Enable traffic plugin
    type: boolean
    default: no

  plugin_traffic_skipped:
    description: |
      Skipped repositories
    type: array
    format: 
      - newline-separated
      - comma-separated
    default: ""
    example: my-repo-1, my-repo-2, owner/repo-3, ...
    inherits: repositories_skipped
</file>

<file path="source/plugins/tweets/index.mjs">
//Setup
export default async function({login, imports, data, q, account}, {enabled = false, token = "", extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.tweets) || (!imports.metadata.plugins.tweets.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {limit, user: username, attachments} = imports.metadata.plugins.tweets.inputs({data, account, q})

    //Load user profile
    console.debug(`metrics/compute/${login}/plugins > tweets > loading twitter profile (@${username})`)
    const {data: {data: profile = null}} = await imports.axios.get(`https://api.twitter.com/2/users/by/username/${username}?user.fields=profile_image_url,verified`, {headers: {Authorization: `Bearer ${token}`}})

    //Load profile image
    if (profile?.profile_image_url) {
      console.debug(`metrics/compute/${login}/plugins > tweets > loading profile image`)
      profile.profile_image = await imports.imgb64(profile.profile_image_url)
    }

    //Load tweets
    console.debug(`metrics/compute/${login}/plugins > tweets > querying api`)
    const {data: {data: tweets = [], includes: {media = []} = {}}} = await imports.axios.get(
      `https://api.twitter.com/2/tweets/search/recent?query=from:${username}&tweet.fields=created_at,entities&media.fields=preview_image_url,url,type&expansions=entities.mentions.username,attachments.media_keys`,
      {headers: {Authorization: `Bearer ${token}`}},
    )
    const medias = new Map(media.map(({media_key, type, url, preview_image_url}) => [media_key, (type === "photo") || (type === "animated_gif") ? url : type === "video" ? preview_image_url : null]))

    //Limit tweets
    if (limit > 0) {
      console.debug(`metrics/compute/${login}/plugins > tweets > keeping only ${limit} tweets`)
      tweets.splice(limit)
    }

    //Format tweets
    await Promise.all(tweets.map(async tweet => {
      //Mentions and urls
      tweet.mentions = tweet.entities?.mentions?.map(({username}) => username) ?? []
      tweet.urls = new Map(tweet.entities?.urls?.map(({url, display_url: link}) => [url, link]) ?? [])
      //Attachments
      if (attachments) {
        //Retrieve linked content
        let linked = null
        if (tweet.urls.size) {
          linked = [...tweet.urls.keys()][tweet.urls.size - 1]
          tweet.text = tweet.text.replace(new RegExp(`(?:${linked})$`), "")
        }
        //Medias
        if (tweet.attachments)
          tweet.attachments = await Promise.all(tweet.attachments.media_keys.filter(key => medias.get(key)).map(key => medias.get(key)).map(async url => ({image: await imports.imgb64(url, {height: -1, width: 450})})))
        if (linked) {
          try {
            const {result: {ogImage, ogSiteName: website, ogTitle: title, ogDescription: description}} = await imports.opengraph({url: linked})
            const image = await imports.imgb64(ogImage?.url, {height: -1, width: 450, fallback: false})
            if (image) {
              if (tweet.attachments)
                tweet.attachments.unshift([{image, title, description, website}])
              else
                tweet.attachments = [{image, title, description, website}]
            }
            else {
              tweet.text = `${tweet.text}\n${linked}`
            }
          }
          catch (error) {
            console.debug(`metrics/compute/${login}/plugins > tweets > error while retrieving linked content: ${error.message}`)
          }
        }
      }
      else {
        tweet.attachments = null
      }

      //Format text
      console.debug(`metrics/compute/${login}/plugins > tweets > formatting tweet ${tweet.id}`)
      tweet.createdAt = `${imports.format.date(tweet.created_at, {time: true})} on ${imports.format.date(tweet.created_at, {date: true})}`
      tweet.text = imports.htmlescape(
        //Escape tags
        imports.htmlescape(tweet.text, {"<": true, ">": true})
          //Mentions
          .replace(new RegExp(`@(${tweet.mentions.join("|")})`, "gi"), '<span class="mention">@$1</span>')
          //Hashtags (this regex comes from the twitter source code)
          .replace(
            /(?<!&)[#|ÔºÉ]([a-z0-9_\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u00ff\u0100-\u024f\u0253-\u0254\u0256-\u0257\u0300-\u036f\u1e00-\u1eff\u0400-\u04ff\u0500-\u0527\u2de0-\u2dff\ua640-\ua69f\u0591-\u05bf\u05c1-\u05c2\u05c4-\u05c5\u05d0-\u05ea\u05f0-\u05f4\ufb12-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4f\u0610-\u061a\u0620-\u065f\u066e-\u06d3\u06d5-\u06dc\u06de-\u06e8\u06ea-\u06ef\u06fa-\u06fc\u0750-\u077f\u08a2-\u08ac\u08e4-\u08fe\ufb50-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\u200c-\u200c\u0e01-\u0e3a\u0e40-\u0e4e\u1100-\u11ff\u3130-\u3185\ua960-\ua97f\uac00-\ud7af\ud7b0-\ud7ff\uffa1-\uffdc\u30a1-\u30fa\u30fc-\u30fe\uff66-\uff9f\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\u3041-\u3096\u3099-\u309e\u3400-\u4dbf\u4e00-\u9fff\u20000-\u2a6df\u2a700-\u2b73f\u2b740-\u2b81f\u2f800-\u2fa1f]*[a-z_\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u00ff\u0100-\u024f\u0253-\u0254\u0256-\u0257\u0300-\u036f\u1e00-\u1eff\u0400-\u04ff\u0500-\u0527\u2de0-\u2dff\ua640-\ua69f\u0591-\u05bf\u05c1-\u05c2\u05c4-\u05c5\u05d0-\u05ea\u05f0-\u05f4\ufb12-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4f\u0610-\u061a\u0620-\u065f\u066e-\u06d3\u06d5-\u06dc\u06de-\u06e8\u06ea-\u06ef\u06fa-\u06fc\u0750-\u077f\u08a2-\u08ac\u08e4-\u08fe\ufb50-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\u200c-\u200c\u0e01-\u0e3a\u0e40-\u0e4e\u1100-\u11ff\u3130-\u3185\ua960-\ua97f\uac00-\ud7af\ud7b0-\ud7ff\uffa1-\uffdc\u30a1-\u30fa\u30fc-\u30fe\uff66-\uff9f\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\u3041-\u3096\u3099-\u309e\u3400-\u4dbf\u4e00-\u9fff\u20000-\u2a6df\u2a700-\u2b73f\u2b740-\u2b81f\u2f800-\u2fa1f][a-z0-9_\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u00ff\u0100-\u024f\u0253-\u0254\u0256-\u0257\u0300-\u036f\u1e00-\u1eff\u0400-\u04ff\u0500-\u0527\u2de0-\u2dff\ua640-\ua69f\u0591-\u05bf\u05c1-\u05c2\u05c4-\u05c5\u05d0-\u05ea\u05f0-\u05f4\ufb12-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4f\u0610-\u061a\u0620-\u065f\u066e-\u06d3\u06d5-\u06dc\u06de-\u06e8\u06ea-\u06ef\u06fa-\u06fc\u0750-\u077f\u08a2-\u08ac\u08e4-\u08fe\ufb50-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\u200c-\u200c\u0e01-\u0e3a\u0e40-\u0e4e\u1100-\u11ff\u3130-\u3185\ua960-\ua97f\uac00-\ud7af\ud7b0-\ud7ff\uffa1-\uffdc\u30a1-\u30fa\u30fc-\u30fe\uff66-\uff9f\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\u3041-\u3096\u3099-\u309e\u3400-\u4dbf\u4e00-\u9fff\u20000-\u2a6df\u2a700-\u2b73f\u2b740-\u2b81f\u2f800-\u2fa1f]*)/gi,
            ' <span class="hashtag">#$1</span> ',
          )
          //Line breaks
          .replace(/\n/g, "<br/>")
          //Links
          .replace(new RegExp(`${tweet.urls.size ? "" : "noop^"}(${[...tweet.urls.keys()].map(url => `(?:${url})`).join("|")})`, "gi"), (_, url) => `<a href="${url}" class="link">${tweet.urls.get(url)}</a>`),
        {"&": true},
      )
    }))

    //Result
    return {username, profile, list: tweets}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/wakatime/examples.yml">
- name: WakaTime
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.wakatime.svg
    token: NOT_NEEDED
    base: ""
    plugin_wakatime: yes
    plugin_wakatime_sections: time, projects, projects-graphs, languages, languages-graphs, editors, os
    plugin_wakatime_token: ${{ secrets.WAKATIME_TOKEN }}
  prod:
    # ‚ö†Ô∏è Using mocked data because I don't really use WakaTime
    with:
      plugin_wakatime_token: MOCKED_TOKEN
      use_mocked_data: yes
</file>

<file path="source/plugins/wakatime/index.mjs">
//Setup
export default async function({login, q, imports, data, account}, {enabled = false, token, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.wakatime) || (!imports.metadata.plugins.wakatime.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {sections, days, limit, url, user, "languages.other": others, "languages.ignored": _ignored, "repositories.visibility": repositoriesVisibility} = imports.metadata.plugins.wakatime.inputs({data, account, q})

    if (!limit)
      limit = void limit

    const showOnlyGitHubPublicRepos = repositoriesVisibility === "public"

    const range = {
      "7": "last_7_days",
      "30": "last_30_days",
      "180": "last_6_months",
      "365": "last_year",
    }[days] ?? "last_7_days"
    console.debug(`metrics/compute/${login}/plugins > wakatime > range: ${range}`)

    //Querying api and format result (https://wakatime.com/developers#stats)
    console.debug(`metrics/compute/${login}/plugins > wakatime > querying api`)
    const {data: {data: stats}} = await imports.axios.get(`${url}/api/v1/users/${user}/stats/${range}?api_key=${token}`)

    const projectStats = stats.projects?.map(({name, percent, total_seconds: total}) => ({name, percent: percent / 100, total})).sort((a, b) => b.percent - a.percent)
    const projects = showOnlyGitHubPublicRepos ? await pickOnlyGitHubPublicRepos({limit, login, axios: imports.axios, projects: projectStats}) : projectStats?.slice(0, limit)

    const result = {
      sections,
      days,
      projects,
      time: {
        total: (others ? stats.total_seconds_including_other_language : stats.total_seconds) / (60 * 60),
        daily: (others ? stats.daily_average_including_other_language : stats.daily_average) / (60 * 60),
      },
      languages: stats.languages?.map(({name, percent, total_seconds: total}) => ({name, percent: percent / 100, total})).filter(({name}) => imports.filters.text(name, _ignored)).sort((a, b) => b.percent - a.percent).slice(0, limit),
      os: stats.operating_systems?.map(({name, percent, total_seconds: total}) => ({name, percent: percent / 100, total})).sort((a, b) => b.percent - a.percent).slice(0, limit),
      editors: stats.editors?.map(({name, percent, total_seconds: total}) => ({name, percent: percent / 100, total})).sort((a, b) => b.percent - a.percent).slice(0, limit),
    }

    //Result
    return result
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}

async function pickOnlyGitHubPublicRepos({projects, axios, login, limit}) {
  const result = []

  for await (const project of projects) {
    if (result.length >= limit)
      break
    try {
      console.debug(`metrics/compute/${login}/plugins > wakatime > checking 'https://github.com/${login}/${project.name}'`)
      await axios.head(`https://github.com/${login}/${project.name}`)

      result.push(project)
    }
    catch {
      continue
    }
  }

  if (result.length === 0)
    return undefined
  return result
}
</file>

<file path="source/plugins/wakatime/metadata.yml">
name: ‚è∞ WakaTime
category: social
description: |
  This plugin displays statistics from a [WakaTime](https://wakatime.com) account.

  It is also compatible with self-hosted instances from [wakapi](https://github.com/muety/wakapi).
disclaimer: |
  This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with [WakaTime](https://wakatime.com).
  All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.wakatime.svg
index: 8
supports:
  - user
scopes: []
inputs:

  plugin_wakatime:
    description: |
      Enable wakatime plugin
    type: boolean
    default: no

  plugin_wakatime_token:
    description: |
      WakaTime API token
    type: token
    default: ""

  plugin_wakatime_url:
    description: |
      WakaTime URL

      Can be used to specify a [wakapi](https://github.com/muety/wakapi) instance
    type: string
    default: https://wakatime.com

  plugin_wakatime_user:
    description: |
      WakaTime username
    type: string
    default: current
    preset: no

  plugin_wakatime_sections:
    description: |
      Displayed sections

      - `time`: show total coding time and daily average
      - `projects`: show most time spent project
      - `projects-graphs`: show most time spent projects graphs
      - `languages`: show most used language
      - `languages-graphs`: show languages graphs
      - `editors`: show most used code editor
      - `editors-graphs`: show code editors graphs
      - `os`: show most used operating system
      - `os-graphs`: show operating systems graphs
    type: array
    values:
      - time
      - projects
      - projects-graphs
      - languages
      - languages-graphs
      - editors
      - editors-graphs
      - os
      - os-graphs
    default: time, projects, projects-graphs, languages, languages-graphs, editors, os

  plugin_wakatime_days:
    description: |
      Time range
    type: string
    values:
      - "7"
      - "30"
      - "180"
      - "365"
    default: 7

  plugin_wakatime_limit:
    description: |
      Display limit (entries per graph)
    type: number
    default: 5
    min: 0
    zero: disable

  plugin_wakatime_languages_other:
    description: |
      Other languages
    type: boolean
    default: no

  plugin_wakatime_languages_ignored:
    description: |
      Ignored languages
    type: array
    format: comma-separated
    default: ""
    example: html, css, ...

  plugin_wakatime_repositories_visibility:
    description: |
      Repositories visibility

      Can be used to toggle private activity visibility
    type: string
    default: all
    values:
      - public
      - all
</file>

<file path="source/templates/classic/examples.yml">
- name: Example
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.classic.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: header, repositories
    plugin_lines: yes
</file>

<file path="source/templates/classic/metadata.yml">
name: üìó Classic template
description: |
  A template mimicking GitHub visual identity.
  This is also the default template.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.classic.svg
index: 0
supports:
  - user
  - organization
formats:
  - svg
  - png
  - jpeg
  - json
</file>

<file path="source/templates/classic/template.mjs">
/**Template processor */
export default async function(_, __, {imports}) {
  //Core
  await imports.plugins.core(...arguments)
}
</file>

<file path="source/templates/community/examples.yml">
- name: Using a community template
  uses: lowlighter/metrics@latest
  with:
    token: ${{ secrets.METRICS_TOKEN }}
    template: "@classic"
    setup_community_templates: "lowlighter/metrics@master:classic"
  test:
    modes:
      - action

- name: Using a trusted community template
  uses: lowlighter/metrics@latest
  with:
    token: ${{ secrets.METRICS_TOKEN }}
    template: "@terminal"
    setup_community_templates: "lowlighter/metrics@master:terminal+trust"
  test:
    modes:
      - action
</file>

<file path="source/templates/community/metadata.yml">
name: üìï Community templates
description: |
  A template mimicking GitHub visual identity.
  This is also the default template.
</file>

<file path="source/templates/community/README.md">
<table>
  <tr><th colspan="2"><h3>üìï Community templates</h3></th></tr>
  <tr><td colspan="2" align="center">

  Community templates are a way to use official releases of [lowlighter/metrics](https://github.com/lowlighter/metrics) while using templates from external repositories (owned or not).

  </td></tr>
</table>

## üìÆ Using community templates

Use `setup_community_templates` option to specify additional external sources using following format:
```
user/repo@branch:template
```

These templates will be downloaded through git and will be usable by prefixing their name with an `@`.

*Example: using `my-theme` template by downloading it from `user/repo`*
```yml
- uses: lowlighter/metrics@latest
  with:
    template: "@my-theme"
    setup_community_templates: "user/repo@main:my-theme"
```

For security reasons, community templates will use the `classic` template `template.mjs` instead of their own.
If you trust a community template, append `+trust` to it.

*Example: using and trusting `my-theme` template by downloading it from `user/repo`*
```yml
- uses: lowlighter/metrics@latest
  with:
    template: "@my-theme"
    setup_community_templates: "user/repo@main:my-theme+trust"
```

> ‚ö†Ô∏è Note that it basically allow remote code execution and the template may have access to **sensitive data** along with **tokens**! Use this feature only from a trusted source. Remember that its content may also change at any time...

Some templates may accept additional custom parameters that can be passed through the `query` option, using a JSON formatted string.

*Example: using and trusting `my-theme` template by downloading it from `user/repo`*
```yaml
- uses: lowlighter/metrics@latest
  with:
    template: "@my-theme"
    query: |
      {
        "header_color": "#FF0000"
      }
```

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Using a community template
uses: lowlighter/metrics@latest
with:
  token: ${{ secrets.METRICS_TOKEN }}
  template: "@classic"
  setup_community_templates: lowlighter/metrics@master:classic

```
```yaml
name: Using a trusted community template
uses: lowlighter/metrics@latest
with:
  token: ${{ secrets.METRICS_TOKEN }}
  template: "@terminal"
  setup_community_templates: lowlighter/metrics@master:terminal+trust

```
<!--/examples-->

## üì™ Creating community templates

Templates creation requires you to be comfortable with HTML, CSS and [EJS](https://github.com/mde/ejs).

### üí¨ Quick-start

To create a new template, clone and setup this repository first:
```shell
git clone https://github.com/lowlighter/metrics.git
cd metrics/
npm install
```

Find a cool name for your new template and run the following:
```shell
npm run quickstart template <template_name>
```

It will create a new directory in `/source/templates` with the following file structure:
* `/source/templates/{template-name}`
  * `README.md`
  * `metadata.yml`
  * `image.svg`
  * `partials/`
    * `_.json`
    * `*.ejs`

Templates are auto-loaded based on their folder existence, so there's no need to register them somewhere.

### üí¨ Understanding `image.svg`

Usually `image.svg` doesn't need to be edited too much, but let's explain it how it works.

```html
<svg xmlns="http://www.w3.org/2000/svg" width="480" height="99999" class="<%= !animated ? 'no-animations' : '' %>">

  <defs><style><%= fonts %></style></defs>
  <style data-optimizable="true"><%= style %></style>

  <foreignObject x="0" y="0" width="100%" height="100%">
    <div xmlns="http://www.w3.org/1999/xhtml" xmlns:xlink="http://www.w3.org/1999/xlink">
      <% for (const partial of [...partials]) { %>
        <%- await include(`partials/${partial}.ejs`) %>
      <% } %>

      <div id="metrics-end"></div>
    </div>
  </foreignObject>

</svg>
```

#### ‚ÑπÔ∏è EJS syntax

[EJS](https://github.com/mde/ejs) framework is used to programmatically create content through the help of templating tags (`<% %>`).

#### ‚ÑπÔ∏è Styling

`fonts` and `style` variables are respectively populated with `fonts.css` and `styles.css` files content (or will fallback to those of `classic` template inexistent).

These will define the global design of the output.

`data-optimizable="true"` tells that a `style` tag can be safely minified and purged by CSS post-processors.

#### ‚ÑπÔ∏è Partials

`partials` variable is populated with `partials/_.json` file content and define which files should be included along with default ordering.

The loop iterates over this array to include all defined partials. Each partial should handle whether it should be displayed by itself.

#### ‚ÑπÔ∏è `#metrics-end` tag

`#metrics-end` is a special HTML tag which must remain at the bottom of SVG template.

It is used to compute height dynamically through a [puppeteer](https://github.com/puppeteer/puppeteer) headless instance. Initial height should remain a high number so it doesn't get cropped accidentally while [puppeteer](https://github.com/puppeteer/puppeteer) compute [element.getBoundingClientRect()](https://developer.mozilla.org/fr/docs/Web/API/Element/getBoundingClientRect).

### üí¨ Filling `metadata.yml`

`metadata.yml` is a required file which describes supported account types, output formats, scopes, etc.

The default file looks like below:
```yaml
name: üñºÔ∏è Template name
extends: classic
description: |
  Short description
examples:
  default: https://via.placeholder.com/468x60?text=No%20preview%20available
supports:
  - user
  - organization
  - repository
formats:
  - svg
  - png
  - jpeg
  - json
  - markdown
  - markdown-pdf
```

> üí° It is important to correctly define `metadata.yml` because *metrics* will use its content for various usage

[`üß± core`](/source/plugins/core/README.md) plugin (which is always called) will automatically verify user inputs against `supports` and `formats` values and throw an error in case of incompatibility.

`extends` is used to define the fallback for `template.mjs` when a template is not trusted by user (depending  on whether you're building an user/organization or repository template, it is advised to either use `classic` or `repository`).

`name`, `description` and `examples` are used to auto-generate documentation in the `README.md`.

### üí¨ Filling `examples.yml`

Workflow examples from `examples.yml` are used to auto-generate documentation in the `README.md`.

### üí¨ Filling `README.md`

`README.md` is used as documentation.

Most of it will is auto-generated by `metadata.yml` and `examples.yml` content, so usually it is not required to manually edit it.

The default content looks like below:
```markdown
<«É--header-->
<«É--/header-->

## ‚ÑπÔ∏è Examples workflows

<«É--examples-->
<«É--/examples-->
```

- `<«É--header-->` will be replaced by an auto-generated header containing template name, supported features and output examples based on `metadata.yml`
- `<«É--examples-->` will be replaced by workflows from `examples.yml`

### üí¨ Creating partials

Just create a new `.ejs` file in `partials` folder, and reference it into `partials/_.json`.

It should be able to handle gracefully plugins state and errors.

Below is a minimal snippet of a partial:
```ejs
<% if (plugins.{plugin_name}) { %>
  <% if (plugins.{plugin_name}.error) { %>
    <%= plugins.{plugin_name}.error.message %>
  <% } else { %>
    <%# content %>
  <% } %>
<% } %>
```

Partials should have the match the same name as plugin handles, as they're used to display plugin compatibility in auto-generated header.

### üí¨ Adding custom fonts

> ‚ö†Ô∏è This significantly increases rendered metrics filesize and thus not recommended. You should restrict charset when using this feature

Here's a quick step-by-step tutorial to create base64 encoded fonts:
- 1. Find a font on [fonts.google.com](https://fonts.google.com)
    - Select regular, bold, italic and bold+italic fonts
    - Open `embed` tab and extract `href`
- 2. Open extracted `href` in a browser and append `&text=` parameter with list of used characters
    - e.g. `&text=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz`
- 3. Download each font file from urls present in generated stylesheet
- 4. Convert them into base64 with `woff` format on [transfonter.org](https://transfonter.org)
- 5. Download archive and extract it
- 6. Copy content of generated stylesheet to `fonts.css`
- 7. Update `style.css` to use the new font
</file>

<file path="source/templates/markdown/partials/_.json">
[]
</file>

<file path="source/templates/markdown/example.pdf.md">
# üìí Markdown template example (pdf)

See [rendering of this file here](https://github.com/lowlighter/metrics/blob/examples/metrics.markdown.pdf) and [original template source here](https://github.com/lowlighter/metrics/blob/master/source/templates/markdown/example.pdf.md).

## üß© Plugins

All markdown features are supported, meaning that both markdown plugins and SVG renders can be used.

<%- await include(`partials/rss.ejs`) %>

<%- await embed(`example-isocalendar-pdf`, {isocalendar:true}) %>
</file>

<file path="source/templates/markdown/metadata.yml">
name: üìí Markdown template
description: |
  A template capable of rendering markdown from a given template file.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.markdown.png
index: 3
supports:
  - user
  - organization
  - repository
formats:
  - markdown
  - markdown-pdf
  - json
</file>

<file path="source/templates/markdown/template.mjs">
/**Template processor */
export default async function(_, {data}, {imports}) {
  //Core
  await imports.plugins.core(...arguments)
  //Aliases
  const {user, computed, plugins} = data
  Object.assign(data, {
    //Base
    NAME: user.name,
    LOGIN: user.login,
    REGISTRATION_DATE: user.createdAt,
    REGISTERED_YEARS: computed.registered.years,
    LOCATION: user.location,
    WEBSITE: user.websiteUrl,
    REPOSITORIES: user.repositories.totalCount,
    REPOSITORIES_DISK_USAGE: user.repositories.totalDiskUsage,
    PACKAGES: user.packages.totalCount,
    STARRED: user.starredRepositories.totalCount,
    WATCHING: user.watching.totalCount,
    SPONSORING: user.sponsorshipsAsSponsor.totalCount,
    SPONSORS: user.sponsorshipsAsMaintainer.totalCount,
    REPOSITORIES_CONTRIBUTED_TO: user.repositoriesContributedTo.totalCount,
    COMMITS: computed.commits,
    COMMITS_PUBLIC: user.contributionsCollection.totalCommitContributions,
    COMMITS_PRIVATE: user.contributionsCollection.restrictedContributionsCount,
    ISSUES: user.contributionsCollection.totalIssueContributions,
    PULL_REQUESTS: user.contributionsCollection.totalPullRequestContributions,
    PULL_REQUESTS_REVIEWS: user.contributionsCollection.totalPullRequestReviewContributions,
    FOLLOWERS: user.followers.totalCount,
    FOLLOWING: user.following.totalCount,
    ISSUE_COMMENTS: user.issueComments.totalCount,
    ORGANIZATIONS: user.organizations.totalCount,
    WATCHERS: computed.repositories.watchers,
    STARGAZERS: computed.repositories.stargazers,
    FORKS: computed.repositories.forks,
    RELEASES: computed.repositories.releases,
    VERSION: data.meta.version,
    //Lines
    LINES_ADDED: plugins.lines?.added ?? 0,
    LINES_DELETED: plugins.lines?.deleted ?? 0,
    //Gists
    GISTS: plugins.gists?.totalCount ?? 0,
    GISTS_STARGAZERS: plugins.gists?.stargazers ?? 0,
    //Languages
    LANGUAGES: plugins.languages?.favorites?.map(({name, value, size, color}) => ({name, value, size, color})) ?? [],
    //Posts
    POSTS: plugins.posts?.list ?? [],
    //Tweets
    TWEETS: plugins.tweets?.list ?? [],
    //Topics
    TOPICS: plugins.topics?.list ?? [],
  })
}
</file>

<file path="source/templates/repository/examples.yml">
- name: Example
  uses: lowlighter/metrics@latest
  with:
    template: repository
    filename: metrics.repository.svg
    token: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}
    user: lowlighter
    repo: metrics
    plugin_lines: yes
    plugin_followup: yes
    plugin_projects: yes
    plugin_projects_repositories: lowlighter/metrics/projects/1
</file>

<file path="source/templates/repository/metadata.yml">
name: üìò Repository template
description: |
  A template mimicking GitHub visual identity and specially crafted for repositories.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.repository.svg
index: 1
supports:
  - repository
formats:
  - svg
  - png
  - jpeg
  - json
</file>

<file path="source/templates/repository/template.mjs">
/**Template processor */
export default async function({login, q}, {data, rest, graphql, queries, account}, {pending, imports}) {
  //Check arguments
  const {repo} = q
  if (!repo) {
    console.debug(`metrics/compute/${login}/${repo} > error, repo was undefined`)
    data.errors.push({error: {message: 'You must pass a "repo" argument to use this template'}})
    return imports.plugins.core(...arguments)
  }
  console.debug(`metrics/compute/${login}/${repo} > switching to mode ${account}`)

  //Retrieving single repository
  console.debug(`metrics/compute/${login}/${repo} > retrieving single repository ${repo}`)
  const {[account === "bypass" ? "user" : account]: {repository}} = await graphql(queries.base.repository({login, repo, account}))
  data.user.repositories.nodes = [repository]
  data.user.repositoriesContributedTo.nodes = []
  data.repo = repository

  //Contributors and sponsors
  data.repo.contributors = {totalCount: (await rest.repos.listContributors({owner: data.repo.owner.login, repo})).data.length}
  data.repo.sponsorshipsAsMaintainer = data.user.sponsorshipsAsMaintainer

  //Get commit activity
  console.debug(`metrics/compute/${login}/${repo} > querying api for commits`)
  const commits = []
  for (let page = 1; page < 100; page++) {
    console.debug(`metrics/compute/${login}/${repo} > loading page ${page}`)
    try {
      const {data} = await rest.repos.listCommits({owner: login, repo, per_page: 100, page})
      if (!data.length) {
        console.debug(`metrics/compute/${login}/${repo} > no more page to load`)
        break
      }
      commits.push(...data)
    }
    catch (error) {
      if (/Git Repository is empty/.test(error))
        break
      throw error
    }
  }
  console.debug(`metrics/compute/${login}/${repo} > ${commits.length} commits loaded`)

  //Override creation date, disk usage and website url
  data.user.createdAt = repository.createdAt
  data.user.repositories.totalDiskUsage = repository.diskUsage
  data.user.websiteUrl = repository.homepageUrl

  //Override contributions calendar
  const days = 14
  //Compute relative date for each contribution
  const now = new Date()
  now.setHours(0, 0, 0, 0)
  const contributions = commits.map(({commit}) => Math.abs(Math.ceil((now - new Date(commit.committer.date)) / (24 * 60 * 60 * 1000))))
  //Count contributions per relative day
  const calendar = new Array(days).fill(0)
  for (const day of contributions)
    calendar[day]++
  calendar.splice(days)
  const max = Math.max(...calendar)
  //Override contributions calendar
  data.user.calendar.contributionCalendar.weeks = calendar.map(commit => ({contributionDays: {color: commit ? `var(--color-calendar-graph-day-L${Math.ceil(commit / max / 0.25)}-bg)` : "var(--color-calendar-graph-day-bg)"}}))

  //Override plugins parameters
  q["projects.limit"] = 0

  //Fetching users count if it's an action
  try {
    if (await rest.repos.getContent({owner: login, repo, path: "action.yml"})) {
      console.debug(`metrics/compute/${login}/${repo} > this repository seems to be a GitHub action, fetching users using code search`)
      const {data: {total_count}} = await rest.search.code({q: `uses ${login} ${repo} path:.github/workflows language:YAML`})
      data.repo.actionUsersCount = total_count
    }
  }
  catch {
    //Ignore errors
  }

  //Core
  await imports.plugins.core(...arguments)
  await Promise.all(pending)

  //Set repository name
  data.user.name = `${data.user.login}/${repo}`

  //Reformat projects names
  if (data.plugins.projects)
    data.plugins.projects.list?.map(project => project.name = project.name.replace(`(${login}/${repo})`, "").trim())
}
</file>

<file path="source/templates/terminal/partials/_.json">
[
  "base.header",
  "base.activity+community",
  "base.repositories",
  "gists",
  "languages",
  "pagespeed",
  "isocalendar",
  "screenshot"
]
</file>

<file path="source/templates/terminal/examples.yml">
- name: Example
  uses: lowlighter/metrics@latest
  with:
    template: terminal
    filename: metrics.terminal.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: header, metadata
</file>

<file path="source/templates/terminal/metadata.yml">
name: üìô Terminal template
description: |
  A template mimicking a SSH session.
examples:
  default: https://github.com/lowlighter/metrics/blob/examples/metrics.terminal.svg
index: 2
supports:
  - user
  - organization
formats:
  - svg
  - png
  - jpeg
  - json
</file>

<file path="source/templates/terminal/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#%EF%B8%8F-templates">‚Üê Back to templates index</a></td></tr>
  <tr><th colspan="2"><h3>üìô Terminal template</h3></th></tr>
  <tr><td colspan="2" align="center"><p>A template mimicking a SSH session.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/plugins/screenshot/README.md" title="üì∏ Website screenshot">üì∏</a> <a href="/source/plugins/gists/README.md" title="üé´ Gists">üé´</a> <a href="/source/plugins/isocalendar/README.md" title="üìÖ Isometric commit calendar">üìÖ</a> <a href="/source/plugins/languages/README.md" title="üà∑Ô∏è Languages activity">üà∑Ô∏è</a> <a href="/source/plugins/lines/README.md" title="üë®‚Äçüíª Lines of code changed">üë®‚Äçüíª</a> <a href="/source/plugins/pagespeed/README.md" title="‚è±Ô∏è Google PageSpeed">‚è±Ô∏è</a> <a href="/source/plugins/traffic/README.md" title="üßÆ Repositories traffic">üßÆ</a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code></td>
  </tr>
  <tr>
    <td><code>*Ô∏è‚É£ SVG</code> <code>*Ô∏è‚É£ PNG</code> <code>*Ô∏è‚É£ JPEG</code> <code>#Ô∏è‚É£ JSON</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.terminal.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Example
uses: lowlighter/metrics@latest
with:
  template: terminal
  filename: metrics.terminal.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: header, metadata

```
<!--/examples-->
</file>

<file path="source/templates/terminal/template.mjs">
/**Template processor */
export default async function({q}, _, {imports}) {
  //Core
  await imports.plugins.core(...arguments)
  //Disable optimization to keep white-spaces
  q.raw = true
}
</file>

<file path="source/templates/README.md">
## üñºÔ∏è Templates

Templates lets you change general appearance of rendered metrics.


* [üìó Classic template <sub>`classic`</sub>](/source/templates/classic/README.md)
* [üìò Repository template <sub>`repository`</sub>](/source/templates/repository/README.md)
* [üìô Terminal template <sub>`terminal`</sub>](/source/templates/terminal/README.md)
* [üìí Markdown template <sub>`markdown`</sub>](/source/templates/markdown/README.md)
* [üìï Community templates <sub>`community`</sub>](/source/templates/community/README.md)
</file>

<file path="source/.eslintrc.yml">
# Use recommended rules
extends: eslint:recommended

# Environment
env:
  node: yes
  es2021: yes
parserOptions:
  ecmaVersion: 2021
  sourceType: module

# Globally defined variables
globals:
  # Puppeteer variables
  document: readonly
  window: readonly
  XMLSerializer: readonly

# Rules
rules:

  # Avoid useless statements
  no-unused-vars: [error, {argsIgnorePattern: "^_"}]
  no-unused-expressions: error
  no-return-await: error
  no-empty-function: error
  no-useless-call: error
  no-useless-constructor: error
  no-useless-concat: error
  no-useless-computed-key: error
  no-useless-backreference: error
  no-self-compare: error
  no-extra-label: error
  no-undef-init: error

  # Avoid visual pollution
  semi: [error, never]
  semi-style: [error, first]
  dot-notation: error
  no-extra-semi: off

  # Avoid confusing code
  no-label-var: error
  no-bitwise: error
  new-cap: error
  new-parens: error
  func-name-matching: error
  no-extend-native: error
  no-extra-bind: error

  # Avoid deprecated or legacy JavaScript
  no-var: error
  no-caller: error
  no-alert: error
  no-script-url: error
  no-eval: error
  no-implied-eval: error
  no-implicit-globals: error
  no-proto: error
  no-iterator: error
  no-new-object: error

  # Code integrity
  no-unsafe-optional-chaining: error
  no-duplicate-imports: error
  eqeqeq: error

  # Code simplicity
  max-depth: [error, 10]
  max-nested-callbacks: error
  max-params: [error, 4]
  max-statements-per-line: error
  newline-per-chained-call: [error, {ignoreChainWithDepth: 6}]
  object-shorthand: error

  # Code readability
  default-case-last: error
  default-param-last: error
  no-else-return: error
  no-lonely-if: error
  no-multiple-empty-lines: error
  no-multi-str: error
  no-multi-assign: error
  yoda: error
  max-classes-per-file: [error, 1]
  grouped-accessor-pairs: error

  # Prefer using new syntax and features
  prefer-regex-literals: error
  prefer-arrow-callback: error
  prefer-destructuring: error
  prefer-numeric-literals: error
  prefer-exponentiation-operator: error
  prefer-spread: error
  prefer-object-spread: error
  prefer-template: error

  # Allow additional features
  no-ex-assign: off
  no-unsafe-finally: off

  # =========================================================================

  # Code style (general rules)
  no-tabs: error
  no-trailing-spaces: error
  brace-style: [error, stroustrup]
  comma-style: error
  sort-vars: error
  no-async-promise-executor: off
  no-misleading-character-class: off

  # Coding style (quoting rules)
  quote-props: [error, as-needed, {numbers: true}]
  quotes: [error, double, {avoidEscape: true}]
  template-curly-spacing: error

  # Coding style (spacing rules)
  block-spacing: [error, always]
  comma-spacing: error
  func-call-spacing: error
  arrow-spacing: error
  generator-star-spacing: error
  object-curly-spacing: [warn, never]
  rest-spread-spacing: error
  key-spacing: [warn, {afterColon: false}]
  computed-property-spacing: error
  array-bracket-spacing: [error, never]
  no-whitespace-before-property: error
  space-in-parens: error
  spaced-comment: [error, never]
  lines-between-class-members: error
  keyword-spacing: error
  array-bracket-newline: [error, consistent]
  array-element-newline: [error, consistent]

  # Coding style (function rules)
  no-new: error
  no-new-func: error
  no-new-wrappers: error
  func-names: [error, never]
  no-extra-parens: [error, functions]
  arrow-body-style: [error, as-needed]
  arrow-parens: [error, as-needed]
</file>

<file path="tests/cases/16personalities.plugin.yml">
- name: üß† 16personalities - MBTI Personality profile
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_16personalities: 'yes'
    plugin_16personalities_url: https://www.16personalities.com/profiles/b7d9f29453ea5
    plugin_16personalities_sections: personality, traits
    plugin_16personalities_scores: 'no'
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/achievements.plugin.yml">
- name: üèÜ Achievements - Detailed display
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_achievements: 'yes'
    plugin_achievements_only: sponsor, maintainer, octonaut
    use_mocked_data: 'yes'
    verify: 'yes'
  timeout: 1800000
- name: üèÜ Achievements - Compact display
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_achievements: 'yes'
    plugin_achievements_only: >-
      polyglot, stargazer, sponsor, deployer, member, maintainer, developer,
      scripter, packager, explorer, infographile, manager
    plugin_achievements_display: compact
    plugin_achievements_threshold: X
    use_mocked_data: 'yes'
    verify: 'yes'
  timeout: 1800000
</file>

<file path="tests/cases/activity.plugin.yml">
- name: üì∞ Recent activity - Recent activity
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_activity: 'yes'
    plugin_activity_limit: 5
    plugin_activity_days: 0
    plugin_activity_filter: issue, pr, release, fork, review, ref/create
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/anilist.plugin.yml">
- name: >-
    üå∏ Anilist watch list and reading list - Favorites anime and currently
    watching
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_anilist: 'yes'
    plugin_anilist_medias: anime
    plugin_anilist_sections: favorites, watching
    plugin_anilist_limit: 1
    use_mocked_data: 'yes'
    verify: 'yes'
- name: >-
    üå∏ Anilist watch list and reading list - Favorites manga and currently
    reading
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_anilist: 'yes'
    plugin_anilist_medias: manga
    plugin_anilist_sections: favorites, reading
    plugin_anilist_limit: 1
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üå∏ Anilist watch list and reading list - Favorites characters
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_anilist: 'yes'
    plugin_anilist_sections: characters
    plugin_anilist_limit_characters: 22
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/base.plugin.yml">
- name: üóÉÔ∏è Base content - Default metrics
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    base: header, activity, community, repositories, metadata
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/calendar.plugin.yml">
- name: üìÜ Commit calendar - Current year calendar
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_calendar: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üìÜ Commit calendar - Full history calendar
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_calendar: 'yes'
    plugin_calendar_limit: 0
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/chess.plugin.yml">
- name: ‚ôüÔ∏è Chess - Last chess game from lichess.org
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_chess: 'yes'
    plugin_chess_token: MOCKED_TOKEN
    plugin_chess_platform: lichess.org
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/classic.template.yml">
- name: üìó Classic template - Example
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    base: header, repositories
    plugin_lines: yes
    use_mocked_data: yes
    verify: yes
</file>

<file path="tests/cases/code.plugin.yml">
- name: ‚ôê Random code snippet - JavaScript or TypeScript snippet of the day
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_code: 'yes'
    plugin_code_languages: javascript, typescript
    plugin_code_load: 400
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/community.template.yml">
- name: üìï Community templates - Using a community template
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    template: "@classic"
    setup_community_templates: lowlighter/metrics@master:classic
    use_mocked_data: yes
    verify: yes
  modes:
    - action
- name: üìï Community templates - Using a trusted community template
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    template: "@terminal"
    setup_community_templates: lowlighter/metrics@master:terminal+trust
    use_mocked_data: yes
    verify: yes
  modes:
    - action
</file>

<file path="tests/cases/contributors.plugin.yml">
- name: üèÖ Repository contributors - Contributors with contributions count
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    template: repository
    repo: metrics
    plugin_contributors: 'yes'
    plugin_contributors_contributions: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üèÖ Repository contributors - Contributors by categories
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    template: repository
    repo: metrics
    plugin_contributors: 'yes'
    plugin_contributors_sections: categories
    plugin_contributors_categories: |
      {
        "üß© Plugins / üñºÔ∏è templates":["source/plugins/**", "source/templates/**"],
        "üìö Documentation":["README.md", "**/README.md", "**/metadata.yml"],
        "üíª Code (other)":["source/**", "Dockerfile"]
      }
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/core.plugin.yml">
- name: üß± Core - Organization
  uses: lowlighter/metrics@latest
  with:
    user: github
    token: MOCKED_TOKEN
    base: header, repositories
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üß± Core - Large display
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    config_display: large
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üß± Core - JSON metrics
  if: ${{ success() || failure() }}
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    config_output: json
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üß± Core - PNG metrics
  if: ${{ success() || failure() }}
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    config_output: png
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üß± Core - Metrics insights
  if: ${{ success() || failure() }}
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    config_output: insights
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üß± Core - Presets
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    base: header, repositories
    config_presets: >-
      https://raw.githubusercontent.com/lowlighter/metrics/presets/lunar-red/preset.yaml
    use_mocked_data: 'yes'
    verify: 'yes'
  modes:
    - web
</file>

<file path="tests/cases/discussions.plugin.yml">
- name: üí¨ Discussions - GitHub Discussions
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_discussions: 'yes'
    plugin_discussions_categories_limit: 8
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/followup.plugin.yml">
- name: üéüÔ∏è Follow-up of issues and pull requests - Opened on user's repositories
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_followup: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üéüÔ∏è Follow-up of issues and pull requests - Opened by user
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_followup: 'yes'
    plugin_followup_sections: user
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üéüÔ∏è Follow-up of issues and pull requests - Indepth analysis
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_followup: 'yes'
    plugin_followup_indepth: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üéüÔ∏è Follow-up of issues and pull requests - Exclude Archived
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_followup: 'yes'
    plugin_followup_archived: 'no'
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/fortune.plugin.yml">
- name: ü•† Fortune - Fortune
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_fortune: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/gists.plugin.yml">
- name: üé´ Gists - Gists
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_gists: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/habits.plugin.yml">
- name: üí° Coding habits and activity - Mildly interesting facts
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_habits: 'yes'
    plugin_habits_facts: 'yes'
    plugin_habits_charts: 'no'
    config_timezone: Europe/Paris
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üí° Coding habits and activity - Recent activity charts
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_habits: 'yes'
    plugin_habits_facts: 'no'
    plugin_habits_charts: 'yes'
    config_timezone: Europe/Paris
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/introduction.plugin.yml">
- name: üôã Introduction - Organization introduction
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    user: github
    base: header
    plugin_introduction: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üôã Introduction - Repository introduction
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    template: repository
    repo: metrics
    base: header
    plugin_introduction: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/isocalendar.plugin.yml">
- name: üìÖ Isometric commit calendar - Half-year calendar
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_isocalendar: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üìÖ Isometric commit calendar - Full-year calendar
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_isocalendar: 'yes'
    plugin_isocalendar_duration: full-year
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/languages.plugin.yml">
- name: üà∑Ô∏è Languages activity - Most used
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_languages: 'yes'
    plugin_languages_ignored: >-
      html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell,
      gnuplot
    plugin_languages_limit: 4
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üà∑Ô∏è Languages activity - Most used (with details)
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_languages: 'yes'
    plugin_languages_ignored: >-
      html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell,
      gnuplot
    plugin_languages_details: bytes-size, percentage
    plugin_languages_limit: 4
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üà∑Ô∏è Languages activity - Recently used
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_languages: 'yes'
    plugin_languages_ignored: >-
      html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell,
      gnuplot
    plugin_languages_sections: recently-used
    plugin_languages_details: bytes-size, percentage
    plugin_languages_limit: 4
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/leetcode.plugin.yml">
- name: üó≥Ô∏è Leetcode - LeetCode
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_leetcode: 'yes'
    plugin_leetcode_sections: solved, skills, recent
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/licenses.plugin.yml">
- name: üìú Repository licenses - Licenses and permissions
  with:
    token: MOCKED_TOKEN
    template: repository
    repo: metrics
    plugin_licenses: 'yes'
    plugin_licenses_setup: bash -c '[[ -f package.json ]] && npm ci || true'
    use_mocked_data: 'yes'
    verify: 'yes'
  timeout: 1800000
  modes:
    - action
</file>

<file path="tests/cases/music.plugin.yml">
- name: üéº Music activity and suggestions - Apple Music - Random track from playlist
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_music: 'yes'
    plugin_music_playlist: https://embed.music.apple.com/fr/playlist/usr-share/pl.u-V9D7m8Etjmjd0D
    plugin_music_limit: 2
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üéº Music activity and suggestions - Spotify - Random track from playlist
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_music: 'yes'
    plugin_music_playlist: https://open.spotify.com/embed/playlist/3nfA87oeJw4LFVcUDjRcqi
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üéº Music activity and suggestions - Spotify - Recently listed
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_music: 'yes'
    plugin_music_provider: spotify
    plugin_music_mode: recent
    plugin_music_token: MOCKED_CLIENT_ID, MOCKED_CLIENT_SECRET, MOCKED_REFRESH_TOKEN
    plugin_music_limit: 2
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üéº Music activity and suggestions - Spotify - Top tracks
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_music: 'yes'
    plugin_music_mode: top
    plugin_music_provider: spotify
    plugin_music_token: MOCKED_CLIENT_ID, MOCKED_CLIENT_SECRET, MOCKED_REFRESH_TOKEN
    plugin_music_time_range: short
    plugin_music_top_type: tracks
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üéº Music activity and suggestions - Spotify - Top artists
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_music: 'yes'
    plugin_music_mode: top
    plugin_music_provider: spotify
    plugin_music_token: MOCKED_CLIENT_ID, MOCKED_CLIENT_SECRET, MOCKED_REFRESH_TOKEN
    plugin_music_time_range: long
    plugin_music_top_type: artists
    use_mocked_data: 'yes'
    verify: 'yes'
- name: >-
    üéº Music activity and suggestions - Youtube Music - Random track from
    playlist
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_music: 'yes'
    plugin_music_playlist: >-
      https://music.youtube.com/playlist?list=OLAK5uy_kU_uxp9TUOl9zVdw77xith8o9AknVwz9U
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üéº Music activity and suggestions - Youtube Music - Recently listed
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_music_token: SAPISID=MOCKED_COOKIE; OTHER_PARAM=OTHER_VALUE;
    plugin_music: 'yes'
    plugin_music_mode: recent
    plugin_music_provider: youtube
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üéº Music activity and suggestions - Last.fm  - Recently listed
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_music_token: MOCKED_TOKEN
    plugin_music: 'yes'
    plugin_music_provider: lastfm
    plugin_music_user: RJ
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/nightscout.plugin.yml">
- uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_nightscout: 'yes'
    plugin_nightscout_url: https://testapp.herokuapp.com/
    use_mocked_data: 'yes'
    verify: 'yes'
  name: üíâ Nightscout - (unnamed)
</file>

<file path="tests/cases/notable.plugin.yml">
- name: üé© Notable contributions - Contributions
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_notable: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üé© Notable contributions - Indepth analysis
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_notable: 'yes'
    plugin_notable_indepth: 'yes'
    plugin_notable_repositories: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/pagespeed.plugin.yml">
- name: ‚è±Ô∏è Google PageSpeed - Succinct report
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_pagespeed: 'yes'
    plugin_pagespeed_token: MOCKED_TOKEN
    plugin_pagespeed_url: https://lecoq.io
    use_mocked_data: 'yes'
    verify: 'yes'
- name: ‚è±Ô∏è Google PageSpeed - Detailed report
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_pagespeed: 'yes'
    plugin_pagespeed_detailed: 'yes'
    plugin_pagespeed_token: MOCKED_TOKEN
    plugin_pagespeed_url: https://lecoq.io
    use_mocked_data: 'yes'
    verify: 'yes'
- name: ‚è±Ô∏è Google PageSpeed - Screenshot
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_pagespeed: 'yes'
    plugin_pagespeed_screenshot: 'yes'
    plugin_pagespeed_token: MOCKED_TOKEN
    plugin_pagespeed_url: https://lecoq.io
    use_mocked_data: 'yes'
    verify: 'yes'
- name: ‚è±Ô∏è Google PageSpeed - Succinct report with PWA
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_pagespeed: 'yes'
    plugin_pagespeed_token: MOCKED_TOKEN
    plugin_pagespeed_url: https://lecoq.io
    plugin_pagespeed_pwa: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/people.plugin.yml">
- name: üßë‚Äçü§ù‚Äçüßë People - Followers
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_people: 'yes'
    plugin_people_types: followers
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üßë‚Äçü§ù‚Äçüßë People - Contributors and sponsors
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    template: repository
    repo: metrics
    plugin_people: 'yes'
    plugin_people_types: contributors, stargazers, watchers, sponsors
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/poopmap.plugin.yml">
- uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_poopmap_token: MOCKED_TOKEN
    plugin_poopmap: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
  name: üí© PoopMap plugin - (unnamed)
</file>

<file path="tests/cases/posts.plugin.yml">
- name: ‚úíÔ∏è Recent posts - Recent posts
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_posts: 'yes'
    plugin_posts_source: dev.to
    use_mocked_data: 'yes'
    verify: 'yes'
- name: ‚úíÔ∏è Recent posts - Recent posts with descriptions and cover images
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_posts: 'yes'
    plugin_posts_source: dev.to
    plugin_posts_limit: 2
    plugin_posts_descriptions: 'yes'
    plugin_posts_covers: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/projects.plugin.yml">
- name: üóÇÔ∏è GitHub projects - Project from a repository
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_projects: 'yes'
    plugin_projects_repositories: lowlighter/metrics/projects/1
    plugin_projects_descriptions: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/reactions.plugin.yml">
- name: üé≠ Comment reactions - Comment reactions
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_reactions: 'yes'
    plugin_reactions_limit: 100
    plugin_reactions_details: percentage
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/repositories.plugin.yml">
- name: üìì Featured repositories - Featured repositories
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_repositories: 'yes'
    plugin_repositories_featured: lowlighter/metrics
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üìì Featured repositories - Pinned repositories
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_repositories: 'yes'
    plugin_repositories_pinned: 2
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/repository.template.yml">
- name: üìò Repository template - Example
  uses: lowlighter/metrics@latest
  with:
    template: repository
    token: MOCKED_TOKEN
    user: lowlighter
    repo: metrics
    plugin_lines: yes
    plugin_followup: yes
    plugin_projects: yes
    plugin_projects_repositories: lowlighter/metrics/projects/1
    use_mocked_data: yes
    verify: yes
</file>

<file path="tests/cases/rss.plugin.yml">
- name: üóº Rss feed - News from hackernews
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_rss: 'yes'
    plugin_rss_source: https://news.ycombinator.com/rss
    plugin_rss_limit: 4
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/screenshot.plugin.yml">
- name: üì∏ Website screenshot - XKCD of the day
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_screenshot: 'yes'
    plugin_screenshot_title: XKCD of the day
    plugin_screenshot_url: https://xkcd.com
    plugin_screenshot_selector: '#comic img'
    use_mocked_data: 'yes'
    verify: 'yes'
  timeout: 1800000
  modes:
    - action
</file>

<file path="tests/cases/splatoon.plugin.yml">
[]
</file>

<file path="tests/cases/sponsors.plugin.yml">
- name: üíï GitHub Sponsors - Sponsors goal
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_sponsors: 'yes'
    plugin_sponsors_sections: goal, list
    plugin_sponsors_past: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üíï GitHub Sponsors - Sponsors introduction
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_sponsors: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/sponsorships.plugin.yml">
- name: üíù GitHub Sponsorships - üíù GitHub Sponsorships
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_sponsorships: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/stackoverflow.plugin.yml">
- name: üó®Ô∏è Stack Overflow - Top answers from stackoverflow
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_stackoverflow: 'yes'
    plugin_stackoverflow_user: 1
    plugin_stackoverflow_sections: answers-top
    plugin_stackoverflow_limit: 2
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/stargazers.plugin.yml">
- name: ‚ú® Stargazers - Using classic charts
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_stargazers: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
- name: ‚ú® Stargazers - Using graph charts
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_stargazers: 'yes'
    plugin_stargazers_charts_type: graph
    use_mocked_data: 'yes'
    verify: 'yes'
- name: ‚ú® Stargazers - With worldmap
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_stargazers: 'yes'
    plugin_stargazers_charts: 'no'
    plugin_stargazers_worldmap: 'yes'
    plugin_stargazers_worldmap_token: MOCKED_TOKEN
    plugin_stargazers_worldmap_sample: 200
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/starlists.plugin.yml">
- name: üí´ Star lists - Featured star list
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_starlists: 'yes'
    plugin_starlists_limit_repositories: 2
    plugin_starlists_only: TC39
    use_mocked_data: 'yes'
    verify: 'yes'
  timeout: 1800000
- name: üí´ Star lists - Featured star list languages
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_starlists: 'yes'
    plugin_starlists_languages: 'yes'
    plugin_starlists_limit_languages: 8
    plugin_starlists_limit_repositories: 0
    plugin_starlists_only: Awesome
    use_mocked_data: 'yes'
    verify: 'yes'
  timeout: 1800000
</file>

<file path="tests/cases/stars.plugin.yml">
- name: üåü Recently starred repositories - Recently starred
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_stars: 'yes'
    plugin_stars_limit: 3
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/stock.plugin.yml">
- name: üíπ Stock prices - Stock prices from Tesla
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_stock: 'yes'
    plugin_stock_token: MOCKED_TOKEN
    plugin_stock_symbol: TSLA
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/support.plugin.yml">
[]
</file>

<file path="tests/cases/terminal.template.yml">
- name: üìô Terminal template - Example
  uses: lowlighter/metrics@latest
  with:
    template: terminal
    token: MOCKED_TOKEN
    base: header, metadata
    use_mocked_data: yes
    verify: yes
</file>

<file path="tests/cases/topics.plugin.yml">
- name: üìå Starred topics - Labels
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_topics: 'yes'
    plugin_topics_limit: 12
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üìå Starred topics - Icons
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_topics: 'yes'
    plugin_topics_limit: 0
    plugin_topics_mode: icons
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/traffic.plugin.yml">
- name: üßÆ Repositories traffic - Repositories traffic
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    base: repositories
    plugin_traffic: 'yes'
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/wakatime.plugin.yml">
- name: ‚è∞ WakaTime - WakaTime
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_wakatime: 'yes'
    plugin_wakatime_sections: time, projects, projects-graphs, languages, languages-graphs, editors, os
    plugin_wakatime_token: MOCKED_TOKEN
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/mocks/api/axios/get/lichess.mjs">
/**Mocked data */
export default function({faker, url, options, login = faker.internet.userName()}) {
  //Wakatime api
  if (/^https:..lichess.org.api.games.user.*$/.test(url)) {
    console.debug(`metrics/compute/mocks > mocking lichess api result > ${url}`)
    return ({
      status: 200,
      data: `
[Event "It (cat.17)"]
[Site "Wijk aan Zee (Netherlands)"]
[Date "1999.??.??"]
[Round "?"]
[White "Garry Kasparov"]
[Black "Veselin Topalov"]
[Result "1-0"]

1. e4 d6 2. d4 Nf6 3. Nc3 g6 4. Be3 Bg7 5. Qd2 c6 6. f3 b5 7. Nge2 Nbd7 8. Bh6
Bxh6 9. Qxh6 Bb7 10. a3 e5 11. O-O-O Qe7 12. Kb1 a6 13. Nc1 O-O-O 14. Nb3 exd4
15. Rxd4 c5 16. Rd1 Nb6 17. g3 Kb8 18. Na5 Ba8 19. Bh3 d5 20. Qf4+ Ka7 21. Rhe1
d4 22. Nd5 Nbxd5 23. exd5 Qd6 24. Rxd4 cxd4 25. Re7+ Kb6 26. Qxd4+ Kxa5 27. b4+
Ka4 28. Qc3 Qxd5 29. Ra7 Bb7 30. Rxb7 Qc4 31. Qxf6 Kxa3 32. Qxa6+ Kxb4 33. c3+
Kxc3 34. Qa1+ Kd2 35. Qb2+ Kd1 36. Bf1 Rd2 37. Rd7 Rxd7 38. Bxc4 bxc4 39. Qxh8
Rd3 40. Qa8 c3 41. Qa4+ Ke1 42. f4 f5 43. Kc1 Rd2 44. Qa7 1-0`.trim(),
    })
  }
}
</file>

<file path="tests/mocks/api/axios/post/hashnode.mjs">
/**Mocked data */
export default function({faker, url, body, login = faker.internet.userName()}) {
  if (/^https:..api.hashnode.com.*$/.test(url)) {
    console.debug(`metrics/compute/mocks > mocking hashnode result > ${url}`)
    return ({
      status: 200,
      data: {
        data: {
          user: {
            publication: {
              posts: new Array(30).fill(null).map(_ => ({
                title: faker.lorem.sentence(),
                brief: faker.lorem.paragraph(),
                coverImage: null,
                dateAdded: faker.date.recent(),
              })),
            },
          },
        },
      },
    })
  }
}
</file>

<file path="tests/mocks/api/axios/post/spotify.mjs">
//Imports
import urls from "url"

/**Mocked data */
export default function({faker, url, body, login = faker.internet.userName()}) {
  if (/^https:..accounts.spotify.com.api.token.*$/.test(url)) {
    //Access token generator
    const params = new urls.URLSearchParams(body)
    if ((params.get("grant_type") === "refresh_token") && (params.get("client_id") === "MOCKED_CLIENT_ID") && (params.get("client_secret") === "MOCKED_CLIENT_SECRET") && (params.get("refresh_token") === "MOCKED_REFRESH_TOKEN")) {
      console.debug(`metrics/compute/mocks > mocking spotify api result > ${url}`)
      return ({
        status: 200,
        data: {
          access_token: "MOCKED_TOKEN_ACCESS",
          token_type: "Bearer",
          expires_in: 3600,
          scope: "user-read-recently-played user-read-private",
        },
      })
    }
  }
}
</file>

<file path="tests/mocks/api/github/graphql/achievements.metrics.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > achievements/metrics")
  return ({
    repository: {viewerHasStarred: faker.datatype.boolean()},
    viewer: {login},
  })
}
</file>

<file path="tests/mocks/api/github/graphql/achievements.octocat.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > achievements/octocat")
  return ({
    user: {viewerIsFollowing: faker.datatype.boolean()},
    viewer: {login},
  })
}
</file>

<file path="tests/mocks/api/github/graphql/base.calendar.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > base/user")
  return ({
    user: {
      calendar: {
        contributionCalendar: {
          weeks: [
            {
              contributionDays: [
                {color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])},
                {color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])},
                {color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])},
                {color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])},
                {color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])},
              ],
            },
            {
              contributionDays: [
                {color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])},
                {color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])},
                {color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])},
                {color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])},
                {color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])},
                {color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])},
                {color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])},
              ],
            },
            {
              contributionDays: [
                {color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])},
                {color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])},
                {color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])},
              ],
            },
          ],
        },
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/contributors.commit.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > contributors/commit")
  return ({
    repository: {
      object: {
        oid: "MOCKED_SHA",
        abbreviatedOid: "MOCKED_SHA",
        messageHeadline: faker.lorem.sentence(),
        committedDate: faker.date.recent(),
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/discussions.categories.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > discussions/categories")
  return /after: "MOCKED_CURSOR"/m.test(query)
    ? ({
      user: {
        repositoryDiscussions: {
          edges: [],
          nodes: [],
        },
      },
    })
    : ({
      user: {
        repositoryDiscussions: {
          edges: new Array(100).fill(null).map(_ => ({cursor: "MOCKED_CURSOR"})),
          nodes: new Array(100).fill(null).map(_ => ({
            category: {
              emoji: faker.helpers.arrayElement([":chart_with_upwards_trend:", ":chart_with_downwards_trend:", ":bar_char:"]),
              name: faker.lorem.slug(),
            },
          })),
        },
      },
    })
}
</file>

<file path="tests/mocks/api/github/graphql/followup.repository.collaborators.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > followup/repository/collaborators")
  return ({
    repository: {
      collaborators: {
        nodes: ["github-user"],
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/introduction.organization.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > introduction/organization")
  return ({
    organization: {
      description: faker.lorem.sentences(),
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/introduction.repository.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > introduction/repository")
  return ({
    repository: {
      description: faker.lorem.sentences(),
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/introduction.user.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > introduction/user")
  return ({
    user: {
      bio: faker.lorem.sentences(),
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/licenses.default.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > licenses/default")
  return ({
    licenses: [
      {
        spdxId: "AGPL-3.0",
        name: "GNU Affero General Public License v3.0",
        nickname: "GNU AGPLv3",
        key: "agpl-3.0",
        limitations: [
          {key: "liability", label: "Liability"},
          {key: "warranty", label: "Warranty"},
        ],
        conditions: [
          {key: "include-copyright", label: "License and copyright notice"},
          {key: "document-changes", label: "State changes"},
          {key: "disclose-source", label: "Disclose source"},
          {key: "network-use-disclose", label: "Network use is distribution"},
          {key: "same-license", label: "Same license"},
        ],
        permissions: [
          {key: "commercial-use", label: "Commercial use"},
          {key: "modifications", label: "Modification"},
          {key: "distribution", label: "Distribution"},
          {key: "patent-use", label: "Patent use"},
          {key: "private-use", label: "Private use"},
        ],
      },
      {
        spdxId: "Apache-2.0",
        name: "Apache License 2.0",
        nickname: null,
        key: "apache-2.0",
        limitations: [
          {key: "trademark-use", label: "Trademark use"},
          {key: "liability", label: "Liability"},
          {key: "warranty", label: "Warranty"},
        ],
        conditions: [
          {key: "include-copyright", label: "License and copyright notice"},
          {key: "document-changes", label: "State changes"},
        ],
        permissions: [
          {key: "commercial-use", label: "Commercial use"},
          {key: "modifications", label: "Modification"},
          {key: "distribution", label: "Distribution"},
          {key: "patent-use", label: "Patent use"},
          {key: "private-use", label: "Private use"},
        ],
      },
      {
        spdxId: "BSD-2-Clause",
        name: 'BSD 2-Clause "Simplified" License',
        nickname: null,
        key: "bsd-2-clause",
        limitations: [
          {key: "liability", label: "Liability"},
          {key: "warranty", label: "Warranty"},
        ],
        conditions: [
          {key: "include-copyright", label: "License and copyright notice"},
        ],
        permissions: [
          {key: "commercial-use", label: "Commercial use"},
          {key: "modifications", label: "Modification"},
          {key: "distribution", label: "Distribution"},
          {key: "private-use", label: "Private use"},
        ],
      },
      {
        spdxId: "BSD-3-Clause",
        name: 'BSD 3-Clause "New" or "Revised" License',
        nickname: null,
        key: "bsd-3-clause",
        limitations: [
          {key: "liability", label: "Liability"},
          {key: "warranty", label: "Warranty"},
        ],
        conditions: [
          {key: "include-copyright", label: "License and copyright notice"},
        ],
        permissions: [
          {key: "commercial-use", label: "Commercial use"},
          {key: "modifications", label: "Modification"},
          {key: "distribution", label: "Distribution"},
          {key: "private-use", label: "Private use"},
        ],
      },
      {
        spdxId: "BSL-1.0",
        name: "Boost Software License 1.0",
        nickname: null,
        key: "bsl-1.0",
        limitations: [
          {key: "liability", label: "Liability"},
          {key: "warranty", label: "Warranty"},
        ],
        conditions: [
          {key: "include-copyright--source", label: "License and copyright notice for source"},
        ],
        permissions: [
          {key: "commercial-use", label: "Commercial use"},
          {key: "modifications", label: "Modification"},
          {key: "distribution", label: "Distribution"},
          {key: "private-use", label: "Private use"},
        ],
      },
      {
        spdxId: "CC0-1.0",
        name: "Creative Commons Zero v1.0 Universal",
        nickname: null,
        key: "cc0-1.0",
        limitations: [
          {key: "liability", label: "Liability"},
          {key: "trademark-use", label: "Trademark use"},
          {key: "patent-use", label: "Patent use"},
          {key: "warranty", label: "Warranty"},
        ],
        conditions: [],
        permissions: [
          {key: "commercial-use", label: "Commercial use"},
          {key: "modifications", label: "Modification"},
          {key: "distribution", label: "Distribution"},
          {key: "private-use", label: "Private use"},
        ],
      },
      {
        spdxId: "EPL-2.0",
        name: "Eclipse Public License 2.0",
        nickname: null,
        key: "epl-2.0",
        limitations: [
          {key: "liability", label: "Liability"},
          {key: "warranty", label: "Warranty"},
        ],
        conditions: [
          {key: "disclose-source", label: "Disclose source"},
          {key: "include-copyright", label: "License and copyright notice"},
          {key: "same-license", label: "Same license"},
        ],
        permissions: [
          {key: "commercial-use", label: "Commercial use"},
          {key: "distribution", label: "Distribution"},
          {key: "modifications", label: "Modification"},
          {key: "patent-use", label: "Patent use"},
          {key: "private-use", label: "Private use"},
        ],
      },
      {
        spdxId: "GPL-2.0",
        name: "GNU General Public License v2.0",
        nickname: "GNU GPLv2",
        key: "gpl-2.0",
        limitations: [
          {key: "liability", label: "Liability"},
          {key: "warranty", label: "Warranty"},
        ],
        conditions: [
          {key: "include-copyright", label: "License and copyright notice"},
          {key: "document-changes", label: "State changes"},
          {key: "disclose-source", label: "Disclose source"},
          {key: "same-license", label: "Same license"},
        ],
        permissions: [
          {key: "commercial-use", label: "Commercial use"},
          {key: "modifications", label: "Modification"},
          {key: "distribution", label: "Distribution"},
          {key: "private-use", label: "Private use"},
        ],
      },
      {
        spdxId: "GPL-3.0",
        name: "GNU General Public License v3.0",
        nickname: "GNU GPLv3",
        key: "gpl-3.0",
        limitations: [
          {key: "liability", label: "Liability"},
          {key: "warranty", label: "Warranty"},
        ],
        conditions: [
          {key: "include-copyright", label: "License and copyright notice"},
          {key: "document-changes", label: "State changes"},
          {key: "disclose-source", label: "Disclose source"},
          {key: "same-license", label: "Same license"},
        ],
        permissions: [
          {key: "commercial-use", label: "Commercial use"},
          {key: "modifications", label: "Modification"},
          {key: "distribution", label: "Distribution"},
          {key: "patent-use", label: "Patent use"},
          {key: "private-use", label: "Private use"},
        ],
      },
      {
        spdxId: "LGPL-2.1",
        name: "GNU Lesser General Public License v2.1",
        nickname: "GNU LGPLv2.1",
        key: "lgpl-2.1",
        limitations: [
          {key: "liability", label: "Liability"},
          {key: "warranty", label: "Warranty"},
        ],
        conditions: [
          {key: "include-copyright", label: "License and copyright notice"},
          {key: "disclose-source", label: "Disclose source"},
          {key: "document-changes", label: "State changes"},
          {key: "same-license--library", label: "Same license (library)"},
        ],
        permissions: [
          {key: "commercial-use", label: "Commercial use"},
          {key: "modifications", label: "Modification"},
          {key: "distribution", label: "Distribution"},
          {key: "private-use", label: "Private use"},
        ],
      },
      {
        spdxId: "MIT",
        name: "MIT License",
        nickname: null,
        key: "mit",
        limitations: [
          {key: "liability", label: "Liability"},
          {key: "warranty", label: "Warranty"},
        ],
        conditions: [
          {key: "include-copyright", label: "License and copyright notice"},
        ],
        permissions: [
          {key: "commercial-use", label: "Commercial use"},
          {key: "modifications", label: "Modification"},
          {key: "distribution", label: "Distribution"},
          {key: "private-use", label: "Private use"},
        ],
      },
      {
        spdxId: "MPL-2.0",
        name: "Mozilla Public License 2.0",
        nickname: null,
        key: "mpl-2.0",
        limitations: [
          {key: "liability", label: "Liability"},
          {key: "trademark-use", label: "Trademark use"},
          {key: "warranty", label: "Warranty"},
        ],
        conditions: [
          {key: "disclose-source", label: "Disclose source"},
          {key: "include-copyright", label: "License and copyright notice"},
          {key: "same-license--file", label: "Same license (file)"},
        ],
        permissions: [
          {key: "commercial-use", label: "Commercial use"},
          {key: "modifications", label: "Modification"},
          {key: "distribution", label: "Distribution"},
          {key: "patent-use", label: "Patent use"},
          {key: "private-use", label: "Private use"},
        ],
      },
      {
        spdxId: "Unlicense",
        name: "The Unlicense",
        nickname: null,
        key: "unlicense",
        limitations: [
          {key: "liability", label: "Liability"},
          {key: "warranty", label: "Warranty"},
        ],
        conditions: [],
        permissions: [
          {key: "private-use", label: "Private use"},
          {key: "commercial-use", label: "Commercial use"},
          {key: "modifications", label: "Modification"},
          {key: "distribution", label: "Distribution"},
        ],
      },
    ],
  })
}
</file>

<file path="tests/mocks/api/github/graphql/licenses.repository.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > licenses/repository")
  return ({
    user: {
      repository: {
        licenseInfo: {spdxId: "MIT", name: "MIT License", nickname: null, key: "mit"},
        url: "https://github.com/lowlighter/metrics",
        databaseId: 293860197,
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/people.default.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > people/default")
  const type = query.match(/(?<type>followers|following)[(]/)?.groups?.type ?? "(unknown type)"
  return /after: "MOCKED_CURSOR"/m.test(query)
    ? ({
      user: {
        [type]: {
          edges: [],
        },
      },
    })
    : ({
      user: {
        [type]: {
          edges: new Array(Math.ceil(20 + 80 * Math.random())).fill(null).map((login = faker.internet.userName()) => ({
            cursor: "MOCKED_CURSOR",
            node: {
              login,
              avatarUrl: null,
            },
          })),
        },
      },
    })
}
</file>

<file path="tests/mocks/api/github/graphql/people.repository.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > people/repository")
  const type = query.match(/(?<type>stargazers|watchers)[(]/)?.groups?.type ?? "(unknown type)"
  return /after: "MOCKED_CURSOR"/m.test(query)
    ? ({
      user: {
        repository: {
          [type]: {
            edges: [],
          },
        },
      },
    })
    : ({
      user: {
        repository: {
          [type]: {
            edges: new Array(Math.ceil(20 + 80 * Math.random())).fill(null).map((login = faker.internet.userName()) => ({
              cursor: "MOCKED_CURSOR",
              node: {
                login,
                avatarUrl: null,
              },
            })),
          },
        },
      },
    })
}
</file>

<file path="tests/mocks/api/github/graphql/people.sponsors.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > people/sponsors")
  const type = query.match(/(?<type>sponsorshipsAsSponsor|sponsorshipsAsMaintainer)[(]/)?.groups?.type ?? "(unknown type)"
  return /after: "MOCKED_CURSOR"/m.test(query)
    ? ({
      user: {
        login,
        [type]: {
          edges: [],
        },
      },
    })
    : ({
      user: {
        login,
        [type]: {
          edges: new Array(Math.ceil(20 + 80 * Math.random())).fill(null).map((login = faker.internet.userName()) => ({
            cursor: "MOCKED_CURSOR",
            node: {
              sponsorEntity: {
                login: faker.internet.userName(),
                avatarUrl: null,
              },
              sponsorable: {
                login: faker.internet.userName(),
                avatarUrl: null,
              },
            },
          })),
        },
      },
    })
}
</file>

<file path="tests/mocks/api/github/graphql/reactions.default.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > reactions/default")
  const type = query.match(/(?<type>issues|issueComments)[(]/)?.groups?.type ?? "(unknown type)"
  return /after: "MOCKED_CURSOR"/m.test(query)
    ? ({
      user: {
        [type]: {
          edges: [],
          nodes: [],
        },
      },
    })
    : ({
      user: {
        [type]: {
          edges: new Array(100).fill(null).map(_ => ({
            cursor: "MOCKED_CURSOR",
            node: {
              createdAt: faker.date.recent(),
              reactions: {
                nodes: new Array(50).fill(null).map(_ => ({
                  user: {login: faker.internet.userName()},
                  content: faker.helpers.arrayElement(["HEART", "THUMBS_UP", "THUMBS_DOWN", "LAUGH", "CONFUSED", "EYES", "ROCKET", "HOORAY"]),
                })),
              },
            },
          })),
        },
      },
    })
}
</file>

<file path="tests/mocks/api/github/graphql/repositories.random.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > repositories/random")
  return ({
    user: {
      repositories: {
        nodes: [
          {nameWithOwner: "lowlighter/metrics"},
        ],
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/repositories.starred.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > repositories/starred")
  return ({
    user: {
      repositories: {
        nodes: [
          {nameWithOwner: "lowlighter/metrics"},
        ],
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/sponsorships.all.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > sponsorships/all")
  return /after: "MOCKED_CURSOR"/m.test(query)
    ? ({
      user: {
        sponsorshipsAsSponsor: {
          edges: [],
          nodes: [],
        },
      },
    })
    : ({
      user: {
        sponsorshipsAsSponsor: {
          edges: new Array(10).fill("MOCKED_CURSOR"),
          nodes: new Array(10).fill(null).map(_ => ({
            createdAt: `${faker.date.recent()}`,
            isActive: faker.datatype.boolean(),
            isOneTimePayment: faker.datatype.boolean(),
            tier: {
              name: "$X a month",
            },
            privacyLevel: "PUBLIC",
            sponsorable: {
              login: faker.internet.userName(),
              avatarUrl: null,
            },
          })),
        },
      },
    })
}
</file>

<file path="tests/mocks/api/github/rest/activity/listRepoEvents.mjs">
//Imports
import listEventsForAuthenticatedUser from "./listEventsForAuthenticatedUser.mjs"

/**Mocked data */
export default async function({faker}, target, that, [{username: login, page, per_page}]) {
  console.debug("metrics/compute/mocks > mocking rest api result > rest.activity.listRepoEvents")
  return listEventsForAuthenticatedUser(...arguments)
}
</file>

<file path="tests/mocks/api/github/rest/emojis/get.mjs">
/**Mocked data */
export default async function({faker}, target, that) {
  console.debug("metrics/compute/mocks > mocking rest api result > rest.emojis.get")
  return ({
    status: 200,
    url: "https://api.github.com/emojis",
    headers: {
      server: "GitHub.com",
      status: "200 OK",
      "x-oauth-scopes": "repo",
    },
    data: {
      "100": "https://github.githubassets.com/images/icons/emoji/unicode/1f4af.png?v8",
      "1234": "https://github.githubassets.com/images/icons/emoji/unicode/1f522.png?v8",
      "+1": "https://github.githubassets.com/images/icons/emoji/unicode/1f44d.png?v8",
      "-1": "https://github.githubassets.com/images/icons/emoji/unicode/1f44e.png?v8",
      "1st_place_medal": "https://github.githubassets.com/images/icons/emoji/unicode/1f947.png?v8",
      "2nd_place_medal": "https://github.githubassets.com/images/icons/emoji/unicode/1f948.png?v8",
      "3rd_place_medal": "https://github.githubassets.com/images/icons/emoji/unicode/1f949.png?v8",
      "8ball": "https://github.githubassets.com/images/icons/emoji/unicode/1f3b1.png?v8",
      a: "https://github.githubassets.com/images/icons/emoji/unicode/1f170.png?v8",
      ab: "https://github.githubassets.com/images/icons/emoji/unicode/1f18e.png?v8",
      abacus: "https://github.githubassets.com/images/icons/emoji/unicode/1f9ee.png?v8",
      abc: "https://github.githubassets.com/images/icons/emoji/unicode/1f524.png?v8",
      abcd: "https://github.githubassets.com/images/icons/emoji/unicode/1f521.png?v8",
      accept: "https://github.githubassets.com/images/icons/emoji/unicode/1f251.png?v8",
      adhesive_bandage: "https://github.githubassets.com/images/icons/emoji/unicode/1fa79.png?v8",
      adult: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1.png?v8",
      aerial_tramway: "https://github.githubassets.com/images/icons/emoji/unicode/1f6a1.png?v8",
      afghanistan: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1eb.png?v8",
      airplane: "https://github.githubassets.com/images/icons/emoji/unicode/2708.png?v8",
      aland_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1fd.png?v8",
      alarm_clock: "https://github.githubassets.com/images/icons/emoji/unicode/23f0.png?v8",
      albania: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1f1.png?v8",
      alembic: "https://github.githubassets.com/images/icons/emoji/unicode/2697.png?v8",
      algeria: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e9-1f1ff.png?v8",
      alien: "https://github.githubassets.com/images/icons/emoji/unicode/1f47d.png?v8",
      ambulance: "https://github.githubassets.com/images/icons/emoji/unicode/1f691.png?v8",
      american_samoa: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1f8.png?v8",
      amphora: "https://github.githubassets.com/images/icons/emoji/unicode/1f3fa.png?v8",
      anchor: "https://github.githubassets.com/images/icons/emoji/unicode/2693.png?v8",
      andorra: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1e9.png?v8",
      angel: "https://github.githubassets.com/images/icons/emoji/unicode/1f47c.png?v8",
      anger: "https://github.githubassets.com/images/icons/emoji/unicode/1f4a2.png?v8",
      angola: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1f4.png?v8",
      angry: "https://github.githubassets.com/images/icons/emoji/unicode/1f620.png?v8",
      anguilla: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1ee.png?v8",
      anguished: "https://github.githubassets.com/images/icons/emoji/unicode/1f627.png?v8",
      ant: "https://github.githubassets.com/images/icons/emoji/unicode/1f41c.png?v8",
      antarctica: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1f6.png?v8",
      antigua_barbuda: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1ec.png?v8",
      apple: "https://github.githubassets.com/images/icons/emoji/unicode/1f34e.png?v8",
      aquarius: "https://github.githubassets.com/images/icons/emoji/unicode/2652.png?v8",
      argentina: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1f7.png?v8",
      aries: "https://github.githubassets.com/images/icons/emoji/unicode/2648.png?v8",
      armenia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1f2.png?v8",
      arrow_backward: "https://github.githubassets.com/images/icons/emoji/unicode/25c0.png?v8",
      arrow_double_down: "https://github.githubassets.com/images/icons/emoji/unicode/23ec.png?v8",
      arrow_double_up: "https://github.githubassets.com/images/icons/emoji/unicode/23eb.png?v8",
      arrow_down: "https://github.githubassets.com/images/icons/emoji/unicode/2b07.png?v8",
      arrow_down_small: "https://github.githubassets.com/images/icons/emoji/unicode/1f53d.png?v8",
      arrow_forward: "https://github.githubassets.com/images/icons/emoji/unicode/25b6.png?v8",
      arrow_heading_down: "https://github.githubassets.com/images/icons/emoji/unicode/2935.png?v8",
      arrow_heading_up: "https://github.githubassets.com/images/icons/emoji/unicode/2934.png?v8",
      arrow_left: "https://github.githubassets.com/images/icons/emoji/unicode/2b05.png?v8",
      arrow_lower_left: "https://github.githubassets.com/images/icons/emoji/unicode/2199.png?v8",
      arrow_lower_right: "https://github.githubassets.com/images/icons/emoji/unicode/2198.png?v8",
      arrow_right: "https://github.githubassets.com/images/icons/emoji/unicode/27a1.png?v8",
      arrow_right_hook: "https://github.githubassets.com/images/icons/emoji/unicode/21aa.png?v8",
      arrow_up: "https://github.githubassets.com/images/icons/emoji/unicode/2b06.png?v8",
      arrow_up_down: "https://github.githubassets.com/images/icons/emoji/unicode/2195.png?v8",
      arrow_up_small: "https://github.githubassets.com/images/icons/emoji/unicode/1f53c.png?v8",
      arrow_upper_left: "https://github.githubassets.com/images/icons/emoji/unicode/2196.png?v8",
      arrow_upper_right: "https://github.githubassets.com/images/icons/emoji/unicode/2197.png?v8",
      arrows_clockwise: "https://github.githubassets.com/images/icons/emoji/unicode/1f503.png?v8",
      arrows_counterclockwise: "https://github.githubassets.com/images/icons/emoji/unicode/1f504.png?v8",
      art: "https://github.githubassets.com/images/icons/emoji/unicode/1f3a8.png?v8",
      articulated_lorry: "https://github.githubassets.com/images/icons/emoji/unicode/1f69b.png?v8",
      artificial_satellite: "https://github.githubassets.com/images/icons/emoji/unicode/1f6f0.png?v8",
      artist: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f3a8.png?v8",
      aruba: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1fc.png?v8",
      ascension_island: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1e8.png?v8",
      asterisk: "https://github.githubassets.com/images/icons/emoji/unicode/002a-20e3.png?v8",
      astonished: "https://github.githubassets.com/images/icons/emoji/unicode/1f632.png?v8",
      astronaut: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f680.png?v8",
      athletic_shoe: "https://github.githubassets.com/images/icons/emoji/unicode/1f45f.png?v8",
      atm: "https://github.githubassets.com/images/icons/emoji/unicode/1f3e7.png?v8",
      atom: "https://github.githubassets.com/images/icons/emoji/atom.png?v8",
      atom_symbol: "https://github.githubassets.com/images/icons/emoji/unicode/269b.png?v8",
      australia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1fa.png?v8",
      austria: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1f9.png?v8",
      auto_rickshaw: "https://github.githubassets.com/images/icons/emoji/unicode/1f6fa.png?v8",
      avocado: "https://github.githubassets.com/images/icons/emoji/unicode/1f951.png?v8",
      axe: "https://github.githubassets.com/images/icons/emoji/unicode/1fa93.png?v8",
      azerbaijan: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1ff.png?v8",
      b: "https://github.githubassets.com/images/icons/emoji/unicode/1f171.png?v8",
      baby: "https://github.githubassets.com/images/icons/emoji/unicode/1f476.png?v8",
      baby_bottle: "https://github.githubassets.com/images/icons/emoji/unicode/1f37c.png?v8",
      baby_chick: "https://github.githubassets.com/images/icons/emoji/unicode/1f424.png?v8",
      baby_symbol: "https://github.githubassets.com/images/icons/emoji/unicode/1f6bc.png?v8",
      back: "https://github.githubassets.com/images/icons/emoji/unicode/1f519.png?v8",
      bacon: "https://github.githubassets.com/images/icons/emoji/unicode/1f953.png?v8",
      badger: "https://github.githubassets.com/images/icons/emoji/unicode/1f9a1.png?v8",
      badminton: "https://github.githubassets.com/images/icons/emoji/unicode/1f3f8.png?v8",
      bagel: "https://github.githubassets.com/images/icons/emoji/unicode/1f96f.png?v8",
      baggage_claim: "https://github.githubassets.com/images/icons/emoji/unicode/1f6c4.png?v8",
      baguette_bread: "https://github.githubassets.com/images/icons/emoji/unicode/1f956.png?v8",
      bahamas: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1f8.png?v8",
      bahrain: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1ed.png?v8",
      balance_scale: "https://github.githubassets.com/images/icons/emoji/unicode/2696.png?v8",
      bald_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f9b2.png?v8",
      bald_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f9b2.png?v8",
      ballet_shoes: "https://github.githubassets.com/images/icons/emoji/unicode/1fa70.png?v8",
      balloon: "https://github.githubassets.com/images/icons/emoji/unicode/1f388.png?v8",
      ballot_box: "https://github.githubassets.com/images/icons/emoji/unicode/1f5f3.png?v8",
      ballot_box_with_check: "https://github.githubassets.com/images/icons/emoji/unicode/2611.png?v8",
      bamboo: "https://github.githubassets.com/images/icons/emoji/unicode/1f38d.png?v8",
      banana: "https://github.githubassets.com/images/icons/emoji/unicode/1f34c.png?v8",
      bangbang: "https://github.githubassets.com/images/icons/emoji/unicode/203c.png?v8",
      bangladesh: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1e9.png?v8",
      banjo: "https://github.githubassets.com/images/icons/emoji/unicode/1fa95.png?v8",
      bank: "https://github.githubassets.com/images/icons/emoji/unicode/1f3e6.png?v8",
      bar_chart: "https://github.githubassets.com/images/icons/emoji/unicode/1f4ca.png?v8",
      barbados: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1e7.png?v8",
      barber: "https://github.githubassets.com/images/icons/emoji/unicode/1f488.png?v8",
      baseball: "https://github.githubassets.com/images/icons/emoji/unicode/26be.png?v8",
      basecamp: "https://github.githubassets.com/images/icons/emoji/basecamp.png?v8",
      basecampy: "https://github.githubassets.com/images/icons/emoji/basecampy.png?v8",
      basket: "https://github.githubassets.com/images/icons/emoji/unicode/1f9fa.png?v8",
      basketball: "https://github.githubassets.com/images/icons/emoji/unicode/1f3c0.png?v8",
      basketball_man: "https://github.githubassets.com/images/icons/emoji/unicode/26f9-2642.png?v8",
      basketball_woman: "https://github.githubassets.com/images/icons/emoji/unicode/26f9-2640.png?v8",
      bat: "https://github.githubassets.com/images/icons/emoji/unicode/1f987.png?v8",
      bath: "https://github.githubassets.com/images/icons/emoji/unicode/1f6c0.png?v8",
      bathtub: "https://github.githubassets.com/images/icons/emoji/unicode/1f6c1.png?v8",
      battery: "https://github.githubassets.com/images/icons/emoji/unicode/1f50b.png?v8",
      beach_umbrella: "https://github.githubassets.com/images/icons/emoji/unicode/1f3d6.png?v8",
      bear: "https://github.githubassets.com/images/icons/emoji/unicode/1f43b.png?v8",
      bearded_person: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d4.png?v8",
      bed: "https://github.githubassets.com/images/icons/emoji/unicode/1f6cf.png?v8",
      bee: "https://github.githubassets.com/images/icons/emoji/unicode/1f41d.png?v8",
      beer: "https://github.githubassets.com/images/icons/emoji/unicode/1f37a.png?v8",
      beers: "https://github.githubassets.com/images/icons/emoji/unicode/1f37b.png?v8",
      beetle: "https://github.githubassets.com/images/icons/emoji/unicode/1f41e.png?v8",
      beginner: "https://github.githubassets.com/images/icons/emoji/unicode/1f530.png?v8",
      belarus: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1fe.png?v8",
      belgium: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1ea.png?v8",
      belize: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1ff.png?v8",
      bell: "https://github.githubassets.com/images/icons/emoji/unicode/1f514.png?v8",
      bellhop_bell: "https://github.githubassets.com/images/icons/emoji/unicode/1f6ce.png?v8",
      benin: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1ef.png?v8",
      bento: "https://github.githubassets.com/images/icons/emoji/unicode/1f371.png?v8",
      bermuda: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1f2.png?v8",
      beverage_box: "https://github.githubassets.com/images/icons/emoji/unicode/1f9c3.png?v8",
      bhutan: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1f9.png?v8",
      bicyclist: "https://github.githubassets.com/images/icons/emoji/unicode/1f6b4.png?v8",
      bike: "https://github.githubassets.com/images/icons/emoji/unicode/1f6b2.png?v8",
      biking_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f6b4-2642.png?v8",
      biking_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f6b4-2640.png?v8",
      bikini: "https://github.githubassets.com/images/icons/emoji/unicode/1f459.png?v8",
      billed_cap: "https://github.githubassets.com/images/icons/emoji/unicode/1f9e2.png?v8",
      biohazard: "https://github.githubassets.com/images/icons/emoji/unicode/2623.png?v8",
      bird: "https://github.githubassets.com/images/icons/emoji/unicode/1f426.png?v8",
      birthday: "https://github.githubassets.com/images/icons/emoji/unicode/1f382.png?v8",
      black_circle: "https://github.githubassets.com/images/icons/emoji/unicode/26ab.png?v8",
      black_flag: "https://github.githubassets.com/images/icons/emoji/unicode/1f3f4.png?v8",
      black_heart: "https://github.githubassets.com/images/icons/emoji/unicode/1f5a4.png?v8",
      black_joker: "https://github.githubassets.com/images/icons/emoji/unicode/1f0cf.png?v8",
      black_large_square: "https://github.githubassets.com/images/icons/emoji/unicode/2b1b.png?v8",
      black_medium_small_square: "https://github.githubassets.com/images/icons/emoji/unicode/25fe.png?v8",
      black_medium_square: "https://github.githubassets.com/images/icons/emoji/unicode/25fc.png?v8",
      black_nib: "https://github.githubassets.com/images/icons/emoji/unicode/2712.png?v8",
      black_small_square: "https://github.githubassets.com/images/icons/emoji/unicode/25aa.png?v8",
      black_square_button: "https://github.githubassets.com/images/icons/emoji/unicode/1f532.png?v8",
      blond_haired_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f471-2642.png?v8",
      blond_haired_person: "https://github.githubassets.com/images/icons/emoji/unicode/1f471.png?v8",
      blond_haired_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f471-2640.png?v8",
      blonde_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f471-2640.png?v8",
      blossom: "https://github.githubassets.com/images/icons/emoji/unicode/1f33c.png?v8",
      blowfish: "https://github.githubassets.com/images/icons/emoji/unicode/1f421.png?v8",
      blue_book: "https://github.githubassets.com/images/icons/emoji/unicode/1f4d8.png?v8",
      blue_car: "https://github.githubassets.com/images/icons/emoji/unicode/1f699.png?v8",
      blue_heart: "https://github.githubassets.com/images/icons/emoji/unicode/1f499.png?v8",
      blue_square: "https://github.githubassets.com/images/icons/emoji/unicode/1f7e6.png?v8",
      blush: "https://github.githubassets.com/images/icons/emoji/unicode/1f60a.png?v8",
      boar: "https://github.githubassets.com/images/icons/emoji/unicode/1f417.png?v8",
      boat: "https://github.githubassets.com/images/icons/emoji/unicode/26f5.png?v8",
      bolivia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1f4.png?v8",
      bomb: "https://github.githubassets.com/images/icons/emoji/unicode/1f4a3.png?v8",
      bone: "https://github.githubassets.com/images/icons/emoji/unicode/1f9b4.png?v8",
      book: "https://github.githubassets.com/images/icons/emoji/unicode/1f4d6.png?v8",
      bookmark: "https://github.githubassets.com/images/icons/emoji/unicode/1f516.png?v8",
      bookmark_tabs: "https://github.githubassets.com/images/icons/emoji/unicode/1f4d1.png?v8",
      books: "https://github.githubassets.com/images/icons/emoji/unicode/1f4da.png?v8",
      boom: "https://github.githubassets.com/images/icons/emoji/unicode/1f4a5.png?v8",
      boot: "https://github.githubassets.com/images/icons/emoji/unicode/1f462.png?v8",
      bosnia_herzegovina: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1e6.png?v8",
      botswana: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1fc.png?v8",
      bouncing_ball_man: "https://github.githubassets.com/images/icons/emoji/unicode/26f9-2642.png?v8",
      bouncing_ball_person: "https://github.githubassets.com/images/icons/emoji/unicode/26f9.png?v8",
      bouncing_ball_woman: "https://github.githubassets.com/images/icons/emoji/unicode/26f9-2640.png?v8",
      bouquet: "https://github.githubassets.com/images/icons/emoji/unicode/1f490.png?v8",
      bouvet_island: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1fb.png?v8",
      bow: "https://github.githubassets.com/images/icons/emoji/unicode/1f647.png?v8",
      bow_and_arrow: "https://github.githubassets.com/images/icons/emoji/unicode/1f3f9.png?v8",
      bowing_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f647-2642.png?v8",
      bowing_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f647-2640.png?v8",
      bowl_with_spoon: "https://github.githubassets.com/images/icons/emoji/unicode/1f963.png?v8",
      bowling: "https://github.githubassets.com/images/icons/emoji/unicode/1f3b3.png?v8",
      bowtie: "https://github.githubassets.com/images/icons/emoji/bowtie.png?v8",
      boxing_glove: "https://github.githubassets.com/images/icons/emoji/unicode/1f94a.png?v8",
      boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f466.png?v8",
      brain: "https://github.githubassets.com/images/icons/emoji/unicode/1f9e0.png?v8",
      brazil: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1f7.png?v8",
      bread: "https://github.githubassets.com/images/icons/emoji/unicode/1f35e.png?v8",
      breast_feeding: "https://github.githubassets.com/images/icons/emoji/unicode/1f931.png?v8",
      bricks: "https://github.githubassets.com/images/icons/emoji/unicode/1f9f1.png?v8",
      bride_with_veil: "https://github.githubassets.com/images/icons/emoji/unicode/1f470.png?v8",
      bridge_at_night: "https://github.githubassets.com/images/icons/emoji/unicode/1f309.png?v8",
      briefcase: "https://github.githubassets.com/images/icons/emoji/unicode/1f4bc.png?v8",
      british_indian_ocean_territory: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f4.png?v8",
      british_virgin_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fb-1f1ec.png?v8",
      broccoli: "https://github.githubassets.com/images/icons/emoji/unicode/1f966.png?v8",
      broken_heart: "https://github.githubassets.com/images/icons/emoji/unicode/1f494.png?v8",
      broom: "https://github.githubassets.com/images/icons/emoji/unicode/1f9f9.png?v8",
      brown_circle: "https://github.githubassets.com/images/icons/emoji/unicode/1f7e4.png?v8",
      brown_heart: "https://github.githubassets.com/images/icons/emoji/unicode/1f90e.png?v8",
      brown_square: "https://github.githubassets.com/images/icons/emoji/unicode/1f7eb.png?v8",
      brunei: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1f3.png?v8",
      bug: "https://github.githubassets.com/images/icons/emoji/unicode/1f41b.png?v8",
      building_construction: "https://github.githubassets.com/images/icons/emoji/unicode/1f3d7.png?v8",
      bulb: "https://github.githubassets.com/images/icons/emoji/unicode/1f4a1.png?v8",
      bulgaria: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1ec.png?v8",
      bullettrain_front: "https://github.githubassets.com/images/icons/emoji/unicode/1f685.png?v8",
      bullettrain_side: "https://github.githubassets.com/images/icons/emoji/unicode/1f684.png?v8",
      burkina_faso: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1eb.png?v8",
      burrito: "https://github.githubassets.com/images/icons/emoji/unicode/1f32f.png?v8",
      burundi: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1ee.png?v8",
      bus: "https://github.githubassets.com/images/icons/emoji/unicode/1f68c.png?v8",
      business_suit_levitating: "https://github.githubassets.com/images/icons/emoji/unicode/1f574.png?v8",
      busstop: "https://github.githubassets.com/images/icons/emoji/unicode/1f68f.png?v8",
      bust_in_silhouette: "https://github.githubassets.com/images/icons/emoji/unicode/1f464.png?v8",
      busts_in_silhouette: "https://github.githubassets.com/images/icons/emoji/unicode/1f465.png?v8",
      butter: "https://github.githubassets.com/images/icons/emoji/unicode/1f9c8.png?v8",
      butterfly: "https://github.githubassets.com/images/icons/emoji/unicode/1f98b.png?v8",
      cactus: "https://github.githubassets.com/images/icons/emoji/unicode/1f335.png?v8",
      cake: "https://github.githubassets.com/images/icons/emoji/unicode/1f370.png?v8",
      calendar: "https://github.githubassets.com/images/icons/emoji/unicode/1f4c6.png?v8",
      call_me_hand: "https://github.githubassets.com/images/icons/emoji/unicode/1f919.png?v8",
      calling: "https://github.githubassets.com/images/icons/emoji/unicode/1f4f2.png?v8",
      cambodia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f0-1f1ed.png?v8",
      camel: "https://github.githubassets.com/images/icons/emoji/unicode/1f42b.png?v8",
      camera: "https://github.githubassets.com/images/icons/emoji/unicode/1f4f7.png?v8",
      camera_flash: "https://github.githubassets.com/images/icons/emoji/unicode/1f4f8.png?v8",
      cameroon: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1f2.png?v8",
      camping: "https://github.githubassets.com/images/icons/emoji/unicode/1f3d5.png?v8",
      canada: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1e6.png?v8",
      canary_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1e8.png?v8",
      cancer: "https://github.githubassets.com/images/icons/emoji/unicode/264b.png?v8",
      candle: "https://github.githubassets.com/images/icons/emoji/unicode/1f56f.png?v8",
      candy: "https://github.githubassets.com/images/icons/emoji/unicode/1f36c.png?v8",
      canned_food: "https://github.githubassets.com/images/icons/emoji/unicode/1f96b.png?v8",
      canoe: "https://github.githubassets.com/images/icons/emoji/unicode/1f6f6.png?v8",
      cape_verde: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1fb.png?v8",
      capital_abcd: "https://github.githubassets.com/images/icons/emoji/unicode/1f520.png?v8",
      capricorn: "https://github.githubassets.com/images/icons/emoji/unicode/2651.png?v8",
      car: "https://github.githubassets.com/images/icons/emoji/unicode/1f697.png?v8",
      card_file_box: "https://github.githubassets.com/images/icons/emoji/unicode/1f5c3.png?v8",
      card_index: "https://github.githubassets.com/images/icons/emoji/unicode/1f4c7.png?v8",
      card_index_dividers: "https://github.githubassets.com/images/icons/emoji/unicode/1f5c2.png?v8",
      caribbean_netherlands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1f6.png?v8",
      carousel_horse: "https://github.githubassets.com/images/icons/emoji/unicode/1f3a0.png?v8",
      carrot: "https://github.githubassets.com/images/icons/emoji/unicode/1f955.png?v8",
      cartwheeling: "https://github.githubassets.com/images/icons/emoji/unicode/1f938.png?v8",
      cat: "https://github.githubassets.com/images/icons/emoji/unicode/1f431.png?v8",
      cat2: "https://github.githubassets.com/images/icons/emoji/unicode/1f408.png?v8",
      cayman_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f0-1f1fe.png?v8",
      cd: "https://github.githubassets.com/images/icons/emoji/unicode/1f4bf.png?v8",
      central_african_republic: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1eb.png?v8",
      ceuta_melilla: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ea-1f1e6.png?v8",
      chad: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1e9.png?v8",
      chains: "https://github.githubassets.com/images/icons/emoji/unicode/26d3.png?v8",
      chair: "https://github.githubassets.com/images/icons/emoji/unicode/1fa91.png?v8",
      champagne: "https://github.githubassets.com/images/icons/emoji/unicode/1f37e.png?v8",
      chart: "https://github.githubassets.com/images/icons/emoji/unicode/1f4b9.png?v8",
      chart_with_downwards_trend: "https://github.githubassets.com/images/icons/emoji/unicode/1f4c9.png?v8",
      chart_with_upwards_trend: "https://github.githubassets.com/images/icons/emoji/unicode/1f4c8.png?v8",
      checkered_flag: "https://github.githubassets.com/images/icons/emoji/unicode/1f3c1.png?v8",
      cheese: "https://github.githubassets.com/images/icons/emoji/unicode/1f9c0.png?v8",
      cherries: "https://github.githubassets.com/images/icons/emoji/unicode/1f352.png?v8",
      cherry_blossom: "https://github.githubassets.com/images/icons/emoji/unicode/1f338.png?v8",
      chess_pawn: "https://github.githubassets.com/images/icons/emoji/unicode/265f.png?v8",
      chestnut: "https://github.githubassets.com/images/icons/emoji/unicode/1f330.png?v8",
      chicken: "https://github.githubassets.com/images/icons/emoji/unicode/1f414.png?v8",
      child: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d2.png?v8",
      children_crossing: "https://github.githubassets.com/images/icons/emoji/unicode/1f6b8.png?v8",
      chile: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1f1.png?v8",
      chipmunk: "https://github.githubassets.com/images/icons/emoji/unicode/1f43f.png?v8",
      chocolate_bar: "https://github.githubassets.com/images/icons/emoji/unicode/1f36b.png?v8",
      chopsticks: "https://github.githubassets.com/images/icons/emoji/unicode/1f962.png?v8",
      christmas_island: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1fd.png?v8",
      christmas_tree: "https://github.githubassets.com/images/icons/emoji/unicode/1f384.png?v8",
      church: "https://github.githubassets.com/images/icons/emoji/unicode/26ea.png?v8",
      cinema: "https://github.githubassets.com/images/icons/emoji/unicode/1f3a6.png?v8",
      circus_tent: "https://github.githubassets.com/images/icons/emoji/unicode/1f3aa.png?v8",
      city_sunrise: "https://github.githubassets.com/images/icons/emoji/unicode/1f307.png?v8",
      city_sunset: "https://github.githubassets.com/images/icons/emoji/unicode/1f306.png?v8",
      cityscape: "https://github.githubassets.com/images/icons/emoji/unicode/1f3d9.png?v8",
      cl: "https://github.githubassets.com/images/icons/emoji/unicode/1f191.png?v8",
      clamp: "https://github.githubassets.com/images/icons/emoji/unicode/1f5dc.png?v8",
      clap: "https://github.githubassets.com/images/icons/emoji/unicode/1f44f.png?v8",
      clapper: "https://github.githubassets.com/images/icons/emoji/unicode/1f3ac.png?v8",
      classical_building: "https://github.githubassets.com/images/icons/emoji/unicode/1f3db.png?v8",
      climbing: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d7.png?v8",
      climbing_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d7-2642.png?v8",
      climbing_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d7-2640.png?v8",
      clinking_glasses: "https://github.githubassets.com/images/icons/emoji/unicode/1f942.png?v8",
      clipboard: "https://github.githubassets.com/images/icons/emoji/unicode/1f4cb.png?v8",
      clipperton_island: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1f5.png?v8",
      clock1: "https://github.githubassets.com/images/icons/emoji/unicode/1f550.png?v8",
      clock10: "https://github.githubassets.com/images/icons/emoji/unicode/1f559.png?v8",
      clock1030: "https://github.githubassets.com/images/icons/emoji/unicode/1f565.png?v8",
      clock11: "https://github.githubassets.com/images/icons/emoji/unicode/1f55a.png?v8",
      clock1130: "https://github.githubassets.com/images/icons/emoji/unicode/1f566.png?v8",
      clock12: "https://github.githubassets.com/images/icons/emoji/unicode/1f55b.png?v8",
      clock1230: "https://github.githubassets.com/images/icons/emoji/unicode/1f567.png?v8",
      clock130: "https://github.githubassets.com/images/icons/emoji/unicode/1f55c.png?v8",
      clock2: "https://github.githubassets.com/images/icons/emoji/unicode/1f551.png?v8",
      clock230: "https://github.githubassets.com/images/icons/emoji/unicode/1f55d.png?v8",
      clock3: "https://github.githubassets.com/images/icons/emoji/unicode/1f552.png?v8",
      clock330: "https://github.githubassets.com/images/icons/emoji/unicode/1f55e.png?v8",
      clock4: "https://github.githubassets.com/images/icons/emoji/unicode/1f553.png?v8",
      clock430: "https://github.githubassets.com/images/icons/emoji/unicode/1f55f.png?v8",
      clock5: "https://github.githubassets.com/images/icons/emoji/unicode/1f554.png?v8",
      clock530: "https://github.githubassets.com/images/icons/emoji/unicode/1f560.png?v8",
      clock6: "https://github.githubassets.com/images/icons/emoji/unicode/1f555.png?v8",
      clock630: "https://github.githubassets.com/images/icons/emoji/unicode/1f561.png?v8",
      clock7: "https://github.githubassets.com/images/icons/emoji/unicode/1f556.png?v8",
      clock730: "https://github.githubassets.com/images/icons/emoji/unicode/1f562.png?v8",
      clock8: "https://github.githubassets.com/images/icons/emoji/unicode/1f557.png?v8",
      clock830: "https://github.githubassets.com/images/icons/emoji/unicode/1f563.png?v8",
      clock9: "https://github.githubassets.com/images/icons/emoji/unicode/1f558.png?v8",
      clock930: "https://github.githubassets.com/images/icons/emoji/unicode/1f564.png?v8",
      closed_book: "https://github.githubassets.com/images/icons/emoji/unicode/1f4d5.png?v8",
      closed_lock_with_key: "https://github.githubassets.com/images/icons/emoji/unicode/1f510.png?v8",
      closed_umbrella: "https://github.githubassets.com/images/icons/emoji/unicode/1f302.png?v8",
      cloud: "https://github.githubassets.com/images/icons/emoji/unicode/2601.png?v8",
      cloud_with_lightning: "https://github.githubassets.com/images/icons/emoji/unicode/1f329.png?v8",
      cloud_with_lightning_and_rain: "https://github.githubassets.com/images/icons/emoji/unicode/26c8.png?v8",
      cloud_with_rain: "https://github.githubassets.com/images/icons/emoji/unicode/1f327.png?v8",
      cloud_with_snow: "https://github.githubassets.com/images/icons/emoji/unicode/1f328.png?v8",
      clown_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f921.png?v8",
      clubs: "https://github.githubassets.com/images/icons/emoji/unicode/2663.png?v8",
      cn: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1f3.png?v8",
      coat: "https://github.githubassets.com/images/icons/emoji/unicode/1f9e5.png?v8",
      cocktail: "https://github.githubassets.com/images/icons/emoji/unicode/1f378.png?v8",
      coconut: "https://github.githubassets.com/images/icons/emoji/unicode/1f965.png?v8",
      cocos_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1e8.png?v8",
      coffee: "https://github.githubassets.com/images/icons/emoji/unicode/2615.png?v8",
      coffin: "https://github.githubassets.com/images/icons/emoji/unicode/26b0.png?v8",
      cold_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f976.png?v8",
      cold_sweat: "https://github.githubassets.com/images/icons/emoji/unicode/1f630.png?v8",
      collision: "https://github.githubassets.com/images/icons/emoji/unicode/1f4a5.png?v8",
      colombia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1f4.png?v8",
      comet: "https://github.githubassets.com/images/icons/emoji/unicode/2604.png?v8",
      comoros: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f0-1f1f2.png?v8",
      compass: "https://github.githubassets.com/images/icons/emoji/unicode/1f9ed.png?v8",
      computer: "https://github.githubassets.com/images/icons/emoji/unicode/1f4bb.png?v8",
      computer_mouse: "https://github.githubassets.com/images/icons/emoji/unicode/1f5b1.png?v8",
      confetti_ball: "https://github.githubassets.com/images/icons/emoji/unicode/1f38a.png?v8",
      confounded: "https://github.githubassets.com/images/icons/emoji/unicode/1f616.png?v8",
      confused: "https://github.githubassets.com/images/icons/emoji/unicode/1f615.png?v8",
      congo_brazzaville: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1ec.png?v8",
      congo_kinshasa: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1e9.png?v8",
      congratulations: "https://github.githubassets.com/images/icons/emoji/unicode/3297.png?v8",
      construction: "https://github.githubassets.com/images/icons/emoji/unicode/1f6a7.png?v8",
      construction_worker: "https://github.githubassets.com/images/icons/emoji/unicode/1f477.png?v8",
      construction_worker_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f477-2642.png?v8",
      construction_worker_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f477-2640.png?v8",
      control_knobs: "https://github.githubassets.com/images/icons/emoji/unicode/1f39b.png?v8",
      convenience_store: "https://github.githubassets.com/images/icons/emoji/unicode/1f3ea.png?v8",
      cook: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f373.png?v8",
      cook_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1f0.png?v8",
      cookie: "https://github.githubassets.com/images/icons/emoji/unicode/1f36a.png?v8",
      cool: "https://github.githubassets.com/images/icons/emoji/unicode/1f192.png?v8",
      cop: "https://github.githubassets.com/images/icons/emoji/unicode/1f46e.png?v8",
      copyright: "https://github.githubassets.com/images/icons/emoji/unicode/00a9.png?v8",
      corn: "https://github.githubassets.com/images/icons/emoji/unicode/1f33d.png?v8",
      costa_rica: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1f7.png?v8",
      cote_divoire: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1ee.png?v8",
      couch_and_lamp: "https://github.githubassets.com/images/icons/emoji/unicode/1f6cb.png?v8",
      couple: "https://github.githubassets.com/images/icons/emoji/unicode/1f46b.png?v8",
      couple_with_heart: "https://github.githubassets.com/images/icons/emoji/unicode/1f491.png?v8",
      couple_with_heart_man_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-2764-1f468.png?v8",
      couple_with_heart_woman_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-2764-1f468.png?v8",
      couple_with_heart_woman_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-2764-1f469.png?v8",
      couplekiss: "https://github.githubassets.com/images/icons/emoji/unicode/1f48f.png?v8",
      couplekiss_man_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-2764-1f48b-1f468.png?v8",
      couplekiss_man_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-2764-1f48b-1f468.png?v8",
      couplekiss_woman_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-2764-1f48b-1f469.png?v8",
      cow: "https://github.githubassets.com/images/icons/emoji/unicode/1f42e.png?v8",
      cow2: "https://github.githubassets.com/images/icons/emoji/unicode/1f404.png?v8",
      cowboy_hat_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f920.png?v8",
      crab: "https://github.githubassets.com/images/icons/emoji/unicode/1f980.png?v8",
      crayon: "https://github.githubassets.com/images/icons/emoji/unicode/1f58d.png?v8",
      credit_card: "https://github.githubassets.com/images/icons/emoji/unicode/1f4b3.png?v8",
      crescent_moon: "https://github.githubassets.com/images/icons/emoji/unicode/1f319.png?v8",
      cricket: "https://github.githubassets.com/images/icons/emoji/unicode/1f997.png?v8",
      cricket_game: "https://github.githubassets.com/images/icons/emoji/unicode/1f3cf.png?v8",
      croatia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ed-1f1f7.png?v8",
      crocodile: "https://github.githubassets.com/images/icons/emoji/unicode/1f40a.png?v8",
      croissant: "https://github.githubassets.com/images/icons/emoji/unicode/1f950.png?v8",
      crossed_fingers: "https://github.githubassets.com/images/icons/emoji/unicode/1f91e.png?v8",
      crossed_flags: "https://github.githubassets.com/images/icons/emoji/unicode/1f38c.png?v8",
      crossed_swords: "https://github.githubassets.com/images/icons/emoji/unicode/2694.png?v8",
      crown: "https://github.githubassets.com/images/icons/emoji/unicode/1f451.png?v8",
      cry: "https://github.githubassets.com/images/icons/emoji/unicode/1f622.png?v8",
      crying_cat_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f63f.png?v8",
      crystal_ball: "https://github.githubassets.com/images/icons/emoji/unicode/1f52e.png?v8",
      cuba: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1fa.png?v8",
      cucumber: "https://github.githubassets.com/images/icons/emoji/unicode/1f952.png?v8",
      cup_with_straw: "https://github.githubassets.com/images/icons/emoji/unicode/1f964.png?v8",
      cupcake: "https://github.githubassets.com/images/icons/emoji/unicode/1f9c1.png?v8",
      cupid: "https://github.githubassets.com/images/icons/emoji/unicode/1f498.png?v8",
      curacao: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1fc.png?v8",
      curling_stone: "https://github.githubassets.com/images/icons/emoji/unicode/1f94c.png?v8",
      curly_haired_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f9b1.png?v8",
      curly_haired_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f9b1.png?v8",
      curly_loop: "https://github.githubassets.com/images/icons/emoji/unicode/27b0.png?v8",
      currency_exchange: "https://github.githubassets.com/images/icons/emoji/unicode/1f4b1.png?v8",
      curry: "https://github.githubassets.com/images/icons/emoji/unicode/1f35b.png?v8",
      cursing_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f92c.png?v8",
      custard: "https://github.githubassets.com/images/icons/emoji/unicode/1f36e.png?v8",
      customs: "https://github.githubassets.com/images/icons/emoji/unicode/1f6c3.png?v8",
      cut_of_meat: "https://github.githubassets.com/images/icons/emoji/unicode/1f969.png?v8",
      cyclone: "https://github.githubassets.com/images/icons/emoji/unicode/1f300.png?v8",
      cyprus: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1fe.png?v8",
      czech_republic: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1ff.png?v8",
      dagger: "https://github.githubassets.com/images/icons/emoji/unicode/1f5e1.png?v8",
      dancer: "https://github.githubassets.com/images/icons/emoji/unicode/1f483.png?v8",
      dancers: "https://github.githubassets.com/images/icons/emoji/unicode/1f46f.png?v8",
      dancing_men: "https://github.githubassets.com/images/icons/emoji/unicode/1f46f-2642.png?v8",
      dancing_women: "https://github.githubassets.com/images/icons/emoji/unicode/1f46f-2640.png?v8",
      dango: "https://github.githubassets.com/images/icons/emoji/unicode/1f361.png?v8",
      dark_sunglasses: "https://github.githubassets.com/images/icons/emoji/unicode/1f576.png?v8",
      dart: "https://github.githubassets.com/images/icons/emoji/unicode/1f3af.png?v8",
      dash: "https://github.githubassets.com/images/icons/emoji/unicode/1f4a8.png?v8",
      date: "https://github.githubassets.com/images/icons/emoji/unicode/1f4c5.png?v8",
      de: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e9-1f1ea.png?v8",
      deaf_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f9cf-2642.png?v8",
      deaf_person: "https://github.githubassets.com/images/icons/emoji/unicode/1f9cf.png?v8",
      deaf_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f9cf-2640.png?v8",
      deciduous_tree: "https://github.githubassets.com/images/icons/emoji/unicode/1f333.png?v8",
      deer: "https://github.githubassets.com/images/icons/emoji/unicode/1f98c.png?v8",
      denmark: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e9-1f1f0.png?v8",
      department_store: "https://github.githubassets.com/images/icons/emoji/unicode/1f3ec.png?v8",
      derelict_house: "https://github.githubassets.com/images/icons/emoji/unicode/1f3da.png?v8",
      desert: "https://github.githubassets.com/images/icons/emoji/unicode/1f3dc.png?v8",
      desert_island: "https://github.githubassets.com/images/icons/emoji/unicode/1f3dd.png?v8",
      desktop_computer: "https://github.githubassets.com/images/icons/emoji/unicode/1f5a5.png?v8",
      detective: "https://github.githubassets.com/images/icons/emoji/unicode/1f575.png?v8",
      diamond_shape_with_a_dot_inside: "https://github.githubassets.com/images/icons/emoji/unicode/1f4a0.png?v8",
      diamonds: "https://github.githubassets.com/images/icons/emoji/unicode/2666.png?v8",
      diego_garcia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e9-1f1ec.png?v8",
      disappointed: "https://github.githubassets.com/images/icons/emoji/unicode/1f61e.png?v8",
      disappointed_relieved: "https://github.githubassets.com/images/icons/emoji/unicode/1f625.png?v8",
      diving_mask: "https://github.githubassets.com/images/icons/emoji/unicode/1f93f.png?v8",
      diya_lamp: "https://github.githubassets.com/images/icons/emoji/unicode/1fa94.png?v8",
      dizzy: "https://github.githubassets.com/images/icons/emoji/unicode/1f4ab.png?v8",
      dizzy_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f635.png?v8",
      djibouti: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e9-1f1ef.png?v8",
      dna: "https://github.githubassets.com/images/icons/emoji/unicode/1f9ec.png?v8",
      do_not_litter: "https://github.githubassets.com/images/icons/emoji/unicode/1f6af.png?v8",
      dog: "https://github.githubassets.com/images/icons/emoji/unicode/1f436.png?v8",
      dog2: "https://github.githubassets.com/images/icons/emoji/unicode/1f415.png?v8",
      dollar: "https://github.githubassets.com/images/icons/emoji/unicode/1f4b5.png?v8",
      dolls: "https://github.githubassets.com/images/icons/emoji/unicode/1f38e.png?v8",
      dolphin: "https://github.githubassets.com/images/icons/emoji/unicode/1f42c.png?v8",
      dominica: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e9-1f1f2.png?v8",
      dominican_republic: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e9-1f1f4.png?v8",
      door: "https://github.githubassets.com/images/icons/emoji/unicode/1f6aa.png?v8",
      doughnut: "https://github.githubassets.com/images/icons/emoji/unicode/1f369.png?v8",
      dove: "https://github.githubassets.com/images/icons/emoji/unicode/1f54a.png?v8",
      dragon: "https://github.githubassets.com/images/icons/emoji/unicode/1f409.png?v8",
      dragon_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f432.png?v8",
      dress: "https://github.githubassets.com/images/icons/emoji/unicode/1f457.png?v8",
      dromedary_camel: "https://github.githubassets.com/images/icons/emoji/unicode/1f42a.png?v8",
      drooling_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f924.png?v8",
      drop_of_blood: "https://github.githubassets.com/images/icons/emoji/unicode/1fa78.png?v8",
      droplet: "https://github.githubassets.com/images/icons/emoji/unicode/1f4a7.png?v8",
      drum: "https://github.githubassets.com/images/icons/emoji/unicode/1f941.png?v8",
      duck: "https://github.githubassets.com/images/icons/emoji/unicode/1f986.png?v8",
      dumpling: "https://github.githubassets.com/images/icons/emoji/unicode/1f95f.png?v8",
      dvd: "https://github.githubassets.com/images/icons/emoji/unicode/1f4c0.png?v8",
      "e-mail": "https://github.githubassets.com/images/icons/emoji/unicode/1f4e7.png?v8",
      eagle: "https://github.githubassets.com/images/icons/emoji/unicode/1f985.png?v8",
      ear: "https://github.githubassets.com/images/icons/emoji/unicode/1f442.png?v8",
      ear_of_rice: "https://github.githubassets.com/images/icons/emoji/unicode/1f33e.png?v8",
      ear_with_hearing_aid: "https://github.githubassets.com/images/icons/emoji/unicode/1f9bb.png?v8",
      earth_africa: "https://github.githubassets.com/images/icons/emoji/unicode/1f30d.png?v8",
      earth_americas: "https://github.githubassets.com/images/icons/emoji/unicode/1f30e.png?v8",
      earth_asia: "https://github.githubassets.com/images/icons/emoji/unicode/1f30f.png?v8",
      ecuador: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ea-1f1e8.png?v8",
      egg: "https://github.githubassets.com/images/icons/emoji/unicode/1f95a.png?v8",
      eggplant: "https://github.githubassets.com/images/icons/emoji/unicode/1f346.png?v8",
      egypt: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ea-1f1ec.png?v8",
      eight: "https://github.githubassets.com/images/icons/emoji/unicode/0038-20e3.png?v8",
      eight_pointed_black_star: "https://github.githubassets.com/images/icons/emoji/unicode/2734.png?v8",
      eight_spoked_asterisk: "https://github.githubassets.com/images/icons/emoji/unicode/2733.png?v8",
      eject_button: "https://github.githubassets.com/images/icons/emoji/unicode/23cf.png?v8",
      el_salvador: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1fb.png?v8",
      electric_plug: "https://github.githubassets.com/images/icons/emoji/unicode/1f50c.png?v8",
      electron: "https://github.githubassets.com/images/icons/emoji/electron.png?v8",
      elephant: "https://github.githubassets.com/images/icons/emoji/unicode/1f418.png?v8",
      elf: "https://github.githubassets.com/images/icons/emoji/unicode/1f9dd.png?v8",
      elf_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f9dd-2642.png?v8",
      elf_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f9dd-2640.png?v8",
      email: "https://github.githubassets.com/images/icons/emoji/unicode/2709.png?v8",
      end: "https://github.githubassets.com/images/icons/emoji/unicode/1f51a.png?v8",
      england: "https://github.githubassets.com/images/icons/emoji/unicode/1f3f4-e0067-e0062-e0065-e006e-e0067-e007f.png?v8",
      envelope: "https://github.githubassets.com/images/icons/emoji/unicode/2709.png?v8",
      envelope_with_arrow: "https://github.githubassets.com/images/icons/emoji/unicode/1f4e9.png?v8",
      equatorial_guinea: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1f6.png?v8",
      eritrea: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ea-1f1f7.png?v8",
      es: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ea-1f1f8.png?v8",
      estonia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ea-1f1ea.png?v8",
      ethiopia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ea-1f1f9.png?v8",
      eu: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ea-1f1fa.png?v8",
      euro: "https://github.githubassets.com/images/icons/emoji/unicode/1f4b6.png?v8",
      european_castle: "https://github.githubassets.com/images/icons/emoji/unicode/1f3f0.png?v8",
      european_post_office: "https://github.githubassets.com/images/icons/emoji/unicode/1f3e4.png?v8",
      european_union: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ea-1f1fa.png?v8",
      evergreen_tree: "https://github.githubassets.com/images/icons/emoji/unicode/1f332.png?v8",
      exclamation: "https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8",
      exploding_head: "https://github.githubassets.com/images/icons/emoji/unicode/1f92f.png?v8",
      expressionless: "https://github.githubassets.com/images/icons/emoji/unicode/1f611.png?v8",
      eye: "https://github.githubassets.com/images/icons/emoji/unicode/1f441.png?v8",
      eye_speech_bubble: "https://github.githubassets.com/images/icons/emoji/unicode/1f441-1f5e8.png?v8",
      eyeglasses: "https://github.githubassets.com/images/icons/emoji/unicode/1f453.png?v8",
      eyes: "https://github.githubassets.com/images/icons/emoji/unicode/1f440.png?v8",
      face_with_head_bandage: "https://github.githubassets.com/images/icons/emoji/unicode/1f915.png?v8",
      face_with_thermometer: "https://github.githubassets.com/images/icons/emoji/unicode/1f912.png?v8",
      facepalm: "https://github.githubassets.com/images/icons/emoji/unicode/1f926.png?v8",
      facepunch: "https://github.githubassets.com/images/icons/emoji/unicode/1f44a.png?v8",
      factory: "https://github.githubassets.com/images/icons/emoji/unicode/1f3ed.png?v8",
      factory_worker: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f3ed.png?v8",
      fairy: "https://github.githubassets.com/images/icons/emoji/unicode/1f9da.png?v8",
      fairy_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f9da-2642.png?v8",
      fairy_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f9da-2640.png?v8",
      falafel: "https://github.githubassets.com/images/icons/emoji/unicode/1f9c6.png?v8",
      falkland_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1eb-1f1f0.png?v8",
      fallen_leaf: "https://github.githubassets.com/images/icons/emoji/unicode/1f342.png?v8",
      family: "https://github.githubassets.com/images/icons/emoji/unicode/1f46a.png?v8",
      family_man_boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f466.png?v8",
      family_man_boy_boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f466-1f466.png?v8",
      family_man_girl: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f467.png?v8",
      family_man_girl_boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f467-1f466.png?v8",
      family_man_girl_girl: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f467-1f467.png?v8",
      family_man_man_boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f468-1f466.png?v8",
      family_man_man_boy_boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f468-1f466-1f466.png?v8",
      family_man_man_girl: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f468-1f467.png?v8",
      family_man_man_girl_boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f468-1f467-1f466.png?v8",
      family_man_man_girl_girl: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f468-1f467-1f467.png?v8",
      family_man_woman_boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f469-1f466.png?v8",
      family_man_woman_boy_boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f469-1f466-1f466.png?v8",
      family_man_woman_girl: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f469-1f467.png?v8",
      family_man_woman_girl_boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f469-1f467-1f466.png?v8",
      family_man_woman_girl_girl: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f469-1f467-1f467.png?v8",
      family_woman_boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f466.png?v8",
      family_woman_boy_boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f466-1f466.png?v8",
      family_woman_girl: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f467.png?v8",
      family_woman_girl_boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f467-1f466.png?v8",
      family_woman_girl_girl: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f467-1f467.png?v8",
      family_woman_woman_boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f469-1f466.png?v8",
      family_woman_woman_boy_boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f469-1f466-1f466.png?v8",
      family_woman_woman_girl: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f469-1f467.png?v8",
      family_woman_woman_girl_boy: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f469-1f467-1f466.png?v8",
      family_woman_woman_girl_girl: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f469-1f467-1f467.png?v8",
      farmer: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f33e.png?v8",
      faroe_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1eb-1f1f4.png?v8",
      fast_forward: "https://github.githubassets.com/images/icons/emoji/unicode/23e9.png?v8",
      fax: "https://github.githubassets.com/images/icons/emoji/unicode/1f4e0.png?v8",
      fearful: "https://github.githubassets.com/images/icons/emoji/unicode/1f628.png?v8",
      feelsgood: "https://github.githubassets.com/images/icons/emoji/feelsgood.png?v8",
      feet: "https://github.githubassets.com/images/icons/emoji/unicode/1f43e.png?v8",
      female_detective: "https://github.githubassets.com/images/icons/emoji/unicode/1f575-2640.png?v8",
      female_sign: "https://github.githubassets.com/images/icons/emoji/unicode/2640.png?v8",
      ferris_wheel: "https://github.githubassets.com/images/icons/emoji/unicode/1f3a1.png?v8",
      ferry: "https://github.githubassets.com/images/icons/emoji/unicode/26f4.png?v8",
      field_hockey: "https://github.githubassets.com/images/icons/emoji/unicode/1f3d1.png?v8",
      fiji: "https://github.githubassets.com/images/icons/emoji/unicode/1f1eb-1f1ef.png?v8",
      file_cabinet: "https://github.githubassets.com/images/icons/emoji/unicode/1f5c4.png?v8",
      file_folder: "https://github.githubassets.com/images/icons/emoji/unicode/1f4c1.png?v8",
      film_projector: "https://github.githubassets.com/images/icons/emoji/unicode/1f4fd.png?v8",
      film_strip: "https://github.githubassets.com/images/icons/emoji/unicode/1f39e.png?v8",
      finland: "https://github.githubassets.com/images/icons/emoji/unicode/1f1eb-1f1ee.png?v8",
      finnadie: "https://github.githubassets.com/images/icons/emoji/finnadie.png?v8",
      fire: "https://github.githubassets.com/images/icons/emoji/unicode/1f525.png?v8",
      fire_engine: "https://github.githubassets.com/images/icons/emoji/unicode/1f692.png?v8",
      fire_extinguisher: "https://github.githubassets.com/images/icons/emoji/unicode/1f9ef.png?v8",
      firecracker: "https://github.githubassets.com/images/icons/emoji/unicode/1f9e8.png?v8",
      firefighter: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f692.png?v8",
      fireworks: "https://github.githubassets.com/images/icons/emoji/unicode/1f386.png?v8",
      first_quarter_moon: "https://github.githubassets.com/images/icons/emoji/unicode/1f313.png?v8",
      first_quarter_moon_with_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f31b.png?v8",
      fish: "https://github.githubassets.com/images/icons/emoji/unicode/1f41f.png?v8",
      fish_cake: "https://github.githubassets.com/images/icons/emoji/unicode/1f365.png?v8",
      fishing_pole_and_fish: "https://github.githubassets.com/images/icons/emoji/unicode/1f3a3.png?v8",
      fist: "https://github.githubassets.com/images/icons/emoji/unicode/270a.png?v8",
      fist_left: "https://github.githubassets.com/images/icons/emoji/unicode/1f91b.png?v8",
      fist_oncoming: "https://github.githubassets.com/images/icons/emoji/unicode/1f44a.png?v8",
      fist_raised: "https://github.githubassets.com/images/icons/emoji/unicode/270a.png?v8",
      fist_right: "https://github.githubassets.com/images/icons/emoji/unicode/1f91c.png?v8",
      five: "https://github.githubassets.com/images/icons/emoji/unicode/0035-20e3.png?v8",
      flags: "https://github.githubassets.com/images/icons/emoji/unicode/1f38f.png?v8",
      flamingo: "https://github.githubassets.com/images/icons/emoji/unicode/1f9a9.png?v8",
      flashlight: "https://github.githubassets.com/images/icons/emoji/unicode/1f526.png?v8",
      flat_shoe: "https://github.githubassets.com/images/icons/emoji/unicode/1f97f.png?v8",
      fleur_de_lis: "https://github.githubassets.com/images/icons/emoji/unicode/269c.png?v8",
      flight_arrival: "https://github.githubassets.com/images/icons/emoji/unicode/1f6ec.png?v8",
      flight_departure: "https://github.githubassets.com/images/icons/emoji/unicode/1f6eb.png?v8",
      flipper: "https://github.githubassets.com/images/icons/emoji/unicode/1f42c.png?v8",
      floppy_disk: "https://github.githubassets.com/images/icons/emoji/unicode/1f4be.png?v8",
      flower_playing_cards: "https://github.githubassets.com/images/icons/emoji/unicode/1f3b4.png?v8",
      flushed: "https://github.githubassets.com/images/icons/emoji/unicode/1f633.png?v8",
      flying_disc: "https://github.githubassets.com/images/icons/emoji/unicode/1f94f.png?v8",
      flying_saucer: "https://github.githubassets.com/images/icons/emoji/unicode/1f6f8.png?v8",
      fog: "https://github.githubassets.com/images/icons/emoji/unicode/1f32b.png?v8",
      foggy: "https://github.githubassets.com/images/icons/emoji/unicode/1f301.png?v8",
      foot: "https://github.githubassets.com/images/icons/emoji/unicode/1f9b6.png?v8",
      football: "https://github.githubassets.com/images/icons/emoji/unicode/1f3c8.png?v8",
      footprints: "https://github.githubassets.com/images/icons/emoji/unicode/1f463.png?v8",
      fork_and_knife: "https://github.githubassets.com/images/icons/emoji/unicode/1f374.png?v8",
      fortune_cookie: "https://github.githubassets.com/images/icons/emoji/unicode/1f960.png?v8",
      fountain: "https://github.githubassets.com/images/icons/emoji/unicode/26f2.png?v8",
      fountain_pen: "https://github.githubassets.com/images/icons/emoji/unicode/1f58b.png?v8",
      four: "https://github.githubassets.com/images/icons/emoji/unicode/0034-20e3.png?v8",
      four_leaf_clover: "https://github.githubassets.com/images/icons/emoji/unicode/1f340.png?v8",
      fox_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f98a.png?v8",
      fr: "https://github.githubassets.com/images/icons/emoji/unicode/1f1eb-1f1f7.png?v8",
      framed_picture: "https://github.githubassets.com/images/icons/emoji/unicode/1f5bc.png?v8",
      free: "https://github.githubassets.com/images/icons/emoji/unicode/1f193.png?v8",
      french_guiana: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1eb.png?v8",
      french_polynesia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f5-1f1eb.png?v8",
      french_southern_territories: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1eb.png?v8",
      fried_egg: "https://github.githubassets.com/images/icons/emoji/unicode/1f373.png?v8",
      fried_shrimp: "https://github.githubassets.com/images/icons/emoji/unicode/1f364.png?v8",
      fries: "https://github.githubassets.com/images/icons/emoji/unicode/1f35f.png?v8",
      frog: "https://github.githubassets.com/images/icons/emoji/unicode/1f438.png?v8",
      frowning: "https://github.githubassets.com/images/icons/emoji/unicode/1f626.png?v8",
      frowning_face: "https://github.githubassets.com/images/icons/emoji/unicode/2639.png?v8",
      frowning_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f64d-2642.png?v8",
      frowning_person: "https://github.githubassets.com/images/icons/emoji/unicode/1f64d.png?v8",
      frowning_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f64d-2640.png?v8",
      fu: "https://github.githubassets.com/images/icons/emoji/unicode/1f595.png?v8",
      fuelpump: "https://github.githubassets.com/images/icons/emoji/unicode/26fd.png?v8",
      full_moon: "https://github.githubassets.com/images/icons/emoji/unicode/1f315.png?v8",
      full_moon_with_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f31d.png?v8",
      funeral_urn: "https://github.githubassets.com/images/icons/emoji/unicode/26b1.png?v8",
      gabon: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1e6.png?v8",
      gambia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1f2.png?v8",
      game_die: "https://github.githubassets.com/images/icons/emoji/unicode/1f3b2.png?v8",
      garlic: "https://github.githubassets.com/images/icons/emoji/unicode/1f9c4.png?v8",
      gb: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1e7.png?v8",
      gear: "https://github.githubassets.com/images/icons/emoji/unicode/2699.png?v8",
      gem: "https://github.githubassets.com/images/icons/emoji/unicode/1f48e.png?v8",
      gemini: "https://github.githubassets.com/images/icons/emoji/unicode/264a.png?v8",
      genie: "https://github.githubassets.com/images/icons/emoji/unicode/1f9de.png?v8",
      genie_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f9de-2642.png?v8",
      genie_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f9de-2640.png?v8",
      georgia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1ea.png?v8",
      ghana: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1ed.png?v8",
      ghost: "https://github.githubassets.com/images/icons/emoji/unicode/1f47b.png?v8",
      gibraltar: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1ee.png?v8",
      gift: "https://github.githubassets.com/images/icons/emoji/unicode/1f381.png?v8",
      gift_heart: "https://github.githubassets.com/images/icons/emoji/unicode/1f49d.png?v8",
      giraffe: "https://github.githubassets.com/images/icons/emoji/unicode/1f992.png?v8",
      girl: "https://github.githubassets.com/images/icons/emoji/unicode/1f467.png?v8",
      globe_with_meridians: "https://github.githubassets.com/images/icons/emoji/unicode/1f310.png?v8",
      gloves: "https://github.githubassets.com/images/icons/emoji/unicode/1f9e4.png?v8",
      goal_net: "https://github.githubassets.com/images/icons/emoji/unicode/1f945.png?v8",
      goat: "https://github.githubassets.com/images/icons/emoji/unicode/1f410.png?v8",
      goberserk: "https://github.githubassets.com/images/icons/emoji/goberserk.png?v8",
      godmode: "https://github.githubassets.com/images/icons/emoji/godmode.png?v8",
      goggles: "https://github.githubassets.com/images/icons/emoji/unicode/1f97d.png?v8",
      golf: "https://github.githubassets.com/images/icons/emoji/unicode/26f3.png?v8",
      golfing: "https://github.githubassets.com/images/icons/emoji/unicode/1f3cc.png?v8",
      golfing_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f3cc-2642.png?v8",
      golfing_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f3cc-2640.png?v8",
      gorilla: "https://github.githubassets.com/images/icons/emoji/unicode/1f98d.png?v8",
      grapes: "https://github.githubassets.com/images/icons/emoji/unicode/1f347.png?v8",
      greece: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1f7.png?v8",
      green_apple: "https://github.githubassets.com/images/icons/emoji/unicode/1f34f.png?v8",
      green_book: "https://github.githubassets.com/images/icons/emoji/unicode/1f4d7.png?v8",
      green_circle: "https://github.githubassets.com/images/icons/emoji/unicode/1f7e2.png?v8",
      green_heart: "https://github.githubassets.com/images/icons/emoji/unicode/1f49a.png?v8",
      green_salad: "https://github.githubassets.com/images/icons/emoji/unicode/1f957.png?v8",
      green_square: "https://github.githubassets.com/images/icons/emoji/unicode/1f7e9.png?v8",
      greenland: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1f1.png?v8",
      grenada: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1e9.png?v8",
      grey_exclamation: "https://github.githubassets.com/images/icons/emoji/unicode/2755.png?v8",
      grey_question: "https://github.githubassets.com/images/icons/emoji/unicode/2754.png?v8",
      grimacing: "https://github.githubassets.com/images/icons/emoji/unicode/1f62c.png?v8",
      grin: "https://github.githubassets.com/images/icons/emoji/unicode/1f601.png?v8",
      grinning: "https://github.githubassets.com/images/icons/emoji/unicode/1f600.png?v8",
      guadeloupe: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1f5.png?v8",
      guam: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1fa.png?v8",
      guard: "https://github.githubassets.com/images/icons/emoji/unicode/1f482.png?v8",
      guardsman: "https://github.githubassets.com/images/icons/emoji/unicode/1f482-2642.png?v8",
      guardswoman: "https://github.githubassets.com/images/icons/emoji/unicode/1f482-2640.png?v8",
      guatemala: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1f9.png?v8",
      guernsey: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1ec.png?v8",
      guide_dog: "https://github.githubassets.com/images/icons/emoji/unicode/1f9ae.png?v8",
      guinea: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1f3.png?v8",
      guinea_bissau: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1fc.png?v8",
      guitar: "https://github.githubassets.com/images/icons/emoji/unicode/1f3b8.png?v8",
      gun: "https://github.githubassets.com/images/icons/emoji/unicode/1f52b.png?v8",
      guyana: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1fe.png?v8",
      haircut: "https://github.githubassets.com/images/icons/emoji/unicode/1f487.png?v8",
      haircut_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f487-2642.png?v8",
      haircut_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f487-2640.png?v8",
      haiti: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ed-1f1f9.png?v8",
      hamburger: "https://github.githubassets.com/images/icons/emoji/unicode/1f354.png?v8",
      hammer: "https://github.githubassets.com/images/icons/emoji/unicode/1f528.png?v8",
      hammer_and_pick: "https://github.githubassets.com/images/icons/emoji/unicode/2692.png?v8",
      hammer_and_wrench: "https://github.githubassets.com/images/icons/emoji/unicode/1f6e0.png?v8",
      hamster: "https://github.githubassets.com/images/icons/emoji/unicode/1f439.png?v8",
      hand: "https://github.githubassets.com/images/icons/emoji/unicode/270b.png?v8",
      hand_over_mouth: "https://github.githubassets.com/images/icons/emoji/unicode/1f92d.png?v8",
      handbag: "https://github.githubassets.com/images/icons/emoji/unicode/1f45c.png?v8",
      handball_person: "https://github.githubassets.com/images/icons/emoji/unicode/1f93e.png?v8",
      handshake: "https://github.githubassets.com/images/icons/emoji/unicode/1f91d.png?v8",
      hankey: "https://github.githubassets.com/images/icons/emoji/unicode/1f4a9.png?v8",
      hash: "https://github.githubassets.com/images/icons/emoji/unicode/0023-20e3.png?v8",
      hatched_chick: "https://github.githubassets.com/images/icons/emoji/unicode/1f425.png?v8",
      hatching_chick: "https://github.githubassets.com/images/icons/emoji/unicode/1f423.png?v8",
      headphones: "https://github.githubassets.com/images/icons/emoji/unicode/1f3a7.png?v8",
      health_worker: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-2695.png?v8",
      hear_no_evil: "https://github.githubassets.com/images/icons/emoji/unicode/1f649.png?v8",
      heard_mcdonald_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ed-1f1f2.png?v8",
      heart: "https://github.githubassets.com/images/icons/emoji/unicode/2764.png?v8",
      heart_decoration: "https://github.githubassets.com/images/icons/emoji/unicode/1f49f.png?v8",
      heart_eyes: "https://github.githubassets.com/images/icons/emoji/unicode/1f60d.png?v8",
      heart_eyes_cat: "https://github.githubassets.com/images/icons/emoji/unicode/1f63b.png?v8",
      heartbeat: "https://github.githubassets.com/images/icons/emoji/unicode/1f493.png?v8",
      heartpulse: "https://github.githubassets.com/images/icons/emoji/unicode/1f497.png?v8",
      hearts: "https://github.githubassets.com/images/icons/emoji/unicode/2665.png?v8",
      heavy_check_mark: "https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8",
      heavy_division_sign: "https://github.githubassets.com/images/icons/emoji/unicode/2797.png?v8",
      heavy_dollar_sign: "https://github.githubassets.com/images/icons/emoji/unicode/1f4b2.png?v8",
      heavy_exclamation_mark: "https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8",
      heavy_heart_exclamation: "https://github.githubassets.com/images/icons/emoji/unicode/2763.png?v8",
      heavy_minus_sign: "https://github.githubassets.com/images/icons/emoji/unicode/2796.png?v8",
      heavy_multiplication_x: "https://github.githubassets.com/images/icons/emoji/unicode/2716.png?v8",
      heavy_plus_sign: "https://github.githubassets.com/images/icons/emoji/unicode/2795.png?v8",
      hedgehog: "https://github.githubassets.com/images/icons/emoji/unicode/1f994.png?v8",
      helicopter: "https://github.githubassets.com/images/icons/emoji/unicode/1f681.png?v8",
      herb: "https://github.githubassets.com/images/icons/emoji/unicode/1f33f.png?v8",
      hibiscus: "https://github.githubassets.com/images/icons/emoji/unicode/1f33a.png?v8",
      high_brightness: "https://github.githubassets.com/images/icons/emoji/unicode/1f506.png?v8",
      high_heel: "https://github.githubassets.com/images/icons/emoji/unicode/1f460.png?v8",
      hiking_boot: "https://github.githubassets.com/images/icons/emoji/unicode/1f97e.png?v8",
      hindu_temple: "https://github.githubassets.com/images/icons/emoji/unicode/1f6d5.png?v8",
      hippopotamus: "https://github.githubassets.com/images/icons/emoji/unicode/1f99b.png?v8",
      hocho: "https://github.githubassets.com/images/icons/emoji/unicode/1f52a.png?v8",
      hole: "https://github.githubassets.com/images/icons/emoji/unicode/1f573.png?v8",
      honduras: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ed-1f1f3.png?v8",
      honey_pot: "https://github.githubassets.com/images/icons/emoji/unicode/1f36f.png?v8",
      honeybee: "https://github.githubassets.com/images/icons/emoji/unicode/1f41d.png?v8",
      hong_kong: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ed-1f1f0.png?v8",
      horse: "https://github.githubassets.com/images/icons/emoji/unicode/1f434.png?v8",
      horse_racing: "https://github.githubassets.com/images/icons/emoji/unicode/1f3c7.png?v8",
      hospital: "https://github.githubassets.com/images/icons/emoji/unicode/1f3e5.png?v8",
      hot_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f975.png?v8",
      hot_pepper: "https://github.githubassets.com/images/icons/emoji/unicode/1f336.png?v8",
      hotdog: "https://github.githubassets.com/images/icons/emoji/unicode/1f32d.png?v8",
      hotel: "https://github.githubassets.com/images/icons/emoji/unicode/1f3e8.png?v8",
      hotsprings: "https://github.githubassets.com/images/icons/emoji/unicode/2668.png?v8",
      hourglass: "https://github.githubassets.com/images/icons/emoji/unicode/231b.png?v8",
      hourglass_flowing_sand: "https://github.githubassets.com/images/icons/emoji/unicode/23f3.png?v8",
      house: "https://github.githubassets.com/images/icons/emoji/unicode/1f3e0.png?v8",
      house_with_garden: "https://github.githubassets.com/images/icons/emoji/unicode/1f3e1.png?v8",
      houses: "https://github.githubassets.com/images/icons/emoji/unicode/1f3d8.png?v8",
      hugs: "https://github.githubassets.com/images/icons/emoji/unicode/1f917.png?v8",
      hungary: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ed-1f1fa.png?v8",
      hurtrealbad: "https://github.githubassets.com/images/icons/emoji/hurtrealbad.png?v8",
      hushed: "https://github.githubassets.com/images/icons/emoji/unicode/1f62f.png?v8",
      ice_cream: "https://github.githubassets.com/images/icons/emoji/unicode/1f368.png?v8",
      ice_cube: "https://github.githubassets.com/images/icons/emoji/unicode/1f9ca.png?v8",
      ice_hockey: "https://github.githubassets.com/images/icons/emoji/unicode/1f3d2.png?v8",
      ice_skate: "https://github.githubassets.com/images/icons/emoji/unicode/26f8.png?v8",
      icecream: "https://github.githubassets.com/images/icons/emoji/unicode/1f366.png?v8",
      iceland: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f8.png?v8",
      id: "https://github.githubassets.com/images/icons/emoji/unicode/1f194.png?v8",
      ideograph_advantage: "https://github.githubassets.com/images/icons/emoji/unicode/1f250.png?v8",
      imp: "https://github.githubassets.com/images/icons/emoji/unicode/1f47f.png?v8",
      inbox_tray: "https://github.githubassets.com/images/icons/emoji/unicode/1f4e5.png?v8",
      incoming_envelope: "https://github.githubassets.com/images/icons/emoji/unicode/1f4e8.png?v8",
      india: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f3.png?v8",
      indonesia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1e9.png?v8",
      infinity: "https://github.githubassets.com/images/icons/emoji/unicode/267e.png?v8",
      information_desk_person: "https://github.githubassets.com/images/icons/emoji/unicode/1f481.png?v8",
      information_source: "https://github.githubassets.com/images/icons/emoji/unicode/2139.png?v8",
      innocent: "https://github.githubassets.com/images/icons/emoji/unicode/1f607.png?v8",
      interrobang: "https://github.githubassets.com/images/icons/emoji/unicode/2049.png?v8",
      iphone: "https://github.githubassets.com/images/icons/emoji/unicode/1f4f1.png?v8",
      iran: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f7.png?v8",
      iraq: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f6.png?v8",
      ireland: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1ea.png?v8",
      isle_of_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f2.png?v8",
      israel: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f1.png?v8",
      it: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f9.png?v8",
      izakaya_lantern: "https://github.githubassets.com/images/icons/emoji/unicode/1f3ee.png?v8",
      jack_o_lantern: "https://github.githubassets.com/images/icons/emoji/unicode/1f383.png?v8",
      jamaica: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ef-1f1f2.png?v8",
      japan: "https://github.githubassets.com/images/icons/emoji/unicode/1f5fe.png?v8",
      japanese_castle: "https://github.githubassets.com/images/icons/emoji/unicode/1f3ef.png?v8",
      japanese_goblin: "https://github.githubassets.com/images/icons/emoji/unicode/1f47a.png?v8",
      japanese_ogre: "https://github.githubassets.com/images/icons/emoji/unicode/1f479.png?v8",
      jeans: "https://github.githubassets.com/images/icons/emoji/unicode/1f456.png?v8",
      jersey: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ef-1f1ea.png?v8",
      jigsaw: "https://github.githubassets.com/images/icons/emoji/unicode/1f9e9.png?v8",
      jordan: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ef-1f1f4.png?v8",
      joy: "https://github.githubassets.com/images/icons/emoji/unicode/1f602.png?v8",
      joy_cat: "https://github.githubassets.com/images/icons/emoji/unicode/1f639.png?v8",
      joystick: "https://github.githubassets.com/images/icons/emoji/unicode/1f579.png?v8",
      jp: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ef-1f1f5.png?v8",
      judge: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-2696.png?v8",
      juggling_person: "https://github.githubassets.com/images/icons/emoji/unicode/1f939.png?v8",
      kaaba: "https://github.githubassets.com/images/icons/emoji/unicode/1f54b.png?v8",
      kangaroo: "https://github.githubassets.com/images/icons/emoji/unicode/1f998.png?v8",
      kazakhstan: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f0-1f1ff.png?v8",
      kenya: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f0-1f1ea.png?v8",
      key: "https://github.githubassets.com/images/icons/emoji/unicode/1f511.png?v8",
      keyboard: "https://github.githubassets.com/images/icons/emoji/unicode/2328.png?v8",
      keycap_ten: "https://github.githubassets.com/images/icons/emoji/unicode/1f51f.png?v8",
      kick_scooter: "https://github.githubassets.com/images/icons/emoji/unicode/1f6f4.png?v8",
      kimono: "https://github.githubassets.com/images/icons/emoji/unicode/1f458.png?v8",
      kiribati: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f0-1f1ee.png?v8",
      kiss: "https://github.githubassets.com/images/icons/emoji/unicode/1f48b.png?v8",
      kissing: "https://github.githubassets.com/images/icons/emoji/unicode/1f617.png?v8",
      kissing_cat: "https://github.githubassets.com/images/icons/emoji/unicode/1f63d.png?v8",
      kissing_closed_eyes: "https://github.githubassets.com/images/icons/emoji/unicode/1f61a.png?v8",
      kissing_heart: "https://github.githubassets.com/images/icons/emoji/unicode/1f618.png?v8",
      kissing_smiling_eyes: "https://github.githubassets.com/images/icons/emoji/unicode/1f619.png?v8",
      kite: "https://github.githubassets.com/images/icons/emoji/unicode/1fa81.png?v8",
      kiwi_fruit: "https://github.githubassets.com/images/icons/emoji/unicode/1f95d.png?v8",
      kneeling_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f9ce-2642.png?v8",
      kneeling_person: "https://github.githubassets.com/images/icons/emoji/unicode/1f9ce.png?v8",
      kneeling_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f9ce-2640.png?v8",
      knife: "https://github.githubassets.com/images/icons/emoji/unicode/1f52a.png?v8",
      koala: "https://github.githubassets.com/images/icons/emoji/unicode/1f428.png?v8",
      koko: "https://github.githubassets.com/images/icons/emoji/unicode/1f201.png?v8",
      kosovo: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fd-1f1f0.png?v8",
      kr: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f0-1f1f7.png?v8",
      kuwait: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f0-1f1fc.png?v8",
      kyrgyzstan: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f0-1f1ec.png?v8",
      lab_coat: "https://github.githubassets.com/images/icons/emoji/unicode/1f97c.png?v8",
      label: "https://github.githubassets.com/images/icons/emoji/unicode/1f3f7.png?v8",
      lacrosse: "https://github.githubassets.com/images/icons/emoji/unicode/1f94d.png?v8",
      lantern: "https://github.githubassets.com/images/icons/emoji/unicode/1f3ee.png?v8",
      laos: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f1-1f1e6.png?v8",
      large_blue_circle: "https://github.githubassets.com/images/icons/emoji/unicode/1f535.png?v8",
      large_blue_diamond: "https://github.githubassets.com/images/icons/emoji/unicode/1f537.png?v8",
      large_orange_diamond: "https://github.githubassets.com/images/icons/emoji/unicode/1f536.png?v8",
      last_quarter_moon: "https://github.githubassets.com/images/icons/emoji/unicode/1f317.png?v8",
      last_quarter_moon_with_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f31c.png?v8",
      latin_cross: "https://github.githubassets.com/images/icons/emoji/unicode/271d.png?v8",
      latvia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f1-1f1fb.png?v8",
      laughing: "https://github.githubassets.com/images/icons/emoji/unicode/1f606.png?v8",
      leafy_green: "https://github.githubassets.com/images/icons/emoji/unicode/1f96c.png?v8",
      leaves: "https://github.githubassets.com/images/icons/emoji/unicode/1f343.png?v8",
      lebanon: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f1-1f1e7.png?v8",
      ledger: "https://github.githubassets.com/images/icons/emoji/unicode/1f4d2.png?v8",
      left_luggage: "https://github.githubassets.com/images/icons/emoji/unicode/1f6c5.png?v8",
      left_right_arrow: "https://github.githubassets.com/images/icons/emoji/unicode/2194.png?v8",
      left_speech_bubble: "https://github.githubassets.com/images/icons/emoji/unicode/1f5e8.png?v8",
      leftwards_arrow_with_hook: "https://github.githubassets.com/images/icons/emoji/unicode/21a9.png?v8",
      leg: "https://github.githubassets.com/images/icons/emoji/unicode/1f9b5.png?v8",
      lemon: "https://github.githubassets.com/images/icons/emoji/unicode/1f34b.png?v8",
      leo: "https://github.githubassets.com/images/icons/emoji/unicode/264c.png?v8",
      leopard: "https://github.githubassets.com/images/icons/emoji/unicode/1f406.png?v8",
      lesotho: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f1-1f1f8.png?v8",
      level_slider: "https://github.githubassets.com/images/icons/emoji/unicode/1f39a.png?v8",
      liberia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f1-1f1f7.png?v8",
      libra: "https://github.githubassets.com/images/icons/emoji/unicode/264e.png?v8",
      libya: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f1-1f1fe.png?v8",
      liechtenstein: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f1-1f1ee.png?v8",
      light_rail: "https://github.githubassets.com/images/icons/emoji/unicode/1f688.png?v8",
      link: "https://github.githubassets.com/images/icons/emoji/unicode/1f517.png?v8",
      lion: "https://github.githubassets.com/images/icons/emoji/unicode/1f981.png?v8",
      lips: "https://github.githubassets.com/images/icons/emoji/unicode/1f444.png?v8",
      lipstick: "https://github.githubassets.com/images/icons/emoji/unicode/1f484.png?v8",
      lithuania: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f1-1f1f9.png?v8",
      lizard: "https://github.githubassets.com/images/icons/emoji/unicode/1f98e.png?v8",
      llama: "https://github.githubassets.com/images/icons/emoji/unicode/1f999.png?v8",
      lobster: "https://github.githubassets.com/images/icons/emoji/unicode/1f99e.png?v8",
      lock: "https://github.githubassets.com/images/icons/emoji/unicode/1f512.png?v8",
      lock_with_ink_pen: "https://github.githubassets.com/images/icons/emoji/unicode/1f50f.png?v8",
      lollipop: "https://github.githubassets.com/images/icons/emoji/unicode/1f36d.png?v8",
      loop: "https://github.githubassets.com/images/icons/emoji/unicode/27bf.png?v8",
      lotion_bottle: "https://github.githubassets.com/images/icons/emoji/unicode/1f9f4.png?v8",
      lotus_position: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d8.png?v8",
      lotus_position_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d8-2642.png?v8",
      lotus_position_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d8-2640.png?v8",
      loud_sound: "https://github.githubassets.com/images/icons/emoji/unicode/1f50a.png?v8",
      loudspeaker: "https://github.githubassets.com/images/icons/emoji/unicode/1f4e2.png?v8",
      love_hotel: "https://github.githubassets.com/images/icons/emoji/unicode/1f3e9.png?v8",
      love_letter: "https://github.githubassets.com/images/icons/emoji/unicode/1f48c.png?v8",
      love_you_gesture: "https://github.githubassets.com/images/icons/emoji/unicode/1f91f.png?v8",
      low_brightness: "https://github.githubassets.com/images/icons/emoji/unicode/1f505.png?v8",
      luggage: "https://github.githubassets.com/images/icons/emoji/unicode/1f9f3.png?v8",
      luxembourg: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f1-1f1fa.png?v8",
      lying_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f925.png?v8",
      m: "https://github.githubassets.com/images/icons/emoji/unicode/24c2.png?v8",
      macau: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1f4.png?v8",
      macedonia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1f0.png?v8",
      madagascar: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1ec.png?v8",
      mag: "https://github.githubassets.com/images/icons/emoji/unicode/1f50d.png?v8",
      mag_right: "https://github.githubassets.com/images/icons/emoji/unicode/1f50e.png?v8",
      mage: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d9.png?v8",
      mage_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d9-2642.png?v8",
      mage_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d9-2640.png?v8",
      magnet: "https://github.githubassets.com/images/icons/emoji/unicode/1f9f2.png?v8",
      mahjong: "https://github.githubassets.com/images/icons/emoji/unicode/1f004.png?v8",
      mailbox: "https://github.githubassets.com/images/icons/emoji/unicode/1f4eb.png?v8",
      mailbox_closed: "https://github.githubassets.com/images/icons/emoji/unicode/1f4ea.png?v8",
      mailbox_with_mail: "https://github.githubassets.com/images/icons/emoji/unicode/1f4ec.png?v8",
      mailbox_with_no_mail: "https://github.githubassets.com/images/icons/emoji/unicode/1f4ed.png?v8",
      malawi: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1fc.png?v8",
      malaysia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1fe.png?v8",
      maldives: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1fb.png?v8",
      male_detective: "https://github.githubassets.com/images/icons/emoji/unicode/1f575-2642.png?v8",
      male_sign: "https://github.githubassets.com/images/icons/emoji/unicode/2642.png?v8",
      mali: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1f1.png?v8",
      malta: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1f9.png?v8",
      man: "https://github.githubassets.com/images/icons/emoji/unicode/1f468.png?v8",
      man_artist: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f3a8.png?v8",
      man_astronaut: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f680.png?v8",
      man_cartwheeling: "https://github.githubassets.com/images/icons/emoji/unicode/1f938-2642.png?v8",
      man_cook: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f373.png?v8",
      man_dancing: "https://github.githubassets.com/images/icons/emoji/unicode/1f57a.png?v8",
      man_facepalming: "https://github.githubassets.com/images/icons/emoji/unicode/1f926-2642.png?v8",
      man_factory_worker: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f3ed.png?v8",
      man_farmer: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f33e.png?v8",
      man_firefighter: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f692.png?v8",
      man_health_worker: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-2695.png?v8",
      man_in_manual_wheelchair: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f9bd.png?v8",
      man_in_motorized_wheelchair: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f9bc.png?v8",
      man_in_tuxedo: "https://github.githubassets.com/images/icons/emoji/unicode/1f935.png?v8",
      man_judge: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-2696.png?v8",
      man_juggling: "https://github.githubassets.com/images/icons/emoji/unicode/1f939-2642.png?v8",
      man_mechanic: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f527.png?v8",
      man_office_worker: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f4bc.png?v8",
      man_pilot: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-2708.png?v8",
      man_playing_handball: "https://github.githubassets.com/images/icons/emoji/unicode/1f93e-2642.png?v8",
      man_playing_water_polo: "https://github.githubassets.com/images/icons/emoji/unicode/1f93d-2642.png?v8",
      man_scientist: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f52c.png?v8",
      man_shrugging: "https://github.githubassets.com/images/icons/emoji/unicode/1f937-2642.png?v8",
      man_singer: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f3a4.png?v8",
      man_student: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f393.png?v8",
      man_teacher: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f3eb.png?v8",
      man_technologist: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f4bb.png?v8",
      man_with_gua_pi_mao: "https://github.githubassets.com/images/icons/emoji/unicode/1f472.png?v8",
      man_with_probing_cane: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f9af.png?v8",
      man_with_turban: "https://github.githubassets.com/images/icons/emoji/unicode/1f473-2642.png?v8",
      mandarin: "https://github.githubassets.com/images/icons/emoji/unicode/1f34a.png?v8",
      mango: "https://github.githubassets.com/images/icons/emoji/unicode/1f96d.png?v8",
      mans_shoe: "https://github.githubassets.com/images/icons/emoji/unicode/1f45e.png?v8",
      mantelpiece_clock: "https://github.githubassets.com/images/icons/emoji/unicode/1f570.png?v8",
      manual_wheelchair: "https://github.githubassets.com/images/icons/emoji/unicode/1f9bd.png?v8",
      maple_leaf: "https://github.githubassets.com/images/icons/emoji/unicode/1f341.png?v8",
      marshall_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1ed.png?v8",
      martial_arts_uniform: "https://github.githubassets.com/images/icons/emoji/unicode/1f94b.png?v8",
      martinique: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1f6.png?v8",
      mask: "https://github.githubassets.com/images/icons/emoji/unicode/1f637.png?v8",
      massage: "https://github.githubassets.com/images/icons/emoji/unicode/1f486.png?v8",
      massage_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f486-2642.png?v8",
      massage_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f486-2640.png?v8",
      mate: "https://github.githubassets.com/images/icons/emoji/unicode/1f9c9.png?v8",
      mauritania: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1f7.png?v8",
      mauritius: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1fa.png?v8",
      mayotte: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fe-1f1f9.png?v8",
      meat_on_bone: "https://github.githubassets.com/images/icons/emoji/unicode/1f356.png?v8",
      mechanic: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f527.png?v8",
      mechanical_arm: "https://github.githubassets.com/images/icons/emoji/unicode/1f9be.png?v8",
      mechanical_leg: "https://github.githubassets.com/images/icons/emoji/unicode/1f9bf.png?v8",
      medal_military: "https://github.githubassets.com/images/icons/emoji/unicode/1f396.png?v8",
      medal_sports: "https://github.githubassets.com/images/icons/emoji/unicode/1f3c5.png?v8",
      medical_symbol: "https://github.githubassets.com/images/icons/emoji/unicode/2695.png?v8",
      mega: "https://github.githubassets.com/images/icons/emoji/unicode/1f4e3.png?v8",
      melon: "https://github.githubassets.com/images/icons/emoji/unicode/1f348.png?v8",
      memo: "https://github.githubassets.com/images/icons/emoji/unicode/1f4dd.png?v8",
      men_wrestling: "https://github.githubassets.com/images/icons/emoji/unicode/1f93c-2642.png?v8",
      menorah: "https://github.githubassets.com/images/icons/emoji/unicode/1f54e.png?v8",
      mens: "https://github.githubassets.com/images/icons/emoji/unicode/1f6b9.png?v8",
      mermaid: "https://github.githubassets.com/images/icons/emoji/unicode/1f9dc-2640.png?v8",
      merman: "https://github.githubassets.com/images/icons/emoji/unicode/1f9dc-2642.png?v8",
      merperson: "https://github.githubassets.com/images/icons/emoji/unicode/1f9dc.png?v8",
      metal: "https://github.githubassets.com/images/icons/emoji/unicode/1f918.png?v8",
      metro: "https://github.githubassets.com/images/icons/emoji/unicode/1f687.png?v8",
      mexico: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1fd.png?v8",
      microbe: "https://github.githubassets.com/images/icons/emoji/unicode/1f9a0.png?v8",
      micronesia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1eb-1f1f2.png?v8",
      microphone: "https://github.githubassets.com/images/icons/emoji/unicode/1f3a4.png?v8",
      microscope: "https://github.githubassets.com/images/icons/emoji/unicode/1f52c.png?v8",
      middle_finger: "https://github.githubassets.com/images/icons/emoji/unicode/1f595.png?v8",
      milk_glass: "https://github.githubassets.com/images/icons/emoji/unicode/1f95b.png?v8",
      milky_way: "https://github.githubassets.com/images/icons/emoji/unicode/1f30c.png?v8",
      minibus: "https://github.githubassets.com/images/icons/emoji/unicode/1f690.png?v8",
      minidisc: "https://github.githubassets.com/images/icons/emoji/unicode/1f4bd.png?v8",
      mobile_phone_off: "https://github.githubassets.com/images/icons/emoji/unicode/1f4f4.png?v8",
      moldova: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1e9.png?v8",
      monaco: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1e8.png?v8",
      money_mouth_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f911.png?v8",
      money_with_wings: "https://github.githubassets.com/images/icons/emoji/unicode/1f4b8.png?v8",
      moneybag: "https://github.githubassets.com/images/icons/emoji/unicode/1f4b0.png?v8",
      mongolia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1f3.png?v8",
      monkey: "https://github.githubassets.com/images/icons/emoji/unicode/1f412.png?v8",
      monkey_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f435.png?v8",
      monocle_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d0.png?v8",
      monorail: "https://github.githubassets.com/images/icons/emoji/unicode/1f69d.png?v8",
      montenegro: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1ea.png?v8",
      montserrat: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1f8.png?v8",
      moon: "https://github.githubassets.com/images/icons/emoji/unicode/1f314.png?v8",
      moon_cake: "https://github.githubassets.com/images/icons/emoji/unicode/1f96e.png?v8",
      morocco: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1e6.png?v8",
      mortar_board: "https://github.githubassets.com/images/icons/emoji/unicode/1f393.png?v8",
      mosque: "https://github.githubassets.com/images/icons/emoji/unicode/1f54c.png?v8",
      mosquito: "https://github.githubassets.com/images/icons/emoji/unicode/1f99f.png?v8",
      motor_boat: "https://github.githubassets.com/images/icons/emoji/unicode/1f6e5.png?v8",
      motor_scooter: "https://github.githubassets.com/images/icons/emoji/unicode/1f6f5.png?v8",
      motorcycle: "https://github.githubassets.com/images/icons/emoji/unicode/1f3cd.png?v8",
      motorized_wheelchair: "https://github.githubassets.com/images/icons/emoji/unicode/1f9bc.png?v8",
      motorway: "https://github.githubassets.com/images/icons/emoji/unicode/1f6e3.png?v8",
      mount_fuji: "https://github.githubassets.com/images/icons/emoji/unicode/1f5fb.png?v8",
      mountain: "https://github.githubassets.com/images/icons/emoji/unicode/26f0.png?v8",
      mountain_bicyclist: "https://github.githubassets.com/images/icons/emoji/unicode/1f6b5.png?v8",
      mountain_biking_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f6b5-2642.png?v8",
      mountain_biking_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f6b5-2640.png?v8",
      mountain_cableway: "https://github.githubassets.com/images/icons/emoji/unicode/1f6a0.png?v8",
      mountain_railway: "https://github.githubassets.com/images/icons/emoji/unicode/1f69e.png?v8",
      mountain_snow: "https://github.githubassets.com/images/icons/emoji/unicode/1f3d4.png?v8",
      mouse: "https://github.githubassets.com/images/icons/emoji/unicode/1f42d.png?v8",
      mouse2: "https://github.githubassets.com/images/icons/emoji/unicode/1f401.png?v8",
      movie_camera: "https://github.githubassets.com/images/icons/emoji/unicode/1f3a5.png?v8",
      moyai: "https://github.githubassets.com/images/icons/emoji/unicode/1f5ff.png?v8",
      mozambique: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1ff.png?v8",
      mrs_claus: "https://github.githubassets.com/images/icons/emoji/unicode/1f936.png?v8",
      muscle: "https://github.githubassets.com/images/icons/emoji/unicode/1f4aa.png?v8",
      mushroom: "https://github.githubassets.com/images/icons/emoji/unicode/1f344.png?v8",
      musical_keyboard: "https://github.githubassets.com/images/icons/emoji/unicode/1f3b9.png?v8",
      musical_note: "https://github.githubassets.com/images/icons/emoji/unicode/1f3b5.png?v8",
      musical_score: "https://github.githubassets.com/images/icons/emoji/unicode/1f3bc.png?v8",
      mute: "https://github.githubassets.com/images/icons/emoji/unicode/1f507.png?v8",
      myanmar: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1f2.png?v8",
      nail_care: "https://github.githubassets.com/images/icons/emoji/unicode/1f485.png?v8",
      name_badge: "https://github.githubassets.com/images/icons/emoji/unicode/1f4db.png?v8",
      namibia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f3-1f1e6.png?v8",
      national_park: "https://github.githubassets.com/images/icons/emoji/unicode/1f3de.png?v8",
      nauru: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f3-1f1f7.png?v8",
      nauseated_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f922.png?v8",
      nazar_amulet: "https://github.githubassets.com/images/icons/emoji/unicode/1f9ff.png?v8",
      neckbeard: "https://github.githubassets.com/images/icons/emoji/neckbeard.png?v8",
      necktie: "https://github.githubassets.com/images/icons/emoji/unicode/1f454.png?v8",
      negative_squared_cross_mark: "https://github.githubassets.com/images/icons/emoji/unicode/274e.png?v8",
      nepal: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f3-1f1f5.png?v8",
      nerd_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f913.png?v8",
      netherlands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f3-1f1f1.png?v8",
      neutral_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f610.png?v8",
      new: "https://github.githubassets.com/images/icons/emoji/unicode/1f195.png?v8",
      new_caledonia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f3-1f1e8.png?v8",
      new_moon: "https://github.githubassets.com/images/icons/emoji/unicode/1f311.png?v8",
      new_moon_with_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f31a.png?v8",
      new_zealand: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f3-1f1ff.png?v8",
      newspaper: "https://github.githubassets.com/images/icons/emoji/unicode/1f4f0.png?v8",
      newspaper_roll: "https://github.githubassets.com/images/icons/emoji/unicode/1f5de.png?v8",
      next_track_button: "https://github.githubassets.com/images/icons/emoji/unicode/23ed.png?v8",
      ng: "https://github.githubassets.com/images/icons/emoji/unicode/1f196.png?v8",
      ng_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f645-2642.png?v8",
      ng_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f645-2640.png?v8",
      nicaragua: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f3-1f1ee.png?v8",
      niger: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f3-1f1ea.png?v8",
      nigeria: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f3-1f1ec.png?v8",
      night_with_stars: "https://github.githubassets.com/images/icons/emoji/unicode/1f303.png?v8",
      nine: "https://github.githubassets.com/images/icons/emoji/unicode/0039-20e3.png?v8",
      niue: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f3-1f1fa.png?v8",
      no_bell: "https://github.githubassets.com/images/icons/emoji/unicode/1f515.png?v8",
      no_bicycles: "https://github.githubassets.com/images/icons/emoji/unicode/1f6b3.png?v8",
      no_entry: "https://github.githubassets.com/images/icons/emoji/unicode/26d4.png?v8",
      no_entry_sign: "https://github.githubassets.com/images/icons/emoji/unicode/1f6ab.png?v8",
      no_good: "https://github.githubassets.com/images/icons/emoji/unicode/1f645.png?v8",
      no_good_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f645-2642.png?v8",
      no_good_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f645-2640.png?v8",
      no_mobile_phones: "https://github.githubassets.com/images/icons/emoji/unicode/1f4f5.png?v8",
      no_mouth: "https://github.githubassets.com/images/icons/emoji/unicode/1f636.png?v8",
      no_pedestrians: "https://github.githubassets.com/images/icons/emoji/unicode/1f6b7.png?v8",
      no_smoking: "https://github.githubassets.com/images/icons/emoji/unicode/1f6ad.png?v8",
      "non-potable_water": "https://github.githubassets.com/images/icons/emoji/unicode/1f6b1.png?v8",
      norfolk_island: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f3-1f1eb.png?v8",
      north_korea: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f0-1f1f5.png?v8",
      northern_mariana_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1f5.png?v8",
      norway: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f3-1f1f4.png?v8",
      nose: "https://github.githubassets.com/images/icons/emoji/unicode/1f443.png?v8",
      notebook: "https://github.githubassets.com/images/icons/emoji/unicode/1f4d3.png?v8",
      notebook_with_decorative_cover: "https://github.githubassets.com/images/icons/emoji/unicode/1f4d4.png?v8",
      notes: "https://github.githubassets.com/images/icons/emoji/unicode/1f3b6.png?v8",
      nut_and_bolt: "https://github.githubassets.com/images/icons/emoji/unicode/1f529.png?v8",
      o: "https://github.githubassets.com/images/icons/emoji/unicode/2b55.png?v8",
      o2: "https://github.githubassets.com/images/icons/emoji/unicode/1f17e.png?v8",
      ocean: "https://github.githubassets.com/images/icons/emoji/unicode/1f30a.png?v8",
      octocat: "https://github.githubassets.com/images/icons/emoji/octocat.png?v8",
      octopus: "https://github.githubassets.com/images/icons/emoji/unicode/1f419.png?v8",
      oden: "https://github.githubassets.com/images/icons/emoji/unicode/1f362.png?v8",
      office: "https://github.githubassets.com/images/icons/emoji/unicode/1f3e2.png?v8",
      office_worker: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f4bc.png?v8",
      oil_drum: "https://github.githubassets.com/images/icons/emoji/unicode/1f6e2.png?v8",
      ok: "https://github.githubassets.com/images/icons/emoji/unicode/1f197.png?v8",
      ok_hand: "https://github.githubassets.com/images/icons/emoji/unicode/1f44c.png?v8",
      ok_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f646-2642.png?v8",
      ok_person: "https://github.githubassets.com/images/icons/emoji/unicode/1f646.png?v8",
      ok_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f646-2640.png?v8",
      old_key: "https://github.githubassets.com/images/icons/emoji/unicode/1f5dd.png?v8",
      older_adult: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d3.png?v8",
      older_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f474.png?v8",
      older_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f475.png?v8",
      om: "https://github.githubassets.com/images/icons/emoji/unicode/1f549.png?v8",
      oman: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f4-1f1f2.png?v8",
      on: "https://github.githubassets.com/images/icons/emoji/unicode/1f51b.png?v8",
      oncoming_automobile: "https://github.githubassets.com/images/icons/emoji/unicode/1f698.png?v8",
      oncoming_bus: "https://github.githubassets.com/images/icons/emoji/unicode/1f68d.png?v8",
      oncoming_police_car: "https://github.githubassets.com/images/icons/emoji/unicode/1f694.png?v8",
      oncoming_taxi: "https://github.githubassets.com/images/icons/emoji/unicode/1f696.png?v8",
      one: "https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8",
      one_piece_swimsuit: "https://github.githubassets.com/images/icons/emoji/unicode/1fa71.png?v8",
      onion: "https://github.githubassets.com/images/icons/emoji/unicode/1f9c5.png?v8",
      open_book: "https://github.githubassets.com/images/icons/emoji/unicode/1f4d6.png?v8",
      open_file_folder: "https://github.githubassets.com/images/icons/emoji/unicode/1f4c2.png?v8",
      open_hands: "https://github.githubassets.com/images/icons/emoji/unicode/1f450.png?v8",
      open_mouth: "https://github.githubassets.com/images/icons/emoji/unicode/1f62e.png?v8",
      open_umbrella: "https://github.githubassets.com/images/icons/emoji/unicode/2602.png?v8",
      ophiuchus: "https://github.githubassets.com/images/icons/emoji/unicode/26ce.png?v8",
      orange: "https://github.githubassets.com/images/icons/emoji/unicode/1f34a.png?v8",
      orange_book: "https://github.githubassets.com/images/icons/emoji/unicode/1f4d9.png?v8",
      orange_circle: "https://github.githubassets.com/images/icons/emoji/unicode/1f7e0.png?v8",
      orange_heart: "https://github.githubassets.com/images/icons/emoji/unicode/1f9e1.png?v8",
      orange_square: "https://github.githubassets.com/images/icons/emoji/unicode/1f7e7.png?v8",
      orangutan: "https://github.githubassets.com/images/icons/emoji/unicode/1f9a7.png?v8",
      orthodox_cross: "https://github.githubassets.com/images/icons/emoji/unicode/2626.png?v8",
      otter: "https://github.githubassets.com/images/icons/emoji/unicode/1f9a6.png?v8",
      outbox_tray: "https://github.githubassets.com/images/icons/emoji/unicode/1f4e4.png?v8",
      owl: "https://github.githubassets.com/images/icons/emoji/unicode/1f989.png?v8",
      ox: "https://github.githubassets.com/images/icons/emoji/unicode/1f402.png?v8",
      oyster: "https://github.githubassets.com/images/icons/emoji/unicode/1f9aa.png?v8",
      package: "https://github.githubassets.com/images/icons/emoji/unicode/1f4e6.png?v8",
      page_facing_up: "https://github.githubassets.com/images/icons/emoji/unicode/1f4c4.png?v8",
      page_with_curl: "https://github.githubassets.com/images/icons/emoji/unicode/1f4c3.png?v8",
      pager: "https://github.githubassets.com/images/icons/emoji/unicode/1f4df.png?v8",
      paintbrush: "https://github.githubassets.com/images/icons/emoji/unicode/1f58c.png?v8",
      pakistan: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f5-1f1f0.png?v8",
      palau: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f5-1f1fc.png?v8",
      palestinian_territories: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f5-1f1f8.png?v8",
      palm_tree: "https://github.githubassets.com/images/icons/emoji/unicode/1f334.png?v8",
      palms_up_together: "https://github.githubassets.com/images/icons/emoji/unicode/1f932.png?v8",
      panama: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f5-1f1e6.png?v8",
      pancakes: "https://github.githubassets.com/images/icons/emoji/unicode/1f95e.png?v8",
      panda_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f43c.png?v8",
      paperclip: "https://github.githubassets.com/images/icons/emoji/unicode/1f4ce.png?v8",
      paperclips: "https://github.githubassets.com/images/icons/emoji/unicode/1f587.png?v8",
      papua_new_guinea: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f5-1f1ec.png?v8",
      parachute: "https://github.githubassets.com/images/icons/emoji/unicode/1fa82.png?v8",
      paraguay: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f5-1f1fe.png?v8",
      parasol_on_ground: "https://github.githubassets.com/images/icons/emoji/unicode/26f1.png?v8",
      parking: "https://github.githubassets.com/images/icons/emoji/unicode/1f17f.png?v8",
      parrot: "https://github.githubassets.com/images/icons/emoji/unicode/1f99c.png?v8",
      part_alternation_mark: "https://github.githubassets.com/images/icons/emoji/unicode/303d.png?v8",
      partly_sunny: "https://github.githubassets.com/images/icons/emoji/unicode/26c5.png?v8",
      partying_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f973.png?v8",
      passenger_ship: "https://github.githubassets.com/images/icons/emoji/unicode/1f6f3.png?v8",
      passport_control: "https://github.githubassets.com/images/icons/emoji/unicode/1f6c2.png?v8",
      pause_button: "https://github.githubassets.com/images/icons/emoji/unicode/23f8.png?v8",
      paw_prints: "https://github.githubassets.com/images/icons/emoji/unicode/1f43e.png?v8",
      peace_symbol: "https://github.githubassets.com/images/icons/emoji/unicode/262e.png?v8",
      peach: "https://github.githubassets.com/images/icons/emoji/unicode/1f351.png?v8",
      peacock: "https://github.githubassets.com/images/icons/emoji/unicode/1f99a.png?v8",
      peanuts: "https://github.githubassets.com/images/icons/emoji/unicode/1f95c.png?v8",
      pear: "https://github.githubassets.com/images/icons/emoji/unicode/1f350.png?v8",
      pen: "https://github.githubassets.com/images/icons/emoji/unicode/1f58a.png?v8",
      pencil: "https://github.githubassets.com/images/icons/emoji/unicode/1f4dd.png?v8",
      pencil2: "https://github.githubassets.com/images/icons/emoji/unicode/270f.png?v8",
      penguin: "https://github.githubassets.com/images/icons/emoji/unicode/1f427.png?v8",
      pensive: "https://github.githubassets.com/images/icons/emoji/unicode/1f614.png?v8",
      people_holding_hands: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f91d-1f9d1.png?v8",
      performing_arts: "https://github.githubassets.com/images/icons/emoji/unicode/1f3ad.png?v8",
      persevere: "https://github.githubassets.com/images/icons/emoji/unicode/1f623.png?v8",
      person_bald: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f9b2.png?v8",
      person_curly_hair: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f9b1.png?v8",
      person_fencing: "https://github.githubassets.com/images/icons/emoji/unicode/1f93a.png?v8",
      person_in_manual_wheelchair: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f9bd.png?v8",
      person_in_motorized_wheelchair: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f9bc.png?v8",
      person_red_hair: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f9b0.png?v8",
      person_white_hair: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f9b3.png?v8",
      person_with_probing_cane: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f9af.png?v8",
      person_with_turban: "https://github.githubassets.com/images/icons/emoji/unicode/1f473.png?v8",
      peru: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f5-1f1ea.png?v8",
      petri_dish: "https://github.githubassets.com/images/icons/emoji/unicode/1f9eb.png?v8",
      philippines: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f5-1f1ed.png?v8",
      phone: "https://github.githubassets.com/images/icons/emoji/unicode/260e.png?v8",
      pick: "https://github.githubassets.com/images/icons/emoji/unicode/26cf.png?v8",
      pie: "https://github.githubassets.com/images/icons/emoji/unicode/1f967.png?v8",
      pig: "https://github.githubassets.com/images/icons/emoji/unicode/1f437.png?v8",
      pig2: "https://github.githubassets.com/images/icons/emoji/unicode/1f416.png?v8",
      pig_nose: "https://github.githubassets.com/images/icons/emoji/unicode/1f43d.png?v8",
      pill: "https://github.githubassets.com/images/icons/emoji/unicode/1f48a.png?v8",
      pilot: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-2708.png?v8",
      pinching_hand: "https://github.githubassets.com/images/icons/emoji/unicode/1f90f.png?v8",
      pineapple: "https://github.githubassets.com/images/icons/emoji/unicode/1f34d.png?v8",
      ping_pong: "https://github.githubassets.com/images/icons/emoji/unicode/1f3d3.png?v8",
      pirate_flag: "https://github.githubassets.com/images/icons/emoji/unicode/1f3f4-2620.png?v8",
      pisces: "https://github.githubassets.com/images/icons/emoji/unicode/2653.png?v8",
      pitcairn_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f5-1f1f3.png?v8",
      pizza: "https://github.githubassets.com/images/icons/emoji/unicode/1f355.png?v8",
      place_of_worship: "https://github.githubassets.com/images/icons/emoji/unicode/1f6d0.png?v8",
      plate_with_cutlery: "https://github.githubassets.com/images/icons/emoji/unicode/1f37d.png?v8",
      play_or_pause_button: "https://github.githubassets.com/images/icons/emoji/unicode/23ef.png?v8",
      pleading_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f97a.png?v8",
      point_down: "https://github.githubassets.com/images/icons/emoji/unicode/1f447.png?v8",
      point_left: "https://github.githubassets.com/images/icons/emoji/unicode/1f448.png?v8",
      point_right: "https://github.githubassets.com/images/icons/emoji/unicode/1f449.png?v8",
      point_up: "https://github.githubassets.com/images/icons/emoji/unicode/261d.png?v8",
      point_up_2: "https://github.githubassets.com/images/icons/emoji/unicode/1f446.png?v8",
      poland: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f5-1f1f1.png?v8",
      police_car: "https://github.githubassets.com/images/icons/emoji/unicode/1f693.png?v8",
      police_officer: "https://github.githubassets.com/images/icons/emoji/unicode/1f46e.png?v8",
      policeman: "https://github.githubassets.com/images/icons/emoji/unicode/1f46e-2642.png?v8",
      policewoman: "https://github.githubassets.com/images/icons/emoji/unicode/1f46e-2640.png?v8",
      poodle: "https://github.githubassets.com/images/icons/emoji/unicode/1f429.png?v8",
      poop: "https://github.githubassets.com/images/icons/emoji/unicode/1f4a9.png?v8",
      popcorn: "https://github.githubassets.com/images/icons/emoji/unicode/1f37f.png?v8",
      portugal: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f5-1f1f9.png?v8",
      post_office: "https://github.githubassets.com/images/icons/emoji/unicode/1f3e3.png?v8",
      postal_horn: "https://github.githubassets.com/images/icons/emoji/unicode/1f4ef.png?v8",
      postbox: "https://github.githubassets.com/images/icons/emoji/unicode/1f4ee.png?v8",
      potable_water: "https://github.githubassets.com/images/icons/emoji/unicode/1f6b0.png?v8",
      potato: "https://github.githubassets.com/images/icons/emoji/unicode/1f954.png?v8",
      pouch: "https://github.githubassets.com/images/icons/emoji/unicode/1f45d.png?v8",
      poultry_leg: "https://github.githubassets.com/images/icons/emoji/unicode/1f357.png?v8",
      pound: "https://github.githubassets.com/images/icons/emoji/unicode/1f4b7.png?v8",
      pout: "https://github.githubassets.com/images/icons/emoji/unicode/1f621.png?v8",
      pouting_cat: "https://github.githubassets.com/images/icons/emoji/unicode/1f63e.png?v8",
      pouting_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f64e.png?v8",
      pouting_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f64e-2642.png?v8",
      pouting_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f64e-2640.png?v8",
      pray: "https://github.githubassets.com/images/icons/emoji/unicode/1f64f.png?v8",
      prayer_beads: "https://github.githubassets.com/images/icons/emoji/unicode/1f4ff.png?v8",
      pregnant_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f930.png?v8",
      pretzel: "https://github.githubassets.com/images/icons/emoji/unicode/1f968.png?v8",
      previous_track_button: "https://github.githubassets.com/images/icons/emoji/unicode/23ee.png?v8",
      prince: "https://github.githubassets.com/images/icons/emoji/unicode/1f934.png?v8",
      princess: "https://github.githubassets.com/images/icons/emoji/unicode/1f478.png?v8",
      printer: "https://github.githubassets.com/images/icons/emoji/unicode/1f5a8.png?v8",
      probing_cane: "https://github.githubassets.com/images/icons/emoji/unicode/1f9af.png?v8",
      puerto_rico: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f5-1f1f7.png?v8",
      punch: "https://github.githubassets.com/images/icons/emoji/unicode/1f44a.png?v8",
      purple_circle: "https://github.githubassets.com/images/icons/emoji/unicode/1f7e3.png?v8",
      purple_heart: "https://github.githubassets.com/images/icons/emoji/unicode/1f49c.png?v8",
      purple_square: "https://github.githubassets.com/images/icons/emoji/unicode/1f7ea.png?v8",
      purse: "https://github.githubassets.com/images/icons/emoji/unicode/1f45b.png?v8",
      pushpin: "https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8",
      put_litter_in_its_place: "https://github.githubassets.com/images/icons/emoji/unicode/1f6ae.png?v8",
      qatar: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f6-1f1e6.png?v8",
      question: "https://github.githubassets.com/images/icons/emoji/unicode/2753.png?v8",
      rabbit: "https://github.githubassets.com/images/icons/emoji/unicode/1f430.png?v8",
      rabbit2: "https://github.githubassets.com/images/icons/emoji/unicode/1f407.png?v8",
      raccoon: "https://github.githubassets.com/images/icons/emoji/unicode/1f99d.png?v8",
      racehorse: "https://github.githubassets.com/images/icons/emoji/unicode/1f40e.png?v8",
      racing_car: "https://github.githubassets.com/images/icons/emoji/unicode/1f3ce.png?v8",
      radio: "https://github.githubassets.com/images/icons/emoji/unicode/1f4fb.png?v8",
      radio_button: "https://github.githubassets.com/images/icons/emoji/unicode/1f518.png?v8",
      radioactive: "https://github.githubassets.com/images/icons/emoji/unicode/2622.png?v8",
      rage: "https://github.githubassets.com/images/icons/emoji/unicode/1f621.png?v8",
      rage1: "https://github.githubassets.com/images/icons/emoji/rage1.png?v8",
      rage2: "https://github.githubassets.com/images/icons/emoji/rage2.png?v8",
      rage3: "https://github.githubassets.com/images/icons/emoji/rage3.png?v8",
      rage4: "https://github.githubassets.com/images/icons/emoji/rage4.png?v8",
      railway_car: "https://github.githubassets.com/images/icons/emoji/unicode/1f683.png?v8",
      railway_track: "https://github.githubassets.com/images/icons/emoji/unicode/1f6e4.png?v8",
      rainbow: "https://github.githubassets.com/images/icons/emoji/unicode/1f308.png?v8",
      rainbow_flag: "https://github.githubassets.com/images/icons/emoji/unicode/1f3f3-1f308.png?v8",
      raised_back_of_hand: "https://github.githubassets.com/images/icons/emoji/unicode/1f91a.png?v8",
      raised_eyebrow: "https://github.githubassets.com/images/icons/emoji/unicode/1f928.png?v8",
      raised_hand: "https://github.githubassets.com/images/icons/emoji/unicode/270b.png?v8",
      raised_hand_with_fingers_splayed: "https://github.githubassets.com/images/icons/emoji/unicode/1f590.png?v8",
      raised_hands: "https://github.githubassets.com/images/icons/emoji/unicode/1f64c.png?v8",
      raising_hand: "https://github.githubassets.com/images/icons/emoji/unicode/1f64b.png?v8",
      raising_hand_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f64b-2642.png?v8",
      raising_hand_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f64b-2640.png?v8",
      ram: "https://github.githubassets.com/images/icons/emoji/unicode/1f40f.png?v8",
      ramen: "https://github.githubassets.com/images/icons/emoji/unicode/1f35c.png?v8",
      rat: "https://github.githubassets.com/images/icons/emoji/unicode/1f400.png?v8",
      razor: "https://github.githubassets.com/images/icons/emoji/unicode/1fa92.png?v8",
      receipt: "https://github.githubassets.com/images/icons/emoji/unicode/1f9fe.png?v8",
      record_button: "https://github.githubassets.com/images/icons/emoji/unicode/23fa.png?v8",
      recycle: "https://github.githubassets.com/images/icons/emoji/unicode/267b.png?v8",
      red_car: "https://github.githubassets.com/images/icons/emoji/unicode/1f697.png?v8",
      red_circle: "https://github.githubassets.com/images/icons/emoji/unicode/1f534.png?v8",
      red_envelope: "https://github.githubassets.com/images/icons/emoji/unicode/1f9e7.png?v8",
      red_haired_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f9b0.png?v8",
      red_haired_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f9b0.png?v8",
      red_square: "https://github.githubassets.com/images/icons/emoji/unicode/1f7e5.png?v8",
      registered: "https://github.githubassets.com/images/icons/emoji/unicode/00ae.png?v8",
      relaxed: "https://github.githubassets.com/images/icons/emoji/unicode/263a.png?v8",
      relieved: "https://github.githubassets.com/images/icons/emoji/unicode/1f60c.png?v8",
      reminder_ribbon: "https://github.githubassets.com/images/icons/emoji/unicode/1f397.png?v8",
      repeat: "https://github.githubassets.com/images/icons/emoji/unicode/1f501.png?v8",
      repeat_one: "https://github.githubassets.com/images/icons/emoji/unicode/1f502.png?v8",
      rescue_worker_helmet: "https://github.githubassets.com/images/icons/emoji/unicode/26d1.png?v8",
      restroom: "https://github.githubassets.com/images/icons/emoji/unicode/1f6bb.png?v8",
      reunion: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f7-1f1ea.png?v8",
      revolving_hearts: "https://github.githubassets.com/images/icons/emoji/unicode/1f49e.png?v8",
      rewind: "https://github.githubassets.com/images/icons/emoji/unicode/23ea.png?v8",
      rhinoceros: "https://github.githubassets.com/images/icons/emoji/unicode/1f98f.png?v8",
      ribbon: "https://github.githubassets.com/images/icons/emoji/unicode/1f380.png?v8",
      rice: "https://github.githubassets.com/images/icons/emoji/unicode/1f35a.png?v8",
      rice_ball: "https://github.githubassets.com/images/icons/emoji/unicode/1f359.png?v8",
      rice_cracker: "https://github.githubassets.com/images/icons/emoji/unicode/1f358.png?v8",
      rice_scene: "https://github.githubassets.com/images/icons/emoji/unicode/1f391.png?v8",
      right_anger_bubble: "https://github.githubassets.com/images/icons/emoji/unicode/1f5ef.png?v8",
      ring: "https://github.githubassets.com/images/icons/emoji/unicode/1f48d.png?v8",
      ringed_planet: "https://github.githubassets.com/images/icons/emoji/unicode/1fa90.png?v8",
      robot: "https://github.githubassets.com/images/icons/emoji/unicode/1f916.png?v8",
      rocket: "https://github.githubassets.com/images/icons/emoji/unicode/1f680.png?v8",
      rofl: "https://github.githubassets.com/images/icons/emoji/unicode/1f923.png?v8",
      roll_eyes: "https://github.githubassets.com/images/icons/emoji/unicode/1f644.png?v8",
      roll_of_paper: "https://github.githubassets.com/images/icons/emoji/unicode/1f9fb.png?v8",
      roller_coaster: "https://github.githubassets.com/images/icons/emoji/unicode/1f3a2.png?v8",
      romania: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f7-1f1f4.png?v8",
      rooster: "https://github.githubassets.com/images/icons/emoji/unicode/1f413.png?v8",
      rose: "https://github.githubassets.com/images/icons/emoji/unicode/1f339.png?v8",
      rosette: "https://github.githubassets.com/images/icons/emoji/unicode/1f3f5.png?v8",
      rotating_light: "https://github.githubassets.com/images/icons/emoji/unicode/1f6a8.png?v8",
      round_pushpin: "https://github.githubassets.com/images/icons/emoji/unicode/1f4cd.png?v8",
      rowboat: "https://github.githubassets.com/images/icons/emoji/unicode/1f6a3.png?v8",
      rowing_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f6a3-2642.png?v8",
      rowing_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f6a3-2640.png?v8",
      ru: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f7-1f1fa.png?v8",
      rugby_football: "https://github.githubassets.com/images/icons/emoji/unicode/1f3c9.png?v8",
      runner: "https://github.githubassets.com/images/icons/emoji/unicode/1f3c3.png?v8",
      running: "https://github.githubassets.com/images/icons/emoji/unicode/1f3c3.png?v8",
      running_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f3c3-2642.png?v8",
      running_shirt_with_sash: "https://github.githubassets.com/images/icons/emoji/unicode/1f3bd.png?v8",
      running_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f3c3-2640.png?v8",
      rwanda: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f7-1f1fc.png?v8",
      sa: "https://github.githubassets.com/images/icons/emoji/unicode/1f202.png?v8",
      safety_pin: "https://github.githubassets.com/images/icons/emoji/unicode/1f9f7.png?v8",
      safety_vest: "https://github.githubassets.com/images/icons/emoji/unicode/1f9ba.png?v8",
      sagittarius: "https://github.githubassets.com/images/icons/emoji/unicode/2650.png?v8",
      sailboat: "https://github.githubassets.com/images/icons/emoji/unicode/26f5.png?v8",
      sake: "https://github.githubassets.com/images/icons/emoji/unicode/1f376.png?v8",
      salt: "https://github.githubassets.com/images/icons/emoji/unicode/1f9c2.png?v8",
      samoa: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fc-1f1f8.png?v8",
      san_marino: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1f2.png?v8",
      sandal: "https://github.githubassets.com/images/icons/emoji/unicode/1f461.png?v8",
      sandwich: "https://github.githubassets.com/images/icons/emoji/unicode/1f96a.png?v8",
      santa: "https://github.githubassets.com/images/icons/emoji/unicode/1f385.png?v8",
      sao_tome_principe: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1f9.png?v8",
      sari: "https://github.githubassets.com/images/icons/emoji/unicode/1f97b.png?v8",
      sassy_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f481-2642.png?v8",
      sassy_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f481-2640.png?v8",
      satellite: "https://github.githubassets.com/images/icons/emoji/unicode/1f4e1.png?v8",
      satisfied: "https://github.githubassets.com/images/icons/emoji/unicode/1f606.png?v8",
      saudi_arabia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1e6.png?v8",
      sauna_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d6-2642.png?v8",
      sauna_person: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d6.png?v8",
      sauna_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d6-2640.png?v8",
      sauropod: "https://github.githubassets.com/images/icons/emoji/unicode/1f995.png?v8",
      saxophone: "https://github.githubassets.com/images/icons/emoji/unicode/1f3b7.png?v8",
      scarf: "https://github.githubassets.com/images/icons/emoji/unicode/1f9e3.png?v8",
      school: "https://github.githubassets.com/images/icons/emoji/unicode/1f3eb.png?v8",
      school_satchel: "https://github.githubassets.com/images/icons/emoji/unicode/1f392.png?v8",
      scientist: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f52c.png?v8",
      scissors: "https://github.githubassets.com/images/icons/emoji/unicode/2702.png?v8",
      scorpion: "https://github.githubassets.com/images/icons/emoji/unicode/1f982.png?v8",
      scorpius: "https://github.githubassets.com/images/icons/emoji/unicode/264f.png?v8",
      scotland: "https://github.githubassets.com/images/icons/emoji/unicode/1f3f4-e0067-e0062-e0073-e0063-e0074-e007f.png?v8",
      scream: "https://github.githubassets.com/images/icons/emoji/unicode/1f631.png?v8",
      scream_cat: "https://github.githubassets.com/images/icons/emoji/unicode/1f640.png?v8",
      scroll: "https://github.githubassets.com/images/icons/emoji/unicode/1f4dc.png?v8",
      seat: "https://github.githubassets.com/images/icons/emoji/unicode/1f4ba.png?v8",
      secret: "https://github.githubassets.com/images/icons/emoji/unicode/3299.png?v8",
      see_no_evil: "https://github.githubassets.com/images/icons/emoji/unicode/1f648.png?v8",
      seedling: "https://github.githubassets.com/images/icons/emoji/unicode/1f331.png?v8",
      selfie: "https://github.githubassets.com/images/icons/emoji/unicode/1f933.png?v8",
      senegal: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1f3.png?v8",
      serbia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f7-1f1f8.png?v8",
      service_dog: "https://github.githubassets.com/images/icons/emoji/unicode/1f415-1f9ba.png?v8",
      seven: "https://github.githubassets.com/images/icons/emoji/unicode/0037-20e3.png?v8",
      seychelles: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1e8.png?v8",
      shallow_pan_of_food: "https://github.githubassets.com/images/icons/emoji/unicode/1f958.png?v8",
      shamrock: "https://github.githubassets.com/images/icons/emoji/unicode/2618.png?v8",
      shark: "https://github.githubassets.com/images/icons/emoji/unicode/1f988.png?v8",
      shaved_ice: "https://github.githubassets.com/images/icons/emoji/unicode/1f367.png?v8",
      sheep: "https://github.githubassets.com/images/icons/emoji/unicode/1f411.png?v8",
      shell: "https://github.githubassets.com/images/icons/emoji/unicode/1f41a.png?v8",
      shield: "https://github.githubassets.com/images/icons/emoji/unicode/1f6e1.png?v8",
      shinto_shrine: "https://github.githubassets.com/images/icons/emoji/unicode/26e9.png?v8",
      ship: "https://github.githubassets.com/images/icons/emoji/unicode/1f6a2.png?v8",
      shipit: "https://github.githubassets.com/images/icons/emoji/shipit.png?v8",
      shirt: "https://github.githubassets.com/images/icons/emoji/unicode/1f455.png?v8",
      shit: "https://github.githubassets.com/images/icons/emoji/unicode/1f4a9.png?v8",
      shoe: "https://github.githubassets.com/images/icons/emoji/unicode/1f45e.png?v8",
      shopping: "https://github.githubassets.com/images/icons/emoji/unicode/1f6cd.png?v8",
      shopping_cart: "https://github.githubassets.com/images/icons/emoji/unicode/1f6d2.png?v8",
      shorts: "https://github.githubassets.com/images/icons/emoji/unicode/1fa73.png?v8",
      shower: "https://github.githubassets.com/images/icons/emoji/unicode/1f6bf.png?v8",
      shrimp: "https://github.githubassets.com/images/icons/emoji/unicode/1f990.png?v8",
      shrug: "https://github.githubassets.com/images/icons/emoji/unicode/1f937.png?v8",
      shushing_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f92b.png?v8",
      sierra_leone: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1f1.png?v8",
      signal_strength: "https://github.githubassets.com/images/icons/emoji/unicode/1f4f6.png?v8",
      singapore: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1ec.png?v8",
      singer: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f3a4.png?v8",
      sint_maarten: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1fd.png?v8",
      six: "https://github.githubassets.com/images/icons/emoji/unicode/0036-20e3.png?v8",
      six_pointed_star: "https://github.githubassets.com/images/icons/emoji/unicode/1f52f.png?v8",
      skateboard: "https://github.githubassets.com/images/icons/emoji/unicode/1f6f9.png?v8",
      ski: "https://github.githubassets.com/images/icons/emoji/unicode/1f3bf.png?v8",
      skier: "https://github.githubassets.com/images/icons/emoji/unicode/26f7.png?v8",
      skull: "https://github.githubassets.com/images/icons/emoji/unicode/1f480.png?v8",
      skull_and_crossbones: "https://github.githubassets.com/images/icons/emoji/unicode/2620.png?v8",
      skunk: "https://github.githubassets.com/images/icons/emoji/unicode/1f9a8.png?v8",
      sled: "https://github.githubassets.com/images/icons/emoji/unicode/1f6f7.png?v8",
      sleeping: "https://github.githubassets.com/images/icons/emoji/unicode/1f634.png?v8",
      sleeping_bed: "https://github.githubassets.com/images/icons/emoji/unicode/1f6cc.png?v8",
      sleepy: "https://github.githubassets.com/images/icons/emoji/unicode/1f62a.png?v8",
      slightly_frowning_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f641.png?v8",
      slightly_smiling_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f642.png?v8",
      slot_machine: "https://github.githubassets.com/images/icons/emoji/unicode/1f3b0.png?v8",
      sloth: "https://github.githubassets.com/images/icons/emoji/unicode/1f9a5.png?v8",
      slovakia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1f0.png?v8",
      slovenia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1ee.png?v8",
      small_airplane: "https://github.githubassets.com/images/icons/emoji/unicode/1f6e9.png?v8",
      small_blue_diamond: "https://github.githubassets.com/images/icons/emoji/unicode/1f539.png?v8",
      small_orange_diamond: "https://github.githubassets.com/images/icons/emoji/unicode/1f538.png?v8",
      small_red_triangle: "https://github.githubassets.com/images/icons/emoji/unicode/1f53a.png?v8",
      small_red_triangle_down: "https://github.githubassets.com/images/icons/emoji/unicode/1f53b.png?v8",
      smile: "https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8",
      smile_cat: "https://github.githubassets.com/images/icons/emoji/unicode/1f638.png?v8",
      smiley: "https://github.githubassets.com/images/icons/emoji/unicode/1f603.png?v8",
      smiley_cat: "https://github.githubassets.com/images/icons/emoji/unicode/1f63a.png?v8",
      smiling_face_with_three_hearts: "https://github.githubassets.com/images/icons/emoji/unicode/1f970.png?v8",
      smiling_imp: "https://github.githubassets.com/images/icons/emoji/unicode/1f608.png?v8",
      smirk: "https://github.githubassets.com/images/icons/emoji/unicode/1f60f.png?v8",
      smirk_cat: "https://github.githubassets.com/images/icons/emoji/unicode/1f63c.png?v8",
      smoking: "https://github.githubassets.com/images/icons/emoji/unicode/1f6ac.png?v8",
      snail: "https://github.githubassets.com/images/icons/emoji/unicode/1f40c.png?v8",
      snake: "https://github.githubassets.com/images/icons/emoji/unicode/1f40d.png?v8",
      sneezing_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f927.png?v8",
      snowboarder: "https://github.githubassets.com/images/icons/emoji/unicode/1f3c2.png?v8",
      snowflake: "https://github.githubassets.com/images/icons/emoji/unicode/2744.png?v8",
      snowman: "https://github.githubassets.com/images/icons/emoji/unicode/26c4.png?v8",
      snowman_with_snow: "https://github.githubassets.com/images/icons/emoji/unicode/2603.png?v8",
      soap: "https://github.githubassets.com/images/icons/emoji/unicode/1f9fc.png?v8",
      sob: "https://github.githubassets.com/images/icons/emoji/unicode/1f62d.png?v8",
      soccer: "https://github.githubassets.com/images/icons/emoji/unicode/26bd.png?v8",
      socks: "https://github.githubassets.com/images/icons/emoji/unicode/1f9e6.png?v8",
      softball: "https://github.githubassets.com/images/icons/emoji/unicode/1f94e.png?v8",
      solomon_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1e7.png?v8",
      somalia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1f4.png?v8",
      soon: "https://github.githubassets.com/images/icons/emoji/unicode/1f51c.png?v8",
      sos: "https://github.githubassets.com/images/icons/emoji/unicode/1f198.png?v8",
      sound: "https://github.githubassets.com/images/icons/emoji/unicode/1f509.png?v8",
      south_africa: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ff-1f1e6.png?v8",
      south_georgia_south_sandwich_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1f8.png?v8",
      south_sudan: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1f8.png?v8",
      space_invader: "https://github.githubassets.com/images/icons/emoji/unicode/1f47e.png?v8",
      spades: "https://github.githubassets.com/images/icons/emoji/unicode/2660.png?v8",
      spaghetti: "https://github.githubassets.com/images/icons/emoji/unicode/1f35d.png?v8",
      sparkle: "https://github.githubassets.com/images/icons/emoji/unicode/2747.png?v8",
      sparkler: "https://github.githubassets.com/images/icons/emoji/unicode/1f387.png?v8",
      sparkles: "https://github.githubassets.com/images/icons/emoji/unicode/2728.png?v8",
      sparkling_heart: "https://github.githubassets.com/images/icons/emoji/unicode/1f496.png?v8",
      speak_no_evil: "https://github.githubassets.com/images/icons/emoji/unicode/1f64a.png?v8",
      speaker: "https://github.githubassets.com/images/icons/emoji/unicode/1f508.png?v8",
      speaking_head: "https://github.githubassets.com/images/icons/emoji/unicode/1f5e3.png?v8",
      speech_balloon: "https://github.githubassets.com/images/icons/emoji/unicode/1f4ac.png?v8",
      speedboat: "https://github.githubassets.com/images/icons/emoji/unicode/1f6a4.png?v8",
      spider: "https://github.githubassets.com/images/icons/emoji/unicode/1f577.png?v8",
      spider_web: "https://github.githubassets.com/images/icons/emoji/unicode/1f578.png?v8",
      spiral_calendar: "https://github.githubassets.com/images/icons/emoji/unicode/1f5d3.png?v8",
      spiral_notepad: "https://github.githubassets.com/images/icons/emoji/unicode/1f5d2.png?v8",
      sponge: "https://github.githubassets.com/images/icons/emoji/unicode/1f9fd.png?v8",
      spoon: "https://github.githubassets.com/images/icons/emoji/unicode/1f944.png?v8",
      squid: "https://github.githubassets.com/images/icons/emoji/unicode/1f991.png?v8",
      sri_lanka: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f1-1f1f0.png?v8",
      st_barthelemy: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e7-1f1f1.png?v8",
      st_helena: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1ed.png?v8",
      st_kitts_nevis: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f0-1f1f3.png?v8",
      st_lucia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f1-1f1e8.png?v8",
      st_martin: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f2-1f1eb.png?v8",
      st_pierre_miquelon: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f5-1f1f2.png?v8",
      st_vincent_grenadines: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fb-1f1e8.png?v8",
      stadium: "https://github.githubassets.com/images/icons/emoji/unicode/1f3df.png?v8",
      standing_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f9cd-2642.png?v8",
      standing_person: "https://github.githubassets.com/images/icons/emoji/unicode/1f9cd.png?v8",
      standing_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f9cd-2640.png?v8",
      star: "https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8",
      star2: "https://github.githubassets.com/images/icons/emoji/unicode/1f31f.png?v8",
      star_and_crescent: "https://github.githubassets.com/images/icons/emoji/unicode/262a.png?v8",
      star_of_david: "https://github.githubassets.com/images/icons/emoji/unicode/2721.png?v8",
      star_struck: "https://github.githubassets.com/images/icons/emoji/unicode/1f929.png?v8",
      stars: "https://github.githubassets.com/images/icons/emoji/unicode/1f320.png?v8",
      station: "https://github.githubassets.com/images/icons/emoji/unicode/1f689.png?v8",
      statue_of_liberty: "https://github.githubassets.com/images/icons/emoji/unicode/1f5fd.png?v8",
      steam_locomotive: "https://github.githubassets.com/images/icons/emoji/unicode/1f682.png?v8",
      stethoscope: "https://github.githubassets.com/images/icons/emoji/unicode/1fa7a.png?v8",
      stew: "https://github.githubassets.com/images/icons/emoji/unicode/1f372.png?v8",
      stop_button: "https://github.githubassets.com/images/icons/emoji/unicode/23f9.png?v8",
      stop_sign: "https://github.githubassets.com/images/icons/emoji/unicode/1f6d1.png?v8",
      stopwatch: "https://github.githubassets.com/images/icons/emoji/unicode/23f1.png?v8",
      straight_ruler: "https://github.githubassets.com/images/icons/emoji/unicode/1f4cf.png?v8",
      strawberry: "https://github.githubassets.com/images/icons/emoji/unicode/1f353.png?v8",
      stuck_out_tongue: "https://github.githubassets.com/images/icons/emoji/unicode/1f61b.png?v8",
      stuck_out_tongue_closed_eyes: "https://github.githubassets.com/images/icons/emoji/unicode/1f61d.png?v8",
      stuck_out_tongue_winking_eye: "https://github.githubassets.com/images/icons/emoji/unicode/1f61c.png?v8",
      student: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f393.png?v8",
      studio_microphone: "https://github.githubassets.com/images/icons/emoji/unicode/1f399.png?v8",
      stuffed_flatbread: "https://github.githubassets.com/images/icons/emoji/unicode/1f959.png?v8",
      sudan: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1e9.png?v8",
      sun_behind_large_cloud: "https://github.githubassets.com/images/icons/emoji/unicode/1f325.png?v8",
      sun_behind_rain_cloud: "https://github.githubassets.com/images/icons/emoji/unicode/1f326.png?v8",
      sun_behind_small_cloud: "https://github.githubassets.com/images/icons/emoji/unicode/1f324.png?v8",
      sun_with_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f31e.png?v8",
      sunflower: "https://github.githubassets.com/images/icons/emoji/unicode/1f33b.png?v8",
      sunglasses: "https://github.githubassets.com/images/icons/emoji/unicode/1f60e.png?v8",
      sunny: "https://github.githubassets.com/images/icons/emoji/unicode/2600.png?v8",
      sunrise: "https://github.githubassets.com/images/icons/emoji/unicode/1f305.png?v8",
      sunrise_over_mountains: "https://github.githubassets.com/images/icons/emoji/unicode/1f304.png?v8",
      superhero: "https://github.githubassets.com/images/icons/emoji/unicode/1f9b8.png?v8",
      superhero_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f9b8-2642.png?v8",
      superhero_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f9b8-2640.png?v8",
      supervillain: "https://github.githubassets.com/images/icons/emoji/unicode/1f9b9.png?v8",
      supervillain_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f9b9-2642.png?v8",
      supervillain_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f9b9-2640.png?v8",
      surfer: "https://github.githubassets.com/images/icons/emoji/unicode/1f3c4.png?v8",
      surfing_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f3c4-2642.png?v8",
      surfing_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f3c4-2640.png?v8",
      suriname: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1f7.png?v8",
      sushi: "https://github.githubassets.com/images/icons/emoji/unicode/1f363.png?v8",
      suspect: "https://github.githubassets.com/images/icons/emoji/suspect.png?v8",
      suspension_railway: "https://github.githubassets.com/images/icons/emoji/unicode/1f69f.png?v8",
      svalbard_jan_mayen: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1ef.png?v8",
      swan: "https://github.githubassets.com/images/icons/emoji/unicode/1f9a2.png?v8",
      swaziland: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1ff.png?v8",
      sweat: "https://github.githubassets.com/images/icons/emoji/unicode/1f613.png?v8",
      sweat_drops: "https://github.githubassets.com/images/icons/emoji/unicode/1f4a6.png?v8",
      sweat_smile: "https://github.githubassets.com/images/icons/emoji/unicode/1f605.png?v8",
      sweden: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1ea.png?v8",
      sweet_potato: "https://github.githubassets.com/images/icons/emoji/unicode/1f360.png?v8",
      swim_brief: "https://github.githubassets.com/images/icons/emoji/unicode/1fa72.png?v8",
      swimmer: "https://github.githubassets.com/images/icons/emoji/unicode/1f3ca.png?v8",
      swimming_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f3ca-2642.png?v8",
      swimming_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f3ca-2640.png?v8",
      switzerland: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e8-1f1ed.png?v8",
      symbols: "https://github.githubassets.com/images/icons/emoji/unicode/1f523.png?v8",
      synagogue: "https://github.githubassets.com/images/icons/emoji/unicode/1f54d.png?v8",
      syria: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f8-1f1fe.png?v8",
      syringe: "https://github.githubassets.com/images/icons/emoji/unicode/1f489.png?v8",
      "t-rex": "https://github.githubassets.com/images/icons/emoji/unicode/1f996.png?v8",
      taco: "https://github.githubassets.com/images/icons/emoji/unicode/1f32e.png?v8",
      tada: "https://github.githubassets.com/images/icons/emoji/unicode/1f389.png?v8",
      taiwan: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1fc.png?v8",
      tajikistan: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1ef.png?v8",
      takeout_box: "https://github.githubassets.com/images/icons/emoji/unicode/1f961.png?v8",
      tanabata_tree: "https://github.githubassets.com/images/icons/emoji/unicode/1f38b.png?v8",
      tangerine: "https://github.githubassets.com/images/icons/emoji/unicode/1f34a.png?v8",
      tanzania: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1ff.png?v8",
      taurus: "https://github.githubassets.com/images/icons/emoji/unicode/2649.png?v8",
      taxi: "https://github.githubassets.com/images/icons/emoji/unicode/1f695.png?v8",
      tea: "https://github.githubassets.com/images/icons/emoji/unicode/1f375.png?v8",
      teacher: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f3eb.png?v8",
      technologist: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d1-1f4bb.png?v8",
      teddy_bear: "https://github.githubassets.com/images/icons/emoji/unicode/1f9f8.png?v8",
      telephone: "https://github.githubassets.com/images/icons/emoji/unicode/260e.png?v8",
      telephone_receiver: "https://github.githubassets.com/images/icons/emoji/unicode/1f4de.png?v8",
      telescope: "https://github.githubassets.com/images/icons/emoji/unicode/1f52d.png?v8",
      tennis: "https://github.githubassets.com/images/icons/emoji/unicode/1f3be.png?v8",
      tent: "https://github.githubassets.com/images/icons/emoji/unicode/26fa.png?v8",
      test_tube: "https://github.githubassets.com/images/icons/emoji/unicode/1f9ea.png?v8",
      thailand: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1ed.png?v8",
      thermometer: "https://github.githubassets.com/images/icons/emoji/unicode/1f321.png?v8",
      thinking: "https://github.githubassets.com/images/icons/emoji/unicode/1f914.png?v8",
      thought_balloon: "https://github.githubassets.com/images/icons/emoji/unicode/1f4ad.png?v8",
      thread: "https://github.githubassets.com/images/icons/emoji/unicode/1f9f5.png?v8",
      three: "https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8",
      thumbsdown: "https://github.githubassets.com/images/icons/emoji/unicode/1f44e.png?v8",
      thumbsup: "https://github.githubassets.com/images/icons/emoji/unicode/1f44d.png?v8",
      ticket: "https://github.githubassets.com/images/icons/emoji/unicode/1f3ab.png?v8",
      tickets: "https://github.githubassets.com/images/icons/emoji/unicode/1f39f.png?v8",
      tiger: "https://github.githubassets.com/images/icons/emoji/unicode/1f42f.png?v8",
      tiger2: "https://github.githubassets.com/images/icons/emoji/unicode/1f405.png?v8",
      timer_clock: "https://github.githubassets.com/images/icons/emoji/unicode/23f2.png?v8",
      timor_leste: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1f1.png?v8",
      tipping_hand_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f481-2642.png?v8",
      tipping_hand_person: "https://github.githubassets.com/images/icons/emoji/unicode/1f481.png?v8",
      tipping_hand_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f481-2640.png?v8",
      tired_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f62b.png?v8",
      tm: "https://github.githubassets.com/images/icons/emoji/unicode/2122.png?v8",
      togo: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1ec.png?v8",
      toilet: "https://github.githubassets.com/images/icons/emoji/unicode/1f6bd.png?v8",
      tokelau: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1f0.png?v8",
      tokyo_tower: "https://github.githubassets.com/images/icons/emoji/unicode/1f5fc.png?v8",
      tomato: "https://github.githubassets.com/images/icons/emoji/unicode/1f345.png?v8",
      tonga: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1f4.png?v8",
      tongue: "https://github.githubassets.com/images/icons/emoji/unicode/1f445.png?v8",
      toolbox: "https://github.githubassets.com/images/icons/emoji/unicode/1f9f0.png?v8",
      tooth: "https://github.githubassets.com/images/icons/emoji/unicode/1f9b7.png?v8",
      top: "https://github.githubassets.com/images/icons/emoji/unicode/1f51d.png?v8",
      tophat: "https://github.githubassets.com/images/icons/emoji/unicode/1f3a9.png?v8",
      tornado: "https://github.githubassets.com/images/icons/emoji/unicode/1f32a.png?v8",
      tr: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1f7.png?v8",
      trackball: "https://github.githubassets.com/images/icons/emoji/unicode/1f5b2.png?v8",
      tractor: "https://github.githubassets.com/images/icons/emoji/unicode/1f69c.png?v8",
      traffic_light: "https://github.githubassets.com/images/icons/emoji/unicode/1f6a5.png?v8",
      train: "https://github.githubassets.com/images/icons/emoji/unicode/1f68b.png?v8",
      train2: "https://github.githubassets.com/images/icons/emoji/unicode/1f686.png?v8",
      tram: "https://github.githubassets.com/images/icons/emoji/unicode/1f68a.png?v8",
      triangular_flag_on_post: "https://github.githubassets.com/images/icons/emoji/unicode/1f6a9.png?v8",
      triangular_ruler: "https://github.githubassets.com/images/icons/emoji/unicode/1f4d0.png?v8",
      trident: "https://github.githubassets.com/images/icons/emoji/unicode/1f531.png?v8",
      trinidad_tobago: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1f9.png?v8",
      tristan_da_cunha: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1e6.png?v8",
      triumph: "https://github.githubassets.com/images/icons/emoji/unicode/1f624.png?v8",
      trolleybus: "https://github.githubassets.com/images/icons/emoji/unicode/1f68e.png?v8",
      trollface: "https://github.githubassets.com/images/icons/emoji/trollface.png?v8",
      trophy: "https://github.githubassets.com/images/icons/emoji/unicode/1f3c6.png?v8",
      tropical_drink: "https://github.githubassets.com/images/icons/emoji/unicode/1f379.png?v8",
      tropical_fish: "https://github.githubassets.com/images/icons/emoji/unicode/1f420.png?v8",
      truck: "https://github.githubassets.com/images/icons/emoji/unicode/1f69a.png?v8",
      trumpet: "https://github.githubassets.com/images/icons/emoji/unicode/1f3ba.png?v8",
      tshirt: "https://github.githubassets.com/images/icons/emoji/unicode/1f455.png?v8",
      tulip: "https://github.githubassets.com/images/icons/emoji/unicode/1f337.png?v8",
      tumbler_glass: "https://github.githubassets.com/images/icons/emoji/unicode/1f943.png?v8",
      tunisia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1f3.png?v8",
      turkey: "https://github.githubassets.com/images/icons/emoji/unicode/1f983.png?v8",
      turkmenistan: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1f2.png?v8",
      turks_caicos_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1e8.png?v8",
      turtle: "https://github.githubassets.com/images/icons/emoji/unicode/1f422.png?v8",
      tuvalu: "https://github.githubassets.com/images/icons/emoji/unicode/1f1f9-1f1fb.png?v8",
      tv: "https://github.githubassets.com/images/icons/emoji/unicode/1f4fa.png?v8",
      twisted_rightwards_arrows: "https://github.githubassets.com/images/icons/emoji/unicode/1f500.png?v8",
      two: "https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8",
      two_hearts: "https://github.githubassets.com/images/icons/emoji/unicode/1f495.png?v8",
      two_men_holding_hands: "https://github.githubassets.com/images/icons/emoji/unicode/1f46c.png?v8",
      two_women_holding_hands: "https://github.githubassets.com/images/icons/emoji/unicode/1f46d.png?v8",
      u5272: "https://github.githubassets.com/images/icons/emoji/unicode/1f239.png?v8",
      u5408: "https://github.githubassets.com/images/icons/emoji/unicode/1f234.png?v8",
      u55b6: "https://github.githubassets.com/images/icons/emoji/unicode/1f23a.png?v8",
      u6307: "https://github.githubassets.com/images/icons/emoji/unicode/1f22f.png?v8",
      u6708: "https://github.githubassets.com/images/icons/emoji/unicode/1f237.png?v8",
      u6709: "https://github.githubassets.com/images/icons/emoji/unicode/1f236.png?v8",
      u6e80: "https://github.githubassets.com/images/icons/emoji/unicode/1f235.png?v8",
      u7121: "https://github.githubassets.com/images/icons/emoji/unicode/1f21a.png?v8",
      u7533: "https://github.githubassets.com/images/icons/emoji/unicode/1f238.png?v8",
      u7981: "https://github.githubassets.com/images/icons/emoji/unicode/1f232.png?v8",
      u7a7a: "https://github.githubassets.com/images/icons/emoji/unicode/1f233.png?v8",
      uganda: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fa-1f1ec.png?v8",
      uk: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1e7.png?v8",
      ukraine: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fa-1f1e6.png?v8",
      umbrella: "https://github.githubassets.com/images/icons/emoji/unicode/2614.png?v8",
      unamused: "https://github.githubassets.com/images/icons/emoji/unicode/1f612.png?v8",
      underage: "https://github.githubassets.com/images/icons/emoji/unicode/1f51e.png?v8",
      unicorn: "https://github.githubassets.com/images/icons/emoji/unicode/1f984.png?v8",
      united_arab_emirates: "https://github.githubassets.com/images/icons/emoji/unicode/1f1e6-1f1ea.png?v8",
      united_nations: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fa-1f1f3.png?v8",
      unlock: "https://github.githubassets.com/images/icons/emoji/unicode/1f513.png?v8",
      up: "https://github.githubassets.com/images/icons/emoji/unicode/1f199.png?v8",
      upside_down_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f643.png?v8",
      uruguay: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fa-1f1fe.png?v8",
      us: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fa-1f1f8.png?v8",
      us_outlying_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fa-1f1f2.png?v8",
      us_virgin_islands: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fb-1f1ee.png?v8",
      uzbekistan: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fa-1f1ff.png?v8",
      v: "https://github.githubassets.com/images/icons/emoji/unicode/270c.png?v8",
      vampire: "https://github.githubassets.com/images/icons/emoji/unicode/1f9db.png?v8",
      vampire_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f9db-2642.png?v8",
      vampire_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f9db-2640.png?v8",
      vanuatu: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fb-1f1fa.png?v8",
      vatican_city: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fb-1f1e6.png?v8",
      venezuela: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fb-1f1ea.png?v8",
      vertical_traffic_light: "https://github.githubassets.com/images/icons/emoji/unicode/1f6a6.png?v8",
      vhs: "https://github.githubassets.com/images/icons/emoji/unicode/1f4fc.png?v8",
      vibration_mode: "https://github.githubassets.com/images/icons/emoji/unicode/1f4f3.png?v8",
      video_camera: "https://github.githubassets.com/images/icons/emoji/unicode/1f4f9.png?v8",
      video_game: "https://github.githubassets.com/images/icons/emoji/unicode/1f3ae.png?v8",
      vietnam: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fb-1f1f3.png?v8",
      violin: "https://github.githubassets.com/images/icons/emoji/unicode/1f3bb.png?v8",
      virgo: "https://github.githubassets.com/images/icons/emoji/unicode/264d.png?v8",
      volcano: "https://github.githubassets.com/images/icons/emoji/unicode/1f30b.png?v8",
      volleyball: "https://github.githubassets.com/images/icons/emoji/unicode/1f3d0.png?v8",
      vomiting_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f92e.png?v8",
      vs: "https://github.githubassets.com/images/icons/emoji/unicode/1f19a.png?v8",
      vulcan_salute: "https://github.githubassets.com/images/icons/emoji/unicode/1f596.png?v8",
      waffle: "https://github.githubassets.com/images/icons/emoji/unicode/1f9c7.png?v8",
      wales: "https://github.githubassets.com/images/icons/emoji/unicode/1f3f4-e0067-e0062-e0077-e006c-e0073-e007f.png?v8",
      walking: "https://github.githubassets.com/images/icons/emoji/unicode/1f6b6.png?v8",
      walking_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f6b6-2642.png?v8",
      walking_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f6b6-2640.png?v8",
      wallis_futuna: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fc-1f1eb.png?v8",
      waning_crescent_moon: "https://github.githubassets.com/images/icons/emoji/unicode/1f318.png?v8",
      waning_gibbous_moon: "https://github.githubassets.com/images/icons/emoji/unicode/1f316.png?v8",
      warning: "https://github.githubassets.com/images/icons/emoji/unicode/26a0.png?v8",
      wastebasket: "https://github.githubassets.com/images/icons/emoji/unicode/1f5d1.png?v8",
      watch: "https://github.githubassets.com/images/icons/emoji/unicode/231a.png?v8",
      water_buffalo: "https://github.githubassets.com/images/icons/emoji/unicode/1f403.png?v8",
      water_polo: "https://github.githubassets.com/images/icons/emoji/unicode/1f93d.png?v8",
      watermelon: "https://github.githubassets.com/images/icons/emoji/unicode/1f349.png?v8",
      wave: "https://github.githubassets.com/images/icons/emoji/unicode/1f44b.png?v8",
      wavy_dash: "https://github.githubassets.com/images/icons/emoji/unicode/3030.png?v8",
      waxing_crescent_moon: "https://github.githubassets.com/images/icons/emoji/unicode/1f312.png?v8",
      waxing_gibbous_moon: "https://github.githubassets.com/images/icons/emoji/unicode/1f314.png?v8",
      wc: "https://github.githubassets.com/images/icons/emoji/unicode/1f6be.png?v8",
      weary: "https://github.githubassets.com/images/icons/emoji/unicode/1f629.png?v8",
      wedding: "https://github.githubassets.com/images/icons/emoji/unicode/1f492.png?v8",
      weight_lifting: "https://github.githubassets.com/images/icons/emoji/unicode/1f3cb.png?v8",
      weight_lifting_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f3cb-2642.png?v8",
      weight_lifting_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f3cb-2640.png?v8",
      western_sahara: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ea-1f1ed.png?v8",
      whale: "https://github.githubassets.com/images/icons/emoji/unicode/1f433.png?v8",
      whale2: "https://github.githubassets.com/images/icons/emoji/unicode/1f40b.png?v8",
      wheel_of_dharma: "https://github.githubassets.com/images/icons/emoji/unicode/2638.png?v8",
      wheelchair: "https://github.githubassets.com/images/icons/emoji/unicode/267f.png?v8",
      white_check_mark: "https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8",
      white_circle: "https://github.githubassets.com/images/icons/emoji/unicode/26aa.png?v8",
      white_flag: "https://github.githubassets.com/images/icons/emoji/unicode/1f3f3.png?v8",
      white_flower: "https://github.githubassets.com/images/icons/emoji/unicode/1f4ae.png?v8",
      white_haired_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f468-1f9b3.png?v8",
      white_haired_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f9b3.png?v8",
      white_heart: "https://github.githubassets.com/images/icons/emoji/unicode/1f90d.png?v8",
      white_large_square: "https://github.githubassets.com/images/icons/emoji/unicode/2b1c.png?v8",
      white_medium_small_square: "https://github.githubassets.com/images/icons/emoji/unicode/25fd.png?v8",
      white_medium_square: "https://github.githubassets.com/images/icons/emoji/unicode/25fb.png?v8",
      white_small_square: "https://github.githubassets.com/images/icons/emoji/unicode/25ab.png?v8",
      white_square_button: "https://github.githubassets.com/images/icons/emoji/unicode/1f533.png?v8",
      wilted_flower: "https://github.githubassets.com/images/icons/emoji/unicode/1f940.png?v8",
      wind_chime: "https://github.githubassets.com/images/icons/emoji/unicode/1f390.png?v8",
      wind_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f32c.png?v8",
      wine_glass: "https://github.githubassets.com/images/icons/emoji/unicode/1f377.png?v8",
      wink: "https://github.githubassets.com/images/icons/emoji/unicode/1f609.png?v8",
      wolf: "https://github.githubassets.com/images/icons/emoji/unicode/1f43a.png?v8",
      woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f469.png?v8",
      woman_artist: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f3a8.png?v8",
      woman_astronaut: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f680.png?v8",
      woman_cartwheeling: "https://github.githubassets.com/images/icons/emoji/unicode/1f938-2640.png?v8",
      woman_cook: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f373.png?v8",
      woman_dancing: "https://github.githubassets.com/images/icons/emoji/unicode/1f483.png?v8",
      woman_facepalming: "https://github.githubassets.com/images/icons/emoji/unicode/1f926-2640.png?v8",
      woman_factory_worker: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f3ed.png?v8",
      woman_farmer: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f33e.png?v8",
      woman_firefighter: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f692.png?v8",
      woman_health_worker: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-2695.png?v8",
      woman_in_manual_wheelchair: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f9bd.png?v8",
      woman_in_motorized_wheelchair: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f9bc.png?v8",
      woman_judge: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-2696.png?v8",
      woman_juggling: "https://github.githubassets.com/images/icons/emoji/unicode/1f939-2640.png?v8",
      woman_mechanic: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f527.png?v8",
      woman_office_worker: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f4bc.png?v8",
      woman_pilot: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-2708.png?v8",
      woman_playing_handball: "https://github.githubassets.com/images/icons/emoji/unicode/1f93e-2640.png?v8",
      woman_playing_water_polo: "https://github.githubassets.com/images/icons/emoji/unicode/1f93d-2640.png?v8",
      woman_scientist: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f52c.png?v8",
      woman_shrugging: "https://github.githubassets.com/images/icons/emoji/unicode/1f937-2640.png?v8",
      woman_singer: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f3a4.png?v8",
      woman_student: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f393.png?v8",
      woman_teacher: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f3eb.png?v8",
      woman_technologist: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f4bb.png?v8",
      woman_with_headscarf: "https://github.githubassets.com/images/icons/emoji/unicode/1f9d5.png?v8",
      woman_with_probing_cane: "https://github.githubassets.com/images/icons/emoji/unicode/1f469-1f9af.png?v8",
      woman_with_turban: "https://github.githubassets.com/images/icons/emoji/unicode/1f473-2640.png?v8",
      womans_clothes: "https://github.githubassets.com/images/icons/emoji/unicode/1f45a.png?v8",
      womans_hat: "https://github.githubassets.com/images/icons/emoji/unicode/1f452.png?v8",
      women_wrestling: "https://github.githubassets.com/images/icons/emoji/unicode/1f93c-2640.png?v8",
      womens: "https://github.githubassets.com/images/icons/emoji/unicode/1f6ba.png?v8",
      woozy_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f974.png?v8",
      world_map: "https://github.githubassets.com/images/icons/emoji/unicode/1f5fa.png?v8",
      worried: "https://github.githubassets.com/images/icons/emoji/unicode/1f61f.png?v8",
      wrench: "https://github.githubassets.com/images/icons/emoji/unicode/1f527.png?v8",
      wrestling: "https://github.githubassets.com/images/icons/emoji/unicode/1f93c.png?v8",
      writing_hand: "https://github.githubassets.com/images/icons/emoji/unicode/270d.png?v8",
      x: "https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8",
      yarn: "https://github.githubassets.com/images/icons/emoji/unicode/1f9f6.png?v8",
      yawning_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f971.png?v8",
      yellow_circle: "https://github.githubassets.com/images/icons/emoji/unicode/1f7e1.png?v8",
      yellow_heart: "https://github.githubassets.com/images/icons/emoji/unicode/1f49b.png?v8",
      yellow_square: "https://github.githubassets.com/images/icons/emoji/unicode/1f7e8.png?v8",
      yemen: "https://github.githubassets.com/images/icons/emoji/unicode/1f1fe-1f1ea.png?v8",
      yen: "https://github.githubassets.com/images/icons/emoji/unicode/1f4b4.png?v8",
      yin_yang: "https://github.githubassets.com/images/icons/emoji/unicode/262f.png?v8",
      yo_yo: "https://github.githubassets.com/images/icons/emoji/unicode/1fa80.png?v8",
      yum: "https://github.githubassets.com/images/icons/emoji/unicode/1f60b.png?v8",
      zambia: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ff-1f1f2.png?v8",
      zany_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f92a.png?v8",
      zap: "https://github.githubassets.com/images/icons/emoji/unicode/26a1.png?v8",
      zebra: "https://github.githubassets.com/images/icons/emoji/unicode/1f993.png?v8",
      zero: "https://github.githubassets.com/images/icons/emoji/unicode/0030-20e3.png?v8",
      zimbabwe: "https://github.githubassets.com/images/icons/emoji/unicode/1f1ff-1f1fc.png?v8",
      zipper_mouth_face: "https://github.githubassets.com/images/icons/emoji/unicode/1f910.png?v8",
      zombie: "https://github.githubassets.com/images/icons/emoji/unicode/1f9df.png?v8",
      zombie_man: "https://github.githubassets.com/images/icons/emoji/unicode/1f9df-2642.png?v8",
      zombie_woman: "https://github.githubassets.com/images/icons/emoji/unicode/1f9df-2640.png?v8",
      zzz: "https://github.githubassets.com/images/icons/emoji/unicode/1f4a4.png?v8",
    },
  })
}
</file>

<file path="tests/mocks/api/github/rest/rateLimit/get.mjs">
/**Mocked data */
export default async function({faker}, target, that, args) {
  return ({
    status: 200,
    url: "https://api.github.com/rate_limit",
    headers: {
      server: "GitHub.com",
      status: "200 OK",
      "x-oauth-scopes": "repo",
    },
    data: {
      resources: {
        core: {limit: 5000, used: 0, remaining: 5000, reset: 0},
        search: {limit: 30, used: 0, remaining: 30, reset: 0},
        graphql: {limit: 5000, used: 0, remaining: 5000, reset: 0},
        integration_manifest: {limit: 5000, used: 0, remaining: 5000, reset: 0},
        source_import: {limit: 100, used: 0, remaining: 100, reset: 0},
        code_scanning_upload: {limit: 500, used: 0, remaining: 500, reset: 0},
      },
      rate: {limit: 5000, used: 0, remaining: "MOCKED", reset: 0},
    },
  })
}
</file>

<file path="tests/mocks/.eslintrc.yml">
# Overrides enforced rules for mocks
rules:
  max-params: off
  no-unused-vars: off
</file>

<file path="tests/ci.test.js">
//Imports
const path = require("path")
const git = require("simple-git")(path.join(__dirname, ".."))

//Edited files list
const diff = async () => (await git.diff(["origin/master...", "--name-status"])).split("\n").map(x => x.trim()).filter(x => /^M\s+/.test(x)).map(x => x.replace(/^M\s+/, ""))

//File changes
describe("Check file changes (checkout your files if needed)", () => {
  describe("Auto-generated files were not modified", () =>
    void test.each([
      "README.md",
      "source/plugins/README.md",
      "source/plugins/community/README.md",
      "source/templates/README.md",
      "action.yml",
      "settings.example.json",
      "tests/cases/*",
      ".github/workflows/examples.yml",
      ".github/readme/partials/documentation/compatibility.md",
    ])("%s", async file => expect((await diff()).includes(file)).toBe(false)))
  if (!["lowlighter"].includes(process.env.PR_AUTHOR)) {
    describe("Repository level files were not modified", () =>
      void test.each([
        ".github/config/*",
        ".github/ISSUE_TEMPLATE/*",
        ".github/readme/partials/license.md",
        ".github/scripts/*",
        ".github/workflows/*",
        ".github/architecture.svg",
        ".github/dependabot.yml",
        ".github/FUNDING.yml",
        ".github/pull_request_template.md/*",
        "LICENSE",
        "ARCHITECTURE.md",
        "SECURITY.md",
        "tests/ci.test.js",
        "source/.eslintrc.yml",
        "source/app/mocks/.eslintrc.yml",
        "vercel.json",
      ])("%s", async file => expect((await diff()).filter(edited => new RegExp(`^${file.replace(/[.]/g, "[.]").replace(/[*]/g, "[\\s\\S]*")}$`).test(edited)).length).toBe(0)))
  }
})

//Template changes
describe("Check template changes", () => {
  test("Use community templates instead (see https://github.com/lowlighter/metrics/tree/master/source/templates/community)", async () => void expect((await diff()).filter(edited => /^sources[/]templates[/]/.test(edited) && /^source[/]templates[/](?:classic|terminal|markdown|repository|community)[/][\s\S]*$/.test(edited)).length).toBe(0))
})
</file>

<file path="tests/metrics.test.js">
//Imports
const processes = require("child_process")
const yaml = require("js-yaml")
const fs = require("fs")
const path = require("path")
const url = require("url")
const axios = require("axios")
const faker = require("@faker-js/faker").faker
const ejs = require("ejs")

//GitHub action
const action = yaml.load(fs.readFileSync(path.join(__dirname, "../action.yml"), "utf8"))
action.defaults = Object.fromEntries(Object.entries(action.inputs).map(([key, {default: value}]) => [key, value]))
action.input = vars => Object.fromEntries([...Object.entries(action.defaults), ...Object.entries(vars)].map(([key, value]) => [`INPUT_${key.toLocaleUpperCase()}`, value]))
action.run = async vars =>
  await new Promise((solve, reject) => {
    let [stdout, stderr] = ["", ""]
    const env = {...process.env, ...action.input(vars), GITHUB_REPOSITORY: "lowlighter/metrics"}
    const child = processes.spawn("node", ["source/app/action/index.mjs"], {env})
    child.stdout.on("data", data => stdout += data)
    child.stderr.on("data", data => stderr += data)
    child.on("close", code => {
      if (code === 0)
        return solve(true)
      console.log(stdout, stderr)
      reject(stdout)
    })
  })

//Web instance
const web = {}
web.run = async vars => (await axios.get(`http://localhost:3000/lowlighter?${new url.URLSearchParams(Object.fromEntries(Object.entries(vars).map(([key, value]) => [key.replace(/^plugin_/, "").replace(/_/g, "."), value])))}`)).status === 200
web.start = async () =>
  new Promise(solve => {
    let stdout = ""
    web.instance = processes.spawn("node", ["source/app/web/index.mjs"], {env: {...process.env, SANDBOX: true}})
    web.instance.stdout.on("data", data => (stdout += data, /Server ready !/.test(stdout) ? solve() : null))
    web.instance.stderr.on("data", data => console.error(`${data}`))
  })
web.stop = async () => await web.instance.kill("SIGKILL")

//Web instance placeholder
require("./../source/app/web/statics/embed/app.placeholder.js")
const placeholder = globalThis.placeholder
delete globalThis.placeholder
placeholder.init({
  faker,
  ejs,
  axios: {
    async get(url) {
      return axios.get(`http://localhost:3000${url}`)
    },
  },
})
placeholder.run = async vars => {
  const options = Object.fromEntries(Object.entries(vars).map(([key, value]) => [key.replace(/^plugin_/, "").replace(/_/g, "."), value]))
  const enabled = Object.fromEntries(Object.entries(vars).filter(([key]) => /^plugin_[a-z]+$/.test(key)))
  const config = Object.fromEntries(Object.entries(options).filter(([key]) => /^config[.]/.test(key)))
  const base = Object.fromEntries(Object.entries(options).filter(([key]) => /^base[.]/.test(key)))
  return typeof await placeholder({
    templates: {selected: vars.template},
    plugins: {enabled: {...enabled, base}, options},
    config,
    version: "TEST",
    user: "lowlighter",
    avatar: "https://github.com/lowlighter.png",
  }) === "string"
}

//Setup
beforeAll(async () => {
  //Clean community template
  await fs.promises.rm(path.join(__dirname, "../source/templates/@classic"), {recursive: true, force: true})
  //Start web instance
  await web.start()
})
//Teardown
afterAll(async () => {
  //Stop web instance
  await web.stop()
  //Clean community template
  await fs.promises.rm(path.join(__dirname, "../source/templates/@classic"), {recursive: true, force: true})
})

//Load metadata (as jest doesn't support ESM modules, we use this dirty hack)
const metadata = JSON.parse(`${
  processes.spawnSync("node", [
    "--input-type",
    "module",
    "--eval",
    'import metadata from "./source/app/metrics/metadata.mjs";console.log(JSON.stringify(await metadata({log:false})))',
  ]).stdout
}`)

//Build tests index
const tests = []
for (const type of ["plugins", "templates"]) {
  for (const name in metadata[type]) {
    const cases = yaml
      .load(fs.readFileSync(path.join(__dirname, "../tests/cases", `${name}.${type.replace(/s$/, "")}.yml`), "utf8"))
      ?.map(({name: test, with: inputs, modes = [], timeout}) => {
        const skip = new Set(Object.entries(metadata.templates).filter(([_, {readme: {compatibility}}]) => !compatibility[name]).map(([template]) => template))
        if (!(metadata[type][name].supports?.includes("repository")))
          skip.add("repository")
        return [test, inputs, {skip: [...skip], modes, timeout}]
      }) ?? []
    tests.push(...cases)
  }
}

//Tests run
describe("GitHub Action", () =>
  describe.each([
    ["classic", {}],
    ["terminal", {}],
    ["repository", {repo: "metrics"}],
  ])("Template : %s", (template, query) => {
    for (const [name, input, {skip = [], modes = [], timeout} = {}] of tests) {
      if ((skip.includes(template)) || ((modes.length) && (!modes.includes("action"))))
        test.skip(name, () => null)
      else
        test(name, async () => expect(await action.run({template, base: "", query: JSON.stringify(query), plugins_errors_fatal: true, dryrun: true, use_mocked_data: true, verify: true, retries: 1, ...input})).toBe(true), timeout)
    }
  }))

describe("Web instance", () =>
  describe.each([
    ["classic", {}],
    ["terminal", {}],
    ["repository", {repo: "metrics"}],
  ])("Template : %s", (template, query) => {
    for (const [name, input, {skip = [], modes = [], timeout} = {}] of tests) {
      if ((skip.includes(template)) || ((modes.length) && (!modes.includes("web"))))
        test.skip(name, () => null)
      else
        test(name, async () => expect(await web.run({template, base: 0, ...query, plugins_errors_fatal: true, verify: true, ...input})).toBe(true), timeout)
    }
  }))

describe("Web instance (placeholder)", () =>
  describe.each([
    ["classic", {}],
    ["terminal", {}],
  ])("Template : %s", (template, query) => {
    for (const [name, input, {skip = [], modes = [], timeout} = {}] of tests) {
      if ((skip.includes(template)) || ((modes.length) && (!modes.includes("placeholder"))))
        test.skip(name, () => null)
      else
        test(name, async () => expect(await placeholder.run({template, base: 0, ...query, ...input})).toBe(true), timeout)
    }
  }))
</file>

<file path="tests/presets.test.js">
//Imports
const processes = require("child_process")
const yaml = require("js-yaml")
const fss = require("fs")
const paths = require("path")

//Git setup
const __metrics = paths.join(paths.dirname(__dirname, ".."))
const __presets = paths.join(__metrics, ".presets")

//Clone presets branch
try {
  fss.accessSync(__presets)
}
catch {
  let {HEAD_REF: branch, REPO: repo} = process.env
  branch = branch || "presets"
  repo = repo || "lowlighter/metrics"
  if (!/^[/-\w\d]+$/.test(branch))
    throw new Error(`invalid branch: ${branch}`)
  if (!/^[-\w\d]+\/[-\w\d]+$/.test(repo))
    throw new Error(`invalid repo: ${repo}`)
  console.log(`cloning: ${repo}@${branch}`)
  processes.execFileSync("git", ["clone", `https://github.com/${repo}.git`, __presets, "--branch", branch, "--single-branch"])
}

//Generate presets examples
for (const path of fss.readdirSync(__presets)) {
  if (/^[.@]/.test(path))
    continue
  if (!(fss.lstatSync(paths.join(__presets, path))).isDirectory())
    continue

  describe(`Preset: ${path}`, () => {
    try {
      //Load preset
      const preset = yaml.load(fss.readFileSync(paths.join(__presets, path, "preset.yml")))
      test("syntax is valid", () => expect(true).toBe(true))
      try {
        //Load schema
        const {properties} = yaml.load(fss.readFileSync(paths.join(__presets, "@schema", `${preset.schema}.yml`)))
        test("schema is valid", () => expect(preset.schema).toBeDefined())
        //Test schema
        for (const [key, {type, required}] of Object.entries(properties)) {
          if (required)
            test(`preset.${key} is defined`, () => expect(preset[key]).toBeDefined())
          test(`preset.${key} type is ${type}`, () => {
            switch (true) {
              case /^'.*'$/.test(type): {
                const value = type.substring(1, type.length - 1)
                expect(preset[key]).toBe(value)
                return
              }
              case /\{\}$/.test(type): {
                const typed = type.substring(0, type.length - 2)
                expect(typeof preset[key]).toBe("object")
                if (typed !== "unknown") {
                  for (const value of Object.values(preset[key]))
                    expect(typeof value).toBe(typed)
                }
                return
              }
              case /\[\]$/.test(type): {
                const typed = type.substring(0, type.length - 2)
                expect(Array.isArray(preset[key])).toBe(true)
                if (typed !== "unknown") {
                  for (const value of Object.values(preset[key]))
                    expect(typeof value).toBe(typed)
                }
                return
              }
              default:
                expect(typeof preset[key]).toBe(type)
            }
          })
        }
      }
      catch (error) {
        test(`schema is valid (got ${preset.schema})`, () => expect(false).toBe(true))
      }
    }
    catch {
      test("syntax is valid", () => expect(false).toBe(true))
    }
  })
}
</file>

<file path="tests/secrets.json">
{
  "METRICS_TOKEN":"MOCKED_TOKEN",
  "METRICS_TOKEN_WITH_SCOPES":"MOCKED_TOKEN",
  "METRICS_TOKEN_PERSONAL": "MOCKED_TOKEN",
  "PAGESPEED_TOKEN":"MOCKED_TOKEN",
  "SPOTIFY_TOKENS":"MOCKED_CLIENT_ID, MOCKED_CLIENT_SECRET, MOCKED_REFRESH_TOKEN",
  "YOUTUBE_MUSIC_TOKENS":"SAPISID=MOCKED_COOKIE; OTHER_PARAM=OTHER_VALUE;",
  "LASTFM_TOKEN":"MOCKED_TOKEN",
  "NIGHTSCOUT_URL":"https://testapp.herokuapp.com/",
  "WAKATIME_TOKEN":"MOCKED_TOKEN",
  "TWITTER_TOKEN":"MOCKED_TOKEN",
  "GOOGLE_MAP_TOKEN": "MOCKED_TOKEN",
  "STOCK_TOKEN":"MOCKED_TOKEN",
  "CHESS_TOKEN":"MOCKED_TOKEN",
  "STEAM_TOKEN":"MOCKED_TOKEN",
  "SPLATOON_TOKEN":"{}",
  "SPLATOON_STATINK_TOKEN":"MOCKED_TOKEN",
  "POOPMAP_TOKEN":"MOCKED_TOKEN",
  "SIXTEEN_PERSONALITIES_URL":"https://www.16personalities.com/profiles/b7d9f29453ea5"
}
</file>

<file path=".dockerignore">
node_modules
</file>

<file path=".editorconfig">
[*.{js,mjs}]
charset = utf-8
indent_style = space
indent_size = 2
</file>

<file path=".gitattributes">
# Auto detect text files and perform LF normalization
* text=auto

# Vendored files
source/templates/** linguist-vendored
source/app/web/statics/style.vars.css linguist-vendored

# Hidden files
.github/** -linguist-detectable

# Documentation
ARCHITECTURE.md linguist-documentation
CODE_OF_CONDUCT.md linguist-documentation
CONTRIBUTING.md linguist-documentation
LICENSE.md linguist-documentation
SECURITY.md linguist-documentation
README.md linguist-documentation

# Generated files
source/plugins/README.md linguist-generated
source/plugins/community/README.md linguist-generated
source/templates/README.md linguist-generated
action.yml linguist-generated
settings.example.json linguist-generated
tests/cases/* linguist-generated
package-lock.json linguist-generated
</file>

<file path="ARCHITECTURE.md">
# üìê Project architecture

Following diagram explain how **metrics** code is structured:

![Architecture](/.github/architecture.svg)

## üóÇÔ∏è Project structure
This section explain how *metrics* is structured.

* `source/app/metrics/` contains *metrics* engine files
* `source/app/action/` contains GitHub action files
  * `index.mjs` contains GitHub action entry point
  * `action.yml` contains GitHub action templated descriptor
* `source/app/web/` contains web instance files
  * `index.mjs` contains web instance entry point
  * `instance.mjs` contains web instance source code
  * `settings.example.json` contains web instance settings example
  * `statics/` contains web instance static files
    * `app.js` contains web instance client source code
    * `app.placeholder.js` contains web instance placeholder mocked data
* `source/plugins/*/` contains source code of plugins
  * `README.md` contains plugin documentation
  * `metadata.yml` contains plugin metadata
  * `examples.yml` contains plugin workflow examples
  * `index.mjs` contains plugin source code
  * `queries/` contains plugin GraphQL queries
* `source/templates/*/` contains templates files
  * `README.md` contains template documentation
  * `metadata.yml` contains template metadata
  * `examples.yml` contains template workflow examples
  * `image.svg` contains template image used to render metrics
  * `style.css` contains style used to render metrics
  * `fonts.css` contains additional fonts used to render metrics
  * `template.mjs` contains template source code
* `tests/` contains tests
  * `metrics.test.js` contains metrics testers
  * `source/app/mocks/` contains mocked data files
  * `api/` contains mocked api data
    * `axios/` contains external REST APIs mocked data
    * `github/` contains mocked GitHub api data
  * `index.mjs` contains mockers
* `Dockerfile` contains docker instructions used to build metrics image
* `package.json` contains dependencies and command line aliases

## üé¨ Behind the scenes

This section explore some topics which explain globally how metrics was designed and how it works.

### üí¨ Creating SVGs images on-the-fly

*metrics* actually exploit the possibility of integrating HTML and CSS into SVGs, so basically creating these images is as simple as designing static web pages. It can even handle animations and transparency.

![Metrics are html](/.github/readme/imgs/about_metrics_are_html.png)

SVGs are templated through [EJS framework](https://github.com/mde/ejs) to make the whole rendering process easier thanks to variables, conditional and loop statements. Only drawback is that it tends to make syntax coloration a bit confused because templates are often misinterpreted as HTML tags markers (`<%= "EJS templating syntax" %>`).

Images (and custom fonts) are encoded into base64 to prevent cross-origin requests, while also removing any external dependencies, although it tends to increase files sizes.

Since SVG renders differently depending on OS and browsers (system fonts, CSS support, ...), it's pretty hard to compute dynamically height. Previously, it was computed with ugly formulas, but as it wasn't scaling really well (especially since the introduction of variable content length plugins). It was often resulting in large empty blank spaces or really badly cropped image.

To solve this, metrics now spawns a [puppeteer](https://github.com/puppeteer/puppeteer) instance and directly render SVG in a browser environment (with all animations disabled). An hidden "marker" element is placed at the end of the image, and is used to resize image through its Y-offset.

![Metrics marker](/.github/readme/imgs/about_metrics_marker.png)

Additional bonus of using puppeteer is that it can take screenshots, making it easy to convert SVGs to PNG output.

### üí¨ Gathering external data from GitHub APIs and Third-Party services

*metrics* mostly use GitHub APIs since it is its primary target. Most of the time, data are retrieved through GraphQL to save APIs requests, but it sometimes fallback on REST for other features. Octokit SDKs are used to make it easier.

As for other external services (Twitter, Spotify, PageSpeed, ...), metrics use their respective APIs, usually making https requests through [axios](https://github.com/axios/axios) and by following their documentation. It would be overkill to install entire SDKs for these since plugins rarely uses more than 2/3 calls.

In last resort, puppeteer is seldom used to scrap websites, though its use tends to make things slow and unstable (as it'll break upon HTML structural changes).

### üí¨ Web instance and GitHub action similarities

Historically, metrics used to be only a web service without any customization possible. The single input was a GitHub username, and was composed of what is now `base` content (along with `languages` and `followup` plugin, which is why they can be computed without any additional queries). That's why `base` content is handled a bit differently from plugins.

As it gathered more and more plugins over time, generating a single user's metrics was becoming costly both in terms of resources but also in APIs requests. It was thus decided to switch to GitHub Action. At first, it was just a way to explore possibilities of this GitHub feature, but now it's basically the full-experience of metrics (unless you use your own  self-hosted instance).

Both web instance and Action actually use the same entrypoint so they basically have the same features.
Action just format inputs into a query-like object (similarly to when url params are parsed by web instance), from which metrics compute the rendered image. It also makes testing easier, as test cases can be reused since only inputs differs.

## üì¶ Packages reference

Below is a list of used packages.

* [express/express.js](https://github.com/expressjs/express) and [expressjs/compression](https://github.com/expressjs/compression)
  * To serve, compute and render a GitHub user's metrics
* [nfriedly/express-rate-limit](https://github.com/nfriedly/express-rate-limit)
  * To apply rate limiting on server and avoid spams and hitting GitHub API's own rate limit
* [octokit/graphql.js](https://github.com/octokit/graphql.js/) and [octokit/rest.js](https://github.com/octokit/rest.js)
  * To perform request to GitHub GraphQL API and GitHub REST API
* [mde/ejs](https://github.com/mde/ejs)
  * To render SVG images
* [ptarjan/node-cache](https://github.com/ptarjan/node-cache)
  * To cache generated content
* [lovell/sharp](https://github.com/lovell/sharp), [foliojs/png.js](https://github.com/foliojs/png.js) and [eugeneware/gifencoder](https://github.com/eugeneware/gifencoder)
  * To process images transformations
* [svg/svgo](https://github.com/svg/svgo)
  * To optimize generated SVG
* [axios/axios](https://github.com/axios/axios)
  * To make HTTP/S requests
* [actions/toolkit](https://github.com/actions/toolkit/tree/master)
  * To build the GitHub Action
* [vuejs/vue](https://github.com/vuejs/vue), [egoist/vue-prism-component](https://github.com/egoist/vue-prism-component), [prismjs/prism](https://github.com/prismjs/prism) and [zenorocha/clipboard.js](https://github.com/zenorocha/clipboard.js)
  * To display server application
* [puppeteer/puppeteer](https://github.com/puppeteer/puppeteer)
  * To scrape the web
* [marudor/libxmljs2](https://github.com/marudor/libxmljs2) and [chrisbottin/xml-formatter](https://github.com/chrisbottin/xml-formatter)
  * To format, test and verify SVG validity
* [facebook/jest](https://github.com/facebook/jest) and [nodeca/js-yaml](https://github.com/nodeca/js-yaml)
  * For unit testing
* [faker-js/faker](https://github.com/faker-js/faker)
  * For mocking data
* [steveukx/git-js](https://github.com/steveukx/git-js)
  * For simple git operations
* [twitter/twemoji-parser](https://github.com/twitter/twemoji-parser) and [IonicaBizau/emoji-name-map](https://github.com/IonicaBizau/emoji-name-map)
  * To parse and handle emojis/[twemojis](https://github.com/twitter/twemoji)
* [jshemas/openGraphScraper](https://github.com/jshemas/openGraphScraper)
  * To retrieve open graphs metadata
* [rbren/rss-parser](https://github.com/rbren/rss-parser)
  * To parse RSS streams
* [Nixinova/Linguist](https://github.com/Nixinova/Linguist)
  * To analyze used languages
* [markedjs/marked](https://github.com/markedjs/marked) and [apostrophecms/sanitize-html](https://github.com/apostrophecms/sanitize-html)
  * To render markdown blocks
* [css/csso](https://github.com/css/csso) and [FullHuman/purgecss](https://github.com/FullHuman/purgecss)
  * To optimize and purge unused CSS
* [isaacs/minimatch](https://github.com/isaacs/minimatch)
  * For file traversal
* [node-fetch/node-fetch](https://github.com/node-fetch/node-fetch)
  * For `fetch` polyfill
* [eslint/eslint](https://github.com/eslint/eslint)
  * As linter
</file>

<file path="CODE_OF_CONDUCT.md">
# Contributor Covenant Code of Conduct

## Our Pledge

We as members, contributors, and leaders pledge to make participation in our
community a harassment-free experience for everyone, regardless of age, body
size, visible or invisible disability, ethnicity, sex characteristics, gender
identity and expression, level of experience, education, socioeconomic status,
nationality, personal appearance, race, religion, or sexual identity
and orientation.

We pledge to act and interact in ways that contribute to an open, welcoming,
diverse, inclusive, and healthy community.

## Our Standards

Examples of behavior that contributes to a positive environment for our
community include:

* Demonstrating empathy and kindness toward other people
* Being respectful of differing opinions, viewpoints, and experiences
* Giving and gracefully accepting constructive feedback
* Accepting responsibility and apologizing to those affected by our mistakes,
  and learning from the experience
* Focusing on what is best not just for us as individuals, but for the
  overall community

Examples of unacceptable behavior include:

* The use of sexualized language or imagery, and sexual attention or
  advances of any kind
* Trolling, insulting or derogatory comments, and personal or political attacks
* Public or private harassment
* Publishing others' private information, such as a physical or email
  address, without their explicit permission
* Other conduct which could reasonably be considered inappropriate in a
  professional setting

## Enforcement Responsibilities

Community leaders have the right and responsibility to remove, edit, or reject
comments, commits, code, wiki edits, issues, and other contributions that are
not aligned to this Code of Conduct, and will communicate reasons for moderation
decisions when appropriate.

Community leaders will take appropriate and fair corrective action in
response to any behavior that they deem inappropriate, threatening, offensive,
or harmful.

## Enforcement Guidelines

Community leaders will follow these Community Impact Guidelines in determining
the consequences for any action they deem in violation of this Code of Conduct:

### 1. Correction

**Community Impact**: Use of inappropriate language or other behavior deemed
unprofessional or unwelcome in the community.

**Consequence**: Offending messages will be deleted at the discretion of the
community leaders.

### 2. Temporary Ban

**Community Impact**: A serious violation of community standards, including
sustained inappropriate behavior.

**Consequence**: A temporary ban from any sort of interaction or public
communication with the community for a specified period of time. No public or
private interaction with the people involved, including unsolicited interaction
with those enforcing the Code of Conduct, is allowed during this period.
Violating these terms may lead to a permanent ban.

### 3. Permanent Ban

**Community Impact**: Demonstrating a pattern of violation of community
standards, including sustained inappropriate behavior, harassment of an
individual, or aggression toward or disparagement of classes of individuals.

**Consequence**: A permanent ban from any sort of public interaction within
the community.

## Attribution

This Code of Conduct was inspired by [Mozilla's code of conduct
enforcement ladder](https://github.com/mozilla/diversity) and adapted from
[Contributor Covenant version 2.0](https://www.contributor-covenant.org/version/2/0/code_of_conduct.html).
</file>

<file path="CONTRIBUTING.md">
# üí™ Interested in contributing?

Nice! Please read the few sections below to understand how to implement new features.

## üë®‚Äçüíª Extending *metrics*

Be sure to read [ARCHITECTURE.md](/ARCHITECTURE.md) first to understand how `metrics` is structured and to follow [`üîß Local setup for development`](.github/readme/partials/documentation/setup/local.md) to get a working development environment!

Before working on something, ensure that it will not duplicate any active open pull requests (including drafts).

It is advised to open a [`üí¨ discussion`](https://github.com/lowlighter/metrics/discussions) first to gather feedback about new features.

> ‚ö†Ô∏è To avoid an ever-growing backlog, inactive pull requests will be closed after 3 weeks and locked after 5 weeks.

> üòÖ Be positive! Even if your changes don't get merged in [lowlighter/metrics](https://github.com/lowlighter/metrics), please don't be too sad, you will always be able to run workflows directly from your fork!

## ü§ù Accepted contributions

The following contributions are accepted:
<table>
  <tr>
    <th>Section</th>
    <th>Changes</th>
    <th>Additions</th>
    <th>Notes</th>
  </tr>
  <tr>
    <td nowrap="nowrap">üß© Plugins</td>
    <td>‚úîÔ∏è</td>
    <td>‚úîÔ∏è</td>
    <td>
      <ul>
        <li>New features for existing plugins are allowed but must be optional and backward compatible</li>
        <li>New community plugins are welcomed provided they're functional and not redundant with existing plugins</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td nowrap="nowrap">üñºÔ∏è Templates</td>
    <td>‚úì</td>
    <td>‚ùå</td>
    <td>
      <ul>
        <li>Template changes are allowed with new features additions (but must remain consistent with current visuals)</li>
        <li>New templates should use <a href="https://github.com/lowlighter/metrics/blob/master/source/templates/community/README.md">üìï Community templates</a> instead</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td nowrap="nowrap">ü™õ Presets</td>
    <td>‚úîÔ∏è</td>
    <td>‚úîÔ∏è</td>
    <td>
      <ul>
        <li>New presets are welcomed provided they're functional and not redundant with existing presets</li>
        <li>Note that presets are on <code><a href="https://github.com/lowlighter/metrics/tree/presets">@presets</a></code> branch</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td nowrap="nowrap">üß™ Tests</td>
    <td>‚úîÔ∏è</td>
    <td>‚úîÔ∏è</td>
    <td>
      <ul>
        <li>Everything that makes metrics more stable is welcomed!</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td nowrap="nowrap">üß± Core</td>
    <td>‚úì</td>
    <td>‚ùå</td>
    <td>
      <ul>
        <li>Core changes impact all rendering process and should be avoided unless necessary</li>
        <li>New dependencies should be avoided when possible</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td nowrap="nowrap">üóÉÔ∏è Repository</td>
    <td>‚ùå</td>
    <td>‚ùå</td>
    <td>
      <ul>
        <li>Workflows, license, readmes, etc. usually don't need to be edited</li>
      </ul>
    </td>
  </tr>
</table>

**Legend**
* ‚úîÔ∏è: Contributions welcomed!
* ‚úì: Contributions are welcomed, but must be discussed first
* ‚ùå: Only maintainers can manage these files
</file>

<file path="LICENSE">
MIT License

Copyright (c) 2020-present lowlighter

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</file>

<file path="SECURITY.md">
### üìù Reporting a Vulnerability

To report a vulnerability, simply open an [issue](https://github.com/lowlighter/metrics/issues).
We'll try to patch it quickly.
</file>

<file path="vercel.json">
{
  "rewrites":[
    {"source": "/.uncache", "destination": "https://metrics.lecoq.io/.uncache"},
    {"source": "/.requests", "destination": "https://metrics.lecoq.io/.requests"},
    {"source": "/.templates", "destination": "/.templates__"},
    {"source": "/.templates/:template", "destination": "/.templates_/:template"},
    {"source": "/about/query/:login", "destination": "https://metrics.lecoq.io/about/query/:login"},
    {"source": "/about/query/:login/:plugin", "destination": "https://metrics.lecoq.io/about/query/:login/:plugin"},
    {"source": "/insights/query/:login", "destination": "https://metrics.lecoq.io/insights/query/:login"},
    {"source": "/insights/query/:login/:plugin", "destination": "https://metrics.lecoq.io/insights/query/:login/:plugin"},
    {"source": "/:login([-\\w]+)", "destination": "https://metrics.lecoq.io/:login"},
    {"source": "/:login([-\\w]+)/:repository([-\\w]+)", "destination": "https://metrics.lecoq.io/:login/:repository"}
  ],
  "github":{
    "silent": true,
    "autoJobCancelation": true
  }
}
</file>

<file path=".github/actions/spelling/excludes.txt">
# See https://github.com/check-spelling/check-spelling/wiki/Configuration-Examples:-excludes
(?:^|/)(?i)COPYRIGHT
(?:^|/)(?i)LICEN[CS]E
(?:^|/)go\.sum$
(?:^|/)package(?:-lock|)\.json$
(?:^|/)vendor/
ignore$
\.a$
\.ai$
\.avi$
\.bmp$
\.bz2$
\.crt$
\.dll$
\.DS_Store$
\.eot$
\.exe$
\.gif$
\.gitattributes$
\.graffle$
\.gz$
\.icns$
\.ico$
\.jar$
\.jpe?g$
\.key$
\.lib$
\.lock$
\.map$
\.min\..
\.mod$
\.mp[34]$
\.o$
\.ocf$
\.otf$
\.pdf$
\.pem$
\.png$
\.psd$
\.s$
\.svg$
\.tiff?$
\.ttf$
\.wav$
\.woff2?$
\.zip$
^\.github/actions/spelling/
^\Q.github/readme/partials/documentation/inspirations.md\E$
^\Q.github/workflows/spelling.yml\E$
^source/plugins/community/splatoon/
^\Qsource/plugins/sponsors/index.mjs\E$
^\Qsource/plugins/stargazers/worldmap/atlas/50m_countries.geojson\E$
^\Qsource/templates/classic/partials/splatoon.ejs\E$
^\Qsource/templates/markdown/example.md\E$
^\Qsource/templates/terminal/fonts.css\E$
^\Qsource/templates/terminal/partials/screenshot.ejs\E$
^\Qtests/mocks/api/github/rest/emojis/get.mjs\E$
^\Qtests/mocks/api/axios/get/lichess.mjs\E$
^\Qtests/mocks/api/axios/get/steam.mjs\E$
</file>

<file path=".github/scripts/quickstart/template/partials/_.json">
[
  "hello"
]
</file>

<file path=".github/scripts/presets_examples.mjs">
//Imports
import processes from "child_process"
import fs from "fs/promises"
import yaml from "js-yaml"
import paths from "path"
import sgit from "simple-git"
import url from "url"

//Mode
const [mode = "dryrun"] = process.argv.slice(2)
console.log(`Mode: ${mode}`)

//Git setup
const __metrics = paths.join(paths.dirname(url.fileURLToPath(import.meta.url)), "../..")
const __presets = paths.join(__metrics, ".presets")

if ((!await fs.access(__presets).then(_ => true).catch(_ => false)) || (!(await fs.lstat(__presets)).isDirectory()))
  await sgit().clone(`https://github-actions[bot]:${process.env.GITHUB_TOKEN}@github.com/lowlighter/metrics`, __presets, {"--branch": "presets", "--single-branch": true})
const git = sgit(__presets)
await git.pull()
const staged = new Set()

//Web instance
const web = {}
web.run = async vars => await fetch(`http://localhost:3000/lowlighter?${new url.URLSearchParams(Object.fromEntries(Object.entries(vars).map(([key, value]) => [key.replace(/^plugin_/, "").replace(/_/g, "."), value])))}`).then(response => response.text())
web.start = async () =>
  new Promise(solve => {
    let stdout = ""
    web.instance = processes.spawn("node", ["source/app/web/index.mjs"], {env: {...process.env, SANDBOX: true}})
    web.instance.stdout.on("data", data => (stdout += data, /Server ready !/.test(stdout) ? solve() : null))
    web.instance.stderr.on("data", data => console.error(`${data}`))
  })
web.stop = async () => await web.instance.kill("SIGKILL")

//Generate presets examples
await web.start()
for (const path of await fs.readdir(__presets)) {
  if (/^[.@]/.test(path))
    continue
  if (!(await fs.lstat(paths.join(__presets, path))).isDirectory())
    continue
  const preset = path

  //Example
  console.log(`generating: ${preset}/example.svg`)
  const svg = await web.run({config_presets: `@${preset}`, plugins_errors_fatal: true})
  await fs.writeFile(paths.join(__presets, path, "example.svg"), svg)
  staged.add(paths.join(__presets, path, "example.svg"))

  //Readme
  console.log(`generating: ${preset}/README.svg`)
  const {name, description} = await yaml.load(await fs.readFile(paths.join(__presets, preset, "preset.yml")))
  await fs.writeFile(
    paths.join(__presets, path, "README.md"),
    `
<table>
  <tr><th><h3>${name}</h3></th></tr>
  <tr><td align="center"><p>${description}</p></td></tr>
  <tr><td align="center">
    <img src="example.svg">
    <img width="900" height="1" alt="">
  </td></tr>
</table>
`.trim(),
  )
  staged.add(paths.join(__presets, path, "README.md"))
}
await web.stop()

//Commit and push
if (mode === "publish") {
  console.log(`Pushing staged changes: \n${[...staged].map(file => `  - ${file}`).join("\n")}`)
  const gitted = await git
    .addConfig("user.name", "github-actions[bot]")
    .addConfig("user.email", "41898282+github-actions[bot]@users.noreply.github.com")
    .add([...staged])
    .commit("ci: auto-regenerate files")
    .push("origin", "presets")
  console.log(gitted)
}
console.log("Success!")
</file>

<file path=".github/workflows/examples.presets.yml">
name: Publish examples (presets)
on:
  schedule:
    - cron: "0 16 1/2 * *"
  workflow_dispatch:
  workflow_call:
jobs:
  examples:
    runs-on: ubuntu-latest
    if: "github.repository == 'lowlighter/metrics'"
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Setup NodeJS
        uses: actions/setup-node@v3
        with:
          node-version: 20
      - name: Setup metrics
        run: npm ci
      - name: Publish presets examples
        run: npm run presets -- publish
        env:
          GITHUB_TOKEN: ${{ github.token }}
</file>

<file path=".github/workflows/stale.yml">
name: Stale issues, pr and runs

on:
  schedule:
    - cron: "30 1 * * *"
  workflow_dispatch:

jobs:
  stale:
    name: Flag stale issues and pull requests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/stale@v6
        with:
          days-before-stale: -1
          stale-pr-message: This pull request seems to be inactive and will be automatically closed in a few days if it remains without any activity.
          days-before-pr-stale: 90
          days-before-pr-close: 7
          stale-pr-label: ‚èπÔ∏è stale
          remove-stale-when-updated: yes
          exempt-issue-labels: üì¶ dependencies
  lock:
    name: Lock inactive closed issues and pull requests
    needs:
      - stale
    runs-on: ubuntu-latest
    steps:
      - uses: dessant/lock-threads@v4
        with:
          github-token: ${{ github.token }}
          issue-inactive-days: 180
          issue-lock-reason: ""
          add-issue-labels: ‚òëÔ∏è archived
          pr-inactive-days: 180
          pr-lock-reason: ""
          add-pr-labels: ‚òëÔ∏è archived
  workflows:
    name: Remove expired workflow runs
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Run script
        run: ./delete_workflows.sh lowlighter/metrics
        working-directory: .github/actions/ghcr-clean
        env:
          GITHUB_TOKEN: ${{ github.token }}
</file>

<file path=".github/workflows/test.presets.yml">
name: Test (presets)

on:
  pull_request:
    branches: [ presets ]
  workflow_call:
    inputs:
      ref:
        type: string
      repo:
        type: string
jobs:

  test:
    name: Test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          ref: master
      - name: Setup NodeJS
        uses: actions/setup-node@v3
        with:
          node-version: 20
      - name: Setup metrics
        run: npm ci
      - name: Run tests
        run: npm run test-presets
        env:
          HEAD_REF: ${{ inputs.ref }}
          REPO: ${{ inputs.repo }}
</file>

<file path=".github/dependabot.yml">
version: 2
updates:
  - package-ecosystem: npm
    open-pull-requests-limit: 0 # Will not be managed by npm anymore in v4
    labels:
      - üì¶ dependencies
    directory: /
    schedule:
      interval: weekly
    pull-request-branch-name:
      separator: "-"
    reviewers:
      - lowlighter
    commit-message:
      prefix: "chore(deps)"
    ignore:
      - dependency-name: "*"
        update-types:
          - version-update:semver-patch
      - dependency-name: vue-prism-component
        versions:
          - 2.0.0
</file>

<file path="source/app/metrics/metadata.mjs">
//Imports
import fs from "fs"
import yaml from "js-yaml"
import { marked } from "marked"
import path from "path"
import url from "url"

//Defined categories
const categories = ["core", "github", "social", "community"]

//Previous descriptors
let previous = null

//Environment
const env = {ghactions: `${process.env.GITHUB_ACTIONS}` === "true"}

/**Metadata descriptor parser */
export default async function metadata({log = true, diff = false} = {}) {
  //Paths
  const __metrics = path.join(path.dirname(url.fileURLToPath(import.meta.url)), "../../..")
  const __templates = path.join(__metrics, "source/templates")
  const __plugins = path.join(__metrics, "source/plugins")
  const __package = path.join(__metrics, "package.json")
  const __descriptor = path.join(__metrics, "action.yml")

  //Init
  const logger = log ? console.debug : () => null

  //Diff with latest version
  if (diff) {
    try {
      previous = yaml.load(await fetch("https://raw.githubusercontent.com/lowlighter/metrics/latest/action.yml").then(response => response.text()))
    }
    catch (error) {
      logger(error)
    }
  }

  //Load plugins metadata
  let Plugins = {}
  logger("metrics/metadata > loading plugins metadata")
  for (const name of await fs.promises.readdir(__plugins)) {
    if (!(await fs.promises.lstat(path.join(__plugins, name))).isDirectory())
      continue
    switch (name) {
      case "community": {
        const ___plugins = path.join(__plugins, "community")
        for (const name of await fs.promises.readdir(___plugins)) {
          if (!(await fs.promises.lstat(path.join(___plugins, name))).isDirectory())
            continue
          logger(`metrics/metadata > loading plugin metadata [community/${name}]`)
          Plugins[name] = await metadata.plugin({__plugins: ___plugins, __templates, name, logger})
          Plugins[name].community = true
        }
        continue
      }
      default:
        logger(`metrics/metadata > loading plugin metadata [${name}]`)
        Plugins[name] = await metadata.plugin({__plugins, __templates, name, logger})
    }
  }
  //Reorder keys
  const {base, core, ...plugins} = Plugins //eslint-disable-line no-unused-vars
  Plugins = Object.fromEntries(Object.entries(Plugins).sort(([_an, a], [_bn, b]) => a.category === b.category ? (a.index ?? Infinity) - (b.index ?? Infinity) : categories.indexOf(a.category) - categories.indexOf(b.category)))
  logger(`metrics/metadata > loaded [${Object.keys(Plugins).join(", ")}]`)
  //Load templates metadata
  let Templates = {}
  logger("metrics/metadata > loading templates metadata")
  for (const name of await fs.promises.readdir(__templates)) {
    if (!(await fs.promises.lstat(path.join(__templates, name))).isDirectory())
      continue
    logger(`metrics/metadata > loading template metadata [${name}]`)
    Templates[name] = await metadata.template({__templates, name, plugins, logger})
  }
  //Reorder keys
  const {community, ...templates} = Templates
  Templates = {...Object.fromEntries(Object.entries(templates).sort(([_an, a], [_bn, b]) => (a.index ?? Infinity) - (b.index ?? Infinity))), community}

  //Packaged metadata
  const packaged = JSON.parse(`${await fs.promises.readFile(__package)}`)

  //Descriptor metadata
  const descriptor = yaml.load(`${await fs.promises.readFile(__descriptor, "utf-8")}`)

  //Metadata
  return {plugins: Plugins, templates: Templates, packaged, descriptor, env}
}

/**Metadata extractor for inputs */
metadata.inputs = {}

/**Metadata extractor for templates */
metadata.plugin = async function({__plugins, __templates, name, logger}) {
  try {
    //Load meta descriptor
    const raw = `${await fs.promises.readFile(path.join(__plugins, name, "metadata.yml"), "utf-8")}`
    const {inputs, ...meta} = yaml.load(raw)
    Object.assign(metadata.inputs, inputs)

    //Category
    if (!categories.includes(meta.category))
      meta.category = "community"
    if ((meta.category === "github") && (!meta.disclaimer))
      meta.disclaimer = "This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with [GitHub](https://github.com).\nAll product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders."

    //Deprecation
    meta.deprecated = !!meta?.deprecation

    //Inputs parser
    {
      meta.inputs = function({data: {user = null} = {}, q, account}, defaults = {}) {
        //Support check
        if (!account)
          console.debug(`metrics/inputs > account type not set for plugin ${name}!`)
        if (account !== "bypass") {
          const context = q.repo ? "repository" : account
          if (!meta.supports?.includes(context))
            throw {error: {message: `Unsupported context ${context}`, instance: new Error()}}
        }
        //Special values replacer
        const replacer = value => {
          value = `${value}`.trim()
          if (user) {
            if (value === ".user.login")
              return user.login ?? value
            if (value === ".user.twitter")
              return user.twitterUsername ?? value
            if (value === ".user.website")
              return user.websiteUrl ?? value
          }
          return value
        }
        //Inputs checks
        const result = Object.fromEntries(
          Object.entries(inputs).map(([key, {type, format, default: defaulted, min, max, values, inherits: _inherits}]) => [
            //Format key
            metadata.to.query(key, {name}),
            //Format value
            (defaulted => {
              //Default value
              let value = (meta.category !== "core" ? q[`plugin.${metadata.to.query(key)}`] : null) ?? q[metadata.to.query(key)] ?? q[key] ?? defaulted
              //Apply type conversion
              switch (type) {
                //Booleans
                case "boolean": {
                  if (/^(?:[Tt]rue|[Oo]n|[Yy]es|1)$/.test(value))
                    return true
                  if (/^(?:[Ff]alse|[Oo]ff|[Nn]o|0)$/.test(value))
                    return false
                  return defaulted
                }
                //Numbers
                case "number": {
                  value = Number(value)
                  if (!Number.isFinite(value))
                    value = defaulted
                  if (Number.isFinite(min))
                    value = Math.max(min, value)
                  if (Number.isFinite(max))
                    value = Math.min(value, max)
                  return value
                }
                //Array
                case "array": {
                  try {
                    value = decodeURIComponent(value)
                  }
                  catch {
                    logger(`metrics/inputs > failed to decode uri : ${value}`)
                    value = defaulted
                  }
                  const separators = {"comma-separated": ",", "space-separated": " ", "newline-separated": "\n"}
                  const formats = [format, "comma-separated"].flat(Infinity).filter(s => s in separators)
                  let parsed = [], used = "comma-separated"
                  for (const separation of formats) {
                    parsed = value
                      .split(separators[separation])
                      .map(v => replacer(v).toLocaleLowerCase())
                      .filter(v => Array.isArray(values) ? values.includes(v) : true)
                      .filter(v => v)
                    //Conditional below serves as auto-detection when multiple formats are provided
                    //To force a specific format one should use the separator as the first character
                    //so that the parsed.length is greater than 1 (empty values are filtered anyways)
                    if (parsed.length > 1) {
                      used = separation
                      break
                    }
                  }
                  logger(`metrics/inputs > used ${used} format to decode ${value}`)
                  return parsed
                }
                //String
                case "string": {
                  value = replacer(value)
                  if ((Array.isArray(values)) && (!values.includes(value)))
                    return defaulted
                  return value
                }
                //JSON
                case "json": {
                  if (typeof value === "object")
                    return value
                  try {
                    value = JSON.parse(value)
                  }
                  catch (error) {
                    try {
                      value = JSON.parse(decodeURIComponent(value))
                    }
                    catch (error) {
                      logger(`metrics/inputs > failed to parse json : ${value}`)
                      value = JSON.parse(defaulted)
                    }
                  }
                  return value
                }
                //Token
                case "token": {
                  return value
                }
                //Default
                default: {
                  return value
                }
              }
            })(defaults[key] ?? defaulted),
          ]),
        )
        logger(`metrics/inputs > ${name} > ${JSON.stringify(result)}`)
        return result
      }
      Object.assign(meta.inputs, inputs, Object.fromEntries(Object.entries(inputs).map(([key, value]) => [metadata.to.query(key, {name}), value])))
    }

    //Enable state handler
    {
      meta.enabled = function(enabled, {extras = {}, error = true} = {}) {
        if ((process.env.GITHUB_ACTIONS) && (!enabled))
          console.warn(`::warning::Plugin "${name}" is currently disabled. Add "plugin_${name}: yes" to your workflow to enable it.`)
        if ((error) && (!enabled))
          throw Object.assign(new Error(`Plugin "${name}" is disabled${process.env.GITHUB_ACTIONS ? "" : " on this server"}`), {enabled: true})
        return (enabled) && (meta.extras("enabled", {extras, error}))
      }
    }

    //Extra features parser
    {
      meta.extras = function(input, {extras = {}, error = true} = {}) {
        const key = metadata.to.yaml(input, {name})
        try {
          //Required permissions
          const required = inputs[key]?.extras ?? null
          if (!required)
            return true
          console.debug(`metrics/extras > ${name} > ${key} > require [${required}]`)

          //Legacy handling
          const enabled = Array.isArray(extras) ? extras : (extras?.features ?? extras?.default ?? (typeof extras === "boolean" ? extras : false))
          if (typeof enabled === "boolean") {
            console.debug(`metrics/extras > ${name} > ${key} > extras features is set to ${enabled}`)
            if (!enabled)
              throw new Error()
            return enabled
          }
          if (!Array.isArray(required)) {
            console.debug(`metrics/extras > ${name} > ${key} > extras is not a permission array, skipping`)
            return false
          }

          //Legacy options handling
          if (!Array.isArray(enabled))
            throw new Error(`metrics/extras > ${name} > ${key} > extras.features is not an array`)
          if (extras.css) {
            console.warn(`metrics/extras > ${name} > ${key} > extras.css is deprecated, use extras.features with "metrics.run.puppeteer.user.css" instead`)
            enabled.push("metrics.run.puppeteer.user.css")
          }
          if (extras.js) {
            console.warn(`metrics/extras > ${name} > ${key} > extras.js is deprecated, use extras.features with "metrics.run.puppeteer.user.js" instead`)
            enabled.push("metrics.run.puppeteer.user.js")
          }
          if (extras.presets) {
            console.warn(`metrics/extras > ${name} > ${key} > extras.presets is deprecated, use extras.features with "metrics.setup.community.presets" instead`)
            enabled.push("metrics.setup.community.presets")
          }

          //Check permissions
          const missing = required.filter(permission => !enabled.includes(permission))
          if (missing.length > 0) {
            console.debug(`metrics/extras > ${name} > ${key} > missing permissions [${missing}]`)
            throw new Error()
          }
          return true
        }
        catch {
          if (!error) {
            console.debug(`metrics/extras > ${name} > ${key} > skipping (no error mode)`)
            return false
          }
          throw Object.assign(new Error(`Option "${key}" is disabled on this server`), {extras: true})
        }
      }
    }

    //Action metadata
    {
      //Extract comments
      const comments = {}
      raw.split(/(?:\r?\n){2,}/m)
        .map(x => x.trim()).filter(x => x)
        .map(x => x.split("\n").map(y => y.trim()).join("\n"))
        .map(x => {
          const input = x.match(new RegExp(`^\\s*(?<input>${Object.keys(inputs).join("|")}):`, "m"))?.groups?.input ?? null
          if (input)
            comments[input] = x.match(new RegExp(`(?<comment>[\\s\\S]*?)(?=(?:${Object.keys(inputs).sort((a, b) => b.length - a.length).join("|")}):)`))?.groups?.comment
        })

      //Action descriptor
      meta.action = Object.fromEntries(
        Object.entries(inputs).map(([key, value]) => [
          key,
          {
            comment: "",
            descriptor: yaml.dump({
              [key]: Object.fromEntries(
                Object.entries(value).filter(([key]) => ["description", "default", "required"].includes(key)).map(([k, v]) => k === "description" ? [k, v.split("\n")[0]] : k === "default" ? [k, ((/^\$\{\{[\s\S]+\}\}$/.test(v)) || (["config_presets", "config_timezone", "use_prebuilt_image"].includes(key))) ? v : "<default-value>"] : [k, v]),
              ),
            }, {quotingType: '"', noCompatMode: true}),
          },
        ]),
      )

      //Action inputs
      meta.inputs.action = function({core, preset = {}}) {
        //Build query object from inputs
        const q = {}
        for (const key of Object.keys(inputs)) {
          //Parse input
          let value
          if (env.ghactions) {
            value = `${core.getInput(key)}`.trim()
            try {
              value = decodeURIComponent(value)
            }
            catch {
              logger(`metrics/inputs > failed to decode uri for ${key}: ${value}`)
              value = "<default-value>"
            }
          }
          else {
            value = process.env[`INPUT_${key.toUpperCase()}`]?.trim() ?? "<default-value>"
          }

          const unspecified = value === "<default-value>"
          //From presets
          if ((key in preset) && (unspecified)) {
            logger(`metrics/inputs > ${key} has been set by preset value`)
            q[key] = preset[key]
          }
          //From defaults
          else if (unspecified) {
            logger(`metrics/inputs > ${key} has been set by default value`)
            q[key] = metadata.inputs[key]?.default
          }
          //From user
          else {
            logger(`metrics/inputs > ${key} has been set by user`)
            q[key] = value
          }
        }
        return meta.inputs({q, account: "bypass"})
      }
    }

    //Web metadata
    {
      meta.web = Object.fromEntries(
        Object.entries(inputs).map(([key, {type, description: text, example, default: defaulted, min = 0, max = 9999, values, extras}]) => [
          //Format key
          metadata.to.query(key),
          //Value descriptor
          (() => {
            switch (type) {
              case "boolean":
                return {text, type: "boolean", defaulted: /^(?:[Tt]rue|[Oo]n|[Yy]es|1)$/.test(defaulted) ? true : /^(?:[Ff]alse|[Oo]ff|[Nn]o|0)$/.test(defaulted) ? false : defaulted, extras}
              case "number":
                return {text, type: "number", min, max, defaulted, extras}
              case "array":
                return {text, type: "text", placeholder: example ?? defaulted, defaulted, extras}
              case "string": {
                if (Array.isArray(values))
                  return {text, type: "select", values, defaulted}
                return {text, type: "text", placeholder: example ?? defaulted, defaulted, extras}
              }
              case "json":
                return {text, type: "text", placeholder: example ?? defaulted, defaulted, extras}
              default:
                return null
            }
          })(),
        ]).filter(([key, value]) => (value) && (!((name === "base") && (key === "repositories")))),
      )
    }

    //Readme metadata
    {
      //Extract demos
      const raw = `${await fs.promises.readFile(path.join(__plugins, name, "README.md"), "utf-8")}`
      const demo = meta.examples ? demos({examples: meta.examples}) : raw.match(/(?<demo><table>[\s\S]*?<[/]table>)/)?.groups?.demo?.replace(/<[/]?(?:table|tr)>/g, "")?.trim() ?? "<td></td>"

      //Compatibility
      const templates = {}
      const compatibility = {}
      for (const template of await fs.promises.readdir(__templates)) {
        if (!(await fs.promises.lstat(path.join(__templates, template))).isDirectory())
          continue
        templates[template] = yaml.load(`${await fs.promises.readFile(path.join(__templates, template, "metadata.yml"), "utf-8")}`)
        const partials = path.join(__templates, template, "partials")
        if ((fs.existsSync(partials)) && ((await fs.promises.lstat(partials)).isDirectory())) {
          const supported = [...await fs.promises.readdir(partials)]
          compatibility[template] = !!supported.filter(id => id.match(new RegExp(`^${name}(?:[.][\\s\\S]+)?[.]ejs$`))).length
        }
      }

      //Header table
      const header = [
        "<table>",
        '  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>',
        `  <tr><th colspan="2"><h3>${meta.name}</h3></th></tr>`,
        `  <tr><td colspan="2" align="center">${marked.parse(meta.description ?? "", {silent: true})}</td></tr>`,
        meta.deprecation ? `  <tr><th>‚ö†Ô∏è Deprecated</th><td>${marked.parse(meta.deprecation ?? "", {silent: true})}</td></tr>` : "",
        meta.disclaimer ? `  <tr><th>‚ö†Ô∏è Disclaimer</th><td>${marked.parse(meta.disclaimer ?? "", {silent: true})}</td></tr>` : "",
        meta.notes ? `  <tr><th>‚Ñπ Additional notes</th><td>${marked.parse(meta.notes ?? "", {silent: true})}</td></tr>` : "",
        meta.authors?.length ? `<tr><th>Authors</th><td>${[meta.authors].flat().map(author => `<a href="https://github.com/${author}">@${author}</a>`)}</td></tr>` : "",
        "  <tr>",
        '    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>',
        `    <td>${Object.entries(compatibility).filter(([_, value]) => value).map(([id]) => `<a href="/source/templates/${id}/README.md"><code>${templates[id].name ?? ""}</code></a>`).join(" ")}</td>`,
        "  </tr>",
        "  <tr>",
        `    <td>${
          [
            meta.supports?.includes("user") ? "<code>üë§ Users</code>" : "",
            meta.supports?.includes("organization") ? "<code>üë• Organizations</code>" : "",
            meta.supports?.includes("repository") ? "<code>üìì Repositories</code>" : "",
          ].filter(v => v).join(" ")
        }</td>`,
        "  </tr>",
        "  <tr>",
        `    <td>${
          [
            ...(meta.scopes ?? []).map(scope => `<code>üîë ${{public_access: "(scopeless)"}[scope] ?? scope}</code>`),
            ...Object.entries(inputs).filter(([_, {type}]) => type === "token").map(([token]) => `<code>üóùÔ∏è ${token}</code>`),
            ...(meta.scopes?.length ? ["read:org", "read:user", "read:packages", "repo"].map(scope => !meta.scopes.includes(scope) ? `<code>${scope} (optional)</code>` : null).filter(v => v) : []),
          ].filter(v => v).join(" ") || "<i>No tokens are required for this plugin</i>"
        }</td>`,
        "  </tr>",
        "  <tr>",
        demos({colspan: 2, wrap: name === "base", examples: meta.examples}),
        "  </tr>",
        "</table>",
      ].filter(v => v).join("\n")

      //Options table
      const table = [
        "<table>",
        "  <tr>",
        '    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>',
        "  </tr>",
        Object.entries(inputs).map(([option, {description, type, ...o}]) => {
          const cell = []
          if (o.required)
            cell.push("‚úîÔ∏è Required<br>")
          if (type === "token")
            cell.push("üîê Token<br>")
          if (o.inherits)
            cell.push(`‚è© Inherits <code>${o.inherits}</code><br>`)
          if (o.global)
            cell.push("‚è≠Ô∏è Global option<br>")
          if (/^(?:[Ff]alse|[Oo]ff|[Nn]o|0)$/.test(o.preset))
            cell.push("‚èØÔ∏è Cannot be preset<br>")
          if (o.testing)
            cell.push("üîß For development<br>")
          if (!Object.keys(previous?.inputs ?? {}).includes(option))
            cell.push("‚ú® On <code>master</code>/<code>main</code><br>")
          if (o.extras) {
            cell.push("üåê Web instances must configure <code>settings.json</code>:")
            cell.push("<ul>")
            for (const permission of o.extras)
              cell.push(`<li><i>${permission}</i></li>`)
            cell.push("</ul>")
          }
          cell.push(`<b>type:</b> <code>${type}</code>`)
          if ("format" in o)
            cell.push(`<i>(${Array.isArray(o.format) ? o.format[0] : o.format})</i>`)
          if ("min" in o)
            cell.push(`<i>(${o.min} ‚â§`)
          if (("min" in o) || ("max" in o))
            cell.push(`${"min" in o ? "" : "<i>("}ùë•${"max" in o ? "" : ")</i>"}`)
          if ("max" in o)
            cell.push(`‚â§ ${o.max})</i>`)
          cell.push("<br>")
          if ("zero" in o)
            cell.push(`<b>zero behaviour:</b> ${o.zero}</br>`)
          if (("default" in o) && (o.default !== "")) {
            let text = o.default
            if (o.default === ".user.login")
              text = "<code>‚Üí User login</code>"
            if (o.default === ".user.twitter")
              text = "<code>‚Üí User attached twitter</code>"
            if (o.default === ".user.website")
              text = "<code>‚Üí User attached website</code>"
            if (type === "json")
              text = `<details><summary>‚Üí Click to expand</summary><pre language="json"><code>${text}</code></pre></details>`
            cell.push(`<b>default:</b> ${text}<br>`)
          }
          if ("values" in o)
            cell.push(`<b>allowed values:</b><ul>${o.values.map(value => `<li>${value}</li>`).join("")}</ul>`)
          return `  <tr>
    <td nowrap="nowrap"><h4><code>${option}</code></h4></td>
    <td rowspan="2">${marked.parse(description, {silent: true})}<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">${cell.join("\n")}</td>
  </tr>`
        }).join("\n"),
        "</table>",
      ].flat(Infinity).filter(s => s).join("\n")

      //Readme descriptor
      meta.readme = {demo, table, header}
    }

    //Icon
    meta.icon = meta.name.split(" ")[0] ?? null

    //Result
    return meta
  }
  catch (error) {
    console.debug(`metrics/metadata > failed to load plugin ${name}: ${error}`)
    return null
  }
}

/**Metadata extractor for templates */
metadata.template = async function({__templates, name, plugins}) {
  try {
    //Load meta descriptor
    const raw = fs.existsSync(path.join(__templates, name, "metadata.yml")) ? `${await fs.promises.readFile(path.join(__templates, name, "metadata.yml"), "utf-8")}` : ""
    const meta = yaml.load(raw) ?? {}

    //Compatibility
    const partials = path.join(__templates, name, "partials")
    const compatibility = Object.fromEntries(Object.entries(plugins).map(([key]) => [key, false]))
    if ((fs.existsSync(partials)) && ((await fs.promises.lstat(partials)).isDirectory())) {
      for (let plugin of await fs.promises.readdir(partials)) {
        plugin = plugin.match(/(?<plugin>^[\s\S]+(?=[.]ejs$))/)?.groups?.plugin ?? null
        if (plugin in compatibility)
          compatibility[plugin] = true
      }
    }

    //Header table
    const header = [
      "<table>",
      '  <tr><td colspan="2"><a href="/README.md#%EF%B8%8F-templates">‚Üê Back to templates index</a></td></tr>',
      `  <tr><th colspan="2"><h3>${meta.name ?? "(unnamed template)"}</h3></th></tr>`,
      `  <tr><td colspan="2" align="center">${marked.parse(meta.description ?? "", {silent: true})}</td></tr>`,
      "  <tr>",
      '    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>',
      `    <td>${Object.entries(compatibility).filter(([_, value]) => value).map(([id]) => `<a href="/source/plugins/${id}/README.md" title="${plugins[id].name}">${plugins[id].icon}</a>`).join(" ")}${meta.formats?.includes("markdown") ? " <code>‚úì embed()</code>" : ""}</td>`,
      "  </tr>",
      "  <tr>",
      `    <td>${
        [
          meta.supports?.includes("user") ? "<code>üë§ Users</code>" : "",
          meta.supports?.includes("organization") ? "<code>üë• Organizations</code>" : "",
          meta.supports?.includes("repository") ? "<code>üìì Repositories</code>" : "",
        ].filter(v => v).join(" ")
      }</td>`,
      "  </tr>",
      "  <tr>",
      `    <td>${
        [
          meta.formats?.includes("svg") ? "<code>*Ô∏è‚É£ SVG</code>" : "",
          meta.formats?.includes("png") ? "<code>*Ô∏è‚É£ PNG</code>" : "",
          meta.formats?.includes("jpeg") ? "<code>*Ô∏è‚É£ JPEG</code>" : "",
          meta.formats?.includes("json") ? "<code>#Ô∏è‚É£ JSON</code>" : "",
          meta.formats?.includes("markdown") ? "<code>üî† Markdown</code>" : "",
          meta.formats?.includes("markdown-pdf") ? "<code>üî† Markdown (PDF)</code>" : "",
        ].filter(v => v).join(" ")
      }</td>`,
      "  </tr>",
      "  <tr>",
      demos({colspan: 2, examples: meta.examples}),
      "  </tr>",
      "</table>",
    ].join("\n")

    //Result
    return {
      name: meta.name ?? "(unnamed template)",
      description: meta.description ?? "",
      index: meta.index ?? null,
      formats: meta.formats ?? null,
      supports: meta.supports ?? null,
      readme: {
        demo: demos({examples: meta.examples}),
        compatibility: {
          ...Object.fromEntries(Object.entries(compatibility).filter(([_, value]) => value)),
          ...Object.fromEntries(Object.entries(compatibility).filter(([_, value]) => !value).map(([key, value]) => [key, meta.formats?.includes("markdown") ? "embed" : value])),
          base: true,
        },
        header,
      },
      check({q, account = "bypass", format = null}) {
        //Support check
        if (account !== "bypass") {
          const context = q.repo ? "repository" : account
          if ((Array.isArray(this.supports)) && (!this.supports.includes(context)))
            throw new Error(`template not supported for: ${context}`)
        }
        //Format check
        if ((format) && (Array.isArray(this.formats)) && (!this.formats.includes(format)))
          throw new Error(`template not supported for: ${format}`)
      },
    }
  }
  catch (error) {
    console.debug(`metrics/metadata > failed to load template ${name}: ${error}`)
    return null
  }
}

/**Metadata converters */
metadata.to = {
  query(key, {name = null} = {}) {
    key = key.replace(/^plugin_/, "").replace(/_/g, ".")
    return name ? key.replace(new RegExp(`^(${name}.)`, "g"), "") : key
  },
  yaml(key, {name = ""} = {}) {
    const parts = []
    if (key !== "enabled")
      parts.unshift(key.replace(/\./g, "_"))
    if (name)
      parts.unshift((name === "base") ? name : `plugin_${name}`)
    return parts.join("_")
  },
}

//Demo for main and individual readmes
function demos({colspan = null, wrap = false, examples = {}} = {}) {
  if (("default1" in examples) && ("default2" in examples)) {
    return [
      wrap ? '<td colspan="2"><table><tr>' : "",
      '<td align="center">',
      `<img src="${examples.default1}" alt=""></img>`,
      "</td>",
      '<td align="center">',
      `<img src="${examples.default2}" alt=""></img>`,
      "</td>",
      wrap ? "</tr></table></td>" : "",
    ].filter(v => v).join("\n")
  }
  return [
    `    <td ${colspan ? `colspan="${colspan}"` : ""} align="center">`,
    `${
      Object.entries(examples).map(([text, link]) => {
        let img = `<img src="${link}" alt=""></img>`
        if (text !== "default") {
          const open = text.charAt(0) === "+" ? " open" : ""
          text = open ? text.substring(1) : text
          text = `${text.charAt(0).toLocaleUpperCase()}${text.substring(1)}`
          img = `<details${open}><summary>${text}</summary>${img}</details>`
        }
        return `      ${img}`
      }).join("\n")
    }`,
    '      <img width="900" height="1" alt="">',
    "    </td>",
  ].filter(v => v).join("\n")
}
</file>

<file path="source/app/metrics/presets.mjs">
//Imports
import fs from "fs/promises"
import yaml from "js-yaml"
import metadata from "./metadata.mjs"

/**Presets parser */
export default async function presets(list, {log = true, core = null} = {}) {
  //Init
  const {plugins} = await metadata({log: false})
  const {"config.presets": files} = plugins.core.inputs({q: {"config.presets": list}, account: "bypass"})
  const logger = log ? console.debug : () => null
  const allowed = Object.entries(metadata.inputs).filter(([_, {type, preset}]) => (type !== "token") && (!/^(?:[Ff]alse|[Oo]ff|[Nn]o|0)$/.test(preset))).map(([key]) => key)
  const env = core ? "action" : "web"
  const options = {}

  //Load presets
  for (const file of files) {
    try {
      //Load and parse preset
      logger(`metrics/presets > loading ${file}`)
      let text = ""
      if (file.startsWith("@")) {
        logger(`metrics/presets > ${file} seems to be predefined preset, fetching`)
        text = await fetch(`https://raw.githubusercontent.com/lowlighter/metrics/presets/${file.substring(1)}/preset.yml`).then(response => response.text())
      }
      else if (file.startsWith("https://")) {
        logger(`metrics/presets > ${file} seems to be an url, fetching`)
        text = await fetch(file).then(response => response.text())
      }
      else if (env === "action") {
        logger(`metrics/presets > ${file} seems to be a local file, reading`)
        text = `${await fs.readFile(file)}`
      }
      else {
        logger(`metrics/presets > ${file} cannot be loaded in current environment ${env}, skipping`)
        continue
      }
      const {schema, with: inputs} = yaml.load(text)
      logger(`metrics/presets > ${file} preset schema is ${schema}`)

      //Evaluate preset
      switch (`${schema}`) {
        case "v1": {
          for (let [key, value] of Object.entries(inputs)) {
            if (!allowed.includes(key)) {
              logger(`metrics/presets > ${key} is specified but is not allowed in preset, skipping`)
              continue
            }
            if (env === "web")
              key = metadata.to.query(key)
            if (key in options)
              logger(`metrics/presets > ${key} was already specified by another preset, overwriting`)
            options[key] = value
          }
          break
        }
        default:
          throw new Error(`unsupported preset schema: ${schema}`)
      }
    }
    //Handle errors
    catch (error) {
      if (env === "action")
        console.log(`::warning::skipping preset ${file}: ${error.message}`)
      logger(`metrics/presets > an error occurred while loading preset ${file} (${error}), ignoring`)
    }
  }
  return options
}
</file>

<file path="source/plugins/achievements/list/users.mjs">
/**Achievements list for users accounts */
export default async function({list, login, data, computed, imports, graphql, queries, rest, rank, leaderboard}) {
  //Initialization
  const {user} = await graphql(queries.achievements({login}))
  const scores = {followers: user.followers.totalCount, created: user.repositories.totalCount, stars: user.popular.nodes?.[0]?.stargazers?.totalCount ?? 0, forks: Math.max(0, ...data.user.repositories.nodes.map(({forkCount}) => forkCount))}
  const ranks = await graphql(queries.achievements.ranking(scores))
  const requirements = {stars: 5, followers: 3, forks: 1, created: 1}

  //Developer
  {
    const value = user.repositories.totalCount
    const unlock = user.repositories.nodes?.shift()
    list.push({
      title: "Developer",
      text: `Published ${value} public repositor${imports.s(value, "y")}`,
      icon:
        '<g stroke-linecap="round" stroke-width="2" fill="none" fill-rule="evenodd"><g stroke="#primary"><path d="M20 24l-3.397 3.398a.85.85 0 000 1.203L20.002 32M37.015 24l3.399 3.398a.85.85 0 010 1.203L37.014 32" stroke-linejoin="round"/><path d="M31.029 21.044L25.976 35.06"/></g><path stroke="#secondary" stroke-linejoin="round" d="M23.018 10h8.984M26 47h5M8 16h16m9 0h15.725M8 41h13"/><path d="M5.027 34.998c.673 2.157 1.726 4.396 2.81 6.02m43.38-19.095C50.7 19.921 49.866 17.796 48.79 16" stroke="#secondary"/><path stroke="#primary" stroke-linejoin="round" d="M26 41h17"/><path d="M7.183 16C5.186 19.582 4 23.619 4 28M42.608 47.02c2.647-1.87 5.642-5.448 7.295-9.18C51.52 34.191 52.071 30.323 52 28" stroke="#primary"/><path stroke="#primary" stroke-linejoin="round" d="M7.226 16H28M13.343 47H21"/><path d="M13.337 47.01a24.364 24.364 0 006.19 3.45 24.527 24.527 0 007.217 1.505c2.145.108 4.672-.05 7.295-.738" stroke="#primary"/><path stroke="#primary" stroke-linejoin="round" d="M36 47h6.647M12 10h6M37 10h6.858"/><path d="M43.852 10c-4.003-3.667-9.984-6.054-16.047-6-2.367.021-4.658.347-6.81 1.045" stroke="#primary"/><path stroke="#secondary" stroke-linejoin="round" d="M5.041 35h4.962M47 22h4.191"/></g>',
      ...rank(value, [1, 20, 50, 100, 250]),
      value,
      unlock: new Date(unlock?.createdAt),
      leaderboard: leaderboard({user: ranks.created_rank.userCount, requirement: scores.created >= requirements.created, type: "users"}),
    })
  }

  //Forker
  {
    const value = user.forks.totalCount
    const unlock = user.forks.nodes?.shift()
    list.push({
      title: "Forker",
      text: `Forked ${value} public repositor${imports.s(value, "y")}`,
      icon:
        '<g stroke-width="2" fill="none" fill-rule="evenodd"><path d="M37.303 21.591a5.84 5.84 0 00-1.877-1.177 6.138 6.138 0 00-4.432 0 5.822 5.822 0 00-1.879 1.177L28 22.638l-1.115-1.047c-1.086-1.018-2.559-1.59-4.094-1.59-1.536 0-3.008.572-4.094 1.59-1.086 1.02-1.696 2.4-1.696 3.84 0 1.441.61 2.823 1.696 3.841l1.115 1.046L28 38l8.189-7.682 1.115-1.046a5.422 5.422 0 001.256-1.761 5.126 5.126 0 000-4.157 5.426 5.426 0 00-1.256-1.763z" stroke="#primary" stroke-linecap="round" stroke-linejoin="round"/><path d="M15.967 42.705A18.922 18.922 0 0028 47a18.92 18.92 0 0011.076-3.56m-.032-30.902A18.914 18.914 0 0028 9c-4.09 0-7.876 1.292-10.976 3.49" stroke="#secondary" stroke-linecap="round"/><g transform="translate(7 10)" stroke="#primary"><path d="M6 0v7c0 2.21-1.343 3-3 3s-3-.79-3-3V0" stroke-linecap="round" stroke-linejoin="round"/><path stroke-linecap="round" d="M3 0v19.675"/><rect stroke-linejoin="round" x="1" y="20" width="4" height="16" rx="2"/></g><g transform="translate(43 10)" stroke="#primary"><path stroke-linecap="round" d="M2 15.968v3.674"/><path d="M4 15.642H0L.014 4.045A4.05 4.05 0 014.028 0L4 15.642z" stroke-linecap="round" stroke-linejoin="round"/><rect stroke-linejoin="round" y="19.968" width="4" height="16" rx="2"/></g><path d="M41.364 8.062A23.888 23.888 0 0028 4a23.89 23.89 0 00-11.95 3.182M4.75 22.021A24.045 24.045 0 004 28c0 1.723.182 3.404.527 5.024m10.195 14.971A23.888 23.888 0 0028 52c4.893 0 9.444-1.464 13.239-3.979m9-10.98A23.932 23.932 0 0052 28c0-2.792-.477-5.472-1.353-7.964" stroke="#secondary" stroke-linecap="round"/></g>',
      ...rank(value, [1, 5, 10, 20, 50]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Contributor
  {
    const value = user.pullRequests.totalCount
    const unlock = user.pullRequests.nodes?.shift()

    list.push({
      title: "Contributor",
      text: `Opened ${value} pull request${imports.s(value)}`,
      icon:
        '<g stroke-width="2" fill="none" fill-rule="evenodd"><path stroke="#secondary" stroke-linecap="round" stroke-linejoin="round" d="M26.022 5.014h6M26.012 53.005h6M27.003 47.003h12M44.01 20.005h5M19.01 11.003h12"/><path stroke="#primary" stroke-linecap="round" stroke-linejoin="round" d="M38.005 11.008h6M41 14.013v-6M14.007 47.003h6M17.002 50.004v-6"/><path d="M29.015 5.01l-5.003 5.992 5.003-5.992zM33.015 47.01l-5.003 5.992 5.003-5.992z" stroke="#secondary"/><path stroke="#primary" stroke-linecap="round" stroke-linejoin="round" d="M8.01 19.002h6"/><path stroke="#secondary" stroke-linecap="round" stroke-linejoin="round" d="M47.011 29h6"/><path stroke="#primary" stroke-linecap="round" stroke-linejoin="round" d="M44.012 39.003h6"/><g stroke="#secondary"><path d="M5.36 29c4.353 0 6.4 4.472 6.4 8"/><path stroke-linecap="round" stroke-linejoin="round" d="M13.99 37.995h-5M10.989 29h-6"/></g><path d="M24.503 22c1.109 0 2.007.895 2.007 2 0 1.104-.898 2-2.007 2a2.004 2.004 0 01-2.008-2c0-1.105.9-2 2.008-2zM24.5 32a2 2 0 110 4 2 2 0 010-4zm9.5 0a2 2 0 110 4 2 2 0 010-4z" stroke="#primary" stroke-linecap="round" stroke-linejoin="round"/><path stroke="#primary" d="M24.5 26.004v6.001"/><path d="M31.076 23.988l1.027-.023a1.998 1.998 0 011.932 2.01L34 31" stroke="#primary" stroke-linecap="round" stroke-linejoin="round"/><path stroke="#primary" stroke-linecap="round" stroke-linejoin="round" d="M31.588 26.222l-2.194-2.046 2.046-2.194"/><path d="M29.023 43c7.732 0 14-6.268 14-14s-6.268-14-14-14-14 6.268-14 14 6.268 14 14 14z" stroke="#primary"/></g>',
      ...rank(value, [1, 200, 500, 1000, 2500]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Manager
  //{
  //     co st va =  = u.er.proje.ts.totalCo
  //     co st unl =  = u.er.proje.ts.no?.s?.shif
  //
  //     l.st.pus
  //    title: e: "Manag,
  //    text: t: `Created ${value} user project${impo.ts.s(value,
  //    icon:
  //         '<g stroke-width="2" fill="none" fill-rule="evenodd"><path d="M29 16V8.867C29 7.705 29.627 7 30.692 7h18.616C50.373 7 51 7.705 51 8.867v38.266C51 48.295 50.373 49 49.308 49H30.692C29.627 49 29 48.295 29 47.133V39m-4-23V9c0-1.253-.737-2-2-2H7c-1.263 0-2 .747-2 2v34c0 1.253.737 2 2 2h16c1.263 0 2-.747 2-2v-4" stroke="#secondary" stroke-linecap="round"/><path stroke="#secondary" d="M51.557 12.005h-22M5 12.005h21"/><path d="M14 33V22c0-1.246.649-2 1.73-2h28.54c1.081 0 1.73.754 1.73 2v11c0 1.246-.649 2-1.73 2H15.73c-1.081 0-1.73-.754-1.73-2z" stroke="#primary" stroke-linecap="round" stroke-linejoin="round"/><path d="M19 29v-3c0-.508.492-1 1-1h3c.508 0 1 .492 1 1v3c0 .508-.492 1-1 1h-3c-.508-.082-1-.492-1-1z" stroke="#primary"/><path stroke="#primary" stroke-linecap="round" stroke-linejoin="round" d="M28.996 27.998h12M9.065 20.04a7.062 7.062 0 00-.023 1.728m.775 2.517c.264.495.584.954.954 1.369"/></,
  //    ...rankank(va, e,, 1, 2, 3, 4, ,
  //    value,
  //    unlock: k:  ew Date(unl?.k?.created,
  //    
  //}

  //Reviewer
  {
    const value = user.contributionsCollection.pullRequestReviewContributions.totalCount
    const unlock = user.contributionsCollection.pullRequestReviewContributions.nodes?.shift()

    list.push({
      title: "Reviewer",
      text: `Reviewed ${value} pull request${imports.s(value)}`,
      icon:
        '<g stroke-linecap="round" stroke-width="2" fill="none" fill-rule="evenodd"><g stroke="#secondary"><path d="M26.009 34.01c.444-.004.9.141 1.228.414.473.394.766.959.76 1.54-.01.735-.333 1.413-.97 2.037.66.718.985 1.4.976 2.048-.012.828-.574 1.58-1.687 2.258.624.788.822 1.549.596 2.28-.225.733-.789 1.219-1.69 1.459.703.833.976 1.585.82 2.256-.178.763-.313 1.716-2.492 1.711" stroke-linejoin="round"/><g stroke-linejoin="round"><path d="M18.548 28.422c1.184-4.303-2.132-5.292-2.132-5.292-.873 2.296-1.438 3.825-4.231 8.108-1.285 1.97-1.926 3.957-1.877 5.796M18.391 34.011L24.993 34c2.412-.009.211-.005-6.602.012zM5.004 37.017l5.234-.014-5.234.014z"/></g><g stroke-linejoin="round"><path d="M18.548 28.422c1.184-4.303-2.132-5.292-2.132-5.292-.873 2.296-1.438 3.825-4.231 8.108-1.285 1.97-1.926 3.957-1.877 5.796M5.004 37.017l5.234-.014-5.234.014zM7 48.012h4.01c1.352 1.333 2.672 2 3.961 2.001 0 0 .485-.005 5.46-.005h3.536"/></g><path d="M18.793 27.022c-.062.933-.373 2.082-.933 3.446-.561 1.364-.433 2.547.383 3.547"/></g><path d="M45 16.156V23a2 2 0 01-2 2H31l-6 4v-4h-1.934M12 23V8a2 2 0 012-2h29a2 2 0 012 2v10" stroke="#primary" stroke-linejoin="round"/><path stroke="#primary" stroke-linejoin="round" d="M23 12.014l-3 3 3 3M34 12.014l3 3-3 3"/><path stroke="#primary" d="M30.029 10l-3.015 10.027"/><path d="M32 39h3l6 4v-4h8a2 2 0 002-2V22a2 2 0 00-2-2h.138" stroke="#secondary" stroke-linejoin="round"/><path stroke="#primary" stroke-linejoin="round" d="M33 29h12M33 34h6M43 34h2"/></g>',
      ...rank(value, [1, 200, 500, 1000, 2500]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Packager
  {
    const value = user.packages.totalCount + ((await rest.packages.listPackagesForUser({package_type: "container", username: login}).catch(() => ({data: []})))?.data?.length || 0)
    const unlock = user.packages.nodes?.shift()

    list.push({
      title: "Packager",
      text: `Created ${value} package${imports.s(value)}`,
      icon:
        '<g fill="none"><path fill="#secondary" d="M28.53 27.64l-11.2 6.49V21.15l11.23-6.48z"/><path d="M40.4 34.84c-.17 0-.34-.04-.5-.13l-11.24-6.44a.99.99 0 01-.37-1.36.99.99 0 011.36-.37l11.24 6.44c.48.27.65.89.37 1.36-.17.32-.51.5-.86.5z" fill="#primary"/><path d="M29.16 28.4c-.56 0-1-.45-1-1.01l.08-12.47c0-.55.49-1 1.01-.99.55 0 1 .45.99 1.01l-.08 12.47c0 .55-.45.99-1 .99z" fill="#primary"/><path d="M18.25 34.65a.996.996 0 01-.5-1.86l10.91-6.25a.997.997 0 11.99 1.73l-10.91 6.25c-.15.09-.32.13-.49.13z" fill="#primary"/><path d="M29.19 41.37c-.17 0-.35-.04-.5-.13l-11.23-6.49c-.31-.18-.5-.51-.5-.87V20.91c0-.36.19-.69.5-.87l11.23-6.49c.31-.18.69-.18 1 0l11.23 6.49c.31.18.5.51.5.87v12.97c0 .36-.19.69-.5.87l-11.23 6.49c-.15.08-.32.13-.5.13zm-10.23-8.06l10.23 5.91 10.23-5.91V21.49l-10.23-5.91-10.23 5.91v11.82zM40.5 11.02c-1.75 0-3.18-1.43-3.18-3.18 0-1.75 1.43-3.18 3.18-3.18 1.75 0 3.18 1.43 3.18 3.18 0 1.75-1.43 3.18-3.18 3.18zm0-4.36c-.65 0-1.18.53-1.18 1.18 0 .65.53 1.18 1.18 1.18.65 0 1.18-.53 1.18-1.18 0-.65-.53-1.18-1.18-1.18zm-23.19 4.36c-1.75 0-3.18-1.43-3.18-3.18 0-1.75 1.43-3.18 3.18-3.18 1.75 0 3.18 1.43 3.18 3.18 0 1.75-1.42 3.18-3.18 3.18zm0-4.36c-.65 0-1.18.53-1.18 1.18 0 .65.53 1.18 1.18 1.18.65 0 1.18-.53 1.18-1.18 0-.65-.53-1.18-1.18-1.18zm23.37 43.8c-1.75 0-3.18-1.43-3.18-3.18 0-1.75 1.43-3.18 3.18-3.18 1.75 0 3.18 1.43 3.18 3.18 0 1.75-1.42 3.18-3.18 3.18zm0-4.35c-.65 0-1.18.53-1.18 1.18 0 .65.53 1.18 1.18 1.18.65 0 1.18-.53 1.18-1.18 0-.65-.53-1.18-1.18-1.18zm-23.06 4.11c-1.75 0-3.18-1.43-3.18-3.18 0-1.75 1.43-3.18 3.18-3.18 1.75 0 3.18 1.43 3.18 3.18 0 1.75-1.43 3.18-3.18 3.18zm0-4.36c-.65 0-1.18.53-1.18 1.18 0 .65.53 1.18 1.18 1.18.65 0 1.18-.53 1.18-1.18 0-.65-.53-1.18-1.18-1.18zM6.18 30.72C4.43 30.72 3 29.29 3 27.54c0-1.75 1.43-3.18 3.18-3.18 1.75 0 3.18 1.43 3.18 3.18 0 1.75-1.43 3.18-3.18 3.18zm0-4.36c-.65 0-1.18.53-1.18 1.18 0 .65.53 1.18 1.18 1.18.65 0 1.18-.53 1.18-1.18 0-.65-.53-1.18-1.18-1.18zm45.64 4.36c-1.75 0-3.18-1.43-3.18-3.18 0-1.75 1.43-3.18 3.18-3.18 1.75 0 3.18 1.43 3.18 3.18 0 1.75-1.43 3.18-3.18 3.18zm0-4.36c-.65 0-1.18.53-1.18 1.18 0 .65.53 1.18 1.18 1.18.65 0 1.18-.53 1.18-1.18 0-.65-.53-1.18-1.18-1.18z" fill="#primary"/><path d="M29.1 10.21c-.55 0-1-.45-1-1V3.52c0-.55.45-1 1-1s1 .45 1 1v5.69c0 .56-.45 1-1 1zM7.44 20.95c-.73 0-1.32-.59-1.32-1.32v-5.38l4.66-2.69c.63-.37 1.44-.15 1.8.48.36.63.15 1.44-.48 1.8l-3.34 1.93v3.86c0 .73-.59 1.32-1.32 1.32zm4 22.68c-.22 0-.45-.06-.66-.18l-4.66-2.69v-5.38c0-.73.59-1.32 1.32-1.32.73 0 1.32.59 1.32 1.32v3.86l3.34 1.93c.63.36.85 1.17.48 1.8-.24.42-.68.66-1.14.66zm17.64 10.39l-4.66-2.69c-.63-.36-.85-1.17-.48-1.8.36-.63 1.17-.85 1.8-.48l3.34 1.93 3.34-1.93a1.32 1.32 0 011.8.48c.36.63.15 1.44-.48 1.8l-4.66 2.69zm17.64-10.39a1.32 1.32 0 01-.66-2.46l3.34-1.93v-3.86c0-.73.59-1.32 1.32-1.32.73 0 1.32.59 1.32 1.32v5.38l-4.66 2.69c-.21.12-.44.18-.66.18zm4-22.68c-.73 0-1.32-.59-1.32-1.32v-3.86l-3.34-1.93c-.63-.36-.85-1.17-.48-1.8.36-.63 1.17-.85 1.8-.48l4.66 2.69v5.38c0 .73-.59 1.32-1.32 1.32z" fill="#secondary"/><path d="M33.08 6.15c-.22 0-.45-.06-.66-.18l-3.34-1.93-3.34 1.93c-.63.36-1.44.15-1.8-.48a1.32 1.32 0 01.48-1.8L29.08 1l4.66 2.69c.63.36.85 1.17.48 1.8a1.3 1.3 0 01-1.14.66zm-3.99 47.3c-.55 0-1-.45-1-1v-7.13c0-.55.45-1 1-1s1 .45 1 1v7.13c0 .55-.44 1-1 1zM13.86 19.71c-.17 0-.34-.04-.5-.13L7.2 16a1 1 0 011-1.73l6.17 3.58c.48.28.64.89.36 1.37-.19.31-.52.49-.87.49zm36.63 21.23c-.17 0-.34-.04-.5-.13l-6.17-3.57a.998.998 0 01-.36-1.37c.28-.48.89-.64 1.37-.36L51 39.08c.48.28.64.89.36 1.37-.19.31-.52.49-.87.49zM44.06 19.8c-.35 0-.68-.18-.87-.5-.28-.48-.11-1.09.36-1.37l6.17-3.57c.48-.28 1.09-.11 1.37.36.28.48.11 1.09-.36 1.37l-6.17 3.57c-.16.1-.33.14-.5.14zM7.43 41.03c-.35 0-.68-.18-.87-.5-.28-.48-.11-1.09.36-1.37l6.17-3.57c.48-.28 1.09-.11 1.37.36.28.48.11 1.09-.36 1.37l-6.17 3.57c-.15.09-.33.14-.5.14z" fill="#secondary"/></g>',
      ...rank(value, [1, 5, 10, 20, 30]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Gister
  {
    const value = user.gists.totalCount
    const unlock = user.gists.nodes?.shift()

    list.push({
      title: "Gister",
      text: `Published ${value} gist${imports.s(value)}`,
      icon:
        '<g stroke-width="2" fill="none" fill-rule="evenodd"><path d="M20 48.875v-12.75c0-1.33.773-2.131 2.385-2.125h26.23c1.612-.006 2.385.795 2.385 2.125v12.75C51 50.198 50.227 51 48.615 51h-26.23C20.773 51 20 50.198 20 48.875zM37 40.505h9M37 44.492h6" stroke="#primary" stroke-linecap="round" stroke-linejoin="round"/><path stroke="#secondary" stroke-linecap="round" stroke-linejoin="round" d="M14 30h-4M16 35h-3M47 10H5M42 15H24M19 15h-9M16 25h-3M42 20h-2M42 20h-2M42 25h-2M16 20h-3"/><path stroke="#primary" stroke-linecap="round" stroke-linejoin="round" d="M31.974 25H24"/><path d="M22 20h12a2 2 0 012 2v6a2 2 0 01-2 2H22a2 2 0 01-2-2v-6a2 2 0 012-2z" stroke="#primary"/><path d="M5 33V7a2 2 0 012-2h38a2 2 0 012 2v23" stroke="#secondary" stroke-linecap="round"/><path d="M5 30v8c0 1.105.892 2 1.993 2H16" stroke="#secondary" stroke-linecap="round"/><g stroke="#primary" stroke-linecap="round"><path d="M26.432 37.933v7.07M26.432 37.933v9.07M24.432 40.433h7.07M24.432 40.433h8.07M24.432 44.433h7.07M24.432 44.433h8.07M30.432 37.933v9.07"/></g></g>',
      ...rank(value, [1, 20, 50, 100, 250]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Worker
  {
    const value = user.organizations.totalCount
    const unlock = user.organizations.nodes?.shift()

    list.push({
      title: "Worker",
      text: `Joined ${value} organization${imports.s(value)}`,
      icon:
        '<g stroke-linecap="round" stroke-width="2" fill="none" fill-rule="evenodd"><g stroke="#secondary" stroke-linejoin="round"><path d="M30 51H16.543v-2.998h-4v2.976l-5.537.016a2 2 0 01-2.006-2v-8.032a2 2 0 01.75-1.562l9.261-7.406 5.984 5.143m29.992 3.864v10h-6v-3h-5v3h-6m-.987-33c.133-1.116.793-2.106 1.978-2.968.44-.32 5.776-3.664 16.01-10.032v36"/><path d="M19 34.994v-8.982m16 0V49a2 2 0 01-2 2h-8.987l.011-6.957"/></g><path stroke="#secondary" d="M40 38h5M40 34h5"/><path stroke="#primary" d="M25 30h5M25 34h5M25 26h5"/><path d="M35.012 22.003H9.855a4.843 4.843 0 010-9.686h1.479c1.473-4.268 4.277-6.674 8.41-7.219 6.493-.856 9.767 4.27 10.396 5.9.734-.83 2.137-2.208 4.194-1.964a4.394 4.394 0 011.685.533" stroke="#primary" stroke-linejoin="round"/></g>',
      ...rank(value, [1, 2, 4, 8, 10]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Stargazer
  {
    const value = user.starredRepositories.totalCount
    const unlock = user.starredRepositories.nodes?.shift()

    list.push({
      title: "Stargazer",
      text: `Starred ${value} repositor${imports.s(value, "y")}`,
      icon:
        '<g stroke-linecap="round" stroke-linejoin="round" stroke-width="2" fill="none" fill-rule="evenodd"><path stroke="#primary" d="M28.017 5v3M36.006 7.013l-1.987 2.024M20.021 7.011l1.988 2.011M28.806 30.23c-2.206-3.88-5.25-2.234-5.25-2.234 1.007 2.24 1.688 3.72 2.742 8.724.957 4.551 3.785 7.409 7.687 7.293l5.028 6.003M29.03 34.057L29 20.007m4.012 9.004V17.005m4.006 11.99l-.003-9.353"/><path d="M18.993 50.038l4.045-5.993s1.03-.262 1.954-.984m-6.983.96c-4.474-.016-6.986-5.558-6.986-9.979 0-1.764-.439-4.997-1.997-8.004 0 0 3.268-1.24 5.747 3.6.904 1.768.458 5.267.642 5.388.185.121 1.336.554 2.637 2.01m4.955-18.92a976.92 976.92 0 010 5.91m-7.995-4.986l-.003 10.97M10.031 48.021l2.369-3.003" stroke="#secondary"/><path d="M45.996 47.026l-1.99-2.497-1.993-2.5s2.995-1.485 2.995-6.46V24.033" stroke="#primary"/><path d="M41 29v-6a2 2 0 114 0v2m-8-4v-4a2 2 0 114 0v7m-8-7v-2a2 2 0 114 0v2m-8 4v-2a2 2 0 114 0v2" stroke="#primary"/><path d="M23 20v-2a2 2 0 013.043-1.707M19 19v-4a2 2 0 114 0v3m-8 3v-2a2 2 0 114 0v10" stroke="#secondary"/><path d="M6.7 12c.316 1.122.572 1.372 1.71 1.678-1.136.314-1.39.566-1.7 1.69-.316-1.121-.572-1.372-1.71-1.678 1.135-.314 1.389-.567 1.7-1.69zm42 0c.316 1.122.572 1.372 1.71 1.678-1.136.314-1.39.566-1.7 1.69-.317-1.121-.573-1.372-1.71-1.679 1.135-.313 1.389-.566 1.7-1.689zM28.021 47.627c.317 1.122.573 1.372 1.71 1.678-1.135.314-1.389.566-1.699 1.69-.318-1.121-.573-1.372-1.71-1.679 1.134-.313 1.389-.566 1.699-1.689z" stroke="#primary"/></g>',
      ...rank(value, [1, 200, 500, 1000, 2500]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Follower
  {
    const value = user.following.totalCount
    const unlock = user.following.nodes?.shift()

    list.push({
      title: "Follower",
      text: `Following ${value} user${imports.s(value)}`,
      icon:
        '<g fill="none" fill-rule="evenodd"><path d="M35 31a7 7 0 1114 0 7 7 0 01-14 0zm12-13a3 3 0 116 0 3 3 0 01-6 0zM33 49a3 3 0 116 0 3 3 0 01-6 0zM4 15a3 3 0 116 0 3 3 0 01-6 0zm37-8.5a2.5 2.5 0 115 0 2.5 2.5 0 01-5 0zM10 14l4.029-.576M19.008 26.016L21 19M29.019 34.001l5.967-1.948M36.997 46.003l2.977-8.02M46.05 24.031L48 21M28.787 18.012l7.248 8.009" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M43.62 29.004c-1.157 0-1.437.676-1.62 1.173-.19-.498-.494-1.167-1.629-1.167-.909 0-1.355.777-1.371 1.632-.022 1.145 1.309 2.365 3 3.358 1.669-.983 3-2.23 3-3.358 0-.89-.54-1.638-1.38-1.638z" fill="#primary"/><path stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M48.043 15.003L45 9"/><path d="M21 12a3 3 0 116 0 3 3 0 01-6 0zM27 12h3M18 12h3M21 43c-.267-1.727-1.973-3-4-3-2.08 0-3.787 1.318-4 3m4-9a3 3 0 100 6 3 3 0 000-6z" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M17 30a9 9 0 110 18 9 9 0 110-18z" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></g>',
      ...rank(value, [1, 200, 500, 1000, 2500]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Influencer
  {
    const value = user.followers.totalCount
    const unlock = user.followers.nodes?.shift()

    list.push({
      title: "Influencer",
      text: `Followed by ${value} user${imports.s(value)}`,
      icon:
        '<g transform="translate(4 4)" stroke-width="2" fill="none" fill-rule="evenodd"><path d="M33.432 1.924A23.922 23.922 0 0024 0c-3.945 0-7.668.952-10.95 2.638m-9.86 9.398A23.89 23.89 0 000 24a23.9 23.9 0 002.274 10.21m3.45 5.347a23.992 23.992 0 0012.929 7.845m13.048-.664c4.43-1.5 8.28-4.258 11.123-7.848m3.16-5.245A23.918 23.918 0 0048 24c0-1.87-.214-3.691-.619-5.439M40.416 6.493a24.139 24.139 0 00-1.574-1.355" stroke="#secondary" stroke-linecap="round"/><path stroke="#secondary" d="M4.582 33.859l1.613-7.946"/><circle stroke="#secondary" cx="6.832" cy="23" r="3"/><path stroke="#primary" d="M17.444 39.854l4.75 3.275"/><path stroke="#secondary" stroke-linecap="round" d="M7.647 14.952l-.433 4.527"/><circle stroke="#primary" cx="15" cy="38" r="3"/><path stroke="#primary" d="M22.216 9.516l.455 4.342"/><path stroke="#secondary" stroke-linecap="round" d="M34.272 6.952l-2.828 5.25"/><path stroke="#primary" stroke-linecap="square" d="M11.873 7.235l6.424-.736"/><path stroke="#secondary" stroke-linecap="round" d="M28.811 5.445l3.718-.671"/><path stroke="#primary" d="M42.392 22.006l.456-5.763M34.349 24.426l4.374.447"/><path d="M20 28c.267-1.727 1.973-3 4-3 2.08 0 3.787 1.318 4 3m-4-9a3 3 0 110 6 3 3 0 010-6z" stroke="#primary" stroke-linecap="round" stroke-linejoin="round"/><path d="M24 14c5.523 0 10 4.477 10 10s-4.477 10-10 10-10-4.477-10-10 4.477-10 10-10z" stroke="#primary" stroke-linecap="round" stroke-linejoin="round"/><circle stroke="#secondary" cx="35.832" cy="4" r="3"/><circle stroke="#secondary" cx="44" cy="36" r="3"/><circle stroke="#secondary" cx="34.832" cy="37" r="3"/><circle stroke="#primary" cx="21.654" cy="6.437" r="3"/><path d="M25.083 48.102a3 3 0 100-6 3 3 0 000 6z" stroke="#primary"/><path d="M8.832 5a3 3 0 110 6 3 3 0 010-6z" stroke="#primary" stroke-linecap="round"/><circle stroke="#secondary" cx="4" cy="37" r="3"/><path d="M42.832 10a3 3 0 110 6 3 3 0 010-6z" stroke="#primary" stroke-linecap="round"/><path stroke="#secondary" stroke-linecap="round" d="M32.313 38.851l-1.786 1.661"/><circle stroke="#primary" cx="42" cy="25" r="3"/><path stroke="#primary" stroke-linecap="square" d="M18.228 32.388l-1.562 2.66"/><path stroke="#secondary" d="M37.831 36.739l2.951-.112"/></g>',
      ...rank(value, [1, 200, 500, 1000, 2500]),
      value,
      unlock: new Date(unlock?.createdAt),
      leaderboard: leaderboard({user: ranks.user_rank.userCount, requirement: scores.followers >= requirements.followers, type: "users"}),
    })
  }

  //Maintainer
  {
    const value = user.popular.nodes?.shift()?.stargazers?.totalCount ?? 0
    const unlock = null

    list.push({
      title: "Maintainer",
      text: `Maintaining a repository with ${value} star${imports.s(value)}`,
      icon:
        '<g transform="translate(4 4)" fill="none" fill-rule="evenodd"><path d="M39 15h.96l4.038 3-.02-3H45a2 2 0 002-2V3a2 2 0 00-2-2H31a2 2 0 00-2 2v4.035" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M36 5.014l-3 3 3 3M40 5.014l3 3-3 3"/><path d="M6 37a1 1 0 110 2 1 1 0 010-2m7 0a1 1 0 110 2 1 1 0 010-2m-2.448 1a1 1 0 11-2 0 1 1 0 012 0z" fill="#primary"/><path d="M1.724 15.05A23.934 23.934 0 000 24c0 .686.029 1.366.085 2.037m19.92 21.632c1.3.218 2.634.331 3.995.331a23.92 23.92 0 009.036-1.76m13.207-13.21A23.932 23.932 0 0048 24c0-1.363-.114-2.7-.332-4M25.064.022a23.932 23.932 0 00-10.073 1.725" stroke="#secondary" stroke-width="2" stroke-linecap="round"/><path d="M19 42.062V43a2 2 0 01-2 2H9.04l-4.038 3 .02-3H3a2 2 0 01-2-2V33a2 2 0 012-2h4.045" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M6 0a6 6 0 110 12A6 6 0 016 0z" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path stroke="#primary" stroke-width="2" stroke-linecap="round" d="M6 3v6M3 6h6"/><path d="M42 36a6 6 0 110 12 6 6 0 010-12z" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M44.338 40.663l-3.336 3.331-1.692-1.686M31 31c-.716-2.865-3.578-5-7-5-3.423 0-6.287 2.14-7 5"/><path d="M24 16a5 5 0 110 10 5 5 0 010-10z" stroke="#primary" stroke-width="2" stroke-linecap="round"/><circle stroke="#primary" stroke-width="2" cx="24" cy="24" r="14"/></g>',
      ...rank(value, [1, 1000, 5000, 10000, 25000]),
      value,
      unlock: new Date(unlock?.createdAt),
      leaderboard: leaderboard({user: ranks.repo_rank.repositoryCount, requirement: scores.stars >= requirements.stars, type: "repositories"}),
    })
  }

  //Inspirer
  {
    const value = Math.max(0, ...data.user.repositories.nodes.map(({forkCount}) => forkCount))
    const unlock = null
    list.push({
      title: "Inspirer",
      text: `Maintaining or created a repository which has been forked ${value} time${imports.s(value)}`,
      icon:
        '<g transform="translate(4 4)" fill="none" fill-rule="evenodd"><path d="M20.065 47.122c.44-.525.58-1.448.58-1.889 0-2.204-1.483-3.967-3.633-4.187.447-1.537.58-2.64.397-3.31-.25-.92-.745-1.646-1.409-2.235m-5.97-7.157c.371-.254.911-.748 1.62-1.48a8.662 8.662 0 001.432-2.366M47 22h-7c-1.538 0-2.749-.357-4-1h-5c-1.789.001-3-1.3-3-2.955 0-1.656 1.211-3.04 3-3.045h2c.027-1.129.513-2.17 1-3m3.082 32.004C34.545 43.028 34.02 40.569 34 39v-1h-1c-2.603-.318-5-2.913-5-5.997S30.397 26 33 26h9c2.384 0 4.326 1.024 5.27 3" stroke="#secondary" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/><g transform="translate(36)" stroke="#primary" stroke-width="2"><path fill="#primary" stroke-linecap="round" stroke-linejoin="round" d="M5.395 5.352L6.009 4l.598 1.348L8 5.408l-1.067 1.12.425 1.47-1.356-.908-1.35.91.404-1.469L4 5.41z"/><circle cx="6" cy="6" r="6"/></g><g transform="translate(0 31)" stroke="#primary" stroke-width="2"><circle cx="6" cy="6" r="6"/><g stroke-linecap="round"><path d="M6 4v4M4 6h4"/></g></g><circle stroke="#primary" stroke-width="2" cx="10.5" cy="10.5" r="10.5"/><g stroke-linecap="round"><path d="M32.01 1.37A23.96 23.96 0 0024 0c-.999 0-1.983.061-2.95.18M.32 20.072a24.21 24.21 0 00.015 7.948M12.42 45.025A23.892 23.892 0 0024 48c13.255 0 24-10.745 24-24 0-2.811-.483-5.51-1.371-8.016" stroke="#secondary" stroke-width="2"/><path stroke="#primary" stroke-width="2" d="M8.999 7.151v5.865"/><path d="M9 3a2 2 0 110 4 2 2 0 010-4zm0 10.8a2 2 0 11-.001 4 2 2 0 01.001-4z" stroke="#primary" stroke-width="1.8"/><path d="M9.622 11.838c.138-.007.989.119 1.595-.05.607-.169 1.584-.539 1.829-1.337" stroke="#primary" stroke-width="2"/><path d="M14.8 7.202a2 2 0 110 4 2 2 0 010-4z" stroke="#primary" stroke-width="1.8"/></g></g>',
      ...rank(value, [1, 100, 500, 1000, 2500]),
      value,
      unlock: new Date(unlock?.createdAt),
      leaderboard: leaderboard({user: ranks.forks_rank.repositoryCount, requirement: scores.forks >= requirements.forks, type: "repositories"}),
    })
  }

  //Polyglot
  {
    const value = new Set(data.user.repositories.nodes.flatMap(repository => repository.languages.edges.map(({node: {name}}) => name))).size
    const unlock = null

    list.push({
      title: "Polyglot",
      text: `Using ${value} different programming language${imports.s(value)}`,
      icon:
        '<g stroke-linecap="round" stroke-width="2" fill="none" fill-rule="evenodd"><path d="M17.135 7.988l-3.303.669a2 2 0 00-1.586 2.223l4.708 35.392a1.498 1.498 0 01-1.162 1.66 1.523 1.523 0 01-1.775-1.01L4.951 19.497a2 2 0 011.215-2.507l2.946-1.072" stroke="#secondary" stroke-linejoin="round"/><path d="M36.8 48H23a2 2 0 01-2-2V7a2 2 0 012-2h26a2 2 0 012 2v32.766" stroke="#primary"/><path d="M29 20.955l-3.399 3.399a.85.85 0 000 1.202l3.399 3.4M43.014 20.955l3.399 3.399a.85.85 0 010 1.202l-3.4 3.4" stroke="#primary" stroke-linejoin="round"/><path stroke="#primary" d="M38.526 18l-5.053 14.016"/><path d="M44 36a8 8 0 110 16 8 8 0 010-16z" stroke="#primary" stroke-linejoin="round"/><path d="M43.068 40.749l3.846 2.396a1 1 0 01-.006 1.7l-3.846 2.36a1 1 0 01-1.523-.853v-4.755a1 1 0 011.529-.848z" stroke="#primary" stroke-linejoin="round"/></g>',
      ...rank(value, [1, 4, 8, 16, 32]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Member
  {
    const {years: value} = computed.registered
    const unlock = null

    list.push({
      title: "Member",
      text: `Registered ${Math.floor(value)} year${imports.s(Math.floor(value))} ago`,
      icon:
        '<g xmlns="http://www.w3.org/2000/svg" transform="translate(5 4)" fill="none" fill-rule="evenodd"><path d="M46 44.557v1a2 2 0 01-2 2H2a2 2 0 01-2-2v-1" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M.75 40.993l.701.561a2.323 2.323 0 002.903 0l1.675-1.34a3 3 0 013.748 0l1.282 1.026a3 3 0 003.71.03l1.4-1.085a3 3 0 013.75.061l1.103.913a3 3 0 003.787.031l1.22-.976a3 3 0 013.748 0l1.282 1.026a3 3 0 003.71.03l1.4-1.085a3 3 0 013.75.061l1.429 1.182a2.427 2.427 0 003.103-.008l.832-.695A2 2 0 0046 39.191v-1.634a2 2 0 00-2-2H2a2 2 0 00-2 2v1.875a2 2 0 00.75 1.561z" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M42 31.609v.948m-38 0v-.992m25.04-15.008H35a2 2 0 012 2v1m-28 0v-1a2 2 0 012-2h6.007" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 8.557h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6a1 1 0 011-1z" stroke="#primary" stroke-width="2" stroke-linejoin="round"/><path d="M4.7 10.557c.316 1.122.572 1.372 1.71 1.678-1.136.314-1.39.566-1.7 1.69-.317-1.121-.573-1.372-1.71-1.679 1.135-.313 1.389-.566 1.7-1.689zm35-8c.316 1.122.572 1.372 1.71 1.678-1.136.314-1.39.566-1.7 1.69-.317-1.121-.573-1.372-1.71-1.679 1.135-.313 1.389-.566 1.7-1.689z" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M23 5.557a2 2 0 002-2C25 2.452 24.433 0 22.273 0c-.463 0 .21 1.424-.502 1.979A2 2 0 0023 5.557z" stroke="#primary" stroke-width="2"/><path d="M4.78 27.982l1.346 1.076a3 3 0 003.748 0l1.252-1.002a3 3 0 013.748 0l1.282 1.026a3 3 0 003.711.03l1.4-1.085a3 3 0 013.75.061l1.102.913a3 3 0 003.787.031l1.22-.976a3 3 0 013.748 0l1.281 1.025a3 3 0 003.712.029l1.358-1.053a2 2 0 00.775-1.58v-.97a1.95 1.95 0 00-1.95-1.95H5.942a1.912 1.912 0 00-1.912 1.912v.951a2 2 0 00.75 1.562z" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle stroke="#secondary" cx="16.5" cy="2.057" r="1"/><circle stroke="#secondary" cx="14.5" cy="12.057" r="1"/><circle stroke="#secondary" cx="31.5" cy="9.057" r="1"/></g>',
      ...rank(value, [1, 3, 5, 10, 15]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Sponsors
  {
    const value = user.sponsorshipsAsSponsor.totalCount
    const unlock = null

    list.push({
      title: "Sponsor",
      text: `Sponsoring ${value} user${imports.s(value)} or organization${imports.s(value)}`,
      icon:
        '<g xmlns="http://www.w3.org/2000/svg" fill="none" fill-rule="evenodd"><path d="M24 32c.267-1.727 1.973-3 4-3 2.08 0 3.787 1.318 4 3m-4-9a3 3 0 110 6 3 3 0 010-6z" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M28 18c5.523 0 10 4.477 10 10s-4.477 10-10 10-10-4.477-10-10 4.477-10 10-10z" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M46.138 15c-1.033 0-1.454.822-1.634 1.413-.019.06-.024.06-.042 0-.182-.591-.707-1.413-1.655-1.413C41.347 15 41 16.117 41 17.005c0 1.676 2.223 3.228 3.091 3.845.272.197.556.194.817 0 .798-.593 3.092-2.17 3.092-3.845 0-.888-.261-2.005-1.862-2.005zm-31-5c-1.033 0-1.454.822-1.634 1.413-.019.06-.024.06-.042 0-.182-.591-.707-1.413-1.655-1.413C10.347 10 10 11.117 10 12.005c0 1.676 2.223 3.228 3.091 3.845.272.197.556.194.817 0 .798-.593 3.092-2.17 3.092-3.845 0-.888-.261-2.005-1.862-2.005zm6 32c-1.033 0-1.454.822-1.634 1.413-.019.06-.024.06-.042 0-.182-.591-.707-1.413-1.655-1.413C16.347 42 16 43.117 16 44.005c0 1.676 2.223 3.228 3.091 3.845.272.197.556.194.817 0 .798-.593 3.092-2.17 3.092-3.845 0-.888-.261-2.005-1.862-2.005z" fill="#secondary"/><path d="M8.003 29a3 3 0 110 6 3 3 0 010-6zM32.018 5.005a3 3 0 110 6 3 3 0 010-6z" stroke="#secondary" stroke-width="2" stroke-linecap="round"/><path stroke="#secondary" stroke-width="2" d="M29.972 18.026L31.361 11M18.063 29.987l-7.004 1.401"/><path d="M22.604 11.886l.746 2.164m-9.313 9.296l-2.156-.712" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M21.304 9a1 1 0 100-2 1 1 0 000 2zM8.076 22.346a1 1 0 100-2 1 1 0 000 2z" fill="#primary"/><path d="M33.267 44.17l-.722-2.146m9.38-9.206l2.147.743" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M34.544 49.031a1 1 0 100-2 1 1 0 000 2zm13.314-13.032a1 1 0 100-2 1 1 0 000 2z" fill="#primary"/><path d="M48.019 51.004a3 3 0 100-6 3 3 0 000 6zM35.194 35.33l10.812 11.019" stroke="#secondary" stroke-width="2"/></g>',
      ...rank(value, [1, 3, 5, 10, 25]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Deployer
  {
    const value = computed.repositories?.deployments
    const unlock = null

    list.push({
      title: "Deployer",
      text: `Repositories have been deployed ${value} time${imports.s(value)}`,
      icon:
        '<g stroke-width="2" fill="none" fill-rule="evenodd"><g stroke="#secondary"><path d="M11 40a2 2 0 100-4 2 2 0 000 4z"/><path d="M11 34v1m0 5v3m0 3v3" stroke-linecap="round"/></g><g stroke="#secondary" stroke-linecap="round" stroke-linejoin="round"><path d="M47.01 41.009h-4M45.016 39v4"/></g><path d="M27.982 5c2.79 1.873 4.46 5.876 5.008 12.01l2.059.659a1.606 1.606 0 011.606-1.665h.84a2.513 2.513 0 012.511 2.508l.004 1.496 3.197 1.588a1.951 1.951 0 011.684-.952l.509.002c.898.003 1.625.73 1.629 1.629l.008 2.115L51 27.606v1.945l-4.815-1.211c-.474.894-.87 1.48-1.192 1.757-.345-.328-.814-1.158-1.406-2.49L38.744 26.5c-.402 1.153-.845 1.828-1.328 2.026-.451-.444-1.04-1.55-1.409-2.821-1.481-.286-2.486-.56-2.994-.688-.27 2.397-1.036 6.884-2.009 10.982l5.006 4.438-6.555-1.08-1.454 3.654-1.45-3.658-6.56 1.082 4.996-4.417c-.899-4.02-1.576-7.684-2.03-10.992a37.29 37.29 0 01-2.967.679c-.38 1.252-.845 2.191-1.396 2.817-.63-.184-1.142-1.474-1.338-2.023-.705.15-2.323.519-4.853 1.107-.601 1.388-1.07 2.218-1.41 2.49a7.032 7.032 0 01-1.173-1.758L5 29.55v-1.945l3.99-3.265v-2.102a1.604 1.604 0 011.625-1.604l.528.007c.68.008 1.307.37 1.654.956l3.184-1.614.003-1.467a2.503 2.503 0 012.511-2.497l.863.003a1.6 1.6 0 011.594 1.646 62.42 62.42 0 012.024-.667c.572-6.097 2.24-10.098 5.006-12.002z" stroke="#primary" stroke-linecap="round" stroke-linejoin="round"/><path stroke="#secondary" stroke-linecap="round" d="M45.016 36.032v-2M45.016 49.032v-3M38.978 36.089v-3.153M17.016 36.089v-3.153M51.031 51.165v-2.193m0-2.972V35.013M4.974 51.165v-2.193m0-2.972V35.013"/></g>',
      ...rank(value, [1, 200, 500, 1000, 2500]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Chatter
  {
    const value = user.discussionsStarted.totalCount + user.discussionsComments.totalCount
    const unlock = null

    list.push({
      title: "Chatter",
      text: `Participated in discussions ${value} time${imports.s(value)}`,
      icon:
        '<g fill="none" fill-rule="evenodd"><path d="M6 42c.45-3.415 3.34-6 7-6 1.874 0 3.752.956 5 3m-6-13a5 5 0 110 10 5 5 0 010-10zm38 16c-.452-3.415-3.34-6-7-6-1.874 0-3.752.956-5 3m6-13a5 5 0 100 10 5 5 0 000-10z" stroke="#secondary" stroke-width="2" stroke-linecap="round"/><path d="M37 51c-.92-4.01-4.6-7-9-7-4.401 0-8.083 2.995-9 7" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M28.01 31.004a6.5 6.5 0 110 13 6.5 6.5 0 010-13z" stroke="#primary" stroke-width="2" stroke-linecap="round"/><path d="M28 14.011a5 5 0 11-5 4.998 5 5 0 015-4.998z" stroke="#secondary" stroke-width="2" stroke-linecap="round"/><path d="M22 26c1.558-1.25 3.665-2 6-2 2.319 0 4.439.761 6 2" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M51 9V8c0-1.3-1.574-3-3-3h-8c-1.426 0-3 1.7-3 3v13l4-4h6c2.805-.031 4-1.826 4-4V9zM5 9V8c0-1.3 1.574-3 3-3h8c1.426 0 3 1.7 3 3v13l-4-4H9c-2.805-.031-4-1.826-4-4V9z" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M43 11a1 1 0 11-2 0 1 1 0 012 0zm4 0a1 1 0 11-2 0 1 1 0 012 0zm-36 0a1 1 0 11-2 0 1 1 0 012 0zm4 0a1 1 0 11-2 0 1 1 0 012 0z" fill="#primary"/></g>',
      ...rank(value, [1, 200, 500, 1000, 2500]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Helper
  {
    const value = user.discussionAnswers.totalCount
    const unlock = null

    list.push({
      title: "Helper",
      text: `Answered and solved ${value} discussion${imports.s(value)}`,
      icon:
        '<g xmlns="http://www.w3.org/2000/svg" fill="none" fill-rule="evenodd"><path d="M28 37c1.003.005.997-.443 1-1 .004-1.458-.004-4.629 0-6-.007-.564-.068-.987-1-1-2.118 0-4 1.79-4 4s1.882 4 4 4zM48 37c-1.003.005-.997-.443-1-1-.004-1.458.004-4.629 0-6 .007-.564.068-.987 1-1 2.118 0 4 1.79 4 4s-1.882 4-4 4z" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M26 51c.798-4.48 4.87-8.082 9.97-8.849.66-.1 1.338-.151 2.028-.151m9.606 4.038c1.27 1.408 2.12 3.102 2.396 4.945M32.002 39.71A8.966 8.966 0 0038 42a8.967 8.967 0 006.02-2.31m-.015-12.394A8.967 8.967 0 0038 25a8.966 8.966 0 00-5.994 2.286" stroke="#secondary" stroke-width="2" stroke-linecap="round"/><path d="M38 45c.17 0 .34-.004.509-.01 5.23-.219 9.596-3.785 11.01-8.613m-.004-6.766C48.052 24.634 43.45 21 38 21c-5.485 0-10.11 3.68-11.542 8.706" stroke="#primary" stroke-width="2"/><path d="M37.85 44h1.173c.54 0 .977.438.977.977v.523a1.5 1.5 0 01-3 0v-.65c0-.47.38-.85.85-.85z" fill="#primary"/><path d="M22 27h-3v4l-6-4H7a2 2 0 01-2-2V7a2 2 0 012-2h33a2 2 0 012 2v10" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><g stroke="#primary" stroke-linecap="round" stroke-width="2"><path stroke-linejoin="round" d="M17 13l-3 3 3 3M30 13l3 3-3 3"/><path d="M25.03 10.986l-3.015 10.027"/></g></g>',
      ...rank(value, [1, 20, 50, 100, 250]),
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Verified
  {
    const value = !/This user hasn't uploaded any GPG keys/i.test((await imports.axios.get(`https://github.com/${login}.gpg`)).data)
    const unlock = null

    list.push({
      title: "Verified",
      text: "Registered a GPG key to sign commits",
      icon:
        '<g stroke-linecap="round" stroke-linejoin="round" stroke-width="2" fill="none" fill-rule="evenodd"><path d="M46 17.036v13.016c0 4.014-.587 8.94-4.751 13.67-5.787 5.911-12.816 8.279-13.243 8.283-.426.003-7.91-2.639-13.222-8.283C10.718 39.4 10 34.056 10 30.052V17.036a2 2 0 012-2h32a2 2 0 012 2zM16 15c0-6.616 5.384-12 12-12s12 5.384 12 12" stroke="#secondary"/><path d="M21 15c0-3.744 3.141-7 7-7 3.86 0 7 3.256 7 7m4.703 29.63l-3.672-3.647m-17.99-17.869l-7.127-7.081" stroke="#secondary"/><path d="M28 23a8 8 0 110 16 8 8 0 010-16z" stroke="#primary"/><path stroke="#primary" d="M30.966 29.005l-4 3.994-2.002-1.995"/></g>',
      rank: value ? "$" : "X",
      progress: value ? 1 : 0,
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Explorer
  {
    const value = !/doesn‚Äôt have any starred topics yet/i.test((await imports.axios.get(`https://github.com/stars/${login}/topics`)).data)
    const unlock = null

    list.push({
      title: "Explorer",
      text: "Starred a topic on GitHub Explore",
      icon:
        '<g transform="translate(3 4)" fill="none" fill-rule="evenodd"><path d="M10 37.5l.049.073a2 2 0 002.506.705l24.391-11.324a2 2 0 00.854-2.874l-2.668-4.27a2 2 0 00-2.865-.562L10.463 34.947A1.869 1.869 0 0010 37.5zM33.028 28.592l-4.033-6.58" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path stroke="#primary" stroke-width="2" stroke-linejoin="round" d="M15.52 37.004l-2.499-3.979"/><path stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M25.008 48.011l.013-15.002M17.984 47.038l6.996-14.035M32.005 47.029l-6.987-14.016"/><path d="M2.032 17.015A23.999 23.999 0 001 24c0 9.3 5.29 17.365 13.025 21.35m22-.027C43.734 41.33 49 33.28 49 24a24 24 0 00-1.025-6.96M34.022 1.754A23.932 23.932 0 0025 0c-2.429 0-4.774.36-6.983 1.032" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M40.64 8.472c-1.102-2.224-.935-4.764 1.382-6.465-.922-.087-2.209.326-3.004.784a6.024 6.024 0 00-2.674 7.229c.94 2.618 3.982 4.864 7.66 3.64 1.292-.429 2.615-1.508 2.996-2.665-1.8.625-5.258-.3-6.36-2.523zM21.013 6.015c-.22-.802-3.018-1.295-4.998-.919M4.998 8.006C2.25 9.22.808 11.146 1.011 12.009" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle stroke="#secondary" stroke-width="2" cx="11" cy="9" r="6"/><path d="M.994 12.022c.351 1.38 5.069 1.25 10.713-.355 5.644-1.603 9.654-4.273 9.303-5.653" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M26.978 10.105c.318 1.123.573 1.373 1.71 1.679-1.135.314-1.388.566-1.698 1.69-.318-1.122-.573-1.373-1.711-1.679 1.135-.314 1.39-.566 1.7-1.69" fill="#secondary"/><path d="M26.978 10.105c.318 1.123.573 1.373 1.71 1.679-1.135.314-1.388.566-1.698 1.69-.318-1.122-.573-1.373-1.711-1.679 1.135-.314 1.39-.566 1.7-1.69z" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M9.929 22.737c.317 1.121.573 1.372 1.71 1.678-1.135.314-1.389.566-1.699 1.69-.318-1.121-.573-1.372-1.71-1.679 1.134-.313 1.389-.566 1.699-1.69" fill="#secondary"/><path d="M9.929 22.737c.317 1.121.573 1.372 1.71 1.678-1.135.314-1.389.566-1.699 1.69-.318-1.121-.573-1.372-1.71-1.679 1.134-.313 1.389-.566 1.699-1.69z" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M38.912 33.684c.318 1.122.573 1.373 1.711 1.679-1.136.313-1.39.565-1.7 1.69-.317-1.123-.573-1.372-1.71-1.68 1.136-.313 1.389-.565 1.7-1.689" fill="#secondary"/><path d="M38.912 33.684c.318 1.122.573 1.373 1.711 1.679-1.136.313-1.39.565-1.7 1.69-.317-1.123-.573-1.372-1.71-1.68 1.136-.313 1.389-.565 1.7-1.689z" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></g>',
      rank: value ? "$" : "X",
      progress: value ? 1 : 0,
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Automator
  {
    const value = process.env.GITHUB_ACTIONS
    const unlock = null

    list.push({
      title: "Automator",
      text: "Use GitHub Actions to automate profile updates",
      icon:
        '<g transform="translate(4 5)" stroke-width="2" fill="none" fill-rule="evenodd"><g stroke-linecap="round" stroke-linejoin="round"><path stroke="#primary" d="M26.478 22l.696 2.087 3.478.696v2.782l-3.478 1.392-.696 1.39 1.392 3.48-1.392 1.39L23 33.827l-1.391.695L20.217 38h-2.782l-1.392-3.478-1.39-.696-3.48 1.391-1.39-1.39 1.39-3.48-.695-1.39L7 27.565v-2.782l3.478-1.392.696-1.391-1.391-3.478 1.39-1.392 3.48 1.392 1.39-.696 1.392-3.478h2.782l1.392 3.478 1.391.696 3.478-1.392 1.392 1.392z"/><path stroke="#secondary" d="M24.779 12.899l-1.475-2.212 1.475-1.475 2.95 1.475 1.474-.738.737-2.934h2.212l.737 2.934 1.475.738 2.95-1.475 1.474 1.475-1.475 2.949.738 1.475 2.949.737v2.212l-2.95.737-.737 1.475 1.475 2.949-1.475 1.475-2.949-1.475"/></g><path stroke="#primary" stroke-linecap="round" d="M5.932 5.546l7.082 6.931"/><path stroke="#secondary" stroke-linecap="round" d="M32.959 31.99l8.728 8.532"/><circle stroke="#secondary" cx="44" cy="43" r="3"/><circle stroke="#primary" cx="13" cy="2" r="2"/><circle stroke="#secondary" cx="35" cy="44" r="2"/><circle stroke="#secondary" cx="3" cy="12" r="2"/><circle stroke="#primary" cx="45" cy="34" r="2"/><path d="M3.832 0a3 3 0 110 6 3 3 0 010-6zM8.04 10.613l2.1-.613M10.334 9.758l1.914-5.669" stroke="#primary" stroke-linecap="round"/><path stroke="#secondary" stroke-linecap="round" d="M40.026 35.91l-2.025.591M35.695 41.965l1.843-5.326"/><path d="M16 2h23.038a6 6 0 016 6v24.033" stroke="#primary" stroke-linecap="round"/><path d="M32.038 44.033H9a6 6 0 01-6-6V14" stroke="#secondary" stroke-linecap="round"/><path d="M17.533 22.154l5.113 3.22a1 1 0 01-.006 1.697l-5.113 3.17a1 1 0 01-1.527-.85V23a1 1 0 011.533-.846zm11.58-7.134v-.504a1 1 0 011.53-.85l3.845 2.397a1 1 0 01-.006 1.701l-3.846 2.358" stroke="#primary" stroke-linecap="round" stroke-linejoin="round"/></g>',
      rank: value ? "$" : "X",
      progress: value ? 1 : 0,
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Infographile
  {
    const {repository: {viewerHasStarred: value}, viewer: {login: _login}} = await graphql(queries.achievements.metrics())
    const unlock = null

    list.push({
      title: "Infographile",
      text: "Fervent supporter of metrics",
      icon:
        '<g stroke-linejoin="round" stroke-width="2" fill="none" fill-rule="evenodd"><g stroke="#secondary" stroke-linecap="round"><path d="M22 31h20M22 36h10"/></g><path d="M44.05 36.013a8 8 0 110 16 8 8 0 010-16z" stroke="#primary" stroke-linecap="round"/><path d="M32 43H7c-1.228 0-2-.84-2-2V7c0-1.16.772-2 2-2h7.075M47 24.04V32" stroke="#secondary" stroke-linecap="round"/><path stroke="#primary" stroke-linecap="round" d="M47.015 42.017l-4 3.994-2.001-1.995"/><path stroke="#secondary" d="M11 31h5v5h-5z"/><path d="M11 14a2 2 0 012-2m28 12a2 2 0 01-2 2h-1m-5 0h-4m-6 0h-4m-5 0h-1a2 2 0 01-2-2m0-4v-2" stroke="#secondary" stroke-linecap="round"/><path d="M18 18V7c0-1.246.649-2 1.73-2h28.54C49.351 5 50 5.754 50 7v11c0 1.246-.649 2-1.73 2H19.73c-1.081 0-1.73-.754-1.73-2z" stroke="#primary" stroke-linecap="round"/><path stroke="#primary" stroke-linecap="round" d="M22 13h4l2-3 3 5 2-2h3.052l2.982-4 3.002 4H46"/></g>',
      rank: (value) && (login === _login) ? "$" : "X",
      progress: (value) && (login === _login) ? 1 : 0,
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }

  //Octonaut
  {
    const {user: {viewerIsFollowing: value}, viewer: {login: _login}} = await graphql(queries.achievements.octocat())
    const unlock = null

    list.push({
      title: "Octonaut",
      text: "Following octocat",
      icon:
        '<g fill="none" fill-rule="evenodd"><path d="M14.7 8c.316 1.122.572 1.372 1.71 1.678-1.136.314-1.39.566-1.7 1.69-.317-1.121-.573-1.372-1.71-1.679 1.135-.313 1.389-.566 1.7-1.689zm26 0c.316 1.122.572 1.372 1.71 1.678-1.136.314-1.39.566-1.7 1.69-.317-1.121-.573-1.372-1.71-1.679 1.135-.313 1.389-.566 1.7-1.689zM28.021 5c.318 1.122.574 1.372 1.711 1.678-1.136.314-1.389.566-1.7 1.69-.317-1.121-.572-1.372-1.71-1.679 1.135-.313 1.39-.566 1.7-1.689z" stroke="#primary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><g transform="translate(4 9)" fill-rule="nonzero"><path d="M14.05 9.195C10.327 7.065 7.46 6 5.453 6 4.92 6 4 6.164 3.5 6.653s-.572.741-.711 1.14c-.734 2.1-1.562 6.317.078 9.286-8.767 25.38 15.513 24.92 21.207 24.92 5.695 0 29.746.456 21.037-24.908 1.112-2.2 1.404-5.119.121-9.284-.863-2.802-4.646-2.341-11.35 1.384a27.38 27.38 0 00-9.802-1.81c-3.358 0-6.701.605-10.03 1.814z" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M10.323 40.074c-2.442-1.02-2.93-3.308-2.93-4.834 0-1.527.488-2.45.976-3.92.489-1.47.391-2.281-.976-5.711-1.368-3.43.976-7.535 4.884-7.535 3.908 0 7.088 3.005 11.723 2.956m0 0c4.635.05 7.815-2.956 11.723-2.956 3.908 0 6.252 4.105 4.884 7.535-1.367 3.43-1.465 4.241-.976 5.71.488 1.47.976 2.394.976 3.92 0 1.527-.488 3.816-2.93 4.835" stroke="#secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle fill="#primary" cx="12" cy="30" r="1"/><circle fill="#primary" cx="13" cy="28" r="1"/><circle fill="#primary" cx="15" cy="28" r="1"/><circle fill="#primary" cx="23" cy="35" r="1"/><circle fill="#primary" cx="25" cy="35" r="1"/><circle fill="#primary" cx="17" cy="28" r="1"/><circle fill="#primary" cx="31" cy="28" r="1"/><circle fill="#primary" cx="33" cy="28" r="1"/><circle fill="#primary" cx="35" cy="28" r="1"/><circle fill="#primary" cx="12" cy="32" r="1"/><circle fill="#primary" cx="19" cy="30" r="1"/><circle fill="#primary" cx="19" cy="32" r="1"/><circle fill="#primary" cx="29" cy="30" r="1"/><circle fill="#primary" cx="29" cy="32" r="1"/><circle fill="#primary" cx="36" cy="30" r="1"/><circle fill="#primary" cx="36" cy="32" r="1"/></g></g>',
      rank: (value) && (login === _login) ? "$" : "X",
      progress: (value) && (login === _login) ? 1 : 0,
      value,
      unlock: new Date(unlock?.createdAt),
    })
  }
}
</file>

<file path="source/plugins/achievements/queries/achievements.graphql">
query AchievementsDefault {

  user(login: "$login") {
    repositories(first: 1, privacy: PUBLIC, affiliations: OWNER, orderBy: {field: CREATED_AT, direction: ASC}) {
      nodes {
        createdAt
        nameWithOwner
      }
      totalCount
    }
    forks:repositories(first: 1, privacy: PUBLIC, isFork: true, orderBy: {field: CREATED_AT, direction: ASC}) {
      nodes {
        createdAt
        nameWithOwner
      }
      totalCount
    }
    popular:repositories(first:1, orderBy: {field: STARGAZERS, direction: DESC}) {
      nodes {
        stargazers {
          totalCount
        }
      }
    }
    pullRequests(orderBy: {field: CREATED_AT, direction: ASC}, first: 1) {
      nodes {
        createdAt
        title
        repository {
          nameWithOwner
        }
      }
      totalCount
    }
    contributionsCollection {
      pullRequestReviewContributions(first: 1, orderBy: {direction: ASC}) {
        nodes {
          occurredAt
          pullRequest {
            title
            number
            repository {
              nameWithOwner
            }
          }
        }
        totalCount
      }
    }
    # projects(first: 1, orderBy: {field: CREATED_AT, direction: ASC}) {
    #   totalCount
    #   #nodes { This requires additional scopes :/
    #   #  name
    #   #}
    # }
    packages(first: 1, orderBy: {direction: ASC, field: CREATED_AT}) {
      totalCount
      #nodes { This requires additional scopes :/
      #  name
      #  packageType
      #  versions(first: 1, orderBy: {direction: ASC, field: CREATED_AT}) {
      #    nodes {
      #      id
      #    }
      #  }
      #}
    }
    organizations(first: 1) {
      #nodes {
      #  name
      #}
      totalCount
    }
    gists(first: 1, orderBy: {field: CREATED_AT, direction: ASC}) {
      nodes {
        createdAt
        name
      }
      totalCount
    }
    starredRepositories {
      totalCount
    }
    followers {
      totalCount
    }
    following {
      totalCount
    }
    bio
    status {
      message
    }
    sponsorshipsAsSponsor {
      totalCount
    }
    discussionsStarted: repositoryDiscussions {
      totalCount
    }
    discussionsComments: repositoryDiscussionComments {
      totalCount
    }
    discussionAnswers: repositoryDiscussionComments(onlyAnswers: true) {
      totalCount
    }
  }
}
</file>

<file path="source/plugins/achievements/queries/total.graphql">
query AchievementsTotal {
  issues:search(query: "created:>1970", type: ISSUE) {
    count:issueCount
  }
  repositories:search(query: "created:>1970", type: REPOSITORY) {
    count:repositoryCount
  }
  users:search(query: "created:>1970", type: USER) {
    count:userCount
  }
}
</file>

<file path="source/plugins/community/crypto/metadata.yml">
name: ü™ô Crypto
category: community
description: |
  Generates a SVG image containing crypto metrics from a given address.
  This plugin using coingecko API to fetch crypto prices.
  check https://www.coingecko.com/vi/api/documentation for more information.
examples:
  default: https://via.placeholder.com/468x60?text=No%20preview%20available
authors:
  - dajneem23
supports:
  - user
  - organization
  - repository
scopes: []
inputs:

  plugin_crypto:
    description: |
      Enable crypto plugin
    type: boolean
    default: no
  
  plugin_crypto_id:
    description: |
      Crypto id
    type: string
    default: ""
    example: bitcoin

  plugin_crypto_vs_currency:
    description: |
      The target currency of market data (usd, eur, jpy, etc.)
    type: string
    default: "usd"
    example: "usd"

  plugin_crypto_days:
    description: |
      Data up to number of days ago (eg. 1,14,30,max)
    type: string
    default: "1"
    example: 1

  plugin_crypto_precision:
    description: |
      The number of decimal places to use
    type: number
    default: 2
    example: 2
</file>

<file path="source/plugins/community/splatoon/s3si/index.ts">
// deno-fmt-ignore-file
// deno-lint-ignore-file
// This code was bundled using `deno bundle` and it's not recommended to edit it manually

class APIError extends Error {
    response;
    json;
    constructor({ response , json , message  }){
        super(message);
        this.response = response;
        this.json = json;
    }
}
const AGENT_NAME = "s3si.ts";
const S3SI_VERSION = "0.4.5";
const NSOAPP_VERSION = "2.6.0";
const WEB_VIEW_VERSION = "4.0.0-d5178440";
var Queries;
(function(Queries) {
    Queries["HomeQuery"] = "7dcc64ea27a08e70919893a0d3f70871";
    Queries["LatestBattleHistoriesQuery"] = "0d90c7576f1916469b2ae69f64292c02";
    Queries["RegularBattleHistoriesQuery"] = "3baef04b095ad8975ea679d722bc17de";
    Queries["BankaraBattleHistoriesQuery"] = "0438ea6978ae8bd77c5d1250f4f84803";
    Queries["XBattleHistoriesQuery"] = "6796e3cd5dc3ebd51864dc709d899fc5";
    Queries["EventBattleHistoriesQuery"] = "9744fcf676441873c7c8a51285b6aa4d";
    Queries["PrivateBattleHistoriesQuery"] = "8e5ae78b194264a6c230e262d069bd28";
    Queries["VsHistoryDetailQuery"] = "9ee0099fbe3d8db2a838a75cf42856dd";
    Queries["CoopHistoryQuery"] = "91b917becd2fa415890f5b47e15ffb15";
    Queries["CoopHistoryDetailQuery"] = "379f0d9b78b531be53044bcac031b34b";
    Queries["myOutfitCommonDataFilteringConditionQuery"] = "d02ab22c9dccc440076055c8baa0fa7a";
    Queries["myOutfitCommonDataEquipmentsQuery"] = "d29cd0c2b5e6bac90dd5b817914832f8";
    Queries["HistoryRecordQuery"] = "d9246baf077b2a29b5f7aac321810a77";
    Queries["ConfigureAnalyticsQuery"] = "f8ae00773cc412a50dd41a6d9a159ddd";
})(Queries || (Queries = {}));
const S3SI_LINK = "https://github.com/spacemeowx2/s3si.ts";
const USERAGENT = `${AGENT_NAME}/${S3SI_VERSION} (${S3SI_LINK})`;
const DEFAULT_APP_USER_AGENT = "Mozilla/5.0 (Linux; Android 11; Pixel 5) " + "AppleWebKit/537.36 (KHTML, like Gecko) " + "Chrome/94.0.4606.61 Mobile Safari/537.36";
const SPLATNET3_ENDPOINT = "https://api.lp1.av5ja.srv.nintendo.net/api/graphql";
const BATTLE_NAMESPACE = "b3a2dbf5-2c09-4792-b78c-00b548b70aeb";
const COOP_NAMESPACE = "f1911910-605e-11ed-a622-7085c2057a9d";
const S3SI_NAMESPACE = "63941e1c-e32e-4b56-9a1d-f6fbe19ef6e1";
const SPLATNET3_STATINK_MAP = {
    RULE: {
        TURF_WAR: "nawabari",
        AREA: "area",
        LOFT: "yagura",
        GOAL: "hoko",
        CLAM: "asari",
        TRI_COLOR: "tricolor"
    },
    RESULT: {
        WIN: "win",
        LOSE: "lose",
        DEEMED_LOSE: "lose",
        EXEMPTED_LOSE: "exempted_lose",
        DRAW: "draw"
    },
    DRAGON: {
        NORMAL: undefined,
        DECUPLE: "10x",
        DRAGON: "100x",
        DOUBLE_DRAGON: "333x"
    },
    COOP_EVENT_MAP: {
        1: "rush",
        2: "goldie_seeking",
        3: "griller",
        4: "mothership",
        5: "fog",
        6: "cohock_charge",
        7: "giant_tornado",
        8: "mudmouth_eruption"
    },
    COOP_SPECIAL_MAP: {
        "bd327d1b64372dedefd32adb28bea62a5b6152d93aada5d9fc4f669a1955d6d4": "nicedama",
        "463eedc60013608666b260c79ac8c352f9795c3d0cce074d3fbbdbd2c054a56d": "hopsonar",
        "fa8d49e8c850ee69f0231976208a913384e73dc0a39e6fb00806f6aa3da8a1ee": "megaphone51",
        "252059408283fbcb69ca9c18b98effd3b8653ab73b7349c42472281e5a1c38f9": "jetpack",
        "680379f8b83e5f9e033b828360827bc2f0e08c34df1abcc23de3d059fe2ac435": "kanitank",
        "0785cb4979024a83aaa2196e287e232d5d7e4ac959895a650c30ed00fedbc714": "sameride",
        "380e541b5bc5e49d77ff1a616f1343aeba01d500fee36aaddf8f09d74bd3d3bc": "tripletornado"
    },
    WATER_LEVEL_MAP: {
        0: "low",
        1: "normal",
        2: "high"
    }
};
const CONTROL_CHARS = /[\x00-\x1F\x7F]/;
const COOKIE_NAME_BLOCKED = /[()<>@,;:\\"/[\]?={}]/;
const COOKIE_OCTET_BLOCKED = /[\s",;\\]/;
const COOKIE_OCTET = /^[\x21\x23-\x2B\x2D-\x3A\x3C-\x5B\x5D-\x7E]+$/;
const TERMINATORS = [
    "\n",
    "\r",
    "\0"
];
function isSameDomainOrSubdomain(domainA, domainB) {
    if (!domainA || !domainB) {
        return false;
    }
    let longerDomain;
    let shorterDomain;
    if (domainB.length > domainA.length) {
        longerDomain = domainB;
        shorterDomain = domainA;
    } else {
        longerDomain = domainA;
        shorterDomain = domainB;
    }
    const indexOfDomain = longerDomain.indexOf(shorterDomain);
    if (indexOfDomain === -1) {
        return false;
    } else if (indexOfDomain > 0) {
        if (longerDomain.charAt(indexOfDomain - 1) !== ".") {
            return false;
        }
    }
    return true;
}
function trimTerminator(str) {
    if (str === undefined || str === "") return str;
    for(let t = 0; t < TERMINATORS.length; t++){
        const terminatorIdx = str.indexOf(TERMINATORS[t]);
        if (terminatorIdx !== -1) {
            str = str.substr(0, terminatorIdx);
        }
    }
    return str;
}
function isValidName(name) {
    if (!name) {
        return false;
    }
    if (CONTROL_CHARS.test(name) || COOKIE_NAME_BLOCKED.test(name)) {
        return false;
    }
    return true;
}
function trimWrappingDoubleQuotes(val) {
    if (val.length >= 2 && val.at(0) === '"' && val.at(-1) === '"') {
        return val.slice(1, -1);
    }
    return val;
}
function isValidValue(val) {
    if (val === "") {
        return true;
    }
    if (!val) {
        return false;
    }
    if (CONTROL_CHARS.test(val) || COOKIE_OCTET_BLOCKED.test(val) || !COOKIE_OCTET.test(val)) {
        return false;
    }
    return true;
}
function parseURL(input) {
    let copyUrl;
    if (input instanceof Request) {
        copyUrl = input.url;
    } else if (input instanceof URL) {
        copyUrl = input.toString();
    } else {
        copyUrl = input;
    }
    copyUrl = copyUrl.replace(/^\./, "");
    if (!copyUrl.includes("://")) {
        copyUrl = "http://" + copyUrl;
    }
    return new URL(copyUrl);
}
class Cookie {
    name;
    value;
    path;
    domain;
    expires;
    maxAge;
    secure;
    httpOnly;
    sameSite;
    creationDate = Date.now();
    creationIndex;
    static cookiesCreated = 0;
    constructor(options){
        if (options) {
            this.name = options.name;
            this.value = options.value;
            this.path = options.path;
            this.domain = options.domain;
            this.expires = options.expires;
            this.maxAge = options.maxAge;
            this.secure = options.secure;
            this.httpOnly = options.httpOnly;
            this.sameSite = options.sameSite;
            if (options.creationDate) {
                this.creationDate = options.creationDate;
            }
        }
        Object.defineProperty(this, "creationIndex", {
            configurable: false,
            enumerable: false,
            writable: true,
            value: ++Cookie.cookiesCreated
        });
    }
    static from(cookieStr) {
        const options = {
            name: undefined,
            value: undefined,
            path: undefined,
            domain: undefined,
            expires: undefined,
            maxAge: undefined,
            secure: undefined,
            httpOnly: undefined,
            sameSite: undefined,
            creationDate: Date.now()
        };
        const unparsed = cookieStr.slice().trim();
        const attrAndValueList = unparsed.split(";");
        const keyValuePairString = trimTerminator(attrAndValueList.shift() || "").trim();
        const keyValuePairEqualsIndex = keyValuePairString.indexOf("=");
        if (keyValuePairEqualsIndex < 0) {
            return new Cookie();
        }
        const name = keyValuePairString.slice(0, keyValuePairEqualsIndex);
        const value = trimWrappingDoubleQuotes(keyValuePairString.slice(keyValuePairEqualsIndex + 1));
        if (!(isValidName(name) && isValidValue(value))) {
            return new Cookie();
        }
        options.name = name;
        options.value = value;
        while(attrAndValueList.length){
            const cookieAV = attrAndValueList.shift()?.trim();
            if (!cookieAV) {
                continue;
            }
            const avSeperatorIndex = cookieAV.indexOf("=");
            let attrKey, attrValue;
            if (avSeperatorIndex === -1) {
                attrKey = cookieAV;
                attrValue = "";
            } else {
                attrKey = cookieAV.substr(0, avSeperatorIndex);
                attrValue = cookieAV.substr(avSeperatorIndex + 1);
            }
            attrKey = attrKey.trim().toLowerCase();
            if (attrValue) {
                attrValue = attrValue.trim();
            }
            switch(attrKey){
                case "expires":
                    if (attrValue) {
                        const expires = new Date(attrValue).getTime();
                        if (expires && !isNaN(expires)) {
                            options.expires = expires;
                        }
                    }
                    break;
                case "max-age":
                    if (attrValue) {
                        const maxAge = parseInt(attrValue, 10);
                        if (!isNaN(maxAge)) {
                            options.maxAge = maxAge;
                        }
                    }
                    break;
                case "domain":
                    if (attrValue) {
                        const domain = parseURL(attrValue).host;
                        if (domain) {
                            options.domain = domain;
                        }
                    }
                    break;
                case "path":
                    if (attrValue) {
                        options.path = attrValue.startsWith("/") ? attrValue : "/" + attrValue;
                    }
                    break;
                case "secure":
                    options.secure = true;
                    break;
                case "httponly":
                    options.httpOnly = true;
                    break;
                case "samesite":
                    {
                        const lowerCasedSameSite = attrValue.toLowerCase();
                        switch(lowerCasedSameSite){
                            case "strict":
                                options.sameSite = "Strict";
                                break;
                            case "lax":
                                options.sameSite = "Lax";
                                break;
                            case "none":
                                options.sameSite = "None";
                                break;
                            default:
                                break;
                        }
                        break;
                    }
                default:
                    break;
            }
        }
        return new Cookie(options);
    }
    isValid() {
        return isValidName(this.name) && isValidValue(this.value);
    }
    canSendTo(url) {
        const urlObj = parseURL(url);
        if (this.secure && urlObj.protocol !== "https:") {
            return false;
        }
        if (this.sameSite === "None" && !this.secure) return false;
        if (this.path) {
            if (this.path === urlObj.pathname) {
                return true;
            }
            if (urlObj.pathname.startsWith(this.path) && this.path[this.path.length - 1] === "/") {
                return true;
            }
            if (this.path.length < urlObj.pathname.length && urlObj.pathname.startsWith(this.path) && urlObj.pathname[this.path.length] === "/") {
                return true;
            }
            return false;
        }
        if (this.domain) {
            const host = urlObj.host;
            if (isSameDomainOrSubdomain(this.domain, host)) {
                return true;
            }
        }
        return false;
    }
    getCookieString() {
        return `${this.name || ""}=${this.value || ""}`;
    }
    setDomain(url) {
        this.domain = parseURL(url).host;
    }
    setPath(url) {
        const uriPath = parseURL(url).pathname;
        if (!uriPath || uriPath[0] !== "/") {
            this.path = "/";
        } else {
            const rightmostSlashIdx = uriPath.lastIndexOf("/");
            if (rightmostSlashIdx <= 0) {
                this.path = "/";
            } else {
                this.path = uriPath.slice(0, rightmostSlashIdx);
            }
        }
    }
    setExpires(exp) {
        if (exp instanceof Date) {
            this.expires = exp.getTime();
        } else if (typeof exp === "number" && exp >= 0) {
            this.expires = exp;
        }
    }
    isExpired() {
        if (this.maxAge !== undefined) {
            if (Date.now() - this.creationDate >= this.maxAge * 1000) {
                return true;
            }
        }
        if (this.expires !== undefined) {
            if (Date.now() - this.expires >= 0) {
                return true;
            }
        }
        return false;
    }
    toString() {
        let str = this.getCookieString();
        if (this.expires && this.expires !== Infinity) {
            str += "; Expires=" + new Date(this.expires).toUTCString();
        }
        if (this.maxAge && this.maxAge !== Infinity) {
            str += `; Max-Age=${this.maxAge}`;
        }
        if (this.domain) {
            str += `; Domain=${this.domain}`;
        }
        if (this.path) {
            str += `; Path=${this.path}`;
        }
        if (this.secure) {
            str += "; Secure";
        }
        if (this.httpOnly) {
            str += "; HttpOnly";
        }
        if (this.sameSite) {
            str += `; SameSite=${this.sameSite}`;
        }
        return str;
    }
    clone() {
        return new Cookie(JSON.parse(JSON.stringify(this)));
    }
}
const strictMatchProps = [
    "value",
    "secure",
    "httpOnly",
    "maxAge",
    "expires",
    "sameSite"
];
function cookieMatches(options, comparedWith, strictMatch = false) {
    if (options.path !== undefined && !comparedWith.path?.startsWith(options.path)) {
        return false;
    }
    if (options.domain) {
        if (!isSameDomainOrSubdomain(options.domain, comparedWith.domain)) {
            return false;
        }
    }
    if (options.name !== undefined && options.name !== comparedWith.name) {
        return false;
    }
    if (strictMatch && strictMatchProps.some((propKey)=>options[propKey] !== undefined && options[propKey] !== comparedWith[propKey])) {
        return false;
    }
    return true;
}
function cookieCompare(a, b) {
    let cmp = 0;
    const aPathLen = a.path?.length || 0;
    const bPathLen = b.path?.length || 0;
    cmp = bPathLen - aPathLen;
    if (cmp !== 0) {
        return cmp;
    }
    const aTime = a.creationDate || 2147483647000;
    const bTime = b.creationDate || 2147483647000;
    cmp = aTime - bTime;
    if (cmp !== 0) {
        return cmp;
    }
    cmp = a.creationIndex - b.creationIndex;
    return cmp;
}
class CookieJar {
    cookies = Array();
    constructor(cookies){
        this.replaceCookies(cookies);
    }
    setCookie(cookie, url) {
        let cookieObj;
        if (typeof cookie === "string") {
            cookieObj = Cookie.from(cookie);
        } else {
            cookieObj = cookie;
        }
        if (url) {
            if (!cookieObj.domain) {
                cookieObj.setDomain(url);
            }
            if (!cookieObj.path) {
                cookieObj.setPath(url);
            }
        }
        if (!cookieObj.isValid()) {
            return;
        }
        const foundCookie = this.getCookie(cookieObj);
        if (foundCookie) {
            const indexOfCookie = this.cookies.indexOf(foundCookie);
            if (!cookieObj.isExpired()) {
                this.cookies.splice(indexOfCookie, 1, cookieObj);
            } else {
                this.cookies.splice(indexOfCookie, 1);
            }
        } else if (!cookieObj.isExpired()) {
            this.cookies.push(cookieObj);
        }
        this.cookies.sort(cookieCompare);
    }
    getCookie(options) {
        const strictMatch = typeof options.isValid !== "function";
        for (const [index, cookie] of this.cookies.entries()){
            if (cookieMatches(options, cookie, strictMatch)) {
                if (!cookie.isExpired()) {
                    return cookie;
                } else {
                    this.cookies.splice(index, 1);
                    return undefined;
                }
            }
        }
    }
    getCookies(options) {
        if (options) {
            const matchedCookies = [];
            const removeCookies = [];
            for (const cookie of this.cookies){
                if (cookieMatches(options, cookie)) {
                    if (!cookie.isExpired()) {
                        matchedCookies.push(cookie);
                    } else {
                        removeCookies.push(cookie);
                    }
                }
            }
            if (removeCookies.length) {
                this.cookies = this.cookies.filter((cookie)=>!removeCookies.includes(cookie));
            }
            return matchedCookies;
        } else {
            return this.cookies;
        }
    }
    getCookieString(url) {
        const searchCookie = new Cookie();
        searchCookie.setDomain(url);
        const cookiesToSend = this.getCookies(searchCookie).filter((cookie)=>{
            return cookie.canSendTo(parseURL(url));
        }).map((c)=>c.getCookieString()).join("; ");
        return cookiesToSend;
    }
    toJSON() {
        return this.cookies;
    }
    removeCookie(options) {
        for (const [index, cookie] of this.cookies.entries()){
            if (cookieMatches(options, cookie)) {
                return this.cookies.splice(index, 1)[0];
            }
        }
    }
    removeCookies(options) {
        if (options) {
            const deletedCookies = [];
            this.cookies = this.cookies.filter((cookie)=>{
                if (cookieMatches(options, cookie)) {
                    deletedCookies.push(cookie);
                    return false;
                }
                return true;
            });
            return deletedCookies.length ? deletedCookies : undefined;
        } else {
            this.cookies = [];
        }
    }
    replaceCookies(cookies) {
        if (cookies?.length) {
            if (typeof cookies[0].isValid === "function") {
                this.cookies = cookies;
            } else {
                this.cookies = [];
                for (const option of cookies){
                    this.cookies.push(new Cookie(option));
                }
            }
        } else {
            this.cookies = [];
        }
    }
}
function wrapFetch(options) {
    const { cookieJar =new CookieJar() , fetch =globalThis.fetch  } = options || {};
    async function wrappedFetch(input, init) {
        if (!input) {
            return await fetch(input);
        }
        const cookieString = cookieJar.getCookieString(input);
        let interceptedInit;
        if (init) {
            interceptedInit = init;
        } else if (input instanceof Request) {
            interceptedInit = input;
        } else {
            interceptedInit = {};
        }
        if (!(interceptedInit.headers instanceof Headers)) {
            interceptedInit.headers = new Headers(interceptedInit.headers || {});
        }
        interceptedInit.headers.set("cookie", cookieString);
        const response = await fetch(input, interceptedInit);
        response.headers.forEach((value, key)=>{
            if (key.toLowerCase() === "set-cookie") {
                cookieJar.setCookie(value, input);
            }
        });
        return response;
    }
    return wrappedFetch;
}
const base64abc = [
    "A",
    "B",
    "C",
    "D",
    "E",
    "F",
    "G",
    "H",
    "I",
    "J",
    "K",
    "L",
    "M",
    "N",
    "O",
    "P",
    "Q",
    "R",
    "S",
    "T",
    "U",
    "V",
    "W",
    "X",
    "Y",
    "Z",
    "a",
    "b",
    "c",
    "d",
    "e",
    "f",
    "g",
    "h",
    "i",
    "j",
    "k",
    "l",
    "m",
    "n",
    "o",
    "p",
    "q",
    "r",
    "s",
    "t",
    "u",
    "v",
    "w",
    "x",
    "y",
    "z",
    "0",
    "1",
    "2",
    "3",
    "4",
    "5",
    "6",
    "7",
    "8",
    "9",
    "+",
    "/"
];
function encode(data) {
    const uint8 = typeof data === "string" ? new TextEncoder().encode(data) : data instanceof Uint8Array ? data : new Uint8Array(data);
    let result = "", i;
    const l = uint8.length;
    for(i = 2; i < l; i += 3){
        result += base64abc[uint8[i - 2] >> 2];
        result += base64abc[(uint8[i - 2] & 0x03) << 4 | uint8[i - 1] >> 4];
        result += base64abc[(uint8[i - 1] & 0x0f) << 2 | uint8[i] >> 6];
        result += base64abc[uint8[i] & 0x3f];
    }
    if (i === l + 1) {
        result += base64abc[uint8[i - 2] >> 2];
        result += base64abc[(uint8[i - 2] & 0x03) << 4];
        result += "==";
    }
    if (i === l) {
        result += base64abc[uint8[i - 2] >> 2];
        result += base64abc[(uint8[i - 2] & 0x03) << 4 | uint8[i - 1] >> 4];
        result += base64abc[(uint8[i - 1] & 0x0f) << 2];
        result += "=";
    }
    return result;
}
function decode(b64) {
    const binString = atob(b64);
    const size = binString.length;
    const bytes = new Uint8Array(size);
    for(let i = 0; i < size; i++){
        bytes[i] = binString.charCodeAt(i);
    }
    return bytes;
}
const mod = {
    encode: encode,
    decode: decode
};
class DenoStdInternalError extends Error {
    constructor(message){
        super(message);
        this.name = "DenoStdInternalError";
    }
}
function assert(expr, msg = "") {
    if (!expr) {
        throw new DenoStdInternalError(msg);
    }
}
const { hasOwn  } = Object;
function get(obj, key) {
    if (hasOwn(obj, key)) {
        return obj[key];
    }
}
function getForce(obj, key) {
    const v = get(obj, key);
    assert(v != null);
    return v;
}
function isNumber(x) {
    if (typeof x === "number") return true;
    if (/^0x[0-9a-f]+$/i.test(String(x))) return true;
    return /^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(String(x));
}
function hasKey(obj, keys) {
    let o = obj;
    keys.slice(0, -1).forEach((key)=>{
        o = get(o, key) ?? {};
    });
    const key = keys[keys.length - 1];
    return hasOwn(o, key);
}
function parse(args, { "--": doubleDash = false , alias ={} , boolean: __boolean = false , default: defaults = {} , stopEarly =false , string =[] , collect =[] , negatable =[] , unknown =(i)=>i  } = {}) {
    const flags = {
        bools: {},
        strings: {},
        unknownFn: unknown,
        allBools: false,
        collect: {},
        negatable: {}
    };
    if (__boolean !== undefined) {
        if (typeof __boolean === "boolean") {
            flags.allBools = !!__boolean;
        } else {
            const booleanArgs = typeof __boolean === "string" ? [
                __boolean
            ] : __boolean;
            for (const key of booleanArgs.filter(Boolean)){
                flags.bools[key] = true;
            }
        }
    }
    const aliases = {};
    if (alias !== undefined) {
        for(const key in alias){
            const val = getForce(alias, key);
            if (typeof val === "string") {
                aliases[key] = [
                    val
                ];
            } else {
                aliases[key] = val;
            }
            for (const alias of getForce(aliases, key)){
                aliases[alias] = [
                    key
                ].concat(aliases[key].filter((y)=>alias !== y));
            }
        }
    }
    if (string !== undefined) {
        const stringArgs = typeof string === "string" ? [
            string
        ] : string;
        for (const key of stringArgs.filter(Boolean)){
            flags.strings[key] = true;
            const alias = get(aliases, key);
            if (alias) {
                for (const al of alias){
                    flags.strings[al] = true;
                }
            }
        }
    }
    if (collect !== undefined) {
        const collectArgs = typeof collect === "string" ? [
            collect
        ] : collect;
        for (const key of collectArgs.filter(Boolean)){
            flags.collect[key] = true;
            const alias = get(aliases, key);
            if (alias) {
                for (const al of alias){
                    flags.collect[al] = true;
                }
            }
        }
    }
    if (negatable !== undefined) {
        const negatableArgs = typeof negatable === "string" ? [
            negatable
        ] : negatable;
        for (const key of negatableArgs.filter(Boolean)){
            flags.negatable[key] = true;
            const alias = get(aliases, key);
            if (alias) {
                for (const al of alias){
                    flags.negatable[al] = true;
                }
            }
        }
    }
    const argv = {
        _: []
    };
    function argDefined(key, arg) {
        return flags.allBools && /^--[^=]+$/.test(arg) || get(flags.bools, key) || !!get(flags.strings, key) || !!get(aliases, key);
    }
    function setKey(obj, name, value, collect = true) {
        let o = obj;
        const keys = name.split(".");
        keys.slice(0, -1).forEach(function(key) {
            if (get(o, key) === undefined) {
                o[key] = {};
            }
            o = get(o, key);
        });
        const key = keys[keys.length - 1];
        const collectable = collect && !!get(flags.collect, name);
        if (!collectable) {
            o[key] = value;
        } else if (get(o, key) === undefined) {
            o[key] = [
                value
            ];
        } else if (Array.isArray(get(o, key))) {
            o[key].push(value);
        } else {
            o[key] = [
                get(o, key),
                value
            ];
        }
    }
    function setArg(key, val, arg = undefined, collect) {
        if (arg && flags.unknownFn && !argDefined(key, arg)) {
            if (flags.unknownFn(arg, key, val) === false) return;
        }
        const value = !get(flags.strings, key) && isNumber(val) ? Number(val) : val;
        setKey(argv, key, value, collect);
        const alias = get(aliases, key);
        if (alias) {
            for (const x of alias){
                setKey(argv, x, value, collect);
            }
        }
    }
    function aliasIsBoolean(key) {
        return getForce(aliases, key).some((x)=>typeof get(flags.bools, x) === "boolean");
    }
    let notFlags = [];
    if (args.includes("--")) {
        notFlags = args.slice(args.indexOf("--") + 1);
        args = args.slice(0, args.indexOf("--"));
    }
    for(let i = 0; i < args.length; i++){
        const arg = args[i];
        if (/^--.+=/.test(arg)) {
            const m = arg.match(/^--([^=]+)=(.*)$/s);
            assert(m != null);
            const [, key, value] = m;
            if (flags.bools[key]) {
                const booleanValue = value !== "false";
                setArg(key, booleanValue, arg);
            } else {
                setArg(key, value, arg);
            }
        } else if (/^--no-.+/.test(arg) && get(flags.negatable, arg.replace(/^--no-/, ""))) {
            const m = arg.match(/^--no-(.+)/);
            assert(m != null);
            setArg(m[1], false, arg, false);
        } else if (/^--.+/.test(arg)) {
            const m = arg.match(/^--(.+)/);
            assert(m != null);
            const [, key] = m;
            const next = args[i + 1];
            if (next !== undefined && !/^-/.test(next) && !get(flags.bools, key) && !flags.allBools && (get(aliases, key) ? !aliasIsBoolean(key) : true)) {
                setArg(key, next, arg);
                i++;
            } else if (/^(true|false)$/.test(next)) {
                setArg(key, next === "true", arg);
                i++;
            } else {
                setArg(key, get(flags.strings, key) ? "" : true, arg);
            }
        } else if (/^-[^-]+/.test(arg)) {
            const letters = arg.slice(1, -1).split("");
            let broken = false;
            for(let j = 0; j < letters.length; j++){
                const next = arg.slice(j + 2);
                if (next === "-") {
                    setArg(letters[j], next, arg);
                    continue;
                }
                if (/[A-Za-z]/.test(letters[j]) && /=/.test(next)) {
                    setArg(letters[j], next.split(/=(.+)/)[1], arg);
                    broken = true;
                    break;
                }
                if (/[A-Za-z]/.test(letters[j]) && /-?\d+(\.\d*)?(e-?\d+)?$/.test(next)) {
                    setArg(letters[j], next, arg);
                    broken = true;
                    break;
                }
                if (letters[j + 1] && letters[j + 1].match(/\W/)) {
                    setArg(letters[j], arg.slice(j + 2), arg);
                    broken = true;
                    break;
                } else {
                    setArg(letters[j], get(flags.strings, letters[j]) ? "" : true, arg);
                }
            }
            const [key] = arg.slice(-1);
            if (!broken && key !== "-") {
                if (args[i + 1] && !/^(-|--)[^-]/.test(args[i + 1]) && !get(flags.bools, key) && (get(aliases, key) ? !aliasIsBoolean(key) : true)) {
                    setArg(key, args[i + 1], arg);
                    i++;
                } else if (args[i + 1] && /^(true|false)$/.test(args[i + 1])) {
                    setArg(key, args[i + 1] === "true", arg);
                    i++;
                } else {
                    setArg(key, get(flags.strings, key) ? "" : true, arg);
                }
            }
        } else {
            if (!flags.unknownFn || flags.unknownFn(arg) !== false) {
                argv._.push(flags.strings["_"] ?? !isNumber(arg) ? arg : Number(arg));
            }
            if (stopEarly) {
                argv._.push(...args.slice(i + 1));
                break;
            }
        }
    }
    for (const [key, value] of Object.entries(defaults)){
        if (!hasKey(argv, key.split("."))) {
            setKey(argv, key, value);
            if (aliases[key]) {
                for (const x of aliases[key]){
                    setKey(argv, x, value);
                }
            }
        }
    }
    for (const key of Object.keys(flags.bools)){
        if (!hasKey(argv, key.split("."))) {
            const value = get(flags.collect, key) ? [] : false;
            setKey(argv, key, value, false);
        }
    }
    for (const key of Object.keys(flags.strings)){
        if (!hasKey(argv, key.split(".")) && get(flags.collect, key)) {
            setKey(argv, key, [], false);
        }
    }
    if (doubleDash) {
        argv["--"] = [];
        for (const key of notFlags){
            argv["--"].push(key);
        }
    } else {
        for (const key of notFlags){
            argv._.push(key);
        }
    }
    return argv;
}
const mod1 = {
    parse: parse
};
class BytesList {
    #len = 0;
    #chunks = [];
    constructor(){}
    size() {
        return this.#len;
    }
    add(value, start = 0, end = value.byteLength) {
        if (value.byteLength === 0 || end - start === 0) {
            return;
        }
        checkRange(start, end, value.byteLength);
        this.#chunks.push({
            value,
            end,
            start,
            offset: this.#len
        });
        this.#len += end - start;
    }
    shift(n) {
        if (n === 0) {
            return;
        }
        if (this.#len <= n) {
            this.#chunks = [];
            this.#len = 0;
            return;
        }
        const idx = this.getChunkIndex(n);
        this.#chunks.splice(0, idx);
        const [chunk] = this.#chunks;
        if (chunk) {
            const diff = n - chunk.offset;
            chunk.start += diff;
        }
        let offset = 0;
        for (const chunk of this.#chunks){
            chunk.offset = offset;
            offset += chunk.end - chunk.start;
        }
        this.#len = offset;
    }
    getChunkIndex(pos) {
        let max = this.#chunks.length;
        let min = 0;
        while(true){
            const i = min + Math.floor((max - min) / 2);
            if (i < 0 || this.#chunks.length <= i) {
                return -1;
            }
            const { offset , start , end  } = this.#chunks[i];
            const len = end - start;
            if (offset <= pos && pos < offset + len) {
                return i;
            } else if (offset + len <= pos) {
                min = i + 1;
            } else {
                max = i - 1;
            }
        }
    }
    get(i) {
        if (i < 0 || this.#len <= i) {
            throw new Error("out of range");
        }
        const idx = this.getChunkIndex(i);
        const { value , offset , start  } = this.#chunks[idx];
        return value[start + i - offset];
    }
    *iterator(start = 0) {
        const startIdx = this.getChunkIndex(start);
        if (startIdx < 0) return;
        const first = this.#chunks[startIdx];
        let firstOffset = start - first.offset;
        for(let i = startIdx; i < this.#chunks.length; i++){
            const chunk = this.#chunks[i];
            for(let j = chunk.start + firstOffset; j < chunk.end; j++){
                yield chunk.value[j];
            }
            firstOffset = 0;
        }
    }
    slice(start, end = this.#len) {
        if (end === start) {
            return new Uint8Array();
        }
        checkRange(start, end, this.#len);
        const result = new Uint8Array(end - start);
        const startIdx = this.getChunkIndex(start);
        const endIdx = this.getChunkIndex(end - 1);
        let written = 0;
        for(let i = startIdx; i < endIdx; i++){
            const chunk = this.#chunks[i];
            const len = chunk.end - chunk.start;
            result.set(chunk.value.subarray(chunk.start, chunk.end), written);
            written += len;
        }
        const last = this.#chunks[endIdx];
        const rest = end - start - written;
        result.set(last.value.subarray(last.start, last.start + rest), written);
        return result;
    }
    concat() {
        const result = new Uint8Array(this.#len);
        let sum = 0;
        for (const { value , start , end  } of this.#chunks){
            result.set(value.subarray(start, end), sum);
            sum += end - start;
        }
        return result;
    }
}
function checkRange(start, end, len) {
    if (start < 0 || len < start || end < 0 || len < end || end < start) {
        throw new Error("invalid range");
    }
}
function concat(...buf) {
    let length = 0;
    for (const b of buf){
        length += b.length;
    }
    const output = new Uint8Array(length);
    let index = 0;
    for (const b of buf){
        output.set(b, index);
        index += b.length;
    }
    return output;
}
function copy(src, dst, off = 0) {
    off = Math.max(0, Math.min(off, dst.byteLength));
    const dstBytesAvailable = dst.byteLength - off;
    if (src.byteLength > dstBytesAvailable) {
        src = src.subarray(0, dstBytesAvailable);
    }
    dst.set(src, off);
    return src.byteLength;
}
const MIN_READ = 32 * 1024;
const MAX_SIZE = 2 ** 32 - 2;
class Buffer {
    #buf;
    #off = 0;
    constructor(ab){
        this.#buf = ab === undefined ? new Uint8Array(0) : new Uint8Array(ab);
    }
    bytes(options = {
        copy: true
    }) {
        if (options.copy === false) return this.#buf.subarray(this.#off);
        return this.#buf.slice(this.#off);
    }
    empty() {
        return this.#buf.byteLength <= this.#off;
    }
    get length() {
        return this.#buf.byteLength - this.#off;
    }
    get capacity() {
        return this.#buf.buffer.byteLength;
    }
    truncate(n) {
        if (n === 0) {
            this.reset();
            return;
        }
        if (n < 0 || n > this.length) {
            throw Error("bytes.Buffer: truncation out of range");
        }
        this.#reslice(this.#off + n);
    }
    reset() {
        this.#reslice(0);
        this.#off = 0;
    }
    #tryGrowByReslice(n) {
        const l = this.#buf.byteLength;
        if (n <= this.capacity - l) {
            this.#reslice(l + n);
            return l;
        }
        return -1;
    }
    #reslice(len) {
        assert(len <= this.#buf.buffer.byteLength);
        this.#buf = new Uint8Array(this.#buf.buffer, 0, len);
    }
    readSync(p) {
        if (this.empty()) {
            this.reset();
            if (p.byteLength === 0) {
                return 0;
            }
            return null;
        }
        const nread = copy(this.#buf.subarray(this.#off), p);
        this.#off += nread;
        return nread;
    }
    read(p) {
        const rr = this.readSync(p);
        return Promise.resolve(rr);
    }
    writeSync(p) {
        const m = this.#grow(p.byteLength);
        return copy(p, this.#buf, m);
    }
    write(p) {
        const n = this.writeSync(p);
        return Promise.resolve(n);
    }
    #grow(n1) {
        const m = this.length;
        if (m === 0 && this.#off !== 0) {
            this.reset();
        }
        const i = this.#tryGrowByReslice(n1);
        if (i >= 0) {
            return i;
        }
        const c = this.capacity;
        if (n1 <= Math.floor(c / 2) - m) {
            copy(this.#buf.subarray(this.#off), this.#buf);
        } else if (c + n1 > MAX_SIZE) {
            throw new Error("The buffer cannot be grown beyond the maximum size.");
        } else {
            const buf = new Uint8Array(Math.min(2 * c + n1, MAX_SIZE));
            copy(this.#buf.subarray(this.#off), buf);
            this.#buf = buf;
        }
        this.#off = 0;
        this.#reslice(Math.min(m + n1, MAX_SIZE));
        return m;
    }
    grow(n) {
        if (n < 0) {
            throw Error("Buffer.grow: negative count");
        }
        const m = this.#grow(n);
        this.#reslice(m);
    }
    async readFrom(r) {
        let n = 0;
        const tmp = new Uint8Array(MIN_READ);
        while(true){
            const shouldGrow = this.capacity - this.length < MIN_READ;
            const buf = shouldGrow ? tmp : new Uint8Array(this.#buf.buffer, this.length);
            const nread = await r.read(buf);
            if (nread === null) {
                return n;
            }
            if (shouldGrow) this.writeSync(buf.subarray(0, nread));
            else this.#reslice(this.length + nread);
            n += nread;
        }
    }
    readFromSync(r) {
        let n = 0;
        const tmp = new Uint8Array(MIN_READ);
        while(true){
            const shouldGrow = this.capacity - this.length < MIN_READ;
            const buf = shouldGrow ? tmp : new Uint8Array(this.#buf.buffer, this.length);
            const nread = r.readSync(buf);
            if (nread === null) {
                return n;
            }
            if (shouldGrow) this.writeSync(buf.subarray(0, nread));
            else this.#reslice(this.length + nread);
            n += nread;
        }
    }
}
const MIN_BUF_SIZE = 16;
const CR = "\r".charCodeAt(0);
const LF = "\n".charCodeAt(0);
class BufferFullError extends Error {
    partial;
    name;
    constructor(partial){
        super("Buffer full");
        this.partial = partial;
        this.name = "BufferFullError";
    }
}
class PartialReadError extends Error {
    name = "PartialReadError";
    partial;
    constructor(){
        super("Encountered UnexpectedEof, data only partially read");
    }
}
class BufReader {
    #buf;
    #rd;
    #r = 0;
    #w = 0;
    #eof = false;
    static create(r, size = 4096) {
        return r instanceof BufReader ? r : new BufReader(r, size);
    }
    constructor(rd, size = 4096){
        if (size < 16) {
            size = MIN_BUF_SIZE;
        }
        this.#reset(new Uint8Array(size), rd);
    }
    size() {
        return this.#buf.byteLength;
    }
    buffered() {
        return this.#w - this.#r;
    }
    #fill = async ()=>{
        if (this.#r > 0) {
            this.#buf.copyWithin(0, this.#r, this.#w);
            this.#w -= this.#r;
            this.#r = 0;
        }
        if (this.#w >= this.#buf.byteLength) {
            throw Error("bufio: tried to fill full buffer");
        }
        for(let i = 100; i > 0; i--){
            const rr = await this.#rd.read(this.#buf.subarray(this.#w));
            if (rr === null) {
                this.#eof = true;
                return;
            }
            assert(rr >= 0, "negative read");
            this.#w += rr;
            if (rr > 0) {
                return;
            }
        }
        throw new Error(`No progress after ${100} read() calls`);
    };
    reset(r) {
        this.#reset(this.#buf, r);
    }
    #reset = (buf, rd)=>{
        this.#buf = buf;
        this.#rd = rd;
        this.#eof = false;
    };
    async read(p) {
        let rr = p.byteLength;
        if (p.byteLength === 0) return rr;
        if (this.#r === this.#w) {
            if (p.byteLength >= this.#buf.byteLength) {
                const rr = await this.#rd.read(p);
                const nread = rr ?? 0;
                assert(nread >= 0, "negative read");
                return rr;
            }
            this.#r = 0;
            this.#w = 0;
            rr = await this.#rd.read(this.#buf);
            if (rr === 0 || rr === null) return rr;
            assert(rr >= 0, "negative read");
            this.#w += rr;
        }
        const copied = copy(this.#buf.subarray(this.#r, this.#w), p, 0);
        this.#r += copied;
        return copied;
    }
    async readFull(p) {
        let bytesRead = 0;
        while(bytesRead < p.length){
            try {
                const rr = await this.read(p.subarray(bytesRead));
                if (rr === null) {
                    if (bytesRead === 0) {
                        return null;
                    } else {
                        throw new PartialReadError();
                    }
                }
                bytesRead += rr;
            } catch (err) {
                if (err instanceof PartialReadError) {
                    err.partial = p.subarray(0, bytesRead);
                } else if (err instanceof Error) {
                    const e = new PartialReadError();
                    e.partial = p.subarray(0, bytesRead);
                    e.stack = err.stack;
                    e.message = err.message;
                    e.cause = err.cause;
                    throw err;
                }
                throw err;
            }
        }
        return p;
    }
    async readByte() {
        while(this.#r === this.#w){
            if (this.#eof) return null;
            await this.#fill();
        }
        const c = this.#buf[this.#r];
        this.#r++;
        return c;
    }
    async readString(delim) {
        if (delim.length !== 1) {
            throw new Error("Delimiter should be a single character");
        }
        const buffer = await this.readSlice(delim.charCodeAt(0));
        if (buffer === null) return null;
        return new TextDecoder().decode(buffer);
    }
    async readLine() {
        let line = null;
        try {
            line = await this.readSlice(LF);
        } catch (err) {
            let partial;
            if (err instanceof PartialReadError) {
                partial = err.partial;
                assert(partial instanceof Uint8Array, "bufio: caught error from `readSlice()` without `partial` property");
            }
            if (!(err instanceof BufferFullError)) {
                throw err;
            }
            partial = err.partial;
            if (!this.#eof && partial && partial.byteLength > 0 && partial[partial.byteLength - 1] === CR) {
                assert(this.#r > 0, "bufio: tried to rewind past start of buffer");
                this.#r--;
                partial = partial.subarray(0, partial.byteLength - 1);
            }
            if (partial) {
                return {
                    line: partial,
                    more: !this.#eof
                };
            }
        }
        if (line === null) {
            return null;
        }
        if (line.byteLength === 0) {
            return {
                line,
                more: false
            };
        }
        if (line[line.byteLength - 1] == LF) {
            let drop = 1;
            if (line.byteLength > 1 && line[line.byteLength - 2] === CR) {
                drop = 2;
            }
            line = line.subarray(0, line.byteLength - drop);
        }
        return {
            line,
            more: false
        };
    }
    async readSlice(delim) {
        let s = 0;
        let slice;
        while(true){
            let i = this.#buf.subarray(this.#r + s, this.#w).indexOf(delim);
            if (i >= 0) {
                i += s;
                slice = this.#buf.subarray(this.#r, this.#r + i + 1);
                this.#r += i + 1;
                break;
            }
            if (this.#eof) {
                if (this.#r === this.#w) {
                    return null;
                }
                slice = this.#buf.subarray(this.#r, this.#w);
                this.#r = this.#w;
                break;
            }
            if (this.buffered() >= this.#buf.byteLength) {
                this.#r = this.#w;
                const oldbuf = this.#buf;
                const newbuf = this.#buf.slice(0);
                this.#buf = newbuf;
                throw new BufferFullError(oldbuf);
            }
            s = this.#w - this.#r;
            try {
                await this.#fill();
            } catch (err) {
                if (err instanceof PartialReadError) {
                    err.partial = slice;
                } else if (err instanceof Error) {
                    const e = new PartialReadError();
                    e.partial = slice;
                    e.stack = err.stack;
                    e.message = err.message;
                    e.cause = err.cause;
                    throw err;
                }
                throw err;
            }
        }
        return slice;
    }
    async peek(n) {
        if (n < 0) {
            throw Error("negative count");
        }
        let avail = this.#w - this.#r;
        while(avail < n && avail < this.#buf.byteLength && !this.#eof){
            try {
                await this.#fill();
            } catch (err) {
                if (err instanceof PartialReadError) {
                    err.partial = this.#buf.subarray(this.#r, this.#w);
                } else if (err instanceof Error) {
                    const e = new PartialReadError();
                    e.partial = this.#buf.subarray(this.#r, this.#w);
                    e.stack = err.stack;
                    e.message = err.message;
                    e.cause = err.cause;
                    throw err;
                }
                throw err;
            }
            avail = this.#w - this.#r;
        }
        if (avail === 0 && this.#eof) {
            return null;
        } else if (avail < n && this.#eof) {
            return this.#buf.subarray(this.#r, this.#r + avail);
        } else if (avail < n) {
            throw new BufferFullError(this.#buf.subarray(this.#r, this.#w));
        }
        return this.#buf.subarray(this.#r, this.#r + n);
    }
}
class AbstractBufBase {
    buf;
    usedBufferBytes = 0;
    err = null;
    constructor(buf){
        this.buf = buf;
    }
    size() {
        return this.buf.byteLength;
    }
    available() {
        return this.buf.byteLength - this.usedBufferBytes;
    }
    buffered() {
        return this.usedBufferBytes;
    }
}
class BufWriter extends AbstractBufBase {
    #writer;
    static create(writer, size = 4096) {
        return writer instanceof BufWriter ? writer : new BufWriter(writer, size);
    }
    constructor(writer, size = 4096){
        super(new Uint8Array(size <= 0 ? 4096 : size));
        this.#writer = writer;
    }
    reset(w) {
        this.err = null;
        this.usedBufferBytes = 0;
        this.#writer = w;
    }
    async flush() {
        if (this.err !== null) throw this.err;
        if (this.usedBufferBytes === 0) return;
        try {
            const p = this.buf.subarray(0, this.usedBufferBytes);
            let nwritten = 0;
            while(nwritten < p.length){
                nwritten += await this.#writer.write(p.subarray(nwritten));
            }
        } catch (e) {
            if (e instanceof Error) {
                this.err = e;
            }
            throw e;
        }
        this.buf = new Uint8Array(this.buf.length);
        this.usedBufferBytes = 0;
    }
    async write(data) {
        if (this.err !== null) throw this.err;
        if (data.length === 0) return 0;
        let totalBytesWritten = 0;
        let numBytesWritten = 0;
        while(data.byteLength > this.available()){
            if (this.buffered() === 0) {
                try {
                    numBytesWritten = await this.#writer.write(data);
                } catch (e) {
                    if (e instanceof Error) {
                        this.err = e;
                    }
                    throw e;
                }
            } else {
                numBytesWritten = copy(data, this.buf, this.usedBufferBytes);
                this.usedBufferBytes += numBytesWritten;
                await this.flush();
            }
            totalBytesWritten += numBytesWritten;
            data = data.subarray(numBytesWritten);
        }
        numBytesWritten = copy(data, this.buf, this.usedBufferBytes);
        this.usedBufferBytes += numBytesWritten;
        totalBytesWritten += numBytesWritten;
        return totalBytesWritten;
    }
}
class BufWriterSync extends AbstractBufBase {
    #writer;
    static create(writer, size = 4096) {
        return writer instanceof BufWriterSync ? writer : new BufWriterSync(writer, size);
    }
    constructor(writer, size = 4096){
        super(new Uint8Array(size <= 0 ? 4096 : size));
        this.#writer = writer;
    }
    reset(w) {
        this.err = null;
        this.usedBufferBytes = 0;
        this.#writer = w;
    }
    flush() {
        if (this.err !== null) throw this.err;
        if (this.usedBufferBytes === 0) return;
        try {
            const p = this.buf.subarray(0, this.usedBufferBytes);
            let nwritten = 0;
            while(nwritten < p.length){
                nwritten += this.#writer.writeSync(p.subarray(nwritten));
            }
        } catch (e) {
            if (e instanceof Error) {
                this.err = e;
            }
            throw e;
        }
        this.buf = new Uint8Array(this.buf.length);
        this.usedBufferBytes = 0;
    }
    writeSync(data) {
        if (this.err !== null) throw this.err;
        if (data.length === 0) return 0;
        let totalBytesWritten = 0;
        let numBytesWritten = 0;
        while(data.byteLength > this.available()){
            if (this.buffered() === 0) {
                try {
                    numBytesWritten = this.#writer.writeSync(data);
                } catch (e) {
                    if (e instanceof Error) {
                        this.err = e;
                    }
                    throw e;
                }
            } else {
                numBytesWritten = copy(data, this.buf, this.usedBufferBytes);
                this.usedBufferBytes += numBytesWritten;
                this.flush();
            }
            totalBytesWritten += numBytesWritten;
            data = data.subarray(numBytesWritten);
        }
        numBytesWritten = copy(data, this.buf, this.usedBufferBytes);
        this.usedBufferBytes += numBytesWritten;
        totalBytesWritten += numBytesWritten;
        return totalBytesWritten;
    }
}
function createLPS(pat) {
    const lps = new Uint8Array(pat.length);
    lps[0] = 0;
    let prefixEnd = 0;
    let i = 1;
    while(i < lps.length){
        if (pat[i] == pat[prefixEnd]) {
            prefixEnd++;
            lps[i] = prefixEnd;
            i++;
        } else if (prefixEnd === 0) {
            lps[i] = 0;
            i++;
        } else {
            prefixEnd = lps[prefixEnd - 1];
        }
    }
    return lps;
}
async function* readDelim(reader, delim) {
    const delimLen = delim.length;
    const delimLPS = createLPS(delim);
    const chunks = new BytesList();
    const bufSize = Math.max(1024, delimLen + 1);
    let inspectIndex = 0;
    let matchIndex = 0;
    while(true){
        const inspectArr = new Uint8Array(bufSize);
        const result = await reader.read(inspectArr);
        if (result === null) {
            yield chunks.concat();
            return;
        } else if (result < 0) {
            return;
        }
        chunks.add(inspectArr, 0, result);
        let localIndex = 0;
        while(inspectIndex < chunks.size()){
            if (inspectArr[localIndex] === delim[matchIndex]) {
                inspectIndex++;
                localIndex++;
                matchIndex++;
                if (matchIndex === delimLen) {
                    const matchEnd = inspectIndex - delimLen;
                    const readyBytes = chunks.slice(0, matchEnd);
                    yield readyBytes;
                    chunks.shift(inspectIndex);
                    inspectIndex = 0;
                    matchIndex = 0;
                }
            } else {
                if (matchIndex === 0) {
                    inspectIndex++;
                    localIndex++;
                } else {
                    matchIndex = delimLPS[matchIndex - 1];
                }
            }
        }
    }
}
async function* readStringDelim(reader, delim, decoderOpts) {
    const encoder = new TextEncoder();
    const decoder = new TextDecoder(decoderOpts?.encoding, decoderOpts);
    for await (const chunk of readDelim(reader, encoder.encode(delim))){
        yield decoder.decode(chunk);
    }
}
async function* readLines(reader, decoderOpts) {
    const bufReader = new BufReader(reader);
    let chunks = [];
    const decoder = new TextDecoder(decoderOpts?.encoding, decoderOpts);
    while(true){
        const res = await bufReader.readLine();
        if (!res) {
            if (chunks.length > 0) {
                yield decoder.decode(concat(...chunks));
            }
            break;
        }
        chunks.push(res.line);
        if (!res.more) {
            yield decoder.decode(concat(...chunks));
            chunks = [];
        }
    }
}
class StringReader extends Buffer {
    constructor(s){
        super(new TextEncoder().encode(s).buffer);
    }
}
class MultiReader {
    #readers;
    #currentIndex = 0;
    constructor(readers){
        this.#readers = [
            ...readers
        ];
    }
    async read(p) {
        const r = this.#readers[this.#currentIndex];
        if (!r) return null;
        const result = await r.read(p);
        if (result === null) {
            this.#currentIndex++;
            return 0;
        }
        return result;
    }
}
class LimitedReader {
    reader;
    limit;
    constructor(reader, limit){
        this.reader = reader;
        this.limit = limit;
    }
    async read(p) {
        if (this.limit <= 0) {
            return null;
        }
        if (p.length > this.limit) {
            p = p.subarray(0, this.limit);
        }
        const n = await this.reader.read(p);
        if (n == null) {
            return null;
        }
        this.limit -= n;
        return n;
    }
}
const DEFAULT_BUFFER_SIZE = 32 * 1024;
async function copyN(r, dest, size) {
    let bytesRead = 0;
    let buf = new Uint8Array(DEFAULT_BUFFER_SIZE);
    while(bytesRead < size){
        if (size - bytesRead < DEFAULT_BUFFER_SIZE) {
            buf = new Uint8Array(size - bytesRead);
        }
        const result = await r.read(buf);
        const nread = result ?? 0;
        bytesRead += nread;
        if (nread > 0) {
            let n = 0;
            while(n < nread){
                n += await dest.write(buf.slice(n, nread));
            }
            assert(n === nread, "could not write");
        }
        if (result === null) {
            break;
        }
    }
    return bytesRead;
}
async function readShort(buf) {
    const high = await buf.readByte();
    if (high === null) return null;
    const low = await buf.readByte();
    if (low === null) throw new Deno.errors.UnexpectedEof();
    return high << 8 | low;
}
async function readInt(buf) {
    const high = await readShort(buf);
    if (high === null) return null;
    const low = await readShort(buf);
    if (low === null) throw new Deno.errors.UnexpectedEof();
    return high << 16 | low;
}
const MAX_SAFE_INTEGER = BigInt(Number.MAX_SAFE_INTEGER);
async function readLong(buf) {
    const high = await readInt(buf);
    if (high === null) return null;
    const low = await readInt(buf);
    if (low === null) throw new Deno.errors.UnexpectedEof();
    const big = BigInt(high) << 32n | BigInt(low);
    if (big > MAX_SAFE_INTEGER) {
        throw new RangeError("Long value too big to be represented as a JavaScript number.");
    }
    return Number(big);
}
function sliceLongToBytes(d, dest = Array.from({
    length: 8
})) {
    let big = BigInt(d);
    for(let i = 0; i < 8; i++){
        dest[7 - i] = Number(big & 0xffn);
        big >>= 8n;
    }
    return dest;
}
const decoder = new TextDecoder();
class StringWriter {
    base;
    #chunks;
    #byteLength;
    #cache;
    constructor(base = ""){
        this.base = base;
        this.#chunks = [];
        this.#byteLength = 0;
        const c = new TextEncoder().encode(base);
        this.#chunks.push(c);
        this.#byteLength += c.byteLength;
    }
    write(p) {
        return Promise.resolve(this.writeSync(p));
    }
    writeSync(p) {
        this.#chunks.push(new Uint8Array(p));
        this.#byteLength += p.byteLength;
        this.#cache = undefined;
        return p.byteLength;
    }
    toString() {
        if (this.#cache) {
            return this.#cache;
        }
        const buf = new Uint8Array(this.#byteLength);
        let offs = 0;
        for (const chunk of this.#chunks){
            buf.set(chunk, offs);
            offs += chunk.byteLength;
        }
        this.#cache = decoder.decode(buf);
        return this.#cache;
    }
}
const mod2 = {
    copyN: copyN,
    readInt: readInt,
    readLong: readLong,
    readShort: readShort,
    sliceLongToBytes: sliceLongToBytes,
    Buffer,
    BufferFullError,
    PartialReadError,
    BufReader,
    BufWriter,
    BufWriterSync,
    readDelim,
    readStringDelim,
    readLines,
    StringReader,
    MultiReader,
    LimitedReader,
    StringWriter
};
function bytesToUuid(bytes) {
    const bits = [
        ...bytes
    ].map((bit)=>{
        const s = bit.toString(16);
        return bit < 0x10 ? "0" + s : s;
    });
    return [
        ...bits.slice(0, 4),
        "-",
        ...bits.slice(4, 6),
        "-",
        ...bits.slice(6, 8),
        "-",
        ...bits.slice(8, 10),
        "-",
        ...bits.slice(10, 16)
    ].join("");
}
function uuidToBytes(uuid) {
    const bytes = [];
    uuid.replace(/[a-fA-F0-9]{2}/g, (hex)=>{
        bytes.push(parseInt(hex, 16));
        return "";
    });
    return bytes;
}
const UUID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-1[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
function validate(id) {
    return UUID_RE.test(id);
}
let _nodeId;
let _clockseq;
let _lastMSecs = 0;
let _lastNSecs = 0;
function generate(options, buf, offset) {
    let i = buf && offset || 0;
    const b = buf ?? [];
    options ??= {};
    let { node =_nodeId , clockseq =_clockseq  } = options;
    if (node === undefined || clockseq === undefined) {
        const seedBytes = options.random ?? options.rng ?? crypto.getRandomValues(new Uint8Array(16));
        if (node === undefined) {
            node = _nodeId = [
                seedBytes[0] | 0x01,
                seedBytes[1],
                seedBytes[2],
                seedBytes[3],
                seedBytes[4],
                seedBytes[5]
            ];
        }
        if (clockseq === undefined) {
            clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;
        }
    }
    let { msecs =new Date().getTime() , nsecs =_lastNSecs + 1  } = options;
    const dt = msecs - _lastMSecs + (nsecs - _lastNSecs) / 10000;
    if (dt < 0 && options.clockseq === undefined) {
        clockseq = clockseq + 1 & 0x3fff;
    }
    if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {
        nsecs = 0;
    }
    if (nsecs > 10000) {
        throw new Error("Can't create more than 10M uuids/sec");
    }
    _lastMSecs = msecs;
    _lastNSecs = nsecs;
    _clockseq = clockseq;
    msecs += 12219292800000;
    const tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;
    b[i++] = tl >>> 24 & 0xff;
    b[i++] = tl >>> 16 & 0xff;
    b[i++] = tl >>> 8 & 0xff;
    b[i++] = tl & 0xff;
    const tmh = msecs / 0x100000000 * 10000 & 0xfffffff;
    b[i++] = tmh >>> 8 & 0xff;
    b[i++] = tmh & 0xff;
    b[i++] = tmh >>> 24 & 0xf | 0x10;
    b[i++] = tmh >>> 16 & 0xff;
    b[i++] = clockseq >>> 8 | 0x80;
    b[i++] = clockseq & 0xff;
    for(let n = 0; n < 6; ++n){
        b[i + n] = node[n];
    }
    return buf ?? bytesToUuid(b);
}
const mod3 = {
    validate: validate,
    generate: generate
};
const UUID_RE1 = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
function validate1(id) {
    return UUID_RE1.test(id);
}
const mod4 = {
    validate: validate1
};
const UUID_RE2 = /^[0-9a-f]{8}-[0-9a-f]{4}-[5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
function validate2(id) {
    return UUID_RE2.test(id);
}
async function generate1(namespace, data) {
    const space = uuidToBytes(namespace);
    assert(space.length === 16, "namespace must be a valid UUID");
    const toHash = concat(new Uint8Array(space), data);
    const buffer = await crypto.subtle.digest("sha-1", toHash);
    const bytes = new Uint8Array(buffer);
    bytes[6] = bytes[6] & 0x0f | 0x50;
    bytes[8] = bytes[8] & 0x3f | 0x80;
    return bytesToUuid(bytes);
}
const mod5 = {
    validate: validate2,
    generate: generate1
};
const NIL_UUID = "00000000-0000-0000-0000-000000000000";
function isNil(id) {
    return id === NIL_UUID;
}
function validate3(uuid) {
    return /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i.test(uuid);
}
function version(uuid) {
    if (!validate3(uuid)) {
        throw new TypeError("Invalid UUID");
    }
    return parseInt(uuid[14], 16);
}
const mod6 = {
    v1: mod3,
    v4: mod4,
    v5: mod5,
    NIL_UUID: NIL_UUID,
    isNil: isNil,
    validate: validate3,
    version: version
};
function utf8Count(str) {
    const strLength = str.length;
    let byteLength = 0;
    let pos = 0;
    while(pos < strLength){
        let value = str.charCodeAt(pos++);
        if ((value & 0xffffff80) === 0) {
            byteLength++;
            continue;
        } else if ((value & 0xfffff800) === 0) {
            byteLength += 2;
        } else {
            if (value >= 0xd800 && value <= 0xdbff) {
                if (pos < strLength) {
                    const extra = str.charCodeAt(pos);
                    if ((extra & 0xfc00) === 0xdc00) {
                        ++pos;
                        value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;
                    }
                }
            }
            if ((value & 0xffff0000) === 0) {
                byteLength += 3;
            } else {
                byteLength += 4;
            }
        }
    }
    return byteLength;
}
function utf8EncodeJs(str, output, outputOffset) {
    const strLength = str.length;
    let offset = outputOffset;
    let pos = 0;
    while(pos < strLength){
        let value = str.charCodeAt(pos++);
        if ((value & 0xffffff80) === 0) {
            output[offset++] = value;
            continue;
        } else if ((value & 0xfffff800) === 0) {
            output[offset++] = value >> 6 & 0x1f | 0xc0;
        } else {
            if (value >= 0xd800 && value <= 0xdbff) {
                if (pos < strLength) {
                    const extra = str.charCodeAt(pos);
                    if ((extra & 0xfc00) === 0xdc00) {
                        ++pos;
                        value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;
                    }
                }
            }
            if ((value & 0xffff0000) === 0) {
                output[offset++] = value >> 12 & 0x0f | 0xe0;
                output[offset++] = value >> 6 & 0x3f | 0x80;
            } else {
                output[offset++] = value >> 18 & 0x07 | 0xf0;
                output[offset++] = value >> 12 & 0x3f | 0x80;
                output[offset++] = value >> 6 & 0x3f | 0x80;
            }
        }
        output[offset++] = value & 0x3f | 0x80;
    }
}
const sharedTextEncoder = new TextEncoder();
function utf8EncodeTEencodeInto(str, output, outputOffset) {
    sharedTextEncoder.encodeInto(str, output.subarray(outputOffset));
}
const utf8EncodeTE = utf8EncodeTEencodeInto;
function utf8DecodeJs(bytes, inputOffset, byteLength) {
    let offset = inputOffset;
    const end = offset + byteLength;
    const units = [];
    let result = "";
    while(offset < end){
        const byte1 = bytes[offset++];
        if ((byte1 & 0x80) === 0) {
            units.push(byte1);
        } else if ((byte1 & 0xe0) === 0xc0) {
            const byte2 = bytes[offset++] & 0x3f;
            units.push((byte1 & 0x1f) << 6 | byte2);
        } else if ((byte1 & 0xf0) === 0xe0) {
            const byte2 = bytes[offset++] & 0x3f;
            const byte3 = bytes[offset++] & 0x3f;
            units.push((byte1 & 0x1f) << 12 | byte2 << 6 | byte3);
        } else if ((byte1 & 0xf8) === 0xf0) {
            const byte2 = bytes[offset++] & 0x3f;
            const byte3 = bytes[offset++] & 0x3f;
            const byte4 = bytes[offset++] & 0x3f;
            let unit = (byte1 & 0x07) << 0x12 | byte2 << 0x0c | byte3 << 0x06 | byte4;
            if (unit > 0xffff) {
                unit -= 0x10000;
                units.push(unit >>> 10 & 0x3ff | 0xd800);
                unit = 0xdc00 | unit & 0x3ff;
            }
            units.push(unit);
        } else {
            units.push(byte1);
        }
        if (units.length >= 0x1_000) {
            result += String.fromCharCode(...units);
            units.length = 0;
        }
    }
    if (units.length > 0) {
        result += String.fromCharCode(...units);
    }
    return result;
}
const sharedTextDecoder = new TextDecoder();
function utf8DecodeTD(bytes, inputOffset, byteLength) {
    const stringBytes = bytes.subarray(inputOffset, inputOffset + byteLength);
    return sharedTextDecoder.decode(stringBytes);
}
class ExtData {
    type;
    data;
    constructor(type, data){
        this.type = type;
        this.data = data;
    }
}
function setUint64(view, offset, value) {
    const high = value / 0x1_0000_0000;
    const low = value;
    view.setUint32(offset, high);
    view.setUint32(offset + 4, low);
}
function setInt64(view, offset, value) {
    const high = Math.floor(value / 0x1_0000_0000);
    const low = value;
    view.setUint32(offset, high);
    view.setUint32(offset + 4, low);
}
function getInt64(view, offset) {
    const high = view.getInt32(offset);
    const low = view.getUint32(offset + 4);
    return high * 0x1_0000_0000 + low;
}
function getUint64(view, offset) {
    const high = view.getUint32(offset);
    const low = view.getUint32(offset + 4);
    return high * 0x1_0000_0000 + low;
}
const EXT_TIMESTAMP = -1;
const TIMESTAMP32_MAX_SEC = 0x100000000 - 1;
const TIMESTAMP64_MAX_SEC = 0x400000000 - 1;
function encodeTimeSpecToTimestamp({ sec , nsec  }) {
    if (sec >= 0 && nsec >= 0 && sec <= TIMESTAMP64_MAX_SEC) {
        if (nsec === 0 && sec <= TIMESTAMP32_MAX_SEC) {
            const rv = new Uint8Array(4);
            const view = new DataView(rv.buffer);
            view.setUint32(0, sec);
            return rv;
        } else {
            const secHigh = sec / 0x100000000;
            const secLow = sec & 0xffffffff;
            const rv = new Uint8Array(8);
            const view = new DataView(rv.buffer);
            view.setUint32(0, nsec << 2 | secHigh & 0x3);
            view.setUint32(4, secLow);
            return rv;
        }
    } else {
        const rv = new Uint8Array(12);
        const view = new DataView(rv.buffer);
        view.setUint32(0, nsec);
        setInt64(view, 4, sec);
        return rv;
    }
}
function encodeDateToTimeSpec(date) {
    const msec = date.getTime();
    const sec = Math.floor(msec / 1e3);
    const nsec = (msec - sec * 1e3) * 1e6;
    const nsecInSec = Math.floor(nsec / 1e9);
    return {
        sec: sec + nsecInSec,
        nsec: nsec - nsecInSec * 1e9
    };
}
function encodeTimestampExtension(object) {
    if (object instanceof Date) {
        const timeSpec = encodeDateToTimeSpec(object);
        return encodeTimeSpecToTimestamp(timeSpec);
    } else {
        return null;
    }
}
function decodeTimestampToTimeSpec(data) {
    const view = new DataView(data.buffer, data.byteOffset, data.byteLength);
    switch(data.byteLength){
        case 4:
            {
                const sec = view.getUint32(0);
                return {
                    sec,
                    nsec: 0
                };
            }
        case 8:
            {
                const nsec30AndSecHigh2 = view.getUint32(0);
                const secLow32 = view.getUint32(4);
                const sec = (nsec30AndSecHigh2 & 0x3) * 0x100000000 + secLow32;
                const nsec = nsec30AndSecHigh2 >>> 2;
                return {
                    sec,
                    nsec
                };
            }
        case 12:
            {
                const sec = getInt64(view, 4);
                const nsec = view.getUint32(0);
                return {
                    sec,
                    nsec
                };
            }
        default:
            throw new Error(`Unrecognized data size for timestamp: ${data.length}`);
    }
}
function decodeTimestampExtension(data) {
    const timeSpec = decodeTimestampToTimeSpec(data);
    return new Date(timeSpec.sec * 1e3 + timeSpec.nsec / 1e6);
}
const timestampExtension = {
    type: EXT_TIMESTAMP,
    encode: encodeTimestampExtension,
    decode: decodeTimestampExtension
};
class ExtensionCodec {
    static defaultCodec = new ExtensionCodec();
    __brand;
    builtInEncoders = [];
    builtInDecoders = [];
    encoders = [];
    decoders = [];
    constructor(){
        this.register(timestampExtension);
    }
    register({ type , encode , decode  }) {
        if (type >= 0) {
            this.encoders[type] = encode;
            this.decoders[type] = decode;
        } else {
            const index = 1 + type;
            this.builtInEncoders[index] = encode;
            this.builtInDecoders[index] = decode;
        }
    }
    tryToEncode(object, context) {
        for(let i = 0; i < this.builtInEncoders.length; i++){
            const encoder = this.builtInEncoders[i];
            if (encoder != null) {
                const data = encoder(object, context);
                if (data != null) {
                    const type = -1 - i;
                    return new ExtData(type, data);
                }
            }
        }
        for(let i = 0; i < this.encoders.length; i++){
            const encoder = this.encoders[i];
            if (encoder != null) {
                const data = encoder(object, context);
                if (data != null) {
                    const type = i;
                    return new ExtData(type, data);
                }
            }
        }
        if (object instanceof ExtData) {
            return object;
        }
        return null;
    }
    decode(data, type, context) {
        const decoder = type < 0 ? this.builtInDecoders[-1 - type] : this.decoders[type];
        if (decoder) {
            return decoder(data, type, context);
        } else {
            return new ExtData(type, data);
        }
    }
}
function ensureUint8Array(buffer) {
    if (buffer instanceof Uint8Array) {
        return buffer;
    } else if (ArrayBuffer.isView(buffer)) {
        return new Uint8Array(buffer.buffer, buffer.byteOffset, buffer.byteLength);
    } else if (buffer instanceof ArrayBuffer) {
        return new Uint8Array(buffer);
    } else {
        return Uint8Array.from(buffer);
    }
}
function createDataView(buffer) {
    if (buffer instanceof ArrayBuffer) {
        return new DataView(buffer);
    }
    const bufferView = ensureUint8Array(buffer);
    return new DataView(bufferView.buffer, bufferView.byteOffset, bufferView.byteLength);
}
class Encoder {
    extensionCodec;
    context;
    maxDepth;
    initialBufferSize;
    sortKeys;
    forceFloat32;
    ignoreUndefined;
    pos;
    view;
    bytes;
    constructor(extensionCodec = ExtensionCodec.defaultCodec, context = undefined, maxDepth = 100, initialBufferSize = 2048, sortKeys = false, forceFloat32 = false, ignoreUndefined = false){
        this.extensionCodec = extensionCodec;
        this.context = context;
        this.maxDepth = maxDepth;
        this.initialBufferSize = initialBufferSize;
        this.sortKeys = sortKeys;
        this.forceFloat32 = forceFloat32;
        this.ignoreUndefined = ignoreUndefined;
        this.pos = 0;
        this.view = new DataView(new ArrayBuffer(this.initialBufferSize));
        this.bytes = new Uint8Array(this.view.buffer);
    }
    getUint8Array() {
        return this.bytes.subarray(0, this.pos);
    }
    reinitializeState() {
        this.pos = 0;
    }
    encode(object) {
        this.reinitializeState();
        this.doEncode(object, 1);
        return this.getUint8Array();
    }
    doEncode(object, depth) {
        if (depth > this.maxDepth) {
            throw new Error(`Too deep objects in depth ${depth}`);
        }
        if (object == null) {
            this.encodeNil();
        } else if (typeof object === "boolean") {
            this.encodeBoolean(object);
        } else if (typeof object === "number") {
            this.encodeNumber(object);
        } else if (typeof object === "string") {
            this.encodeString(object);
        } else {
            this.encodeObject(object, depth);
        }
    }
    ensureBufferSizeToWrite(sizeToWrite) {
        const requiredSize = this.pos + sizeToWrite;
        if (this.view.byteLength < requiredSize) {
            this.resizeBuffer(requiredSize * 2);
        }
    }
    resizeBuffer(newSize) {
        const newBuffer = new ArrayBuffer(newSize);
        const newBytes = new Uint8Array(newBuffer);
        const newView = new DataView(newBuffer);
        newBytes.set(this.bytes);
        this.view = newView;
        this.bytes = newBytes;
    }
    encodeNil() {
        this.writeU8(0xc0);
    }
    encodeBoolean(object) {
        if (object === false) {
            this.writeU8(0xc2);
        } else {
            this.writeU8(0xc3);
        }
    }
    encodeNumber(object) {
        if (Number.isSafeInteger(object)) {
            if (object >= 0) {
                if (object < 0x80) {
                    this.writeU8(object);
                } else if (object < 0x100) {
                    this.writeU8(0xcc);
                    this.writeU8(object);
                } else if (object < 0x10000) {
                    this.writeU8(0xcd);
                    this.writeU16(object);
                } else if (object < 0x100000000) {
                    this.writeU8(0xce);
                    this.writeU32(object);
                } else {
                    this.writeU8(0xcf);
                    this.writeU64(object);
                }
            } else {
                if (object >= -0x20) {
                    this.writeU8(0xe0 | object + 0x20);
                } else if (object >= -0x80) {
                    this.writeU8(0xd0);
                    this.writeI8(object);
                } else if (object >= -0x8000) {
                    this.writeU8(0xd1);
                    this.writeI16(object);
                } else if (object >= -0x80000000) {
                    this.writeU8(0xd2);
                    this.writeI32(object);
                } else {
                    this.writeU8(0xd3);
                    this.writeI64(object);
                }
            }
        } else {
            if (this.forceFloat32) {
                this.writeU8(0xca);
                this.writeF32(object);
            } else {
                this.writeU8(0xcb);
                this.writeF64(object);
            }
        }
    }
    writeStringHeader(byteLength) {
        if (byteLength < 32) {
            this.writeU8(0xa0 + byteLength);
        } else if (byteLength < 0x100) {
            this.writeU8(0xd9);
            this.writeU8(byteLength);
        } else if (byteLength < 0x10000) {
            this.writeU8(0xda);
            this.writeU16(byteLength);
        } else if (byteLength < 0x100000000) {
            this.writeU8(0xdb);
            this.writeU32(byteLength);
        } else {
            throw new Error(`Too long string: ${byteLength} bytes in UTF-8`);
        }
    }
    encodeString(object) {
        const maxHeaderSize = 1 + 4;
        const strLength = object.length;
        if (strLength > 200) {
            const byteLength = utf8Count(object);
            this.ensureBufferSizeToWrite(maxHeaderSize + byteLength);
            this.writeStringHeader(byteLength);
            utf8EncodeTE(object, this.bytes, this.pos);
            this.pos += byteLength;
        } else {
            const byteLength = utf8Count(object);
            this.ensureBufferSizeToWrite(maxHeaderSize + byteLength);
            this.writeStringHeader(byteLength);
            utf8EncodeJs(object, this.bytes, this.pos);
            this.pos += byteLength;
        }
    }
    encodeObject(object, depth) {
        const ext = this.extensionCodec.tryToEncode(object, this.context);
        if (ext != null) {
            this.encodeExtension(ext);
        } else if (Array.isArray(object)) {
            this.encodeArray(object, depth);
        } else if (ArrayBuffer.isView(object)) {
            this.encodeBinary(object);
        } else if (typeof object === "object") {
            this.encodeMap(object, depth);
        } else {
            throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(object)}`);
        }
    }
    encodeBinary(object) {
        const size = object.byteLength;
        if (size < 0x100) {
            this.writeU8(0xc4);
            this.writeU8(size);
        } else if (size < 0x10000) {
            this.writeU8(0xc5);
            this.writeU16(size);
        } else if (size < 0x100000000) {
            this.writeU8(0xc6);
            this.writeU32(size);
        } else {
            throw new Error(`Too large binary: ${size}`);
        }
        const bytes = ensureUint8Array(object);
        this.writeU8a(bytes);
    }
    encodeArray(object, depth) {
        const size = object.length;
        if (size < 16) {
            this.writeU8(0x90 + size);
        } else if (size < 0x10000) {
            this.writeU8(0xdc);
            this.writeU16(size);
        } else if (size < 0x100000000) {
            this.writeU8(0xdd);
            this.writeU32(size);
        } else {
            throw new Error(`Too large array: ${size}`);
        }
        for (const item of object){
            this.doEncode(item, depth + 1);
        }
    }
    countWithoutUndefined(object, keys) {
        let count = 0;
        for (const key of keys){
            if (object[key] !== undefined) {
                count++;
            }
        }
        return count;
    }
    encodeMap(object, depth) {
        const keys = Object.keys(object);
        if (this.sortKeys) {
            keys.sort();
        }
        const size = this.ignoreUndefined ? this.countWithoutUndefined(object, keys) : keys.length;
        if (size < 16) {
            this.writeU8(0x80 + size);
        } else if (size < 0x10000) {
            this.writeU8(0xde);
            this.writeU16(size);
        } else if (size < 0x100000000) {
            this.writeU8(0xdf);
            this.writeU32(size);
        } else {
            throw new Error(`Too large map object: ${size}`);
        }
        for (const key of keys){
            const value = object[key];
            if (!(this.ignoreUndefined && value === undefined)) {
                this.encodeString(key);
                this.doEncode(value, depth + 1);
            }
        }
    }
    encodeExtension(ext) {
        const size = ext.data.length;
        if (size === 1) {
            this.writeU8(0xd4);
        } else if (size === 2) {
            this.writeU8(0xd5);
        } else if (size === 4) {
            this.writeU8(0xd6);
        } else if (size === 8) {
            this.writeU8(0xd7);
        } else if (size === 16) {
            this.writeU8(0xd8);
        } else if (size < 0x100) {
            this.writeU8(0xc7);
            this.writeU8(size);
        } else if (size < 0x10000) {
            this.writeU8(0xc8);
            this.writeU16(size);
        } else if (size < 0x100000000) {
            this.writeU8(0xc9);
            this.writeU32(size);
        } else {
            throw new Error(`Too large extension object: ${size}`);
        }
        this.writeI8(ext.type);
        this.writeU8a(ext.data);
    }
    writeU8(value) {
        this.ensureBufferSizeToWrite(1);
        this.view.setUint8(this.pos, value);
        this.pos++;
    }
    writeU8a(values) {
        const size = values.length;
        this.ensureBufferSizeToWrite(size);
        this.bytes.set(values, this.pos);
        this.pos += size;
    }
    writeI8(value) {
        this.ensureBufferSizeToWrite(1);
        this.view.setInt8(this.pos, value);
        this.pos++;
    }
    writeU16(value) {
        this.ensureBufferSizeToWrite(2);
        this.view.setUint16(this.pos, value);
        this.pos += 2;
    }
    writeI16(value) {
        this.ensureBufferSizeToWrite(2);
        this.view.setInt16(this.pos, value);
        this.pos += 2;
    }
    writeU32(value) {
        this.ensureBufferSizeToWrite(4);
        this.view.setUint32(this.pos, value);
        this.pos += 4;
    }
    writeI32(value) {
        this.ensureBufferSizeToWrite(4);
        this.view.setInt32(this.pos, value);
        this.pos += 4;
    }
    writeF32(value) {
        this.ensureBufferSizeToWrite(4);
        this.view.setFloat32(this.pos, value);
        this.pos += 4;
    }
    writeF64(value) {
        this.ensureBufferSizeToWrite(8);
        this.view.setFloat64(this.pos, value);
        this.pos += 8;
    }
    writeU64(value) {
        this.ensureBufferSizeToWrite(8);
        setUint64(this.view, this.pos, value);
        this.pos += 8;
    }
    writeI64(value) {
        this.ensureBufferSizeToWrite(8);
        setInt64(this.view, this.pos, value);
        this.pos += 8;
    }
}
const defaultEncodeOptions = {};
function encode1(value, options = defaultEncodeOptions) {
    const encoder = new Encoder(options.extensionCodec, options.context, options.maxDepth, options.initialBufferSize, options.sortKeys, options.forceFloat32, options.ignoreUndefined);
    return encoder.encode(value);
}
function prettyByte(__byte) {
    return `${__byte < 0 ? "-" : ""}0x${Math.abs(__byte).toString(16).padStart(2, "0")}`;
}
class CachedKeyDecoder {
    maxKeyLength;
    maxLengthPerKey;
    hit;
    miss;
    caches;
    constructor(maxKeyLength = 16, maxLengthPerKey = 16){
        this.maxKeyLength = maxKeyLength;
        this.maxLengthPerKey = maxLengthPerKey;
        this.hit = 0;
        this.miss = 0;
        this.caches = [];
        for(let i = 0; i < this.maxKeyLength; i++){
            this.caches.push([]);
        }
    }
    canBeCached(byteLength) {
        return byteLength > 0 && byteLength <= this.maxKeyLength;
    }
    get(bytes, inputOffset, byteLength) {
        const records = this.caches[byteLength - 1];
        const recordsLength = records.length;
        FIND_CHUNK: for(let i = 0; i < recordsLength; i++){
            const record = records[i];
            const recordBytes = record.bytes;
            for(let j = 0; j < byteLength; j++){
                if (recordBytes[j] !== bytes[inputOffset + j]) {
                    continue FIND_CHUNK;
                }
            }
            return record.value;
        }
        return null;
    }
    store(bytes, value) {
        const records = this.caches[bytes.length - 1];
        const record = {
            bytes,
            value
        };
        if (records.length >= this.maxLengthPerKey) {
            records[Math.random() * records.length | 0] = record;
        } else {
            records.push(record);
        }
    }
    decode(bytes, inputOffset, byteLength) {
        const cachedValue = this.get(bytes, inputOffset, byteLength);
        if (cachedValue != null) {
            this.hit++;
            return cachedValue;
        }
        this.miss++;
        const value = utf8DecodeJs(bytes, inputOffset, byteLength);
        const slicedCopyOfBytes = Uint8Array.prototype.slice.call(bytes, inputOffset, inputOffset + byteLength);
        this.store(slicedCopyOfBytes, value);
        return value;
    }
}
var State;
(function(State) {
    State[State["ARRAY"] = 0] = "ARRAY";
    State[State["MAP_KEY"] = 1] = "MAP_KEY";
    State[State["MAP_VALUE"] = 2] = "MAP_VALUE";
})(State || (State = {}));
const isValidMapKeyType = (key)=>{
    const keyType = typeof key;
    return keyType === "string" || keyType === "number";
};
const HEAD_BYTE_REQUIRED = -1;
const EMPTY_VIEW = new DataView(new ArrayBuffer(0));
const EMPTY_BYTES = new Uint8Array(EMPTY_VIEW.buffer);
const DataViewIndexOutOfBoundsError = (()=>{
    try {
        EMPTY_VIEW.getInt8(0);
    } catch (e) {
        return e.constructor;
    }
    throw new Error("never reached");
})();
const MORE_DATA = new DataViewIndexOutOfBoundsError("Insufficient data");
const sharedCachedKeyDecoder = new CachedKeyDecoder();
class Decoder {
    extensionCodec;
    context;
    maxStrLength;
    maxBinLength;
    maxArrayLength;
    maxMapLength;
    maxExtLength;
    keyDecoder;
    totalPos;
    pos;
    view;
    bytes;
    headByte;
    stack;
    constructor(extensionCodec = ExtensionCodec.defaultCodec, context = undefined, maxStrLength = 0xffff_ffff, maxBinLength = 0xffff_ffff, maxArrayLength = 0xffff_ffff, maxMapLength = 0xffff_ffff, maxExtLength = 0xffff_ffff, keyDecoder = sharedCachedKeyDecoder){
        this.extensionCodec = extensionCodec;
        this.context = context;
        this.maxStrLength = maxStrLength;
        this.maxBinLength = maxBinLength;
        this.maxArrayLength = maxArrayLength;
        this.maxMapLength = maxMapLength;
        this.maxExtLength = maxExtLength;
        this.keyDecoder = keyDecoder;
        this.totalPos = 0;
        this.pos = 0;
        this.view = EMPTY_VIEW;
        this.bytes = EMPTY_BYTES;
        this.headByte = HEAD_BYTE_REQUIRED;
        this.stack = [];
    }
    reinitializeState() {
        this.totalPos = 0;
        this.headByte = HEAD_BYTE_REQUIRED;
    }
    setBuffer(buffer) {
        this.bytes = ensureUint8Array(buffer);
        this.view = createDataView(this.bytes);
        this.pos = 0;
    }
    appendBuffer(buffer) {
        buffer = ensureUint8Array(buffer).slice();
        if (this.headByte === HEAD_BYTE_REQUIRED && !this.hasRemaining()) {
            this.setBuffer(buffer);
        } else {
            const remainingData = this.bytes.subarray(this.pos);
            const newData = ensureUint8Array(buffer);
            const concated = new Uint8Array(remainingData.length + newData.length);
            concated.set(remainingData);
            concated.set(newData, remainingData.length);
            this.setBuffer(concated);
        }
    }
    hasRemaining(size = 1) {
        return this.view.byteLength - this.pos >= size;
    }
    createNoExtraBytesError(posToShow) {
        const { view , pos  } = this;
        return new RangeError(`Extra ${view.byteLength - pos} of ${view.byteLength} byte(s) found at buffer[${posToShow}]`);
    }
    decode(buffer) {
        this.reinitializeState();
        this.setBuffer(buffer);
        return this.doDecodeSingleSync();
    }
    doDecodeSingleSync() {
        const object = this.doDecodeSync();
        if (this.hasRemaining()) {
            throw this.createNoExtraBytesError(this.pos);
        }
        return object;
    }
    async decodeAsync(stream) {
        let decoded = false;
        let object;
        for await (const buffer of stream){
            if (decoded) {
                throw this.createNoExtraBytesError(this.totalPos);
            }
            this.appendBuffer(buffer);
            try {
                object = this.doDecodeSync();
                decoded = true;
            } catch (e) {
                if (!(e instanceof DataViewIndexOutOfBoundsError)) {
                    throw e;
                }
            }
            this.totalPos += this.pos;
        }
        if (decoded) {
            if (this.hasRemaining()) {
                throw this.createNoExtraBytesError(this.totalPos);
            }
            return object;
        }
        const { headByte , pos , totalPos  } = this;
        throw new RangeError(`Insufficient data in parcing ${prettyByte(headByte)} at ${totalPos} (${pos} in the current buffer)`);
    }
    decodeArrayStream(stream) {
        return this.decodeMultiAsync(stream, true);
    }
    decodeStream(stream) {
        return this.decodeMultiAsync(stream, false);
    }
    async *decodeMultiAsync(stream, isArray) {
        let isArrayHeaderRequired = isArray;
        let arrayItemsLeft = -1;
        for await (const buffer of stream){
            if (isArray && arrayItemsLeft === 0) {
                throw this.createNoExtraBytesError(this.totalPos);
            }
            this.appendBuffer(buffer);
            if (isArrayHeaderRequired) {
                arrayItemsLeft = this.readArraySize();
                isArrayHeaderRequired = false;
                this.complete();
            }
            try {
                while(true){
                    yield this.doDecodeSync();
                    if (--arrayItemsLeft === 0) {
                        break;
                    }
                }
            } catch (e) {
                if (!(e instanceof DataViewIndexOutOfBoundsError)) {
                    throw e;
                }
            }
            this.totalPos += this.pos;
        }
    }
    doDecodeSync() {
        DECODE: while(true){
            const headByte = this.readHeadByte();
            let object;
            if (headByte >= 0xe0) {
                object = headByte - 0x100;
            } else if (headByte < 0xc0) {
                if (headByte < 0x80) {
                    object = headByte;
                } else if (headByte < 0x90) {
                    const size = headByte - 0x80;
                    if (size !== 0) {
                        this.pushMapState(size);
                        this.complete();
                        continue DECODE;
                    } else {
                        object = {};
                    }
                } else if (headByte < 0xa0) {
                    const size = headByte - 0x90;
                    if (size !== 0) {
                        this.pushArrayState(size);
                        this.complete();
                        continue DECODE;
                    } else {
                        object = [];
                    }
                } else {
                    const byteLength = headByte - 0xa0;
                    object = this.decodeUtf8String(byteLength, 0);
                }
            } else if (headByte === 0xc0) {
                object = null;
            } else if (headByte === 0xc2) {
                object = false;
            } else if (headByte === 0xc3) {
                object = true;
            } else if (headByte === 0xca) {
                object = this.readF32();
            } else if (headByte === 0xcb) {
                object = this.readF64();
            } else if (headByte === 0xcc) {
                object = this.readU8();
            } else if (headByte === 0xcd) {
                object = this.readU16();
            } else if (headByte === 0xce) {
                object = this.readU32();
            } else if (headByte === 0xcf) {
                object = this.readU64();
            } else if (headByte === 0xd0) {
                object = this.readI8();
            } else if (headByte === 0xd1) {
                object = this.readI16();
            } else if (headByte === 0xd2) {
                object = this.readI32();
            } else if (headByte === 0xd3) {
                object = this.readI64();
            } else if (headByte === 0xd9) {
                const byteLength = this.lookU8();
                object = this.decodeUtf8String(byteLength, 1);
            } else if (headByte === 0xda) {
                const byteLength = this.lookU16();
                object = this.decodeUtf8String(byteLength, 2);
            } else if (headByte === 0xdb) {
                const byteLength = this.lookU32();
                object = this.decodeUtf8String(byteLength, 4);
            } else if (headByte === 0xdc) {
                const size = this.readU16();
                if (size !== 0) {
                    this.pushArrayState(size);
                    this.complete();
                    continue DECODE;
                } else {
                    object = [];
                }
            } else if (headByte === 0xdd) {
                const size = this.readU32();
                if (size !== 0) {
                    this.pushArrayState(size);
                    this.complete();
                    continue DECODE;
                } else {
                    object = [];
                }
            } else if (headByte === 0xde) {
                const size = this.readU16();
                if (size !== 0) {
                    this.pushMapState(size);
                    this.complete();
                    continue DECODE;
                } else {
                    object = {};
                }
            } else if (headByte === 0xdf) {
                const size = this.readU32();
                if (size !== 0) {
                    this.pushMapState(size);
                    this.complete();
                    continue DECODE;
                } else {
                    object = {};
                }
            } else if (headByte === 0xc4) {
                const size = this.lookU8();
                object = this.decodeBinary(size, 1);
            } else if (headByte === 0xc5) {
                const size = this.lookU16();
                object = this.decodeBinary(size, 2);
            } else if (headByte === 0xc6) {
                const size = this.lookU32();
                object = this.decodeBinary(size, 4);
            } else if (headByte === 0xd4) {
                object = this.decodeExtension(1, 0);
            } else if (headByte === 0xd5) {
                object = this.decodeExtension(2, 0);
            } else if (headByte === 0xd6) {
                object = this.decodeExtension(4, 0);
            } else if (headByte === 0xd7) {
                object = this.decodeExtension(8, 0);
            } else if (headByte === 0xd8) {
                object = this.decodeExtension(16, 0);
            } else if (headByte === 0xc7) {
                const size = this.lookU8();
                object = this.decodeExtension(size, 1);
            } else if (headByte === 0xc8) {
                const size = this.lookU16();
                object = this.decodeExtension(size, 2);
            } else if (headByte === 0xc9) {
                const size = this.lookU32();
                object = this.decodeExtension(size, 4);
            } else {
                throw new Error(`Unrecognized type byte: ${prettyByte(headByte)}`);
            }
            this.complete();
            const stack = this.stack;
            while(stack.length > 0){
                const state = stack[stack.length - 1];
                if (state.type === 0) {
                    state.array[state.position] = object;
                    state.position++;
                    if (state.position === state.size) {
                        stack.pop();
                        object = state.array;
                    } else {
                        continue DECODE;
                    }
                } else if (state.type === 1) {
                    if (!isValidMapKeyType(object)) {
                        throw new Error("The type of key must be string or number but " + typeof object);
                    }
                    state.key = object;
                    state.type = 2;
                    continue DECODE;
                } else {
                    state.map[state.key] = object;
                    state.readCount++;
                    if (state.readCount === state.size) {
                        stack.pop();
                        object = state.map;
                    } else {
                        state.key = null;
                        state.type = 1;
                        continue DECODE;
                    }
                }
            }
            return object;
        }
    }
    readHeadByte() {
        if (this.headByte === HEAD_BYTE_REQUIRED) {
            this.headByte = this.readU8();
        }
        return this.headByte;
    }
    complete() {
        this.headByte = HEAD_BYTE_REQUIRED;
    }
    readArraySize() {
        const headByte = this.readHeadByte();
        switch(headByte){
            case 0xdc:
                return this.readU16();
            case 0xdd:
                return this.readU32();
            default:
                {
                    if (headByte < 0xa0) {
                        return headByte - 0x90;
                    } else {
                        throw new Error(`Unrecognized array type byte: ${prettyByte(headByte)}`);
                    }
                }
        }
    }
    pushMapState(size) {
        if (size > this.maxMapLength) {
            throw new Error(`Max length exceeded: map length (${size}) > maxMapLengthLength (${this.maxMapLength})`);
        }
        this.stack.push({
            type: 1,
            size,
            key: null,
            readCount: 0,
            map: {}
        });
    }
    pushArrayState(size) {
        if (size > this.maxArrayLength) {
            throw new Error(`Max length exceeded: array length (${size}) > maxArrayLength (${this.maxArrayLength})`);
        }
        this.stack.push({
            type: 0,
            size,
            array: new Array(size),
            position: 0
        });
    }
    decodeUtf8String(byteLength, headerOffset) {
        if (byteLength > this.maxStrLength) {
            throw new Error(`Max length exceeded: UTF-8 byte length (${byteLength}) > maxStrLength (${this.maxStrLength})`);
        }
        if (this.bytes.byteLength < this.pos + headerOffset + byteLength) {
            throw MORE_DATA;
        }
        const offset = this.pos + headerOffset;
        let object;
        if (this.stateIsMapKey() && this.keyDecoder?.canBeCached(byteLength)) {
            object = this.keyDecoder.decode(this.bytes, offset, byteLength);
        } else if (byteLength > 200) {
            object = utf8DecodeTD(this.bytes, offset, byteLength);
        } else {
            object = utf8DecodeJs(this.bytes, offset, byteLength);
        }
        this.pos += headerOffset + byteLength;
        return object;
    }
    stateIsMapKey() {
        if (this.stack.length > 0) {
            const state = this.stack[this.stack.length - 1];
            return state.type === 1;
        }
        return false;
    }
    decodeBinary(byteLength, headOffset) {
        if (byteLength > this.maxBinLength) {
            throw new Error(`Max length exceeded: bin length (${byteLength}) > maxBinLength (${this.maxBinLength})`);
        }
        if (!this.hasRemaining(byteLength + headOffset)) {
            throw MORE_DATA;
        }
        const offset = this.pos + headOffset;
        const object = this.bytes.subarray(offset, offset + byteLength);
        this.pos += headOffset + byteLength;
        return object;
    }
    decodeExtension(size, headOffset) {
        if (size > this.maxExtLength) {
            throw new Error(`Max length exceeded: ext length (${size}) > maxExtLength (${this.maxExtLength})`);
        }
        const extType = this.view.getInt8(this.pos + headOffset);
        const data = this.decodeBinary(size, headOffset + 1);
        return this.extensionCodec.decode(data, extType, this.context);
    }
    lookU8() {
        return this.view.getUint8(this.pos);
    }
    lookU16() {
        return this.view.getUint16(this.pos);
    }
    lookU32() {
        return this.view.getUint32(this.pos);
    }
    readU8() {
        const value = this.view.getUint8(this.pos);
        this.pos++;
        return value;
    }
    readI8() {
        const value = this.view.getInt8(this.pos);
        this.pos++;
        return value;
    }
    readU16() {
        const value = this.view.getUint16(this.pos);
        this.pos += 2;
        return value;
    }
    readI16() {
        const value = this.view.getInt16(this.pos);
        this.pos += 2;
        return value;
    }
    readU32() {
        const value = this.view.getUint32(this.pos);
        this.pos += 4;
        return value;
    }
    readI32() {
        const value = this.view.getInt32(this.pos);
        this.pos += 4;
        return value;
    }
    readU64() {
        const value = getUint64(this.view, this.pos);
        this.pos += 8;
        return value;
    }
    readI64() {
        const value = getInt64(this.view, this.pos);
        this.pos += 8;
        return value;
    }
    readF32() {
        const value = this.view.getFloat32(this.pos);
        this.pos += 4;
        return value;
    }
    readF64() {
        const value = this.view.getFloat64(this.pos);
        this.pos += 8;
        return value;
    }
}
const defaultDecodeOptions = {};
function decode1(buffer, options = defaultDecodeOptions) {
    const decoder = new Decoder(options.extensionCodec, options.context, options.maxStrLength, options.maxBinLength, options.maxArrayLength, options.maxMapLength, options.maxExtLength);
    return decoder.decode(buffer);
}
function isAsyncIterable(object) {
    return object[Symbol.asyncIterator] != null;
}
function assertNonNull(value) {
    if (value == null) {
        throw new Error("Assertion Failure: value must not be null nor undefined");
    }
}
async function* asyncIterableFromStream(stream) {
    const reader = stream.getReader();
    try {
        while(true){
            const { done , value  } = await reader.read();
            if (done) {
                return;
            }
            assertNonNull(value);
            yield value;
        }
    } finally{
        reader.releaseLock();
    }
}
function ensureAsyncIterabe(streamLike) {
    if (isAsyncIterable(streamLike)) {
        return streamLike;
    } else {
        return asyncIterableFromStream(streamLike);
    }
}
function decodeAsync(streamLike, options = defaultDecodeOptions) {
    const stream = ensureAsyncIterabe(streamLike);
    const decoder = new Decoder(options.extensionCodec, options.context, options.maxStrLength, options.maxBinLength, options.maxArrayLength, options.maxMapLength, options.maxExtLength);
    return decoder.decodeAsync(stream);
}
function decodeArrayStream(streamLike, options = defaultDecodeOptions) {
    const stream = ensureAsyncIterabe(streamLike);
    const decoder = new Decoder(options.extensionCodec, options.context, options.maxStrLength, options.maxBinLength, options.maxArrayLength, options.maxMapLength, options.maxExtLength);
    return decoder.decodeArrayStream(stream);
}
function decodeStream(streamLike, options = defaultDecodeOptions) {
    const stream = ensureAsyncIterabe(streamLike);
    const decoder = new Decoder(options.extensionCodec, options.context, options.maxStrLength, options.maxBinLength, options.maxArrayLength, options.maxMapLength, options.maxExtLength);
    return decoder.decodeStream(stream);
}
const mod7 = {
    encode: encode1,
    decode: decode1,
    decodeArrayStream: decodeArrayStream,
    decodeAsync: decodeAsync,
    decodeStream: decodeStream,
    Decoder: Decoder,
    Encoder: Encoder,
    ExtensionCodec: ExtensionCodec,
    ExtData: ExtData,
    decodeTimestampExtension: decodeTimestampExtension,
    decodeTimestampToTimeSpec: decodeTimestampToTimeSpec,
    encodeDateToTimeSpec: encodeDateToTimeSpec,
    encodeTimeSpecToTimestamp: encodeTimeSpecToTimestamp,
    encodeTimestampExtension: encodeTimestampExtension,
    EXT_TIMESTAMP: EXT_TIMESTAMP
};
const osType = (()=>{
    const { Deno: Deno1  } = globalThis;
    if (typeof Deno1?.build?.os === "string") {
        return Deno1.build.os;
    }
    const { navigator  } = globalThis;
    if (navigator?.appVersion?.includes?.("Win")) {
        return "windows";
    }
    return "linux";
})();
const isWindows = osType === "windows";
const CHAR_FORWARD_SLASH = 47;
function assertPath(path) {
    if (typeof path !== "string") {
        throw new TypeError(`Path must be a string. Received ${JSON.stringify(path)}`);
    }
}
function isPosixPathSeparator(code) {
    return code === 47;
}
function isPathSeparator(code) {
    return isPosixPathSeparator(code) || code === 92;
}
function isWindowsDeviceRoot(code) {
    return code >= 97 && code <= 122 || code >= 65 && code <= 90;
}
function normalizeString(path, allowAboveRoot, separator, isPathSeparator) {
    let res = "";
    let lastSegmentLength = 0;
    let lastSlash = -1;
    let dots = 0;
    let code;
    for(let i = 0, len = path.length; i <= len; ++i){
        if (i < len) code = path.charCodeAt(i);
        else if (isPathSeparator(code)) break;
        else code = CHAR_FORWARD_SLASH;
        if (isPathSeparator(code)) {
            if (lastSlash === i - 1 || dots === 1) {} else if (lastSlash !== i - 1 && dots === 2) {
                if (res.length < 2 || lastSegmentLength !== 2 || res.charCodeAt(res.length - 1) !== 46 || res.charCodeAt(res.length - 2) !== 46) {
                    if (res.length > 2) {
                        const lastSlashIndex = res.lastIndexOf(separator);
                        if (lastSlashIndex === -1) {
                            res = "";
                            lastSegmentLength = 0;
                        } else {
                            res = res.slice(0, lastSlashIndex);
                            lastSegmentLength = res.length - 1 - res.lastIndexOf(separator);
                        }
                        lastSlash = i;
                        dots = 0;
                        continue;
                    } else if (res.length === 2 || res.length === 1) {
                        res = "";
                        lastSegmentLength = 0;
                        lastSlash = i;
                        dots = 0;
                        continue;
                    }
                }
                if (allowAboveRoot) {
                    if (res.length > 0) res += `${separator}..`;
                    else res = "..";
                    lastSegmentLength = 2;
                }
            } else {
                if (res.length > 0) res += separator + path.slice(lastSlash + 1, i);
                else res = path.slice(lastSlash + 1, i);
                lastSegmentLength = i - lastSlash - 1;
            }
            lastSlash = i;
            dots = 0;
        } else if (code === 46 && dots !== -1) {
            ++dots;
        } else {
            dots = -1;
        }
    }
    return res;
}
function _format(sep, pathObject) {
    const dir = pathObject.dir || pathObject.root;
    const base = pathObject.base || (pathObject.name || "") + (pathObject.ext || "");
    if (!dir) return base;
    if (dir === pathObject.root) return dir + base;
    return dir + sep + base;
}
const WHITESPACE_ENCODINGS = {
    "\u0009": "%09",
    "\u000A": "%0A",
    "\u000B": "%0B",
    "\u000C": "%0C",
    "\u000D": "%0D",
    "\u0020": "%20"
};
function encodeWhitespace(string) {
    return string.replaceAll(/[\s]/g, (c)=>{
        return WHITESPACE_ENCODINGS[c] ?? c;
    });
}
const sep = "\\";
const delimiter = ";";
function resolve(...pathSegments) {
    let resolvedDevice = "";
    let resolvedTail = "";
    let resolvedAbsolute = false;
    for(let i = pathSegments.length - 1; i >= -1; i--){
        let path;
        const { Deno: Deno1  } = globalThis;
        if (i >= 0) {
            path = pathSegments[i];
        } else if (!resolvedDevice) {
            if (typeof Deno1?.cwd !== "function") {
                throw new TypeError("Resolved a drive-letter-less path without a CWD.");
            }
            path = Deno1.cwd();
        } else {
            if (typeof Deno1?.env?.get !== "function" || typeof Deno1?.cwd !== "function") {
                throw new TypeError("Resolved a relative path without a CWD.");
            }
            path = Deno1.cwd();
            if (path === undefined || path.slice(0, 3).toLowerCase() !== `${resolvedDevice.toLowerCase()}\\`) {
                path = `${resolvedDevice}\\`;
            }
        }
        assertPath(path);
        const len = path.length;
        if (len === 0) continue;
        let rootEnd = 0;
        let device = "";
        let isAbsolute = false;
        const code = path.charCodeAt(0);
        if (len > 1) {
            if (isPathSeparator(code)) {
                isAbsolute = true;
                if (isPathSeparator(path.charCodeAt(1))) {
                    let j = 2;
                    let last = j;
                    for(; j < len; ++j){
                        if (isPathSeparator(path.charCodeAt(j))) break;
                    }
                    if (j < len && j !== last) {
                        const firstPart = path.slice(last, j);
                        last = j;
                        for(; j < len; ++j){
                            if (!isPathSeparator(path.charCodeAt(j))) break;
                        }
                        if (j < len && j !== last) {
                            last = j;
                            for(; j < len; ++j){
                                if (isPathSeparator(path.charCodeAt(j))) break;
                            }
                            if (j === len) {
                                device = `\\\\${firstPart}\\${path.slice(last)}`;
                                rootEnd = j;
                            } else if (j !== last) {
                                device = `\\\\${firstPart}\\${path.slice(last, j)}`;
                                rootEnd = j;
                            }
                        }
                    }
                } else {
                    rootEnd = 1;
                }
            } else if (isWindowsDeviceRoot(code)) {
                if (path.charCodeAt(1) === 58) {
                    device = path.slice(0, 2);
                    rootEnd = 2;
                    if (len > 2) {
                        if (isPathSeparator(path.charCodeAt(2))) {
                            isAbsolute = true;
                            rootEnd = 3;
                        }
                    }
                }
            }
        } else if (isPathSeparator(code)) {
            rootEnd = 1;
            isAbsolute = true;
        }
        if (device.length > 0 && resolvedDevice.length > 0 && device.toLowerCase() !== resolvedDevice.toLowerCase()) {
            continue;
        }
        if (resolvedDevice.length === 0 && device.length > 0) {
            resolvedDevice = device;
        }
        if (!resolvedAbsolute) {
            resolvedTail = `${path.slice(rootEnd)}\\${resolvedTail}`;
            resolvedAbsolute = isAbsolute;
        }
        if (resolvedAbsolute && resolvedDevice.length > 0) break;
    }
    resolvedTail = normalizeString(resolvedTail, !resolvedAbsolute, "\\", isPathSeparator);
    return resolvedDevice + (resolvedAbsolute ? "\\" : "") + resolvedTail || ".";
}
function normalize(path) {
    assertPath(path);
    const len = path.length;
    if (len === 0) return ".";
    let rootEnd = 0;
    let device;
    let isAbsolute = false;
    const code = path.charCodeAt(0);
    if (len > 1) {
        if (isPathSeparator(code)) {
            isAbsolute = true;
            if (isPathSeparator(path.charCodeAt(1))) {
                let j = 2;
                let last = j;
                for(; j < len; ++j){
                    if (isPathSeparator(path.charCodeAt(j))) break;
                }
                if (j < len && j !== last) {
                    const firstPart = path.slice(last, j);
                    last = j;
                    for(; j < len; ++j){
                        if (!isPathSeparator(path.charCodeAt(j))) break;
                    }
                    if (j < len && j !== last) {
                        last = j;
                        for(; j < len; ++j){
                            if (isPathSeparator(path.charCodeAt(j))) break;
                        }
                        if (j === len) {
                            return `\\\\${firstPart}\\${path.slice(last)}\\`;
                        } else if (j !== last) {
                            device = `\\\\${firstPart}\\${path.slice(last, j)}`;
                            rootEnd = j;
                        }
                    }
                }
            } else {
                rootEnd = 1;
            }
        } else if (isWindowsDeviceRoot(code)) {
            if (path.charCodeAt(1) === 58) {
                device = path.slice(0, 2);
                rootEnd = 2;
                if (len > 2) {
                    if (isPathSeparator(path.charCodeAt(2))) {
                        isAbsolute = true;
                        rootEnd = 3;
                    }
                }
            }
        }
    } else if (isPathSeparator(code)) {
        return "\\";
    }
    let tail;
    if (rootEnd < len) {
        tail = normalizeString(path.slice(rootEnd), !isAbsolute, "\\", isPathSeparator);
    } else {
        tail = "";
    }
    if (tail.length === 0 && !isAbsolute) tail = ".";
    if (tail.length > 0 && isPathSeparator(path.charCodeAt(len - 1))) {
        tail += "\\";
    }
    if (device === undefined) {
        if (isAbsolute) {
            if (tail.length > 0) return `\\${tail}`;
            else return "\\";
        } else if (tail.length > 0) {
            return tail;
        } else {
            return "";
        }
    } else if (isAbsolute) {
        if (tail.length > 0) return `${device}\\${tail}`;
        else return `${device}\\`;
    } else if (tail.length > 0) {
        return device + tail;
    } else {
        return device;
    }
}
function isAbsolute(path) {
    assertPath(path);
    const len = path.length;
    if (len === 0) return false;
    const code = path.charCodeAt(0);
    if (isPathSeparator(code)) {
        return true;
    } else if (isWindowsDeviceRoot(code)) {
        if (len > 2 && path.charCodeAt(1) === 58) {
            if (isPathSeparator(path.charCodeAt(2))) return true;
        }
    }
    return false;
}
function join(...paths) {
    const pathsCount = paths.length;
    if (pathsCount === 0) return ".";
    let joined;
    let firstPart = null;
    for(let i = 0; i < pathsCount; ++i){
        const path = paths[i];
        assertPath(path);
        if (path.length > 0) {
            if (joined === undefined) joined = firstPart = path;
            else joined += `\\${path}`;
        }
    }
    if (joined === undefined) return ".";
    let needsReplace = true;
    let slashCount = 0;
    assert(firstPart != null);
    if (isPathSeparator(firstPart.charCodeAt(0))) {
        ++slashCount;
        const firstLen = firstPart.length;
        if (firstLen > 1) {
            if (isPathSeparator(firstPart.charCodeAt(1))) {
                ++slashCount;
                if (firstLen > 2) {
                    if (isPathSeparator(firstPart.charCodeAt(2))) ++slashCount;
                    else {
                        needsReplace = false;
                    }
                }
            }
        }
    }
    if (needsReplace) {
        for(; slashCount < joined.length; ++slashCount){
            if (!isPathSeparator(joined.charCodeAt(slashCount))) break;
        }
        if (slashCount >= 2) joined = `\\${joined.slice(slashCount)}`;
    }
    return normalize(joined);
}
function relative(from, to) {
    assertPath(from);
    assertPath(to);
    if (from === to) return "";
    const fromOrig = resolve(from);
    const toOrig = resolve(to);
    if (fromOrig === toOrig) return "";
    from = fromOrig.toLowerCase();
    to = toOrig.toLowerCase();
    if (from === to) return "";
    let fromStart = 0;
    let fromEnd = from.length;
    for(; fromStart < fromEnd; ++fromStart){
        if (from.charCodeAt(fromStart) !== 92) break;
    }
    for(; fromEnd - 1 > fromStart; --fromEnd){
        if (from.charCodeAt(fromEnd - 1) !== 92) break;
    }
    const fromLen = fromEnd - fromStart;
    let toStart = 0;
    let toEnd = to.length;
    for(; toStart < toEnd; ++toStart){
        if (to.charCodeAt(toStart) !== 92) break;
    }
    for(; toEnd - 1 > toStart; --toEnd){
        if (to.charCodeAt(toEnd - 1) !== 92) break;
    }
    const toLen = toEnd - toStart;
    const length = fromLen < toLen ? fromLen : toLen;
    let lastCommonSep = -1;
    let i = 0;
    for(; i <= length; ++i){
        if (i === length) {
            if (toLen > length) {
                if (to.charCodeAt(toStart + i) === 92) {
                    return toOrig.slice(toStart + i + 1);
                } else if (i === 2) {
                    return toOrig.slice(toStart + i);
                }
            }
            if (fromLen > length) {
                if (from.charCodeAt(fromStart + i) === 92) {
                    lastCommonSep = i;
                } else if (i === 2) {
                    lastCommonSep = 3;
                }
            }
            break;
        }
        const fromCode = from.charCodeAt(fromStart + i);
        const toCode = to.charCodeAt(toStart + i);
        if (fromCode !== toCode) break;
        else if (fromCode === 92) lastCommonSep = i;
    }
    if (i !== length && lastCommonSep === -1) {
        return toOrig;
    }
    let out = "";
    if (lastCommonSep === -1) lastCommonSep = 0;
    for(i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i){
        if (i === fromEnd || from.charCodeAt(i) === 92) {
            if (out.length === 0) out += "..";
            else out += "\\..";
        }
    }
    if (out.length > 0) {
        return out + toOrig.slice(toStart + lastCommonSep, toEnd);
    } else {
        toStart += lastCommonSep;
        if (toOrig.charCodeAt(toStart) === 92) ++toStart;
        return toOrig.slice(toStart, toEnd);
    }
}
function toNamespacedPath(path) {
    if (typeof path !== "string") return path;
    if (path.length === 0) return "";
    const resolvedPath = resolve(path);
    if (resolvedPath.length >= 3) {
        if (resolvedPath.charCodeAt(0) === 92) {
            if (resolvedPath.charCodeAt(1) === 92) {
                const code = resolvedPath.charCodeAt(2);
                if (code !== 63 && code !== 46) {
                    return `\\\\?\\UNC\\${resolvedPath.slice(2)}`;
                }
            }
        } else if (isWindowsDeviceRoot(resolvedPath.charCodeAt(0))) {
            if (resolvedPath.charCodeAt(1) === 58 && resolvedPath.charCodeAt(2) === 92) {
                return `\\\\?\\${resolvedPath}`;
            }
        }
    }
    return path;
}
function dirname(path) {
    assertPath(path);
    const len = path.length;
    if (len === 0) return ".";
    let rootEnd = -1;
    let end = -1;
    let matchedSlash = true;
    let offset = 0;
    const code = path.charCodeAt(0);
    if (len > 1) {
        if (isPathSeparator(code)) {
            rootEnd = offset = 1;
            if (isPathSeparator(path.charCodeAt(1))) {
                let j = 2;
                let last = j;
                for(; j < len; ++j){
                    if (isPathSeparator(path.charCodeAt(j))) break;
                }
                if (j < len && j !== last) {
                    last = j;
                    for(; j < len; ++j){
                        if (!isPathSeparator(path.charCodeAt(j))) break;
                    }
                    if (j < len && j !== last) {
                        last = j;
                        for(; j < len; ++j){
                            if (isPathSeparator(path.charCodeAt(j))) break;
                        }
                        if (j === len) {
                            return path;
                        }
                        if (j !== last) {
                            rootEnd = offset = j + 1;
                        }
                    }
                }
            }
        } else if (isWindowsDeviceRoot(code)) {
            if (path.charCodeAt(1) === 58) {
                rootEnd = offset = 2;
                if (len > 2) {
                    if (isPathSeparator(path.charCodeAt(2))) rootEnd = offset = 3;
                }
            }
        }
    } else if (isPathSeparator(code)) {
        return path;
    }
    for(let i = len - 1; i >= offset; --i){
        if (isPathSeparator(path.charCodeAt(i))) {
            if (!matchedSlash) {
                end = i;
                break;
            }
        } else {
            matchedSlash = false;
        }
    }
    if (end === -1) {
        if (rootEnd === -1) return ".";
        else end = rootEnd;
    }
    return path.slice(0, end);
}
function basename(path, ext = "") {
    if (ext !== undefined && typeof ext !== "string") {
        throw new TypeError('"ext" argument must be a string');
    }
    assertPath(path);
    let start = 0;
    let end = -1;
    let matchedSlash = true;
    let i;
    if (path.length >= 2) {
        const drive = path.charCodeAt(0);
        if (isWindowsDeviceRoot(drive)) {
            if (path.charCodeAt(1) === 58) start = 2;
        }
    }
    if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {
        if (ext.length === path.length && ext === path) return "";
        let extIdx = ext.length - 1;
        let firstNonSlashEnd = -1;
        for(i = path.length - 1; i >= start; --i){
            const code = path.charCodeAt(i);
            if (isPathSeparator(code)) {
                if (!matchedSlash) {
                    start = i + 1;
                    break;
                }
            } else {
                if (firstNonSlashEnd === -1) {
                    matchedSlash = false;
                    firstNonSlashEnd = i + 1;
                }
                if (extIdx >= 0) {
                    if (code === ext.charCodeAt(extIdx)) {
                        if (--extIdx === -1) {
                            end = i;
                        }
                    } else {
                        extIdx = -1;
                        end = firstNonSlashEnd;
                    }
                }
            }
        }
        if (start === end) end = firstNonSlashEnd;
        else if (end === -1) end = path.length;
        return path.slice(start, end);
    } else {
        for(i = path.length - 1; i >= start; --i){
            if (isPathSeparator(path.charCodeAt(i))) {
                if (!matchedSlash) {
                    start = i + 1;
                    break;
                }
            } else if (end === -1) {
                matchedSlash = false;
                end = i + 1;
            }
        }
        if (end === -1) return "";
        return path.slice(start, end);
    }
}
function extname(path) {
    assertPath(path);
    let start = 0;
    let startDot = -1;
    let startPart = 0;
    let end = -1;
    let matchedSlash = true;
    let preDotState = 0;
    if (path.length >= 2 && path.charCodeAt(1) === 58 && isWindowsDeviceRoot(path.charCodeAt(0))) {
        start = startPart = 2;
    }
    for(let i = path.length - 1; i >= start; --i){
        const code = path.charCodeAt(i);
        if (isPathSeparator(code)) {
            if (!matchedSlash) {
                startPart = i + 1;
                break;
            }
            continue;
        }
        if (end === -1) {
            matchedSlash = false;
            end = i + 1;
        }
        if (code === 46) {
            if (startDot === -1) startDot = i;
            else if (preDotState !== 1) preDotState = 1;
        } else if (startDot !== -1) {
            preDotState = -1;
        }
    }
    if (startDot === -1 || end === -1 || preDotState === 0 || preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {
        return "";
    }
    return path.slice(startDot, end);
}
function format(pathObject) {
    if (pathObject === null || typeof pathObject !== "object") {
        throw new TypeError(`The "pathObject" argument must be of type Object. Received type ${typeof pathObject}`);
    }
    return _format("\\", pathObject);
}
function parse1(path) {
    assertPath(path);
    const ret = {
        root: "",
        dir: "",
        base: "",
        ext: "",
        name: ""
    };
    const len = path.length;
    if (len === 0) return ret;
    let rootEnd = 0;
    let code = path.charCodeAt(0);
    if (len > 1) {
        if (isPathSeparator(code)) {
            rootEnd = 1;
            if (isPathSeparator(path.charCodeAt(1))) {
                let j = 2;
                let last = j;
                for(; j < len; ++j){
                    if (isPathSeparator(path.charCodeAt(j))) break;
                }
                if (j < len && j !== last) {
                    last = j;
                    for(; j < len; ++j){
                        if (!isPathSeparator(path.charCodeAt(j))) break;
                    }
                    if (j < len && j !== last) {
                        last = j;
                        for(; j < len; ++j){
                            if (isPathSeparator(path.charCodeAt(j))) break;
                        }
                        if (j === len) {
                            rootEnd = j;
                        } else if (j !== last) {
                            rootEnd = j + 1;
                        }
                    }
                }
            }
        } else if (isWindowsDeviceRoot(code)) {
            if (path.charCodeAt(1) === 58) {
                rootEnd = 2;
                if (len > 2) {
                    if (isPathSeparator(path.charCodeAt(2))) {
                        if (len === 3) {
                            ret.root = ret.dir = path;
                            return ret;
                        }
                        rootEnd = 3;
                    }
                } else {
                    ret.root = ret.dir = path;
                    return ret;
                }
            }
        }
    } else if (isPathSeparator(code)) {
        ret.root = ret.dir = path;
        return ret;
    }
    if (rootEnd > 0) ret.root = path.slice(0, rootEnd);
    let startDot = -1;
    let startPart = rootEnd;
    let end = -1;
    let matchedSlash = true;
    let i = path.length - 1;
    let preDotState = 0;
    for(; i >= rootEnd; --i){
        code = path.charCodeAt(i);
        if (isPathSeparator(code)) {
            if (!matchedSlash) {
                startPart = i + 1;
                break;
            }
            continue;
        }
        if (end === -1) {
            matchedSlash = false;
            end = i + 1;
        }
        if (code === 46) {
            if (startDot === -1) startDot = i;
            else if (preDotState !== 1) preDotState = 1;
        } else if (startDot !== -1) {
            preDotState = -1;
        }
    }
    if (startDot === -1 || end === -1 || preDotState === 0 || preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {
        if (end !== -1) {
            ret.base = ret.name = path.slice(startPart, end);
        }
    } else {
        ret.name = path.slice(startPart, startDot);
        ret.base = path.slice(startPart, end);
        ret.ext = path.slice(startDot, end);
    }
    if (startPart > 0 && startPart !== rootEnd) {
        ret.dir = path.slice(0, startPart - 1);
    } else ret.dir = ret.root;
    return ret;
}
function fromFileUrl(url) {
    url = url instanceof URL ? url : new URL(url);
    if (url.protocol != "file:") {
        throw new TypeError("Must be a file URL.");
    }
    let path = decodeURIComponent(url.pathname.replace(/\//g, "\\").replace(/%(?![0-9A-Fa-f]{2})/g, "%25")).replace(/^\\*([A-Za-z]:)(\\|$)/, "$1\\");
    if (url.hostname != "") {
        path = `\\\\${url.hostname}${path}`;
    }
    return path;
}
function toFileUrl(path) {
    if (!isAbsolute(path)) {
        throw new TypeError("Must be an absolute path.");
    }
    const [, hostname, pathname] = path.match(/^(?:[/\\]{2}([^/\\]+)(?=[/\\](?:[^/\\]|$)))?(.*)/);
    const url = new URL("file:///");
    url.pathname = encodeWhitespace(pathname.replace(/%/g, "%25"));
    if (hostname != null && hostname != "localhost") {
        url.hostname = hostname;
        if (!url.hostname) {
            throw new TypeError("Invalid hostname.");
        }
    }
    return url;
}
const mod8 = {
    sep: sep,
    delimiter: delimiter,
    resolve: resolve,
    normalize: normalize,
    isAbsolute: isAbsolute,
    join: join,
    relative: relative,
    toNamespacedPath: toNamespacedPath,
    dirname: dirname,
    basename: basename,
    extname: extname,
    format: format,
    parse: parse1,
    fromFileUrl: fromFileUrl,
    toFileUrl: toFileUrl
};
const sep1 = "/";
const delimiter1 = ":";
function resolve1(...pathSegments) {
    let resolvedPath = "";
    let resolvedAbsolute = false;
    for(let i = pathSegments.length - 1; i >= -1 && !resolvedAbsolute; i--){
        let path;
        if (i >= 0) path = pathSegments[i];
        else {
            const { Deno: Deno1  } = globalThis;
            if (typeof Deno1?.cwd !== "function") {
                throw new TypeError("Resolved a relative path without a CWD.");
            }
            path = Deno1.cwd();
        }
        assertPath(path);
        if (path.length === 0) {
            continue;
        }
        resolvedPath = `${path}/${resolvedPath}`;
        resolvedAbsolute = path.charCodeAt(0) === CHAR_FORWARD_SLASH;
    }
    resolvedPath = normalizeString(resolvedPath, !resolvedAbsolute, "/", isPosixPathSeparator);
    if (resolvedAbsolute) {
        if (resolvedPath.length > 0) return `/${resolvedPath}`;
        else return "/";
    } else if (resolvedPath.length > 0) return resolvedPath;
    else return ".";
}
function normalize1(path) {
    assertPath(path);
    if (path.length === 0) return ".";
    const isAbsolute = path.charCodeAt(0) === 47;
    const trailingSeparator = path.charCodeAt(path.length - 1) === 47;
    path = normalizeString(path, !isAbsolute, "/", isPosixPathSeparator);
    if (path.length === 0 && !isAbsolute) path = ".";
    if (path.length > 0 && trailingSeparator) path += "/";
    if (isAbsolute) return `/${path}`;
    return path;
}
function isAbsolute1(path) {
    assertPath(path);
    return path.length > 0 && path.charCodeAt(0) === 47;
}
function join1(...paths) {
    if (paths.length === 0) return ".";
    let joined;
    for(let i = 0, len = paths.length; i < len; ++i){
        const path = paths[i];
        assertPath(path);
        if (path.length > 0) {
            if (!joined) joined = path;
            else joined += `/${path}`;
        }
    }
    if (!joined) return ".";
    return normalize1(joined);
}
function relative1(from, to) {
    assertPath(from);
    assertPath(to);
    if (from === to) return "";
    from = resolve1(from);
    to = resolve1(to);
    if (from === to) return "";
    let fromStart = 1;
    const fromEnd = from.length;
    for(; fromStart < fromEnd; ++fromStart){
        if (from.charCodeAt(fromStart) !== 47) break;
    }
    const fromLen = fromEnd - fromStart;
    let toStart = 1;
    const toEnd = to.length;
    for(; toStart < toEnd; ++toStart){
        if (to.charCodeAt(toStart) !== 47) break;
    }
    const toLen = toEnd - toStart;
    const length = fromLen < toLen ? fromLen : toLen;
    let lastCommonSep = -1;
    let i = 0;
    for(; i <= length; ++i){
        if (i === length) {
            if (toLen > length) {
                if (to.charCodeAt(toStart + i) === 47) {
                    return to.slice(toStart + i + 1);
                } else if (i === 0) {
                    return to.slice(toStart + i);
                }
            } else if (fromLen > length) {
                if (from.charCodeAt(fromStart + i) === 47) {
                    lastCommonSep = i;
                } else if (i === 0) {
                    lastCommonSep = 0;
                }
            }
            break;
        }
        const fromCode = from.charCodeAt(fromStart + i);
        const toCode = to.charCodeAt(toStart + i);
        if (fromCode !== toCode) break;
        else if (fromCode === 47) lastCommonSep = i;
    }
    let out = "";
    for(i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i){
        if (i === fromEnd || from.charCodeAt(i) === 47) {
            if (out.length === 0) out += "..";
            else out += "/..";
        }
    }
    if (out.length > 0) return out + to.slice(toStart + lastCommonSep);
    else {
        toStart += lastCommonSep;
        if (to.charCodeAt(toStart) === 47) ++toStart;
        return to.slice(toStart);
    }
}
function toNamespacedPath1(path) {
    return path;
}
function dirname1(path) {
    assertPath(path);
    if (path.length === 0) return ".";
    const hasRoot = path.charCodeAt(0) === 47;
    let end = -1;
    let matchedSlash = true;
    for(let i = path.length - 1; i >= 1; --i){
        if (path.charCodeAt(i) === 47) {
            if (!matchedSlash) {
                end = i;
                break;
            }
        } else {
            matchedSlash = false;
        }
    }
    if (end === -1) return hasRoot ? "/" : ".";
    if (hasRoot && end === 1) return "//";
    return path.slice(0, end);
}
function basename1(path, ext = "") {
    if (ext !== undefined && typeof ext !== "string") {
        throw new TypeError('"ext" argument must be a string');
    }
    assertPath(path);
    let start = 0;
    let end = -1;
    let matchedSlash = true;
    let i;
    if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {
        if (ext.length === path.length && ext === path) return "";
        let extIdx = ext.length - 1;
        let firstNonSlashEnd = -1;
        for(i = path.length - 1; i >= 0; --i){
            const code = path.charCodeAt(i);
            if (code === 47) {
                if (!matchedSlash) {
                    start = i + 1;
                    break;
                }
            } else {
                if (firstNonSlashEnd === -1) {
                    matchedSlash = false;
                    firstNonSlashEnd = i + 1;
                }
                if (extIdx >= 0) {
                    if (code === ext.charCodeAt(extIdx)) {
                        if (--extIdx === -1) {
                            end = i;
                        }
                    } else {
                        extIdx = -1;
                        end = firstNonSlashEnd;
                    }
                }
            }
        }
        if (start === end) end = firstNonSlashEnd;
        else if (end === -1) end = path.length;
        return path.slice(start, end);
    } else {
        for(i = path.length - 1; i >= 0; --i){
            if (path.charCodeAt(i) === 47) {
                if (!matchedSlash) {
                    start = i + 1;
                    break;
                }
            } else if (end === -1) {
                matchedSlash = false;
                end = i + 1;
            }
        }
        if (end === -1) return "";
        return path.slice(start, end);
    }
}
function extname1(path) {
    assertPath(path);
    let startDot = -1;
    let startPart = 0;
    let end = -1;
    let matchedSlash = true;
    let preDotState = 0;
    for(let i = path.length - 1; i >= 0; --i){
        const code = path.charCodeAt(i);
        if (code === 47) {
            if (!matchedSlash) {
                startPart = i + 1;
                break;
            }
            continue;
        }
        if (end === -1) {
            matchedSlash = false;
            end = i + 1;
        }
        if (code === 46) {
            if (startDot === -1) startDot = i;
            else if (preDotState !== 1) preDotState = 1;
        } else if (startDot !== -1) {
            preDotState = -1;
        }
    }
    if (startDot === -1 || end === -1 || preDotState === 0 || preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {
        return "";
    }
    return path.slice(startDot, end);
}
function format1(pathObject) {
    if (pathObject === null || typeof pathObject !== "object") {
        throw new TypeError(`The "pathObject" argument must be of type Object. Received type ${typeof pathObject}`);
    }
    return _format("/", pathObject);
}
function parse2(path) {
    assertPath(path);
    const ret = {
        root: "",
        dir: "",
        base: "",
        ext: "",
        name: ""
    };
    if (path.length === 0) return ret;
    const isAbsolute = path.charCodeAt(0) === 47;
    let start;
    if (isAbsolute) {
        ret.root = "/";
        start = 1;
    } else {
        start = 0;
    }
    let startDot = -1;
    let startPart = 0;
    let end = -1;
    let matchedSlash = true;
    let i = path.length - 1;
    let preDotState = 0;
    for(; i >= start; --i){
        const code = path.charCodeAt(i);
        if (code === 47) {
            if (!matchedSlash) {
                startPart = i + 1;
                break;
            }
            continue;
        }
        if (end === -1) {
            matchedSlash = false;
            end = i + 1;
        }
        if (code === 46) {
            if (startDot === -1) startDot = i;
            else if (preDotState !== 1) preDotState = 1;
        } else if (startDot !== -1) {
            preDotState = -1;
        }
    }
    if (startDot === -1 || end === -1 || preDotState === 0 || preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {
        if (end !== -1) {
            if (startPart === 0 && isAbsolute) {
                ret.base = ret.name = path.slice(1, end);
            } else {
                ret.base = ret.name = path.slice(startPart, end);
            }
        }
    } else {
        if (startPart === 0 && isAbsolute) {
            ret.name = path.slice(1, startDot);
            ret.base = path.slice(1, end);
        } else {
            ret.name = path.slice(startPart, startDot);
            ret.base = path.slice(startPart, end);
        }
        ret.ext = path.slice(startDot, end);
    }
    if (startPart > 0) ret.dir = path.slice(0, startPart - 1);
    else if (isAbsolute) ret.dir = "/";
    return ret;
}
function fromFileUrl1(url) {
    url = url instanceof URL ? url : new URL(url);
    if (url.protocol != "file:") {
        throw new TypeError("Must be a file URL.");
    }
    return decodeURIComponent(url.pathname.replace(/%(?![0-9A-Fa-f]{2})/g, "%25"));
}
function toFileUrl1(path) {
    if (!isAbsolute1(path)) {
        throw new TypeError("Must be an absolute path.");
    }
    const url = new URL("file:///");
    url.pathname = encodeWhitespace(path.replace(/%/g, "%25").replace(/\\/g, "%5C"));
    return url;
}
const mod9 = {
    sep: sep1,
    delimiter: delimiter1,
    resolve: resolve1,
    normalize: normalize1,
    isAbsolute: isAbsolute1,
    join: join1,
    relative: relative1,
    toNamespacedPath: toNamespacedPath1,
    dirname: dirname1,
    basename: basename1,
    extname: extname1,
    format: format1,
    parse: parse2,
    fromFileUrl: fromFileUrl1,
    toFileUrl: toFileUrl1
};
const SEP = isWindows ? "\\" : "/";
const SEP_PATTERN = isWindows ? /[\\/]+/ : /\/+/;
function common(paths, sep = SEP) {
    const [first = "", ...remaining] = paths;
    if (first === "" || remaining.length === 0) {
        return first.substring(0, first.lastIndexOf(sep) + 1);
    }
    const parts = first.split(sep);
    let endOfPrefix = parts.length;
    for (const path of remaining){
        const compare = path.split(sep);
        for(let i = 0; i < endOfPrefix; i++){
            if (compare[i] !== parts[i]) {
                endOfPrefix = i;
            }
        }
        if (endOfPrefix === 0) {
            return "";
        }
    }
    const prefix = parts.slice(0, endOfPrefix).join(sep);
    return prefix.endsWith(sep) ? prefix : `${prefix}${sep}`;
}
const path = isWindows ? mod8 : mod9;
const { join: join2 , normalize: normalize2  } = path;
const regExpEscapeChars = [
    "!",
    "$",
    "(",
    ")",
    "*",
    "+",
    ".",
    "=",
    "?",
    "[",
    "\\",
    "^",
    "{",
    "|"
];
const rangeEscapeChars = [
    "-",
    "\\",
    "]"
];
function globToRegExp(glob, { extended =true , globstar: globstarOption = true , os =osType , caseInsensitive =false  } = {}) {
    if (glob == "") {
        return /(?!)/;
    }
    const sep = os == "windows" ? "(?:\\\\|/)+" : "/+";
    const sepMaybe = os == "windows" ? "(?:\\\\|/)*" : "/*";
    const seps = os == "windows" ? [
        "\\",
        "/"
    ] : [
        "/"
    ];
    const globstar = os == "windows" ? "(?:[^\\\\/]*(?:\\\\|/|$)+)*" : "(?:[^/]*(?:/|$)+)*";
    const wildcard = os == "windows" ? "[^\\\\/]*" : "[^/]*";
    const escapePrefix = os == "windows" ? "`" : "\\";
    let newLength = glob.length;
    for(; newLength > 1 && seps.includes(glob[newLength - 1]); newLength--);
    glob = glob.slice(0, newLength);
    let regExpString = "";
    for(let j = 0; j < glob.length;){
        let segment = "";
        const groupStack = [];
        let inRange = false;
        let inEscape = false;
        let endsWithSep = false;
        let i = j;
        for(; i < glob.length && !seps.includes(glob[i]); i++){
            if (inEscape) {
                inEscape = false;
                const escapeChars = inRange ? rangeEscapeChars : regExpEscapeChars;
                segment += escapeChars.includes(glob[i]) ? `\\${glob[i]}` : glob[i];
                continue;
            }
            if (glob[i] == escapePrefix) {
                inEscape = true;
                continue;
            }
            if (glob[i] == "[") {
                if (!inRange) {
                    inRange = true;
                    segment += "[";
                    if (glob[i + 1] == "!") {
                        i++;
                        segment += "^";
                    } else if (glob[i + 1] == "^") {
                        i++;
                        segment += "\\^";
                    }
                    continue;
                } else if (glob[i + 1] == ":") {
                    let k = i + 1;
                    let value = "";
                    while(glob[k + 1] != null && glob[k + 1] != ":"){
                        value += glob[k + 1];
                        k++;
                    }
                    if (glob[k + 1] == ":" && glob[k + 2] == "]") {
                        i = k + 2;
                        if (value == "alnum") segment += "\\dA-Za-z";
                        else if (value == "alpha") segment += "A-Za-z";
                        else if (value == "ascii") segment += "\x00-\x7F";
                        else if (value == "blank") segment += "\t ";
                        else if (value == "cntrl") segment += "\x00-\x1F\x7F";
                        else if (value == "digit") segment += "\\d";
                        else if (value == "graph") segment += "\x21-\x7E";
                        else if (value == "lower") segment += "a-z";
                        else if (value == "print") segment += "\x20-\x7E";
                        else if (value == "punct") {
                            segment += "!\"#$%&'()*+,\\-./:;<=>?@[\\\\\\]^_‚Äò{|}~";
                        } else if (value == "space") segment += "\\s\v";
                        else if (value == "upper") segment += "A-Z";
                        else if (value == "word") segment += "\\w";
                        else if (value == "xdigit") segment += "\\dA-Fa-f";
                        continue;
                    }
                }
            }
            if (glob[i] == "]" && inRange) {
                inRange = false;
                segment += "]";
                continue;
            }
            if (inRange) {
                if (glob[i] == "\\") {
                    segment += `\\\\`;
                } else {
                    segment += glob[i];
                }
                continue;
            }
            if (glob[i] == ")" && groupStack.length > 0 && groupStack[groupStack.length - 1] != "BRACE") {
                segment += ")";
                const type = groupStack.pop();
                if (type == "!") {
                    segment += wildcard;
                } else if (type != "@") {
                    segment += type;
                }
                continue;
            }
            if (glob[i] == "|" && groupStack.length > 0 && groupStack[groupStack.length - 1] != "BRACE") {
                segment += "|";
                continue;
            }
            if (glob[i] == "+" && extended && glob[i + 1] == "(") {
                i++;
                groupStack.push("+");
                segment += "(?:";
                continue;
            }
            if (glob[i] == "@" && extended && glob[i + 1] == "(") {
                i++;
                groupStack.push("@");
                segment += "(?:";
                continue;
            }
            if (glob[i] == "?") {
                if (extended && glob[i + 1] == "(") {
                    i++;
                    groupStack.push("?");
                    segment += "(?:";
                } else {
                    segment += ".";
                }
                continue;
            }
            if (glob[i] == "!" && extended && glob[i + 1] == "(") {
                i++;
                groupStack.push("!");
                segment += "(?!";
                continue;
            }
            if (glob[i] == "{") {
                groupStack.push("BRACE");
                segment += "(?:";
                continue;
            }
            if (glob[i] == "}" && groupStack[groupStack.length - 1] == "BRACE") {
                groupStack.pop();
                segment += ")";
                continue;
            }
            if (glob[i] == "," && groupStack[groupStack.length - 1] == "BRACE") {
                segment += "|";
                continue;
            }
            if (glob[i] == "*") {
                if (extended && glob[i + 1] == "(") {
                    i++;
                    groupStack.push("*");
                    segment += "(?:";
                } else {
                    const prevChar = glob[i - 1];
                    let numStars = 1;
                    while(glob[i + 1] == "*"){
                        i++;
                        numStars++;
                    }
                    const nextChar = glob[i + 1];
                    if (globstarOption && numStars == 2 && [
                        ...seps,
                        undefined
                    ].includes(prevChar) && [
                        ...seps,
                        undefined
                    ].includes(nextChar)) {
                        segment += globstar;
                        endsWithSep = true;
                    } else {
                        segment += wildcard;
                    }
                }
                continue;
            }
            segment += regExpEscapeChars.includes(glob[i]) ? `\\${glob[i]}` : glob[i];
        }
        if (groupStack.length > 0 || inRange || inEscape) {
            segment = "";
            for (const c of glob.slice(j, i)){
                segment += regExpEscapeChars.includes(c) ? `\\${c}` : c;
                endsWithSep = false;
            }
        }
        regExpString += segment;
        if (!endsWithSep) {
            regExpString += i < glob.length ? sep : sepMaybe;
            endsWithSep = true;
        }
        while(seps.includes(glob[i]))i++;
        if (!(i > j)) {
            throw new Error("Assertion failure: i > j (potential infinite loop)");
        }
        j = i;
    }
    regExpString = `^${regExpString}$`;
    return new RegExp(regExpString, caseInsensitive ? "i" : "");
}
function isGlob(str) {
    const chars = {
        "{": "}",
        "(": ")",
        "[": "]"
    };
    const regex = /\\(.)|(^!|\*|\?|[\].+)]\?|\[[^\\\]]+\]|\{[^\\}]+\}|\(\?[:!=][^\\)]+\)|\([^|]+\|[^\\)]+\))/;
    if (str === "") {
        return false;
    }
    let match;
    while(match = regex.exec(str)){
        if (match[2]) return true;
        let idx = match.index + match[0].length;
        const open = match[1];
        const close = open ? chars[open] : null;
        if (open && close) {
            const n = str.indexOf(close, idx);
            if (n !== -1) {
                idx = n + 1;
            }
        }
        str = str.slice(idx);
    }
    return false;
}
function normalizeGlob(glob, { globstar =false  } = {}) {
    if (glob.match(/\0/g)) {
        throw new Error(`Glob contains invalid characters: "${glob}"`);
    }
    if (!globstar) {
        return normalize2(glob);
    }
    const s = SEP_PATTERN.source;
    const badParentPattern = new RegExp(`(?<=(${s}|^)\\*\\*${s})\\.\\.(?=${s}|$)`, "g");
    return normalize2(glob.replace(badParentPattern, "\0")).replace(/\0/g, "..");
}
function joinGlobs(globs, { extended =true , globstar =false  } = {}) {
    if (!globstar || globs.length == 0) {
        return join2(...globs);
    }
    if (globs.length === 0) return ".";
    let joined;
    for (const glob of globs){
        const path = glob;
        if (path.length > 0) {
            if (!joined) joined = path;
            else joined += `${SEP}${path}`;
        }
    }
    if (!joined) return ".";
    return normalizeGlob(joined, {
        extended,
        globstar
    });
}
const path1 = isWindows ? mod8 : mod9;
const { basename: basename2 , delimiter: delimiter2 , dirname: dirname2 , extname: extname2 , format: format2 , fromFileUrl: fromFileUrl2 , isAbsolute: isAbsolute2 , join: join3 , normalize: normalize3 , parse: parse3 , relative: relative2 , resolve: resolve2 , sep: sep2 , toFileUrl: toFileUrl2 , toNamespacedPath: toNamespacedPath2  } = path1;
const mod10 = {
    SEP: SEP,
    SEP_PATTERN: SEP_PATTERN,
    win32: mod8,
    posix: mod9,
    basename: basename2,
    delimiter: delimiter2,
    dirname: dirname2,
    extname: extname2,
    format: format2,
    fromFileUrl: fromFileUrl2,
    isAbsolute: isAbsolute2,
    join: join3,
    normalize: normalize3,
    parse: parse3,
    relative: relative2,
    resolve: resolve2,
    sep: sep2,
    toFileUrl: toFileUrl2,
    toNamespacedPath: toNamespacedPath2,
    common,
    globToRegExp,
    isGlob,
    normalizeGlob,
    joinGlobs
};
const { Deno: Deno1  } = globalThis;
const noColor = typeof Deno1?.noColor === "boolean" ? Deno1.noColor : true;
let enabled = !noColor;
function code(open, close) {
    return {
        open: `\x1b[${open.join(";")}m`,
        close: `\x1b[${close}m`,
        regexp: new RegExp(`\\x1b\\[${close}m`, "g")
    };
}
function run(str, code) {
    return enabled ? `${code.open}${str.replace(code.regexp, code.open)}${code.close}` : str;
}
function bgGreen(str) {
    return run(str, code([
        42
    ], 49));
}
function bgWhite(str) {
    return run(str, code([
        47
    ], 49));
}
new RegExp([
    "[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)",
    "(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]))"
].join("|"), "g");
function writeAllSync(w, arr) {
    let nwritten = 0;
    while(nwritten < arr.length){
        nwritten += w.writeSync(arr.subarray(nwritten));
    }
}
const isTTY = Deno.stdout && Deno.isatty(Deno.stdout.rid);
const isWindow = Deno.build.os === "windows";
class MultiProgressBar {
    width;
    complete;
    incomplete;
    clear;
    interval;
    display;
    #end = false;
    #startIndex = 0;
    #lastRows = 0;
    #strs = [];
    lastStr = "";
    start = Date.now();
    lastRender = 0;
    encoder = new TextEncoder();
    constructor({ title ="" , width =50 , complete =bgGreen(" ") , incomplete =bgWhite(" ") , clear =false , interval , display  } = {}){
        if (title != "") {
            this.#strs.push(title);
            this.#startIndex = 1;
        }
        this.width = width;
        this.complete = complete;
        this.incomplete = incomplete;
        this.clear = clear;
        this.interval = interval ?? 16;
        this.display = display ?? ":bar :text :percent :time :completed/:total";
    }
    render(bars) {
        if (this.#end || !isTTY) return;
        const now = Date.now();
        const ms = now - this.lastRender;
        this.lastRender = now;
        const time = ((now - this.start) / 1000).toFixed(1) + "s";
        let end = true;
        let index = this.#startIndex;
        for (const { completed , total =100 , text ="" , ...options } of bars){
            if (completed < 0) {
                throw new Error(`completed must greater than or equal to 0`);
            }
            if (!Number.isInteger(total)) throw new Error(`total must be 'number'`);
            if (completed > total && this.#strs[index] != undefined) continue;
            end = false;
            const percent = (completed / total * 100).toFixed(2) + "%";
            const eta = completed == 0 ? "-" : (completed >= total ? 0 : (total / completed - 1) * (now - this.start) / 1000).toFixed(1) + "s";
            let str = this.display.replace(":text", text).replace(":time", time).replace(":eta", eta).replace(":percent", percent).replace(":completed", completed + "").replace(":total", total + "");
            let availableSpace = Math.max(0, this.ttyColumns - str.replace(":bar", "").length);
            if (availableSpace && isWindow) availableSpace -= 1;
            const width = Math.min(this.width, availableSpace);
            const completeLength = Math.round(width * completed / total);
            const complete = new Array(completeLength).fill(options.complete ?? this.complete).join("");
            const incomplete = new Array(width - completeLength).fill(options.incomplete ?? this.incomplete).join("");
            str = str.replace(":bar", complete + incomplete);
            if (this.#strs[index] && str.length < this.#strs[index].length) {
                str += " ".repeat(this.#strs[index].length - str.length);
            }
            this.#strs[index++] = str;
        }
        if (ms < this.interval && end == false) return;
        const renderStr = this.#strs.join("\n");
        if (renderStr !== this.lastStr) {
            this.resetScreen();
            this.write(renderStr);
            this.lastStr = renderStr;
            this.#lastRows = this.#strs.length;
        }
        if (end) this.end();
    }
    end() {
        this.#end = true;
        if (this.clear) {
            this.resetScreen();
        } else {
            this.breakLine();
        }
        this.showCursor();
    }
    console(message) {
        this.resetScreen();
        this.write(`${message}`);
        this.breakLine();
        this.write(this.lastStr);
    }
    write(msg) {
        msg = `${msg}\x1b[?25l`;
        this.stdoutWrite(msg);
    }
    resetScreen() {
        if (this.#lastRows > 0) {
            this.stdoutWrite("\x1b[" + (this.#lastRows - 1) + "A\r\x1b[?0J");
        }
    }
    get ttyColumns() {
        return 100;
    }
    breakLine() {
        this.stdoutWrite("\r\n");
    }
    stdoutWrite(msg) {
        writeAllSync(Deno.stdout, this.encoder.encode(msg));
    }
    showCursor() {
        this.stdoutWrite("\x1b[?25h");
    }
}
const isTTY1 = Deno.stdout && Deno.isatty(Deno.stdout.rid);
const isWindow1 = Deno.build.os === "windows";
var Direction;
(function(Direction) {
    Direction[Direction["left"] = 0] = "left";
    Direction[Direction["right"] = 1] = "right";
    Direction[Direction["all"] = 2] = "all";
})(Direction || (Direction = {}));
class ProgressBar {
    title;
    total;
    width;
    complete;
    preciseBar;
    incomplete;
    clear;
    interval;
    display;
    isCompleted = false;
    lastStr = "";
    start = Date.now();
    lastRender = 0;
    encoder = new TextEncoder();
    constructor({ title ="" , total , width =50 , complete =bgGreen(" ") , preciseBar =[] , incomplete =bgWhite(" ") , clear =false , interval =16 , display  } = {}){
        this.title = title;
        this.total = total;
        this.width = width;
        this.complete = complete;
        this.preciseBar = preciseBar.concat(complete);
        this.incomplete = incomplete;
        this.clear = clear;
        this.interval = interval;
        this.display = display ?? ":title :percent :bar :time :completed/:total";
    }
    render(completed, options = {}) {
        if (this.isCompleted || !isTTY1) return;
        if (completed < 0) {
            throw new Error(`completed must greater than or equal to 0`);
        }
        const total = options.total ?? this.total ?? 100;
        const now = Date.now();
        const ms = now - this.lastRender;
        if (ms < this.interval && completed < total) return;
        this.lastRender = now;
        const time = ((now - this.start) / 1000).toFixed(1) + "s";
        const eta = completed == 0 ? "-" : (completed >= total ? 0 : (total / completed - 1) * (now - this.start) / 1000).toFixed(1) + "s";
        const percent = (completed / total * 100).toFixed(2) + "%";
        let str = this.display.replace(":title", options.title ?? this.title).replace(":time", time).replace(":eta", eta).replace(":percent", percent).replace(":completed", completed + "").replace(":total", total + "");
        let availableSpace = Math.max(0, this.ttyColumns - str.replace(":bar", "").length);
        if (availableSpace && isWindow1) availableSpace -= 1;
        const width = Math.min(this.width, availableSpace);
        const finished = completed >= total;
        const preciseBar = options.preciseBar ?? this.preciseBar;
        const precision = preciseBar.length > 1;
        const completeLength = width * completed / total;
        const roundedCompleteLength = Math.floor(completeLength);
        let precise = "";
        if (precision) {
            const preciseLength = completeLength - roundedCompleteLength;
            precise = finished ? "" : preciseBar[Math.floor(preciseBar.length * preciseLength)];
        }
        const complete = new Array(roundedCompleteLength).fill(options.complete ?? this.complete).join("");
        const incomplete = new Array(Math.max(width - roundedCompleteLength - (precision ? 1 : 0), 0)).fill(options.incomplete ?? this.incomplete).join("");
        str = str.replace(":bar", complete + precise + incomplete);
        if (str.length < this.lastStr.length) {
            str += " ".repeat(this.lastStr.length - str.length);
        }
        if (str !== this.lastStr) {
            this.write(str);
            this.lastStr = str;
        }
        if (finished) this.end();
    }
    end() {
        this.isCompleted = true;
        if (this.clear) {
            this.stdoutWrite("\r");
            this.clearLine();
        } else {
            this.breakLine();
        }
        this.showCursor();
    }
    console(message) {
        this.clearLine();
        this.write(`${message}`);
        this.breakLine();
        this.write(this.lastStr);
    }
    write(msg) {
        msg = `\r${msg}\x1b[?25l`;
        this.stdoutWrite(msg);
    }
    get ttyColumns() {
        return 100;
    }
    breakLine() {
        this.stdoutWrite("\r\n");
    }
    stdoutWrite(msg) {
        writeAllSync(Deno.stdout, this.encoder.encode(msg));
    }
    clearLine(direction = 2) {
        switch(direction){
            case 2:
                this.stdoutWrite("\x1b[2K");
                break;
            case 0:
                this.stdoutWrite("\x1b[1K");
                break;
            case 1:
                this.stdoutWrite("\x1b[0K");
                break;
        }
    }
    showCursor() {
        this.stdoutWrite("\x1b[?25h");
    }
}
class Semaphore {
    tasks = [];
    count;
    constructor(count){
        this.count = count;
    }
    schedule() {
        if (this.count > 0 && this.tasks.length > 0) {
            this.count--;
            const next = this.tasks.shift();
            if (next === undefined) {
                throw "Unexpected undefined value in tasks list";
            }
            next();
        }
    }
    get length() {
        return this.tasks.length;
    }
    acquire() {
        return new Promise((resolve)=>{
            const task = ()=>{
                let released = false;
                resolve(()=>{
                    if (!released) {
                        released = true;
                        this.count++;
                        this.schedule();
                    }
                });
            };
            this.tasks.push(task);
            queueMicrotask(this.schedule.bind(this));
        });
    }
    async use(fn) {
        const release = await this.acquire();
        try {
            const res = await fn();
            release();
            return res;
        } catch (err) {
            release();
            throw err;
        }
    }
}
class Mutex extends Semaphore {
    constructor(){
        super(1);
    }
}
const stdinLines = mod2.readLines(Deno.stdin);
async function readline({ skipEmpty =true  } = {}) {
    for await (const line of stdinLines){
        if (!skipEmpty || line !== "") {
            return line;
        }
    }
    throw new Error("EOF");
}
function urlBase64Encode(data) {
    return mod.encode(data).replaceAll("+", "-").replaceAll("/", "_").replaceAll("=", "");
}
async function retry(f, times = 2) {
    let lastError;
    for(let i = 0; i < times; i++){
        try {
            return await f();
        } catch (e) {
            lastError = e;
        }
    }
    throw lastError;
}
async function showError(env, p) {
    try {
        return await p;
    } catch (e) {
        if (e instanceof APIError) {
            env.logger.error(`\n\nAPIError: ${e.message}`, "\nResponse: ", e.response, "\nBody: ", e.json);
        } else {
            env.logger.error(e);
        }
        throw e;
    }
}
function gameId(id) {
    const parsed = parseHistoryDetailId(id);
    if (parsed.type === "VsHistoryDetail") {
        const content = new TextEncoder().encode(`${parsed.timestamp}_${parsed.uuid}`);
        return mod6.v5.generate(BATTLE_NAMESPACE, content);
    } else if (parsed.type === "CoopHistoryDetail") {
        return mod6.v5.generate(COOP_NAMESPACE, mod.decode(id));
    } else {
        throw new Error("Unknown type");
    }
}
function s3siGameId(id) {
    const fullId = mod.decode(id);
    const tsUuid = fullId.slice(fullId.length - 52, fullId.length);
    return mod6.v5.generate(S3SI_NAMESPACE, tsUuid);
}
function s3sCoopGameId(id) {
    const fullId = mod.decode(id);
    const tsUuid = fullId.slice(fullId.length - 52, fullId.length);
    return mod6.v5.generate(COOP_NAMESPACE, tsUuid);
}
function parseHistoryDetailId(id) {
    const plainText = new TextDecoder().decode(mod.decode(id));
    const vsRE = /VsHistoryDetail-([a-z0-9-]+):(\w+):(\d{8}T\d{6})_([0-9a-f-]{36})/;
    const coopRE = /CoopHistoryDetail-([a-z0-9-]+):(\d{8}T\d{6})_([0-9a-f-]{36})/;
    if (vsRE.test(plainText)) {
        const [, uid, listType, timestamp, uuid] = plainText.match(vsRE);
        return {
            type: "VsHistoryDetail",
            uid,
            listType,
            timestamp,
            uuid
        };
    } else if (coopRE.test(plainText)) {
        const [, uid, timestamp, uuid] = plainText.match(coopRE);
        return {
            type: "CoopHistoryDetail",
            uid,
            timestamp,
            uuid
        };
    } else {
        throw new Error(`Invalid ID: ${plainText}`);
    }
}
const delay = (ms)=>new Promise((resolve)=>setTimeout(resolve, ms));
function b64Number(id) {
    const text = new TextDecoder().decode(mod.decode(id));
    const [_, num] = text.split("-");
    return parseInt(num);
}
function nonNullable(v) {
    return v !== null && v !== undefined;
}
function urlSimplify(url) {
    try {
        const { pathname  } = new URL(url);
        return {
            pathname
        };
    } catch (_e) {
        return url;
    }
}
const battleTime = (id)=>{
    const { timestamp  } = parseHistoryDetailId(id);
    const dateStr = timestamp.replace(/(\d{4})(\d{2})(\d{2})T(\d{2})(\d{2})(\d{2})/, "$1-$2-$3T$4:$5:$6Z");
    return new Date(dateStr);
};
async function loginSteps({ newFetcher  }, step2) {
    const fetch = newFetcher();
    if (!step2) {
        const state = urlBase64Encode(random(36));
        const authCodeVerifier = urlBase64Encode(random(32));
        const authCvHash = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(authCodeVerifier));
        const authCodeChallenge = urlBase64Encode(authCvHash);
        const body = {
            "state": state,
            "redirect_uri": "npf71b963c1b7b6d119://auth",
            "client_id": "71b963c1b7b6d119",
            "scope": "openid user user.birthday user.mii user.screenName",
            "response_type": "session_token_code",
            "session_token_code_challenge": authCodeChallenge,
            "session_token_code_challenge_method": "S256",
            "theme": "login_form"
        };
        const url = "https://accounts.nintendo.com/connect/1.0.0/authorize?" + new URLSearchParams(body);
        const res = await fetch.get({
            url,
            headers: {
                "Host": "accounts.nintendo.com",
                "Connection": "keep-alive",
                "Cache-Control": "max-age=0",
                "Upgrade-Insecure-Requests": "1",
                "User-Agent": DEFAULT_APP_USER_AGENT,
                "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8n",
                "DNT": "1",
                "Accept-Encoding": "gzip,deflate,br"
            }
        });
        return {
            authCodeVerifier,
            url: res.url
        };
    } else {
        const { login , authCodeVerifier  } = step2;
        const loginURL = new URL(login);
        const params = new URLSearchParams(loginURL.hash.substring(1));
        const sessionTokenCode = params.get("session_token_code");
        if (!sessionTokenCode) {
            throw new Error("No session token code provided");
        }
        const sessionToken = await getSessionToken({
            fetch,
            sessionTokenCode,
            authCodeVerifier
        });
        if (!sessionToken) {
            throw new Error("No session token found");
        }
        return {
            sessionToken
        };
    }
}
async function loginManually(env) {
    const { prompts: { promptLogin  }  } = env;
    const step1 = await loginSteps(env);
    const { url , authCodeVerifier  } = step1;
    const login = (await promptLogin(url)).trim();
    if (!login) {
        throw new Error("No login URL provided");
    }
    const step2 = await loginSteps(env, {
        authCodeVerifier,
        login
    });
    return step2.sessionToken;
}
async function getGToken({ fApi , sessionToken , env  }) {
    const fetch = env.newFetcher();
    const idResp = await fetch.post({
        url: "https://accounts.nintendo.com/connect/1.0.0/api/token",
        headers: {
            "Host": "accounts.nintendo.com",
            "Accept-Encoding": "gzip",
            "Content-Type": "application/json",
            "Accept": "application/json",
            "Connection": "Keep-Alive",
            "User-Agent": "Dalvik/2.1.0 (Linux; U; Android 7.1.2)"
        },
        body: JSON.stringify({
            "client_id": "71b963c1b7b6d119",
            "session_token": sessionToken,
            "grant_type": "urn:ietf:params:oauth:grant-type:jwt-bearer-session-token"
        })
    });
    const idRespJson = await idResp.json();
    const { access_token: accessToken , id_token: idToken  } = idRespJson;
    if (!accessToken || !idToken) {
        throw new APIError({
            response: idResp,
            json: idRespJson,
            message: "No access_token or id_token found"
        });
    }
    const uiResp = await fetch.get({
        url: "https://api.accounts.nintendo.com/2.0.0/users/me",
        headers: {
            "User-Agent": "NASDKAPI; Android",
            "Content-Type": "application/json",
            "Accept": "application/json",
            "Authorization": `Bearer ${accessToken}`,
            "Host": "api.accounts.nintendo.com",
            "Connection": "Keep-Alive",
            "Accept-Encoding": "gzip"
        }
    });
    const uiRespJson = await uiResp.json();
    const { nickname , birthday , language , country , id: userId  } = uiRespJson;
    const getIdToken2 = async (idToken)=>{
        const { f , request_id: requestId , timestamp  } = await callImink({
            fApi,
            step: 1,
            idToken,
            userId,
            env
        });
        const resp = await fetch.post({
            url: "https://api-lp1.znc.srv.nintendo.net/v3/Account/Login",
            headers: {
                "X-Platform": "Android",
                "X-ProductVersion": NSOAPP_VERSION,
                "Content-Type": "application/json; charset=utf-8",
                "Connection": "Keep-Alive",
                "Accept-Encoding": "gzip",
                "User-Agent": `com.nintendo.znca/${NSOAPP_VERSION}(Android/7.1.2)`
            },
            body: JSON.stringify({
                parameter: {
                    "f": f,
                    "language": language,
                    "naBirthday": birthday,
                    "naCountry": country,
                    "naIdToken": idToken,
                    "requestId": requestId,
                    "timestamp": timestamp
                }
            })
        });
        const respJson = await resp.json();
        const idToken2 = respJson?.result?.webApiServerCredential?.accessToken;
        const coralUserId = respJson?.result?.user?.id?.toString();
        if (!idToken2 || !coralUserId) {
            throw new APIError({
                response: resp,
                json: respJson,
                message: `No idToken2 or coralUserId found. Please try again later. (${idToken2.length}, ${coralUserId.length})`
            });
        }
        return [
            idToken2,
            coralUserId
        ];
    };
    const getGToken = async (idToken, coralUserId)=>{
        const { f , request_id: requestId , timestamp  } = await callImink({
            step: 2,
            idToken,
            fApi,
            userId,
            coralUserId,
            env
        });
        const resp = await fetch.post({
            url: "https://api-lp1.znc.srv.nintendo.net/v2/Game/GetWebServiceToken",
            headers: {
                "X-Platform": "Android",
                "X-ProductVersion": NSOAPP_VERSION,
                "Authorization": `Bearer ${idToken}`,
                "Content-Type": "application/json; charset=utf-8",
                "Accept-Encoding": "gzip",
                "User-Agent": `com.nintendo.znca/${NSOAPP_VERSION}(Android/7.1.2)`
            },
            body: JSON.stringify({
                parameter: {
                    "f": f,
                    "id": 4834290508791808,
                    "registrationToken": idToken,
                    "requestId": requestId,
                    "timestamp": timestamp
                }
            })
        });
        const respJson = await resp.json();
        const webServiceToken = respJson?.result?.accessToken;
        if (!webServiceToken) {
            throw new APIError({
                response: resp,
                json: respJson,
                message: "No webServiceToken found"
            });
        }
        return webServiceToken;
    };
    const [idToken2, coralUserId] = await retry(()=>getIdToken2(idToken));
    const webServiceToken = await retry(()=>getGToken(idToken2, coralUserId));
    return {
        webServiceToken,
        nickname,
        userCountry: country,
        userLang: language
    };
}
async function getBulletToken({ webServiceToken , appUserAgent =DEFAULT_APP_USER_AGENT , userLang , userCountry , env  }) {
    const { post  } = env.newFetcher({
        cookies: [
            {
                name: "_gtoken",
                value: webServiceToken,
                domain: "api.lp1.av5ja.srv.nintendo.net"
            }
        ]
    });
    const resp = await post({
        url: "https://api.lp1.av5ja.srv.nintendo.net/api/bullet_tokens",
        headers: {
            "Content-Type": "application/json",
            "Accept-Language": userLang,
            "User-Agent": appUserAgent,
            "X-Web-View-Ver": WEB_VIEW_VERSION,
            "X-NACOUNTRY": userCountry,
            "Accept": "*/*",
            "Origin": "https://api.lp1.av5ja.srv.nintendo.net",
            "X-Requested-With": "com.nintendo.znca"
        }
    });
    if (resp.status == 401) {
        throw new APIError({
            response: resp,
            message: "Unauthorized error (ERROR_INVALID_GAME_WEB_TOKEN). Cannot fetch tokens at this time."
        });
    }
    if (resp.status == 403) {
        throw new APIError({
            response: resp,
            message: "Forbidden error (ERROR_OBSOLETE_VERSION). Cannot fetch tokens at this time."
        });
    }
    if (resp.status == 204) {
        throw new APIError({
            response: resp,
            message: "Cannot access SplatNet 3 without having played online."
        });
    }
    if (resp.status !== 201) {
        throw new APIError({
            response: resp,
            message: "Not 201"
        });
    }
    const respJson = await resp.json();
    const { bulletToken  } = respJson;
    if (typeof bulletToken !== "string") {
        throw new APIError({
            response: resp,
            json: respJson,
            message: "No bulletToken found"
        });
    }
    return bulletToken;
}
function random(size) {
    return crypto.getRandomValues(new Uint8Array(size)).buffer;
}
async function getSessionToken({ fetch , sessionTokenCode , authCodeVerifier  }) {
    const resp = await fetch.post({
        url: "https://accounts.nintendo.com/connect/1.0.0/api/session_token",
        headers: {
            "User-Agent": `OnlineLounge/${NSOAPP_VERSION} NASDKAPI Android`,
            "Accept-Language": "en-US",
            "Accept": "application/json",
            "Content-Type": "application/x-www-form-urlencoded",
            "Host": "accounts.nintendo.com",
            "Connection": "Keep-Alive",
            "Accept-Encoding": "gzip"
        },
        body: new URLSearchParams({
            "client_id": "71b963c1b7b6d119",
            "session_token_code": sessionTokenCode,
            "session_token_code_verifier": authCodeVerifier
        })
    });
    const json = await resp.json();
    if (json.error) {
        throw new APIError({
            response: resp,
            json,
            message: "Error getting session token"
        });
    }
    return json["session_token"];
}
async function callImink(params) {
    const { fApi , step , idToken , userId , coralUserId , env  } = params;
    const { post  } = env.newFetcher();
    const resp = await post({
        url: fApi,
        headers: {
            "User-Agent": USERAGENT,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            "token": idToken,
            "hash_method": step,
            "na_id": userId,
            "coral_user_id": coralUserId
        })
    });
    return await resp.json();
}
const DEFAULT_ENV = {
    prompts: {
        promptLogin: async (url)=>{
            console.log("Navigate to this URL in your browser:");
            console.log(url);
            console.log('Log in, right click the "Select this account" button, copy the link address, and paste it below:');
            return await readline();
        },
        prompt: async (tips)=>{
            console.log(tips);
            return await readline();
        }
    },
    logger: {
        debug: console.debug,
        log: console.log,
        warn: console.warn,
        error: console.error
    },
    newFetcher: ({ cookies  } = {})=>{
        const cookieJar = new CookieJar(cookies);
        const fetch = wrapFetch({
            cookieJar
        });
        return {
            async get ({ url , headers  }) {
                return await fetch(url, {
                    method: "GET",
                    headers
                });
            },
            async post ({ url , body , headers  }) {
                return await fetch(url, {
                    method: "POST",
                    headers,
                    body
                });
            }
        };
    }
};
const DEFAULT_STATE = {
    cacheDir: "./cache",
    fGen: "https://api.imink.app/f",
    fileExportPath: "./export",
    monitorInterval: 500
};
class FileStateBackend {
    path;
    constructor(path){
        this.path = path;
    }
    async read() {
        const data = await Deno.readTextFile(this.path);
        const json = JSON.parse(data);
        return json;
    }
    async write(newState) {
        const data = JSON.stringify(newState, undefined, 2);
        const swapPath = `${this.path}.swap`;
        await Deno.writeTextFile(swapPath, data);
        await Deno.rename(swapPath, this.path);
    }
}
class Profile {
    _state;
    stateBackend;
    env;
    constructor({ stateBackend , env =DEFAULT_ENV  }){
        this.stateBackend = stateBackend;
        this.env = env;
    }
    get state() {
        if (!this._state) {
            throw new Error("state is not initialized");
        }
        return this._state;
    }
    async writeState(newState) {
        this._state = newState;
        await this.stateBackend.write(newState);
    }
    async readState() {
        try {
            const json = await this.stateBackend.read();
            this._state = {
                ...DEFAULT_STATE,
                ...json
            };
        } catch (e) {
            this.env.logger.warn(`Failed to read config file, create new config file. (${e})`);
            await this.writeState(DEFAULT_STATE);
        }
    }
}
var BattleListType;
(function(BattleListType) {
    BattleListType[BattleListType["Latest"] = 0] = "Latest";
    BattleListType[BattleListType["Regular"] = 1] = "Regular";
    BattleListType[BattleListType["Bankara"] = 2] = "Bankara";
    BattleListType[BattleListType["Event"] = 3] = "Event";
    BattleListType[BattleListType["XBattle"] = 4] = "XBattle";
    BattleListType[BattleListType["Private"] = 5] = "Private";
    BattleListType[BattleListType["Coop"] = 6] = "Coop";
})(BattleListType || (BattleListType = {}));
var SummaryEnum;
(function(SummaryEnum) {
    SummaryEnum[SummaryEnum["ConfigureAnalyticsQuery"] = Queries.ConfigureAnalyticsQuery] = "ConfigureAnalyticsQuery";
    SummaryEnum[SummaryEnum["HistoryRecordQuery"] = Queries.HistoryRecordQuery] = "HistoryRecordQuery";
    SummaryEnum[SummaryEnum["CoopHistoryQuery"] = Queries.CoopHistoryQuery] = "CoopHistoryQuery";
})(SummaryEnum || (SummaryEnum = {}));
class Splatnet3 {
    profile;
    env;
    constructor({ profile , env =DEFAULT_ENV  }){
        this.profile = profile;
        this.env = env;
    }
    async request(query, ...rest) {
        const doRequest = async ()=>{
            const state = this.profile.state;
            const variables = rest?.[0] ?? {};
            const body = {
                extensions: {
                    persistedQuery: {
                        sha256Hash: query,
                        version: 1
                    }
                },
                variables
            };
            const { post  } = this.env.newFetcher();
            const resp = await post({
                url: SPLATNET3_ENDPOINT,
                headers: {
                    "Authorization": `Bearer ${state.loginState?.bulletToken}`,
                    "Accept-Language": state.userLang ?? "en-US",
                    "User-Agent": state.appUserAgent ?? DEFAULT_APP_USER_AGENT,
                    "X-Web-View-Ver": WEB_VIEW_VERSION,
                    "Content-Type": "application/json",
                    "Accept": "*/*",
                    "Origin": "https://api.lp1.av5ja.srv.nintendo.net",
                    "X-Requested-With": "com.nintendo.znca",
                    "Referer": `https://api.lp1.av5ja.srv.nintendo.net/?lang=${state.userLang}&na_country=${state.userCountry}&na_lang=${state.userLang}`,
                    "Accept-Encoding": "gzip, deflate",
                    "Cookie": `_gtoken: ${state.loginState?.gToken}`
                },
                body: JSON.stringify(body)
            });
            if (resp.status !== 200) {
                throw new APIError({
                    response: resp,
                    message: "Splatnet3 request failed"
                });
            }
            const json = await resp.json();
            if ("errors" in json) {
                throw new APIError({
                    response: resp,
                    json,
                    message: `Splatnet3 request failed(${json.errors?.[0].message})`
                });
            }
            return json.data;
        };
        try {
            return await doRequest();
        } catch (e) {
            if (isTokenExpired(e)) {
                await this.fetchToken();
                return await doRequest();
            }
            throw e;
        }
    }
    async fetchToken() {
        const state = this.profile.state;
        const sessionToken = state.loginState?.sessionToken;
        if (!sessionToken) {
            throw new Error("Session token is not set.");
        }
        const { webServiceToken , userCountry , userLang  } = await getGToken({
            fApi: state.fGen,
            sessionToken,
            env: this.env
        });
        const bulletToken = await getBulletToken({
            webServiceToken,
            userLang,
            userCountry,
            appUserAgent: state.appUserAgent,
            env: this.env
        });
        await this.profile.writeState({
            ...state,
            loginState: {
                ...state.loginState,
                gToken: webServiceToken,
                bulletToken
            },
            userLang: state.userLang ?? userLang,
            userCountry: state.userCountry ?? userCountry
        });
    }
    BATTLE_LIST_TYPE_MAP = {
        [BattleListType.Latest]: ()=>this.request(Queries.LatestBattleHistoriesQuery).then((r)=>getIdsFromGroups(r.latestBattleHistories)),
        [BattleListType.Regular]: ()=>this.request(Queries.RegularBattleHistoriesQuery).then((r)=>getIdsFromGroups(r.regularBattleHistories)),
        [BattleListType.Bankara]: ()=>this.request(Queries.BankaraBattleHistoriesQuery).then((r)=>getIdsFromGroups(r.bankaraBattleHistories)),
        [BattleListType.XBattle]: ()=>this.request(Queries.XBattleHistoriesQuery).then((r)=>getIdsFromGroups(r.xBattleHistories)),
        [BattleListType.Event]: ()=>this.request(Queries.EventBattleHistoriesQuery).then((r)=>getIdsFromGroups(r.eventBattleHistories)),
        [BattleListType.Private]: ()=>this.request(Queries.PrivateBattleHistoriesQuery).then((r)=>getIdsFromGroups(r.privateBattleHistories)),
        [BattleListType.Coop]: ()=>this.request(Queries.CoopHistoryQuery).then((r)=>getIdsFromGroups(r.coopResult))
    };
    async checkToken() {
        const state = this.profile.state;
        if (!state.loginState?.sessionToken || !state.loginState?.bulletToken || !state.loginState?.gToken) {
            return false;
        }
        try {
            await this.request(Queries.ConfigureAnalyticsQuery);
            return true;
        } catch (_e) {
            return false;
        }
    }
    async getBattleList(battleListType = BattleListType.Latest) {
        return await this.BATTLE_LIST_TYPE_MAP[battleListType]();
    }
    async getAllBattleList() {
        const ALL_TYPE = [
            BattleListType.Regular,
            BattleListType.Bankara,
            BattleListType.XBattle,
            BattleListType.Event,
            BattleListType.Private
        ];
        const ids = [];
        for (const type of ALL_TYPE){
            ids.push(...await this.getBattleList(type));
        }
        const timeMap = new Map(ids.map((id)=>[
                id,
                battleTime(id)
            ]));
        return ids.sort((a, b)=>timeMap.get(b).getTime() - timeMap.get(a).getTime());
    }
    getBattleDetail(id) {
        return this.request(Queries.VsHistoryDetailQuery, {
            vsResultId: id
        });
    }
    getCoopDetail(id) {
        return this.request(Queries.CoopHistoryDetailQuery, {
            coopHistoryDetailId: id
        });
    }
    async getBankaraBattleHistories() {
        const resp = await this.request(Queries.BankaraBattleHistoriesQuery);
        return resp;
    }
    async getXBattleHistories() {
        return await this.request(Queries.XBattleHistoriesQuery);
    }
    async getCoopHistories() {
        const resp = await this.request(Queries.CoopHistoryQuery);
        return resp;
    }
    async getGearPower() {
        const resp = await this.request(Queries.myOutfitCommonDataFilteringConditionQuery);
        return resp;
    }
    async getLatestBattleHistoriesQuery() {
        const resp = await this.request(Queries.LatestBattleHistoriesQuery);
        return resp;
    }
    async getGears() {
        const resp = await this.request(Queries.myOutfitCommonDataEquipmentsQuery);
        return resp;
    }
    async getSummary() {
        const ConfigureAnalyticsQuery = await this.request(Queries.ConfigureAnalyticsQuery);
        const HistoryRecordQuery = await this.request(Queries.HistoryRecordQuery);
        const CoopHistoryQuery = await this.request(Queries.CoopHistoryQuery);
        const getFirstBattleId = async ()=>{
            const latest = await this.request(Queries.LatestBattleHistoriesQuery);
            const id = latest?.latestBattleHistories?.historyGroups?.nodes?.[0]?.historyDetails?.nodes?.[0]?.id;
            return id;
        };
        const id = CoopHistoryQuery?.coopResult?.historyGroups?.nodes?.[0]?.historyDetails?.nodes?.[0]?.id ?? await getFirstBattleId();
        if (!id) {
            throw new Error("No battle id found");
        }
        const { uid  } = parseHistoryDetailId(id);
        return {
            uid,
            ConfigureAnalyticsQuery,
            HistoryRecordQuery,
            CoopHistoryQuery
        };
    }
}
function getIdsFromGroups({ historyGroups  }) {
    return historyGroups.nodes.flatMap((i)=>i.historyDetails.nodes).map((i)=>i.id);
}
function isTokenExpired(e) {
    if (e instanceof APIError) {
        return e.response.status === 401;
    } else {
        return false;
    }
}
class MemoryCache {
    cache = {};
    async read(key) {
        return this.cache[key];
    }
    async write(key, value) {
        this.cache[key] = value;
    }
}
class FileCache {
    path;
    constructor(path){
        this.path = path;
    }
    async getPath(key) {
        await Deno.mkdir(this.path, {
            recursive: true
        });
        const hash = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(key));
        const hashHex = Array.from(new Uint8Array(hash)).map((b)=>b.toString(16).padStart(2, "0")).join("");
        return mod10.join(this.path, hashHex);
    }
    async read(key) {
        const path = await this.getPath(key);
        try {
            const data = await Deno.readTextFile(path);
            return JSON.parse(data);
        } catch (e) {
            if (e instanceof Deno.errors.NotFound) {
                return undefined;
            }
            throw e;
        }
    }
    async write(key, value) {
        const path = await this.getPath(key);
        const encoder = new TextEncoder();
        const data = encoder.encode(JSON.stringify(value));
        const swapPath = `${path}.swap`;
        await Deno.writeFile(swapPath, data);
        await Deno.rename(swapPath, path);
    }
}
const __default = JSON.parse("[\n  {\n    \"key\": \"ink_saver_main\",\n    \"name\": {\n      \"de-DE\": \"Hauptverbrauch\",\n      \"en-GB\": \"Ink Saver (Main)\",\n      \"en-US\": \"Ink Saver (Main)\",\n      \"es-ES\": \"Tintahorro (ppal.)\",\n      \"es-MX\": \"Ahorro tinta (ppal.)\",\n      \"fr-CA\": \"Encr√©menteur (pr.)\",\n      \"fr-FR\": \"Encr√©menteur (pr.)\",\n      \"it-IT\": \"Eco-colore princ.\",\n      \"ja-JP\": \"„Ç§„É≥„ÇØÂäπÁéá„Ç¢„ÉÉ„Éó(„É°„Ç§„É≥)\",\n      \"ko-KR\": \"ÏûâÌÅ¨ Ìö®Ïú® ÏóÖ(Î©îÏù∏)\",\n      \"nl-NL\": \"Hoofdspaarder\",\n      \"ru-RU\": \"–û—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–ª–æ–Ω X\",\n      \"zh-CN\": \"ÊèêÂçáÂ¢®Ê±ÅÊïàÁéáÔºà‰∏ªË¶ÅÊ≠¶Âô®Ôºâ\",\n      \"zh-TW\": \"ÊèêÂçáÂ¢®Ê±ÅÊïàÁéáÔºà‰∏ªË¶ÅÊ≠¶Âô®Ôºâ\"\n    },\n    \"primary_only\": false\n  },\n  {\n    \"key\": \"ink_saver_sub\",\n    \"name\": {\n      \"de-DE\": \"Sekund√§rverbrauch\",\n      \"en-GB\": \"Ink Saver (Sub)\",\n      \"en-US\": \"Ink Saver (Sub)\",\n      \"es-ES\": \"Tintahorro (sec.)\",\n      \"es-MX\": \"Ahorro tinta (sec.)\",\n      \"fr-CA\": \"Encr√©menteur (sec.)\",\n      \"fr-FR\": \"Encr√©menteur (sec.)\",\n      \"it-IT\": \"Eco-colore second.\",\n      \"ja-JP\": \"„Ç§„É≥„ÇØÂäπÁéá„Ç¢„ÉÉ„Éó(„Çµ„Éñ)\",\n      \"ko-KR\": \"ÏûâÌÅ¨ Ìö®Ïú® ÏóÖ(ÏÑúÎ∏å)\",\n      \"nl-NL\": \"Subspaarder\",\n      \"ru-RU\": \"–ó–∞–ø–∞—Å–Ω–æ–π –±–∞–ª–ª–æ–Ω X\",\n      \"zh-CN\": \"ÊèêÂçáÂ¢®Ê±ÅÊïàÁéáÔºàÊ¨°Ë¶ÅÊ≠¶Âô®Ôºâ\",\n      \"zh-TW\": \"ÊèêÂçáÂ¢®Ê±ÅÊïàÁéáÔºàÊ¨°Ë¶ÅÊ≠¶Âô®Ôºâ\"\n    },\n    \"primary_only\": false\n  },\n  {\n    \"key\": \"ink_recovery_up\",\n    \"name\": {\n      \"de-DE\": \"Regeneration +\",\n      \"en-GB\": \"Ink Recovery Up\",\n      \"en-US\": \"Ink Recovery Up\",\n      \"es-ES\": \"Recarga r√°pida\",\n      \"es-MX\": \"Mejor recarga tinta\",\n      \"fr-CA\": \"Lev√©e d'encre\",\n      \"fr-FR\": \"Lev√©e d'encre\",\n      \"it-IT\": \"Recupero colore +\",\n      \"ja-JP\": \"„Ç§„É≥„ÇØÂõûÂæ©Âäõ„Ç¢„ÉÉ„Éó\",\n      \"ko-KR\": \"ÏûâÌÅ¨ ÌöåÎ≥µÎ†• ÏóÖ\",\n      \"nl-NL\": \"Inktvulling\",\n      \"ru-RU\": \"–ë—ã—Å—Ç—Ä—ã–π –±–∞–ª–ª–æ–Ω\",\n      \"zh-CN\": \"ÊèêÂçáÂ¢®Ê±ÅÂõûÂ§çÂäõ\",\n      \"zh-TW\": \"ÊèêÂçáÂ¢®Ê±ÅÂõûÂæ©Âäõ\"\n    },\n    \"primary_only\": false\n  },\n  {\n    \"key\": \"run_speed_up\",\n    \"name\": {\n      \"de-DE\": \"Lauftempo +\",\n      \"en-GB\": \"Run Speed Up\",\n      \"en-US\": \"Run Speed Up\",\n      \"es-ES\": \"Supercarrera\",\n      \"es-MX\": \"Carrera acelerada\",\n      \"fr-CA\": \"Course √† pied\",\n      \"fr-FR\": \"Course √† pied\",\n      \"it-IT\": \"Velocit√† +\",\n      \"ja-JP\": \"„Éí„ÉàÁßªÂãïÈÄüÂ∫¶„Ç¢„ÉÉ„Éó\",\n      \"ko-KR\": \"Ïù∏Í∞Ñ Ïù¥Îèô ÏÜçÎèÑ ÏóÖ\",\n      \"nl-NL\": \"Hardloper\",\n      \"ru-RU\": \"–°–ø—Ä–∏–Ω—Ç–µ—Ä\",\n      \"zh-CN\": \"ÊèêÂçá‰∫∫Á±ªÁßªÂä®ÈÄüÂ∫¶\",\n      \"zh-TW\": \"ÊèêÂçá‰∫∫È°ûÁßªÂãïÈÄüÂ∫¶\"\n    },\n    \"primary_only\": false\n  },\n  {\n    \"key\": \"swim_speed_up\",\n    \"name\": {\n      \"de-DE\": \"Schwimmtempo +\",\n      \"en-GB\": \"Swim Speed Up\",\n      \"en-US\": \"Swim Speed Up\",\n      \"es-ES\": \"Superbuceo\",\n      \"es-MX\": \"Nado acelerado\",\n      \"fr-CA\": \"Turbo-calmar\",\n      \"fr-FR\": \"Turbo-calamar\",\n      \"it-IT\": \"Velocit√† nuoto +\",\n      \"ja-JP\": \"„Ç§„Ç´„ÉÄ„ÉÉ„Ç∑„É•ÈÄüÂ∫¶„Ç¢„ÉÉ„Éó\",\n      \"ko-KR\": \"ÏßïÏñ¥ÎåÄÏãú ÏÜçÎèÑ ÏóÖ\",\n      \"nl-NL\": \"Zwemdiploma\",\n      \"ru-RU\": \"–ü–ª–∞–≤—É–Ω–µ—Ü\",\n      \"zh-CN\": \"ÊèêÂçáÈ±øÈ±ºÂÜ≤Âà∫ÈÄüÂ∫¶\",\n      \"zh-TW\": \"ÊèêÂçáÈ≠∑È≠öË°ùÂà∫ÈÄüÂ∫¶\"\n    },\n    \"primary_only\": false\n  },\n  {\n    \"key\": \"special_charge_up\",\n    \"name\": {\n      \"de-DE\": \"Spezialladezeit +\",\n      \"en-GB\": \"Special Charge Up\",\n      \"en-US\": \"Special Charge Up\",\n      \"es-ES\": \"Recarga especial\",\n      \"es-MX\": \"Recarga especial\",\n      \"fr-CA\": \"Jauge sp√©ciale +\",\n      \"fr-FR\": \"Jauge sp√©ciale +\",\n      \"it-IT\": \"Ricarica speciale +\",\n      \"ja-JP\": \"„Çπ„Éö„Ç∑„É£„É´Â¢óÂä†Èáè„Ç¢„ÉÉ„Éó\",\n      \"ko-KR\": \"Ïä§ÌéòÏÖú Ï¶ùÍ∞ÄÎüâ ÏóÖ\",\n      \"nl-NL\": \"Speciaallader\",\n      \"ru-RU\": \"–û—Å–æ–±—ã–π –Ω–∞—Å–æ—Å\",\n      \"zh-CN\": \"ÊèêÂçáÁâπÊÆäÊ≠¶Âô®Â¢ûÂä†Èáè\",\n      \"zh-TW\": \"ÊèêÂçáÁâπÊÆäÊ≠¶Âô®Â¢ûÂä†Èáè\"\n    },\n    \"primary_only\": false\n  },\n  {\n    \"key\": \"special_saver\",\n    \"name\": {\n      \"de-DE\": \"Spezialabzug -\",\n      \"en-GB\": \"Special Saver\",\n      \"en-US\": \"Special Saver\",\n      \"es-ES\": \"Reducci√≥n especial\",\n      \"es-MX\": \"Ahorro especial\",\n      \"fr-CA\": \"Baisse sp√©ciale -\",\n      \"fr-FR\": \"Baisse sp√©ciale -\",\n      \"it-IT\": \"Riduzione speciale -\",\n      \"ja-JP\": \"„Çπ„Éö„Ç∑„É£„É´Ê∏õÂ∞ëÈáè„ÉÄ„Ç¶„É≥\",\n      \"ko-KR\": \"Ïä§ÌéòÏÖú Í∞êÏÜåÎüâ Îã§Ïö¥\",\n      \"nl-NL\": \"Speciaalspaarder\",\n      \"ru-RU\": \"–û—Å–æ–±—ã–π —Ä–µ–∑–µ—Ä–≤\",\n      \"zh-CN\": \"Èôç‰ΩéÁâπÊÆäÊ≠¶Âô®ÂáèÂ∞ëÈáè\",\n      \"zh-TW\": \"Èôç‰ΩéÁâπÊÆäÊ≠¶Âô®Ê∏õÂ∞ëÈáè\"\n    },\n    \"primary_only\": false\n  },\n  {\n    \"key\": \"special_power_up\",\n    \"name\": {\n      \"de-DE\": \"Spezialst√§rke +\",\n      \"en-GB\": \"Special Power Up\",\n      \"en-US\": \"Special Power Up\",\n      \"es-ES\": \"Superarma especial\",\n      \"es-MX\": \"Mejora especial\",\n      \"fr-CA\": \"Arme sp√©ciale +\",\n      \"fr-FR\": \"Arme sp√©ciale +\",\n      \"it-IT\": \"Arma speciale +\",\n      \"ja-JP\": \"„Çπ„Éö„Ç∑„É£„É´ÊÄßËÉΩ„Ç¢„ÉÉ„Éó\",\n      \"ko-KR\": \"Ïä§ÌéòÏÖú ÏÑ±Îä• ÏóÖ\",\n      \"nl-NL\": \"Specialist\",\n      \"ru-RU\": \"–û—Å–æ–±—ã–π –ø–æ–¥—Ö–æ–¥\",\n      \"zh-CN\": \"ÊèêÂçáÁâπÊÆäÊ≠¶Âô®ÊÄßËÉΩ\",\n      \"zh-TW\": \"ÊèêÂçáÁâπÊÆäÊ≠¶Âô®ÊÄßËÉΩ\"\n    },\n    \"primary_only\": false\n  },\n  {\n    \"key\": \"quick_respawn\",\n    \"name\": {\n      \"de-DE\": \"Schnelle R√ºckkehr\",\n      \"en-GB\": \"Quick Respawn\",\n      \"en-US\": \"Quick Respawn\",\n      \"es-ES\": \"Retorno expr√©s\",\n      \"es-MX\": \"Regeneraci√≥n r√°pida\",\n      \"fr-CA\": \"Sans temps mort\",\n      \"fr-FR\": \"Sans temps morts\",\n      \"it-IT\": \"Il tempo √® colore\",\n      \"ja-JP\": \"Âæ©Ê¥ªÊôÇÈñìÁü≠Á∏Æ\",\n      \"ko-KR\": \"Î∂ÄÌôú ÏãúÍ∞Ñ Îã®Ï∂ï\",\n      \"nl-NL\": \"Comeback\",\n      \"ru-RU\": \"–§–µ–Ω–∏–∫—Å\",\n      \"zh-CN\": \"Áº©Áü≠Â§çÊ¥ªÊó∂Èó¥\",\n      \"zh-TW\": \"Á∏ÆÁü≠Âæ©Ê¥ªÊôÇÈñì\"\n    },\n    \"primary_only\": false\n  },\n  {\n    \"key\": \"quick_super_jump\",\n    \"name\": {\n      \"de-DE\": \"Supersprung +\",\n      \"en-GB\": \"Quick Super Jump\",\n      \"en-US\": \"Quick Super Jump\",\n      \"es-ES\": \"Supersalto r√°pido\",\n      \"es-MX\": \"Supersalto r√°pido\",\n      \"fr-CA\": \"A√©rodynamisme\",\n      \"fr-FR\": \"A√©rodynamisme\",\n      \"it-IT\": \"Salti super e veloci\",\n      \"ja-JP\": \"„Çπ„Éº„Éë„Éº„Ç∏„É£„É≥„ÉóÊôÇÈñìÁü≠Á∏Æ\",\n      \"ko-KR\": \"ÏäàÌçº Ï†êÌîÑ ÏãúÍ∞Ñ Îã®Ï∂ï\",\n      \"nl-NL\": \"Turbosprong\",\n      \"ru-RU\": \"–°—É–ø–µ—Ä–ø—Ä—ã–≥—É–Ω\",\n      \"zh-CN\": \"Áº©Áü≠Ë∂ÖÁ∫ßË∑≥Ë∑ÉÊó∂Èó¥\",\n      \"zh-TW\": \"Á∏ÆÁü≠Ë∂ÖÁ¥öË∑≥Ë∫çÊôÇÈñì\"\n    },\n    \"primary_only\": false\n  },\n  {\n    \"key\": \"sub_power_up\",\n    \"name\": {\n      \"de-DE\": \"Sekund√§rst√§rke +\",\n      \"en-GB\": \"Sub Power Up\",\n      \"en-US\": \"Sub Power Up\",\n      \"es-ES\": \"Superarma secundaria\",\n      \"es-MX\": \"Mejora secundaria\",\n      \"fr-CA\": \"Arme secondaire +\",\n      \"fr-FR\": \"Arme secondaire +\",\n      \"it-IT\": \"Arma secondaria +\",\n      \"ja-JP\": \"„Çµ„ÉñÊÄßËÉΩ„Ç¢„ÉÉ„Éó\",\n      \"ko-KR\": \"ÏÑúÎ∏å ÏÑ±Îä• ÏóÖ\",\n      \"nl-NL\": \"Subtopper\",\n      \"ru-RU\": \"–ü—Ä–æ-–ó–∞–ø–∞—Å\",\n      \"zh-CN\": \"ÊèêÂçáÊ¨°Ë¶ÅÊ≠¶Âô®ÊÄßËÉΩ\",\n      \"zh-TW\": \"ÊèêÂçáÊ¨°Ë¶ÅÊ≠¶Âô®ÊÄßËÉΩ\"\n    },\n    \"primary_only\": false\n  },\n  {\n    \"key\": \"ink_resistance_up\",\n    \"name\": {\n      \"de-DE\": \"Tintentoleranz +\",\n      \"en-GB\": \"Ink Resistance Up\",\n      \"en-US\": \"Ink Resistance Up\",\n      \"es-ES\": \"Impermeabilidad\",\n      \"es-MX\": \"Impermeabilidad\",\n      \"fr-CA\": \"Imperm√©abilit√©\",\n      \"fr-FR\": \"Pieds au sec\",\n      \"it-IT\": \"Scarpe impermeabili\",\n      \"ja-JP\": \"Áõ∏Êâã„Ç§„É≥„ÇØÂΩ±ÈüøËªΩÊ∏õ\",\n      \"ko-KR\": \"ÏÉÅÎåÄ ÏûâÌÅ¨ ÏòÅÌñ• Í∞êÏÜå\",\n      \"nl-NL\": \"Inkttolerantie\",\n      \"ru-RU\": \"–ö—Ä–∞—Å–∫–æ—Å—Ç–æ–π–∫–æ—Å—Ç—å\",\n      \"zh-CN\": \"ÂáèËΩªÂØπÊâãÂ¢®Ê±ÅÂΩ±Âìç\",\n      \"zh-TW\": \"Ê∏õËºïÂ∞çÊâãÂ¢®Ê±ÅÂΩ±Èüø\"\n    },\n    \"primary_only\": false\n  },\n  {\n    \"key\": \"sub_resistance_up\",\n    \"name\": {\n      \"de-DE\": \"Sekund√§rschutz +\",\n      \"en-GB\": \"Sub Resistance Up\",\n      \"en-US\": \"Sub Resistance Up\",\n      \"es-ES\": \"Resistencia secundaria\",\n      \"es-MX\": \"Resistencia secundaria\",\n      \"fr-CA\": \"Filtre √† secondaires\",\n      \"fr-FR\": \"Filtre √† secondaires\",\n      \"it-IT\": \"Arma sec. impermeabile\",\n      \"ja-JP\": \"„Çµ„ÉñÂΩ±ÈüøËªΩÊ∏õ\",\n      \"ko-KR\": \"ÏÑúÎ∏å ÏòÅÌñ• Í∞êÏÜå\",\n      \"nl-NL\": \"Subdemper\",\n      \"ru-RU\": \"–°—Ç–æ–π–∫–æ—Å—Ç—å –∑–∞–ø–∞—Å–∞\",\n      \"zh-CN\": \"ÂáèËΩªÊ¨°Ë¶ÅÊ≠¶Âô®ÂΩ±Âìç\",\n      \"zh-TW\": \"Ê∏õËºïÊ¨°Ë¶ÅÊ≠¶Âô®ÂΩ±Èüø\"\n    },\n    \"primary_only\": false\n  },\n  {\n    \"key\": \"intensify_action\",\n    \"name\": {\n      \"de-DE\": \"Action +\",\n      \"en-GB\": \"Intensify Action\",\n      \"en-US\": \"Intensify Action\",\n      \"es-ES\": \"Agilidad extra\",\n      \"es-MX\": \"Agilidad extra\",\n      \"fr-CA\": \"Feu de l'action\",\n      \"fr-FR\": \"Feu de l'action\",\n      \"it-IT\": \"Intensificazione\",\n      \"ja-JP\": \"„Ç¢„ÇØ„Ç∑„Éß„É≥Âº∑Âåñ\",\n      \"ko-KR\": \"Ïï°ÏÖò Í∞ïÌôî\",\n      \"nl-NL\": \"Actie-assistentie\",\n      \"ru-RU\": \"–£–ª—å—Ç—Ä–∞—É–¥–∞—Ä\",\n      \"zh-CN\": \"Ë°åÂä®Âº∫Âåñ\",\n      \"zh-TW\": \"Ë°åÂãïÂº∑Âåñ\"\n    },\n    \"primary_only\": false\n  },\n  {\n    \"key\": \"opening_gambit\",\n    \"name\": {\n      \"de-DE\": \"Startvorteil\",\n      \"en-GB\": \"Opening Gambit\",\n      \"en-US\": \"Opening Gambit\",\n      \"es-ES\": \"Aceler√≥n de salida\",\n      \"es-MX\": \"Aceler√≥n de salida\",\n      \"fr-CA\": \"D√©part toute allure\",\n      \"fr-FR\": \"Chapeaux de roue\",\n      \"it-IT\": \"Partenza a razzo\",\n      \"ja-JP\": \"„Çπ„Çø„Éº„Éà„ÉÄ„ÉÉ„Ç∑„É•\",\n      \"ko-KR\": \"Ïä§ÌÉÄÌä∏ ÎåÄÏãú\",\n      \"nl-NL\": \"Vliegende start\",\n      \"ru-RU\": \"–°—Ç–∞—Ä—Ç–æ–≤—ã–π —Å–ø—É—Ä—Ç\",\n      \"zh-CN\": \"ÊúÄÂàùÂÜ≤Âà∫\",\n      \"zh-TW\": \"ÊúÄÂàùË°ùÂà∫\"\n    },\n    \"primary_only\": true\n  },\n  {\n    \"key\": \"last_ditch_effort\",\n    \"name\": {\n      \"de-DE\": \"Endspurt\",\n      \"en-GB\": \"Last-Ditch Effort\",\n      \"en-US\": \"Last-Ditch Effort\",\n      \"es-ES\": \"Sprint final\",\n      \"es-MX\": \"√öltimo recurso\",\n      \"fr-CA\": \"Ultime sursaut\",\n      \"fr-FR\": \"Ultime sursaut\",\n      \"it-IT\": \"Splash finale\",\n      \"ja-JP\": \"„É©„Çπ„Éà„Çπ„Éë„Éº„Éà\",\n      \"ko-KR\": \"ÎùºÏä§Ìä∏ Ïä§ÌçºÌä∏\",\n      \"nl-NL\": \"Eindsprint\",\n      \"ru-RU\": \"–§–∏–Ω–∏—à–Ω—ã–π —Å–ø—É—Ä—Ç\",\n      \"zh-CN\": \"ÊúÄÂêéÂÜ≤Âà∫\",\n      \"zh-TW\": \"ÊúÄÂæåË°ùÂà∫\"\n    },\n    \"primary_only\": true\n  },\n  {\n    \"key\": \"tenacity\",\n    \"name\": {\n      \"de-DE\": \"Z√§higkeit\",\n      \"en-GB\": \"Tenacity\",\n      \"en-US\": \"Tenacity\",\n      \"es-ES\": \"Ventaja\",\n      \"es-MX\": \"Tenacidad\",\n      \"fr-CA\": \"T√©nacit√©\",\n      \"fr-FR\": \"Justice\",\n      \"it-IT\": \"Tenacia\",\n      \"ja-JP\": \"ÈÄÜÂ¢ÉÂº∑Âåñ\",\n      \"ko-KR\": \"Ïó≠Í≤Ω Í∞ïÌôî\",\n      \"nl-NL\": \"Volharding\",\n      \"ru-RU\": \"–ö–æ–º–ø–µ–Ω—Å–∞—Ç–æ—Ä\",\n      \"zh-CN\": \"ÈÄÜÂ¢ÉÂº∫Âåñ\",\n      \"zh-TW\": \"ÈÄÜÂ¢ÉÂº∑Âåñ\"\n    },\n    \"primary_only\": true\n  },\n  {\n    \"key\": \"comeback\",\n    \"name\": {\n      \"de-DE\": \"R√ºckkehr\",\n      \"en-GB\": \"Comeback\",\n      \"en-US\": \"Comeback\",\n      \"es-ES\": \"Remontada\",\n      \"es-MX\": \"Remonte\",\n      \"fr-CA\": \"Retour\",\n      \"fr-FR\": \"Come-back\",\n      \"it-IT\": \"Gran ritorno\",\n      \"ja-JP\": \"„Ç´„É†„Éê„ÉÉ„ÇØ\",\n      \"ko-KR\": \"Ïª¥Î∞±\",\n      \"nl-NL\": \"Opfrisser\",\n      \"ru-RU\": \"–û—Ç–≤–µ—Ç–Ω—ã–π —É–¥–∞—Ä\",\n      \"zh-CN\": \"ÂõûÂΩí\",\n      \"zh-TW\": \"ÂõûÊ≠∏\"\n    },\n    \"primary_only\": true\n  },\n  {\n    \"key\": \"ninja_squid\",\n    \"name\": {\n      \"de-DE\": \"Tintenfisch-Ninja\",\n      \"en-GB\": \"Ninja Squid\",\n      \"en-US\": \"Ninja Squid\",\n      \"es-ES\": \"Ninjalamar\",\n      \"es-MX\": \"Ninjalamar\",\n      \"fr-CA\": \"Ninjalmar\",\n      \"fr-FR\": \"Ninjalamar\",\n      \"it-IT\": \"Calamaro ninja\",\n      \"ja-JP\": \"„Ç§„Ç´„Éã„É≥„Ç∏„É£\",\n      \"ko-KR\": \"ÏßïÏñ¥ÎãåÏûê\",\n      \"nl-NL\": \"Ninja-inktvis\",\n      \"ru-RU\": \"–ú–∏–º–∏–∫—Ä–∏—è\",\n      \"zh-CN\": \"È±øÈ±ºÂøçËÄÖ\",\n      \"zh-TW\": \"È≠∑È≠öÂøçËÄÖ\"\n    },\n    \"primary_only\": true\n  },\n  {\n    \"key\": \"haunt\",\n    \"name\": {\n      \"de-DE\": \"Vergeltung\",\n      \"en-GB\": \"Haunt\",\n      \"en-US\": \"Haunt\",\n      \"es-ES\": \"Represalia\",\n      \"es-MX\": \"Resentimiento\",\n      \"fr-CA\": \"Vengeance\",\n      \"fr-FR\": \"Revanche\",\n      \"it-IT\": \"Rappresaglia\",\n      \"ja-JP\": \"„É™„Éô„É≥„Ç∏\",\n      \"ko-KR\": \"Î¶¨Î≤§ÏßÄ\",\n      \"nl-NL\": \"Revanche\",\n      \"ru-RU\": \"–í–µ–Ω–¥–µ—Ç—Ç–∞\",\n      \"zh-CN\": \"Â§ç‰ªá\",\n      \"zh-TW\": \"Âæ©‰ªá\"\n    },\n    \"primary_only\": true\n  },\n  {\n    \"key\": \"thermal_ink\",\n    \"name\": {\n      \"de-DE\": \"Markierfarbe\",\n      \"en-GB\": \"Thermal Ink\",\n      \"en-US\": \"Thermal Ink\",\n      \"es-ES\": \"Se√±uelo\",\n      \"es-MX\": \"Tinta rastreadora\",\n      \"fr-CA\": \"Encre thermique\",\n      \"fr-FR\": \"Encre thermique\",\n      \"it-IT\": \"Inchiostro termico\",\n      \"ja-JP\": \"„Çµ„Éº„Éû„É´„Ç§„É≥„ÇØ\",\n      \"ko-KR\": \"ÏÑúÎ©Ä ÏûâÌÅ¨\",\n      \"nl-NL\": \"Markeerstift\",\n      \"ru-RU\": \"–ö–ª–µ–π–º–æ\",\n      \"zh-CN\": \"ÁÉ≠ÂäõÂ¢®Ê±Å\",\n      \"zh-TW\": \"ÁÜ±ÂäõÂ¢®Ê±Å\"\n    },\n    \"primary_only\": true\n  },\n  {\n    \"key\": \"respawn_punisher\",\n    \"name\": {\n      \"de-DE\": \"Heimsuchung\",\n      \"en-GB\": \"Respawn Punisher\",\n      \"en-US\": \"Respawn Punisher\",\n      \"es-ES\": \"Castigo p√≥stumo\",\n      \"es-MX\": \"Castigo p√≥stumo\",\n      \"fr-CA\": \"Retour perdant\",\n      \"fr-FR\": \"Retour perdant\",\n      \"it-IT\": \"Castigo\",\n      \"ja-JP\": \"Âæ©Ê¥ª„Éö„Éä„É´„ÉÜ„Ç£„Ç¢„ÉÉ„Éó\",\n      \"ko-KR\": \"Î∂ÄÌôú ÌéòÎÑêÌã∞ ÏóÖ\",\n      \"nl-NL\": \"Repercussie\",\n      \"ru-RU\": \"–ö–∞—Ä–∞\",\n      \"zh-CN\": \"ÊèêÂçáÂ§çÊ¥ªÊÉ©ÁΩö\",\n      \"zh-TW\": \"ÊèêÂçáÂæ©Ê¥ªÊá≤ÁΩ∞\"\n    },\n    \"primary_only\": true\n  },\n  {\n    \"key\": \"ability_doubler\",\n    \"name\": {\n      \"de-DE\": \"Effektdoppelung\",\n      \"en-GB\": \"Ability Doubler\",\n      \"en-US\": \"Ability Doubler\",\n      \"es-ES\": \"Duplicador\",\n      \"es-MX\": \"Duplicador\",\n      \"fr-CA\": \"Bonus √ó2\",\n      \"fr-FR\": \"Bonus √ó2\",\n      \"it-IT\": \"Raddoppiatore\",\n      \"ja-JP\": \"ËøΩÂä†„ÇÆ„Ç¢„Éë„ÉØ„ÉºÂÄçÂåñ\",\n      \"ko-KR\": \"Ï∂îÍ∞Ä Í∏∞Ïñ¥ ÌååÏõå 2Î∞∞\",\n      \"nl-NL\": \"Verdubbelaar\",\n      \"ru-RU\": \"–î—É–ø–ª–∏–∫–∞—Ç–æ—Ä\",\n      \"zh-CN\": \"ËøΩÂä†Ë£ÖÂ§áËÉΩÂäõÂ¢ûÂÄç\",\n      \"zh-TW\": \"ËøΩÂä†Ë£ùÂÇôËÉΩÂäõÂ¢ûÂÄç\"\n    },\n    \"primary_only\": true\n  },\n  {\n    \"key\": \"stealth_jump\",\n    \"name\": {\n      \"de-DE\": \"Sprunginfiltration\",\n      \"en-GB\": \"Stealth Jump\",\n      \"en-US\": \"Stealth Jump\",\n      \"es-ES\": \"Supersalto invisible\",\n      \"es-MX\": \"Supersalto invisible\",\n      \"fr-CA\": \"Super saut invisible\",\n      \"fr-FR\": \"R√©ception r√©ussie\",\n      \"it-IT\": \"Salto al buio\",\n      \"ja-JP\": \"„Çπ„ÉÜ„É´„Çπ„Ç∏„É£„É≥„Éó\",\n      \"ko-KR\": \"Ïä§ÌÖîÏä§ Ï†êÌîÑ\",\n      \"nl-NL\": \"Sluipsprong\",\n      \"ru-RU\": \"–î–µ—Å–∞–Ω—Ç\",\n      \"zh-CN\": \"ÈöêË∫´Ë∑≥Ë∑É\",\n      \"zh-TW\": \"Èö±Ë∫´Ë∑≥Ë∫ç\"\n    },\n    \"primary_only\": true\n  },\n  {\n    \"key\": \"object_shredder\",\n    \"name\": {\n      \"de-DE\": \"Zerst√∂rer\",\n      \"en-GB\": \"Object Shredder\",\n      \"en-US\": \"Object Shredder\",\n      \"es-ES\": \"Demolici√≥n\",\n      \"es-MX\": \"Demolici√≥n\",\n      \"fr-CA\": \"D√©molition\",\n      \"fr-FR\": \"D√©molition\",\n      \"it-IT\": \"Demolitore\",\n      \"ja-JP\": \"ÂØæÁâ©ÊîªÊíÉÂäõ„Ç¢„ÉÉ„Éó\",\n      \"ko-KR\": \"Ïò§Î∏åÏ†ùÌä∏ Í≥µÍ≤©Î†• ÏóÖ\",\n      \"nl-NL\": \"Sloper\",\n      \"ru-RU\": \"–î–µ–º–æ–Ω—Ç–∞–∂–Ω–∏–∫\",\n      \"zh-CN\": \"ÊèêÂçáÂØπÁâ©‰ΩìÊîªÂáªÂäõ\",\n      \"zh-TW\": \"ÊèêÂçáÂ∞çÁâ©È´îÊîªÊìäÂäõ\"\n    },\n    \"primary_only\": true\n  },\n  {\n    \"key\": \"drop_roller\",\n    \"name\": {\n      \"de-DE\": \"Tricklandung\",\n      \"en-GB\": \"Drop Roller\",\n      \"en-US\": \"Drop Roller\",\n      \"es-ES\": \"Amortiguador\",\n      \"es-MX\": \"Aterrizaje rodante\",\n      \"fr-CA\": \"Super roulade\",\n      \"fr-FR\": \"Super roulade\",\n      \"it-IT\": \"Atterraggio stiloso\",\n      \"ja-JP\": \"Âèó„ÅëË∫´Ë°ì\",\n      \"ko-KR\": \"ÎÇôÎ≤ï\",\n      \"nl-NL\": \"Rolmodel\",\n      \"ru-RU\": \"–ê–∫—Ä–æ–±–∞—Ç\",\n      \"zh-CN\": \"ÂèóË∫´ÊúØ\",\n      \"zh-TW\": \"ÂèóË∫´Ë°ì\"\n    },\n    \"primary_only\": true\n  }\n]");
const COOP_POINT_MAP = {
    0: -20,
    1: -10,
    2: 0,
    3: 20
};
async function checkResponse(resp) {
    if (Math.floor(resp.status / 100) !== 2) {
        const json = await resp.json().catch(()=>undefined);
        throw new APIError({
            response: resp,
            json,
            message: "Failed to fetch data from stat.ink"
        });
    }
}
class StatInkAPI {
    statInkApiKey;
    env;
    statInk;
    FETCH_LOCK;
    cache;
    constructor(statInkApiKey, env){
        this.statInkApiKey = statInkApiKey;
        this.env = env;
        this.statInk = "https://stat.ink";
        this.FETCH_LOCK = new Mutex();
        this.cache = {};
        this._salmonWeaponMap = new Map();
        this.getSalmonWeapon = ()=>this._getCached(`${this.statInk}/api/v3/salmon/weapon?full=1`);
        this.getWeapon = ()=>this._getCached(`${this.statInk}/api/v3/weapon?full=1`);
        this.getAbility = ()=>__default;
        this.getStage = ()=>this._getCached(`${this.statInk}/api/v3/stage`);
        if (statInkApiKey.length !== 43) {
            throw new Error("Invalid stat.ink API key");
        }
    }
    requestHeaders() {
        return {
            "User-Agent": USERAGENT,
            "Authorization": `Bearer ${this.statInkApiKey}`
        };
    }
    async uuidList(type) {
        const fetch = this.env.newFetcher();
        const response = await fetch.get({
            url: type === "VsInfo" ? `${this.statInk}/api/v3/s3s/uuid-list` : `${this.statInk}/api/v3/salmon/uuid-list`,
            headers: this.requestHeaders()
        });
        await checkResponse(response);
        const uuidResult = await response.json();
        if (!Array.isArray(uuidResult)) {
            throw new APIError({
                response,
                json: uuidResult,
                message: uuidResult.message
            });
        }
        return uuidResult;
    }
    async postBattle(body) {
        const fetch = this.env.newFetcher();
        const resp = await fetch.post({
            url: `${this.statInk}/api/v3/battle`,
            headers: {
                ...this.requestHeaders(),
                "Content-Type": "application/x-msgpack"
            },
            body: mod7.encode(body)
        });
        const json = await resp.json().catch(()=>({}));
        if (resp.status !== 200 && resp.status !== 201) {
            throw new APIError({
                response: resp,
                message: "Failed to export battle",
                json
            });
        }
        if (json.error) {
            throw new APIError({
                response: resp,
                message: "Failed to export battle",
                json
            });
        }
        return json;
    }
    async postCoop(body) {
        const fetch = this.env.newFetcher();
        const resp = await fetch.post({
            url: `${this.statInk}/api/v3/salmon`,
            headers: {
                ...this.requestHeaders(),
                "Content-Type": "application/x-msgpack"
            },
            body: mod7.encode(body)
        });
        const json = await resp.json().catch(()=>({}));
        if (resp.status !== 200 && resp.status !== 201) {
            throw new APIError({
                response: resp,
                message: "Failed to export battle",
                json
            });
        }
        if (json.error) {
            throw new APIError({
                response: resp,
                message: "Failed to export battle",
                json
            });
        }
        return json;
    }
    async _getCached(url) {
        const release = await this.FETCH_LOCK.acquire();
        try {
            if (this.cache[url]) {
                return this.cache[url];
            }
            const fetch = this.env.newFetcher();
            const resp = await fetch.get({
                url,
                headers: this.requestHeaders()
            });
            await checkResponse(resp);
            const json = await resp.json();
            this.cache[url] = json;
            return json;
        } finally{
            release();
        }
    }
    _getAliasName(name) {
        const STAT_INK_DOT = "¬∑";
        const SPLATNET_DOT = "‚Äß";
        if (name.includes(STAT_INK_DOT)) {
            return [
                name,
                name.replaceAll(STAT_INK_DOT, SPLATNET_DOT)
            ];
        } else {
            return [
                name
            ];
        }
    }
    _salmonWeaponMap;
    async getSalmonWeaponMap() {
        if (this._salmonWeaponMap.size === 0) {
            const weapons = await this.getSalmonWeapon();
            for (const weapon of weapons){
                for (const name of Object.values(weapon.name).flatMap((n)=>this._getAliasName(n))){
                    const prevKey = this._salmonWeaponMap.get(name);
                    if (prevKey !== undefined && prevKey !== weapon.key) {
                        console.warn(`Duplicate weapon name: ${name}`);
                    }
                    this._salmonWeaponMap.set(name, weapon.key);
                }
            }
            if (this._salmonWeaponMap.size === 0) {
                throw new Error("Failed to get salmon weapon map");
            }
        }
        return this._salmonWeaponMap;
    }
    getSalmonWeapon;
    getWeapon;
    getAbility;
    getStage;
}
class StatInkExporter {
    name = "stat.ink";
    api;
    uploadMode;
    constructor({ statInkApiKey , uploadMode , env  }){
        this.api = new StatInkAPI(statInkApiKey, env);
        this.uploadMode = uploadMode;
    }
    isTriColor({ vsMode  }) {
        return vsMode.mode === "FEST" && b64Number(vsMode.id) === 8;
    }
    async exportGame(game) {
        if (game.type === "VsInfo") {
            const body = await this.mapBattle(game);
            const { url  } = await this.api.postBattle(body);
            return {
                status: "success",
                url
            };
        } else {
            const body = await this.mapCoop(game);
            const { url  } = await this.api.postCoop(body);
            return {
                status: "success",
                url
            };
        }
    }
    async notExported({ type , list  }) {
        const uuid = await this.api.uuidList(type);
        const out = [];
        for (const id of list){
            const s3sId = await gameId(id);
            const s3siId = await s3siGameId(id);
            const s3sCoopId = await s3sCoopGameId(id);
            if (!uuid.includes(s3sId) && !uuid.includes(s3siId) && !uuid.includes(s3sCoopId)) {
                out.push(id);
            }
        }
        return out;
    }
    mapLobby(vsDetail) {
        const { mode: vsMode  } = vsDetail.vsMode;
        if (vsMode === "REGULAR") {
            return "regular";
        } else if (vsMode === "BANKARA") {
            const { mode  } = vsDetail.bankaraMatch ?? {
                mode: "UNKNOWN"
            };
            const map = {
                OPEN: "bankara_open",
                CHALLENGE: "bankara_challenge",
                UNKNOWN: ""
            };
            const result = map[mode];
            if (result) {
                return result;
            }
        } else if (vsMode === "PRIVATE") {
            return "private";
        } else if (vsMode === "FEST") {
            const modeId = b64Number(vsDetail.vsMode.id);
            if (modeId === 6) {
                return "splatfest_open";
            } else if (modeId === 7) {
                return "splatfest_challenge";
            } else if (modeId === 8) {
                return "splatfest_open";
            }
        } else if (vsMode === "X_MATCH") {
            return "xmatch";
        } else if (vsMode === "LEAGUE") {
            return "event";
        }
        throw new TypeError(`Unknown vsMode ${vsMode}`);
    }
    async mapStage({ vsStage  }) {
        const id = b64Number(vsStage.id).toString();
        const stage = await this.api.getStage();
        const result = stage.find((s)=>s.aliases.includes(id));
        if (!result) {
            throw new Error("Unknown stage: " + vsStage.name);
        }
        return result.key;
    }
    async mapGears({ headGear , clothingGear , shoesGear  }) {
        const amap = (await this.api.getAbility()).map((i)=>({
                ...i,
                names: Object.values(i.name)
            }));
        const mapAbility = ({ name  })=>{
            const result = amap.find((a)=>a.names.includes(name));
            if (!result) {
                return null;
            }
            return result.key;
        };
        const mapGear = ({ primaryGearPower , additionalGearPowers  })=>{
            const primary = mapAbility(primaryGearPower);
            if (!primary) {
                throw new Error("Unknown ability: " + primaryGearPower.name);
            }
            return {
                primary_ability: primary,
                secondary_abilities: additionalGearPowers.map(mapAbility)
            };
        };
        return {
            headgear: mapGear(headGear),
            clothing: mapGear(clothingGear),
            shoes: mapGear(shoesGear)
        };
    }
    mapPlayer = async (player, index)=>{
        const result = {
            me: player.isMyself ? "yes" : "no",
            rank_in_team: index + 1,
            name: player.name,
            number: player.nameId ?? undefined,
            splashtag_title: player.byname,
            weapon: b64Number(player.weapon.id).toString(),
            inked: player.paint,
            gears: await this.mapGears(player),
            crown: player.crown ? "yes" : "no",
            disconnected: player.result ? "no" : "yes"
        };
        if (player.result) {
            result.kill_or_assist = player.result.kill;
            result.assist = player.result.assist;
            result.kill = result.kill_or_assist - result.assist;
            result.death = player.result.death;
            result.signal = player.result.noroshiTry ?? undefined;
            result.special = player.result.special;
        }
        return result;
    };
    async mapBattle({ groupInfo , challengeProgress , bankaraMatchChallenge , listNode , detail: vsDetail , rankBeforeState , rankState  }) {
        const { knockout , vsRule: { rule  } , myTeam , otherTeams , bankaraMatch , leagueMatch , festMatch , playedTime  } = vsDetail;
        const self = vsDetail.myTeam.players.find((i)=>i.isMyself);
        if (!self) {
            throw new Error("Self not found");
        }
        const startedAt = Math.floor(new Date(playedTime).getTime() / 1000);
        if (otherTeams.length === 0) {
            throw new Error(`Other teams is empty`);
        }
        const result = {
            uuid: await gameId(vsDetail.id),
            lobby: this.mapLobby(vsDetail),
            rule: SPLATNET3_STATINK_MAP.RULE[vsDetail.vsRule.rule],
            stage: await this.mapStage(vsDetail),
            result: SPLATNET3_STATINK_MAP.RESULT[vsDetail.judgement],
            weapon: b64Number(self.weapon.id).toString(),
            inked: self.paint,
            rank_in_team: vsDetail.myTeam.players.indexOf(self) + 1,
            medals: vsDetail.awards.map((i)=>i.name),
            our_team_players: await Promise.all(myTeam.players.map(this.mapPlayer)),
            their_team_players: await Promise.all(otherTeams[0].players.map(this.mapPlayer)),
            agent: AGENT_NAME,
            agent_version: S3SI_VERSION,
            agent_variables: {
                "Upload Mode": this.uploadMode
            },
            automated: "yes",
            start_at: startedAt,
            end_at: startedAt + vsDetail.duration
        };
        if (self.result) {
            result.kill_or_assist = self.result.kill;
            result.assist = self.result.assist;
            result.kill = result.kill_or_assist - result.assist;
            result.death = self.result.death;
            result.signal = self.result.noroshiTry ?? undefined;
            result.special = self.result.special;
        }
        result.our_team_color = this.mapColor(myTeam.color);
        result.their_team_color = this.mapColor(otherTeams[0].color);
        if (otherTeams.length === 2) {
            result.third_team_color = this.mapColor(otherTeams[1].color);
        }
        if (festMatch) {
            result.fest_dragon = SPLATNET3_STATINK_MAP.DRAGON[festMatch.dragonMatchType];
            result.clout_change = festMatch.contribution;
            result.fest_power = festMatch.myFestPower ?? undefined;
        }
        if (rule === "TURF_WAR" || rule === "TRI_COLOR") {
            result.our_team_percent = (myTeam?.result?.paintRatio ?? 0) * 100;
            result.their_team_percent = (otherTeams?.[0]?.result?.paintRatio ?? 0) * 100;
            result.our_team_inked = myTeam.players.reduce((acc, i)=>acc + i.paint, 0);
            result.their_team_inked = otherTeams?.[0].players.reduce((acc, i)=>acc + i.paint, 0);
            if (myTeam.festTeamName) {
                result.our_team_theme = myTeam.festTeamName;
            }
            if (myTeam.tricolorRole) {
                result.our_team_role = myTeam.tricolorRole === "DEFENSE" ? "defender" : "attacker";
            }
            if (otherTeams[0].festTeamName) {
                result.their_team_theme = otherTeams[0].festTeamName;
            }
            if (otherTeams[0].tricolorRole) {
                result.their_team_role = otherTeams[0].tricolorRole === "DEFENSE" ? "defender" : "attacker";
            }
            if (otherTeams.length === 2) {
                result.third_team_players = await Promise.all(otherTeams[1].players.map(this.mapPlayer));
                result.third_team_percent = (otherTeams[1]?.result?.paintRatio ?? 0) * 100;
                result.third_team_inked = otherTeams[1].players.reduce((acc, i)=>acc + i.paint, 0);
                if (otherTeams[1].festTeamName) {
                    result.third_team_theme = otherTeams[1].festTeamName;
                }
                if (otherTeams[1].tricolorRole) {
                    result.third_team_role = otherTeams[1].tricolorRole === "DEFENSE" ? "defender" : "attacker";
                }
            }
        }
        if (knockout) {
            result.knockout = knockout === "NEITHER" ? "no" : "yes";
        }
        result.our_team_count = myTeam?.result?.score ?? undefined;
        result.their_team_count = otherTeams?.[0]?.result?.score ?? undefined;
        result.rank_exp_change = bankaraMatch?.earnedUdemaePoint ?? undefined;
        if (listNode?.udemae) {
            [result.rank_before, result.rank_before_s_plus] = parseUdemae(listNode.udemae);
        }
        if (bankaraMatchChallenge && challengeProgress) {
            result.rank_up_battle = bankaraMatchChallenge.isPromo ? "yes" : "no";
            if (challengeProgress.index === 0 && bankaraMatchChallenge.udemaeAfter) {
                [result.rank_after, result.rank_after_s_plus] = parseUdemae(bankaraMatchChallenge.udemaeAfter);
                result.rank_exp_change = bankaraMatchChallenge.earnedUdemaePoint ?? undefined;
            } else {
                result.rank_after = result.rank_before;
                result.rank_after_s_plus = result.rank_before_s_plus;
            }
        }
        if (leagueMatch) {
            result.event = leagueMatch.leagueMatchEvent?.id;
            result.event_power = leagueMatch.myLeaguePower;
        }
        if (challengeProgress) {
            result.challenge_win = challengeProgress.winCount;
            result.challenge_lose = challengeProgress.loseCount;
        }
        if (vsDetail.xMatch) {
            result.x_power_before = result.x_power_after = vsDetail.xMatch.lastXPower;
            if (groupInfo?.xMatchMeasurement && groupInfo?.xMatchMeasurement.state === "COMPLETED" && challengeProgress?.index === 0) {
                result.x_power_after = groupInfo.xMatchMeasurement.xPowerAfter;
            }
        }
        result.bankara_power_after = vsDetail.bankaraMatch?.bankaraPower?.power;
        if (rankBeforeState && rankState) {
            result.rank_before_exp = rankBeforeState.rankPoint;
            result.rank_after_exp = rankState.rankPoint;
            if (!bankaraMatchChallenge?.isUdemaeUp && result.rank_exp_change === undefined) {
                result.rank_exp_change = result.rank_after_exp - result.rank_before_exp;
            }
            if (!result.rank_after) {
                [result.rank_after, result.rank_after_s_plus] = parseUdemae(rankState.rank);
            }
        }
        return result;
    }
    mapColor(color) {
        const float2hex = (i)=>Math.round(i * 255).toString(16).padStart(2, "0");
        const nums = [
            color.r,
            color.g,
            color.b,
            color.a
        ];
        return nums.map(float2hex).join("");
    }
    isRandom(image) {
        const RANDOM_FILENAME = "473fffb2442075078d8bb7125744905abdeae651b6a5b7453ae295582e45f7d1";
        const url = image?.url;
        if (typeof url === "string") {
            return url.includes(RANDOM_FILENAME);
        } else if (url === undefined || url === null) {
            return false;
        } else {
            return url.pathname.includes(RANDOM_FILENAME);
        }
    }
    async mapCoopWeapon({ name , image  }) {
        const weaponMap = await this.api.getSalmonWeaponMap();
        const weapon = weaponMap.get(name);
        if (!weapon) {
            if (this.isRandom(image)) {
                return null;
            }
            throw new Error(`Weapon not found: ${name}`);
        }
        return weapon;
    }
    mapSpecial({ name , image  }) {
        const { url  } = image;
        const imageName = typeof url === "object" ? url.pathname : url ?? "";
        const hash = /\/(\w+)_0\.\w+/.exec(imageName)?.[1] ?? "";
        const special = SPLATNET3_STATINK_MAP.COOP_SPECIAL_MAP[hash];
        if (!special) {
            if (this.isRandom(image)) {
                return Promise.resolve(undefined);
            }
            throw new Error(`Special not found: ${name} (${imageName})`);
        }
        return Promise.resolve(special);
    }
    async mapCoopPlayer(isMyself, { player , weapons , specialWeapon , defeatEnemyCount , deliverCount , goldenAssistCount , goldenDeliverCount , rescueCount , rescuedCount  }) {
        const disconnected = [
            goldenDeliverCount,
            deliverCount,
            rescueCount,
            rescuedCount,
            defeatEnemyCount
        ].every((v)=>v === 0) || !specialWeapon;
        return {
            me: isMyself ? "yes" : "no",
            name: player.name,
            number: player.nameId,
            splashtag_title: player.byname,
            uniform: b64Number(player.uniform.id).toString(),
            special: specialWeapon ? await this.mapSpecial(specialWeapon) : undefined,
            weapons: await Promise.all(weapons.map((w)=>this.mapCoopWeapon(w))),
            golden_eggs: goldenDeliverCount,
            golden_assist: goldenAssistCount,
            power_eggs: deliverCount,
            rescue: rescueCount,
            rescued: rescuedCount,
            defeat_boss: defeatEnemyCount,
            disconnected: disconnected ? "yes" : "no"
        };
    }
    mapKing(id) {
        if (!id) {
            return undefined;
        }
        const nid = b64Number(id).toString();
        return nid;
    }
    async mapWave(wave) {
        const event = wave.eventWave ? SPLATNET3_STATINK_MAP.COOP_EVENT_MAP[b64Number(wave.eventWave.id)] : undefined;
        const special_uses = (await Promise.all(wave.specialWeapons.map((w)=>this.mapSpecial(w)))).flatMap((key)=>key ? [
                key
            ] : []).reduce((p, key)=>({
                ...p,
                [key]: (p[key] ?? 0) + 1
            }), {});
        return {
            tide: SPLATNET3_STATINK_MAP.WATER_LEVEL_MAP[wave.waterLevel],
            event,
            golden_quota: wave.deliverNorm,
            golden_appearances: wave.goldenPopCount,
            golden_delivered: wave.teamDeliverCount,
            special_uses,
            danger_rate: null
        };
    }
    async mapCoop({ gradeBefore , groupInfo , detail  }) {
        const { dangerRate , resultWave , bossResult , myResult , memberResults , scale , playedTime , enemyResults , smellMeter , waveResults  } = detail;
        const startedAt = Math.floor(new Date(playedTime).getTime() / 1000);
        const golden_eggs = waveResults.reduce((prev, i)=>prev + i.teamDeliverCount, 0);
        const power_eggs = myResult.deliverCount + memberResults.reduce((p, i)=>p + i.deliverCount, 0);
        const bosses = Object.fromEntries(enemyResults.map((i)=>[
                b64Number(i.enemy.id),
                {
                    appearances: i.popCount,
                    defeated: i.teamDefeatCount,
                    defeated_by_me: i.defeatCount
                }
            ]));
        const title_after = detail.afterGrade ? b64Number(detail.afterGrade.id).toString() : undefined;
        const title_exp_after = detail.afterGradePoint;
        const maxWaves = detail.rule === "TEAM_CONTEST" ? 5 : 3;
        let clear_waves;
        if (waveResults.length > 0) {
            clear_waves = waveResults.filter((i)=>i.waveNumber < maxWaves + 1).length - 1 + (resultWave === 0 ? 1 : 0);
        } else {
            clear_waves = 0;
        }
        let title_before = undefined;
        let title_exp_before = undefined;
        if (gradeBefore) {
            title_before = b64Number(gradeBefore.grade.id).toString();
            title_exp_before = gradeBefore.gradePoint;
        } else {
            const expDiff = COOP_POINT_MAP[clear_waves];
            if (nonNullable(title_after) && nonNullable(title_exp_after) && nonNullable(expDiff)) {
                if (title_exp_after === 40 && expDiff === 20) {} else if (title_exp_after === 40 && expDiff < 0 && title_after !== "8") {} else if (title_exp_after === 999 && expDiff !== 0) {
                    title_before = title_after;
                } else {
                    if (title_exp_after - expDiff >= 0) {
                        title_before = title_after;
                        title_exp_before = title_exp_after - expDiff;
                    } else {
                        title_before = (parseInt(title_after) - 1).toString();
                    }
                }
            }
        }
        let fail_reason = null;
        if (clear_waves !== maxWaves && waveResults.length > 0) {
            const lastWave = waveResults[waveResults.length - 1];
            if (lastWave.teamDeliverCount >= lastWave.deliverNorm) {
                fail_reason = "wipe_out";
            }
        }
        const result = {
            uuid: await gameId(detail.id),
            private: groupInfo?.mode === "PRIVATE_CUSTOM" ? "yes" : "no",
            big_run: detail.rule === "BIG_RUN" ? "yes" : "no",
            eggstra_work: detail.rule === "TEAM_CONTEST" ? "yes" : "no",
            stage: b64Number(detail.coopStage.id).toString(),
            danger_rate: detail.rule === "TEAM_CONTEST" ? null : dangerRate * 100,
            clear_waves,
            fail_reason,
            king_smell: smellMeter,
            king_salmonid: this.mapKing(detail.bossResult?.boss.id),
            clear_extra: bossResult?.hasDefeatBoss ? "yes" : "no",
            title_before,
            title_exp_before,
            title_after,
            title_exp_after,
            golden_eggs,
            power_eggs,
            gold_scale: scale?.gold,
            silver_scale: scale?.silver,
            bronze_scale: scale?.bronze,
            job_point: detail.jobPoint,
            job_score: detail.jobScore,
            job_rate: detail.jobRate,
            job_bonus: detail.jobBonus,
            waves: await Promise.all(waveResults.map((w)=>this.mapWave(w))),
            players: await Promise.all([
                this.mapCoopPlayer(true, myResult),
                ...memberResults.map((p)=>this.mapCoopPlayer(false, p))
            ]),
            bosses,
            agent: AGENT_NAME,
            agent_version: S3SI_VERSION,
            agent_variables: {
                "Upload Mode": this.uploadMode
            },
            automated: "yes",
            start_at: startedAt
        };
        if (detail.rule === "TEAM_CONTEST") {
            let lastWave;
            for (const [wave] of result.waves.map((p, i)=>[
                    p,
                    i
                ])){
                let haz_level;
                if (!lastWave) {
                    haz_level = 60;
                } else {
                    const num_players = result.players.length;
                    const quota = lastWave.golden_quota;
                    const delivered = lastWave.golden_delivered;
                    let added_percent = 0;
                    if (num_players == 4) {
                        if (delivered >= quota * 2) {
                            added_percent = 60;
                        } else if (delivered >= quota * 1.5) {
                            added_percent = 30;
                        }
                    } else if (num_players == 3) {
                        if (delivered >= quota * 2) {
                            added_percent = 40;
                        } else if (delivered >= quota * 1.5) {
                            added_percent = 20;
                        }
                    } else if (num_players == 2) {
                        if (delivered >= quota * 2) {
                            added_percent = 20;
                        } else if (delivered >= quota * 1.5) {
                            added_percent = 10;
                            added_percent = 5;
                        }
                    } else if (num_players == 1) {
                        if (delivered >= quota * 2) {
                            added_percent = 10;
                        } else if (delivered >= quota * 1.5) {
                            added_percent = 5;
                        }
                    }
                    const prev_percent = lastWave.danger_rate;
                    haz_level = prev_percent + added_percent;
                }
                wave.danger_rate = haz_level;
                lastWave = wave;
            }
        }
        return result;
    }
}
function parseUdemae(udemae) {
    const [rank, rankNum] = udemae.split(/([0-9]+)/);
    return [
        rank.toLowerCase(),
        rankNum === undefined ? undefined : parseInt(rankNum)
    ];
}
function replacer(key, value) {
    if (![
        "url",
        "maskImageUrl",
        "overlayImageUrl"
    ].includes(key)) {
        return value;
    }
    return typeof value === "string" ? urlSimplify(value) : undefined;
}
class FileExporter {
    exportPath;
    name;
    constructor(exportPath){
        this.exportPath = exportPath;
        this.name = "file";
    }
    getFilenameById(id) {
        const { uid , timestamp  } = parseHistoryDetailId(id);
        return `${uid}_${timestamp}Z.json`;
    }
    async exportedGames({ uid , type , filter  }) {
        const out = [];
        for await (const entry of Deno.readDir(this.exportPath)){
            const filename = entry.name;
            const [fileUid, timestamp] = filename.split("_", 2);
            if (!entry.isFile || fileUid !== uid) {
                continue;
            }
            const filepath = mod10.join(this.exportPath, filename);
            const content = await Deno.readTextFile(filepath);
            const body = JSON.parse(content);
            if (body.type === "SUMMARY") {
                continue;
            }
            if (body.type === "VS" && type === "VsInfo") {
                if (filter && !filter(body.data)) {
                    continue;
                }
                out.push({
                    id: body.data.detail.id,
                    filepath,
                    timestamp
                });
            } else if (body.type === "COOP" && type === "CoopInfo") {
                if (filter && !filter(body.data)) {
                    continue;
                }
                out.push({
                    id: body.data.detail.id,
                    filepath,
                    timestamp
                });
            }
        }
        return out.sort((a, b)=>b.timestamp.localeCompare(a.timestamp)).map(({ id , filepath  })=>({
                id,
                getContent: async ()=>{
                    const content = await Deno.readTextFile(filepath);
                    const body = JSON.parse(content);
                    return body.data;
                }
            }));
    }
    async exportSummary(summary) {
        const filename = `${summary.uid}_summary.json`;
        const filepath = mod10.join(this.exportPath, filename);
        const body = {
            type: "SUMMARY",
            nsoVersion: NSOAPP_VERSION,
            s3siVersion: S3SI_VERSION,
            exportTime: new Date().toISOString(),
            data: summary
        };
        await Deno.writeTextFile(filepath, JSON.stringify(body));
        return {
            status: "success",
            url: filepath
        };
    }
    async exportGame(info) {
        await Deno.mkdir(this.exportPath, {
            recursive: true
        });
        const filename = this.getFilenameById(info.detail.id);
        const filepath = mod10.join(this.exportPath, filename);
        const common = {
            nsoVersion: NSOAPP_VERSION,
            s3siVersion: S3SI_VERSION,
            exportTime: new Date().toISOString()
        };
        const dataType = info.type === "VsInfo" ? {
            type: "VS",
            data: info
        } : {
            type: "COOP",
            data: info
        };
        const body = {
            ...common,
            ...dataType
        };
        await Deno.writeTextFile(filepath, JSON.stringify(body, replacer));
        return {
            status: "success",
            url: filepath
        };
    }
    async notExported({ list  }) {
        const out = [];
        for (const id of list){
            const filename = this.getFilenameById(id);
            const filepath = mod10.join(this.exportPath, filename);
            const isFile = await Deno.stat(filepath).then((f)=>f.isFile).catch(()=>false);
            if (!isFile) {
                out.push(id);
            }
        }
        return out;
    }
}
const SEASONS = [
    {
        id: "season202209",
        name: "Drizzle Season 2022",
        start: new Date("2022-09-01T00:00:00+00:00"),
        end: new Date("2022-12-01T00:00:00+00:00")
    },
    {
        id: "season202212",
        name: "Chill Season 2022",
        start: new Date("2022-12-01T00:00:00+00:00"),
        end: new Date("2023-03-01T00:00:00+00:00")
    },
    {
        id: "season202303",
        name: "Fresh Season 2023",
        start: new Date("2023-03-01T00:00:00+00:00"),
        end: new Date("2023-06-01T00:00:00+00:00")
    },
    {
        id: "season202306",
        name: "Sizzle Season 2023",
        start: new Date("2023-06-01T00:00:00+00:00"),
        end: new Date("2023-09-01T00:00:00+00:00")
    }
];
const getSeason = (date)=>{
    return SEASONS.find((s)=>s.start <= date && date < s.end);
};
const splusParams = ()=>{
    const out = [];
    for(let i = 0; i < 50; i++){
        const level = i % 10;
        const item = {
            rank: `S+${i}`,
            pointRange: [
                300 + level * 350,
                300 + (level + 1) * 350
            ],
            charge: 180
        };
        if (level === 9) {
            item.promotion = true;
        }
        out.push(item);
    }
    out.push({
        rank: "S+50",
        pointRange: [
            0,
            9999
        ],
        charge: 180
    });
    return out;
};
const RANK_PARAMS = [
    {
        rank: "C-",
        pointRange: [
            0,
            200
        ],
        charge: 0
    },
    {
        rank: "C",
        pointRange: [
            200,
            400
        ],
        charge: 20
    },
    {
        rank: "C+",
        pointRange: [
            400,
            600
        ],
        charge: 40,
        promotion: true
    },
    {
        rank: "B-",
        pointRange: [
            100,
            350
        ],
        charge: 55
    },
    {
        rank: "B",
        pointRange: [
            350,
            600
        ],
        charge: 70
    },
    {
        rank: "B+",
        pointRange: [
            600,
            850
        ],
        charge: 85,
        promotion: true
    },
    {
        rank: "A-",
        pointRange: [
            200,
            500
        ],
        charge: 110
    },
    {
        rank: "A",
        pointRange: [
            500,
            800
        ],
        charge: 120
    },
    {
        rank: "A+",
        pointRange: [
            800,
            1100
        ],
        charge: 130,
        promotion: true
    },
    {
        rank: "S",
        pointRange: [
            300,
            1000
        ],
        charge: 170,
        promotion: true
    },
    ...splusParams()
];
function addRank(state, delta) {
    if (!state) {
        if (delta.isPromotion && delta.isRankUp) {
            state = getRankStateByDelta(delta);
        } else {
            return;
        }
    }
    if (state.gameId !== delta.before.gameId) {
        throw new Error("Invalid state");
    }
    const { rank , rankPoint  } = state;
    const { gameId , timestamp , rankAfter , isPromotion , isRankUp , isChallengeFirst  } = delta;
    if (state.timestamp) {
        const oldSeason = getSeason(new Date(state.timestamp * 1000));
        if (oldSeason) {
            const newSeason = getSeason(new Date(timestamp * 1000));
            if (newSeason?.id !== oldSeason.id) {
                return;
            }
        }
    }
    const rankIndex = RANK_PARAMS.findIndex((r)=>r.rank === rank);
    if (rankIndex === -1) {
        throw new Error(`Rank not found: ${rank}`);
    }
    const rankParam = RANK_PARAMS[rankIndex];
    if (isChallengeFirst) {
        return {
            before: state,
            after: {
                gameId,
                timestamp,
                rank,
                rankPoint: rankPoint - rankParam.charge
            }
        };
    }
    if (rankIndex === RANK_PARAMS.length - 1) {
        return {
            before: state,
            after: {
                timestamp,
                gameId,
                rank,
                rankPoint: Math.min(rankPoint + delta.rankPoint, rankParam.pointRange[1])
            }
        };
    }
    if (isPromotion && isRankUp) {
        const nextRankParam = RANK_PARAMS[rankIndex + 1];
        return {
            before: state,
            after: {
                gameId,
                timestamp,
                rank: nextRankParam.rank,
                rankPoint: nextRankParam.pointRange[0]
            }
        };
    }
    return {
        before: state,
        after: {
            gameId,
            timestamp,
            rank: rankAfter ?? rank,
            rankPoint: rankPoint + delta.rankPoint
        }
    };
}
function beginPoint(state, flatten) {
    if (state) {
        const index = flatten.findIndex((i)=>i.gameId === state.gameId);
        if (index !== -1) {
            return [
                flatten[index],
                flatten.slice(index)
            ];
        }
    }
    if (flatten.length === 0) {
        throw new Error("flatten must not be empty");
    }
    return [
        flatten[0],
        flatten
    ];
}
function getTimestamp(date) {
    return Math.floor(date.getTime() / 1000);
}
function generateDeltaList(state, flatten) {
    const [firstItem, unProcessed] = beginPoint(state, flatten);
    const deltaList = [];
    let before = {
        gameId: firstItem.gameId,
        timestamp: getTimestamp(firstItem.time)
    };
    for (const i of unProcessed.slice(1)){
        if (!i.detail.bankaraMatch) {
            throw new TypeError("bankaraMatch must be defined");
        }
        let delta = {
            before,
            gameId: i.gameId,
            timestamp: getTimestamp(i.time),
            rankPoint: 0,
            isPromotion: false,
            isRankUp: false,
            isChallengeFirst: false
        };
        before = {
            gameId: i.gameId,
            timestamp: Math.floor(i.time.getTime() / 1000)
        };
        if (i.bankaraMatchChallenge) {
            if (i.index === 0 && i.bankaraMatchChallenge.state !== "INPROGRESS") {
                delta = {
                    ...delta,
                    rank: i.detail.udemae,
                    rankAfter: i.bankaraMatchChallenge.udemaeAfter ?? undefined,
                    rankPoint: i.bankaraMatchChallenge.earnedUdemaePoint ?? 0,
                    isPromotion: i.bankaraMatchChallenge.isPromo ?? false,
                    isRankUp: i.bankaraMatchChallenge.isUdemaeUp ?? false,
                    isChallengeFirst: false
                };
            } else if (i.index === i.groupLength - 1) {
                delta = {
                    ...delta,
                    isChallengeFirst: true
                };
            }
        } else {
            delta = {
                ...delta,
                rankAfter: i.detail.udemae,
                rankPoint: i.detail.bankaraMatch?.earnedUdemaePoint ?? 0
            };
        }
        deltaList.push(delta);
    }
    return {
        firstItem,
        deltaList
    };
}
function getRankStateByDelta(i) {
    const rank = i.rank;
    const nextRank = i.rankAfter;
    const earnedUdemaePoint = i.rankPoint;
    if (!rank || !nextRank) {
        throw new Error("rank and nextRank must be defined");
    }
    const param = RANK_PARAMS.find((i)=>i.rank === rank);
    const nextParam = RANK_PARAMS.find((i)=>i.rank === nextRank);
    if (!param || !nextParam) {
        throw new Error(`Rank or nextRank not found: ${rank} ${nextRank}`);
    }
    const oldRankPoint = nextParam.pointRange[0] - earnedUdemaePoint;
    return {
        gameId: i.before.gameId,
        timestamp: i.before.timestamp,
        rank,
        rankPoint: oldRankPoint
    };
}
class RankTracker {
    state;
    deltaMap;
    stateMap;
    constructor(state){
        this.state = state;
        this.deltaMap = new Map();
        this.stateMap = new Map();
    }
    async getRankStateById(id) {
        const gid = await gameId(id);
        return this.stateMap.get(gid);
    }
    setState(state) {
        this.state = state;
    }
    async updateState(history) {
        if (history.length === 0) {
            return;
        }
        const flatten = await Promise.all(history.flatMap(({ historyDetails , bankaraMatchChallenge  })=>{
            return historyDetails.nodes.map((j, index)=>({
                    id: j.id,
                    time: battleTime(j.id),
                    gameId: gameId(j.id),
                    bankaraMatchChallenge,
                    index,
                    groupLength: historyDetails.nodes.length,
                    detail: j
                }));
        }).sort((a, b)=>a.time.getTime() - b.time.getTime()).map((i)=>i.gameId.then((gameId)=>({
                    ...i,
                    gameId
                }))));
        let curState = this.state;
        const { firstItem , deltaList  } = generateDeltaList(curState, flatten);
        if (curState && firstItem.gameId !== curState.gameId) {
            return;
        }
        for (const delta of deltaList){
            this.deltaMap.set(delta.before.gameId, delta);
            const result = addRank(curState, delta);
            curState = result?.after;
            if (result) {
                this.stateMap.set(result.after.gameId, result);
            }
        }
        return curState;
    }
}
class GameFetcher {
    _splatnet;
    cache;
    rankTracker;
    lock = {};
    bankaraLock = new Mutex();
    bankaraHistory;
    coopLock = new Mutex();
    coopHistory;
    xMatchLock = new Mutex();
    xMatchHistory;
    constructor({ cache =new MemoryCache() , splatnet , state  }){
        this._splatnet = splatnet;
        this.cache = cache;
        this.rankTracker = new RankTracker(state.rankState);
    }
    get splatnet() {
        if (!this._splatnet) {
            throw new Error("splatnet is not set");
        }
        return this._splatnet;
    }
    getLock(id) {
        let cur = this.lock[id];
        if (!cur) {
            cur = new Mutex();
            this.lock[id] = cur;
        }
        return cur;
    }
    setRankState(state) {
        this.rankTracker.setState(state);
    }
    async updateRank() {
        const finalState = await this.rankTracker.updateState(await this.getBankaraHistory());
        return finalState;
    }
    getRankStateById(id) {
        return this.rankTracker.getRankStateById(id);
    }
    getXMatchHistory() {
        if (!this._splatnet) {
            return [];
        }
        return this.xMatchLock.use(async ()=>{
            if (this.xMatchHistory) {
                return this.xMatchHistory;
            }
            const { xBattleHistories: { historyGroups  }  } = await this.splatnet.getXBattleHistories();
            this.xMatchHistory = historyGroups.nodes;
            return this.xMatchHistory;
        });
    }
    getBankaraHistory() {
        if (!this._splatnet) {
            return [];
        }
        return this.bankaraLock.use(async ()=>{
            if (this.bankaraHistory) {
                return this.bankaraHistory;
            }
            const { bankaraBattleHistories: { historyGroups  }  } = await this.splatnet.getBankaraBattleHistories();
            this.bankaraHistory = historyGroups.nodes;
            return this.bankaraHistory;
        });
    }
    getCoopHistory() {
        if (!this._splatnet) {
            return [];
        }
        return this.coopLock.use(async ()=>{
            if (this.coopHistory) {
                return this.coopHistory;
            }
            const { coopResult: { historyGroups  }  } = await this.splatnet.getCoopHistories();
            this.coopHistory = historyGroups.nodes;
            return this.coopHistory;
        });
    }
    async getCoopMetaById(id) {
        const coopHistory = this._splatnet ? await this.getCoopHistory() : [];
        const group = coopHistory.find((i)=>i.historyDetails.nodes.some((i)=>i.id === id));
        if (!group) {
            return {
                type: "CoopInfo",
                listNode: null,
                groupInfo: null,
                gradeBefore: null
            };
        }
        const { historyDetails , ...groupInfo } = group;
        const listNodeIdx = historyDetails.nodes.findIndex((i)=>i.id === id) ?? null;
        const listNode = listNodeIdx !== null ? historyDetails.nodes[listNodeIdx] : null;
        const listNodeBefore = listNodeIdx !== null ? historyDetails.nodes[listNodeIdx + 1] ?? null : null;
        return {
            type: "CoopInfo",
            listNode,
            groupInfo,
            gradeBefore: listNodeBefore?.afterGrade && listNodeBefore.afterGradePoint ? {
                grade: listNodeBefore.afterGrade,
                gradePoint: listNodeBefore.afterGradePoint
            } : null
        };
    }
    async getBattleMetaById(id, vsMode) {
        const gid = await gameId(id);
        const gameIdMap = new Map();
        let group = null;
        let listNode = null;
        if (vsMode === "BANKARA" || vsMode === "X_MATCH") {
            const bankaraHistory = vsMode === "BANKARA" ? await this.getBankaraHistory() : await this.getXMatchHistory();
            for (const i of bankaraHistory){
                for (const j of i.historyDetails.nodes){
                    gameIdMap.set(j, await gameId(j.id));
                }
            }
            group = bankaraHistory.find((i)=>i.historyDetails.nodes.some((i)=>gameIdMap.get(i) === gid)) ?? null;
        }
        if (!group) {
            return {
                type: "VsInfo",
                challengeProgress: null,
                bankaraMatchChallenge: null,
                listNode: null,
                rankState: null,
                rankBeforeState: null,
                groupInfo: null
            };
        }
        const { bankaraMatchChallenge , xMatchMeasurement  } = group;
        const { historyDetails , ...groupInfo } = group;
        listNode = historyDetails.nodes.find((i)=>gameIdMap.get(i) === gid) ?? null;
        const index = historyDetails.nodes.indexOf(listNode);
        let challengeProgress = null;
        const challengeOrMeasurement = bankaraMatchChallenge || xMatchMeasurement;
        if (challengeOrMeasurement) {
            const pastBattles = historyDetails.nodes.slice(0, index);
            const { winCount , loseCount  } = challengeOrMeasurement;
            challengeProgress = {
                index,
                winCount: winCount - pastBattles.filter((i)=>i.judgement == "WIN").length,
                loseCount: loseCount - pastBattles.filter((i)=>[
                        "LOSE",
                        "DEEMED_LOSE"
                    ].includes(i.judgement)).length
            };
        }
        const { before , after  } = await this.rankTracker.getRankStateById(id) ?? {};
        return {
            type: "VsInfo",
            bankaraMatchChallenge,
            listNode,
            challengeProgress,
            rankState: after ?? null,
            rankBeforeState: before ?? null,
            groupInfo
        };
    }
    cacheDetail(id, getter) {
        const lock = this.getLock(id);
        return lock.use(async ()=>{
            const cached = await this.cache.read(id);
            if (cached) {
                return cached;
            }
            const detail = await getter();
            await this.cache.write(id, detail);
            return detail;
        });
    }
    fetch(type, id) {
        switch(type){
            case "VsInfo":
                return this.fetchBattle(id);
            case "CoopInfo":
                return this.fetchCoop(id);
            default:
                throw new Error(`Unknown game type: ${type}`);
        }
    }
    async fetchBattle(id) {
        const detail = await this.cacheDetail(id, ()=>this.splatnet.getBattleDetail(id).then((r)=>r.vsHistoryDetail));
        const metadata = await this.getBattleMetaById(id, detail.vsMode.mode);
        const game = {
            ...metadata,
            detail
        };
        return game;
    }
    async fetchCoop(id) {
        const detail = await this.cacheDetail(id, ()=>this.splatnet.getCoopDetail(id).then((r)=>r.coopHistoryDetail));
        const metadata = await this.getCoopMetaById(id);
        const game = {
            ...metadata,
            detail
        };
        return game;
    }
}
const DEFAULT_OPTS = {
    profilePath: "./profile.json",
    exporter: "stat.ink",
    noProgress: false,
    monitor: false,
    withSummary: false,
    listMethod: "auto",
    env: DEFAULT_ENV
};
class StepProgress {
    currentUrl;
    total;
    exported;
    done;
    skipped;
    constructor(){
        this.total = 1;
        this.exported = 0;
        this.done = 0;
        this.skipped = {};
    }
}
class BattleListFetcher {
    splatnet;
    listMethod;
    allBattleList;
    latestBattleList;
    allLock;
    latestLock;
    constructor(listMethod, splatnet){
        this.splatnet = splatnet;
        this.allLock = new Mutex();
        this.latestLock = new Mutex();
        if (listMethod === "all") {
            this.listMethod = "all";
        } else if (listMethod === "latest") {
            this.listMethod = "latest";
        } else {
            this.listMethod = "auto";
        }
    }
    getAllBattleList() {
        return this.allLock.use(async ()=>{
            if (!this.allBattleList) {
                this.allBattleList = await this.splatnet.getAllBattleList();
            }
            return this.allBattleList;
        });
    }
    getLatestBattleList() {
        return this.latestLock.use(async ()=>{
            if (!this.latestBattleList) {
                this.latestBattleList = await this.splatnet.getBattleList();
            }
            return this.latestBattleList;
        });
    }
    async innerFetch(exporter) {
        if (this.listMethod === "latest") {
            return await exporter.notExported({
                type: "VsInfo",
                list: await this.getLatestBattleList()
            });
        }
        if (this.listMethod === "all") {
            return await exporter.notExported({
                type: "VsInfo",
                list: await this.getAllBattleList()
            });
        }
        if (this.listMethod === "auto") {
            const latestList = await exporter.notExported({
                type: "VsInfo",
                list: await this.getLatestBattleList()
            });
            if (latestList.length === 50) {
                return await exporter.notExported({
                    type: "VsInfo",
                    list: await this.getAllBattleList()
                });
            }
            return latestList;
        }
        throw new TypeError(`Unknown listMethod: ${this.listMethod}`);
    }
    async fetch(exporter) {
        return [
            ...await this.innerFetch(exporter)
        ].reverse();
    }
}
class CoopListFetcher {
    splatnet;
    constructor(splatnet){
        this.splatnet = splatnet;
    }
    async fetch(exporter) {
        return [
            ...await exporter.notExported({
                type: "CoopInfo",
                list: await this.splatnet.getBattleList(BattleListType.Coop)
            })
        ].reverse();
    }
}
function progress({ total , currentUrl , done  }) {
    return {
        total,
        currentUrl,
        current: done
    };
}
class App {
    opts;
    profile;
    env;
    constructor(opts){
        this.opts = opts;
        const stateBackend = opts.stateBackend ?? new FileStateBackend(opts.profilePath);
        this.profile = new Profile({
            stateBackend,
            env: opts.env
        });
        this.env = opts.env;
        if (opts.listMethod && ![
            "all",
            "auto",
            "latest"
        ].includes(opts.listMethod)) {
            throw new TypeError(`Unknown listMethod: ${opts.listMethod}`);
        }
    }
    getSkipMode() {
        const mode = this.opts.skipMode;
        if (mode === "vs") {
            return [
                "vs"
            ];
        } else if (mode === "coop") {
            return [
                "coop"
            ];
        }
        return [];
    }
    async getExporters() {
        const state = this.profile.state;
        const exporters = this.opts.exporter.split(",");
        const out = [];
        if (exporters.includes("stat.ink")) {
            if (!state.statInkApiKey) {
                const key = (await this.env.prompts.prompt("stat.ink API key is not set. Please enter below.")).trim();
                if (!key) {
                    this.env.logger.error("API key is required.");
                    Deno.exit(1);
                }
                await this.profile.writeState({
                    ...state,
                    statInkApiKey: key
                });
            }
            out.push(new StatInkExporter({
                statInkApiKey: this.profile.state.statInkApiKey,
                uploadMode: this.opts.monitor ? "Monitoring" : "Manual",
                env: this.env
            }));
        }
        if (exporters.includes("file")) {
            out.push(new FileExporter(state.fileExportPath));
        }
        return out;
    }
    exporterProgress(title) {
        const bar = !this.opts.noProgress ? new MultiProgressBar({
            title,
            display: "[:bar] :text :percent :time eta: :eta :completed/:total"
        }) : undefined;
        const allProgress = {};
        const redraw = (name, progress)=>{
            allProgress[name] = progress;
            if (bar) {
                bar.render(Object.entries(allProgress).map(([name, progress])=>({
                        completed: progress.current,
                        total: progress.total,
                        text: name
                    })));
            } else if (progress.currentUrl) {
                this.env.logger.log(`Battle exported to ${progress.currentUrl} (${progress.current}/${progress.total})`);
            }
        };
        const endBar = ()=>{
            bar?.end();
        };
        return {
            redraw,
            endBar
        };
    }
    async exportOnce() {
        const splatnet = new Splatnet3({
            profile: this.profile,
            env: this.env
        });
        const exporters = await this.getExporters();
        const initStats = ()=>Object.fromEntries(exporters.map((e)=>[
                    e.name,
                    new StepProgress()
                ]));
        let stats = initStats();
        const skipMode = this.getSkipMode();
        const errors = [];
        if (skipMode.includes("vs") || exporters.length === 0) {
            this.env.logger.log("Skip exporting VS games.");
        } else {
            const gameListFetcher = new BattleListFetcher(this.opts.listMethod ?? "auto", splatnet);
            const { redraw , endBar  } = this.exporterProgress("Export vs games");
            const fetcher = new GameFetcher({
                cache: this.opts.cache ?? new FileCache(this.profile.state.cacheDir),
                state: this.profile.state,
                splatnet
            });
            const finalRankState = await fetcher.updateRank();
            await Promise.all(exporters.map((e)=>showError(this.env, this.exportGameList({
                    type: "VsInfo",
                    fetcher,
                    exporter: e,
                    gameListFetcher,
                    stepProgress: stats[e.name],
                    onStep: ()=>{
                        redraw(e.name, progress(stats[e.name]));
                    }
                })).catch((err)=>{
                    errors.push(err);
                    this.env.logger.error(`\nFailed to export to ${e.name}:`, err);
                })));
            endBar();
            this.printStats(stats);
            if (errors.length > 0) {
                throw errors[0];
            }
            fetcher.setRankState(finalRankState);
            await this.profile.writeState({
                ...this.profile.state,
                rankState: finalRankState
            });
        }
        stats = initStats();
        if (skipMode.includes("coop") || exporters.length === 0) {
            this.env.logger.log("Skip exporting coop games.");
        } else {
            const gameListFetcher = new CoopListFetcher(splatnet);
            const { redraw , endBar  } = this.exporterProgress("Export coop games");
            const fetcher = new GameFetcher({
                cache: this.opts.cache ?? new FileCache(this.profile.state.cacheDir),
                state: this.profile.state,
                splatnet
            });
            await Promise.all(exporters.map((e)=>showError(this.env, this.exportGameList({
                    type: "CoopInfo",
                    fetcher,
                    exporter: e,
                    gameListFetcher,
                    stepProgress: stats[e.name],
                    onStep: ()=>{
                        redraw(e.name, progress(stats[e.name]));
                    }
                })).catch((err)=>{
                    errors.push(err);
                    this.env.logger.error(`\nFailed to export to ${e.name}:`, err);
                })));
            endBar();
            this.printStats(stats);
            if (errors.length > 0) {
                throw errors[0];
            }
        }
        const summaryExporters = exporters.filter((e)=>e.exportSummary);
        if (!this.opts.withSummary || summaryExporters.length === 0) {
            this.env.logger.log("Skip exporting summary.");
        } else {
            this.env.logger.log("Fetching summary...");
            const summary = await splatnet.getSummary();
            await Promise.all(summaryExporters.map((e)=>showError(this.env, e.exportSummary(summary)).then((result)=>{
                    if (result.status === "success") {
                        this.env.logger.log(`Exported summary to ${result.url}`);
                    } else if (result.status === "skip") {
                        this.env.logger.log(`Skipped exporting summary to ${e.name}`);
                    } else {}
                }).catch((err)=>{
                    errors.push(err);
                    this.env.logger.error(`\nFailed to export to ${e.name}:`, err);
                })));
            if (errors.length > 0) {
                throw errors[0];
            }
        }
    }
    async monitor() {
        while(true){
            await this.exportOnce();
            await this.countDown(this.profile.state.monitorInterval);
        }
    }
    async countDown(sec) {
        const bar = !this.opts.noProgress ? new MultiProgressBar({
            title: "Killing time...",
            display: "[:bar] :completed/:total"
        }) : undefined;
        for (const i of Array(sec).keys()){
            bar?.render([
                {
                    completed: i,
                    total: sec
                }
            ]);
            await delay(1000);
        }
        bar?.end();
    }
    async run() {
        await this.profile.readState();
        if (!this.profile.state.loginState?.sessionToken) {
            const sessionToken = await loginManually(this.env);
            await this.profile.writeState({
                ...this.profile.state,
                loginState: {
                    ...this.profile.state.loginState,
                    sessionToken
                }
            });
        }
        if (this.opts.monitor) {
            await this.monitor();
        } else {
            await this.exportOnce();
        }
    }
    async exportGameList({ type , fetcher , exporter , gameListFetcher , stepProgress , onStep  }) {
        onStep?.();
        const workQueue = await gameListFetcher.fetch(exporter);
        const step = async (id)=>{
            const detail = await fetcher.fetch(type, id);
            const result = await exporter.exportGame(detail);
            stepProgress.done += 1;
            stepProgress.currentUrl = undefined;
            if (result.status === "success") {
                stepProgress.exported += 1;
                stepProgress.currentUrl = result.url;
            } else if (result.status === "skip") {
                const { skipped  } = stepProgress;
                skipped[result.reason] = (skipped[result.reason] ?? 0) + 1;
            } else {}
            onStep?.();
        };
        if (workQueue.length > 0) {
            stepProgress.total = workQueue.length;
            onStep?.();
            for (const battle of workQueue){
                await step(battle);
            }
        } else {
            stepProgress.done = 1;
            onStep?.();
        }
        return stepProgress;
    }
    printStats(stats) {
        this.env.logger.log(`Exported ${Object.entries(stats).map(([name, { exported  }])=>`${name}: ${exported}`).join(", ")}`);
        if (Object.values(stats).some((i)=>Object.keys(i.skipped).length > 0)) {
            this.env.logger.log(`Skipped ${Object.entries(stats).map(([name, { skipped  }])=>Object.entries(skipped).map(([reason, count])=>`${name}: ${reason} (${count})`).join(", "))}`);
        }
    }
}
const parseArgs = (args)=>{
    const parsed = mod1.parse(args, {
        string: [
            "profilePath",
            "exporter",
            "skipMode",
            "listMethod"
        ],
        boolean: [
            "help",
            "noProgress",
            "monitor",
            "withSummary"
        ],
        alias: {
            "help": "h",
            "profilePath": [
                "p",
                "profile-path"
            ],
            "exporter": [
                "e"
            ],
            "noProgress": [
                "n",
                "no-progress"
            ],
            "monitor": [
                "m"
            ],
            "skipMode": [
                "s",
                "skip-mode"
            ],
            "withSummary": "with-summary",
            "listMethod": "list-method"
        }
    });
    return parsed;
};
const opts = parseArgs(Deno.args);
if (opts.help) {
    console.log(`Usage: deno run -A ${Deno.mainModule} [options]

Options:
    --profile-path <path>, -p    Path to config file (default: ./profile.json)
    --exporter <exporter>, -e    Exporter list to use (default: stat.ink)
                                 Multiple exporters can be separated by commas
                                 (e.g. "stat.ink,file")
    --list-method                When set to "latest", the latest 50 matches will be obtained.
                                 When set to "all", matches of all modes will be obtained with a maximum of 250 matches (5 modes x 50 matches).
                                 When set to "auto", the latest 50 matches will be obtained. If 50 matches have not been uploaded yet, matches will be obtained from the list of all modes.
                                 "auto" is the default setting.
    --no-progress, -n            Disable progress bar
    --monitor, -m                Monitor mode
    --skip-mode <mode>, -s       Skip mode (default: null)
                                 ("vs", "coop")
    --with-summary               Include summary in the output
    --help                       Show this help message and exit`);
    Deno.exit(0);
}
const app = new App({
    ...DEFAULT_OPTS,
    ...opts
});
await showError(app.env, app.run());
</file>

<file path="source/plugins/community/splatoon/index.mjs">
//Imports
import assets from "./assets.mjs"

//Setup
export default async function({login, q, imports, data, account}, {enabled = false, extras = false, token, "statink.token": _statink_token} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.splatoon) || (!imports.metadata.plugins.splatoon.enabled(enabled, {extras})))
      return null

    //Load inputs
    const {sections, "versus.limit": _versus_limit, "salmon.limit": _salmon_limit, statink, source} = imports.metadata.plugins.splatoon.inputs({data, account, q})

    //Save profile
    {
      const profile = `${imports.__module(import.meta.url)}/s3si/profile.json`
      console.debug(`metrics/compute/${login}/plugins > splatoon > saving ${profile}`)
      const parsed = JSON.parse(token)
      if (!parsed?.loginState?.sessionToken)
        throw new Error("Configuration is missing sessionToken")
      if (statink) {
        console.debug(`metrics/compute/${login}/plugins > splatoon > stat.ink integration is enabled`)
        if (_statink_token) {
          parsed.statInkApiKey = _statink_token
          console.debug(`metrics/compute/${login}/plugins > splatoon > stat.ink api key set`)
        }
        else {
          data.warnings.push({warning: {message: '"plugin_splatoon_statink" is set without "plugin_splatoon_statink_token"'}})
          console.debug(`metrics/compute/${login}/plugins > splatoon > stat.ink api key missing`)
        }
      }
      await imports.fs.writeFile(profile, JSON.stringify(parsed))
    }

    //Fetch data
    const allowed = {
      files: ["profile.json", "profile.json.swap", "export", "cache"],
      net: ["api.imink.app", "accounts.nintendo.com", "api.accounts.nintendo.com", "api-lp1.znc.srv.nintendo.net", "api.lp1.av5ja.srv.nintendo.net"],
    }
    const exporters = ["file"]
    if (statink) {
      exporters.push("stat.ink")
      allowed.net.push("stat.ink")
    }
    switch (source) {
      case "mocks":
      case "local":
        console.debug(`metrics/compute/${login}/plugins > splatoon > skipping s3si execution`)
        break
      case "splatnet":
        await imports.run(`deno run --no-prompt --cached-only --no-remote --allow-read="${allowed.files}" --allow-write="${allowed.files}" --allow-net="${allowed.net}" index.ts --exporter="${exporters}" --with-summary --no-progress`, {cwd: `${imports.__module(import.meta.url)}/s3si`}, {prefixed: false})
        break
    }

    //Read fetched data
    const exported = await Promise.all(
      (await imports.fs.readdir(`${imports.__module(import.meta.url)}/s3si/${source === "mocks" ? "mocks" : "export"}`))
        .map(async file => JSON.parse(await imports.fs.readFile(`${imports.__module(import.meta.url)}/s3si/${source === "mocks" ? "mocks" : "export"}/${file}`))),
    )
    const summary = exported.filter(({type}) => type === "SUMMARY").at(0)
    if (!summary)
      throw new Error("Failed to fetch player summary!")
    const fetched = exported.filter(({type}) => type !== "SUMMARY").sort((a, b) => new Date(b.data.detail.playedTime) - new Date(a.data.detail.playedTime))
    console.debug(`metrics/compute/${login}/plugins > splatoon > fetched ${fetched.length} matches`)

    //Player summary
    const player = {
      level: summary.data.HistoryRecordQuery.playHistory.rank,
      rank: {
        current: summary.data.HistoryRecordQuery.playHistory.udemae,
        max: summary.data.HistoryRecordQuery.playHistory.udemaeMax,
      },
      painted: summary.data.HistoryRecordQuery.playHistory.paintPointTotal,
      battles: {
        wins: summary.data.HistoryRecordQuery.playHistory.winCountTotal,
        count: summary.data.ConfigureAnalyticsQuery.playHistory.battleNumTotal,
      },
      started: new Date(summary.data.HistoryRecordQuery.playHistory.gameStartTime),
      name: summary.data.HistoryRecordQuery.currentPlayer.name,
      byname: summary.data.HistoryRecordQuery.currentPlayer.byname,
      badges: await Promise.all(summary.data.HistoryRecordQuery.currentPlayer.nameplate.badges.map(badge => badge ? imports.imgb64(badge.image.url) : null)),
      plate: {
        color: `#${Math.round(255 * summary.data.HistoryRecordQuery.currentPlayer.nameplate.background.textColor.r).toString(16).padStart(2, 0)}${Math.round(255 * summary.data.HistoryRecordQuery.currentPlayer.nameplate.background.textColor.g).toString(16).padStart(2, 0)}${
          Math.round(255 * summary.data.HistoryRecordQuery.currentPlayer.nameplate.background.textColor.b).toString(16).padStart(2, 0)
        }`,
        icon: await imports.imgb64(summary.data.HistoryRecordQuery.currentPlayer.nameplate.background.image.url),
      },
      equipment: {
        weapon: {
          name: summary.data.HistoryRecordQuery.currentPlayer.weapon.name,
          icon: await imports.imgb64(summary.data.HistoryRecordQuery.currentPlayer.weapon.image.url),
        },
        special: {
          name: summary.data.HistoryRecordQuery.currentPlayer.weapon.specialWeapon.name,
          icon: await imports.imgb64(summary.data.HistoryRecordQuery.currentPlayer.weapon.specialWeapon.image.url),
        },
        sub: {
          name: summary.data.HistoryRecordQuery.currentPlayer.weapon.subWeapon.name,
          icon: await imports.imgb64(summary.data.HistoryRecordQuery.currentPlayer.weapon.subWeapon.image.url),
        },
        gears: await Promise.all(["headGear", "clothingGear", "shoesGear"].map(async type => {
          const gear = summary.data.HistoryRecordQuery.currentPlayer[type]
          return {
            name: gear.name,
            icon: await imports.imgb64(gear.image.url),
            abilities: await Promise.all([
              {
                name: gear.primaryGearPower.name,
                icon: await imports.imgb64(gear.primaryGearPower.image.url),
              },
              ...gear.additionalGearPowers.map(async ability => ({name: ability.name, icon: await imports.imgb64(ability.image.url)})),
            ]),
          }
        })),
      },
      salmon: {
        grade: {
          name: summary.data.CoopHistoryQuery.coopResult.regularGrade.name,
          points: summary.data.CoopHistoryQuery.coopResult.regularGradePoint,
        },
        played: summary.data.CoopHistoryQuery.coopResult.pointCard.playCount,
        rescues: summary.data.CoopHistoryQuery.coopResult.pointCard.rescueCount,
        eggs: {
          golden: summary.data.CoopHistoryQuery.coopResult.pointCard.goldenDeliverCount,
          regular: summary.data.CoopHistoryQuery.coopResult.pointCard.deliverCount,
        },
        points: summary.data.CoopHistoryQuery.coopResult.pointCard.totalPoint,
        kings: summary.data.CoopHistoryQuery.coopResult.pointCard.defeatBossCount,
      },
    }

    //Versus mode
    let vs = null
    if (sections.includes("versus")) {
      vs = {
        matches: await Promise.all(
          fetched.filter(({type}) => type === "VS").slice(0, _versus_limit).map(async ({data}) => ({
            mode: {
              name: data.detail.vsRule.name,
              icon: await imports.imgb64(assets.modes[data.detail.vsRule.name]),
            },
            result: data.detail.judgement,
            knockout: data.detail.knockout ?? null,
            teams: await Promise.all([data.detail.myTeam, ...data.detail.otherTeams].map(async team => ({
              color: `#${Math.round(255 * team.color.r).toString(16).padStart(2, 0)}${Math.round(255 * team.color.g).toString(16).padStart(2, 0)}${Math.round(255 * team.color.b).toString(16).padStart(2, 0)}`,
              score: ((data.detail.vsRule.name === "Turf War") ? team.result?.paintRatio * 100 : team.result?.score) ?? null,
              players: await Promise.all(team.players.map(async ({name, byname, weapon, paint, result, isMyself: self}) => ({
                name,
                byname,
                self,
                weapon: {
                  name: weapon.name,
                  icon: await imports.imgb64(assets.weapons[weapon.name]),
                },
                special: {
                  name: weapon.specialWeapon.name,
                  icon: await imports.imgb64(assets.specials[weapon.specialWeapon.name]),
                },
                sub: {
                  name: weapon.subWeapon.name,
                  icon: await imports.imgb64(assets.subweapons[weapon.subWeapon.name]),
                },
                result: {
                  paint: paint ?? 0,
                  kill: result?.kill ?? 0,
                  death: result?.death ?? 0,
                  assist: result?.assist ?? 0,
                  special: result?.special ?? 0,
                },
              }))),
            }))),
            awards: data.detail.awards,
            date: data.detail.playedTime,
            duration: data.detail.duration,
            rank: data.listNode?.udemae ?? null,
            stage: {
              name: data.detail.vsStage.name,
              icon: await imports.imgb64(assets.stages[data.detail.vsStage.name]),
            },
          })),
        ),
      }
    }

    //Salmon run
    let salmon = null
    if (sections.includes("salmon-run")) {
      salmon = {
        matches: await Promise.all(
          fetched.filter(({type}) => type === "COOP").slice(0, _salmon_limit).map(async ({data}) => ({
            weapons: await Promise.all(data.detail.myResult.weapons.map(async ({name}) => ({name, icon: await imports.imgb64(assets.weapons[name])}))),
            special: {
              name: data.detail.myResult.specialWeapon.name,
              icon: await imports.imgb64(assets.specials[data.detail.myResult.specialWeapon.name]),
            },
            eggs: {
              golden: data.detail.myResult.goldenDeliverCount,
              regular: data.detail.myResult.deliverCount,
            },
            defeated: await Promise.all(data.detail.enemyResults.map(async ({defeatCount: count, enemy: {name}}) => ({name, count, icon: await imports.imgb64(assets.salmon[name])}))),
            rescues: data.detail.myResult.rescueCount,
            rescued: data.detail.myResult.rescuedCount,
            waves: data.detail.waveResults.map(({deliverNorm: quota, teamDeliverCount: delivered}) => ({quota, delivered})),
            failed: data.detail.resultWave,
            hazard: Math.round(data.detail.dangerRate * 100),
            boss: data.detail.bossResult
              ? {
                defeated: data.detail.bossResult.hasDefeatBoss,
                name: data.detail.bossResult.boss.name,
                icon: await imports.imgb64(assets.salmon[data.detail.bossResult.boss.name]),
              }
              : null,
            stage: {
              name: data.detail.coopStage.name,
              icon: await imports.imgb64(assets.stages[data.detail.coopStage.name]),
            },
            date: data.detail.playedTime,
            grade: data.detail.afterGrade?.name ?? "",
          })),
        ),
      }
    }

    //Results
    return {
      sections,
      player,
      vs,
      salmon,
      icons: Object.fromEntries(await Promise.all(Object.entries(assets.icons).map(async ([k, v]) => [k, await imports.imgb64(v)]))),
    }
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/community/README.md">
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üé≤ Community plugins</h3></th></tr>
  <tr><td colspan="2" align="center">Additional plugins maintained by community for even more features!</td></tr>
  <tr>
    <th><a href="/source/plugins/community/16personalities/README.md">üß† 16personalities</a><br><sup>by <a href="https://github.com/lowlighter">@lowlighter</a></sup></th>
    <th><a href="/source/plugins/community/chess/README.md">‚ôüÔ∏è Chess</a><br><sup>by <a href="https://github.com/lowlighter">@lowlighter</a></sup></th>
  </tr>
  <tr>
    <td  align="center">
      <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.16personalities.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
    <td  align="center">
      <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.chess.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>  <tr>
    <th><a href="/source/plugins/community/crypto/README.md">ü™ô Crypto</a><br><sup>by <a href="https://github.com/dajneem23">@dajneem23</a></sup></th>
    <th><a href="/source/plugins/community/fortune/README.md">ü•† Fortune</a><br><sup>by <a href="https://github.com/lowlighter">@lowlighter</a></sup></th>
  </tr>
  <tr>
    <td  align="center">
      <img alt="" width="400" src="https://via.placeholder.com/468x60?text=No%20preview%20available" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
    <td  align="center">
      <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.fortune.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>  <tr>
    <th><a href="/source/plugins/community/nightscout/README.md">üíâ Nightscout</a><br><sup>by <a href="https://github.com/legoandmars">@legoandmars</a></sup></th>
    <th><a href="/source/plugins/community/poopmap/README.md">üí© PoopMap plugin</a><br><sup>by <a href="https://github.com/matievisthekat">@matievisthekat</a></sup></th>
  </tr>
  <tr>
    <td  align="center">
      <img alt="" width="400" src="https://github.com/legoandmars/legoandmars/blob/master/metrics.plugin.nightscout.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
    <td  align="center">
      <img alt="" width="400" src="https://github.com/matievisthekat/matievisthekat/blob/master/metrics.plugin.poopmap.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>  <tr>
    <th><a href="/source/plugins/community/screenshot/README.md">üì∏ Website screenshot</a><br><sup>by <a href="https://github.com/lowlighter">@lowlighter</a></sup></th>
    <th><a href="/source/plugins/community/splatoon/README.md">ü¶ë Splatoon</a><br><sup>by <a href="https://github.com/lowlighter">@lowlighter</a></sup></th>
  </tr>
  <tr>
    <td  align="center">
      <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.screenshot.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
    <td  align="center">
      <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.splatoon.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>  <tr>
    <th><a href="/source/plugins/community/stock/README.md">üíπ Stock prices</a><br><sup>by <a href="https://github.com/lowlighter">@lowlighter</a></sup></th>
    <th></th>
  </tr>
  <tr>
    <td  align="center">
      <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stock.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
<td align="center"><img width="900" height="1" alt=""></td>
  </tr>
</table>

## üì™ Creating community plugins

Plugins creation requires you to be comfortable with JavaScript, HTML, CSS and [EJS](https://github.com/mde/ejs).

### üí¨ Before creating a new plugin

Be sure to read [contribution guide](/CONTRIBUTING.md) and [architecture](/ARCHITECTURE.md) first.

> ‚ÑπÔ∏è *metrics* maintainers have no obligation towards community plugins support and may redirect any help, feature or fix requests from other users to you. Of course you are not bound to work on it, but it would be great if you plan to merge a plugin in the main repository

Please respect the following guidelines:

- A plugin should be independent and should not rely on other plugins
  - [üß± core](/source/plugins/core/README.md) and [üóÉÔ∏è base](/source/plugins/base/README.md) output can be reused though
- A plugin should never edit its original arguments, as it is shared amongst other plugins and would create unattended side effects
- Use `imports.metadata.plugins.{plugin-name}.inputs()` to automatically type check and default user inputs through defined `metadata.yml`
- Plugin options should respect the "lexical field" of existing option to keep consistency
- Plugin errors should be handled gracefully by partials with error message
- New dependencies should be avoided, consider using existing `imports`
- Spawning sub-process should be avoided, unless absolute necessity
  - Use `imports.which()` to detect whether a command is available
  - Use `imports.run()` to run a command
    - Pass `{prefixed: true}` to wrap automatically command with [WSL](https://docs.microsoft.com/windows/wsl/about) on Windows
  - It is required to work on Linux Ubuntu (as the GitHub action run on it)

> üí° While the following guide intend to explain the creation process of new plugin, it may also be a good idea to see what existing plugins looks like and see if you want to embark on the adventure!

### üí¨ Quick-start

To create a new plugin, clone and setup this repository first:
```shell
git clone https://github.com/lowlighter/metrics.git
cd metrics/
npm install
```

Find a cool name and an [unused emoji](https://emojipedia.org) for your new plugin and run the following:
```shell
npm run quickstart plugin <plugin_name>
```

> ‚ö†Ô∏è Community plugins cannot have the same name as official plugins. *metrics* maintainers may also reserve a plugin name for future usage and may ask you to rename it in case of conflicts

It will create a new directory in `/source/plugins/community` with the following file structure:
* `/source/plugins/community/{plugin-name}`
  * `README.md`
  * `metadata.yml`
  * `examples.mjs`
  * `index.mjs`

Plugins are auto-loaded based on their folder existence, so there's no need to register them somewhere.

### üí¨ Filling `metadata.yml`

`metadata.yml` is a required file which describes supported account types, output formats, scopes, etc.

The default file looks like below:
```yaml
name: "üß© Plugin name"
category: community
description: Short description
examples:
  default: https://via.placeholder.com/468x60?text=No%20preview%20available
authors:
  - octocat
supports:
  - user
  - organization
  - repository
scopes: []
inputs:

  plugin_{name}:
    description: Enable {name} plugin
    type: boolean
    default: no
```

> üí° It is important to correctly define `metadata.yml` because *metrics* will use its content for various usage

[`üß± core`](/source/plugins/core/README.md) plugin (which is always called) will automatically verify user inputs against `supports` and `inputs` values and throw an error in case of incompatibility.

`name`, `description`, `scopes`, `examples` are used to auto-generate documentation in the `README.md`. For community plugins, `examples` should be set with auto-generated examples of your own profile.

`authors` should contain your GitHub username

`category` should be set to `community`.

Because of GitHub Actions original limitations, only strings, numbers and boolean were actually supported by `action.yml`. *metrics* implemented its own `inputs` validator to circumvent this. It should be pretty simple to use.

*Example: boolean type, defaults to `false`*
```yml
  plugin_{name}_{option}:
    description: Boolean type
    type: boolean
    default: no
```

```yml
  plugin_{name}_{option}:
    description: String type
    type: string
    default: .user.login
```

> üí° `.user.login`, `.user.twitter` and `.user.website` are special default values that will be respectively replaced by user's login, Twitter username and attached website. Note that these are not available if `token: NOT_NEEDED` is set by user

*Example: string type, defaults to `foo` with `foo` or `bar` as allowed values*
```yml
  plugin_{name}_{option}:
    description: Select type
    type: string
    values:
      - foo
      - bar
    default: foo
```

> üí° `values` restricts what can be passed by user

*Example: number type, defaults to `1` and expected to be between `0` and `100`*
```yml
  plugin_{name}_{option}:
    description: Number type
    type: number
    default: 1
    min: 0
    max: 100
```

> üí° `min` and `max` restricts what can be passed by user. Omit these to respectively remove lower and upper limits.

> üí° Zero may have a special behaviour (usually to disable limitations), if that's the case add a `zero` attribute (e.g. `zero: disable`) to reference this in documentation

*Example: array type, with comma-separated elements*
```yml
  plugin_{name}_{option}:
    description: Array type
    type: array
    format: comma-separated
    values:
      - foo
      - bar
    default: foo, bar
```

> üí° An array can be either `comma-separated` or `space-separated`, and will split user input by mentioned separator. Each value is trimmed and lowercased.

*Example: json type*
```yml
  plugin_{name}_{option}:
    description: JSON type
    type: json
    default: |
      {
        "foo": "bar"
      }
```

> üí° JSON types should be avoided when possible, as they're usually kind of unpractical to write within a YAML document

For complex inputs, pass an `example` that will be displayed as a placeholder on web instances.

When calling `imports.metadata.plugins.{plugin-name}.inputs({data, account, q})`, an object with verified user inputs and correct typing will be returned.

Any invalid input will use have the `default` value instead.

> ‚ö†Ô∏è Returned object will use the web syntax for options rather than the action one. It means that `plugin_` prefix is dropped, and all underscores (`_`) are replaced by dots (`.`)

*Example: validating user inputs*
```javascript
let {limit, "limit.field":limit_field} = imports.metadata.plugins.myplugin.inputs({data, account, q})
console.assert(limit === true)
```

### üí¨ Filling `index.mjs`

Plugins use [JavaScript modules](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules).

The default exported module of `index.mjs` will be auto-loaded when *metrics* start.

Below is a breakdown of basic `index.mjs` content
```js
export default async function(
  //Shared inputs
  {
    login, //GitHub username
    q, //Raw user inputs (dot notation without plugin_ prefix, don't use it directly)
    imports, //Various utilities (axios, puppeteer, fs, etc., see /source/app/metrics/utils.mjs)
    data, //Raw data from core/base plugin
    computed, //Computed data from core/base plugin
    rest, //Rest authenticated GitHub octokit
    graphql, //Graph QL authenticated GitHub octokit
    queries, //Autoloaded queries from ./queries
    account, //Account type ("user" or "organization")
  },
  //Settings and tokens
  {
    enabled = false,
    extras = false,
  } = {}) {
    //Plugin execution
    try {
      //Check if plugin is enabled and requirements are met
      if ((!q.my_plugin)||(imports.metadata.plugins.my_plugin.enabled(enabled, {extras})))
        return null

      //Automatically validate user inputs
      //An error will be thrown if `account` type is not supported
      //Inputs will have correct typing from `metadata.yml` and unset or invalid options will be set to default
      let {option} = imports.metadata.plugins.my_plugin.inputs({data, account, q})

      //Automatically template query from /source/plugins/myplugin/queries/myquery.graph ql
      const {[account]:stuff} = await graphql(queries.myplugin.myquery({login, account, option}))

      //Results
      return {stuff}
    }
    //Handle errors
    catch (error) {
      throw imports.format.error(error)
    }
}
```

> ‚ö†Ô∏è Remember, a plugin should never edit its original arguments, as it is shared amongst other plugins and would create unattended side effects

### üí¨ Creating partials

Just create a new `.ejs` file in `partials` folder from templates you wish to support, and reference it into their `partials/_.json`.

Plugin partials should be able to handle gracefully their own state and errors.

Below is a minimal snippet of a partial:
```ejs
<% if (plugins.{plugin_name}) { %>
  <% if (plugins.{plugin_name}.error) { %>
    <%= plugins.{plugin_name}.error.message %>
  <% } else { %>
    <%# content %>
  <% } %>
<% } %>
```

Partials should have the match the same name as plugin handles, as they're used to display plugin compatibility in auto-generated header.

[EJS](https://github.com/mde/ejs) framework is used to template content through templating tags (``).

### üí¨ Filling `README.md`

`README.md` is used as documentation.

Most of it will is auto-generated by `metadata.yml` and `examples.yml` content, so usually it is not required to manually edit it.

The default content looks like below:
```markdown
<«É--header-->
<«É--/header-->

## ‚û°Ô∏è Available options

<«É--options-->
<«É--/options-->

## ‚ÑπÔ∏è Examples workflows

<«É--examples-->
<«É--/examples-->
```

- `<«É--header-->` will be replaced by an auto-generated header containing plugin name, supported features and output examples based on `metadata.yml`
- `<«É--options-->` will be replaced by an auto-generated table containing all referenced option from `metadata.yml`
- `<«É--examples-->` will be replaced by workflows from `examples.yml`

> ‚ö†Ô∏è Do not replace these auto-generated placeholder yet! They will be built by the ci workflow and will help making your pull request easier to read

When a plugin requires a token, please add a `## üóùÔ∏è Obtaining a {service} token` section after the available options section.

Complex features may also be documented in additional sections after available options section options if required.

Try to respect current format of `README.md` from other plugins and use a neutral and impersonal writing style if possible.

### üí¨ Filling `examples.yml`

Workflow examples from `examples.yml` are used as unit testing and to auto-generate documentation in the `README.md`.

It uses the same syntax as GitHub action and looks like below:
```yml
- name: Test name
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.{name}.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_{name}: yes
  prod:
    skip: true
  test:
    timeout: 1800000
    modes:
      - action
      - web
      - placeholder
```

> üí° Tests are executed in a mocked environment to avoid causing charges on external services. It may be required to create mock testing files.

`test` is usually not needed and optional but can be set to set a custom timeout (for plugins with a high execution time) and `modes` can be used to restrict which environment should be used.

`prod` should keep `skip: true` as you should use your own render outputs as examples.

### üí¨ Testing locally and creating mocked data

The easiest way to test a new plugin is to setup a web instance locally ([see documentation](.github/readme/partials/documentation/setup/local.md)).

Once server is started, open a browser and try to generate an output with your new plugin enabled and check if it works as expected:
```
http://localhost:3000/username?base=0&my-plugin=1
```

> üí° You may need to configure your server first by editing `settings.json`. Ensure that:
> - `token` is correctly set when working with GitHub APIs
> - `plugins.default` is set to `true` as plugins are disabled by default
>   - or enable your plugins by manually in `plugins`.`my-plugin`.`enabled`
> -  `debug` is set to `true` for more verbose output

When your plugin is finalized, you may need to create mocked data if it either uses GitHub APIs or any external service.

They must be created in `tests/mocks/api`:
- use `github` directory for all related GitHub APIs data
- use `axios` directory for all external service that you call using `imports.axios`

> üí° Files from these directories are auto-loaded, so it is just required to create them with faked data.

Finally [/source/app/web/statics/app.placeholder.js](/source/app/web/statics/app.placeholder.js) to add mocked placeholder data to make users using the shared instance able to preview a render locally without any server computation.

### üí¨ Submitting a pull request

If you made it until there, congratulations ü•≥!

You're almost done, review the following checklist before submitting a pull request:
- [x] I have correctly filled `metadata.yml`
  - [x] `name` is set with an unused emoji and plugin name
  - [x] `category` is set to `community`
  - [x] `examples` contains links towards a rendered output hosted by you
  - [x] `authors` contains my GitHub username
  - [x] `supports` list which account type are supported
  - [x] `scopes` are correctly listed with their associated names on GitHub (leave an empty array if not applicable)
  - [x] `inputs` are correctly filled
- [x] I have implemented my plugin
  - [x] `index.mjs` respects the plugins guidelines
- [x] I have tested my plugin locally
  - [x] `tests/mocks` ... have been created
  - [x] `app.placeholder.js` has been updated for preview from web instances
  - [x] `examples.yml` contains workflows examples (at least one is required)
    - [x] `skip: true` has been set for `prod` attribute in each test
  - [x] `npm run linter` yields no errors
- [x] I have documented my plugin
  - [x] `README.md` eventually describes complex setup or options (if applicable)
- [x] I am ready!
  - [x] Checkout any generated files (in fact, don't run `npm run build`)
  - [x] Commit and push your changes (commits are squashed, no need to rebase)
  - [x] Open a new [pull request](https://github.com/lowlighter/metrics/pulls)
  - [x] Post a screenshot or a render in the pull request so it can be previewed

> üí° A pull request **will need** to have passing builds and an example screenshot if you want to get it merged.
> Maintainers may request changes in some cases

> üéä Thanks a lot for your contribution!
</file>

<file path="source/plugins/core/index.mjs">
/**
 * Core plugin is a special plugin because of historical reasons.
 * It is used by templates to setup global configuration.
 */

//Setup
export default async function({login, q}, {conf, data, rest, graphql, plugins, queries, account, convert, template, callbacks}, {pending, imports}) {
  //Load inputs
  const {"config.animations": animations, "config.display": display, "config.timezone": _timezone, "config.base64": _base64, "debug.flags": dflags} = imports.metadata.plugins.core.inputs({data, account, q})
  imports.metadata.templates[template].check({q, account, format: convert})

  //Base64 images
  if (!_base64) {
    console.debug(`metrics/compute/${login} > base64 for images has been disabled`)
    imports.imgb64 = url => url
  }

  //Init
  const computed = {
    commits: 0,
    sponsorships: 0,
    licenses: {favorite: "", used: {}, about: {}},
    token: {},
    repositories: {watchers: 0, stargazers: 0, issues_open: 0, issues_closed: 0, pr_open: 0, pr_closed: 0, pr_merged: 0, forks: 0, forked: 0, releases: 0, deployments: 0, environments: 0},
  }
  const avatar = imports.imgb64(data.user.avatarUrl)
  data.computed = computed
  console.debug(`metrics/compute/${login} > formatting common metrics`)

  //Timezone config
  const offset = Number(new Date().toLocaleString("fr", {timeZoneName: "short"}).match(/UTC[+](?<offset>\d+)/)?.groups?.offset * 60 * 60 * 1000) || 0
  if (_timezone) {
    const timezone = {name: _timezone, offset: 0}
    data.config.timezone = timezone
    try {
      timezone.offset = offset - (Number(new Date().toLocaleString("fr", {timeZoneName: "short", timeZone: timezone.name}).match(/UTC[+](?<offset>\d+)/)?.groups?.offset * 60 * 60 * 1000) || 0)
      console.debug(`metrics/compute/${login} > timezone set to ${timezone.name} (${timezone.offset > 0 ? "+" : ""}${Math.round(timezone.offset / (60 * 60 * 1000))} hours)`)
    }
    catch {
      timezone.error = `Failed to use timezone "${timezone.name}"`
      console.debug(`metrics/compute/${login} > failed to use timezone "${timezone.name}"`)
    }
  }
  else if (process?.env?.TZ) {
    data.config.timezone = {name: process.env.TZ, offset}
  }

  //Display
  data.large = display === "large"
  data.columns = display === "columns"

  //Animations
  data.animated = animations
  console.debug(`metrics/compute/${login} > animations ${data.animated ? "enabled" : "disabled"}`)

  //Extras features
  const extras = conf.settings?.extras?.features ?? conf.settings?.extras?.default ?? false
  console.debug(`metrics/compute/${login} > extras > ${JSON.stringify(extras)}`)

  //Plugins
  for (const name of Object.keys(imports.plugins)) {
    if (!q[name])
      continue
    pending.push((async () => {
      try {
        console.debug(`metrics/compute/${login}/plugins > ${name} > started`)
        data.plugins[name] = await imports.plugins[name]({login, q, imports, data, computed, rest, graphql, queries, account}, {extras, sandbox: conf.settings?.sandbox ?? false, ...plugins[name]})
        console.debug(`metrics/compute/${login}/plugins > ${name} > completed`)
      }
      catch (error) {
        console.debug(`metrics/compute/${login}/plugins > ${name} > completed (error)`)
        data.plugins[name] = error
      }
      finally {
        const result = {name, result: data.plugins[name]}
        console.debug(imports.util.inspect(result, {depth: Infinity, maxStringLength: 256, getters: true}))
        await callbacks?.plugin?.(login, name, !data.plugins[name].error, data.plugins[name]).catch(error => console.debug(`metrics/compute/${login}/plugins/callbacks > ${name} > ${error}`))
        return result
      }
    })())
  }

  //Iterate through user's repositories
  for (const repository of data.user.repositories.nodes) {
    //Simple properties with totalCount
    for (const property of ["watchers", "stargazers", "issues_open", "issues_closed", "pr_open", "pr_closed", "pr_merged", "releases", "deployments", "environments"])
      computed.repositories[property] += repository[property]?.totalCount ?? 0
    //Forks
    computed.repositories.forks += repository.forkCount
    if (repository.isFork)
      computed.repositories.forked++
    //License
    if (repository.licenseInfo) {
      computed.licenses.used[repository.licenseInfo.spdxId] = (computed.licenses.used[repository.licenseInfo.spdxId] ?? 0) + 1
      computed.licenses.about[repository.licenseInfo.spdxId] = repository.licenseInfo
    }
  }

  //Total disk usage
  computed.diskUsage = `${imports.format.bytes(data.user.repositories.totalDiskUsage * 1000)}`

  //Compute licenses stats
  computed.licenses.favorite = Object.entries(computed.licenses.used).sort(([_an, a], [_bn, b]) => b - a).slice(0, 1).map(([name, _value]) => name) ?? ""

  //Compute total commits
  computed.commits += data.user.contributionsCollection.totalCommitContributions + data.user.contributionsCollection.restrictedContributionsCount

  //Compute registration date
  const now = Date.now()
  const created = new Date(data.user.createdAt)
  const diff = new Date(now - created)
  const years = diff.getUTCFullYear() - new Date(0).getUTCFullYear()
  const months = diff.getUTCMonth() - new Date(0).getUTCMonth()
  const days = diff.getUTCDate() - new Date(0).getUTCDate()

  computed.registered = {years: years + days / 365.25, months}
  computed.registration = years ? `${years} year${imports.s(years)} ago` : months ? `${months} month${imports.s(months)} ago` : `${days} day${imports.s(days)} ago`
  computed.cakeday = (years >= 1 && months === 0 && days === 0) ? true : false

  //Compute calendar
  computed.calendar = data.user.calendar.contributionCalendar.weeks.flatMap(({contributionDays}) => contributionDays).slice(-14)

  //Avatar (base64)
  computed.avatar = await avatar || "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg=="

  //Token scopes
  try {
    computed.token.scopes = conf.settings.notoken ? [] : (await rest.request("HEAD /")).headers["x-oauth-scopes"]?.split(", ") ?? []
  }
  catch (error) {
    console.debug(error)
    computed.token.scopes = []
  }

  //Meta
  data.meta = {
    version: conf.package.version,
    author: conf.package.author,
    generated: imports.format.date(new Date(), {date: true, time: true}),
  }

  //Debug flags
  if (dflags.includes("--cakeday")) {
    console.debug(`metrics/compute/${login} > applying dflag --cakeday`)
    computed.cakeday = true
  }
  if ((dflags.includes("--halloween")) || (dflags.includes("--winter"))) {
    const color = dflags.find(color => ["--halloween", "--winter"].includes(color)).replace("--", "")
    console.debug(`metrics/compute/${login} > applying dflag --halloween`)
    //Color replacer
    const replace = content =>
      content
        .replace(/--color-calendar-graph/g, `--color-calendar-${color}-graph`)
        .replace(/#9be9a8/gi, `var(--color-calendar-${color}-graph-day-L1-bg)`)
        .replace(/#40c463/gi, `var(--color-calendar-${color}-graph-day-L2-bg)`)
        .replace(/#30a14e/gi, `var(--color-calendar-${color}-graph-day-L3-bg)`)
        .replace(/#216e39/gi, `var(--color-calendar-${color}-graph-day-L4-bg)`)
    //Update contribution calendar colors
    computed.calendar.map(day => day.color = replace(day.color))
    //Update calendars colors
    const waiting = [...pending]
    pending.push((async () => {
      await Promise.all(waiting)
      if (data.plugins.isocalendar?.svg)
        data.plugins.isocalendar.svg = replace(data.plugins.isocalendar.svg)
      if (data.plugins.calendar?.years) {
        for (const {weeks} of data.plugins.calendar.years) {
          for (const {contributionDays} of weeks)
            contributionDays.forEach(day => day.color = replace(day.color))
        }
      }
      return {name: `dflag.${color}`, result: true}
    })())
  }
  if (dflags.includes("--error")) {
    console.debug(`metrics/compute/${login} > applying dflag --error`)
    throw new Error("Failed as requested by --error flag")
  }

  //Results
  return null
}
</file>

<file path="source/plugins/languages/analyzer/analyzer.mjs">
//Imports
import fs from "fs/promises"
import os from "os"
import paths from "path"
import git from "simple-git"
import { filters } from "../../../app/metrics/utils.mjs"
import core from "@actions/core"

/**Analyzer */
export class Analyzer {
  /**Constructor */
  constructor(login, {account = "bypass", authoring = [], uid = Math.random(), shell, rest = null, context = {mode: "user"}, skipped = [], categories = ["programming", "markup"], timeout = {global: NaN, repositories: NaN}}) {
    //User informations
    this.login = login
    this.account = account
    this.authoring = authoring
    this.uid = uid
    this.gpg = []

    //Utilities
    this.shell = shell
    this.rest = rest
    this.context = context
    this.markers = {
      hash: /\b[0-9a-f]{40}\b/,
      file: /^[+]{3}\sb[/](?<file>[\s\S]+)$/,
      line: /^(?<op>[-+])\s*(?<content>[\s\S]+)$/,
    }
    this.parser = /^(?<login>[\s\S]+?)\/(?<name>[\s\S]+?)(?:@(?<branch>[\s\S]+?)(?::(?<ref>[\s\S]+))?)?$/
    this.consumed = false

    //Options
    this.skipped = skipped
    this.categories = categories
    this.timeout = timeout

    //Results
    this.results = {partial: {global: false, repositories: false}, total: 0, lines: {}, stats: {}, colors: {}, commits: 0, files: 0, missed: {lines: 0, bytes: 0, commits: 0}, elapsed: 0}
    this.debug(`instantiated a new ${this.constructor.name}`)
  }

  /**Run analyzer */
  async run(runner) {
    if (this.consumed)
      throw new Error("This analyzer has already been consumed, another instance needs to be created to perform a new analysis")
    this.consumed = true
    const results = await new Promise(async solve => {
      let completed = false
      if (Number.isFinite(this.timeout.global)) {
        this.debug(`timeout set to ${this.timeout.global}m`)
        setTimeout(() => {
          if (!completed) {
            try {
              this.debug(`reached maximum execution time of ${this.timeout.global}m for analysis`)
              this.results.partial.global = true
              solve(this.results)
            }
            catch {
              //Ignore errors
            }
          }
        }, this.timeout.global * 60 * 1000)
      }
      await runner()
      completed = true
      solve(this.results)
    })
    return results
  }

  /**Parse repository */
  parse(repository) {
    let branch = null, ref = null
    if (typeof repository === "string") {
      if (!this.parser.test(repository))
        throw new TypeError(`"${repository}" pattern is not supported`)
      const {login, name, ...groups} = repository.match(this.parser)?.groups ?? {}
      repository = {owner: {login}, name}
      branch = groups.branch ?? null
      ref = groups.ref ?? null
    }
    const repo = `${repository.owner.login}/${repository.name}`
    const path = paths.join(os.tmpdir(), `${this.uid}-${repo.replace(/[^\w]/g, "_")}`)
    return {repo, path, branch, ref}
  }

  /**Clone a repository */
  async clone(repository) {
    const {repo, branch, path} = this.parse(repository)
    let token

    if (process.env.GITHUB_ACTIONS) {
      token = core.getInput("token")
    }

    let url = /^https?:\/\//.test(repo) ? repo : `https://${token}@github.com/${repo}`
    try {
      this.debug(`cloning https://github.com/${repo} to ${path}`)
      await fs.rm(path, {recursive: true, force: true})
      await fs.mkdir(path, {recursive: true})
      await git(path).clone(url, ".", ["--single-branch"]).status()
      this.debug(`cloned https://github.com/${repo} to ${path}`)
      if (branch) {
        this.debug(`switching to branch ${branch} for ${repo}`)
        await git(path).branch(branch)
      }
      return true
    }
    catch (error) {
      this.debug(`failed to clone https://github.com/${repo} (${error})`)
      this.clean(path)
      return false
    }
  }

  /**Analyze a repository */
  async analyze(path, {commits = []} = {}) {
    const cache = {files: {}, languages: {}}
    const start = Date.now()
    let elapsed = 0, processed = 0
    if (this.timeout.repositories)
      this.debug(`timeout for repository analysis set to ${this.timeout.repositories}m`)
    for (const commit of commits) {
      elapsed = (Date.now() - start) / 1000 / 60
      if ((this.timeout.repositories) && (elapsed > this.timeout.repositories)) {
        this.results.partial.repositories = true
        this.debug(`reached maximum execution time of ${this.timeout.repositories}m for repository analysis (${elapsed}m elapsed)`)
        break
      }
      try {
        const {total, files, missed, lines, stats} = await this.linguist(path, {commit, cache})
        this.results.commits++
        this.results.total += total
        this.results.files += files
        this.results.missed.lines += missed.lines
        this.results.missed.bytes += missed.bytes
        for (const language in lines) {
          if (this.categories.includes(cache.languages[language]?.type))
            this.results.lines[language] = (this.results.lines[language] ?? 0) + lines[language]
        }
        for (const language in stats) {
          if (this.categories.includes(cache.languages[language]?.type))
            this.results.stats[language] = (this.results.stats[language] ?? 0) + stats[language]
        }
      }
      catch (error) {
        this.debug(`skipping commit ${commit.sha} (${error})`)
        this.results.missed.commits++
      }
      finally {
        this.results.elapsed += elapsed
        processed++
        if ((processed % 50 === 0) || (processed === commits.length))
          this.debug(`at commit ${processed}/${commits.length} (${(100 * processed / commits.length).toFixed(2)}%, ${elapsed.toFixed(2)}m elapsed)`)
      }
    }
    this.results.colors = Object.fromEntries(Object.entries(cache.languages).map(([lang, {color}]) => [lang, color]))
  }

  /**Clean a path */
  async clean(path) {
    try {
      this.debug(`cleaning ${path}`)
      await fs.rm(path, {recursive: true, force: true})
      this.debug(`cleaned ${path}`)
      return true
    }
    catch (error) {
      this.debug(`failed to clean (${error})`)
      return false
    }
  }

  /**Whether to skip a repository or not */
  ignore(repository) {
    const ignored = !filters.repo(repository, this.skipped)
    if (ignored)
      this.debug(`skipping ${typeof repository === "string" ? repository : `${repository?.owner?.login}/${repository?.name}`} as it matches skipped repositories`)
    return ignored
  }

  /**Debug log */
  debug(message) {
    return console.debug(`metrics/compute/${this.login}/plugins > languages > ${this.constructor.name.replace(/([a-z])([A-Z])/, (_, a, b) => `${a} ${b.toLocaleLowerCase()}`).toLocaleLowerCase()} > ${message}`)
  }
}
</file>

<file path="source/plugins/languages/index.mjs">
//Imports
import { indepth as indepth_analyzer, recent as recent_analyzer } from "./analyzers.mjs"

//Setup
export default async function({login, data, imports, q, rest, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.languages) || (!imports.metadata.plugins.languages.enabled(enabled, {extras})))
      return null

    //Context
    let context = {mode: "user"}
    if (q.repo) {
      console.debug(`metrics/compute/${login}/plugins > languages > switched to repository mode`)
      const {owner, repo} = data.user.repositories.nodes.map(({name: repo, owner: {login: owner}}) => ({repo, owner})).shift()
      context = {...context, mode: "repository", owner, repo}
    }

    //Load inputs
    let {ignored, skipped, other, colors, aliases, details, threshold, limit, indepth, "indepth.custom": _indepth_custom, "analysis.timeout": _timeout_global, "analysis.timeout.repositories": _timeout_repositories, sections, categories, "recent.categories": _recent_categories, "recent.load": _recent_load, "recent.days": _recent_days} = imports.metadata
      .plugins.languages
      .inputs({
        data,
        account,
        q,
      })
    const timeout = {global: _timeout_global, repositories: _timeout_repositories}
    threshold = (Number(threshold.replace(/%$/, "")) || 0) / 100
    skipped.push(...data.shared["repositories.skipped"])
    if (!limit)
      limit = Infinity
    if (!indepth)
      details = details.filter(detail => !["lines"].includes(detail))
    aliases = Object.fromEntries(aliases.split(",").filter(alias => /^[\s\S]+:[\s\S]+$/.test(alias)).map(alias => alias.trim().split(":")).map(([key, value]) => [key.toLocaleLowerCase(), value]))

    //Custom colors
    const colorsets = JSON.parse(`${await imports.fs.readFile(`${imports.__module(import.meta.url)}/colorsets.json`)}`)
    if ((`${colors}` in colorsets) && (limit <= 8))
      colors = colorsets[`${colors}`]
    colors = Object.fromEntries(decodeURIComponent(colors).split(",").map(x => x.trim().toLocaleLowerCase()).filter(x => x).map(x => x.split(":").map(x => x.trim())))
    console.debug(`metrics/compute/${login}/plugins > languages > custom colors ${JSON.stringify(colors)}`)

    //Unique languages
    const repositories = context.mode === "repository" ? data.user.repositories.nodes : [...data.user.repositories.nodes, ...data.user.repositoriesContributedTo.nodes]
    const unique = new Set(repositories.flatMap(repository => repository.languages.edges.map(({node: {name}}) => name))).size

    //Iterate through user's repositories and retrieve languages data
    console.debug(`metrics/compute/${login}/plugins > languages > processing ${data.user.repositories.nodes.length} repositories`)
    const languages = {unique, sections, details, indepth, colors: {}, total: 0, stats: {}, "stats.recent": {}}
    const customColors = {}
    for (const repository of data.user.repositories.nodes) {
      //Skip repository if asked
      if (!imports.filters.repo(repository, skipped))
        continue
      //Process repository languages
      for (const {size, node: {color, name}} of Object.values(repository.languages.edges)) {
        languages.stats[name] = (languages.stats[name] ?? 0) + size
        if (colors[name.toLocaleLowerCase()])
          customColors[name] = colors[name.toLocaleLowerCase()]
        if (!languages.colors[name])
          languages.colors[name] = color
        languages.total += size
      }
    }

    //Recently used languages
    if ((sections.includes("recently-used")) && (imports.metadata.plugins.languages.extras("indepth", {extras}))) {
      try {
        console.debug(`metrics/compute/${login}/plugins > languages > using recent analyzer`)
        languages["stats.recent"] = await recent_analyzer({login, data, imports, rest, context, account}, {skipped, categories: _recent_categories ?? categories, days: _recent_days, load: _recent_load, timeout})
        Object.assign(languages.colors, languages["stats.recent"].colors)
      }
      catch (error) {
        console.debug(`metrics/compute/${login}/plugins > languages > recent analyzer > ${error}`)
      }
    }

    //Indepth mode
    if ((indepth) && (imports.metadata.plugins.languages.extras("indepth", {extras}))) {
      try {
        console.debug(`metrics/compute/${login}/plugins > languages > switching to indepth mode (this may take some time)`)
        const existingColors = languages.colors
        Object.assign(languages, await indepth_analyzer({login, data, imports, rest, context, repositories: repositories.concat(_indepth_custom)}, {skipped, categories, timeout}))
        Object.assign(languages.colors, existingColors)
        console.debug(`metrics/compute/${login}/plugins > languages > indepth analysis processed successfully ${languages.commits} and missed ${languages.missed.commits} commits in ${languages.elapsed.toFixed(2)}m`)
      }
      catch (error) {
        console.debug(`metrics/compute/${login}/plugins > languages > indepth analyzer > ${error}`)
      }
    }

    //Apply aliases and group languages when needed
    for (const stats of [languages.stats, languages.lines, languages["stats.recent"].stats, languages["stats.recent"].lines]) {
      if (!stats)
        continue
      for (const [language, value] of Object.entries(stats)) {
        if (language.toLocaleLowerCase() in aliases) {
          delete stats[language]
          const alias = aliases[language.toLocaleLowerCase()]
          stats[alias] = (stats[alias] ?? 0) + value
          console.debug(`metrics/compute/${login}/plugins > languages > ${language} -> ${alias}: ${stats[alias]} (+${value})`)
        }
      }
    }

    //Compute languages stats
    // ‰øÆÊ≠£: „É´„Éº„ÉóÂÜÖ„ÅÆ„É≠„Ç∏„ÉÉ„ÇØ„Çí„ÄåË°åÊï∞Âü∫Ê∫ñ„Äç„Å´Êõ∏„ÅçÊèõ„Åà
    for (const {section, stats = {}, lines = {}, missed = {bytes: 0, lines: 0}, total = 0} of [{section: "favorites", stats: languages.stats, lines: languages.lines, total: languages.total, missed: languages.missed}, {section: "recent", ...languages["stats.recent"]}]) {
      console.debug(`metrics/compute/${login}/plugins > languages > formatting stats ${section}`)
      
      // 1. ÂÖ®Ë°åÊï∞„ÇíË®àÁÆóÔºà„Éë„Éº„Çª„É≥„ÉÜ„Éº„Ç∏„ÅÆÂàÜÊØçÁî®Ôºâ
      const totalLines = Object.values(lines).reduce((a, b) => a + b, 0) || 1

      languages[section] = Object.entries(stats)
        .filter(([name]) => imports.filters.text(name, ignored))
        .sort(([_an], [_bn]) => (lines[_bn] || 0) - (lines[_an] || 0)) // 2. Ë°åÊï∞„Åß„ÇΩ„Éº„Éà
        .slice(0, limit)
        .map(([name, byteSize]) => ({
            name, 
            value: lines[name] || 0, // 3. „Ç∞„É©„Éï„ÅÆÂÄ§„Çí„ÄåË°åÊï∞„Äç„Å´Â§âÊõ¥
            size: byteSize,          // „Éê„Ç§„ÉàÊï∞„ÅØË°®Á§∫Áî®„Å´size„Å®„Åó„Å¶‰øùÊåÅ
            color: languages.colors[name], 
            x: 0
        }))
        .filter(({value}) => value / totalLines > threshold) // 4. Ë∂≥Âàá„Çä„ÇÇË°åÊï∞„Éô„Éº„Çπ„ÅßÂà§ÂÆö

      // 5. "Other"Ôºà„Åù„ÅÆ‰ªñÔºâ„Ç´„ÉÜ„Ç¥„É™„ÅÆË®àÁÆó„ÇÇË°åÊï∞„Éô„Éº„Çπ„Å´Â§âÊõ¥
      if (other) {
        // indepth„É¢„Éº„Éâ„Å™„ÇâËß£Êûê„Åß„Åç„Å™„Åã„Å£„ÅüË°åÊï∞„ÄÅ„Åù„ÅÜ„Åß„Å™„Åë„Çå„Å∞„É™„Çπ„Éà„Å´Âê´„Åæ„Çå„Å™„ÅÑË®ÄË™û„ÅÆË°åÊï∞„ÇíÂêàË®à
        let value = indepth ? (missed.lines || 0) : Object.entries(lines).filter(([name]) => !Object.values(languages[section]).map(({name}) => name).includes(name)).reduce((a, [_, b]) => a + b, 0)
        
        // limitÂà∂Èôê„Åß„É™„Çπ„Éà„Åã„ÇâÊ∫¢„Çå„ÅüË®ÄË™û„Åå„ÅÇ„Çå„Å∞„ÄÅ„Åù„ÅÆË°åÊï∞„ÇíOther„Å´Ë∂≥„Åô
        if (languages[section].length === limit) {
            const popped = languages[section].pop()
            value += popped.value
        }
        
        if (value) {
          //dprint-ignore-next-line
          languages[section].push({name:"Other", value, size: value, get lines() { return value }, set lines(_) { }, x:0}) 
        }
      }

      // 6. Ë°®Á§∫Áî®ÂêàË®àÂÄ§Ôºà„Ç∞„É©„Éï„ÅÆ100%ÂπÖÔºâ„ÇíË°åÊï∞„ÅÆÂêàË®à„ÅßË®àÁÆó
      const visible = {total: Object.values(languages[section]).map(({value}) => value).reduce((a, b) => a + b, 0)}

      for (let i = 0; i < languages[section].length; i++) {
        const {name} = languages[section][i]
        // 7. ÂêÑË®ÄË™û„ÅÆÂâ≤Âêà„ÇíË°åÊï∞„Éô„Éº„Çπ„ÅßË®àÁÆó
        languages[section][i].value /= (visible.total || 1)
        languages[section][i].x = (languages[section][i - 1]?.x ?? 0) + (languages[section][i - 1]?.value ?? 0)
        languages[section][i].lines = lines[name] ?? 0
        
        if ((colors[i]) && (!colors[name.toLocaleLowerCase()]))
          languages[section][i].color = colors[i]
        else
          languages[section][i].color = customColors[name] ?? languages.colors[name] ?? "#ededed"
      }
    }

    //Results
    return languages
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/lines/examples.yml">
- name: Compact display in base plugin
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.lines.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: repositories
    plugin_lines: yes
    plugin_lines_delay: 30

- name: Repositories and diff history
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.lines.history.svg
    token: ${{ secrets.METRICS_TOKEN }}
    base: ""
    plugin_lines: yes
    plugin_lines_delay: 30
    plugin_lines_sections: repositories, history
    plugin_lines_repositories_limit: 2
    plugin_lines_history_limit: 1
    repositories_skipped: |
      @use.patterns
      */*
      +lowlighter/metrics
</file>

<file path="source/plugins/lines/metadata.yml">
name: üë®‚Äçüíª Lines of code changed
category: github
description: |
  This plugin displays the number of lines of code added and removed across repositories.
examples:
  +Repositories and diff history: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.lines.history.svg
  Compact display in base plugin: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.lines.svg
index: 3
supports:
  - user
  - organization
  - repository
scopes:
  - public_access
inputs:

  plugin_lines:
    description: |
      Enable lines plugin
    type: boolean
    default: no

  plugin_lines_skipped:
    description: |
      Skipped repositories
    type: array
    format:
      - newline-separated
      - comma-separated
    default: ""
    example: my-repo-1, my-repo-2, owner/repo-3, ...
    inherits: repositories_skipped

  plugin_lines_sections:
    description: |
      Displayed sections

      - `base` will display the total lines added and removed in `base.repositories` section
      - `repositories` will display repositories with the most lines added and removed
      - `history` will display a graph displaying lines added and removed over time

      > ‚ÑπÔ∏è `base` requires at least [`base: repositories`](/source/plugins/base/README.md#base) to be set
    type: array
    format: comma-separated
    default: base
    example: repositories, history
    values:
      - base
      - repositories
      - history

  plugin_lines_repositories_limit:
    description: |
      Display limit
    type: number
    default: 4
    min: 0

  plugin_lines_history_limit:
    description: |
      Years to display

      Will display the last `n` years, relative to current year
    type: number
    default: 1
    zero: disable

  plugin_lines_delay:
    description: |
      Delay before performing a second query

      When non-zero, will perform a second query after specified delay (in seconds).
      The GitHub endpoint used may return inaccurate results on first query (these values seems to be cached on the fly),
      after returning correct results upon performing another query.

      Using this option may mitigate the occurrence of weird values.
    type: number
    default: 0
    min: 0
    zero: disable
</file>

<file path="source/plugins/skyline/examples.yml">
- name: GitHub Skyline
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.skyline.svg
    token: NOT_NEEDED
    base: ''
    plugin_skyline: yes
    plugin_skyline_year: 2020
    plugin_skyline_frames: 6
    plugin_skyline_quality: 1
  test:
    timeout: 1800000
    modes:
      - action
    skip: true
  prod:
    skip: true # Currently skyline always return 404

- name: GitHub City
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.skyline.city.svg
    token: NOT_NEEDED
    base: ''
    plugin_skyline: yes
    plugin_skyline_year: 2020
    plugin_skyline_frames: 6
    plugin_skyline_quality: 1
    plugin_skyline_settings: |
      {
        "url": "https://honzaap.github.io/GithubCity?name=${login}&year=${year}",
        "ready": "[...document.querySelectorAll('.display-info span')].map(span => span.innerText).includes('${login}')",
        "wait": 4,
        "hide": ".github-corner, .footer-link, .buttons-options, .mobile-rotate, .display-info span:first-child"
      }
  test:
    timeout: 1800000
    modes:
      - action
    skip: true
  prod:
    skip: true # Currently skyline always return 404
</file>

<file path="source/plugins/steam/examples.yml">
- name: Recently played games
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.steam.svg
    token: NOT_NEEDED
    base: ""
    plugin_steam_token: ${{ secrets.STEAM_TOKEN }}
    plugin_steam: yes
    plugin_steam_user: "0"
    plugin_steam_sections: recently-played
    plugin_steam_achievements_limit: 0
  prod:
    # ‚ö†Ô∏è Using mocked data for privacy reasons
    with:
      plugin_steam_token: MOCKED_TOKEN
      use_mocked_data: yes

- name: Profile and detailed game history
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.steam.full.svg
    token: NOT_NEEDED
    base: ""
    plugin_steam_token: ${{ secrets.STEAM_TOKEN }}
    plugin_steam: yes
    plugin_steam_user: "0"
  prod:
    # ‚ö†Ô∏è Using mocked data for privacy reasons
    with:
      plugin_steam_token: MOCKED_TOKEN
      use_mocked_data: yes
</file>

<file path="source/plugins/tweets/examples.yml">
- name: Latest tweets
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.tweets.svg
    token: NOT_NEEDED
    base: ""
    plugin_tweets: yes
    plugin_tweets_token: ${{ secrets.TWITTER_TOKEN }}
    plugin_tweets_user: github
  prod:
    skip: true
  test:
    skip: true

- name: Latest tweets including attachments
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.tweets.attachments.svg
    token: NOT_NEEDED
    base: ""
    plugin_tweets: yes
    plugin_tweets_token: ${{ secrets.TWITTER_TOKEN }}
    plugin_tweets_attachments: yes
    plugin_tweets_user: github
    plugin_tweets_limit: 1
  prod:
    skip: true
  test:
    skip: true
</file>

<file path="source/plugins/tweets/metadata.yml">
name: üê§ Latest tweets
category: social
description: |
  This plugin displays the latest tweets from a [Twitter](https://twitter.com) account.
disclaimer: |
  This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with [Twitter](https://twitter.com).
  All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.
deprecation: |
  As [Twitter](https://twitter.com) removed the ability to fetch tweets from their free API as part of their new [pricing policy](https://developer.twitter.com/en/docs/twitter-api/getting-started/about-twitter-api), this plugin is no longer maintained.
examples:
  +latest tweets with attachments: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.tweets.attachments.svg
  latest tweets: https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.tweets.svg
index: 1
supports:
  - user
  - organization
scopes: []
inputs:

  plugin_tweets:
    description: |
      Enable tweets plugin
    type: boolean
    default: no
    extras:
      - metrics.api.twitter.tweets

  plugin_tweets_token:
    description: |
      Twitter API token
    type: token
    default: ""

  plugin_tweets_user:
    description: |
      Twitter username
    type: string
    default: .user.twitter
    preset: no

  plugin_tweets_attachments:
    description: |
      Tweets attachments

      Can be used to display linked images, video thumbnails, etc.
    type: boolean
    default: no

  plugin_tweets_limit:
    description: |
      Display limit
    type: number
    default: 2
    min: 1
    max: 10
</file>

<file path="source/templates/classic/partials/_.json">
[
  "base.header",
  "introduction",
  "base.activity+community",
  "base.repositories",
  "lines",
  "followup",
  "discussions",
  "languages",
  "notable",
  "projects",
  "repositories",
  "gists",
  "pagespeed",
  "habits",
  "topics",
  "music",
  "nightscout",
  "posts",
  "rss",
  "tweets",
  "isocalendar",
  "calendar",
  "stars",
  "starlists",
  "stargazers",
  "people",
  "activity",
  "reactions",
  "anilist",
  "wakatime",
  "skyline",
  "support",
  "stackoverflow",
  "leetcode",
  "crypto",
  "stock",
  "achievements",
  "screenshot",
  "code",
  "chess",
  "sponsors",
  "sponsorships",
  "poopmap",
  "16personalities",
  "fortune",
  "splatoon",
  "steam"
]
</file>

<file path="source/templates/classic/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#%EF%B8%8F-templates">‚Üê Back to templates index</a></td></tr>
  <tr><th colspan="2"><h3>üìó Classic template</h3></th></tr>
  <tr><td colspan="2" align="center"><p>A template mimicking GitHub visual identity.
This is also the default template.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/plugins/achievements/README.md" title="üèÜ Achievements">üèÜ</a> <a href="/source/plugins/activity/README.md" title="üì∞ Recent activity">üì∞</a> <a href="/source/plugins/anilist/README.md" title="üå∏ Anilist watch list and reading list">üå∏</a> <a href="/source/plugins/calendar/README.md" title="üìÜ Commit calendar">üìÜ</a> <a href="/source/plugins/code/README.md" title="‚ôê Random code snippet">‚ôê</a> <a href="/source/plugins/16personalities/README.md" title="üß† 16personalities">üß†</a> <a href="/source/plugins/chess/README.md" title="‚ôüÔ∏è Chess">‚ôüÔ∏è</a> <a href="/source/plugins/crypto/README.md" title="ü™ô Crypto">ü™ô</a> <a href="/source/plugins/fortune/README.md" title="ü•† Fortune">ü•†</a> <a href="/source/plugins/nightscout/README.md" title="üíâ Nightscout">üíâ</a> <a href="/source/plugins/poopmap/README.md" title="üí© PoopMap plugin">üí©</a> <a href="/source/plugins/screenshot/README.md" title="üì∏ Website screenshot">üì∏</a> <a href="/source/plugins/splatoon/README.md" title="ü¶ë Splatoon">ü¶ë</a> <a href="/source/plugins/stock/README.md" title="üíπ Stock prices">üíπ</a> <a href="/source/plugins/discussions/README.md" title="üí¨ Discussions">üí¨</a> <a href="/source/plugins/followup/README.md" title="üéüÔ∏è Follow-up of issues and pull requests">üéüÔ∏è</a> <a href="/source/plugins/gists/README.md" title="üé´ Gists">üé´</a> <a href="/source/plugins/habits/README.md" title="üí° Coding habits and activity">üí°</a> <a href="/source/plugins/introduction/README.md" title="üôã Introduction">üôã</a> <a href="/source/plugins/isocalendar/README.md" title="üìÖ Isometric commit calendar">üìÖ</a> <a href="/source/plugins/languages/README.md" title="üà∑Ô∏è Languages activity">üà∑Ô∏è</a> <a href="/source/plugins/leetcode/README.md" title="üó≥Ô∏è Leetcode">üó≥Ô∏è</a> <a href="/source/plugins/lines/README.md" title="üë®‚Äçüíª Lines of code changed">üë®‚Äçüíª</a> <a href="/source/plugins/music/README.md" title="üéº Music activity and suggestions">üéº</a> <a href="/source/plugins/notable/README.md" title="üé© Notable contributions">üé©</a> <a href="/source/plugins/pagespeed/README.md" title="‚è±Ô∏è Google PageSpeed">‚è±Ô∏è</a> <a href="/source/plugins/people/README.md" title="üßë‚Äçü§ù‚Äçüßë People">üßë‚Äçü§ù‚Äçüßë</a> <a href="/source/plugins/posts/README.md" title="‚úíÔ∏è Recent posts">‚úíÔ∏è</a> <a href="/source/plugins/projects/README.md" title="üóÇÔ∏è GitHub projects">üóÇÔ∏è</a> <a href="/source/plugins/reactions/README.md" title="üé≠ Comment reactions">üé≠</a> <a href="/source/plugins/repositories/README.md" title="üìì Featured repositories">üìì</a> <a href="/source/plugins/rss/README.md" title="üóº Rss feed">üóº</a> <a href="/source/plugins/skyline/README.md" title="üåá GitHub Skyline">üåá</a> <a href="/source/plugins/sponsors/README.md" title="üíï GitHub Sponsors">üíï</a> <a href="/source/plugins/sponsorships/README.md" title="üíù GitHub Sponsorships">üíù</a> <a href="/source/plugins/stackoverflow/README.md" title="üó®Ô∏è Stack Overflow">üó®Ô∏è</a> <a href="/source/plugins/stargazers/README.md" title="‚ú® Stargazers">‚ú®</a> <a href="/source/plugins/starlists/README.md" title="üí´ Star lists">üí´</a> <a href="/source/plugins/stars/README.md" title="üåü Recently starred repositories">üåü</a> <a href="/source/plugins/steam/README.md" title="üïπÔ∏è Steam">üïπÔ∏è</a> <a href="/source/plugins/support/README.md" title="üí≠ GitHub Community Support">üí≠</a> <a href="/source/plugins/topics/README.md" title="üìå Starred topics">üìå</a> <a href="/source/plugins/traffic/README.md" title="üßÆ Repositories traffic">üßÆ</a> <a href="/source/plugins/tweets/README.md" title="üê§ Latest tweets">üê§</a> <a href="/source/plugins/wakatime/README.md" title="‚è∞ WakaTime">‚è∞</a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code></td>
  </tr>
  <tr>
    <td><code>*Ô∏è‚É£ SVG</code> <code>*Ô∏è‚É£ PNG</code> <code>*Ô∏è‚É£ JPEG</code> <code>#Ô∏è‚É£ JSON</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.classic.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Example
uses: lowlighter/metrics@latest
with:
  filename: metrics.classic.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: header, repositories
  plugin_lines: yes

```
<!--/examples-->
</file>

<file path="source/templates/markdown/example.md">
# üìí Markdown template example

See [rendering of this file here](https://github.com/lowlighter/metrics/blob/examples/metrics.markdown.full.md) and [original template source here](https://github.com/lowlighter/metrics/blob/master/source/templates/markdown/example.md).

## üß© Plugins with markdown version

<%- await include(`partials/activity.ejs`) %>

___

<%- await include(`partials/posts.ejs`) %>

___

<%- await include(`partials/rss.ejs`) %>

___

> ‚ö†Ô∏è As [Twitter](https://twitter.com) removed the ability to fetch tweets from their free API as part of their new [pricing policy](https://developer.twitter.com/en/docs/twitter-api/getting-started/about-twitter-api), this plugin is no longer maintained.

<!-- <% if (false) { %> -->
<<!-- -->%- await include(`partials/tweets.ejs`) %<!-- -->>
<!-- <% } %> -->
<!-- Example rendering before the plugin was deprecated
<%- "--"+">" %>

**[üê§ Latest tweets from @github](https://twitter.com/github)**
> Putting that extra ‚Äú+‚Äù in engineering culture, staff+ engineers lead by example, collaborate, make effective decisions, and support organizational goals. <span class="mention">@rynchantress</span> breaks it down.
>
> <a href="GitHub"><img src="https://images.ctfassets.net/s5uo95nf6njh/3sBQCkU6O0Lwc2Tp2LkMrU/e20b22c6ecaa66be267ebdf2d7774816/1920x1080-ReadMe-Site_Hero-Ryn_Daniels.jpg" alt="How to put the plus in ‚Äòstaff+‚Äô engineer " height="200"></a>
>
> *19:22:01 on 6 Jun 2023*

> It's never been more essential to ensure that your mobile applications are secure. üîí Check out two highlights from code scanning and Dependabot that are bringing a heightened level of security to the mobile development process in both Swift and Kotlin.
>
> <a href="The GitHub Blog"><img src="https://github.blog/wp-content/uploads/2023/05/1200.630-Security-wLogo.png" alt="Swift support brings broader mobile application security to GitHub Advanced Security | The GitHub Blog" height="200"></a>
>
> *16:48:16 on 6 Jun 2023*

<%- "<"+"!--" %>
-->

___

<%- await include(`partials/topics.ejs`) %>

## üéà Embedding SVG metrics on-the-fly

<%- await embed(`example-isocalendar`, {isocalendar:true, isocalendar_duration:"full-year", config_display:"large"}) %>

___

<%- await embed(`example-languages-pdf`, {languages:true, languages_details:"percentage, bytes-size", config_display:"large"}) %>

___

<%- await embed(`example-base-pdf`, {base:"activity, community, repositories"}) %>
</file>

<file path="source/templates/markdown/examples.yml">
- name: Example
  uses: lowlighter/metrics@latest
  with:
    template: markdown
    filename: metrics.markdown.md
    markdown: https://raw.githubusercontent.com/lowlighter/metrics/examples/metrics.markdown.template.md
    config_output: markdown
    token: ${{ secrets.METRICS_TOKEN }}
  prod:
    with:
      output_action: commit
      committer_branch: examples

- name: Example with plugins configuration for embed use
  uses: lowlighter/metrics@latest
  with:
    template: markdown
    filename: metrics.markdown.full.md
    markdown: https://raw.githubusercontent.com/lowlighter/metrics/master/source/templates/markdown/example.md
    config_output: markdown
    plugin_activity: yes
    plugin_activity_limit: 7
    plugin_activity_days: 0
    plugin_activity_filter: issue, pr, release, fork, review, ref/create
    plugin_posts: yes
    plugin_posts_source: dev.to
    plugin_posts_descriptions: yes
    plugin_posts_covers: yes
    plugin_posts_limit: 2
    plugin_rss: yes
    plugin_rss_source: https://news.ycombinator.com/rss
    plugin_rss_limit: 4
    plugin_topics: yes
    plugin_topics_limit: 24
    plugin_isocalendar: yes
    plugin_languages: yes
    token: ${{ secrets.METRICS_TOKEN }}
  prod:
    with:
      output_action: commit
      committer_branch: examples

- name: Example (pdf output)
  uses: lowlighter/metrics@latest
  with:
    template: markdown
    filename: metrics.markdown.pdf
    markdown: https://raw.githubusercontent.com/lowlighter/metrics/master/source/templates/markdown/example.pdf.md
    config_output: markdown-pdf
    plugin_rss: yes
    plugin_rss_source: https://news.ycombinator.com/rss
    plugin_rss_limit: 4
    plugin_isocalendar: yes
    config_twemoji: yes
    config_padding: 5%
    token: ${{ secrets.METRICS_TOKEN }}
  prod:
    with:
      output_action: commit
      committer_branch: examples
</file>

<file path="source/templates/markdown/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#%EF%B8%8F-templates">‚Üê Back to templates index</a></td></tr>
  <tr><th colspan="2"><h3>üìí Markdown template</h3></th></tr>
  <tr><td colspan="2" align="center"><p>A template capable of rendering markdown from a given template file.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/plugins/activity/README.md" title="üì∞ Recent activity">üì∞</a> <a href="/source/plugins/posts/README.md" title="‚úíÔ∏è Recent posts">‚úíÔ∏è</a> <a href="/source/plugins/rss/README.md" title="üóº Rss feed">üóº</a> <a href="/source/plugins/topics/README.md" title="üìå Starred topics">üìå</a> <a href="/source/plugins/tweets/README.md" title="üê§ Latest tweets">üê§</a> <code>‚úì embed()</code></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>#Ô∏è‚É£ JSON</code> <code>üî† Markdown</code> <code>üî† Markdown (PDF)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.markdown.png" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

This template can be used to a *markdown template file* with data gathered by metrics.

Since the resulting output is a markdown file, it is possible to do additional formatting such as creating hyperlinks and adding custom texts.

## üàÇÔ∏è Templating syntax:

The templating engine is [EJS](https://github.com/mde/ejs) and can be used to interpolate any data retrieved by metrics.

* `<%=` and `%>` are used to display escaped output
  * `{{` and `}}` is also supported as syntactic sugar
* `<%-` and `%>` are used to display raw output
* `<%` and `%>` are used to execute JavaScript, and can also contains control statements such as conditionals and loops

*Example: basic templating*
```markdown
<!-- template -->
I joined GitHub on `{{ f.date(REGISTRATION_DATE, {date:true}) }}`.
I contributed to `{{ REPOSITORIES_CONTRIBUTED_TO }}` repositories and made `{{ COMMITS }}` commits.

<!-- render -->
I joined GitHub on `20 Oct 2016`.
I contributed to `37` repositories and made `5947` commits.
```

## üî£ Available data

Any data fetched by metrics and exposed formatting helpers can be used.

It also means that to access plugins data they must be enabled and configured beforehand.

*Example: enabling `plugin_activity` exposes `plugins.activity` data*
```yml
- uses: lowlighter/metrics@latest
  with:
    template: markdown
    plugin_activity: yes
```

> üí° To avoid failures while accessing data, use [optional chaining operator `?.`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining) or ensure that no errors where reported by a given plugin.

> ‚ö†Ô∏è Although rare, data schemas may change in-between metrics version without any notice (these changes are not documented in release notes). It is advised to use a pinned version or a fork when using this template.

A few properties are aliased in [/source/templates/markdown/template.mjs](/source/templates/markdown/template.mjs) for convenience.

Use `config_output: json` to dump all available data for a given configuration. Power users can also directly read [metrics source code](https://github.com/lowlighter/metrics) to know what is exposed.

For a quick overview, it is also possible to use [metrics.lecoq.io/{username}?config.output=json](https://metrics.lecoq.io).

> üí° Note however that [metrics.lecoq.io](https://metrics.lecoq.io) has a caching system which may prevent any new result.

## üß© Plugins with markdown version

Several plugins have a markdown version which provides better usability, usually with hyperlinks and better text formatting.

*Example: using `‚úíÔ∏è posts` plugin markdown version*
```ejs
<%- await include(`partials/posts.ejs`) %>
```

**[‚úíÔ∏è Recent posts from dev.to](https://dev.to/lowlighter)**
<table>
  <tr>
    <td rowspan="2" width="280">
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--rbmokFTg--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/i/idot5ak9irxtu948bgzs.png" alt="" width="280">
    </td>
    <th>
      <a href="https://dev.to/lowlighter/metrics-v3-0-the-ultimate-tool-to-pimp-your-github-profile-g7p">Metrics v3.0, the ultimate tool to pimp your GitHub profile!</a>
    </th>
  </tr>
  <tr>
    <td>
      Metrics is an extensive SVG images generator plugged with various APIs (GitHub, Twitter, Spotify, ......
      <br>
      <i>Published on 4 Jan 2021</i>
    </td>
  </tr>
</table>

> üí° Remember, plugins still need to be enabled and configured in workflow file!

## üéà Embedding SVG metrics on-the-fly

An additional feature which makes the markdown template more powerful than its counterparts is that it can also render SVG on the fly using `embed()` function, without creating any additional jobs.

These renders will automatically be pushed to `markdown_cache` folder and included in the markdown render.

```yml
- uses: lowlighter/metrics@latest
  with:
    template: markdown
    markdown_cache: .cache
```

The `embed()` function takes two arguments:
1. An unique file identifier (which will be used to store render in `${markdown_cache}/${file_identifier}`)
2. Configuration options
  - Note that `token` options are automatically passed down from overall configuration, do not pass them again (especially in clear) in it

*Example: embed a `üà∑Ô∏è languages` SVG render*
```ejs
<%- await embed(`example-languages-pdf`, {languages:true, languages_details:"percentage, bytes-size", config_display:"large"}) %>
```

<img src="https://github.com/lowlighter/metrics/blob/examples/.cache/example-languages-pdf.svg">

> üí° The `plugin_` prefix can be dropped for convenience

> üí° The `embed()` function does not have `üóÉÔ∏è base` plugin enabled by default. To use it, it is required to explicitly pass them through `base` option.

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Example
uses: lowlighter/metrics@latest
with:
  template: markdown
  filename: metrics.markdown.md
  markdown: >-
    https://raw.githubusercontent.com/lowlighter/metrics/examples/metrics.markdown.template.md
  config_output: markdown
  token: ${{ secrets.METRICS_TOKEN }}

```
```yaml
name: Example with plugins configuration for embed use
uses: lowlighter/metrics@latest
with:
  template: markdown
  filename: metrics.markdown.full.md
  markdown: >-
    https://raw.githubusercontent.com/lowlighter/metrics/master/source/templates/markdown/example.md
  config_output: markdown
  plugin_activity: yes
  plugin_activity_limit: 7
  plugin_activity_days: 0
  plugin_activity_filter: issue, pr, release, fork, review, ref/create
  plugin_posts: yes
  plugin_posts_source: dev.to
  plugin_posts_descriptions: yes
  plugin_posts_covers: yes
  plugin_posts_limit: 2
  plugin_rss: yes
  plugin_rss_source: https://news.ycombinator.com/rss
  plugin_rss_limit: 4
  plugin_topics: yes
  plugin_topics_limit: 24
  plugin_isocalendar: yes
  plugin_languages: yes
  token: ${{ secrets.METRICS_TOKEN }}

```
```yaml
name: Example (pdf output)
uses: lowlighter/metrics@latest
with:
  template: markdown
  filename: metrics.markdown.pdf
  markdown: >-
    https://raw.githubusercontent.com/lowlighter/metrics/master/source/templates/markdown/example.pdf.md
  config_output: markdown-pdf
  plugin_rss: yes
  plugin_rss_source: https://news.ycombinator.com/rss
  plugin_rss_limit: 4
  plugin_isocalendar: yes
  config_twemoji: yes
  config_padding: 5%
  token: ${{ secrets.METRICS_TOKEN }}

```
<!--/examples-->
</file>

<file path="source/templates/repository/partials/_.json">
[
  "base.header",
  "introduction",
  "followup",
  "languages",
  "projects",
  "pagespeed",
  "stargazers",
  "people",
  "activity",
  "posts",
  "rss",
  "screenshot",
  "stock",
  "crypto",
  "contributors",
  "sponsors",
  "licenses"
]
</file>

<file path="source/templates/repository/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#%EF%B8%8F-templates">‚Üê Back to templates index</a></td></tr>
  <tr><th colspan="2"><h3>üìò Repository template</h3></th></tr>
  <tr><td colspan="2" align="center"><p>A template mimicking GitHub visual identity and specially crafted for repositories.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/plugins/activity/README.md" title="üì∞ Recent activity">üì∞</a> <a href="/source/plugins/crypto/README.md" title="ü™ô Crypto">ü™ô</a> <a href="/source/plugins/screenshot/README.md" title="üì∏ Website screenshot">üì∏</a> <a href="/source/plugins/stock/README.md" title="üíπ Stock prices">üíπ</a> <a href="/source/plugins/contributors/README.md" title="üèÖ Repository contributors">üèÖ</a> <a href="/source/plugins/followup/README.md" title="üéüÔ∏è Follow-up of issues and pull requests">üéüÔ∏è</a> <a href="/source/plugins/introduction/README.md" title="üôã Introduction">üôã</a> <a href="/source/plugins/languages/README.md" title="üà∑Ô∏è Languages activity">üà∑Ô∏è</a> <a href="/source/plugins/licenses/README.md" title="üìú Repository licenses">üìú</a> <a href="/source/plugins/lines/README.md" title="üë®‚Äçüíª Lines of code changed">üë®‚Äçüíª</a> <a href="/source/plugins/pagespeed/README.md" title="‚è±Ô∏è Google PageSpeed">‚è±Ô∏è</a> <a href="/source/plugins/people/README.md" title="üßë‚Äçü§ù‚Äçüßë People">üßë‚Äçü§ù‚Äçüßë</a> <a href="/source/plugins/posts/README.md" title="‚úíÔ∏è Recent posts">‚úíÔ∏è</a> <a href="/source/plugins/projects/README.md" title="üóÇÔ∏è GitHub projects">üóÇÔ∏è</a> <a href="/source/plugins/rss/README.md" title="üóº Rss feed">üóº</a> <a href="/source/plugins/sponsors/README.md" title="üíï GitHub Sponsors">üíï</a> <a href="/source/plugins/stargazers/README.md" title="‚ú® Stargazers">‚ú®</a> <a href="/source/plugins/traffic/README.md" title="üßÆ Repositories traffic">üßÆ</a></td>
  </tr>
  <tr>
    <td><code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>*Ô∏è‚É£ SVG</code> <code>*Ô∏è‚É£ PNG</code> <code>*Ô∏è‚É£ JPEG</code> <code>#Ô∏è‚É£ JSON</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.repository.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## üéé Using a repository template

To use a repository template, a `repo` handle must be provided.

If the token owner is not the repository owner, then the `user` option must be set to the repository owner (whether it is an user or organization account).

*Example: render `lowlighter/metrics` repository*
```yml
- uses: lowlighter/metrics@latest
  with:
    template: repository
    user: lowlighter
    repo: metrics
```

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Example
uses: lowlighter/metrics@latest
with:
  template: repository
  filename: metrics.repository.svg
  token: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}
  user: lowlighter
  repo: metrics
  plugin_lines: yes
  plugin_followup: yes
  plugin_projects: yes
  plugin_projects_repositories: lowlighter/metrics/projects/1

```
<!--/examples-->
</file>

<file path="tests/cases/crypto.plugin.yml">
[]
</file>

<file path="tests/cases/lines.plugin.yml">
- name: üë®‚Äçüíª Lines of code changed - Compact display in base plugin
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    base: repositories
    plugin_lines: 'yes'
    plugin_lines_delay: 30
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üë®‚Äçüíª Lines of code changed - Repositories and diff history
  uses: lowlighter/metrics@latest
  with:
    token: MOCKED_TOKEN
    plugin_lines: 'yes'
    plugin_lines_delay: 30
    plugin_lines_sections: repositories, history
    plugin_lines_repositories_limit: 2
    plugin_lines_history_limit: 1
    repositories_skipped: |
      @use.patterns
      */*
      +lowlighter/metrics
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/markdown.template.yml">
- name: üìí Markdown template - Example
  uses: lowlighter/metrics@latest
  with:
    template: markdown
    markdown: >-
      https://raw.githubusercontent.com/lowlighter/metrics/examples/metrics.markdown.template.md
    config_output: markdown
    token: MOCKED_TOKEN
    use_mocked_data: yes
    verify: yes
- name: üìí Markdown template - Example with plugins configuration for embed use
  uses: lowlighter/metrics@latest
  with:
    template: markdown
    markdown: >-
      https://raw.githubusercontent.com/lowlighter/metrics/master/source/templates/markdown/example.md
    config_output: markdown
    plugin_activity: yes
    plugin_activity_limit: 7
    plugin_activity_days: 0
    plugin_activity_filter: issue, pr, release, fork, review, ref/create
    plugin_posts: yes
    plugin_posts_source: dev.to
    plugin_posts_descriptions: yes
    plugin_posts_covers: yes
    plugin_posts_limit: 2
    plugin_rss: yes
    plugin_rss_source: https://news.ycombinator.com/rss
    plugin_rss_limit: 4
    plugin_topics: yes
    plugin_topics_limit: 24
    plugin_isocalendar: yes
    plugin_languages: yes
    token: MOCKED_TOKEN
    use_mocked_data: yes
    verify: yes
- name: üìí Markdown template - Example (pdf output)
  uses: lowlighter/metrics@latest
  with:
    template: markdown
    markdown: >-
      https://raw.githubusercontent.com/lowlighter/metrics/master/source/templates/markdown/example.pdf.md
    config_output: markdown-pdf
    plugin_rss: yes
    plugin_rss_source: https://news.ycombinator.com/rss
    plugin_rss_limit: 4
    plugin_isocalendar: yes
    config_twemoji: yes
    config_padding: 5%
    token: MOCKED_TOKEN
    use_mocked_data: yes
    verify: yes
</file>

<file path="tests/cases/skyline.plugin.yml">
[]
</file>

<file path="tests/cases/steam.plugin.yml">
- name: üïπÔ∏è Steam - Recently played games
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_steam_token: MOCKED_TOKEN
    plugin_steam: 'yes'
    plugin_steam_user: '0'
    plugin_steam_sections: recently-played
    plugin_steam_achievements_limit: 0
    use_mocked_data: 'yes'
    verify: 'yes'
- name: üïπÔ∏è Steam - Profile and detailed game history
  uses: lowlighter/metrics@latest
  with:
    token: NOT_NEEDED
    plugin_steam_token: MOCKED_TOKEN
    plugin_steam: 'yes'
    plugin_steam_user: '0'
    use_mocked_data: 'yes'
    verify: 'yes'
</file>

<file path="tests/cases/tweets.plugin.yml">
[]
</file>

<file path="tests/mocks/api/axios/get/nightscout.mjs">
/**Mocked data */
export default function({faker, url}) {
  //Last.fm api
  if (/^https:..testapp.herokuapp.com.*$/.test(url)) {
    //Get Nightscout Data
    console.debug(`metrics/compute/mocks > mocking nightscout api result > ${url}`)
    const lastInterval = Math.floor(new Date() / 300000) * 300000
    return ({
      status: 200,
      data: new Array(12).fill(null).map(_ => ({
        _id: faker.git.commitSha().substring(0, 23),
        device: "xDrip-DexcomG5",
        date: lastInterval,
        dateString: new Date(lastInterval).toISOString(),
        sgv: faker.number.int({min: 40, max: 400}),
        delta: faker.number.int({min: -10, max: 10}),
        direction: faker.helpers.arrayElement(["SingleUp", "DoubleUp", "FortyFiveUp", "Flat", "FortyFiveDown", "SingleDown", "DoubleDown"]),
        type: "sgv",
        filtered: 0,
        unfiltered: 0,
        rssi: 100,
        noise: 1,
        sysTime: new Date(lastInterval).toISOString(),
        utcOffset: faker.number.int({min: -12, max: 14}) * 60,
      })),
    })
  }
}
</file>

<file path="tests/mocks/api/axios/get/poopmap.mjs">
/**Mocked data */
export default function({faker, url, options, login = faker.internet.userName()}) {
  //Wakatime api
  if (/^https:..api.poopmap.net.*$/.test(url)) {
    //Get user profile
    if (/public_links\/MOCKED_TOKEN/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking poopmap api result > ${url}`)
      return ({
        status: 200,
        data: {
          poops: new Array(12 + faker.number.int(6)).fill(null).map(_ => ({
            id: 79744699,
            latitude: faker.location.latitude(),
            longitude: faker.location.longitude(),
            created_at: faker.date.past().toISOString(),
            note: "",
            place: "",
            rating: faker.number.int(5),
            followers_count: faker.number.int(100),
            comments_count: faker.number.int(12),
          })),
        },
      })
    }
  }
}
</file>

<file path="tests/mocks/api/axios/get/stackoverflow.mjs">
/**Mocked data */
export default function({faker, url, options, login = faker.internet.userName()}) {
  //Stackoverflow api
  if (/^https:..api.stackexchange.com.2.2.*$/.test(url)) {
    //Extract user id
    const user_id = url.match(/[/]users[/](?<id>\d+)/)?.groups?.id ?? NaN
    const pagesize = Number(url.match(/pagesize=(?<pagesize>\d+)/)?.groups?.pagesize) || 30
    //User account
    if (/users[/]\d+[/][?]site=stackoverflow$/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking stackoverflow api result > ${url}`)
      return ({
        status: 200,
        data: {
          items: [
            {
              badge_counts: {bronze: faker.number.int(500), silver: faker.number.int(300), gold: faker.number.int(100)},
              accept_rate: faker.number.int(100),
              answer_count: faker.number.int(1000),
              question_count: faker.number.int(1000),
              view_count: faker.number.int(10000),
              creation_date: faker.date.past(),
              display_name: faker.internet.userName(),
              user_id,
              reputation: faker.number.int(100000),
            },
          ],
          has_more: false,
          quota_max: 300,
          quota_remaining: faker.number.int(300),
        },
      })
    }
    //Total metrics
    if (/[?]site=stackoverflow&filter=total$/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking stackoverflow api result > ${url}`)
      return ({
        status: 200,
        data: {
          total: faker.number.int(10000),
        },
      })
    }
    //Questions
    if ((/questions[?]site=stackoverflow/.test(url)) || (/questions[/][\d;]+[?]site=stackoverflow/.test(url))) {
      console.debug(`metrics/compute/mocks > mocking stackoverflow api result > ${url}`)
      return ({
        status: 200,
        data: {
          items: new Array(pagesize).fill(null).map(_ => ({
            tags: new Array(5).fill(null).map(_ => faker.lorem.slug()),
            owner: {display_name: faker.internet.userName()},
            is_answered: faker.datatype.boolean(),
            view_count: faker.number.int(10000),
            accepted_answer_id: faker.number.int(1000000),
            answer_count: faker.number.int(100),
            score: faker.number.int(1000),
            creation_date: faker.date.recent(),
            down_vote_count: faker.number.int(1000),
            up_vote_count: faker.number.int(1000),
            comment_count: faker.number.int(1000),
            favorite_count: faker.number.int(1000),
            title: faker.lorem.sentence(),
            body_markdown: faker.lorem.paragraphs(),
            link: faker.internet.url(),
            question_id: faker.number.int(1000000),
          })),
          has_more: false,
          quota_max: 300,
          quota_remaining: faker.number.int(300),
        },
      })
    }
    //Answers
    if ((/answers[?]site=stackoverflow/.test(url)) || (/answers[/][\d;]+[?]site=stackoverflow/.test(url))) {
      console.debug(`metrics/compute/mocks > mocking stackoverflow api result > ${url}`)
      return ({
        status: 200,
        data: {
          items: new Array(pagesize).fill(null).map(_ => ({
            owner: {display_name: faker.internet.userName()},
            link: faker.internet.url(),
            is_accepted: faker.datatype.boolean(),
            score: faker.number.int(1000),
            down_vote_count: faker.number.int(1000),
            up_vote_count: faker.number.int(1000),
            comment_count: faker.number.int(1000),
            creation_date: faker.date.recent(),
            question_id: faker.number.int(1000000),
            body_markdown: faker.lorem.paragraphs(),
            answer_id: faker.number.int(1000000),
          })),
          has_more: false,
          quota_max: 300,
          quota_remaining: faker.number.int(300),
        },
      })
    }
  }
}
</file>

<file path="tests/mocks/api/axios/get/steam.mjs">
/**Mocked data */
export default function({faker, url, options, login = faker.internet.userName()}) {
  // App details
  if (/^https:..store.steampowered.com.api.appdetails*$/.test(url)) {
    console.debug(`metrics/compute/mocks > mocking steam api result > ${url}`)
    return ({
      status: 200,
      data: {
        "524220": {
          "success": true,
          "data": {
            "type": "game",
            "name": "NieR:Automata‚Ñ¢",
            "steam_appid": 524220,
            "required_age": 0,
            "is_free": false,
            "dlc": [
              580600,
            ],
            "detailed_description":
              '<h1>NieR:Automata‚Ñ¢ Game of the YoRHa Edition<\/h1><p><img src="https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/extras\/Nier-GOTY-Steam-EN.jpg?t=1646911723" \/><br>The NieR:Automata‚Ñ¢ Game of the YoRHa Edition includes the game itself and comes packed with DLC and bonus content for the full experience of the award-winning post-apocalyptic action RPG, including:<br><br><ul class="bb_ul"><li>3C3C1D119440927 DLC*<br><\/li><li>Valve Character Accessory<br><\/li><li>Cardboard Pod Skin<br><\/li><li>Retro Grey Pod Skin<br><\/li><li>Retro Red Pod Skin<br><\/li><li>Grimoire Weiss Pod<br><\/li><li>Machine Mask Accessory<br><\/li><li>Exclusive set of wallpapers in the following sizes: 1024 x 768, 1280 x 1024, 1920 x 1080, 2560 x 1600<\/li><\/ul><br>*To enjoy this content you will need to have progressed a certain way into the main story of the game. There are also some scenes during the progression of the main game scenario in which this content cannot be accessed.<\/p><br><h1>Featured DLC<\/h1><p><img src="https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/extras\/PromoBanner_616x389_en.png?t=1646911723" \/><br>The NieR: Automata 3C3C1D119440927 DLC is out now and includes three new colosseums to challenge, plus additional sub-quests. Upon completion of these quests, players can earn various rewards including new costumes from NieR: Replicant, new equipment and cosmetic accessories such as masks, hairspray that change the color of your character, records that add special music tracks to the players‚Äô jukebox and much more!<\/p><br><h1>Reviews &amp; Accolades<\/h1><p>9\/10 <i>&quot;Don‚Äôt miss this&quot;<\/i> ‚Äì <a href="https:\/\/steamcommunity.com\/linkfilter\/?url=https:\/\/www.videogamer.com\/reviews\/nier-automata-review" target="_blank" rel=" noopener"  >VideoGamer<\/a><br><br>10\/10 <i>&quot;One of the best games I‚Äôve ever played&quot;<\/i> ‚Äì <a href="https:\/\/steamcommunity.com\/linkfilter\/?url=http:\/\/www.rpgsite.net\/review\/5372-nier-automata-review" target="_blank" rel=" noopener"  >RPGSite<\/a><br><br>4\/5 <i>&quot;Pure genius&quot;<\/i> ‚Äì <a href="https:\/\/steamcommunity.com\/linkfilter\/?url=http:\/\/www.trustedreviews.com\/nier-automata-review" target="_blank" rel=" noopener"  >Trusted Reviews<\/a><br><br>9\/10 <i>&quot;One of the most interesting and unique games you‚Äôll play this year&quot;<\/i> ‚Äì <a href="https:\/\/steamcommunity.com\/linkfilter\/?url=http:\/\/www.godisageek.com\/reviews\/nier-automata-review" target="_blank" rel=" noopener"  >God is a Geek<\/a><br><br>9\/10 <i>&quot;Classic Platinum action combined with a deep role-playing system&quot;<\/i> ‚Äì <a href="https:\/\/steamcommunity.com\/linkfilter\/?url=http:\/\/metro.co.uk\/2017\/03\/06\/nier-automata-review-bullet-hell-meets-existential-role-player-6491251\/" target="_blank" rel=" noopener"  >Metro<\/a><\/p><br><h1>About the Game<\/h1><a href="https:\/\/store.steampowered.com\/app\/1113560\/NieR_Replicant_ver122474487139\/" target="_blank" rel=""  id="dynamiclink_0" >https:\/\/store.steampowered.com\/app\/1113560\/NieR_Replicant_ver122474487139\/<\/a><br><br><img src="https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/extras\/Nier_PRE_Launch-ENG_UK_Multi_06_Mod.jpg?t=1646911723" \/><br>NieR: Automata tells the story of androids 2B, 9S and A2 and their battle to reclaim the machine-driven dystopia overrun by powerful machines.<br><br>Humanity has been driven from the Earth by mechanical beings from another world. In a final effort to take back the planet, the human resistance sends a force of android soldiers to destroy the invaders. Now, a war between machines and androids rages on... A war that could soon unveil a long-forgotten truth of the world.<br><br>Key Features:<br><ul class="bb_ul"><li><strong>Action-Packed Battles<\/strong> ‚Äì Players will switch between using melee and ranged attacks in battle against hordes of enemies and challenging bosses across a variety of open field maps. The tight controls and incredibly fluid combat are simple to learn for newcomers while offering plenty of depth for more experienced action gamers. Players can perform high-speed battle actions‚Äîcombining light and heavy attacks‚Äîand switch through an arsenal of weaponry while evading enemies with speed and style. <br><\/li><li><strong>Beautifully Desolate Open-World<\/strong> ‚Äì The game seamlessly joins together hauntingly beautiful vistas and locations with no area loading. The environments are rendered in 60fps and contain a wealth of sub-events in addition to the main storyline. <br><\/li><li><strong>Masterfully Crafted Story and Characters<\/strong> ‚Äì NieR: Automata tells the story of androids 2B, 9S and A2 and their ferocious battle to reclaim a machine-driven dystopia overrun by powerful weapons known as machine lifeforms.<br><\/li><li><strong>Elements of an RPG<\/strong> ‚Äì Players will obtain a variety of weapon types, level up in battle, learn new combat skills, and customise a loadout that caters to their playstyle.<br><\/li><li><strong>Utilise the Pod Support System to Assist In and Outside of Battle<\/strong> ‚Äì Pods can attack the enemy in both manual and lock-on modes. They can also assist outside of battle, such as allowing the player to glide through the air. Pods can be enhanced throughout the game, with upgrades including new attack methods and variations.<br><\/li><li><strong>‚ÄúAuto Mode‚Äù Available for Beginners <\/strong>‚Äì Novice players can elect ‚ÄúAuto Mode‚Äù for easy attacks and evasions.<\/li><\/ul>',
            "about_the_game":
              '<a href="https:\/\/store.steampowered.com\/app\/1113560\/NieR_Replicant_ver122474487139\/" target="_blank" rel=""  id="dynamiclink_1" >https:\/\/store.steampowered.com\/app\/1113560\/NieR_Replicant_ver122474487139\/<\/a><br><br><img src="https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/extras\/Nier_PRE_Launch-ENG_UK_Multi_06_Mod.jpg?t=1646911723" \/><br>NieR: Automata tells the story of androids 2B, 9S and A2 and their battle to reclaim the machine-driven dystopia overrun by powerful machines.<br><br>Humanity has been driven from the Earth by mechanical beings from another world. In a final effort to take back the planet, the human resistance sends a force of android soldiers to destroy the invaders. Now, a war between machines and androids rages on... A war that could soon unveil a long-forgotten truth of the world.<br><br>Key Features:<br><ul class="bb_ul"><li><strong>Action-Packed Battles<\/strong> ‚Äì Players will switch between using melee and ranged attacks in battle against hordes of enemies and challenging bosses across a variety of open field maps. The tight controls and incredibly fluid combat are simple to learn for newcomers while offering plenty of depth for more experienced action gamers. Players can perform high-speed battle actions‚Äîcombining light and heavy attacks‚Äîand switch through an arsenal of weaponry while evading enemies with speed and style. <br><\/li><li><strong>Beautifully Desolate Open-World<\/strong> ‚Äì The game seamlessly joins together hauntingly beautiful vistas and locations with no area loading. The environments are rendered in 60fps and contain a wealth of sub-events in addition to the main storyline. <br><\/li><li><strong>Masterfully Crafted Story and Characters<\/strong> ‚Äì NieR: Automata tells the story of androids 2B, 9S and A2 and their ferocious battle to reclaim a machine-driven dystopia overrun by powerful weapons known as machine lifeforms.<br><\/li><li><strong>Elements of an RPG<\/strong> ‚Äì Players will obtain a variety of weapon types, level up in battle, learn new combat skills, and customise a loadout that caters to their playstyle.<br><\/li><li><strong>Utilise the Pod Support System to Assist In and Outside of Battle<\/strong> ‚Äì Pods can attack the enemy in both manual and lock-on modes. They can also assist outside of battle, such as allowing the player to glide through the air. Pods can be enhanced throughout the game, with upgrades including new attack methods and variations.<br><\/li><li><strong>‚ÄúAuto Mode‚Äù Available for Beginners <\/strong>‚Äì Novice players can elect ‚ÄúAuto Mode‚Äù for easy attacks and evasions.<\/li><\/ul>',
            "short_description": "NieR: Automata tells the story of androids 2B, 9S and A2 and their battle to reclaim the machine-driven dystopia overrun by powerful machines.",
            "supported_languages": "English<strong>*<\/strong>, French, Italian, German, Spanish - Spain, Japanese<strong>*<\/strong><br><strong>*<\/strong>languages with full audio support",
            "reviews":
              '‚ÄúRiveting and gratifying combat‚Äù<br>9\/10 ‚Äì <a href="https:\/\/steamcommunity.com\/linkfilter\/?url=http:\/\/www.gamespot.com\/reviews\/nier-automata-review\/1900-6416628\/" target="_blank" rel=" noopener"  >Gamespot<\/a><br><br>‚ÄúA breath of fresh air‚Äù<br>4.5\/5 ‚Äì <a href="https:\/\/steamcommunity.com\/linkfilter\/?url=http:\/\/www.gamesradar.com\/nier-automata-review\/" target="_blank" rel=" noopener"  >GamesRadar+<\/a><br><br>‚ÄúBold, ambitious, and surprising‚Äù<br>Recommended ‚Äì <a href="https:\/\/steamcommunity.com\/linkfilter\/?url=http:\/\/www.eurogamer.net\/articles\/2017-02-27-nier-automata-review" target="_blank" rel=" noopener"  >Eurogamer<\/a><br>',
            "header_image": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/header.jpg?t=1646911723",
            "website": "http:\/\/www.niergame.com\/",
            "pc_requirements": {
              "minimum":
                '<strong>Minimum:<\/strong><br><ul class="bb_ul"><li><strong>OS:<\/strong> Windows 7 \/8.1 \/10 64bit<br><\/li><li><strong>Processor:<\/strong> Intel Core i3 2100 or AMD A8-6500<br><\/li><li><strong>Memory:<\/strong> 4 GB RAM<br><\/li><li><strong>Graphics:<\/strong> NVIDIA GeForce GTX 770 VRAM 2GB or AMD Radeon R9 270X VRAM 2GB<br><\/li><li><strong>DirectX:<\/strong> Version 11<br><\/li><li><strong>Network:<\/strong> Broadband Internet connection<br><\/li><li><strong>Storage:<\/strong> 50 GB available space<br><\/li><li><strong>Sound Card:<\/strong> DirectX¬Æ 11 supported<br><\/li><li><strong>Additional Notes:<\/strong> Mouse, keyboard and game pad (XInput only). Screen resolution: 1280x720. This product only supports MS-IME keyboard input. There is a possibility that other IME will not function correctly with it.<\/li><\/ul>',
              "recommended":
                '<strong>Recommended:<\/strong><br><ul class="bb_ul"><li><strong>OS:<\/strong> Windows 8.1 \/10 64bit<br><\/li><li><strong>Processor:<\/strong> Intel Core i5 4670 or AMD A10-7850K<br><\/li><li><strong>Memory:<\/strong> 8 GB RAM<br><\/li><li><strong>Graphics:<\/strong> NVIDIA GeForce GTX 980 VRAM 4GB or AMD Radeon R9 380X VRAM 4GB<br><\/li><li><strong>DirectX:<\/strong> Version 11<br><\/li><li><strong>Network:<\/strong> Broadband Internet connection<br><\/li><li><strong>Storage:<\/strong> 50 GB available space<br><\/li><li><strong>Sound Card:<\/strong> DirectX¬Æ 11 supported<br><\/li><li><strong>Additional Notes:<\/strong> Mouse, keyboard and game pad (XInput only). Screen resolution: 1920x1080. Depending on the monitor and PC graphics card environment and setup used, this title can expand its display resolution to 4K. However, please be aware that 4K resolutions are not officially supported. This product only supports MS-IME keyboard input. There is a possibility that other IME will not function correctly with it.<\/li><\/ul>',
            },
            "mac_requirements": [],
            "linux_requirements": [],
            "legal_notice":
              "¬© 2017 SQUARE ENIX CO., LTD. All Rights Reserved. Developed by PlatinumGames Inc. Character Design by Akihiko Yoshida. NieR: Automata is a registered trademark or trademark of Square Enix Co., Ltd. SQUARE ENIX and the SQUARE ENIX logo are registered trademarks or trademarks of Square Enix Holdings Co., Ltd. All other marks are properties of their respective owners.",
            "developers": [
              "Square Enix",
              "PlatinumGames Inc.",
            ],
            "publishers": [
              "Square Enix",
            ],
            "price_overview": {
              "currency": "CAD",
              "initial": 5350,
              "final": 5350,
              "discount_percent": 0,
              "initial_formatted": "",
              "final_formatted": "CDN$ 53.50",
            },
            "packages": [
              339705,
            ],
            "package_groups": [
              {
                "name": "default",
                "title": "Buy NieR:Automata‚Ñ¢",
                "description": "",
                "selection_text": "Select a purchase option",
                "save_text": "",
                "display_type": 0,
                "is_recurring_subscription": "false",
                "subs": [
                  {
                    "packageid": 339705,
                    "percent_savings_text": " ",
                    "percent_savings": 0,
                    "option_text": "NieR:Automata‚Ñ¢ Game of the YoRHa Edition - CDN$ 53.50",
                    "option_description": "",
                    "can_get_free_license": "0",
                    "is_free_license": false,
                    "price_in_cents_with_discount": 5350,
                  },
                ],
              },
            ],
            "platforms": {
              "windows": true,
              "mac": false,
              "linux": false,
            },
            "metacritic": {
              "score": 84,
              "url": "https:\/\/www.metacritic.com\/game\/pc\/nier-automata?ftag=MCD-06-10aaa1f",
            },
            "categories": [
              {
                "id": 2,
                "description": "Single-player",
              },
              {
                "id": 22,
                "description": "Steam Achievements",
              },
              {
                "id": 29,
                "description": "Steam Trading Cards",
              },
              {
                "id": 18,
                "description": "Partial Controller Support",
              },
              {
                "id": 23,
                "description": "Steam Cloud",
              },
              {
                "id": 41,
                "description": "Remote Play on Phone",
              },
              {
                "id": 42,
                "description": "Remote Play on Tablet",
              },
            ],
            "genres": [
              {
                "id": "1",
                "description": "Action",
              },
              {
                "id": "3",
                "description": "RPG",
              },
            ],
            "screenshots": [
              {
                "id": 0,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_d0314b4c134329a483b5e43af951f60274abc66b.600x338.jpg?t=1646911723",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_d0314b4c134329a483b5e43af951f60274abc66b.1920x1080.jpg?t=1646911723",
              },
              {
                "id": 1,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_8b29f7e1ce9a8b9313dc3eb50dbe76a4cf94eef9.600x338.jpg?t=1646911723",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_8b29f7e1ce9a8b9313dc3eb50dbe76a4cf94eef9.1920x1080.jpg?t=1646911723",
              },
              {
                "id": 2,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_2c265df38c3d2d393d74ee8e74d79bdafa16b143.600x338.jpg?t=1646911723",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_2c265df38c3d2d393d74ee8e74d79bdafa16b143.1920x1080.jpg?t=1646911723",
              },
              {
                "id": 3,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_831e0e7c9d514393b711e9ed1d6796042521a80c.600x338.jpg?t=1646911723",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_831e0e7c9d514393b711e9ed1d6796042521a80c.1920x1080.jpg?t=1646911723",
              },
              {
                "id": 4,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_a6d164452c1aa00a0d7b7ca31aa76d787853b39e.600x338.jpg?t=1646911723",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_a6d164452c1aa00a0d7b7ca31aa76d787853b39e.1920x1080.jpg?t=1646911723",
              },
              {
                "id": 5,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_edcb7633ff42d7200bcb240a1ebb1116d602d9fe.600x338.jpg?t=1646911723",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_edcb7633ff42d7200bcb240a1ebb1116d602d9fe.1920x1080.jpg?t=1646911723",
              },
              {
                "id": 6,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_e926e3b5d440b4f244525745c7100edc2d717b85.600x338.jpg?t=1646911723",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_e926e3b5d440b4f244525745c7100edc2d717b85.1920x1080.jpg?t=1646911723",
              },
              {
                "id": 7,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_02d2f3f2b7b7add8e6ad50d6b9325d05fa1d7bc7.600x338.jpg?t=1646911723",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_02d2f3f2b7b7add8e6ad50d6b9325d05fa1d7bc7.1920x1080.jpg?t=1646911723",
              },
              {
                "id": 8,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_b55c67ac11781513183391c18ea86819e047577d.600x338.jpg?t=1646911723",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_b55c67ac11781513183391c18ea86819e047577d.1920x1080.jpg?t=1646911723",
              },
              {
                "id": 9,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_c538e630c5cc224124104cc42ec6220ab90b5852.600x338.jpg?t=1646911723",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/ss_c538e630c5cc224124104cc42ec6220ab90b5852.1920x1080.jpg?t=1646911723",
              },
            ],
            "movies": [
              {
                "id": 256744000,
                "name": "ESRB EN Nier GOTY",
                "thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256744000\/movie.293x165.jpg?t=1551200572",
                "webm": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256744000\/movie480.webm?t=1551200572",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256744000\/movie_max.webm?t=1551200572",
                },
                "mp4": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256744000\/movie480.mp4?t=1551200572",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256744000\/movie_max.mp4?t=1551200572",
                },
                "highlight": true,
              },
              {
                "id": 256681401,
                "name": "Nier Pre-Launch ESRB EN",
                "thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256681401\/movie.293x165.jpg?t=1489664283",
                "webm": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256681401\/movie480.webm?t=1489664283",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256681401\/movie_max.webm?t=1489664283",
                },
                "mp4": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256681401\/movie480.mp4?t=1489664283",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256681401\/movie_max.mp4?t=1489664283",
                },
                "highlight": true,
              },
              {
                "id": 256680536,
                "name": "Nier Attract Trailer Unrated EN",
                "thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256680536\/movie.293x165.jpg?t=1493741191",
                "webm": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256680536\/movie480.webm?t=1493741191",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256680536\/movie_max.webm?t=1493741191",
                },
                "mp4": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256680536\/movie480.mp4?t=1493741191",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256680536\/movie_max.mp4?t=1493741191",
                },
                "highlight": true,
              },
            ],
            "recommendations": {
              "total": 80839,
            },
            "achievements": {
              "total": 47,
              "highlighted": [
                {
                  "name": "Resuscitated Body",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/524220\/3396a4732f6c521900195182eadc9c523988e271.jpg",
                },
                {
                  "name": "Vestiges of Prosperity",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/524220\/a68518be86868a69b68d64b9720d65a33068713f.jpg",
                },
                {
                  "name": "It's a Healthy Baby Boy!",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/524220\/9c038749e650134ddbe142a76c7a920e98947a82.jpg",
                },
                {
                  "name": "We Await Your Next Visit",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/524220\/e028dca2f5773e58e6a36c0bbb5e3dfc4de1806a.jpg",
                },
                {
                  "name": "Creation and Insurrection",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/524220\/52cadba291448ae488147c0a31e9ffddd64adab7.jpg",
                },
                {
                  "name": "The Mechanical Kingdom",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/524220\/f57deb02acdf63c9cf9adc21abb5a3158db77cfa.jpg",
                },
                {
                  "name": "Ruler of the Deep",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/524220\/6af7569b29b4f6f2b62f4a8d4b3be6f25183e8da.jpg",
                },
                {
                  "name": "Those Who Love Humans",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/524220\/ef85393debcb1c87e0f48f50b8afd89305d65c73.jpg",
                },
                {
                  "name": "Iron Soul",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/524220\/80808a96458c14f827bb66a12c1ef0a5c877b9d4.jpg",
                },
                {
                  "name": "One Battle Ends",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/524220\/5172a623c717e83a83c41b52f52e9b39077f0289.jpg",
                },
              ],
            },
            "release_date": {
              "coming_soon": false,
              "date": "17 Mar, 2017",
            },
            "support_info": {
              "url": "http:\/\/sqex.to\/steamsupport",
              "email": "",
            },
            "background": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/page_bg_generated_v6b.jpg?t=1646911723",
            "background_raw": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/524220\/page.bg.jpg?t=1646911723",
            "content_descriptors": {
              "ids": [],
              "notes": null,
            },
          },
        },
        "1113560": {
          "success": true,
          "data": {
            "type": "game",
            "name": "NieR Replicant‚Ñ¢ ver.1.22474487139...",
            "steam_appid": 1113560,
            "required_age": "17",
            "is_free": false,
            "dlc": [
              1408390,
            ],
            "detailed_description":
              '<h1>Reviews &amp; Accolades<\/h1><p><img src="https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/extras\/SNOW_Accolades_Banner_616x600_Steam_in-text_banner.jpg?t=1673963725" \/><\/p><br><h1>4 YoRHa<\/h1><p><img src="https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/extras\/SNOW_steamautomata_intextEN.jpg?t=1673963725" \/><br>4 YoRHa is a free downloadable content. <br>Enjoy 4 costumes and 4 weapons from NieR:Automata in NieR Replicant ver.1.22474487139....<br><br>*Due to the story of the game, this content may not be playable during some scenes.<br>*The full game (sold separately) is required to use this content. Also, if the latest patch needs to be applied, please update before use.<\/p><br><h1>About the Game<\/h1><img src="https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/extras\/Steam_Overview_Banner_new.png?t=1673963725" \/><br>A thousand-year lie that would live on for eternity...<br><br>NieR Replicant ver.1.22474487139... is an updated version of NieR Replicant, previously only released in Japan.<br><br>Discover the one-of-a-kind prequel to the critically-acclaimed masterpiece NieR:Automata. Now with a modern upgrade, experience masterfully revived visuals, a fascinating storyline and more! <br><br>The protagonist is a kind young man living in a remote village. In order to save his sister Yonah, who fell terminally ill to the Black Scrawl, he sets out with Grimoire Weiss, a strange talking tome, to search for the &quot;Sealed verses.&quot;<br><br>Experience the NieR Replicant story for the first time in the west through the eyes of the protagonist as a brother. <br><br>The original all-star team returns including acclaimed director, YOKO TARO (Drakengard \/ NieR:Automata), composer Keiichi Okabe (TEKKEN \/ Drakengard \/ NieR:Automata), and producer Yosuke Saito (DRAGON QUEST X \/ NieR:Automata).<br><br><br><img src="https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/extras\/Steam_Story_Banner_new.png?t=1673963725" \/><br>In a distant, distant future, humanity is on the brink of extinction.<br>A black scrawl disease and strange beasts threaten the world. <br>A young kindhearted boy makes a promise to his little sister.<br>A thousand-year lie that would live on for eternity...<br><br><br><img src="https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/extras\/Steam_Features_Banner_new.png?t=1673963725" \/><br><ul class="bb_ul"><li>Uncover the truth behind the world of NieR and prepare to question everything in this dark, twisting tale.<br><\/li><li>Journey alongside an unlikely group of allies through a ruined world, plagued by sickness and monstrous horrors.<br><\/li><li>A mesmerizing iconic soundtrack, newly recorded by NieR:Automata composer, Keiichi Okabe.<br><\/li><li>Fight back dreadful enemies with a visceral, uniquely customizable blend of swordplay and powerful magic.<br><\/li><li>Customize your character\'s magic, skills, and weapons with the power of Words.  <\/li><\/ul>',
            "about_the_game":
              '<img src="https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/extras\/Steam_Overview_Banner_new.png?t=1673963725" \/><br>A thousand-year lie that would live on for eternity...<br><br>NieR Replicant ver.1.22474487139... is an updated version of NieR Replicant, previously only released in Japan.<br><br>Discover the one-of-a-kind prequel to the critically-acclaimed masterpiece NieR:Automata. Now with a modern upgrade, experience masterfully revived visuals, a fascinating storyline and more! <br><br>The protagonist is a kind young man living in a remote village. In order to save his sister Yonah, who fell terminally ill to the Black Scrawl, he sets out with Grimoire Weiss, a strange talking tome, to search for the &quot;Sealed verses.&quot;<br><br>Experience the NieR Replicant story for the first time in the west through the eyes of the protagonist as a brother. <br><br>The original all-star team returns including acclaimed director, YOKO TARO (Drakengard \/ NieR:Automata), composer Keiichi Okabe (TEKKEN \/ Drakengard \/ NieR:Automata), and producer Yosuke Saito (DRAGON QUEST X \/ NieR:Automata).<br><br><br><img src="https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/extras\/Steam_Story_Banner_new.png?t=1673963725" \/><br>In a distant, distant future, humanity is on the brink of extinction.<br>A black scrawl disease and strange beasts threaten the world. <br>A young kindhearted boy makes a promise to his little sister.<br>A thousand-year lie that would live on for eternity...<br><br><br><img src="https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/extras\/Steam_Features_Banner_new.png?t=1673963725" \/><br><ul class="bb_ul"><li>Uncover the truth behind the world of NieR and prepare to question everything in this dark, twisting tale.<br><\/li><li>Journey alongside an unlikely group of allies through a ruined world, plagued by sickness and monstrous horrors.<br><\/li><li>A mesmerizing iconic soundtrack, newly recorded by NieR:Automata composer, Keiichi Okabe.<br><\/li><li>Fight back dreadful enemies with a visceral, uniquely customizable blend of swordplay and powerful magic.<br><\/li><li>Customize your character\'s magic, skills, and weapons with the power of Words.  <\/li><\/ul>',
            "short_description": "The upgraded prequel of NieR:Automata. A kind young man sets out with Grimoire Weiss, a strange talking book, to search for the &quot;Sealed verses&quot; in order to save his sister Yonah, who fell terminally ill to the Black Scrawl.",
            "supported_languages": "English<strong>*<\/strong>, French, Italian, German, Spanish - Spain, Japanese<strong>*<\/strong>, Korean, Simplified Chinese, Traditional Chinese<br><strong>*<\/strong>languages with full audio support",
            "reviews":
              '‚ÄúLives up to the hype‚Äù<br>4.5\/5 ‚Äì <a href="https:\/\/steamcommunity.com\/linkfilter\/?url=https:\/\/www.windowscentral.com\/nier-replicant-review" target="_blank" rel=" noopener"  >Windows Central<\/a><br><br>‚ÄúIncredible, refined version‚Äù<br>5\/5 ‚Äì <a href="https:\/\/steamcommunity.com\/linkfilter\/?url=https:\/\/www.thegamer.com\/nier-replicant-remake-review\/" target="_blank" rel=" noopener"  >https:\/\/www.thegamer.com\/nier-replicant-remake-review\/<\/a><br><br>‚ÄúAmbitious, fascinating game‚Äù<br>10\/10 ‚Äì <a href="https:\/\/steamcommunity.com\/linkfilter\/?url=https:\/\/www.gamingbible.co.uk\/reviews\/games-nier-replicant-ver122474487139-review-a-replayable-masterpiece-20210422?source=twitter" target="_blank" rel=" noopener"  >GAMINGbible<\/a><br>',
            "header_image": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/header.jpg?t=1673963725",
            "website": "https:\/\/nier.square-enix-games.com\/",
            "pc_requirements": {
              "minimum":
                '<strong>Minimum:<\/strong><br><ul class="bb_ul"><li>Requires a 64-bit processor and operating system<br><\/li><li><strong>OS:<\/strong> Windows¬Æ 10 64-bit<br><\/li><li><strong>Processor:<\/strong> AMD Ryzen‚Ñ¢ 3 1300X; Intel¬Æ Core‚Ñ¢ i5-6400<br><\/li><li><strong>Memory:<\/strong> 8 GB RAM<br><\/li><li><strong>Graphics:<\/strong> AMD Radeon‚Ñ¢ R9 270X; NVIDIA¬Æ GeForce¬Æ GTX 960<br><\/li><li><strong>DirectX:<\/strong> Version 11<br><\/li><li><strong>Storage:<\/strong> 26 GB available space<br><\/li><li><strong>Sound Card:<\/strong> DirectX Compatible Sound Card<br><\/li><li><strong>Additional Notes:<\/strong> 60 FPS @ 1280x720<\/li><\/ul>',
              "recommended":
                '<strong>Recommended:<\/strong><br><ul class="bb_ul"><li>Requires a 64-bit processor and operating system<br><\/li><li><strong>OS:<\/strong> Windows¬Æ 10 64-bit<br><\/li><li><strong>Processor:<\/strong> AMD Ryzen‚Ñ¢ 3 1300X; Intel¬Æ Core‚Ñ¢ i5-6400<br><\/li><li><strong>Memory:<\/strong> 16 GB RAM<br><\/li><li><strong>Graphics:<\/strong> AMD Radeon‚Ñ¢ RX Vega 56; NVIDIA¬Æ GeForce¬Æ GTX 1660<br><\/li><li><strong>DirectX:<\/strong> Version 11<br><\/li><li><strong>Storage:<\/strong> 26 GB available space<br><\/li><li><strong>Sound Card:<\/strong> DirectX Compatible Sound Card<br><\/li><li><strong>Additional Notes:<\/strong> 60 FPS @ 1920x1080<\/li><\/ul>',
            },
            "mac_requirements": {
              "minimum": '<strong>Minimum:<\/strong><br><ul class="bb_ul"><li>Requires a 64-bit processor and operating system<\/li><\/ul>',
              "recommended": '<strong>Recommended:<\/strong><br><ul class="bb_ul"><li>Requires a 64-bit processor and operating system<\/li><\/ul>',
            },
            "linux_requirements": {
              "minimum": '<strong>Minimum:<\/strong><br><ul class="bb_ul"><li>Requires a 64-bit processor and operating system<\/li><\/ul>',
              "recommended": '<strong>Recommended:<\/strong><br><ul class="bb_ul"><li>Requires a 64-bit processor and operating system<\/li><\/ul>',
            },
            "legal_notice": "¬© 2010 SQUARE ENIX CO., LTD. All Rights Reserved. Developed by Toylogic Inc. <br \/>\r\nNIER REPLICANT is a registered trademark or trademark of Square Enix Co., Ltd. SQUARE ENIX and the SQUARE ENIX logo are registered trademarks or trademarks of Square Enix Holdings Co., Ltd.",
            "developers": [
              "Square Enix",
              "Toylogic Inc.",
            ],
            "publishers": [
              "Square Enix",
            ],
            "price_overview": {
              "currency": "CAD",
              "initial": 7999,
              "final": 7999,
              "discount_percent": 0,
              "initial_formatted": "",
              "final_formatted": "CDN$ 79.99",
            },
            "packages": [
              502733,
            ],
            "package_groups": [
              {
                "name": "default",
                "title": "Buy NieR Replicant‚Ñ¢ ver.1.22474487139...",
                "description": "",
                "selection_text": "Select a purchase option",
                "save_text": "",
                "display_type": 0,
                "is_recurring_subscription": "false",
                "subs": [
                  {
                    "packageid": 502733,
                    "percent_savings_text": " ",
                    "percent_savings": 0,
                    "option_text": "NieR Replicant ver.1.22474487139 - CDN$ 79.99",
                    "option_description": "",
                    "can_get_free_license": "0",
                    "is_free_license": false,
                    "price_in_cents_with_discount": 7999,
                  },
                ],
              },
            ],
            "platforms": {
              "windows": true,
              "mac": false,
              "linux": false,
            },
            "categories": [
              {
                "id": 2,
                "description": "Single-player",
              },
              {
                "id": 22,
                "description": "Steam Achievements",
              },
              {
                "id": 29,
                "description": "Steam Trading Cards",
              },
              {
                "id": 18,
                "description": "Partial Controller Support",
              },
              {
                "id": 23,
                "description": "Steam Cloud",
              },
            ],
            "genres": [
              {
                "id": "1",
                "description": "Action",
              },
              {
                "id": "25",
                "description": "Adventure",
              },
              {
                "id": "3",
                "description": "RPG",
              },
            ],
            "screenshots": [
              {
                "id": 0,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_2ff3ddb26c30b8397bce45abd0b4d847c3457259.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_2ff3ddb26c30b8397bce45abd0b4d847c3457259.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 1,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_f33bdbe53fa2d75e429f9b35a1299109c9ab8991.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_f33bdbe53fa2d75e429f9b35a1299109c9ab8991.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 2,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_b7867dae1f1fa62a2cc82165c8c79eb6821782d6.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_b7867dae1f1fa62a2cc82165c8c79eb6821782d6.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 3,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_8d7a5e5a0a7fe7782bf238763a2e29f8f6419e84.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_8d7a5e5a0a7fe7782bf238763a2e29f8f6419e84.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 4,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_f7689ef6964eee2407d9e996bc73b380e3e7a56a.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_f7689ef6964eee2407d9e996bc73b380e3e7a56a.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 5,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_6740ec558094fafc86f0933264e50e796c21e9cf.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_6740ec558094fafc86f0933264e50e796c21e9cf.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 6,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_eb6b583db6d9b3051c131ba748c768b2d6226277.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_eb6b583db6d9b3051c131ba748c768b2d6226277.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 7,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_c93af51b782d72cf081d4e8451836ad1716f63be.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_c93af51b782d72cf081d4e8451836ad1716f63be.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 8,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_56ecf25d6d95441a23f5481f895771c2dcb9ac18.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_56ecf25d6d95441a23f5481f895771c2dcb9ac18.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 9,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_a2c004272402bf76b70ed13c920fbd3c85d43d94.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_a2c004272402bf76b70ed13c920fbd3c85d43d94.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 10,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_0621ab7f10a0b23f4124509a13a8ace0487d856a.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_0621ab7f10a0b23f4124509a13a8ace0487d856a.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 11,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_ada29940be1bdb0e8b70e64788044f4c2592657f.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_ada29940be1bdb0e8b70e64788044f4c2592657f.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 12,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_1c972f496956e106c3b9023c68ff309fd649407e.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_1c972f496956e106c3b9023c68ff309fd649407e.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 13,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_344cfa42952beb6d51540d43bdfcbeaa0949c9a7.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_344cfa42952beb6d51540d43bdfcbeaa0949c9a7.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 14,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_2a5576351e2f84518dec11a796fbff609f4e5b9f.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_2a5576351e2f84518dec11a796fbff609f4e5b9f.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 15,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_071609b98112f7621067dd5275ce0ead665f13f2.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_071609b98112f7621067dd5275ce0ead665f13f2.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 16,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_b3a1dfdbb9d4a47b6407de5c8b1dc75ddfcea931.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_b3a1dfdbb9d4a47b6407de5c8b1dc75ddfcea931.1920x1080.jpg?t=1673963725",
              },
              {
                "id": 17,
                "path_thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_942e62e6f1bf312148a7480f943babe2325a3714.600x338.jpg?t=1673963725",
                "path_full": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/ss_942e62e6f1bf312148a7480f943babe2325a3714.1920x1080.jpg?t=1673963725",
              },
            ],
            "movies": [
              {
                "id": 256831765,
                "name": "ESRB EN Launch NierRep",
                "thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256831765\/movie.293x165.jpg?t=1619194859",
                "webm": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256831765\/movie480_vp9.webm?t=1619194859",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256831765\/movie_max_vp9.webm?t=1619194859",
                },
                "mp4": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256831765\/movie480.mp4?t=1619194859",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256831765\/movie_max.mp4?t=1619194859",
                },
                "highlight": true,
              },
              {
                "id": 256831398,
                "name": "PEGI FR Gestalt NierRep",
                "thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256831398\/movie.293x165.jpg?t=1619194237",
                "webm": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256831398\/movie480_vp9.webm?t=1619194237",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256831398\/movie_max_vp9.webm?t=1619194237",
                },
                "mp4": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256831398\/movie480.mp4?t=1619194237",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256831398\/movie_max.mp4?t=1619194237",
                },
                "highlight": true,
              },
              {
                "id": 256831395,
                "name": "ESRB EN Extra content NierRep",
                "thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256831395\/movie.293x165.jpg?t=1619194332",
                "webm": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256831395\/movie480_vp9.webm?t=1619194332",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256831395\/movie_max_vp9.webm?t=1619194332",
                },
                "mp4": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256831395\/movie480.mp4?t=1619194332",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256831395\/movie_max.mp4?t=1619194332",
                },
                "highlight": true,
              },
              {
                "id": 256827494,
                "name": "ESRB EN OpeningCinematic NierRep",
                "thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256827494\/movie.293x165.jpg?t=1616752558",
                "webm": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256827494\/movie480_vp9.webm?t=1616752558",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256827494\/movie_max_vp9.webm?t=1616752558",
                },
                "mp4": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256827494\/movie480.mp4?t=1616752558",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256827494\/movie_max.mp4?t=1616752558",
                },
                "highlight": true,
              },
              {
                "id": 256813164,
                "name": "ESRB EN TGA 2020 NierRep",
                "thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256813164\/movie.293x165.jpg?t=1607687616",
                "webm": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256813164\/movie480_vp9.webm?t=1607687616",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256813164\/movie_max_vp9.webm?t=1607687616",
                },
                "mp4": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256813164\/movie480.mp4?t=1607687616",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256813164\/movie_max.mp4?t=1607687616",
                },
                "highlight": true,
              },
              {
                "id": 256802321,
                "name": "ESRB EN TGS NierRep",
                "thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256802321\/movie.293x165.jpg?t=1600963175",
                "webm": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256802321\/movie480_vp9.webm?t=1600963175",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256802321\/movie_max_vp9.webm?t=1600963175",
                },
                "mp4": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256802321\/movie480.mp4?t=1600963175",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256802321\/movie_max.mp4?t=1600963175",
                },
                "highlight": true,
              },
              {
                "id": 256782057,
                "name": "ESRB EN - Teaser",
                "thumbnail": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256782057\/movie.293x165.jpg?t=1600964179",
                "webm": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256782057\/movie480_vp9.webm?t=1600964179",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256782057\/movie_max_vp9.webm?t=1600964179",
                },
                "mp4": {
                  "480": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256782057\/movie480.mp4?t=1600964179",
                  "max": "http:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/256782057\/movie_max.mp4?t=1600964179",
                },
                "highlight": true,
              },
            ],
            "recommendations": {
              "total": 15065,
            },
            "achievements": {
              "total": 47,
              "highlighted": [
                {
                  "name": "The Final Verse",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/1113560\/a9369e5eddeb1486ffd849aa3820607353ddbc23.jpg",
                },
                {
                  "name": "The Book of Legend",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/1113560\/6d11bfa34275061352048988a9202c3194259851.jpg",
                },
                {
                  "name": "The Wild Companion",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/1113560\/8ac7d0d717ccda449162f94f81054073e9679fc5.jpg",
                },
                {
                  "name": "The Mellow Companion",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/1113560\/1981aa8fe7fb43d11720331503fa3c9028f0e18a.jpg",
                },
                {
                  "name": "Release",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/1113560\/88d76547290c9c200536cbb1a48d255303010a5b.jpg",
                },
                {
                  "name": "Gratitude",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/1113560\/d9b8fd4cc2e4fc270edf18b177729b07e8a32cc9.jpg",
                },
                {
                  "name": "Key Collector",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/1113560\/6629579d96114c2a268898911634495f8235ce08.jpg",
                },
                {
                  "name": "A World in Flux",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/1113560\/4b3b4bcf8267f93bb73600cc688323c2c910e0b5.jpg",
                },
                {
                  "name": "Combo Fanatic",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/1113560\/d19d83d2254a60554435a1e1d99896e96bdf64d5.jpg",
                },
                {
                  "name": "Combo Master",
                  "path": "https:\/\/cdn.akamai.steamstatic.com\/steamcommunity\/public\/images\/apps\/1113560\/d62e08ce00fd14c0fb72acebdfb09c838803a102.jpg",
                },
              ],
            },
            "release_date": {
              "coming_soon": false,
              "date": "23 Apr, 2021",
            },
            "support_info": {
              "url": "https:\/\/support.square-enix-games.com\/",
              "email": "",
            },
            "background": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/page_bg_generated_v6b.jpg?t=1673963725",
            "background_raw": "https:\/\/cdn.akamai.steamstatic.com\/steam\/apps\/1113560\/page.bg.jpg?t=1673963725",
            "content_descriptors": {
              "ids": [
                2,
                5,
              ],
              "notes": "NieR Replicant ver.1.22474487139‚Ä¶ contains adult scenes and theme, strong language in certain areas of the game, including blood, violence, criminal acts and killing. ",
            },
          },
        },
      },
    })
  }

  //Steam api
  if (/^https:..api.steampowered.com.*$/.test(url)) {
    //Owned games
    if (/^.*IPlayerService.GetOwnedGames.v0001.*$/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking steam api result > ${url}`)
      return ({
        status: 200,
        data: {
          "response": {
            "game_count": 2,
            "games": [
              {
                "appid": 524220,
                "name": "NieR:Automata‚Ñ¢",
                "playtime_forever": 2693,
                "img_icon_url": "ec431ecb2a5178c5a01bb15550f112f93af029bb",
                "has_community_visible_stats": true,
                "playtime_windows_forever": 3,
                "playtime_mac_forever": 0,
                "playtime_linux_forever": 0,
                "rtime_last_played": 1582407120,
              },
              {
                "appid": 1113560,
                "name": "NieR Replicant ver.1.22474487139...",
                "playtime_forever": 2661,
                "img_icon_url": "8ca16d03995179d1ba3a2263e03db170100c6382",
                "has_community_visible_stats": true,
                "playtime_windows_forever": 2661,
                "playtime_mac_forever": 0,
                "playtime_linux_forever": 0,
                "rtime_last_played": 1625611102,
                "content_descriptorids": [
                  2,
                  5,
                ],
              },
            ],
          },
        },
      })
    }
    //Game schema
    if (/^.*ISteamUserStats.GetSchemaForGame.v0002.*$/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking steam api result > ${url}`)
      return ({
        status: 200,
        data: /appid=524220/.test(url)
          ? {
            "game": {
              "gameName": "TRAIN",
              "gameVersion": "14",
              "availableGameStats": {
                "achievements": [
                  {
                    "name": "ACH_VISITED_BUNKER",
                    "defaultvalue": 0,
                    "displayName": "Resuscitated Body",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/3396a4732f6c521900195182eadc9c523988e271.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_VISITED_RUINS_CITY",
                    "defaultvalue": 0,
                    "displayName": "Vestiges of Prosperity",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/a68518be86868a69b68d64b9720d65a33068713f.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_CLEAR_DESERT_AREA",
                    "defaultvalue": 0,
                    "displayName": "It's a Healthy Baby Boy!",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/9c038749e650134ddbe142a76c7a920e98947a82.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_CLEAR_AMUSEMENT_PARK",
                    "defaultvalue": 0,
                    "displayName": "We Await Your Next Visit",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/e028dca2f5773e58e6a36c0bbb5e3dfc4de1806a.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_CLEAR_ALIEN_SHIP",
                    "defaultvalue": 0,
                    "displayName": "Creation and Insurrection",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/52cadba291448ae488147c0a31e9ffddd64adab7.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_CLEAR_CASTLE_FOREST",
                    "defaultvalue": 0,
                    "displayName": "The Mechanical Kingdom",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/f57deb02acdf63c9cf9adc21abb5a3158db77cfa.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_CLEAR_SUBMERGE_CITY",
                    "defaultvalue": 0,
                    "displayName": "Ruler of the Deep",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/6af7569b29b4f6f2b62f4a8d4b3be6f25183e8da.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_CLEAR_COPY_CITY",
                    "defaultvalue": 0,
                    "displayName": "Those Who Love Humans",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/ef85393debcb1c87e0f48f50b8afd89305d65c73.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_CLEAR_ROBOT_MT",
                    "defaultvalue": 0,
                    "displayName": "Iron Soul",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/80808a96458c14f827bb66a12c1ef0a5c877b9d4.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_CLEAR_A",
                    "defaultvalue": 0,
                    "displayName": "One Battle Ends",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5172a623c717e83a83c41b52f52e9b39077f0289.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_CLEAR_B",
                    "defaultvalue": 0,
                    "displayName": "A New Battle Begins",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/91df4ff96e60f0f0434afd1105c82a59dddb20a9.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_SEE_2B_DIE",
                    "defaultvalue": 0,
                    "displayName": "Final Wish",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/9337b450a269e175ac5c96606237f7b5cedf52e4.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_PLAY_A2_FIRST_TIME",
                    "defaultvalue": 0,
                    "displayName": "Treacherous Blade",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/f8bbe8253972c94d1692dcc3733e98f37c0fd92e.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_LAST_REQUEST_PASCAL",
                    "defaultvalue": 0,
                    "displayName": "Farewell, Pascal",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/392b60acb70e7d048edbd4de5cfb5bb39ccc524c.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_KILL_ROBOT_BROTHER",
                    "defaultvalue": 0,
                    "displayName": "Justice",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/c81d259248687088bc59cdb50a668434bbb1e246.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_DEVOLA_NOVEL_END",
                    "defaultvalue": 0,
                    "displayName": "Crime and Punishment",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/9eb6d496221f65495a09764d3ae1ec453f12208f.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_CLEAR_9S",
                    "defaultvalue": 0,
                    "displayName": "Leaving for the New World",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/f92c92e085c3d6edec542f25b3561d8eb810c5d7.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_CLEAR_A2",
                    "defaultvalue": 0,
                    "displayName": "Beautiful World",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/c36712e0b97b65ee1ecb027db8e3ff8798d3bb55.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_TRUE_END",
                    "defaultvalue": 0,
                    "displayName": "The Minds That Emerged",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/2989eb6c7f2918ecfc7c756e401a271c17157c74.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_RECOVERY_SELF_CORPSE",
                    "defaultvalue": 0,
                    "displayName": "The Circle of Death",
                    "hidden": 0,
                    "description": "Have your body collected.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/076ec7fa27bb95797b07da45c3b65af5c3a447a9.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_RECOVERY_CORPSE",
                    "defaultvalue": 0,
                    "displayName": "Cherish Our Resources",
                    "hidden": 0,
                    "description": "Have 100 bodies collected.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/1940860e6bd542954652853f5fbbe8bcd58fbac4.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_CLEAR_QUEST_FIRST_TIME",
                    "defaultvalue": 0,
                    "displayName": "First Errand",
                    "hidden": 0,
                    "description": "Complete your first quest.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/f31eb13d16a028fb3de23f5623955b8441e57c7c.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_CLEAR_MANY_QUEST",
                    "defaultvalue": 0,
                    "displayName": "The Mercenary",
                    "hidden": 0,
                    "description": "80% of all quests completed.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/bbdd00f461406cbf64726d753dac5f3abe066ef8.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_COLLECT_ARCHIVE",
                    "defaultvalue": 0,
                    "displayName": "Information Master",
                    "hidden": 0,
                    "description": "80% of all archives found.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/8d536964d4eabac2027adfc2705661fea25ede6b.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_COLLECT_EM_LIST",
                    "defaultvalue": 0,
                    "displayName": "Destruction is My Job",
                    "hidden": 0,
                    "description": "80% of all unit data unlocked.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/8048ddee99c03defd4562520d28bc4445938bda0.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_COLLECT_CHIP",
                    "defaultvalue": 0,
                    "displayName": "Chip Collector",
                    "hidden": 0,
                    "description": "80% of all plug-in chips collected.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/c8600b37d39a3d09ba4730a480d4ea5c87790a22.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_HAS_ALL_ACTIVE_SKILL",
                    "defaultvalue": 0,
                    "displayName": "Weapons Maniac",
                    "hidden": 0,
                    "description": "All Pod programs obtained.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/bd78a999e5b0eea50d60e7e1158a93a58d82a517.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_WEAPON_LV_MAX",
                    "defaultvalue": 0,
                    "displayName": "Tools of the Trade",
                    "hidden": 0,
                    "description": "Any weapon upgraded to the highest level.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/6bd93e150b03f8de3c857e3589a4e92eed0b03cc.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_WEAPON_LV_MAX_ALL",
                    "defaultvalue": 0,
                    "displayName": "Inorganic Blade",
                    "hidden": 0,
                    "description": "All weapons upgraded to the highest level.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/54bf4e0bef1e06348ccc291d1e87d49ce58e63db.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_POD_LV_MAX_ALL",
                    "defaultvalue": 0,
                    "displayName": "Supreme Support Weapons",
                    "hidden": 0,
                    "description": "All Pods upgraded to the highest level.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/254d29f9ddf775427dec4ea2e2456ee32100f0bc.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_CLEAR_HACKING_9S",
                    "defaultvalue": 0,
                    "displayName": "Fighting's Not My Thing",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/aa7810edbe2376ebe0456f553bd3d33a139bd539.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_HACKING_KILL",
                    "defaultvalue": 0,
                    "displayName": "A Scanner's Power",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/a8077834157c6407d5855157d0a902f5415edf07.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_REMOTO_KILL",
                    "defaultvalue": 0,
                    "displayName": "Machines vs. Machines",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/ac4bc0d5ea71c94f14b5b6d18c7aee30804fff55.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_BERSERKER_KILL",
                    "defaultvalue": 0,
                    "displayName": "The Power of Hate",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/ca0c9026a53cc307519c09b43b198823bd4a28b5.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_SHOOTING",
                    "defaultvalue": 0,
                    "displayName": "Ruler of the Skies",
                    "hidden": 0,
                    "description": "255 enemies destroyed using a flight unit.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/ed342c90ae36c5655e9e5ff2bef89162a5af8f62.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_EXTRACTION",
                    "defaultvalue": 0,
                    "displayName": "Harvest King",
                    "hidden": 0,
                    "description": "Materials gathered at a hidden harvest point 10 times.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/7434e8cf28fa79d62acf02c37359155c42223bef.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_GET_ALL_POD",
                    "defaultvalue": 0,
                    "displayName": "Pod Hunter",
                    "hidden": 0,
                    "description": "All Pods found.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/1f40b92b07294e7c25ef3b1d19dfb14f452e662c.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_RICH_MAN",
                    "defaultvalue": 0,
                    "displayName": "Desire Without Emotion",
                    "hidden": 0,
                    "description": "At least 100,000 G in possession.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/e899966832c71f405fc33a0e0302212efc66ee5a.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_ANIMAL_RUN",
                    "defaultvalue": 0,
                    "displayName": "Animal Rider",
                    "hidden": 0,
                    "description": "Any animal ridden for 5 kilometers.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/6985b5f0ff4c7b03aa8e652015e548d72198c575.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_FISHING",
                    "defaultvalue": 0,
                    "displayName": "A Round by the Pond",
                    "hidden": 0,
                    "description": "20 different kinds of fish caught.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/08f09efe530ca0dc577b3808a7d7a94a936df655.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_NPC_KILL",
                    "defaultvalue": 0,
                    "displayName": "Wait! Don't Kill Me!",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/41b7f8c6625f9a566c625b49f1c6cc8314202aad.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_SKIRT_ESCAPE",
                    "defaultvalue": 0,
                    "displayName": "What Are You Doing?",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/bf5e3ee4db9b1cd77223e1f30657325fda93b9f2.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_PANTS",
                    "defaultvalue": 0,
                    "displayName": "Not That I Mind...",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/31aef58a56f5e92d65437f17718c3dd01c54cf56.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_EMILE_SHOP",
                    "defaultvalue": 0,
                    "displayName": "Come Take a Look!",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/99f6388ed11b885d386eb979a2a8736290a4a235.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_KILL_EM1010",
                    "defaultvalue": 0,
                    "displayName": "Naughty Children",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/6e29e9ce653df1b4f4e51778df371f40851e409c.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_BAD_END",
                    "defaultvalue": 0,
                    "displayName": "Transcendent Being",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5649159a9e23e6f490360e0de38dd65da1fa9fdb.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                  {
                    "name": "ACH_CALL_AT_KAINES_ROOM",
                    "defaultvalue": 0,
                    "displayName": "Lunar Tear",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/6b6e361e2917f8996a39b977b8df7a8fc640729d.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/524220/5cad263135d7f42d3304918370f492b353aa46f3.jpg",
                  },
                ],
              },
            },
          }
          : {
            "game": {
              "gameName": "",
              "gameVersion": "30",
              "availableGameStats": {
                "achievements": [
                  {
                    "name": "ACHIEVEMENT_0000",
                    "defaultvalue": 0,
                    "displayName": "The Final Verse",
                    "hidden": 0,
                    "description": "Congratulations! Thank you for playing!",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/a9369e5eddeb1486ffd849aa3820607353ddbc23.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0010",
                    "defaultvalue": 0,
                    "displayName": "The Book of Legend",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/6d11bfa34275061352048988a9202c3194259851.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0020",
                    "defaultvalue": 0,
                    "displayName": "The Wild Companion",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/8ac7d0d717ccda449162f94f81054073e9679fc5.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0030",
                    "defaultvalue": 0,
                    "displayName": "The Mellow Companion",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/1981aa8fe7fb43d11720331503fa3c9028f0e18a.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0040",
                    "defaultvalue": 0,
                    "displayName": "Release",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/88d76547290c9c200536cbb1a48d255303010a5b.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0050",
                    "defaultvalue": 0,
                    "displayName": "Gratitude",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/d9b8fd4cc2e4fc270edf18b177729b07e8a32cc9.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0060",
                    "defaultvalue": 0,
                    "displayName": "Key Collector",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/6629579d96114c2a268898911634495f8235ce08.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0070",
                    "defaultvalue": 0,
                    "displayName": "A World in Flux",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/4b3b4bcf8267f93bb73600cc688323c2c910e0b5.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0080",
                    "defaultvalue": 0,
                    "displayName": "Combo Fanatic",
                    "hidden": 0,
                    "description": "You pulled off a 50-hit combo.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/d19d83d2254a60554435a1e1d99896e96bdf64d5.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0090",
                    "defaultvalue": 0,
                    "displayName": "Combo Master",
                    "hidden": 0,
                    "description": "You pulled off a 100-hit combo.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/d62e08ce00fd14c0fb72acebdfb09c838803a102.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0100",
                    "defaultvalue": 0,
                    "displayName": "The Magic Man",
                    "hidden": 0,
                    "description": "You learned every type of magic.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/2d7124c94623283b25cd1889cc6599d23b8cab5c.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0110",
                    "defaultvalue": 0,
                    "displayName": "Wordsmith",
                    "hidden": 0,
                    "description": "You collected 50 percent of all words.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/8a8b550048c266f8132d1d6c36967f2dee42a0ec.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0120",
                    "defaultvalue": 0,
                    "displayName": "Weapons Collector",
                    "hidden": 0,
                    "description": "You found every weapon.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/36b528043b6af91f11116aeed684d950722f1d60.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0130",
                    "defaultvalue": 0,
                    "displayName": "Village Handyman",
                    "hidden": 0,
                    "description": "You completed 10 quests.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/93856660d44eccb4edc0ebbb9d63a5445e688528.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0140",
                    "defaultvalue": 0,
                    "displayName": "Jack of All Trades",
                    "hidden": 0,
                    "description": "You completed 20 quests.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/ca294c1039d08d7c72682ca2a8dd88bca4a48cf0.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0150",
                    "defaultvalue": 0,
                    "displayName": "Go-To Guy",
                    "hidden": 0,
                    "description": "You completed 30 quests.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/ca294c1039d08d7c72682ca2a8dd88bca4a48cf0.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0160",
                    "defaultvalue": 0,
                    "displayName": "Dear Diary",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/676d5f5e2cd45a24738dc6078031f14d56ed923e.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0170",
                    "defaultvalue": 0,
                    "displayName": "Man of Means",
                    "hidden": 0,
                    "description": "You accumulated 1,000,000 pieces of gold.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/d7fb76788b77cd73639cefd292567e596ecc912a.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0180",
                    "defaultvalue": 0,
                    "displayName": "Educated Warrior",
                    "hidden": 0,
                    "description": "You read all novel segments about your friends' pasts.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/d59ca2f03b4015bc9b6134d921262f8768f843f1.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0190",
                    "defaultvalue": 0,
                    "displayName": "Call Her Back",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/cfbbf964649924e25af995c47f9207e6bdb0e82a.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0200",
                    "defaultvalue": 0,
                    "displayName": "Lingering Memories",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/7f65bb588647210451d003101fb6ce7ca335fb92.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0210",
                    "defaultvalue": 0,
                    "displayName": "Thank You",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/acd8fa3e92c01655b9dfeb91ea13b7c997df3825.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0220",
                    "defaultvalue": 0,
                    "displayName": "Something Very Special",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/5bc97058ccbe271edd966ca6ee9d0f4aefc0307b.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0230",
                    "defaultvalue": 0,
                    "displayName": "e8 a8 98 e6 86 b6 e3 82 b5 e3 83 bc e3 83 90 e3 83 bc",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/d556f212037cb9645aa17c87c1a01a34ccacfaa5.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0240",
                    "defaultvalue": 0,
                    "displayName": "Legendary Gardener",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/636ac036eb45750ac6d125ea8d6936ed1130266d.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0250",
                    "defaultvalue": 0,
                    "displayName": "Fish of Legend",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/b5e054f5234a31c7bbc3b458c0f3ae5289069b81.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0260",
                    "defaultvalue": 0,
                    "displayName": "A Round by the Pond",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/c67e64eb2e069c0b115a5feea3cb02451df4f11a.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0270",
                    "defaultvalue": 0,
                    "displayName": "Material Hunter",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/c0d448fc0d573abb796053bf7f2b12eb0b6f4c32.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0280",
                    "defaultvalue": 0,
                    "displayName": "Upgrade Apprentice",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/369a20404467230c20b158f7a3dd77699be9effd.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0290",
                    "defaultvalue": 0,
                    "displayName": "Reform Specialist",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/3abb815e20d23a97e80b2a10742cc3afd38e53cc.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0300",
                    "defaultvalue": 0,
                    "displayName": "Forging Master",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/ef2b7d68560bcfb3d32347e8884a0b736be4750b.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0310",
                    "defaultvalue": 0,
                    "displayName": "All Aboared!",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/669fb049d3b0d0ac200125736144e4e274c7620e.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0320",
                    "defaultvalue": 0,
                    "displayName": "The Sheep Whisperer",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/3c40216c95eb8d9acdb90435760c921dc6bd3954.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0330",
                    "defaultvalue": 0,
                    "displayName": "Lightspeed Fighter",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/f61dd8bd207e6a897ca5fa0297dbfbab0ff51103.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0340",
                    "defaultvalue": 0,
                    "displayName": "King of the Lost Shrine",
                    "hidden": 0,
                    "description": "You defeated Gretel within three minutes and twenty seconds.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/70883d0681b1993aa430bbcd8f9d4241f637b3ce.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0350",
                    "defaultvalue": 0,
                    "displayName": "A True Friend",
                    "hidden": 0,
                    "description": "You stopped the berserk Kain√© within one minute.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/0b7d266b6959f86fa40ce0108cda8d7c7df207f9.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0360",
                    "defaultvalue": 0,
                    "displayName": "Boss of the Junk Heap",
                    "hidden": 0,
                    "description": "You defeated P-33 within four and a half minutes.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/602644eaf05ce46aa16b2d58299210d68e114d92.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0370",
                    "defaultvalue": 0,
                    "displayName": "Scourge of The Aerie",
                    "hidden": 0,
                    "description": "You defeated Wendy within eight and a half minutes.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/0ef270a84980596473ae130aee58f8275ee15ef2.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0380",
                    "defaultvalue": 0,
                    "displayName": "Protector of Facade",
                    "hidden": 0,
                    "description": "You defeated Roc within three and a half minutes.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/d9e9a588af83858f08ad062bba1d2148e23fdcde.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0390",
                    "defaultvalue": 0,
                    "displayName": "The Little Mermaid",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/0c6faf92c5cdfb91223238bfd12a0829bd8b13a9.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0400",
                    "defaultvalue": 0,
                    "displayName": "Permission Granted",
                    "hidden": 0,
                    "description": "You drove off Devola and Popola within three minutes.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/52b749ff62320430f2440c7dff89898e9fae3473.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0410",
                    "defaultvalue": 0,
                    "displayName": "A Dirge for the Hero",
                    "hidden": 0,
                    "description": "You defeated Goose within two minutes.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/c33b07dfe29428d7caab6a1f7c6a13c49e539ceb.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0420",
                    "defaultvalue": 0,
                    "displayName": "Soul Crusher",
                    "hidden": 0,
                    "description": "You defeated Devola and Popola within three and a half minutes.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/f80e7782c38c6657bb6a39f9c8904219e1cb3d1a.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0430",
                    "defaultvalue": 0,
                    "displayName": "Book Burner",
                    "hidden": 0,
                    "description": "You defeated Grimoire Noir within one and a half minutes.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/f0c1804eee52d941045b24beb6353967ad522eb7.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0440",
                    "defaultvalue": 0,
                    "displayName": "The Once and Final King",
                    "hidden": 0,
                    "description": "You defeated the Shadowlord within four minutes and twenty seconds.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/9395b1e23f8ffecde59ac3d84d4c17844d9c13e9.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0450",
                    "defaultvalue": 0,
                    "displayName": "The Strongest Bond",
                    "hidden": 0,
                    "description": "You defeated the berserk Kain√© within three and a half minutes.",
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/66a42f466f875af265a505380e0c9754c8d2c550.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/dccf83b1927eb511d794ec172eb2a8737aa5f317.jpg",
                  },
                  {
                    "name": "ACHIEVEMENT_0460",
                    "defaultvalue": 0,
                    "displayName": "Daredevil",
                    "hidden": 1,
                    "icon": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/9c70d4e9d69a09bcda912fa4323bded42b9d183a.jpg",
                    "icongray": "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/1113560/67f2dca4872e41dd6ce5b923edf54bf16d42ef53.jpg",
                  },
                ],
              },
            },
          },
      })
    }

    //Player level
    if (/^.*IPlayerService.GetSteamLevel.v1.*$/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking steam api result > ${url}`)
      return ({
        status: 200,
        data: {
          response: {
            player_level: faker.number.int(500),
          },
        },
      })
    }

    //Player summary
    if (/^.*ISteamUser.GetPlayerSummaries.v0002.*$/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking steam api result > ${url}`)
      return ({
        status: 200,
        data: {
          "response": {
            "players": [
              {
                "steamid": "0",
                "communityvisibilitystate": 3,
                "profilestate": 1,
                "personaname": faker.internet.userName(),
                "commentpermission": 2,
                "profileurl": "https://steamcommunity.com/id",
                "avatar": null,
                "avatarmedium": null,
                "avatarfull": null,
                "avatarhash": "562c4d8db58d44af73b0f5f46d2f1bb5a24e54b3",
                "lastlogoff": 1676688802,
                "personastate": 0,
                "primaryclanid": "0",
                "timecreated": 1366386002,
                "personastateflags": 0,
                "loccountrycode": "FR",
              },
            ],
          },
        },
      })
    }

    //Player achievements
    if (/^.*ISteamUserStats.GetPlayerAchievements.v0001.*$/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking steam api result > ${url}`)
      return ({
        status: 200,
        data: /appid=524220/.test(url)
          ? {
            "playerstats": {
              "steamID": "76561198089224516",
              "gameName": "NieR:Automata‚Ñ¢",
              "achievements": [
                {
                  "apiname": "ACH_VISITED_BUNKER",
                  "achieved": 1,
                  "unlocktime": 1565069702,
                  "name": "Resuscitated Body",
                  "description": "",
                },
                {
                  "apiname": "ACH_VISITED_RUINS_CITY",
                  "achieved": 1,
                  "unlocktime": 1565376632,
                  "name": "Vestiges of Prosperity",
                  "description": "",
                },
                {
                  "apiname": "ACH_CLEAR_DESERT_AREA",
                  "achieved": 1,
                  "unlocktime": 1565974024,
                  "name": "It's a Healthy Baby Boy!",
                  "description": "",
                },
                {
                  "apiname": "ACH_CLEAR_AMUSEMENT_PARK",
                  "achieved": 1,
                  "unlocktime": 1565974917,
                  "name": "We Await Your Next Visit",
                  "description": "",
                },
                {
                  "apiname": "ACH_CLEAR_ALIEN_SHIP",
                  "achieved": 1,
                  "unlocktime": 1565431434,
                  "name": "Creation and Insurrection",
                  "description": "",
                },
                {
                  "apiname": "ACH_CLEAR_CASTLE_FOREST",
                  "achieved": 1,
                  "unlocktime": 1565433829,
                  "name": "The Mechanical Kingdom",
                  "description": "",
                },
                {
                  "apiname": "ACH_CLEAR_SUBMERGE_CITY",
                  "achieved": 1,
                  "unlocktime": 1565434679,
                  "name": "Ruler of the Deep",
                  "description": "",
                },
                {
                  "apiname": "ACH_CLEAR_COPY_CITY",
                  "achieved": 1,
                  "unlocktime": 1565441114,
                  "name": "Those Who Love Humans",
                  "description": "",
                },
                {
                  "apiname": "ACH_CLEAR_ROBOT_MT",
                  "achieved": 1,
                  "unlocktime": 1565444308,
                  "name": "Iron Soul",
                  "description": "",
                },
                {
                  "apiname": "ACH_CLEAR_A",
                  "achieved": 1,
                  "unlocktime": 1565447636,
                  "name": "One Battle Ends",
                  "description": "",
                },
                {
                  "apiname": "ACH_CLEAR_B",
                  "achieved": 1,
                  "unlocktime": 1565532631,
                  "name": "A New Battle Begins",
                  "description": "",
                },
                {
                  "apiname": "ACH_SEE_2B_DIE",
                  "achieved": 1,
                  "unlocktime": 1565537220,
                  "name": "Final Wish",
                  "description": "",
                },
                {
                  "apiname": "ACH_PLAY_A2_FIRST_TIME",
                  "achieved": 1,
                  "unlocktime": 1565537371,
                  "name": "Treacherous Blade",
                  "description": "",
                },
                {
                  "apiname": "ACH_LAST_REQUEST_PASCAL",
                  "achieved": 1,
                  "unlocktime": 1565548811,
                  "name": "Farewell, Pascal",
                  "description": "",
                },
                {
                  "apiname": "ACH_KILL_ROBOT_BROTHER",
                  "achieved": 1,
                  "unlocktime": 1565551466,
                  "name": "Justice",
                  "description": "",
                },
                {
                  "apiname": "ACH_DEVOLA_NOVEL_END",
                  "achieved": 1,
                  "unlocktime": 1565553188,
                  "name": "Crime and Punishment",
                  "description": "",
                },
                {
                  "apiname": "ACH_CLEAR_9S",
                  "achieved": 1,
                  "unlocktime": 1565558387,
                  "name": "Leaving for the New World",
                  "description": "",
                },
                {
                  "apiname": "ACH_CLEAR_A2",
                  "achieved": 1,
                  "unlocktime": 1565556538,
                  "name": "Beautiful World",
                  "description": "",
                },
                {
                  "apiname": "ACH_TRUE_END",
                  "achieved": 1,
                  "unlocktime": 1565558387,
                  "name": "The Minds That Emerged",
                  "description": "",
                },
                {
                  "apiname": "ACH_RECOVERY_SELF_CORPSE",
                  "achieved": 1,
                  "unlocktime": 1565431434,
                  "name": "The Circle of Death",
                  "description": "Have your body collected.",
                },
                {
                  "apiname": "ACH_RECOVERY_CORPSE",
                  "achieved": 1,
                  "unlocktime": 1565473831,
                  "name": "Cherish Our Resources",
                  "description": "Have 100 bodies collected.",
                },
                {
                  "apiname": "ACH_CLEAR_QUEST_FIRST_TIME",
                  "achieved": 1,
                  "unlocktime": 1565378552,
                  "name": "First Errand",
                  "description": "Complete your first quest.",
                },
                {
                  "apiname": "ACH_CLEAR_MANY_QUEST",
                  "achieved": 1,
                  "unlocktime": 1565543033,
                  "name": "The Mercenary",
                  "description": "80% of all quests completed.",
                },
                {
                  "apiname": "ACH_COLLECT_ARCHIVE",
                  "achieved": 1,
                  "unlocktime": 1565897848,
                  "name": "Information Master",
                  "description": "80% of all archives found.",
                },
                {
                  "apiname": "ACH_COLLECT_EM_LIST",
                  "achieved": 1,
                  "unlocktime": 1565551063,
                  "name": "Destruction is My Job",
                  "description": "80% of all unit data unlocked.",
                },
                {
                  "apiname": "ACH_COLLECT_CHIP",
                  "achieved": 1,
                  "unlocktime": 1565470147,
                  "name": "Chip Collector",
                  "description": "80% of all plug-in chips collected.",
                },
                {
                  "apiname": "ACH_HAS_ALL_ACTIVE_SKILL",
                  "achieved": 1,
                  "unlocktime": 1565901900,
                  "name": "Weapons Maniac",
                  "description": "All Pod programs obtained.",
                },
                {
                  "apiname": "ACH_WEAPON_LV_MAX",
                  "achieved": 1,
                  "unlocktime": 1565520201,
                  "name": "Tools of the Trade",
                  "description": "Any weapon upgraded to the highest level.",
                },
                {
                  "apiname": "ACH_WEAPON_LV_MAX_ALL",
                  "achieved": 1,
                  "unlocktime": 1565892897,
                  "name": "Inorganic Blade",
                  "description": "All weapons upgraded to the highest level.",
                },
                {
                  "apiname": "ACH_POD_LV_MAX_ALL",
                  "achieved": 1,
                  "unlocktime": 1565892998,
                  "name": "Supreme Support Weapons",
                  "description": "All Pods upgraded to the highest level.",
                },
                {
                  "apiname": "ACH_CLEAR_HACKING_9S",
                  "achieved": 1,
                  "unlocktime": 1565448443,
                  "name": "Fighting's Not My Thing",
                  "description": "",
                },
                {
                  "apiname": "ACH_HACKING_KILL",
                  "achieved": 1,
                  "unlocktime": 1565483879,
                  "name": "A Scanner's Power",
                  "description": "",
                },
                {
                  "apiname": "ACH_REMOTO_KILL",
                  "achieved": 1,
                  "unlocktime": 1565883806,
                  "name": "Machines vs. Machines",
                  "description": "",
                },
                {
                  "apiname": "ACH_BERSERKER_KILL",
                  "achieved": 1,
                  "unlocktime": 1565903370,
                  "name": "The Power of Hate",
                  "description": "",
                },
                {
                  "apiname": "ACH_SHOOTING",
                  "achieved": 1,
                  "unlocktime": 1565433829,
                  "name": "Ruler of the Skies",
                  "description": "255 enemies destroyed using a flight unit.",
                },
                {
                  "apiname": "ACH_EXTRACTION",
                  "achieved": 1,
                  "unlocktime": 1565892563,
                  "name": "Harvest King",
                  "description": "Materials gathered at a hidden harvest point 10 times.",
                },
                {
                  "apiname": "ACH_GET_ALL_POD",
                  "achieved": 1,
                  "unlocktime": 1565524165,
                  "name": "Pod Hunter",
                  "description": "All Pods found.",
                },
                {
                  "apiname": "ACH_RICH_MAN",
                  "achieved": 1,
                  "unlocktime": 1565467456,
                  "name": "Desire Without Emotion",
                  "description": "At least 100,000 G in possession.",
                },
                {
                  "apiname": "ACH_ANIMAL_RUN",
                  "achieved": 1,
                  "unlocktime": 1565522297,
                  "name": "Animal Rider",
                  "description": "Any animal ridden for 5 kilometers.",
                },
                {
                  "apiname": "ACH_FISHING",
                  "achieved": 1,
                  "unlocktime": 1565976316,
                  "name": "A Round by the Pond",
                  "description": "20 different kinds of fish caught.",
                },
                {
                  "apiname": "ACH_NPC_KILL",
                  "achieved": 1,
                  "unlocktime": 1565481959,
                  "name": "Wait! Don't Kill Me!",
                  "description": "",
                },
                {
                  "apiname": "ACH_SKIRT_ESCAPE",
                  "achieved": 1,
                  "unlocktime": 1565902246,
                  "name": "What Are You Doing?",
                  "description": "",
                },
                {
                  "apiname": "ACH_PANTS",
                  "achieved": 1,
                  "unlocktime": 1565903882,
                  "name": "Not That I Mind...",
                  "description": "",
                },
                {
                  "apiname": "ACH_EMILE_SHOP",
                  "achieved": 1,
                  "unlocktime": 1565435609,
                  "name": "Come Take a Look!",
                  "description": "",
                },
                {
                  "apiname": "ACH_KILL_EM1010",
                  "achieved": 1,
                  "unlocktime": 1565889756,
                  "name": "Naughty Children",
                  "description": "",
                },
                {
                  "apiname": "ACH_BAD_END",
                  "achieved": 1,
                  "unlocktime": 1565976624,
                  "name": "Transcendent Being",
                  "description": "",
                },
                {
                  "apiname": "ACH_CALL_AT_KAINES_ROOM",
                  "achieved": 1,
                  "unlocktime": 1565903768,
                  "name": "Lunar Tear",
                  "description": "",
                },
              ],
              "success": true,
            },
          }
          : {
            "playerstats": {
              "steamID": "76561198089224516",
              "gameName": "NieR Replicant ver.1.22474487139...",
              "achievements": [
                {
                  "apiname": "ACHIEVEMENT_0000",
                  "achieved": 0,
                  "unlocktime": 0,
                  "name": "The Final Verse",
                  "description": "Congratulations! Thank you for playing!",
                },
                {
                  "apiname": "ACHIEVEMENT_0010",
                  "achieved": 1,
                  "unlocktime": 1623873057,
                  "name": "The Book of Legend",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0020",
                  "achieved": 1,
                  "unlocktime": 1624294156,
                  "name": "The Wild Companion",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0030",
                  "achieved": 1,
                  "unlocktime": 1624466800,
                  "name": "The Mellow Companion",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0040",
                  "achieved": 1,
                  "unlocktime": 1624471033,
                  "name": "Release",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0050",
                  "achieved": 1,
                  "unlocktime": 1625520706,
                  "name": "Gratitude",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0060",
                  "achieved": 1,
                  "unlocktime": 1624486870,
                  "name": "Key Collector",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0070",
                  "achieved": 1,
                  "unlocktime": 1624489046,
                  "name": "A World in Flux",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0080",
                  "achieved": 1,
                  "unlocktime": 1624399122,
                  "name": "Combo Fanatic",
                  "description": "You pulled off a 50-hit combo.",
                },
                {
                  "apiname": "ACHIEVEMENT_0090",
                  "achieved": 1,
                  "unlocktime": 1624486870,
                  "name": "Combo Master",
                  "description": "You pulled off a 100-hit combo.",
                },
                {
                  "apiname": "ACHIEVEMENT_0100",
                  "achieved": 1,
                  "unlocktime": 1624397883,
                  "name": "The Magic Man",
                  "description": "You learned every type of magic.",
                },
                {
                  "apiname": "ACHIEVEMENT_0110",
                  "achieved": 1,
                  "unlocktime": 1625391608,
                  "name": "Wordsmith",
                  "description": "You collected 50 percent of all words.",
                },
                {
                  "apiname": "ACHIEVEMENT_0120",
                  "achieved": 1,
                  "unlocktime": 1625417752,
                  "name": "Weapons Collector",
                  "description": "You found every weapon.",
                },
                {
                  "apiname": "ACHIEVEMENT_0130",
                  "achieved": 1,
                  "unlocktime": 1624277733,
                  "name": "Village Handyman",
                  "description": "You completed 10 quests.",
                },
                {
                  "apiname": "ACHIEVEMENT_0140",
                  "achieved": 1,
                  "unlocktime": 1624305463,
                  "name": "Jack of All Trades",
                  "description": "You completed 20 quests.",
                },
                {
                  "apiname": "ACHIEVEMENT_0150",
                  "achieved": 1,
                  "unlocktime": 1624310689,
                  "name": "Go-To Guy",
                  "description": "You completed 30 quests.",
                },
                {
                  "apiname": "ACHIEVEMENT_0160",
                  "achieved": 1,
                  "unlocktime": 1625417752,
                  "name": "Dear Diary",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0170",
                  "achieved": 1,
                  "unlocktime": 1625396749,
                  "name": "Man of Means",
                  "description": "You accumulated 1,000,000 pieces of gold.",
                },
                {
                  "apiname": "ACHIEVEMENT_0180",
                  "achieved": 1,
                  "unlocktime": 1625590899,
                  "name": "Educated Warrior",
                  "description": "You read all novel segments about your friends' pasts.",
                },
                {
                  "apiname": "ACHIEVEMENT_0190",
                  "achieved": 1,
                  "unlocktime": 1624489684,
                  "name": "Call Her Back",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0200",
                  "achieved": 1,
                  "unlocktime": 1625437212,
                  "name": "Lingering Memories",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0210",
                  "achieved": 1,
                  "unlocktime": 1625592439,
                  "name": "Thank You",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0220",
                  "achieved": 1,
                  "unlocktime": 1625598751,
                  "name": "Something Very Special",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0230",
                  "achieved": 1,
                  "unlocktime": 1625610706,
                  "name": "e8 a8 98 e6 86 b6 e3 82 b5 e3 83 bc e3 83 90 e3 83 bc",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0240",
                  "achieved": 1,
                  "unlocktime": 1625515136,
                  "name": "Legendary Gardener",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0250",
                  "achieved": 1,
                  "unlocktime": 1625399355,
                  "name": "Fish of Legend",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0260",
                  "achieved": 1,
                  "unlocktime": 1625406465,
                  "name": "A Round by the Pond",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0270",
                  "achieved": 1,
                  "unlocktime": 1624305463,
                  "name": "Material Hunter",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0280",
                  "achieved": 1,
                  "unlocktime": 1625396391,
                  "name": "Upgrade Apprentice",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0290",
                  "achieved": 1,
                  "unlocktime": 1625517105,
                  "name": "Reform Specialist",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0300",
                  "achieved": 1,
                  "unlocktime": 1625517174,
                  "name": "Forging Master",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0310",
                  "achieved": 1,
                  "unlocktime": 1625522791,
                  "name": "All Aboared!",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0320",
                  "achieved": 1,
                  "unlocktime": 1625600972,
                  "name": "The Sheep Whisperer",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0330",
                  "achieved": 0,
                  "unlocktime": 0,
                  "name": "Lightspeed Fighter",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0340",
                  "achieved": 1,
                  "unlocktime": 1625516447,
                  "name": "King of the Lost Shrine",
                  "description": "You defeated Gretel within three minutes and twenty seconds.",
                },
                {
                  "apiname": "ACHIEVEMENT_0350",
                  "achieved": 1,
                  "unlocktime": 1625392124,
                  "name": "A True Friend",
                  "description": "You stopped the berserk Kain√© within one minute.",
                },
                {
                  "apiname": "ACHIEVEMENT_0360",
                  "achieved": 1,
                  "unlocktime": 1625405608,
                  "name": "Boss of the Junk Heap",
                  "description": "You defeated P-33 within four and a half minutes.",
                },
                {
                  "apiname": "ACHIEVEMENT_0370",
                  "achieved": 1,
                  "unlocktime": 1625518485,
                  "name": "Scourge of The Aerie",
                  "description": "You defeated Wendy within eight and a half minutes.",
                },
                {
                  "apiname": "ACHIEVEMENT_0380",
                  "achieved": 1,
                  "unlocktime": 1625521457,
                  "name": "Protector of Facade",
                  "description": "You defeated Roc within three and a half minutes.",
                },
                {
                  "apiname": "ACHIEVEMENT_0390",
                  "achieved": 0,
                  "unlocktime": 0,
                  "name": "The Little Mermaid",
                  "description": "",
                },
                {
                  "apiname": "ACHIEVEMENT_0400",
                  "achieved": 1,
                  "unlocktime": 1625589841,
                  "name": "Permission Granted",
                  "description": "You drove off Devola and Popola within three minutes.",
                },
                {
                  "apiname": "ACHIEVEMENT_0410",
                  "achieved": 1,
                  "unlocktime": 1625437212,
                  "name": "A Dirge for the Hero",
                  "description": "You defeated Goose within two minutes.",
                },
                {
                  "apiname": "ACHIEVEMENT_0420",
                  "achieved": 1,
                  "unlocktime": 1625595493,
                  "name": "Soul Crusher",
                  "description": "You defeated Devola and Popola within three and a half minutes.",
                },
                {
                  "apiname": "ACHIEVEMENT_0430",
                  "achieved": 1,
                  "unlocktime": 1625595593,
                  "name": "Book Burner",
                  "description": "You defeated Grimoire Noir within one and a half minutes.",
                },
                {
                  "apiname": "ACHIEVEMENT_0440",
                  "achieved": 1,
                  "unlocktime": 1625591368,
                  "name": "The Once and Final King",
                  "description": "You defeated the Shadowlord within four minutes and twenty seconds.",
                },
                {
                  "apiname": "ACHIEVEMENT_0450",
                  "achieved": 1,
                  "unlocktime": 1625596007,
                  "name": "The Strongest Bond",
                  "description": "You defeated the berserk Kain√© within three and a half minutes.",
                },
                {
                  "apiname": "ACHIEVEMENT_0460",
                  "achieved": 1,
                  "unlocktime": 1625607419,
                  "name": "Daredevil",
                  "description": "",
                },
              ],
              "success": true,
            },
          },
      })
    }
  }
}
</file>

<file path="tests/mocks/api/axios/get/wakatime.mjs">
/**Mocked data */
export default function({faker, url, options, login = faker.internet.userName()}) {
  //Wakatime api
  if (/^https:..wakatime.com.api.v1.users..*.stats.*$/.test(url)) {
    //Get user profile
    if (/api_key=MOCKED_TOKEN/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking wakatime api result > ${url}`)
      const stats = array => {
        const elements = []
        let results = new Array(4 + faker.number.int(2)).fill(null).map(_ => ({
          get digital() {
            return `${this.hours}:${this.minutes}`
          },
          hours: faker.number.int(1000),
          minutes: faker.number.int(1000),
          name: array ? faker.helpers.arrayElement(array) : faker.lorem.words(2).replace(/ /g, "-").toLocaleLowerCase(),
          percent: 0,
          total_seconds: faker.number.int(1000000),
        }))
        results = results.filter(({name}) => elements.includes(name) ? false : (elements.push(name), true))
        let percents = 100
        for (const result of results) {
          result.percent = 1 + ((percents - 1) <= 0 ? 0 : faker.number.int(percents - 1))
          percents -= result.percent
        }
        return results
      }
      return ({
        status: 200,
        data: {
          data: {
            best_day: {
              created_at: faker.date.recent(),
              date: `${faker.date.recent()}`.substring(0, 10),
              total_seconds: faker.number.int(1000000),
            },
            categories: stats(),
            daily_average: faker.number.int(12 * 60 * 60),
            daily_average_including_other_language: faker.number.int(12 * 60 * 60),
            dependencies: stats(),
            editors: stats(["VS Code", "Chrome", "IntelliJ", "PhpStorm", "WebStorm", "Android Studio", "Visual Studio", "Sublime Text", "PyCharm", "Vim", "Atom", "Xcode"]),
            languages: stats(["JavaScript", "TypeScript", "PHP", "Java", "Python", "Vue.js", "HTML", "C#", "JSON", "Dart", "SCSS", "Kotlin", "JSX", "Go", "Ruby", "YAML"]),
            machines: stats(),
            operating_systems: stats(["Mac", "Windows", "Linux"]),
            project: null,
            projects: /api_key=MOCKED_TOKEN_NO_PROJECTS/.test(url) ? null : stats(),
            total_seconds: faker.number.int(1000000000),
            total_seconds_including_other_language: faker.number.int(1000000000),
          },
        },
      })
    }
  }
}
</file>

<file path="tests/mocks/api/axios/get/yahoo.mjs">
/**Mocked data */
export default function({faker, url, options, login = faker.internet.userName()}) {
  //Wakatime api
  if (/^https:..yh-finance.p.rapidapi.com.stock.v2.*$/.test(url)) {
    //Get company profile
    if (/get-profile/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking yahoo finance api result > ${url}`)
      return ({
        status: 200,
        data: {
          price: {
            marketCap: {
              raw: faker.number.int(1000000000),
            },
            symbol: "OCTO",
          },
          quoteType: {
            shortName: faker.company.name(),
            longName: faker.company.name(),
            exchangeTimezoneName: faker.location.timeZone(),
            symbol: "OCTO",
          },
          calendarEvents: {},
          summaryDetail: {},
          symbol: "OCTO",
          assetProfile: {
            fullTimeEmployees: faker.number.int(10000),
            city: faker.location.city(),
            country: faker.location.country(),
          },
        },
      })
    }
    //Get stock chart
    if (/get-chart/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking yahoo finance api result > ${url}`)
      return ({
        status: 200,
        data: {
          chart: {
            result: [
              {
                meta: {
                  currency: "USD",
                  symbol: "OCTO",
                  regularMarketPrice: faker.number.int(10000) / 100,
                  chartPreviousClose: faker.number.int(10000) / 100,
                  previousClose: faker.number.int(10000) / 100,
                },
                timestamp: new Array(1000).fill(Date.now()).map((x, i) => x + i * 60000),
                indicators: {
                  quote: [
                    {
                      close: new Array(1000).fill(null).map(_ => faker.number.int(10000) / 100),
                      get low() {
                        return this.close
                      },
                      get high() {
                        return this.close
                      },
                      get open() {
                        return this.close
                      },
                      volume: [],
                    },
                  ],
                },
              },
            ],
          },
        },
      })
    }
  }
}
</file>

<file path="tests/mocks/api/axios/post/youtubemusic.mjs">
/**Mocked data */
export default function({faker, url, options, login = faker.internet.userName()}) {
  if (/^https:..music.youtube.com.youtubei.v1.*$/.test(url)) {
    //Get recently played tracks
    if (/browse/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking yt music api result > ${url}`)
      const artist = faker.lorem.word()
      const track = faker.lorem.words(5)
      const artwork = faker.image.url()
      return ({
        contents: {
          singleColumnBrowseResultsRenderer: {
            tabs: [{
              tabRenderer: {
                content: {
                  sectionListRenderer: {
                    contents: [{
                      contents: [{
                        musicResponsiveListItemRenderer: {
                          thumbnail: {
                            musicThumbnailRenderer: {
                              thumbnail: {
                                thumbnails: [{
                                  url: artwork,
                                }],
                              },
                            },
                          },
                          flexColumns: [{
                            musicResponsiveListItemFlexColumnRenderer: {
                              text: {
                                runs: [{
                                  text: track,
                                }],
                              },
                            },
                          }, {
                            musicResponsiveListItemFlexColumnRenderer: {
                              text: {
                                runs: [{
                                  text: artist,
                                }],
                              },
                            },
                          }],
                        },
                      }],
                    }],
                  },
                },
              },
            }],
          },
        },
      })
    }
  }
}
</file>

<file path="tests/mocks/api/github/graphql/achievements.default.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > achievements/metrics")
  return ({
    user: {
      repositories: {
        nodes: [
          {
            createdAt: faker.date.recent(),
            nameWithOwner: `${faker.internet.userName()}/${faker.lorem.slug()}`,
          },
        ],
        totalCount: faker.number.int(100),
      },
      forks: {
        nodes: [
          {
            createdAt: faker.date.recent(),
            nameWithOwner: `${faker.internet.userName()}/${faker.lorem.slug()}`,
          },
        ],
        totalCount: faker.number.int(100),
      },
      popular: {
        nodes: [{stargazers: {totalCount: faker.number.int(50000)}}],
      },
      pullRequests: {
        nodes: [
          {
            createdAt: faker.date.recent(),
            title: faker.lorem.sentence(),
            repository: {nameWithOwner: `${faker.internet.userName()}/${faker.lorem.slug()}`},
          },
        ],
        totalCount: faker.number.int(50000),
      },
      contributionsCollection: {
        pullRequestReviewContributions: {
          nodes: [
            {
              occurredAt: faker.date.recent(),
              pullRequest: {
                title: faker.lorem.sentence(),
                number: faker.number.int(1000),
                repository: {nameWithOwner: `${faker.internet.userName()}/${faker.lorem.slug()}`},
              },
            },
          ],
          totalCount: faker.number.int(1000),
        },
      },
      projects: {totalCount: faker.number.int(100)},
      packages: {totalCount: faker.number.int(100)},
      organizations: {nodes: [], totalCount: faker.number.int(5)},
      gists: {
        nodes: [{createdAt: faker.date.recent(), name: faker.lorem.slug()}],
        totalCount: faker.number.int(1000),
      },
      starredRepositories: {totalCount: faker.number.int(1000)},
      followers: {totalCount: faker.number.int(10000)},
      following: {totalCount: faker.number.int(10000)},
      bio: faker.lorem.sentence(),
      status: {message: faker.lorem.paragraph()},
      sponsorshipsAsSponsor: {totalCount: faker.number.int(100)},
      discussionsStarted: {totalCount: faker.number.int(1000)},
      discussionsComments: {totalCount: faker.number.int(1000)},
      discussionAnswers: {totalCount: faker.number.int(1000)},
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/achievements.organizations.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > achievements/organizations")
  return ({
    organization: {
      repositories: {
        nodes: [
          {
            createdAt: faker.date.recent(),
            nameWithOwner: `${faker.internet.userName()}/${faker.lorem.slug()}`,
          },
        ],
        totalCount: faker.number.int(100),
      },
      forks: {
        nodes: [
          {
            createdAt: faker.date.recent(),
            nameWithOwner: `${faker.internet.userName()}/${faker.lorem.slug()}`,
          },
        ],
        totalCount: faker.number.int(100),
      },
      popular: {
        nodes: [{stargazers: {totalCount: faker.number.int(50000)}}],
      },
      projects: {totalCount: faker.number.int(100)},
      packages: {totalCount: faker.number.int(100)},
      membersWithRole: {totalCount: faker.number.int(100)},
      sponsorshipsAsSponsor: {totalCount: faker.number.int(100)},
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/achievements.ranking.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > achievements/ranking")
  return ({
    repo_rank: {repositoryCount: faker.number.int(100000)},
    forks_rank: {repositoryCount: faker.number.int(100000)},
    created_rank: {userCount: faker.number.int(100000)},
    user_rank: {userCount: faker.number.int(100000)},
    repo_total: {repositoryCount: faker.number.int(100000)},
    user_total: {userCount: faker.number.int(100000)},
  })
}
</file>

<file path="tests/mocks/api/github/graphql/achievements.total.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > achievements/total")
  return ({
    repositories: {count: faker.number.int(100000)},
    issues: {count: faker.number.int(100000)},
    users: {count: faker.number.int(100000)},
  })
}
</file>

<file path="tests/mocks/api/github/graphql/base.contributions.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > base/user")
  return ({
    user: {
      contributionsCollection: {
        totalRepositoriesWithContributedCommits: faker.number.int(100),
        totalCommitContributions: faker.number.int(10000),
        restrictedContributionsCount: faker.number.int(10000),
        totalIssueContributions: faker.number.int(100),
        totalPullRequestContributions: faker.number.int(1000),
        totalPullRequestReviewContributions: faker.number.int(1000),
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/base.field.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > base/user")
  return ({
    user: {
      packages: {totalCount: faker.number.int(10)},
      starredRepositories: {totalCount: faker.number.int(1000)},
      watching: {totalCount: faker.number.int(100)},
      sponsorshipsAsSponsor: {totalCount: faker.number.int(10)},
      sponsorshipsAsMaintainer: {totalCount: faker.number.int(10)},
      repositoriesContributedTo: {totalCount: faker.number.int(100)},
      followers: {totalCount: faker.number.int(1000)},
      following: {totalCount: faker.number.int(1000)},
      issueComments: {totalCount: faker.number.int(1000)},
      organizations: {totalCount: faker.number.int(10)},
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/base.field.repositories.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > base/user")
  return ({
    user: {
      repositories: {totalCount: faker.number.int(100), totalDiskUsage: faker.number.int(100000)},
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/base.repositories.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > base/repositories")
  return /after: "MOCKED_CURSOR"/m.test(query)
    ? ({
      user: {
        get repositoriesContributedTo() {
          return this.repositories
        },
        repositories: {
          edges: [],
          nodes: [],
        },
      },
    })
    : ({
      user: {
        get repositoriesContributedTo() {
          return this.repositories
        },
        repositories: {
          edges: [
            {
              cursor: "MOCKED_CURSOR",
            },
          ],
          nodes: [
            {
              name: faker.lorem.words(),
              watchers: {totalCount: faker.number.int(1000)},
              stargazers: {totalCount: faker.number.int(10000)},
              owner: {login},
              languages: {
                edges: [
                  {size: faker.number.int(100000), node: {color: faker.internet.color(), name: faker.lorem.word()}},
                  {size: faker.number.int(100000), node: {color: faker.internet.color(), name: faker.lorem.word()}},
                  {size: faker.number.int(100000), node: {color: faker.internet.color(), name: faker.lorem.word()}},
                  {size: faker.number.int(100000), node: {color: faker.internet.color(), name: faker.lorem.word()}},
                  {size: faker.number.int(100000), node: {color: faker.internet.color(), name: faker.lorem.word()}},
                  {size: faker.number.int(100000), node: {color: faker.internet.color(), name: faker.lorem.word()}},
                  {size: faker.number.int(100000), node: {color: faker.internet.color(), name: faker.lorem.word()}},
                ],
              },
              issues_open: {totalCount: faker.number.int(100)},
              issues_closed: {totalCount: faker.number.int(100)},
              pr_open: {totalCount: faker.number.int(100)},
              pr_closed: {totalCount: faker.number.int(100)},
              pr_merged: {totalCount: faker.number.int(100)},
              releases: {totalCount: faker.number.int(100)},
              forkCount: faker.number.int(100),
              licenseInfo: {spdxId: "MIT"},
              deployments: {totalCount: faker.number.int(100)},
              environments: {totalCount: faker.number.int(100)},
            },
          ],
        },
      },
    })
}
</file>

<file path="tests/mocks/api/github/graphql/base.repository.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > base/repository")
  return ({
    user: {
      repository: {
        name: "metrics",
        owner: {login},
        createdAt: new Date().toISOString(),
        diskUsage: Math.floor(Math.random() * 10000),
        homepageUrl: faker.internet.url(),
        watchers: {totalCount: faker.number.int(1000)},
        stargazers: {totalCount: faker.number.int(10000)},
        languages: {
          edges: [
            {size: faker.number.int(100000), node: {color: faker.internet.color(), name: faker.lorem.word()}},
            {size: faker.number.int(100000), node: {color: faker.internet.color(), name: faker.lorem.word()}},
            {size: faker.number.int(100000), node: {color: faker.internet.color(), name: faker.lorem.word()}},
            {size: faker.number.int(100000), node: {color: faker.internet.color(), name: faker.lorem.word()}},
            {size: faker.number.int(100000), node: {color: faker.internet.color(), name: faker.lorem.word()}},
            {size: faker.number.int(100000), node: {color: faker.internet.color(), name: faker.lorem.word()}},
            {size: faker.number.int(100000), node: {color: faker.internet.color(), name: faker.lorem.word()}},
          ],
        },
        issues_open: {totalCount: faker.number.int(100)},
        issues_closed: {totalCount: faker.number.int(100)},
        pr_open: {totalCount: faker.number.int(100)},
        pr_closed: {totalCount: faker.number.int(100)},
        pr_merged: {totalCount: faker.number.int(100)},
        releases: {totalCount: faker.number.int(100)},
        forkCount: faker.number.int(100),
        licenseInfo: {spdxId: "MIT"},
        deployments: {totalCount: faker.number.int(100)},
        environments: {totalCount: faker.number.int(100)},
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/calendar.default.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > calendar/default")
  //Generate calendar
  const date = new Date(query.match(/from: "(?<date>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z)"/)?.groups?.date)
  const to = new Date(query.match(/to: "(?<date>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z)"/)?.groups?.date)
  const weeks = []
  let contributionDays = []
  for (; date <= to; date.setDate(date.getDate() + 1)) {
    //Create new week on sunday
    if (date.getDay() === 0) {
      weeks.push({contributionDays})
      contributionDays = []
    }
    //Random contributions
    const contributionCount = Math.min(10, Math.max(0, faker.number.int(14) - 4))
    contributionDays.push({
      contributionCount,
      color: ["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"][Math.ceil(contributionCount / 10 / 0.25)],
      date: date.toISOString().substring(0, 10),
    })
  }
  return ({
    user: {
      calendar: {
        contributionCalendar: {
          weeks,
        },
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/discussions.comments.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > discussions/comments")
  return /after: "MOCKED_CURSOR"/m.test(query)
    ? ({
      user: {
        repositoryDiscussionsComments: {
          edges: [],
          nodes: [],
        },
      },
    })
    : ({
      user: {
        repositoryDiscussionsComments: {
          edges: new Array(100).fill(null).map(_ => ({cursor: "MOCKED_CURSOR"})),
          nodes: new Array(100).fill(null).map(_ => ({upvoteCount: faker.number.int(10)})),
        },
      },
    })
}
</file>

<file path="tests/mocks/api/github/graphql/discussions.statistics.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > discussions/statistics")
  return ({
    user: {
      started: {totalCount: faker.number.int(1000)},
      comments: {totalCount: faker.number.int(1000)},
      answers: {totalCount: faker.number.int(1000)},
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/followup.repository.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > followup/repository")
  return ({
    issues_open: {issueCount: faker.number.int(100)},
    issues_drafts: {issueCount: faker.number.int(100)},
    issues_skipped: {issueCount: faker.number.int(100)},
    issues_closed: {issueCount: faker.number.int(100)},
    pr_open: {issueCount: faker.number.int(100)},
    pr_drafts: {issueCount: faker.number.int(100)},
    pr_closed: {issueCount: faker.number.int(100)},
    pr_merged: {issueCount: faker.number.int(100)},
  })
}
</file>

<file path="tests/mocks/api/github/graphql/followup.user.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > followup/user")
  return ({
    issues_open: {issueCount: faker.number.int(100)},
    issues_drafts: {issueCount: faker.number.int(100)},
    issues_skipped: {issueCount: faker.number.int(100)},
    issues_closed: {issueCount: faker.number.int(100)},
    pr_open: {issueCount: faker.number.int(100)},
    pr_drafts: {issueCount: faker.number.int(100)},
    pr_closed: {issueCount: faker.number.int(100)},
    pr_merged: {issueCount: faker.number.int(100)},
  })
}
</file>

<file path="tests/mocks/api/github/graphql/gists.default.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > gists/default")
  return /after: "MOCKED_CURSOR"/m.test(query)
    ? ({
      user: {
        gists: {
          edges: [],
          nodes: [],
        },
      },
    })
    : ({
      user: {
        gists: {
          edges: [
            {
              cursor: "MOCKED_CURSOR",
            },
          ],
          totalCount: faker.number.int(100),
          nodes: [
            {
              stargazerCount: faker.number.int(10),
              isFork: false,
              forks: {totalCount: faker.number.int(10)},
              files: [{name: faker.system.fileName()}],
              comments: {totalCount: faker.number.int(10)},
            },
            {
              stargazerCount: faker.number.int(10),
              isFork: false,
              forks: {totalCount: faker.number.int(10)},
              files: [{name: faker.system.fileName()}],
              comments: {totalCount: faker.number.int(10)},
            },
          ],
        },
      },
    })
}
</file>

<file path="tests/mocks/api/github/graphql/isocalendar.calendar.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > isocalendar/calendar")
  //Generate calendar
  const date = new Date(query.match(/from: "(?<date>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z)"/)?.groups?.date)
  const to = new Date(query.match(/to: "(?<date>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z)"/)?.groups?.date)
  const weeks = []
  let contributionDays = []
  for (; date <= to; date.setDate(date.getDate() + 1)) {
    //Create new week on sunday
    if (date.getDay() === 0) {
      weeks.push({contributionDays})
      contributionDays = []
    }
    //Random contributions
    const contributionCount = Math.min(10, Math.max(0, faker.number.int(14) - 4))
    contributionDays.push({
      contributionCount,
      color: ["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"][Math.ceil(contributionCount / 10 / 0.25)],
      date: date.toISOString().substring(0, 10),
    })
  }
  return ({
    user: {
      calendar: {
        contributionCalendar: {
          weeks,
        },
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/notable.contributions.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > notable/contributions")
  return /after: "MOCKED_CURSOR"/m.test(query)
    ? ({
      user: {
        repositoriesContributedTo: {
          edges: [],
        },
      },
    })
    : ({
      user: {
        repositoriesContributedTo: {
          edges: [
            {
              cursor: "MOCKED_CURSOR",
              node: {
                isInOrganization: true,
                owner: {
                  login: faker.internet.userName(),
                  avatarUrl: null,
                },
                nameWithOwner: `${faker.internet.userName()}/${faker.lorem.slug()}`,
                stargazers: {totalCount: faker.number.int(1000)},
                watchers: {totalCount: faker.number.int(1000)},
                forks: {totalCount: faker.number.int(1000)},
                issues: {totalCount: faker.number.int(1000)},
                pullRequests: {totalCount: faker.number.int(1000)},
              },
            },
          ],
        },
      },
    })
}
</file>

<file path="tests/mocks/api/github/graphql/notable.issues.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > notable/issues")
  return /after: "MOCKED_CURSOR"/m.test(query)
    ? ({
      user: {
        issues: {
          edges: [],
        },
        pullRequests: {
          edges: [],
        },
      },
    })
    : ({
      user: {
        issues: {
          totalCount: faker.number.int(1000),
          edges: [
            {
              cursor: "MOCKED_CURSOR",
              node: {
                repository: {
                  nameWithOwner: `${faker.internet.userName()}/${faker.lorem.slug()}`,
                },
              },
            },
          ],
        },
        get pullRequests() {
          return this.issues
        },
      },
    })
}
</file>

<file path="tests/mocks/api/github/graphql/projects.repository.legacy.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > projects/repository.legacy")
  return ({
    user: {
      repository: {
        project: {
          name: "Repository project example",
          updatedAt: `${faker.date.recent()}`,
          body: faker.lorem.paragraph(),
          progress: {
            doneCount: faker.number.int(10),
            inProgressCount: faker.number.int(10),
            todoCount: faker.number.int(10),
            enabled: true,
          },
        },
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/projects.repository.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > projects/repository")
  return ({
    user: {
      repository: {
        projectV2: {
          name: "Repository project example",
          updatedAt: `${faker.date.recent()}`,
          body: faker.lorem.paragraph(),
          items: {
            get totalCount() {
              return this.nodes.length
            },
            nodes: new Array(faker.number.int(10)).fill(null).map(() => ({type: faker.helpers.arrayElement(["DRAFT_ISSUE", "ISSUE", "PULL_REQUEST", "REDACTED"]), fieldValues: {nodes: [{text: faker.lorem.sentence()}]}})),
          },
        },
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/projects.user.legacy.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > projects/user.legacy")
  return ({
    user: {
      projects: {
        totalCount: 1,
        nodes: [
          {
            name: "User-owned project",
            updatedAt: `${faker.date.recent()}`,
            body: faker.lorem.paragraph(),
            progress: {
              doneCount: faker.number.int(10),
              inProgressCount: faker.number.int(10),
              todoCount: faker.number.int(10),
              enabled: true,
            },
          },
        ],
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/projects.user.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > projects/user")
  return ({
    user: {
      projectsV2: {
        totalCount: 1,
        nodes: [
          {
            name: "User-owned project",
            updatedAt: `${faker.date.recent()}`,
            body: faker.lorem.paragraph(),
            items: {
              get totalCount() {
                return this.nodes.length
              },
              nodes: new Array(faker.number.int(10)).fill(null).map(() => ({type: faker.helpers.arrayElement(["DRAFT_ISSUE", "ISSUE", "PULL_REQUEST", "REDACTED"]), fieldValues: {nodes: [{text: faker.lorem.sentence()}]}})),
            },
          },
        ],
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/repositories.pinned.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > repositories/pinned")
  return ({
    user: {
      pinnedItems: {
        edges: [{
          node: {
            createdAt: faker.date.past(),
            description: "üìä An image generator with 20+ metrics about your GitHub account such as activity, community, repositories, coding habits, website performances, music played, starred topics, etc. that you can put on your profile or elsewhere !",
            forkCount: faker.number.int(100),
            isFork: false,
            issues: {
              totalCount: faker.number.int(100),
            },
            nameWithOwner: "lowlighter/metrics",
            openGraphImageUrl: "https://repository-images.githubusercontent.com/293860197/7fd72080-496d-11eb-8fe0-238b38a0746a",
            pullRequests: {
              totalCount: faker.number.int(100),
            },
            stargazerCount: faker.number.int(10000),
            licenseInfo: {
              nickname: null,
              name: "MIT License",
            },
            primaryLanguage: {
              color: "#f1e05a",
              name: "JavaScript",
            },
          },
        }],
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/repositories.repository.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > repositories/repository")
  return ({
    repository: {
      createdAt: faker.date.past(),
      description: "üìä An image generator with 20+ metrics about your GitHub account such as activity, community, repositories, coding habits, website performances, music played, starred topics, etc. that you can put on your profile or elsewhere !",
      forkCount: faker.number.int(100),
      isFork: false,
      issues: {
        totalCount: faker.number.int(100),
      },
      nameWithOwner: "lowlighter/metrics",
      openGraphImageUrl: "https://repository-images.githubusercontent.com/293860197/7fd72080-496d-11eb-8fe0-238b38a0746a",
      pullRequests: {
        totalCount: faker.number.int(100),
      },
      stargazerCount: faker.number.int(10000),
      licenseInfo: {
        nickname: null,
        name: "MIT License",
      },
      primaryLanguage: {
        color: "#f1e05a",
        name: "JavaScript",
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/sponsors.active.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > sponsors/default")
  return /after: "MOCKED_CURSOR"/m.test(query)
    ? ({
      user: {
        sponsorshipsAsMaintainer: {
          edges: [],
          nodes: [],
        },
      },
    })
    : ({
      user: {
        sponsorshipsAsMaintainer: {
          edges: new Array(10).fill("MOCKED_CURSOR"),
          nodes: new Array(10).fill(null).map(_ => ({
            privacyLevel: faker.helpers.arrayElement(["PUBLIC", "PRIVATE"]),
            sponsorEntity: {
              login: faker.internet.userName(),
              avatarUrl: null,
            },
            tier: {
              monthlyPriceInDollars: faker.number.int(10),
            },
          })),
        },
      },
    })
}
</file>

<file path="tests/mocks/api/github/graphql/sponsors.all.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > sponsors/all")
  return /after: "MOCKED_CURSOR"/m.test(query)
    ? ({
      user: {
        sponsorsActivities: {
          edges: [],
          nodes: [],
        },
      },
    })
    : ({
      user: {
        sponsorsActivities: {
          edges: new Array(10).fill("MOCKED_CURSOR"),
          nodes: new Array(10).fill(null).map(_ => ({
            sponsor: {
              login: faker.internet.userName(),
              avatarUrl: null,
            },
            sponsorsTier: {
              monthlyPriceInDollars: faker.number.int(10),
            },
          })),
        },
      },
    })
}
</file>

<file path="tests/mocks/api/github/graphql/sponsors.description.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > sponsors/default")
  return ({
    user: {
      sponsorsListing: {
        fullDescription: faker.lorem.sentences(),
        activeGoal: {
          percentComplete: faker.number.int(100),
          title: faker.lorem.sentence(),
          description: faker.lorem.sentence(),
        },
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/sponsorships.default.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > sponsorships/default")
  return ({
    user: {
      totalSponsorshipAmountAsSponsorInCents: faker.number.int(100000),
      sponsorshipsAsSponsor: {
        nodes: [{createdAt: `${faker.date.recent()}`}],
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/rest/repos/get.mjs">
/**Mocked data */
export default async function({faker}, target, that, [{owner, repo}]) {
  console.debug("metrics/compute/mocks > mocking rest api result > rest.repos.get")
  return ({
    status: 200,
    url: `https://api.github.com/repos/${owner}/${repo}`,
    headers: {
      server: "GitHub.com",
      status: "200 OK",
      "x-oauth-scopes": "repo",
    },
    data: {
      id: faker.number.int(100000),
      name: repo,
      full_name: `${owner}/${repo}`,
      private: false,
      owner: {
        login: owner,
        id: faker.number.int(100000),
      },
      description: faker.lorem.sentences(),
      created_at: faker.date.past(),
      license: {
        key: "mit",
        name: "MIT License",
      },
      default_branch: "main",
    },
  })
}
</file>

<file path="tests/mocks/api/github/rest/repos/getContributorsStats.mjs">
/**Mocked data */
export default async function({faker}, target, that, [{owner, repo}]) {
  console.debug("metrics/compute/mocks > mocking rest api result > rest.repos.getContributorsStats")
  return ({
    status: 200,
    url: `https://api.github.com/repos/${owner}/${repo}/stats/contributors`,
    headers: {
      server: "GitHub.com",
      status: "200 OK",
      "x-oauth-scopes": "repo",
    },
    data: [
      {
        total: faker.number.int(10000),
        weeks: [
          {w: faker.date.recent(), a: faker.number.int(10000), d: faker.number.int(10000), c: faker.number.int(10000)},
          {w: faker.date.recent(), a: faker.number.int(10000), d: faker.number.int(10000), c: faker.number.int(10000)},
          {w: faker.date.recent(), a: faker.number.int(10000), d: faker.number.int(10000), c: faker.number.int(10000)},
          {w: faker.date.recent(), a: faker.number.int(10000), d: faker.number.int(10000), c: faker.number.int(10000)},
        ].sort((a, b) => new Date(a.w) - new Date(b.w)),
        author: {
          login: owner,
        },
      },
    ],
  })
}
</file>

<file path="tests/mocks/api/github/rest/repos/getViews.mjs">
/**Mocked data */
export default async function({faker}, target, that, [{owner, repo}]) {
  console.debug("metrics/compute/mocks > mocking rest api result > rest.repos.getViews")
  const count = faker.number.int(10000) * 2
  const uniques = faker.number.int(count) * 2
  return ({
    status: 200,
    url: `https://api.github.com/repos/${owner}/${repo}/traffic/views`,
    headers: {
      server: "GitHub.com",
      status: "200 OK",
      "x-oauth-scopes": "repo",
    },
    data: {
      count,
      uniques,
      views: [
        {timestamp: `${faker.date.recent()}`, count: count / 2, uniques: uniques / 2},
        {timestamp: `${faker.date.recent()}`, count: count / 2, uniques: uniques / 2},
      ],
    },
  })
}
</file>

<file path="tests/mocks/api/github/rest/repos/listContributors.mjs">
/**Mocked data */
export default async function({faker}, target, that, [{owner, repo}]) {
  console.debug("metrics/compute/mocks > mocking rest api result > rest.repos.listContributors")
  return ({
    status: 200,
    url: `https://api.github.com/repos/${owner}/${repo}/contributors`,
    headers: {
      server: "GitHub.com",
      status: "200 OK",
      "x-oauth-scopes": "repo",
    },
    data: new Array(40 + faker.number.int(60)).fill(null).map(() => ({
      login: faker.internet.userName(),
      avatar_url: null,
      contributions: faker.number.int(1000),
    })),
  })
}
</file>

<file path="tests/mocks/api/github/rest/users/getByUsername.mjs">
/**Mocked data */
export default async function({faker}, target, that, [{username}]) {
  console.debug("metrics/compute/mocks > mocking rest api result > rest.repos.getByUsername")
  return ({
    status: 200,
    url: `https://api.github.com/users/${username}/`,
    headers: {
      server: "GitHub.com",
      status: "200 OK",
      "x-oauth-scopes": "repo",
    },
    data: {
      login: faker.internet.userName(),
      avatar_url: null,
      contributions: faker.number.int(1000),
    },
  })
}
</file>

<file path="tests/mocks/api/github/rest/users/listGpgKeysForUser.mjs">
/**Mocked data */
export default async function({faker}, target, that, [{username}]) {
  console.debug("metrics/compute/mocks > mocking rest api result > rest.users.listGpgKeysForUser")
  return ({
    status: 200,
    url: `https://api.github.com/users/${username}/`,
    headers: {
      server: "GitHub.com",
      status: "200 OK",
      "x-oauth-scopes": "repo",
    },
    data: [
      {
        key_id: faker.datatype.hexadecimal(16),
        raw_key: "-----BEGIN PGP PUBLIC KEY BLOCK-----\n(dummy content)\n-----END PGP PUBLIC KEY BLOCK-----",
        emails: [
          {
            email: faker.internet.email(),
            verified: true,
          },
        ],
      },
    ],
  })
}
</file>

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
lerna-debug.log*

# Diagnostic reports (https://nodejs.org/api/report.html)
report.[0-9]*.[0-9]*.[0-9]*.[0-9]*.json

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage
*.lcov

# nyc test coverage
.nyc_output

# Grunt intermediate storage (https://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# TypeScript v1 declaration files
typings/

# TypeScript cache
*.tsbuildinfo

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Microbundle cache
.rpt2_cache/
.rts2_cache_cjs/
.rts2_cache_es/
.rts2_cache_umd/

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variables file
.env
.env.test

# parcel-bundler cache (https://parceljs.org/)
.cache

# Next.js build output
.next

# Nuxt.js build / generate output
.nuxt
dist

# Gatsby files
.cache/
# Comment in the public line in if your project uses Gatsby and *not* Next.js
# https://nextjs.org/blog/next-9-1#public-directory-support
# public

# vuepress build output
.vuepress/dist

# Serverless directories
.serverless/

# FuseBox cache
.fusebox/

# DynamoDB Local files
.dynamodb/

# TernJS port file
.tern-port

# User settings
settings.json

# Community templates
source/templates/.community
source/templates/@*

# Preview
source/app/web/statics/preview

# Presets
.presets

# V4
.deno-make.json
.coverage
.secrets
.test
source/run/serve/static/app.js
metrics.config.yml
</file>

<file path="settings.example.json">
{
  "//": "Example of configuration for metrics web instance",
  "//": "====================================================================",

  "token": "GITHUB API TOKEN",          "//": "GitHub Personal Token (required)",
  "modes": ["embed", "insights"],       "//": "Web instance enabled modes",
  "restricted": [],                     "//": "Authorized users (empty to disable)",
  "maxusers": 0,                        "//": "Maximum users, (0 to disable)",
  "cached": 3600000,                    "//": "Cache time rendered metrics (0 to disable)",
  "ratelimiter": null,                  "//": "Rate limiter (see express-rate-limit documentation)",
  "port": 3000,                         "//": "Listening port",
  "optimize": true,                     "//": "SVG optimization",
  "debug": false,                       "//": "Debug logs",
  "debug.headless": false,              "//": "Debug puppeteer process",
  "mocked": false,                      "//": "Use mocked data instead of live APIs (use 'force' to use mocked token even if real token are defined)",
  "repositories": 100,                  "//": "Number of repositories to use",
  "padding": ["0", "8 + 11%"],          "//": "Image padding (default)",
  "outputs": ["svg", "png", "json"],    "//": "Image output formats (empty to enable all)",
  "hosted": {
    "by": "",                           "//": "Web instance host (displayed in footer)",
    "link": "",                         "//": "Web instance host link (displayed in footer)"
  },
  "oauth":{
    "id": null,                         "//": "GitHub OAUTH client id",
    "secret": null,                     "//": "GitHub OAUTH client secret",
    "url":"https://example.com",        "//": "GitHub OAUTH callback url (must be the same as the web instance host)"
  },
  "api":{
    "rest": null,                       "//": "GitHub REST API custom endpoint",
    "graphql": null,                    "//": "GitHub GraphQL API custom endpoint"
  },
  "control":{
    "token": null,                      "//": "Control token (can be used by external services to perform actions on instance, such as stopping it for redeploys)"
  },
  "community": {
    "templates": [],                    "//": "Additional community templates to setup"
  },
  "templates": {
    "default": "classic",               "//": "Default template",
    "enabled": [],                      "//": "Enabled templates (empty to enable all)"
  },
  "extras": {
    "default": false,                   "//": "Default extras state (advised to let 'false' unless in debug mode)",
    "features": false,                  "//": "Enable extra features (advised to let 'false' on web instances), see below for supported features",
                                        "//": "________________________________________________________________________",
                                        "//": "metrics.setup.community.templates | Allow community templates download",
                                        "//": "metrics.setup.community.presets   | Allow community presets usage",
                                        "//": "metrics.api.github.overuse        | Allow GitHub API intensive requests",
                                        "//": "metrics.api.*                     | Allow use of external API requests",
                                        "//": "metrics.cpu.overuse               | Allow CPU intensive requests",
                                        "//": "metrics.run.tempdir               | Allow access to temporary directory (I/O operations may be performed)",
                                        "//": "metrics.run.git                   | Allow to run git",
                                        "//": "metrics.run.licensed              | Allow to run licensed",
                                        "//": "metrics.run.user.cmd              | Allow to run ANY command by user (USE WITH CAUTION!)",
                                        "//": "metrics.run.puppeteer.scrapping   | Allow to run puppeteer to scrape data",
                                        "//": "metrics.run.puppeteer.user.css    | Allow to run CSS by user during puppeteer render",
                                        "//": "metrics.run.puppeteer.user.js     | Allow to run JavaScript by user during puppeteer render",
                                        "//": "metrics.npm.optional.*            | Allow use of specified dependency",
                                        "//": "________________________________________________________________________",
                                        "//": "Additional extra features when user is logged with GitHub",
    "logged": [
      "metrics.api.github.overuse"
    ]
  },
  "plugins.default": false,             "//": "Default plugin state (advised to let 'false' unless in debug mode)",
  "plugins": {                          "//": "Global plugin configuration",
    "isocalendar":{
      "enabled": false,                 "//": "Enable isocalendar plugin"
    },
    "languages":{
      "enabled": false,                 "//": "Enable languages plugin"
    },
    "stargazers":{
      "worldmap.token": null,           "//": "Stargazers worldmap token",
      "enabled": false,                 "//": "Enable stargazers plugin"
    },
    "lines":{
      "enabled": false,                 "//": "Enable lines plugin"
    },
    "topics":{
      "enabled": false,                 "//": "Enable topics plugin"
    },
    "stars":{
      "enabled": false,                 "//": "Enable stars plugin"
    },
    "licenses":{
      "enabled": false,                 "//": "Enable licenses plugin"
    },
    "habits":{
      "enabled": false,                 "//": "Enable habits plugin"
    },
    "contributors":{
      "enabled": false,                 "//": "Enable contributors plugin"
    },
    "followup":{
      "enabled": false,                 "//": "Enable followup plugin"
    },
    "reactions":{
      "enabled": false,                 "//": "Enable reactions plugin"
    },
    "people":{
      "enabled": false,                 "//": "Enable people plugin"
    },
    "sponsorships":{
      "enabled": false,                 "//": "Enable sponsorships plugin"
    },
    "sponsors":{
      "enabled": false,                 "//": "Enable sponsors plugin"
    },
    "repositories":{
      "enabled": false,                 "//": "Enable repositories plugin"
    },
    "discussions":{
      "enabled": false,                 "//": "Enable discussions plugin"
    },
    "starlists":{
      "enabled": false,                 "//": "Enable starlists plugin"
    },
    "calendar":{
      "enabled": false,                 "//": "Enable calendar plugin"
    },
    "achievements":{
      "enabled": false,                 "//": "Enable achievements plugin"
    },
    "notable":{
      "enabled": false,                 "//": "Enable notable plugin"
    },
    "activity":{
      "enabled": false,                 "//": "Enable activity plugin"
    },
    "traffic":{
      "enabled": false,                 "//": "Enable traffic plugin"
    },
    "code":{
      "enabled": false,                 "//": "Enable code plugin"
    },
    "gists":{
      "enabled": false,                 "//": "Enable gists plugin"
    },
    "projects":{
      "enabled": false,                 "//": "Enable projects plugin"
    },
    "introduction":{
      "enabled": false,                 "//": "Enable introduction plugin"
    },
    "skyline":{
      "enabled": false,                 "//": "Enable skyline plugin"
    },
    "support":{
      "enabled": false,                 "//": "Enable support plugin"
    },
    "pagespeed":{
      "token": "PageSpeed token",
      "enabled": false,                 "//": "Enable pagespeed plugin"
    },
    "tweets":{
      "token": "Twitter API token",
      "enabled": false,                 "//": "Enable tweets plugin"
    },
    "stackoverflow":{
      "enabled": false,                 "//": "Enable stackoverflow plugin"
    },
    "anilist":{
      "enabled": false,                 "//": "Enable aniList plugin"
    },
    "music":{
      "token": "Music provider token",
      "enabled": false,                 "//": "Enable music plugin"
    },
    "posts":{
      "enabled": false,                 "//": "Enable posts plugin"
    },
    "rss":{
      "enabled": false,                 "//": "Enable rss plugin"
    },
    "wakatime":{
      "token": "WakaTime API token",
      "enabled": false,                 "//": "Enable wakatime plugin"
    },
    "leetcode":{
      "enabled": false,                 "//": "Enable leetcode plugin"
    },
    "steam":{
      "token": "Steam token",
      "enabled": false,                 "//": "Enable steam plugin"
    },
    "16personalities":{
      "enabled": false,                 "//": "Enable 16personalities plugin"
    },
    "chess":{
      "token": "Chess platform token",
      "enabled": false,                 "//": "Enable chess plugin"
    },
    "crypto":{
      "enabled": false,                 "//": "Enable crypto plugin"
    },
    "fortune":{
      "enabled": false,                 "//": "Enable fortune plugin"
    },
    "nightscout":{
      "enabled": false,                 "//": "Enable nightscout plugin"
    },
    "poopmap":{
      "token": "PoopMap API token",
      "enabled": false,                 "//": "Enable poopmap plugin"
    },
    "screenshot":{
      "enabled": false,                 "//": "Enable screenshot plugin"
    },
    "splatoon":{
      "token": "Splatnet token",
      "statink.token": null,            "//": "stat.ink token",
      "enabled": false,                 "//": "Enable splatoon plugin"
    },
    "stock":{
      "token": "Yahoo Finance token",
      "enabled": false,                 "//": "Enable stock plugin"
    },
    "//": ""
  }
}
</file>

<file path=".github/actions/spelling/allow.txt">
appid
apikey
apiname
appdetails
appids
appinfo
deno
Flickr
gpgarmor
github
githubassets
https
IPlayer
ISteam
joinmastodon
leetcode
MBTI
Nie
npx
personaname
pgn
playerstats
rbga
rtime
scm
shas
splatoon
Splatnet
ssh
statink
STATINK
steamcommunity
steamid
steamids
steampowered
tdatum
timecreated
tspan
ubuntu
unlocktime
userid
xticked
xticks
yargsparser
yticked
webtoken
</file>

<file path=".github/readme/partials/documentation/setup/action.md">
# ‚öôÔ∏è Using GitHub Action on a profile repository (~10 min)

Setup a GitHub Action which runs periodically and pushes generated images to a repository.

## 0Ô∏è Setup a personal repository

Create a repository with the same name as your GitHub login (if it doesn't exist).

![Setup personal repository](/.github/readme/imgs/setup_personal_repository.light.png#gh-light-mode-only)
![Setup personal repository](/.github/readme/imgs/setup_personal_repository.dark.png#gh-dark-mode-only)

Its `README.md` will be displayed on your user profile:

![GitHub Profile Example](/.github/readme/imgs/example_github_profile.light.png#gh-light-mode-only)
![GitHub Profile Example](/.github/readme/imgs/example_github_profile.dark.png#gh-dark-mode-only)

## 1Ô∏è Create a GitHub personal token

> üí° A GitHub personal token is required since this action will fetch data that cannot be accessed through repository-scoped tokens (like [`${{ secrets.GITHUB_TOKEN }}` or `${{ github.token }}`](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#about-the-github_token-secret)) such as users, organizations, issues, pull requests, comments, commits, activity, etc.

From the `Developer settings` of your account settings, select `Personal access tokens` to create a new token.

No scopes are required, but additional one may be required depending on which features will be used. Each plugin documentation enumerates which scopes are required to make it work.

As a general rule, the following scopes may be required:
- `public_repo` for some plugins
- `read:org` for all organizations related metrics
- `repo` for all private repositories related metrics
  - `read:user` for some private repositories related metrics
- `read:packages` for some packages related metrics
- `read:project` for some projects related metrics
- `gist` for publishing renders to gists instead of a repository

> üí° For security reasons, it is advised to always use the least amount of scopes. It is possible to prevent security issues by [forking this repository](https://github.com/lowlighter/metrics/fork) and using it in your workflow instead (more information available in step 3)

![Setup a GitHub personal token](/.github/readme/imgs/setup_personal_token.light.png#gh-light-mode-only)
![Setup a GitHub personal token](/.github/readme/imgs/setup_personal_token.dark.png#gh-dark-mode-only)

A scope-less token can still display private contributions by enabling `Include private contributions on my profile` in account settings:

![Enable "Include private contributions on my profile`"](/.github/readme/imgs/setup_private_contributions.light.png#gh-light-mode-only)
![Enable "Include private contributions on my profile`"](/.github/readme/imgs/setup_private_contributions.dark.png#gh-dark-mode-only)

When a plugin has not enough scopes to operate (and `plugins_errors_fatal` is disabled), an error will be reported in the rendering like below:

![Plugin error example](https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.error.svg)

## 2Ô∏è Put your GitHub personal token in repository secrets

Go to the `Settings` of your repository and to create a new secret and paste your freshly generated GitHub token there.

![Setup a repository secret](/.github/readme/imgs/setup_repository_secret.light.png#gh-light-mode-only)
![Setup a repository secret](/.github/readme/imgs/setup_repository_secret.dark.png#gh-dark-mode-only)

## 3Ô∏è Setup GitHub Action workflow

Create a new workflow from the `Actions` tab of repository and paste the following:

```yaml
name: Metrics
on:
  # Schedule daily updates
  schedule: [{cron: "0 0 * * *"}]
  # (optional) Run workflow manually
  workflow_dispatch:
  # (optional) Run workflow when pushing on master/main
  push: {branches: ["master", "main"]}
jobs:
  github-metrics:
    runs-on: ubuntu-latest
    environment: 
      name: production
    permissions:
      contents: write
    steps:
      - uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
```

Default output action is to commit rendered metrics to target repository on each run.

![Action update example](/.github/readme/imgs/example_action_update.light.png#gh-light-mode-only)
![Action update example](/.github/readme/imgs/example_action_update.dark.png#gh-dark-mode-only)

Use [`output_action`](/source/plugins/core/README.md#-configuring-output-action) to change this behaviour to use either pull requests, gists or manually handle renders.

### 3Ô∏è.1Ô∏è Choosing between `@latest`, `@master`/`@main`, a fork or a pinned version

There are several *metrics* versions that can be used in workflows:

- `@latest`
  - ‚úîÔ∏è Stable version
- `@master`/`@main`
  - ‚úîÔ∏è Enjoy new features and bug fixes as they're being released
  - ‚úîÔ∏è Helps discovering new issues
  - ‚ûñ Jobs may fail occasionally (watch [issues](https://github.com/lowlighter/metrics/issues) and [discussions](https://github.com/lowlighter/metrics/discussions) for bug tracking)
- `@{fork}`
  - ‚úîÔ∏è Secure as you're in control
  - ‚úîÔ∏è Advised when using additional scopes in personal access token
  - ‚ûñ Manual updates (watch new [releases](https://github.com/lowlighter/metrics/releases) for updates)
- `@v{x}.{x}`
  - ‚ûñ Pinned versions have no real advantages

> üí° Workflows are always compatible with previous version as *metrics* workflow-breaking changes are never introduced. In fact, even workflows from v1.0 are still compatible!

*Example: using a forked version*
```yaml
  - uses: user/metrics@master
```

> ‚ö†Ô∏è Be sure to use the default branch (`@master`) on forks to apply any changes made!

### 3Ô∏è.2Ô∏è Configure *metrics*

Read [documentation](/README.md#-documentation) for more informations about configuration.
It is advised to start with [`üß± core`](/source/plugins/core/README.md) plugin documentation.

It is also possible to use [metrics.lecoq.io](https://metrics.lecoq.io) to play with configuration options, preview renders and finally copy the auto-generated workflow code.

## 4Ô∏è Add images to your profile `README.md`

Update profile `README.md` to include rendered image (filename may differ if `filename` option has been set, use the correct path accordingly).

*Example: add rendered image with markdown*
```markdown
![Metrics](/github-metrics.svg)
```

*Example: add rendered image with html for more customization*
```html
<p align="center"><img src="/github-metrics.svg" alt="Metrics" width="400"></p>
```

*Example: add rendered image and prevent GitHub from auto linking to the image*
```html
<picture>
  <img src="/github-metrics.svg" alt="Metrics">
</picture>
```

*Example: add rendered image when using `config_display: columns`*
```html
<img src="/github-metrics.svg" alt="Metrics" width="100%">
```
</file>

<file path=".github/scripts/markdown_example.mjs">
//Imports
import puppeteer from "puppeteer"

//Setup browser
const browser = await puppeteer.launch({
  headless: "new",
  executablePath: process.env.PUPPETEER_BROWSER_PATH,
  args: ["--no-sandbox", "--disable-extensions", "--disable-setuid-sandbox", "--disable-dev-shm-usage"],
  ignoreDefaultArgs: ["--disable-extensions"],
})
const page = await browser.newPage()

//Select markdown example and take screenshot
await page.setViewport({width: 600, height: 600})
await page.goto("https://github.com/lowlighter/metrics/blob/examples/metrics.markdown.md")
await page.waitForSelector("article.markdown-body")
await new Promise(solve => setTimeout(solve, 4000))
const clip = await page.evaluate(() => {
  const {x, y, width, height} = document.querySelector("article.markdown-body").getBoundingClientRect()
  return {x, y, width, height}
})
await page.screenshot({type: "png", path: "/tmp/metrics.markdown.png", clip, omitBackground: true})
await browser.close()
</file>

<file path=".github/workflows/ci.yml">
name: Continuous integration

on:
  push:
    branches: [ master ]

jobs:

  # Build, test and analyze
  build-test-analyze:
    name: Build, test and analyze
    if: "!contains(github.event.head_commit.message, '[skip test]')"
    uses: lowlighter/metrics/.github/workflows/test.yml@master

  # Format code
  format:
    name: Format code
    runs-on: ubuntu-latest
    needs: [ build-test-analyze ]
    if: always() && (needs.build-test-analyze.result == 'success' || needs.build-test-analyze.result == 'skipped')
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Checkout master
        run: git checkout master
      - name: Format code
        run: |
          npm install -g dprint
          mkdir -v -p /home/runner/.cache/dprint/cache
          npx dprint fmt --config .github/config/dprint.json
      - name: Publish formatted code
        run: |
          set +e
          git config user.name github-actions[bot]
          git config user.email 41898282+github-actions[bot]@users.noreply.github.com
          git add --all
          git commit -m "chore: code formatting"
          git push
          set -e

  # Update plugins and template indexes, along with README.md
  update-indexes:
    name: Publish rebuilt metrics indexes
    runs-on: ubuntu-latest
    needs: [ format ]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Setup NodeJS
        uses: actions/setup-node@v3
        with:
          node-version: 20
      - name: Pull changes
        run: |
          git checkout master
          git pull
      - name: Setup metrics
        run: npm ci
      - name: Publish rebuild metrics indexes
        run: npm run build -- publish

  # Rebase main branch on master
  update-main:
    name: Rebase main on master
    runs-on: ubuntu-latest
    needs: [ update-indexes ]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Setup NodeJS
        uses: actions/setup-node@v3
        with:
          node-version: 20
      - name: Pull
        run: git pull
      - name: Checkout main
        run: git checkout main
      - name: Rebase main on master
        run: git merge master
      - name: Push main
        run: git push origin main

  # Build docker image from master and publish it to GitHub registry
  docker-master:
    name: Publish master to GitHub registry
    runs-on: ubuntu-latest
    needs: [ update-indexes ]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Login to GitHub registry
        run: echo ${{ github.token }} | docker login ghcr.io -u ${{ github.actor }} --password-stdin
      - name: Build docker image
        run: docker build -t ghcr.io/lowlighter/metrics:master .
      - name: Publish to GitHub registry
        run: docker push ghcr.io/lowlighter/metrics:master
      - name: Tag docker image (beta) and publish to GitHub registry
        run: |
          set +e
          METRICS_VERSION=$(cat package.json | grep -Po '(?<="version": ")\d+[.]\d+(?=[.]0-beta")')
          METRICS_VERSION_BETA="$METRICS_VERSION-beta"
          set -e
          if [[ ! -z "$METRICS_VERSION" ]]; then
            echo "Beta version: v$METRICS_VERSION_BETA"
            docker tag ghcr.io/lowlighter/metrics:master ghcr.io/lowlighter/metrics:$(echo "v$METRICS_VERSION_BETA")
            docker push ghcr.io/lowlighter/metrics:$(echo "v$METRICS_VERSION_BETA")
          fi
      - name: Tag docker image (main) and publish to GitHub registry
        run: |
          docker tag ghcr.io/lowlighter/metrics:master ghcr.io/lowlighter/metrics:main
          docker push ghcr.io/lowlighter/metrics:main

  # Deploy to beta-metrics.lecoq.io
  deploy-master:
    name: Deploy lowlighter/metrics@master
    runs-on: ubuntu-latest
    needs: [ docker-master ]
    steps:
      - name: Deploy web instance
        run: "curl -X POST -H 'Authorization: ${{ secrets.WEB_DEPLOY_BETA_TOKEN }}' https://beta-metrics.lecoq.io/.control/stop"
      - name: Wait for redeploy
        run: sleep 120
      - name: Check deployment status
        run: "curl --retry 15 --retry-delay 60 https://beta-metrics.lecoq.io/.version"

  # Test lowlighter/metrics@master
  action-master-test:
    name: Test lowlighter/metrics@master
    runs-on: ubuntu-latest
    needs: [ docker-master ]
    steps:
      - name: Run tests
        uses: lowlighter/metrics@master
        with:
          token: MOCKED_TOKEN
          plugins_errors_fatal: yes
          dryrun: yes
          use_mocked_data: yes
          verify: yes

  # Publish examples
  publish-examples:
    name: Publish examples
    needs: [ action-master-test ]
    uses: lowlighter/metrics/.github/workflows/examples.yml@master
    secrets:
      METRICS_TOKEN: ${{ secrets.METRICS_TOKEN }}
      METRICS_TOKEN_WITH_SCOPES: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}
      METRICS_TOKEN_PERSONAL: ${{ secrets.METRICS_TOKEN_PERSONAL }}
      CHESS_TOKEN: ${{ secrets.CHESS_TOKEN }}
      PAGESPEED_TOKEN: ${{ secrets.PAGESPEED_TOKEN }}
      GOOGLE_MAP_TOKEN: ${{ secrets.GOOGLE_MAP_TOKEN }}
      SPLATOON_TOKEN: ${{ secrets.SPLATOON_TOKEN }}
      SPLATOON_STATINK_TOKEN: ${{ secrets.SPLATOON_STATINK_TOKEN }}
      SIXTEEN_PERSONALITIES_URL: ${{ secrets.SIXTEEN_PERSONALITIES_URL }}
      SPOTIFY_TOKENS: ${{ secrets.SPOTIFY_TOKENS }}
      STOCK_TOKEN: ${{ secrets.STOCK_TOKEN }}
      TWITTER_TOKEN: ${{ secrets.TWITTER_TOKEN }}
      WAKATIME_TOKEN: ${{ secrets.WAKATIME_TOKEN }}

  # Publish examples (presets)
  publish-examples-presets:
    name: Publish examples (presets)
    needs: [ action-master-test ]
    uses: lowlighter/metrics/.github/workflows/examples.presets.yml@master

  # Build docker image from master and publish it to GitHub registry with release tag
  docker-release:
    name: Publish release to GitHub registry
    runs-on: ubuntu-latest
    needs: [ publish-examples ]
    if: contains(github.event.head_commit.message, '[release]')
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Login to GitHub registry
        run: echo ${{ github.token }} | docker login ghcr.io -u ${{ github.actor }} --password-stdin
      - name: Pull docker image (master)
        run: docker pull ghcr.io/lowlighter/metrics:master
      - name: Tag docker image (release)
        env:
          GITHUB_COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
        run: docker tag ghcr.io/lowlighter/metrics:master ghcr.io/lowlighter/metrics:$(echo $GITHUB_COMMIT_MESSAGE | grep -Po 'v\d+[.]\d+')
      - name: Publish release to GitHub registry
        env:
          GITHUB_COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
        run: docker push ghcr.io/lowlighter/metrics:$(echo $GITHUB_COMMIT_MESSAGE | grep -Po 'v\d+[.]\d+')
      - name: Tag docker image (latest)
        run: docker tag ghcr.io/lowlighter/metrics:master ghcr.io/lowlighter/metrics:latest
      - name: Publish latest to GitHub registry
        run: docker push ghcr.io/lowlighter/metrics:latest

  # Rebase latest branch on master
  update-latest:
    name: Rebase latest on master
    runs-on: ubuntu-latest
    needs: [ docker-release ]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Setup NodeJS
        uses: actions/setup-node@v3
        with:
          node-version: 20
      - name: Setup metrics
        run: npm ci
      - name: Pull
        run: git pull
      - name: Checkout latest
        run: git checkout latest
      - name: Rebase latest on master
        run: git merge master
      - name: Push latest
        run: git push origin latest

  # Test lowlighter/metrics@latest
  action-latest-test:
    name: Test lowlighter/metrics@latest
    runs-on: ubuntu-latest
    needs: [ update-latest ]
    steps:
      - name: Run tests
        uses: lowlighter/metrics@latest
        with:
          token: MOCKED_TOKEN
          plugins_errors_fatal: yes
          dryrun: yes
          use_mocked_data: yes
          verify: yes

  # Deploy to metrics.lecoq.io
  deploy-latest:
    name: Deploy lowlighter/metrics@latest
    runs-on: ubuntu-latest
    needs: [ docker-release, deploy-master ]
    steps:
      - name: Deploy web instance
        run: "curl -X POST -H 'Authorization: ${{ secrets.WEB_DEPLOY_TOKEN }}' https://metrics.lecoq.io/.control/stop"
      - name: Wait for redeploy
        run: sleep 120
      - name: Check deployment status
        run: "curl --retry 15 --retry-delay 60 https://metrics.lecoq.io/.version"

  # Publish GitHub release
  publish-release:
    name: Publish release
    runs-on: ubuntu-latest
    needs: [ action-latest-test, deploy-latest ]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Setup NodeJS
        uses: actions/setup-node@v3
        with:
          node-version: 20
      - name: Setup metrics
        run: npm ci
      - name: Publish release
        run: node .github/scripts/release.mjs
        env:
          GITHUB_TOKEN: ${{ github.token }}
          GITHUB_REPOSITORY: ${{ github.repository }}
          GITHUB_COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
</file>

<file path=".github/workflows/publish-docker.yml">
name: Publish Docker Image

on:
  workflow_dispatch:

jobs:
  push_to_registry:
    name: Build and Push Docker Image
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
      
    steps:
      - name: Check out the repo
        uses: actions/checkout@v4

      # ‚ñº ËøΩÂä†: Docker Buildx „ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÔºà„Ç≠„É£„ÉÉ„Ç∑„É•Á≠â„ÅåÂäπ„Åç„ÇÑ„Åô„Åè„Å™„ÇãÔºâ
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      # ‚ñº ËøΩÂä†: „Ç§„É°„Éº„Ç∏Âêç„ÇíÂÆöÁæ©Ôºà„Åì„Åì„ÅßËá™ÂãïÁöÑ„Å´Â∞èÊñáÂ≠ó„Å´Â§âÊèõ„Åï„Çå„Åæ„ÅôÔºâ
      - name: Extract metadata (tags, labels) for Docker
        id: meta
        uses: docker/metadata-action@v5
        with:
          images: ghcr.io/${{ github.repository }}
          tags: |
            type=raw,value=master

      - name: Log in to the Container registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: .
          push: true
          # ‚ñº ‰øÆÊ≠£: metadata„Ç¢„ÇØ„Ç∑„Éß„É≥„ÅßÁîüÊàê„Åï„Çå„Åü„Çø„Ç∞ÔºàÂ∞èÊñáÂ≠óÔºâ„Çí‰ΩøÁî®
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
          # „Éì„É´„ÉâÈ´òÈÄüÂåñ„ÅÆ„Åü„ÇÅ„ÅÆ„Ç≠„É£„ÉÉ„Ç∑„É•Ë®≠ÂÆöÔºàÊé®Â•®Ôºâ
          cache-from: type=gha
          cache-to: type=gha,mode=max
</file>

<file path=".github/workflows/test.yml">
name: Build, test and analyze

on:
  pull_request:
    branches: [ master ]
  workflow_call:

jobs:

  # Run linter to ensure new code respect coding rules
  lint:
    name: Lint code
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Setup NodeJS
        uses: actions/setup-node@v3
        with:
          node-version: 20
      - name: Setup metrics
        run: npm ci
      - name: Check contributions requirements
        run: npm run test-contrib
        env:
          PR_AUTHOR: ${{ github.event.pull_request.user.login }}
      - name: Run linter
        run: npm run linter

  # Build docker image from branch and run tests
  build:
    name: Build and test
    runs-on: ubuntu-latest
    needs: [ lint ]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Format code with dprint
        run: |
          npm install -g dprint
          mkdir -v -p /home/runner/.cache/dprint/cache
          npx dprint fmt --config .github/config/dprint.json
      - name: Build lowlighter/metrics:${{ github.head_ref || 'master' }}
        env:
          GIT_REF: ${{ github.head_ref || 'master' }}
        run: docker build -t lowlighter/metrics:$(echo $GIT_REF | sed 's/[^a-z]/-/g') .
      - name: Run tests
        env:
          GIT_REF: ${{ github.head_ref || 'master' }}
        run: docker run --rm --entrypoint="" lowlighter/metrics:$(echo $GIT_REF | sed 's/[^a-z]/-/g') npm run test-metrics

  # Run CodeQL on branch
  analyze:
    name: Analyze code
    runs-on: ubuntu-latest
    needs: [ lint ]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Setup CodeQL
        uses: github/codeql-action/init@v2
        with:
          languages: javascript
          config-file: ./.github/config/codeql.yml
      - name: Analyze code
        uses: github/codeql-action/analyze@v2
</file>

<file path="source/plugins/achievements/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üèÜ Achievements</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays several highlights about what an account has achieved on GitHub.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Compact display</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.achievements.compact.svg" alt=""></img></details>
      <details><summary>Detailed display</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.achievements.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_achievements</code></h4></td>
    <td rowspan="2"><p>Enable achievements plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.run.puppeteer.scrapping</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_achievements_threshold</code></h4></td>
    <td rowspan="2"><p>Rank threshold filter</p>
<p>Use <code>X</code> to display achievements not yet unlocked</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> C<br>
<b>allowed values:</b><ul><li>S</li><li>A</li><li>B</li><li>C</li><li>X</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_achievements_secrets</code></h4></td>
    <td rowspan="2"><p>Secrets achievements</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_achievements_display</code></h4></td>
    <td rowspan="2"><p>Display style</p>
<ul>
<li><code>detailed</code>: display icon, name, description and ranking</li>
<li><code>compact</code>: display icon, name and value</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> detailed<br>
<b>allowed values:</b><ul><li>detailed</li><li>compact</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_achievements_limit</code></h4></td>
    <td rowspan="2"><p>Display limit</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 0<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_achievements_ignored</code></h4></td>
    <td rowspan="2"><p>Ignored achievements</p>
<p>Use achievements names without their rank adjective (i.e. without &quot;great&quot;, &quot;super&quot; or &quot;master&quot;)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_achievements_only</code></h4></td>
    <td rowspan="2"><p>Showcased achievements</p>
<p>Use achievements names without their rank adjective (i.e. without &quot;great&quot;, &quot;super&quot; or &quot;master&quot;)</p>
<p>This option is equivalent to <a href="/source/plugins/achievements/README.md#plugin_achievements_ignored"><code>plugin_achievements_ignored</code></a> with all existing achievements except the ones listed in this option</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Detailed display
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.achievements.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_achievements: yes
  plugin_achievements_only: sponsor, maintainer, octonaut

```
```yaml
name: Compact display
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.achievements.compact.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_achievements: yes
  plugin_achievements_only: >-
    polyglot, stargazer, sponsor, deployer, member, maintainer, developer,
    scripter, packager, explorer, infographile, manager
  plugin_achievements_display: compact
  plugin_achievements_threshold: X

```
<!--/examples-->
</file>

<file path="source/plugins/activity/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üì∞ Recent activity</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays recent activity on GitHub.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/markdown/README.md"><code>üìí Markdown template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.activity.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_activity</code></h4></td>
    <td rowspan="2"><p>Enable activity plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_activity_limit</code></h4></td>
    <td rowspan="2"><p>Display limit</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 1000)</i>
<br>
<b>default:</b> 5<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_activity_load</code></h4></td>
    <td rowspan="2"><p>Events to load</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(100 ‚â§
ùë•
‚â§ 1000)</i>
<br>
<b>default:</b> 300<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_activity_days</code></h4></td>
    <td rowspan="2"><p>Events maximum age</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 365)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 14<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_activity_visibility</code></h4></td>
    <td rowspan="2"><p>Events visibility</p>
<p>Can be used to toggle private activity visibility when using a token with <code>repo</code> scope</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> all<br>
<b>allowed values:</b><ul><li>public</li><li>all</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_activity_timestamps</code></h4></td>
    <td rowspan="2"><p>Events timestamps</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_activity_skipped</code></h4></td>
    <td rowspan="2"><p>Skipped repositories</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è© Inherits <code>repositories_skipped</code><br>
<b>type:</b> <code>array</code>
<i>(newline-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_activity_ignored</code></h4></td>
    <td rowspan="2"><p>Ignored users</p>
<p>Can be used to ignore bots activity</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è© Inherits <code>users_ignored</code><br>
<b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_activity_filter</code></h4></td>
    <td rowspan="2"><p>Events types</p>
<p>These are fetched from <a href="https://docs.github.com/en/free-pro-team@latest/developers/webhooks-and-events/github-event-types">GitHub events API</a> and the following types are currently supported:</p>
<ul>
<li><code>push</code>: Push of commits</li>
<li><code>issue</code>: Opening/Reopening/Closing of issues</li>
<li><code>pr</code>: Opening/Closing of pull requests</li>
<li><code>ref/create</code>: Creation of git tags or git branches</li>
<li><code>ref/delete</code>: Deletion of git tags or git branches</li>
<li><code>release</code>: Publication of new releases</li>
<li><code>review</code>: Review of pull requests</li>
<li><code>comment</code>: Comments on commits, issues and pull requests</li>
<li><code>wiki</code>: Changes of wiki pages</li>
<li><code>fork</code>: Forking of repositories</li>
<li><code>star</code>: Starring of repositories</li>
<li><code>public</code>: Repositories made public</li>
<li><code>member</code>: Addition of new collaborator in repository</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> all<br>
<b>allowed values:</b><ul><li>all</li><li>comment</li><li>ref/create</li><li>ref/delete</li><li>release</li><li>push</li><li>issue</li><li>pr</li><li>review</li><li>wiki</li><li>fork</li><li>star</li><li>member</li><li>public</li></ul></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Recent activity
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.activity.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_activity: yes
  plugin_activity_limit: 5
  plugin_activity_days: 0
  plugin_activity_filter: issue, pr, release, fork, review, ref/create

```
<!--/examples-->
</file>

<file path="source/plugins/anilist/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üå∏ Anilist watch list and reading list</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays favorites animes, mangas and characters from a <a href="https://anilist.co">AniList</a> account.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://anilist.co">AniList</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code></td>
  </tr>
  <tr>
    <td><i>No tokens are required for this plugin</i></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>For anime watchers</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.anilist.svg" alt=""></img></details>
      <details><summary>For manga readers</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.anilist.manga.svg" alt=""></img></details>
      <details open><summary>For waifus simp</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.anilist.characters.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_anilist</code></h4></td>
    <td rowspan="2"><p>Enable aniList plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.run.puppeteer.scrapping</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_anilist_user</code></h4></td>
    <td rowspan="2"><p>AniList login</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>string</code>
<br>
<b>default:</b> <code>‚Üí User login</code><br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_anilist_medias</code></h4></td>
    <td rowspan="2"><p>Medias types</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> anime, manga<br>
<b>allowed values:</b><ul><li>anime</li><li>manga</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_anilist_sections</code></h4></td>
    <td rowspan="2"><p>Displayed sections</p>
<ul>
<li><code>favorites</code> will display favorites from <code>plugin_anilist_medias</code></li>
<li><code>watching</code> will display animes currently in watching list</li>
<li><code>reading</code> will display manga currently in reading list</li>
<li><code>characters</code> will display liked characters</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> favorites<br>
<b>allowed values:</b><ul><li>favorites</li><li>watching</li><li>reading</li><li>characters</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_anilist_limit</code></h4></td>
    <td rowspan="2"><p>Display limit (medias)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 2<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_anilist_limit_characters</code></h4></td>
    <td rowspan="2"><p>Display limit (characters)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 22<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_anilist_shuffle</code></h4></td>
    <td rowspan="2"><p>Shuffle data</p>
<p>Can be used to create varied outputs</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Favorites anime and currently watching
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.anilist.svg
  token: NOT_NEEDED
  base: ""
  plugin_anilist: yes
  plugin_anilist_medias: anime
  plugin_anilist_sections: favorites, watching
  plugin_anilist_limit: 1

```
```yaml
name: Favorites manga and currently reading
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.anilist.manga.svg
  token: NOT_NEEDED
  base: ""
  plugin_anilist: yes
  plugin_anilist_medias: manga
  plugin_anilist_sections: favorites, reading
  plugin_anilist_limit: 1

```
```yaml
name: Favorites characters
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.anilist.characters.svg
  token: NOT_NEEDED
  base: ""
  plugin_anilist: yes
  plugin_anilist_sections: characters
  plugin_anilist_limit_characters: 22

```
<!--/examples-->
</file>

<file path="source/plugins/base/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üóÉÔ∏è Base content</h3></th></tr>
  <tr><td colspan="2" align="center"></td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a> <a href="/source/templates/terminal/README.md"><code>üìô Terminal template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
<td colspan="2"><table><tr>
<td align="center">
<img src="https://github.com/lowlighter/metrics/blob/examples/metrics.classic.svg" alt=""></img>
</td>
<td align="center">
<img src="https://github.com/lowlighter/metrics/blob/examples/metrics.organization.svg" alt=""></img>
</td>
</tr></table></td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>base</code></h4></td>
    <td rowspan="2"><p>Base content</p>
<p>The following sections are supported:</p>
<ul>
<li><code>header</code>, which usually contains username, two-weeks commits calendars and a few additional data</li>
<li><code>activity</code>, which contains recent activity (commits, pull requests, issues, etc.)</li>
<li><code>community</code>, which contains community stats (following, sponsors, organizations, etc.)</li>
<li><code>repositories</code>, which contains repository stats (license, forks, stars, etc.)</li>
<li><code>metadata</code>, which contains information about generated metrics</li>
</ul>
<p>These are all enabled by default, but it is possible to explicitly opt out from them.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> header, activity, community, repositories, metadata<br>
<b>allowed values:</b><ul><li>header</li><li>activity</li><li>community</li><li>repositories</li><li>metadata</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>base_indepth</code></h4></td>
    <td rowspan="2"><p>Indepth mode</p>
<p>Enabling this will consume additional API queries to fetch more data.
This currently improves the accuracy of the following statistics:</p>
<ul>
<li>total commits</li>
<li>total issues</li>
<li>total pull requests</li>
<li>total pull requests reviews</li>
<li>total repositories contributed to</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.api.github.overuse</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>base_hireable</code></h4></td>
    <td rowspan="2"><p>Show <code>Available for hire!</code> in header section</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>base_skip</code></h4></td>
    <td rowspan="2"><p>Skip base content</p>
<blockquote>
<p>‚ö†Ô∏è Any plugin that relies on base content data may break!
Only use this option when using a plugin that can be configured with <a href="/source/plugins/core/README.md#token"><code>token: NOT_NEEDED</code></a></p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>repositories</code></h4></td>
    <td rowspan="2"><p>Fetched repositories</p>
<p>A higher value result in more accurate metrics but can hit GitHub API rate-limit more easily (especially with a lot of plugins enabled)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>default:</b> 100<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>repositories_batch</code></h4></td>
    <td rowspan="2"><p>Fetched repositories per query</p>
<p>If you receive <code>Something went wrong while executing your query</code> (which is usually caused by API timeouts), lowering this value may help.
This setting may not be supported by all plugins.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 100)</i>
<br>
<b>default:</b> 100<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>repositories_forks</code></h4></td>
    <td rowspan="2"><p>Include forks</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>repositories_affiliations</code></h4></td>
    <td rowspan="2"><p>Repositories affiliations</p>
<ul>
<li><code>owner</code>: owned repositories</li>
<li><code>collaborator</code>: repositories with push access</li>
<li><code>organization_member</code>: repositories from an organization where user is a member</li>
</ul>
<p>Some plugin outputs may be affected by this setting too.</p>
<p>Set to <code>&quot;&quot;</code> to disable and fetch all repositories related to given account.
Broad affiliations will result in less representative metrics.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> owner<br>
<b>allowed values:</b><ul><li>owner</li><li>collaborator</li><li>organization_member</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>repositories_skipped</code></h4></td>
    <td rowspan="2"><p>Default skipped repositories</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è≠Ô∏è Global option<br>
<b>type:</b> <code>array</code>
<i>(newline-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>users_ignored</code></h4></td>
    <td rowspan="2"><p>Default ignored users</p>
<p>Note that emails are only supported in commits-related elements.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è≠Ô∏è Global option<br>
<b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> github-actions[bot], dependabot[bot], dependabot-preview[bot], actions-user, action@github.com<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>commits_authoring</code></h4></td>
    <td rowspan="2"><p>Identifiers that has been used for authoring commits</p>
<p>Specify names, surnames, username, email addresses that has been used in the past that can be used to detect commits ownerships in some plugins</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è≠Ô∏è Global option<br>
‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> <code>‚Üí User login</code><br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Default metrics
uses: lowlighter/metrics@latest
with:
  filename: metrics.base.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: header, activity, community, repositories, metadata

```
<!--/examples-->
</file>

<file path="source/plugins/calendar/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üìÜ Commit calendar</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin can display commit calendar across several years.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details><summary>Current year</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.calendar.svg" alt=""></img></details>
      <details open><summary>Full history</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.calendar.full.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_calendar</code></h4></td>
    <td rowspan="2"><p>Enable calendar plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_calendar_limit</code></h4></td>
    <td rowspan="2"><p>Years to display</p>
<p>This option has different behaviours depending on its value:</p>
<ul>
<li><code>n &gt; 0</code> will display the last <code>n</code> years, relative to current year</li>
<li><code>n == 0</code> will display all years starting from GitHub account registration date</li>
<li><code>n &lt; 0</code> will display all years plus <code>n</code> additional years, relative to GitHub account registration date<ul>
<li>Use this when there are commits pushed before GitHub registration</li>
</ul>
</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 1<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Current year calendar
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.calendar.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_calendar: yes

```
```yaml
name: Full history calendar
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.calendar.full.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_calendar: yes
  plugin_calendar_limit: 0

```
<!--/examples-->
</file>

<file path="source/plugins/code/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>‚ôê Random code snippet</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays a random code snippet from recent activity history.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr><th>‚Ñπ Additional notes</th><td><blockquote>
<p>‚ö†Ô∏è When improperly configured, this plugin could display private code.
If you work with sensitive data or company code, it is advised to keep this plugin disabled.
Use at your own risk, <em>metrics</em> and its authors cannot be held responsible for any resulting code leaks.</p>
</blockquote>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.code.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_code</code></h4></td>
    <td rowspan="2"><p>Enable code plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_code_lines</code></h4></td>
    <td rowspan="2"><p>Display limit (lines per code snippets)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 128)</i>
<br>
<b>default:</b> 12<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_code_load</code></h4></td>
    <td rowspan="2"><p>Events to load</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(100 ‚â§
ùë•
‚â§ 1000)</i>
<br>
<b>default:</b> 400<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_code_days</code></h4></td>
    <td rowspan="2"><p>Events maximum age</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 365)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 3<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_code_visibility</code></h4></td>
    <td rowspan="2"><p>Events visibility</p>
<p>Can be used to toggle private activity visibility when using a token with <code>repo</code> scope</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> public<br>
<b>allowed values:</b><ul><li>public</li><li>all</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_code_skipped</code></h4></td>
    <td rowspan="2"><p>Skipped repositories</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è© Inherits <code>repositories_skipped</code><br>
<b>type:</b> <code>array</code>
<i>(newline-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_code_languages</code></h4></td>
    <td rowspan="2"><p>Showcased languages</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: JavaScript or TypeScript snippet of the day
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.code.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_code: yes
  plugin_code_languages: javascript, typescript
  plugin_code_load: 400

```
<!--/examples-->
</file>

<file path="source/plugins/community/chess/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>‚ôüÔ∏è Chess</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays the last game you played on a supported chess platform.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with any of the supported provider.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
<tr><th>Authors</th><td><a href="https://github.com/lowlighter">@lowlighter</a></td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üóùÔ∏è plugin_chess_token</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.chess.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_chess</code></h4></td>
    <td rowspan="2"><p>Enable chess plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_chess_token</code></h4></td>
    <td rowspan="2"><p>Chess platform token</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üîê Token<br>
üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.api.chess.any</i></li>
</ul>
<b>type:</b> <code>token</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_chess_user</code></h4></td>
    <td rowspan="2"><p>Chess platform login</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>string</code>
<br>
<b>default:</b> <code>‚Üí User login</code><br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_chess_platform</code></h4></td>
    <td rowspan="2"><p>Chess platform</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>allowed values:</b><ul><li>lichess.org</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_chess_animation</code></h4></td>
    <td rowspan="2"><p>Animation settings</p>
<ul>
<li><code>size</code> is the size of a single chessboard square in pixels (board will be 8 times larger)</li>
<li><code>delay</code> is the delay before starting animation (in seconds)</li>
<li><code>duration</code> is the duration of the animation of a move (in seconds)</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>json</code>
<br>
<b>default:</b> <details><summary>‚Üí Click to expand</summary><pre language="json"><code>{
  "size": 40,
  "delay": 3,
  "duration": 0.6
}
</code></pre></details><br></td>
  </tr>
</table>
<!--/options-->

## üóùÔ∏è Obtaining a lichess.org token

Create a [lichess.org account](https://lichess.org) and select [API access tokens](https://lichess.org/account/oauth/token) to get a token.

![lichess.org token](/.github/readme/imgs/plugin_chess_lichess_token_0.png)

It is not necessary to add additional scopes:

![lichess.org token](/.github/readme/imgs/plugin_chess_lichess_token_1.png)

Create token and store it in your secrets:

![lichess.org token](/.github/readme/imgs/plugin_chess_lichess_token_0.png)

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Last chess game from lichess.org
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.chess.svg
  token: NOT_NEEDED
  base: ""
  plugin_chess: yes
  plugin_chess_token: ${{ secrets.CHESS_TOKEN }}
  plugin_chess_platform: lichess.org

```
<!--/examples-->
</file>

<file path="source/plugins/community/crypto/examples.yml">
- name: Crypto Metrics
  uses: lowlighter/metrics@latest
  with:
    filename: metrics.plugin.crypto.svg
    token: NOT_NEEDED
    base: ""
    plugin_crypto: yes
    plugin_crypto_id: bitcoin
    plugin_crypto_vs_currency: usd
    plugin_crypto_days: 1
    plugin_crypto_precision: 2
  prod:
    skip: true
  test:
    skip: true
</file>

<file path="source/plugins/community/crypto/index.mjs">
//Setup
export default async function({login, q, imports, data, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.crypto) || (!imports.metadata.plugins.crypto.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {id, days, vs_currency, precision} = imports.metadata.plugins.crypto.inputs({data, account, q})
    if (!id)
      throw {error: {message: "Crypto currency id is not set"}}

    console.debug(`metrics/compute/${login}/plugins > crypto > querying api for crypto`)

    const {
      data: coin,
    } = await imports.axios.get(`https://api.coingecko.com/api/v3/coins/${id}`, {
      params: {
        market_data: true,
      },
    })

    if (!coin)
      throw {error: {message: "Crypto currency not found"}}

    const {
      data: {prices},
    } = await imports.axios.get(`https://api.coingecko.com/api/v3/coins/${id}/market_chart`, {
      params: {
        vs_currency,
        days,
        precision,
      },
    })

    const chart = imports.Graph.timeline(
      prices.map((y, _) => ({x: new Date(y[0]), y: y[1]})),
      {
        low: Math.min(...prices.map((y, _) => y[1])),

        high: Math.max(...prices.map((y, _) => y[1])),

        points: false,
        text: false,
        width: 480 * (1 + data.large),
        height: 200,
      },
    )

    //Results
    return {
      chart,
      id,
      precision,
      days: {"1": "Today", "14": "2 Weeks", "30": "1 Month", max: "All-time"}[days],
      symbol: coin.symbol,
      name: coin.name,
      current_price: coin.market_data.current_price[vs_currency],
      price_change_percentage_24h: coin.market_data.price_change_percentage_24h,
      vs_currency,
      logo: coin.image.small,
    }
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="source/plugins/community/crypto/README.md">
<!-- Header -->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>ü™ô Crypto</h3></th></tr>
  <tr><td colspan="2" align="center">
    <p>This plugin generates an SVG image containing crypto metrics from a given address. It uses the CoinGecko API to fetch crypto prices.</p>
    <p>For more information, check the <a href="https://www.coingecko.com/vi/api/documentation">CoinGecko API documentation</a>.</p>
  </td></tr>
  <tr><th>Authors</th><td><a href="https://github.com/dajneem23">@dajneem23</a></td></tr>
  <tr>
    <th rowspan="3">Supported Features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td>
      <ul>
        <li><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></li>
        <li><a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a></li>
      </ul>
    </td>
  </tr>
  <tr>
    <td>
      <ul>
        <li><code>üë§ Users</code></li>
        <li><code>üë• Organizations</code></li>
        <li><code>üìì Repositories</code></li>
      </ul>
    </td>
  </tr>
  <tr>
    <td><code>üóùÔ∏è plugin_crypto</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://via.placeholder.com/468x60?text=No%20preview%20available" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!-- /Header -->

## ‚û°Ô∏è Available Options

<!-- Options -->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_crypto</code></h4></td>
    <td rowspan="2"><p>Enable crypto plugin</p><img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">Type: <code>boolean</code><br>Default: <code>no</code><br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_crypto_id</code></h4></td>
    <td rowspan="2"><p>Crypto id (from Coingecko)</p><img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">Type: <code>string</code><br>Default: ""<br>Example: bitcoin<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_crypto_vs_currency</code></h4></td>
    <td rowspan="2"><p>The target currency of market data (usd, eur, jpy, etc.)</p><img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">Type: <code>string</code><br>Default: "usd"<br>Example: "usd"<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_crypto_days</code></h4></td>
    <td rowspan="2"><p>Data up to number of days ago (eg. 1,14,30,max)</p><img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">Type: <code>string</code><br>Default: "1"<br>Example: 1<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_crypto_precision</code></h4></td>
    <td rowspan="2"><p>The number of decimal places to use</p><img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">Type: <code>number</code><br>Default: 2<br>Example: 2<br></td>
  </tr>
</table>
<!-- /Options -->

<!--examples-->
```yaml
name: Crypto Metrics
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.crypto.svg
  token: NOT_NEEDED
  base: ""
  plugin_crypto: yes
  plugin_crypto_id: bitcoin
  plugin_crypto_vs_currency: usd
  plugin_crypto_days: 1
  plugin_crypto_precision: 2

```
<!--/examples-->
</file>

<file path="source/plugins/community/fortune/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>ü•† Fortune</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugins displays a random fortune message</p>
</td></tr>
<tr><th>Authors</th><td><a href="https://github.com/lowlighter">@lowlighter</a></td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><i>No tokens are required for this plugin</i></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.fortune.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_fortune</code></h4></td>
    <td rowspan="2"><p>Enable fortune plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Fortune
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.fortune.svg
  token: NOT_NEEDED
  base: ""
  plugin_fortune: yes

```
<!--/examples-->
</file>

<file path="source/plugins/community/nightscout/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üíâ Nightscout</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays blood sugar values from a <a href="http://nightscout.info">Nightscout</a> site.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="http://nightscout.info">Nightscout</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
<tr><th>Authors</th><td><a href="https://github.com/legoandmars">@legoandmars</a></td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><i>No tokens are required for this plugin</i></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/legoandmars/legoandmars/blob/master/metrics.plugin.nightscout.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_nightscout</code></h4></td>
    <td rowspan="2"><p>Enable nightscout plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_nightscout_url</code></h4></td>
    <td rowspan="2"><p>Nightscout URL</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> https://example.herokuapp.com<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_nightscout_datapoints</code></h4></td>
    <td rowspan="2"><p>Number of datapoints shown the graph</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 12<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_nightscout_lowalert</code></h4></td>
    <td rowspan="2"><p>Threshold for low blood sugar</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>default:</b> 80<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_nightscout_highalert</code></h4></td>
    <td rowspan="2"><p>Threshold for high blood sugar</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>default:</b> 180<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_nightscout_urgentlowalert</code></h4></td>
    <td rowspan="2"><p>Threshold for urgently low blood sugar</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>default:</b> 50<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_nightscout_urgenthighalert</code></h4></td>
    <td rowspan="2"><p>Threshold for urgently high blood sugar</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>default:</b> 250<br></td>
  </tr>
</table>
<!--/options-->

## üåê Setup a Nightscout instance

The [nightscout website](http://www.nightscout.info/) details how to self-host a nightscout site.
Check out the instructions there.

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
uses: lowlighter/metrics@latest
with:
  token: NOT_NEEDED
  plugin_nightscout: yes
  plugin_nightscout_url: ${{ secrets.NIGHTSCOUT_URL }}

```
<!--/examples-->
</file>

<file path="source/plugins/community/poopmap/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üí© PoopMap plugin</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays statistics from a <a href="https://poopmap.net">PoopMap</a> account.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://poopmap.net">PoopMap</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
<tr><th>Authors</th><td><a href="https://github.com/matievisthekat">@matievisthekat</a></td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><code>üóùÔ∏è plugin_poopmap_token</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/matievisthekat/matievisthekat/blob/master/metrics.plugin.poopmap.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_poopmap</code></h4></td>
    <td rowspan="2"><p>Enable poopmap plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_poopmap_token</code></h4></td>
    <td rowspan="2"><p>PoopMap API token</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üîê Token<br>
<b>type:</b> <code>token</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_poopmap_days</code></h4></td>
    <td rowspan="2"><p>Time range</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<br>
<b>default:</b> 7<br>
<b>allowed values:</b><ul><li>7</li><li>30</li><li>180</li><li>365</li></ul></td>
  </tr>
</table>
<!--/options-->

## üóùÔ∏è Obtaining a PoopMap token

Install PoopMap app ([iOS](https://itunes.apple.com/us/app/poop-map/id1303269455?mt=8)/[Android](https://play.google.com/store/apps/details?id=net.poopmap)) and create an account.

Navigate to your profile in the app

<div align="center">
  <img src="https://user-images.githubusercontent.com/45036977/143533812-c2776bcc-1fda-441e-bc96-cf21d4c69ca1.jpg" width="150" />
</div>

Tap "Share Profile" in the top right

<div align="center">
  <img src="https://user-images.githubusercontent.com/45036977/143533849-b7e03b4d-2903-4339-bbb7-e1fc0ea9724e.jpg" width="150" />
</div>

Tap "Copy to Clipboard"

<div align="center">
  <img src="https://user-images.githubusercontent.com/45036977/143533856-f4a9fc0d-7bde-48c2-b579-e8ee91804d78.jpg" width="150" />
</div>

It should result in something like `Haha, check out the places I've pooped on Poop Map https://api.poopmap.net/map?token=xxxxxxxxxx` copied.

Extract the `token` query parameter from the link and use it in `plugin_poopmap_token`.
This token will not expire and it will be able to access only public details.

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
uses: lowlighter/metrics@latest
with:
  token: NOT_NEEDED
  plugin_poopmap_token: ${{ secrets.POOPMAP_TOKEN }}
  plugin_poopmap: yes

```
<!--/examples-->
</file>

<file path="source/plugins/community/screenshot/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üì∏ Website screenshot</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays a screenshot from any website.</p>
<p>It can either show the full page or a portion restricted by a <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors">CSS selector</a>.</p>
</td></tr>
<tr><th>Authors</th><td><a href="https://github.com/lowlighter">@lowlighter</a></td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a> <a href="/source/templates/terminal/README.md"><code>üìô Terminal template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><i>No tokens are required for this plugin</i></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.screenshot.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_screenshot</code></h4></td>
    <td rowspan="2"><p>Enable screenshot plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.run.puppeteer.scrapping</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_screenshot_title</code></h4></td>
    <td rowspan="2"><p>Title caption</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> Screenshot<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_screenshot_url</code></h4></td>
    <td rowspan="2"><p>Website URL</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_screenshot_selector</code></h4></td>
    <td rowspan="2"><p>CSS Selector</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> body<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_screenshot_mode</code></h4></td>
    <td rowspan="2"><p>Output mode</p>
<ul>
<li><code>image</code>: screenshot of selected element</li>
<li><code>text</code>: keep <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/innerText"><code>innerText</code></a> of selected element<ul>
<li><em>‚ö†Ô∏è Any CSS style applied to text such as font size, weight or color will be removed</em></li>
</ul>
</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> image<br>
<b>allowed values:</b><ul><li>image</li><li>text</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_screenshot_viewport</code></h4></td>
    <td rowspan="2"><p>Viewport options</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>json</code>
<br>
<b>default:</b> <details><summary>‚Üí Click to expand</summary><pre language="json"><code>{
  "width": 1280,
  "height": 1280
}
</code></pre></details><br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_screenshot_wait</code></h4></td>
    <td rowspan="2"><p>Wait time before taking screenshot (ms)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>default:</b> 0<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_screenshot_background</code></h4></td>
    <td rowspan="2"><p>Background</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: XKCD of the day
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.screenshot.svg
  token: NOT_NEEDED
  base: ""
  plugin_screenshot: yes
  plugin_screenshot_title: XKCD of the day
  plugin_screenshot_url: https://xkcd.com
  plugin_screenshot_selector: "#comic img"

```
<!--/examples-->
</file>

<file path="source/plugins/community/splatoon/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>ü¶ë Splatoon</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays your Splatoon 3 recent matches based on data fetched from Splatnet.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://www.nintendo.com">Nintendo</a> or <a href="https://splatoon.nintendo.com">Splatoon</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
<p>This specific plugin is licensed under GPL-3.0 rather than MIT to comply with <a href="https://github.com/spacemeowx2/s3si.ts">spacemeowx2/s3si.ts</a> license.</p>
<p>Note that <em>Nintendo Switch Online</em> web tokens usage are not explicitly allowed by <em>Nintendo</em>, use at your own risk.</p>
</td></tr>
<tr><th>Authors</th><td><a href="https://github.com/lowlighter">@lowlighter</a></td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code></td>
  </tr>
  <tr>
    <td><code>üóùÔ∏è plugin_splatoon_token</code> <code>üóùÔ∏è plugin_splatoon_statink_token</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.splatoon.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_splatoon</code></h4></td>
    <td rowspan="2"><p>Enable splatoon plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_splatoon_token</code></h4></td>
    <td rowspan="2"><p>Splatnet token</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üîê Token<br>
üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.api.nintendo.splatnet</i></li>
</ul>
<b>type:</b> <code>token</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_splatoon_sections</code></h4></td>
    <td rowspan="2"><p>Displayed sections</p>
<ul>
<li><code>player</code> for overall player recap</li>
<li><code>versus</code> for <em>Turf war</em> and <em>Anarchy battle</em> matches</li>
<li><code>salmon-run</code> for <em>Salmon run next wave</em> matches</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> player, versus, salmon-run<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_splatoon_versus_limit</code></h4></td>
    <td rowspan="2"><p>Display limit (Versus)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 6)</i>
<br>
<b>default:</b> 1<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_splatoon_salmon_limit</code></h4></td>
    <td rowspan="2"><p>Display limit (Salmon run)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 6)</i>
<br>
<b>default:</b> 1<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_splatoon_statink</code></h4></td>
    <td rowspan="2"><p>stat.ink integration</p>
<p>If set, fetched data will also be uploaded to stat.ink
Requires <a href="/source/plugins/community/splatoon/README.md#plugin_splatoon_statink_token"><code>plugin_splatoon_statink_token</code></a> to be set</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.api.statink</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_splatoon_statink_token</code></h4></td>
    <td rowspan="2"><p>stat.ink token</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üîê Token<br>
<b>type:</b> <code>token</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_splatoon_source</code></h4></td>
    <td rowspan="2"><p>Source</p>
<ul>
<li><code>splatnet</code> will fetch data from Splatnet using <a href="https://github.com/spacemeowx2/s3si.ts">spacemeowx2/s3si.ts</a> tool</li>
<li><code>local</code> will assume <code>s3si/export</code> directory already exists and is populated (use this when developping new features for this plugin to save network resources and time)</li>
<li><code>mocks</code> will use <code>s3si/mocks</code> directory (use this when developping new features for this plugin to avoid setting up a NSO token)</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
üîß For development<br>
<b>type:</b> <code>string</code>
<br>
<b>default:</b> splatnet<br>
<b>allowed values:</b><ul><li>splatnet</li><li>local</li><li>mocks</li></ul></td>
  </tr>
</table>
<!--/options-->

## üóùÔ∏è Obtaining a *Nintendo Switch Online* token

The helper script is intended to be run by [deno runtime](https://deno.land/). Either [install it locally](https://deno.land/manual/getting_started/installation) or use its [docker image](https://hub.docker.com/r/denoland/deno).

Run the following command in your terminal and follow instructions:
```bash
deno run --allow-run=deno --allow-read=profile.json --allow-write=profile.json --unstable https://raw.githubusercontent.com/lowlighter/metrics/master/source/plugins/community/splatoon/token.ts
```

![Script](/.github/readme/imgs/plugin_splatoon_script.png)

![Authentication](/.github/readme/imgs/plugin_splatoon_auth.png)

## üêô [stat.ink](https://stat.ink) integration

It is possible to make this plugin automatically export fetched games to [stat.ink](https://stat.ink) by adding the following:

```yaml
plugin_splatoon_statink: yes
plugin_splatoon_statink_token: ${{ secrets.SPLATOON_STATINK_TOKEN }}
```

[stat.ink](https://stat.ink) API key can be found on user profile:

![stat.ink](/.github/readme/imgs/plugin_splatoon_statink.png)

## üë®‚Äçüíª About

Data are fetched using [spacemeowx2/s3si.ts](https://github.com/spacemeowx2/s3si.ts) tool (which is itself based on [frozenpandaman/s3s](https://github.com/frozenpandaman/s3s)).

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Splatnet data
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.splatoon.svg
  token: NOT_NEEDED
  base: ""
  plugin_splatoon: yes
  plugin_splatoon_token: ${{ secrets.SPLATOON_TOKEN }}

```
```yaml
name: Splatnet data with stat.ink integration
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.splatoon.svg
  token: NOT_NEEDED
  base: ""
  plugin_splatoon: yes
  plugin_splatoon_token: ${{ secrets.SPLATOON_TOKEN }}
  plugin_splatoon_statink: yes
  plugin_splatoon_statink_token: ${{ secrets.SPLATOON_STATINK_TOKEN }}
  extras_css: |
    h2 { display: none !important; }

```
<!--/examples-->
</file>

<file path="source/plugins/community/stock/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üíπ Stock prices</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays the stock market price of a given company.</p>
</td></tr>
<tr><th>Authors</th><td><a href="https://github.com/lowlighter">@lowlighter</a></td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üóùÔ∏è plugin_stock_token</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stock.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stock</code></h4></td>
    <td rowspan="2"><p>Enable stock plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.npm.optional.d3</i></li>
<li><i>metrics.api.yahoo.finance</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stock_token</code></h4></td>
    <td rowspan="2"><p>Yahoo Finance token</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üîê Token<br>
<b>type:</b> <code>token</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stock_symbol</code></h4></td>
    <td rowspan="2"><p>Company stock symbol</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stock_duration</code></h4></td>
    <td rowspan="2"><p>Time range</p>
<ul>
<li><code>1d</code>: Today</li>
<li><code>5d</code>: 5 days</li>
<li><code>1mo</code>: 1 month</li>
<li><code>3mo</code>: 3 months</li>
<li><code>6mo</code>: 6 months</li>
<li><code>1y</code>: 1 year</li>
<li><code>2y</code>: 2 years</li>
<li><code>5y</code>: 5 years</li>
<li><code>10y</code>: 10 years</li>
<li><code>ytd</code>: Year to date</li>
<li><code>max</code>: All time</li>
</ul>
<p>This is relative to current date</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> 1d<br>
<b>allowed values:</b><ul><li>1d</li><li>5d</li><li>1mo</li><li>3mo</li><li>6mo</li><li>1y</li><li>2y</li><li>5y</li><li>10y</li><li>ytd</li><li>max</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stock_interval</code></h4></td>
    <td rowspan="2"><p>Time interval between points</p>
<ul>
<li><code>1m</code>: 1 minute</li>
<li><code>2m</code>: 2 minutes</li>
<li><code>5m</code>: 5 minutes</li>
<li><code>15m</code>: 15 minutes</li>
<li><code>60m</code>: 60 minutes</li>
<li><code>1d</code>: 1 day</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> 5m<br>
<b>allowed values:</b><ul><li>1m</li><li>2m</li><li>5m</li><li>15m</li><li>60m</li><li>1d</li></ul></td>
  </tr>
</table>
<!--/options-->

## üóùÔ∏è Obtaining a RapidAPI Yahoo Finance token

Create a [RapidAPI account](https://rapidapi.com) and subscribe to [Yahoo Finance API](https://rapidapi.com/apidojo/api/yahoo-finance1) to get a token.

![RapidAPI token](/.github/readme/imgs/plugin_stock_token.png)

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Stock prices from Tesla
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.stock.svg
  token: NOT_NEEDED
  base: ""
  plugin_stock: yes
  plugin_stock_token: ${{ secrets.STOCK_TOKEN }}
  plugin_stock_symbol: TSLA

```
<!--/examples-->
</file>

<file path="source/plugins/contributors/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üèÖ Repository contributors</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin display repositories contributors from a commit range along with additional stats.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a></td>
  </tr>
  <tr>
    <td><code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>By contribution types</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.contributors.categories.svg" alt=""></img></details>
      <details><summary>By number of contributions</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.contributors.contributions.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_contributors</code></h4></td>
    <td rowspan="2"><p>Enable contributors plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_contributors_base</code></h4></td>
    <td rowspan="2"><p>Base reference</p>
<p>Can be a commit, tag, branch, etc.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_contributors_head</code></h4></td>
    <td rowspan="2"><p>Head reference</p>
<p>Can be a commit, tag, branch, etc.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> master<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_contributors_ignored</code></h4></td>
    <td rowspan="2"><p>Ignored users</p>
<p>Can be used to ignore bots activity</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è© Inherits <code>users_ignored</code><br>
<b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_contributors_contributions</code></h4></td>
    <td rowspan="2"><p>Contributions count</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_contributors_sections</code></h4></td>
    <td rowspan="2"><p>Displayed sections</p>
<ul>
<li><code>contributors</code>: all contributors</li>
<li><code>categories</code>: contributors sorted by contributions categories (must be configured with <a href="/source/plugins/contributors/README.md#plugin_contributors_categories"><code>plugin_contributors_categories</code></a>)</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> contributors<br>
<b>allowed values:</b><ul><li>contributors</li><li>categories</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_contributors_categories</code></h4></td>
    <td rowspan="2"><p>Contribution categories</p>
<p>This option requires <a href="/source/plugins/contributors/README.md#plugin_contributors_sections"><code>plugin_contributors_sections</code></a> to have <code>categories</code> in it to be effective.
Pass a JSON object mapping category with file globs</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.run.tempdir</i></li>
<li><i>metrics.run.git</i></li>
</ul>
<b>type:</b> <code>json</code>
<br>
<b>default:</b> <details><summary>‚Üí Click to expand</summary><pre language="json"><code>{
  "üìö Documentation": ["README.md", "docs/**"],
  "üíª Code": ["source/**", "src/**"],
  "#Ô∏è‚É£ Others": ["*"]
}
</code></pre></details><br></td>
  </tr>
</table>
<!--/options-->

## üóÇÔ∏è Setting up contribution categories

Pass a JSON object to `plugin_contributors_categories` with categories names as keys and arrays of file globs as values to configure contributions categories.

Each modified file by a contributor matching a file glob will add them in said category.

> üí° File matching respect keys order

> üí° Use `|` YAML multiline operator for better readability

*Example: *
```yaml
- uses: lowlighter/metrics@latest
  with:
    plugin_contributors: yes
    plugin_contributors_categories: |
      {
        "üìö Documentation": ["README.md", "docs/**"],
        "üíª Code": ["source/**", "src/**"],
        "#Ô∏è‚É£ Others": ["*"]
      }
```

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Contributors with contributions count
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.contributors.contributions.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  template: repository
  repo: metrics
  plugin_contributors: yes
  plugin_contributors_contributions: yes

```
```yaml
name: Contributors by categories
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.contributors.categories.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  template: repository
  repo: metrics
  plugin_contributors: yes
  plugin_contributors_sections: categories
  plugin_contributors_categories: |
    {
      "üß© Plugins / üñºÔ∏è templates":["source/plugins/**", "source/templates/**"],
      "üìö Documentation":["README.md", "**/README.md", "**/metadata.yml"],
      "üíª Code (other)":["source/**", "Dockerfile"]
    }

```
<!--/examples-->
</file>

<file path="source/plugins/core/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üß± Core</h3></th></tr>
  <tr><td colspan="2" align="center"><p>Global configuration and options</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üóùÔ∏è token</code> <code>üóùÔ∏è committer_token</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

[‚û°Ô∏è Jump to all available options](#%EF%B8%8F-available-options)

## üåê Configure used timezone

By default, dates use Greenwich meridian (GMT/UTC).

Configure `config_timezone` (see [supported timezone](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)) to avoid time offsets.

*Example: configuring timezone*
```yaml
- uses: lowlighter/metrics@latest
  with:
    config_timezone: Europe/Paris
```

## üì¶ Ordering content

Content can be manually ordered using `config_order` option.

*Example: display base.header, isocalendar, languages and stars in this specific order*
```yaml
- uses: lowlighter/metrics@latest
  with:
    base: header
    plugin_isocalendar: yes
    plugin_languages: yes
    plugin_stars: yes
    config_order: base.header, isocalendar, languages, stars
```

> üí° Omitted sections will be appended at the end using default order

> ‚ÑπÔ∏è The handles to use for each plugin and sections is based on the [`partials/_.json`](/source/templates/classic/partials/_.json) of the template.
> It may not necessarily be the plugin id (e.g. `base.header`, `base.activity+community`, `base.repositories`, etc.).

## üîï Skipping repositories in plugins

Some plugins support a `plugin_*_skipped` option which is used to skipped repositories from result. It inherits the global option [`repositories_skipped`](/source/plugins/base/README.md#repositories_skipped) which makes it easier to ignore repositories from all plugins at once.

These options support two different syntaxes:

### Basic pattern matching

Skip repositories by:
- using their full handle (e.g. `user/repo`)
- using only their name (e.g. `repo`)
  - *in this case, the owner may be implicitly set to current `user` option*

*Example: skipping repositories with basic pattern matching*
```yml
repositories_skipped: my-repo, user/my-repo
```

> üí° Either comma or newlines can be used to separate basic patterns

### Advanced pattern matching

To enable advanced pattern matching to skip repositories, include `@use.patterns` at the beginning of the option value.

Skip repositories by writing file-glob patterns, with any of the supported operation:
- `#` to write comments
- `-` to exclude repositories
  - *the `-` is implicit and may be omitted from excluding patterns*
- `+` to include back repositories

> ‚ÑπÔ∏è *metrics* use [isaacs/minimatch](https://github.com/isaacs/minimatch) as its file-glob matcher

*Example: skipping repositories with basic advanced matching*
```yml
repositories_skipped: |
  @use.patterns

  # Skip a specific repository (both patterns are equivalent)
  user/repo
  -user/repo

  # Skip repositories matching a given pattern
  user/repo-*
  {user1, user2, user3}/*

  # Include back a previously skipped repository
  org/repo
  +org/include-this-repo
```

> ‚ÑπÔ∏è Unlike basic pattern matching, patterns are always tested against the full repository handle (the user will not be implicitly added)

> ‚ö†Ô∏è As patterns may contain commas, be sure to use newlines rather than commas as separator to ensure patterns are correctly parsed

## ü™õ Using presets

It is possible to reuse the same configuration across different repositories and workflows using configuration presets.
A preset override the default values of inputs, and multiple presets can be provided at once through URLs or file paths.

Options resolution is done in the following order:
- default values
- presets, from first to last
- user values

*Example: using a configuration preset from an url*
```yaml
- uses: lowlighter/metrics@latest
  with:
    config_presets: https://raw.githubusercontent.com/lowlighter/metrics/presets/lunar-red/preset.yaml
```

Some presets are hosted on this repository on the [`@presets`](https://github.com/lowlighter/metrics/tree/presets) branch and can be used directly by using their identifier prefixed by an arobase (`@`).

*Example: using a pre-defined configuration preset*
```yaml
- uses: lowlighter/metrics@latest
  with:
    config_presets: "@lunar-red"
```

> ‚ö†Ô∏è `üîê Tokens` and options marked with `‚èØÔ∏è Cannot be preset`, as they suggest, cannot be preset and thus requires to be explicitly defined to be set.

> ‚ÑπÔ∏è Presets configurations use [schemas](https://github.com/lowlighter/metrics/tree/presets/%40schema) to ensure compatibility between format changes

## üé® Custom CSS styling

Additional CSS can be injected using `extras_css` option.

*Example: changing the color of `h2`*
```yaml
- uses: lowlighter/metrics@latest
  with:
    base: header
    extras_css: |
      h2 {
        color: red;
      }
```

> üí° *metrics* does not use `!important` keyword, so use it when having trouble when styling is not applied

> üí° If you make an heavy use of this option, creating a [community templates](/source/templates/community/README.md) may be a better alternative

> ‚ö†Ô∏è CSS styles may slightly change between releases, backward compatibility is not guaranteed!

## üó≥Ô∏è Custom JavaScript scripting

Additional JavaScript can be injected using `extras_js` option.

*Example: removing all `h2`*
```yaml
- uses: lowlighter/metrics@latest
  with:
    base: header
    extras_js: |
      document.querySelectorAll("h2")?.forEach(h2 => h2.remove())
```

> ‚ÑπÔ∏è JavaScript is executed in puppeteer context during the rendering phase, **not** in *metrics* context.
> It will be possible to access `document` and all other features accessible like if the SVG was opened in a browser page

> üí° If you make an heavy use of this option, creating a [community templates](/source/templates/community/README.md) may be a better alternative

> ‚ö†Ô∏è HTML elements may slightly change between releases, backward compatibility is not guaranteed!

## üî≤ Adjusting padding

SVG rendering is dependent on operating system, browser and fonts combination and may look different across different platforms.

It may not look like it, but computing the height of a SVG is not trivial. *metrics* spawns an headless browser and try to do its best to resize the result, but it may sometimes ends up in either cropped or oversized images.

Tweak `config_padding` option to manually adjust padding and solve this issue.

This settings supports the following format:
- 1 value for both width and height
- 2 values for width first and height second, separated by a comma (`,`)

> üí° Both negative and positive values are allowed

Each value need to respect the following format:
- {number}
- {number} + {number}%
- {number}%

> üí° Percentage based values are relative to the height computed by puppeteer

*Example: add 10px padding for both width and height*
```yaml
- uses: lowlighter/metrics@latest
  with:
    config_padding: 10
```

*Example: add 10px padding to height and increase it by 8%*
```yaml
- uses: lowlighter/metrics@latest
  with:
    config_padding: 0, 10 + 8%
```

*Example: remove 10% from height*
```yaml
- uses: lowlighter/metrics@latest
  with:
    config_padding: 0, -10%
```

## ‚ÜîÔ∏è Controlling display size

Some templates may support different output display size.

A `regular` display size will render a medium-sized image suitable for both desktop and mobile displays, while a `large` one will be more suitable only for desktop and some plugins (like [`üìå topics`](/source/plugins/topics/README.md) or [`üèÖ contributors`](/source/plugins/contributors/README.md))

The `columns` display will render a full-width image with automatic resizing: two columns for desktop and a single one column for mobiles.

*Example: output a PNG image*
```yaml
- uses: lowlighter/metrics@latest
  with:
    config_display: large
```

## üí± Configuring output format

Use `config_output` to change output format.

*Example: output a PNG image*
```yaml
- uses: lowlighter/metrics@latest
  with:
    config_output: png
```

A JSON output can be used to retrieved collected data and use it elsewhere.

*Example: output a JSON data dump*
```yaml
- uses: lowlighter/metrics@latest
  with:
    config_output: json
```

When using a PDF output, it is advised to set `config_base64: yes` to encode embed images in base64 in order to make self-contained documents.

*Example: output a self-contained PDF document*
```yaml
- uses: lowlighter/metrics@latest
  with:
    markdown: TEMPLATE.md
    config_output: markdown-pdf
    config_base64: yes
```

## ‚ú® Render `Metrics insights` statically

It is possible to generate a self-contained HTML file containing `‚ú® Metrics insights` output by using `config_output: insights`.

> üí° Note that like `‚ú® Metrics insights` content is not configurable, thus any other plugin option will actually be ignored

*Example: output `‚ú® Metrics insights` report*
```yaml
- uses: lowlighter/metrics@latest
  with:
    config_output: insights
```

## üß∂ Configuring output action

Before configuring output action, ensure that workflows permissions are properly set.
These can be changed either through repository settings in Actions tab:

![Setting workflows permissions](/.github/readme/imgs/setup_workflow_permissions.light.png#gh-light-mode-only)
![Setting workflows permissions](/.github/readme/imgs/setup_workflow_permissions.dark.png#gh-dark-mode-only)

Or more granulary [at job or workflow level](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token).

### Using commits (default)

Use `output_action: commit` to make the action directly push changes to `committer_branch` with a commit.
A custom commit message can be used through `committer_message`.

> üí° *metrics* will automatically ignore push events with a commit message containing `[Skip GitHub Action]` or `Auto-generated metrics for run #` to avoid infinite loops. Note that by default, GitHub already ignore events pushed by `${{ github.token }}` or containing `[skip ci]` in commit message

*Example: push output to metrics-renders branch rather than the default branch*
```yaml
metrics:
  permissions:
    contents: write
  steps:
    - uses: lowlighter/metrics@latest
      with:
        output_action: commit
        committer_branch: metrics-renders
        committer_message: "chore: update metrics"
```

### Using pull requests

Use `output_action: pull-request` to make the action open a new pull request and push changes from the same run on it.

The last step should use either `pull-request-merge`, `pull-request-squash` or `pull-request-rebase` to merge changes to `committer_branch`.

> üí° When using `pull-request` output action, do not forget to change `filename` too or previous output will be overwritten!

*Example: push two outputs using a merge pull request*
```yaml
metrics:
  permissions:
    contents: write
    pull-requests: write
  steps:
    - uses: lowlighter/metrics@latest
      with:
        filename: my-metrics-0.svg
        output_action: pull-request

    - uses: lowlighter/metrics@latest
      with:
        filename: my-metrics-1.svg
        output_action: pull-request-merge
```

### Using gists

Use `output_action: gist` to push output to a [GitHub gist](https://gist.github.com) instead.
It is required to provide a gist id to `committer_gist` option to make it work.

> üí° This feature will use `token` instead of `committer_token` to push changes, so `gists` scope must be granted to the original `token` first

*Example: push output to a gist*
```yaml
metrics:
  steps:
    - uses: lowlighter/metrics@latest
      with:
        output_action: gist
        committer_gist: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

### Manual handling

Use `output_action: none` to perform custom processing with outputs.
They will be available under `/metrics_renders/{filename}` in the runner.

*Example: generate outputs and manually push them*
```yaml
metrics:
  permissions:
    contents: write
  steps:
    - name: Checkout repository
      uses: actions/checkout@v3
        with:
          fetch-depth: 0

    - uses: lowlighter/metrics@latest
      with:
        output_action: none

    - uses: lowlighter/metrics@latest
      run: |
        set +e
        git checkout metrics-renders
        git config user.name github-actions[bot]
        git config user.email 41898282+github-actions[bot]@users.noreply.github.com
        sudo mv /metrics_renders/* ./
        git add --all
        git commit -m "chore: push metrics"
        git push
```

## ‚ôªÔ∏è Retrying automatically failed rendering and output action

Rendering is subject to external factors and can fail occasionally.
Use `retries` and `retries_delay` options to automatically retry rendering.

*Example: retry render up to 3 times (wait 5 minutes between each fail)*
```yaml
- uses: lowlighter/metrics@latest
  with:
    retries: 3
    retries_delay: 300
```

Output action is also subject to GitHub API rate-limiting and overall health status and can fail occasionally.
Use `retries_output_action` and `retries_delay_output_action` options to automatically retry output action.

> üí° As output action is a separate step from rendering, render step won't be called again

*Example: retry output action up to 5 times (wait 2 minutes between each fail)*
```yaml
- uses: lowlighter/metrics@latest
  with:
    retries_output_action: 5
    retries_delay_output_action: 120
```

## üóúÔ∏è Optimize SVG output

To reduce filesize and decrease loading time, *metrics* offers several optimization options, such as purging unused CSS and style minification, XML pretty-printing (which also reduce diffs between changes) and general SVG optimization (still experimental).

> üí° This option is enabled by default!

*Example: optimize CSS and XML*
```yaml
- uses: lowlighter/metrics@latest
  with:
    optimize: css, xml
```

*Example: optimize SVG (experimental)*
```yaml
- uses: lowlighter/metrics@latest
  with:
    optimize: svg
    experimental_features: --optimize-svg
```

## üê≥ Faster execution with prebuilt docker images

When using `lowlighter/metrics` official releases as a GitHub Action, a prebuilt docker container image will be pulled from [GitHub Container Registry](https://github.com/users/lowlighter/packages/container/package/metrics). It allows to significantly reduce workflow execution time.

> üí° This option is enabled by default!

On forks, this feature is disable to take into account any changes you made on it.

*Example: using prebuilt docker image*
```yaml
- uses: lowlighter/metrics@latest
  with:
    use_prebuilt_image: yes
```

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>token</code></h4></td>
    <td rowspan="2"><p>GitHub Personal Access Token</p>
<p>No scopes are required by default, though some plugins and features may require additional scopes.</p>
<p>When using a configuration which does not requires a GitHub PAT, it is possible to pass <code>NOT_NEEDED</code> instead.
When doing so, any settings which defaults on user fetched values will not be templated (e.g. <code>.user.*</code>) and will usually need to be set manually.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚úîÔ∏è Required<br>
üîê Token<br>
<b>type:</b> <code>token</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>user</code></h4></td>
    <td rowspan="2"><p>GitHub username</p>
<p>Defaults to <a href="/source/plugins/core/README.md#token"><code>token</code></a> owner username.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>repo</code></h4></td>
    <td rowspan="2"><p>GitHub repository</p>
<p>This option is only revelant for repositories templates</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>committer_token</code></h4></td>
    <td rowspan="2"><p>GitHub Token used to commit metrics</p>
<p>Leave this to <code>${{ github.token }}</code> or <code>${{ secrets.GITHUB_TOKEN }}</code>, which is a special auto-generated token restricted to current repository scope.</p>
<blockquote>
<p>üí° When using <a href="/source/plugins/core/README.md#output_action"><code>output_action: gist</code></a>, it will use <a href="/source/plugins/core/README.md#token"><code>token</code></a> instead, since gists are outside of scope</p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üîê Token<br>
<b>type:</b> <code>token</code>
<br>
<b>default:</b> ${{ github.token }}<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>committer_branch</code></h4></td>
    <td rowspan="2"><p>Target branch</p>
<p>Defaults to current repository default branch</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>committer_message</code></h4></td>
    <td rowspan="2"><p>Commit message</p>
<p>Use <code>${filename}</code> to display filename</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> Update ${filename} - [Skip GitHub Action]<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>committer_gist</code></h4></td>
    <td rowspan="2"><p>Gist id</p>
<p>Specify an existing gist id (can be retrieved from its URL) when using <a href="/source/plugins/core/README.md#output_action"><code>output_action: gist</code></a>.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>filename</code></h4></td>
    <td rowspan="2"><p>Output path</p>
<p>When using an asterisk (<code>*</code>), correct extension will automatically be applied according to <a href="/source/plugins/core/README.md#config_output"><code>config_output</code></a> value</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> github-metrics.*<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>markdown</code></h4></td>
    <td rowspan="2"><p>Markdown template path</p>
<p>It can be either a local path or a full link (e.g. <a href="https://raw.githubusercontent.com">https://raw.githubusercontent.com</a>)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> TEMPLATE.md<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>markdown_cache</code></h4></td>
    <td rowspan="2"><p>Markdown file cache</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> .cache<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>output_action</code></h4></td>
    <td rowspan="2"><p>Output action</p>
<ul>
<li><code>none</code>: just create file in <code>/metrics_renders</code> directory of action runner</li>
<li><code>commit</code>: push output to <code>committer_branch</code></li>
<li><code>pull-request</code>: push output to a new branch and open a pull request to <code>committer_branch</code></li>
<li><code>pull-request-merge</code>: same as <code>pull-request</code> and additionally merge pull request</li>
<li><code>pull-request-squash</code>: same as <code>pull-request</code> and additionally squash and merge pull request</li>
<li><code>pull-request-rebase</code>: same as <code>pull-request</code> and additionally rebase and merge pull request</li>
<li><code>gist</code>: push output to <code>committer_gist</code></li>
</ul>
<blockquote>
<p>üí° When using <code>pull-request</code>, you will need to set the last job with a <code>pull-request-*</code> action instead, else it won&#39;t be merged</p>
</blockquote>
<blockquote>
<p>‚ö†Ô∏è As GitHub gists API does not support binary files upload, <code>gist</code> does not support <a href="/source/plugins/core/README.md#config_output"><code>config_output</code></a> set to either <code>png</code>, <code>jpeg</code> or <code>markdown-pdf</code></p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> commit<br>
<b>allowed values:</b><ul><li>none</li><li>commit</li><li>pull-request</li><li>pull-request-merge</li><li>pull-request-squash</li><li>pull-request-rebase</li><li>gist</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>output_condition</code></h4></td>
    <td rowspan="2"><p>Output condition</p>
<ul>
<li><code>always</code>: always try to push changes</li>
<li><code>data-changed</code>: skip changes if no data changed (e.g. like when only metadata changed)</li>
</ul>
<blockquote>
<p>‚ÑπÔ∏è This option is only revelant when <a href="/source/plugins/core/README.md#config_output"><code>config_output: svg</code></a> is set</p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> always<br>
<b>allowed values:</b><ul><li>always</li><li>data-changed</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>optimize</code></h4></td>
    <td rowspan="2"><p>Optimization features</p>
<ul>
<li><code>css</code>: purge and minify CSS styles</li>
<li><code>xml</code>: pretty-print XML (useful to reduce diff)</li>
<li><code>svg</code>: optimization with SVGO (experimental, requires <a href="/source/plugins/core/README.md#experimental_features"><code>experimental_features: --optimize-svg</code></a>)</li>
</ul>
<p>Templates may not always honour all provided options</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> css, xml<br>
<b>allowed values:</b><ul><li>css</li><li>xml</li><li>svg</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>setup_community_templates</code></h4></td>
    <td rowspan="2"><p>Community templates to setup</p>
<p>See <a href="https://github.com/lowlighter/metrics/blob/master/source/templates/community/README.md">community templates guide</a> for more informations</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.setup.community.templates</i></li>
</ul>
<b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>template</code></h4></td>
    <td rowspan="2"><p>Template</p>
<p>Community templates must be prefixed by at sign (<code>@</code>)
See <a href="https://github.com/lowlighter/metrics/blob/master/README.md#%EF%B8%8F-templates">list of supported templates</a></p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> classic<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>query</code></h4></td>
    <td rowspan="2"><p>Query parameters</p>
<p>Pass additional parameters to templates.
This is mostly useful for custom templates.</p>
<blockquote>
<p>‚ö†Ô∏è <strong>Do not</strong> use this option to pass other existing parameters, they will be overwritten</p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>json</code>
<br>
<b>default:</b> <details><summary>‚Üí Click to expand</summary><pre language="json"><code>{}</code></pre></details><br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>extras_css</code></h4></td>
    <td rowspan="2"><p>Extra CSS</p>
<p>Custom CSS that will be injected in used template.
Useful to avoid creating a new template just to tweak some styling</p>
<blockquote>
<p>üí° <em>metrics</em> tends to avoid using <code>!important</code> rules, which means that most styling can be overridden by this option when using <code>!important</code></p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.run.puppeteer.user.css</i></li>
</ul>
<b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>extras_js</code></h4></td>
    <td rowspan="2"><p>Extra JavaScript</p>
<p>Custom JavaScript that will be executed during puppeteer rendering.
Useful to avoid creating a new template just to tweak some content.</p>
<blockquote>
<p>‚ö†Ô∏è Note that is it executed within puppeteer context and <strong>not</strong> within <em>metrics</em> context.
No access to fetched data or configuration will be offered through this context.
It is run after transformations and optimizations, but just before resizing.</p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.run.puppeteer.user.js</i></li>
</ul>
<b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>github_api_rest</code></h4></td>
    <td rowspan="2"><p>GitHub REST API endpoint</p>
<p>Can be used to support <a href="https://github.com/enterprise">GitHub enterprises server</a>.
Leave empty to use default endpoint.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è≠Ô∏è Global option<br>
<b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>github_api_graphql</code></h4></td>
    <td rowspan="2"><p>GitHub GraphQL API endpoint</p>
<p>Can be used to support <a href="https://github.com/enterprise">GitHub enterprises server</a>.
Leave empty to use default endpoint.</p>
<blockquote>
<p>‚ÑπÔ∏è GraphQL octokit will automatically append <code>/graphql</code> to provided endpoint</p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è≠Ô∏è Global option<br>
<b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>config_timezone</code></h4></td>
    <td rowspan="2"><p>Timezone for dates</p>
<p>See <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">list of supported timezone</a></p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è≠Ô∏è Global option<br>
<b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>config_order</code></h4></td>
    <td rowspan="2"><p>Plugin order</p>
<p>By default, templates use <code>partials/_.json</code> ordering.
You can override the content order by using this setting.</p>
<p>If some partials are omitted, they will be appended at the end with default ordering</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è≠Ô∏è Global option<br>
<b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>config_twemoji</code></h4></td>
    <td rowspan="2"><p>Use twemojis</p>
<p>Replace emojis by <a href="%5Btwemojis%5D(https://github.com/twitter/twemoji)">twemojis</a> to have a consistent render across all platforms
May increase filesize.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è≠Ô∏è Global option<br>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>config_gemoji</code></h4></td>
    <td rowspan="2"><p>Use GitHub custom emojis</p>
<p>GitHub supports additional emojis which are not registered in Unicode standard (:octocat:, :shipit:, :trollface:, ...)
See full list at <a href="https://api.github.com/emojis">https://api.github.com/emojis</a>.</p>
<p>This option has no effect when [`token: NOT_NEEDED``](/source/plugins/core/README.md#token) is set.</p>
<p>May increase filesize</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è≠Ô∏è Global option<br>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>config_octicon</code></h4></td>
    <td rowspan="2"><p>Use GitHub octicons</p>
<p>Octicons are open-sourced icons provided by GitHub.
See full list at <a href="https://primer.style/octicons">https://primer.style/octicons</a>.</p>
<p>To include an octicon, use the following syntax: <code>:octicon-{name}-{size}:</code>.
Size must be a supported icon size (12, 16 or 24).
16px octicons can omit size and directly use <code>:octicon-{name}:</code> syntax.</p>
<p>May increase filesize</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è≠Ô∏è Global option<br>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>config_display</code></h4></td>
    <td rowspan="2"><p>Display width (for image output formats)</p>
<ul>
<li><code>regular</code>: 480px width</li>
<li><code>large</code>: 960px width (may not be supported by all templates)</li>
<li><code>columns</code>: Full width with auto-sizing (two columns for desktops, and one column for mobile)<ul>
<li>known issue: <a href="https://github.com/lowlighter/metrics/issues/374">https://github.com/lowlighter/metrics/issues/374</a></li>
</ul>
</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è≠Ô∏è Global option<br>
<b>type:</b> <code>string</code>
<br>
<b>default:</b> regular<br>
<b>allowed values:</b><ul><li>regular</li><li>large</li><li>columns</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>config_animations</code></h4></td>
    <td rowspan="2"><p>Use CSS animations</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è≠Ô∏è Global option<br>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>config_base64</code></h4></td>
    <td rowspan="2"><p>Base64-encoded images</p>
<p>Enable this option to make self-contained output (i.e. with no external links)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è≠Ô∏è Global option<br>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>config_padding</code></h4></td>
    <td rowspan="2"><p>Output padding</p>
<p>Although <em>metrics</em> try to auto-guess resulting height, rendering is still dependent on OS and browser settings.
It can result in cropped or oversized outputs.</p>
<p>This settings let you manually adjust padding with the following format:</p>
<ul>
<li>1 value for both width and height</li>
<li>2 values for width fist and height second, separated by a comma (<code>,</code>)</li>
</ul>
<p>Each value need to respect the following format:</p>
<ul>
<li><code>{number}</code></li>
<li><code>{number} + {number}%</code></li>
<li><code>{number}%</code></li>
</ul>
<p>Percentage are relative to computed dimensions</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> 0, 8 + 11%<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>config_output</code></h4></td>
    <td rowspan="2"><p>Output format</p>
<ul>
<li><code>auto</code>: Template default (usually <code>svg</code> or <code>markdown</code>)</li>
<li><code>svg</code>: SVG image</li>
<li><code>png</code>: PNG image (animations not supported)</li>
<li><code>jpeg</code>: JPEG image (animations and transparency not supported)</li>
<li><code>json</code>: JSON data dump</li>
<li><code>markdown</code>: Markdown rendered file</li>
<li><code>markdown-pdf</code>: PDF from markdown rendered file</li>
<li><code>insights</code>: Metrics Insights self-contained HTML file (not configurable)</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> auto<br>
<b>allowed values:</b><ul><li>auto</li><li>svg</li><li>png</li><li>jpeg</li><li>json</li><li>markdown</li><li>markdown-pdf</li><li>insights</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>config_presets</code></h4></td>
    <td rowspan="2"><p>Configuration presets</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.setup.community.presets</i></li>
</ul>
<b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>retries</code></h4></td>
    <td rowspan="2"><p>Retries in case of failures (for rendering)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 10)</i>
<br>
<b>default:</b> 3<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>retries_delay</code></h4></td>
    <td rowspan="2"><p>Delay between each retry (in seconds, for rendering)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 3600)</i>
<br>
<b>default:</b> 300<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>retries_output_action</code></h4></td>
    <td rowspan="2"><p>Retries in case of failures (for output action)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 10)</i>
<br>
<b>default:</b> 5<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>retries_delay_output_action</code></h4></td>
    <td rowspan="2"><p>Delay between each retry (in seconds, for output action)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 3600)</i>
<br>
<b>default:</b> 120<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>clean_workflows</code></h4></td>
    <td rowspan="2"><p>Clean previous workflows jobs</p>
<p>This can be used to clean up Action tabs from previous workflows runs.</p>
<p>Use <code>all</code> to clean up workflows runs in any state.</p>
<blockquote>
<p>‚ö†Ô∏è When reporting issues, it is <strong>required</strong> to provide logs so it can be investigated and reproduced.
Be sure to disable this option when asking for help or submitting bug reports.</p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>allowed values:</b><ul><li>cancelled</li><li>failure</li><li>success</li><li>skipped</li><li>startup_failure</li><li>timed_out</li><li>all</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>delay</code></h4></td>
    <td rowspan="2"><p>Job delay</p>
<p>This can be used to avoid triggering GitHub abuse mechanics on large workflows</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 3600)</i>
<br>
<b>default:</b> 0<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>quota_required_rest</code></h4></td>
    <td rowspan="2"><p>Minimum GitHub REST API requests quota required to run</p>
<p>Action will cancel itself without any errors if requirements are not met</p>
<p>This option has no effect when <a href="/source/plugins/core/README.md#token"><code>token: NOT_NEEDED</code></a> is set</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 5000)</i>
<br>
<b>default:</b> 200<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>quota_required_graphql</code></h4></td>
    <td rowspan="2"><p>Minimum GitHub GraphQL API requests quota required to run</p>
<p>Action will cancel itself without any errors if requirements are not met</p>
<p>This option has no effect when <a href="/source/plugins/core/README.md#token"><code>token: NOT_NEEDED</code></a> is set</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 5000)</i>
<br>
<b>default:</b> 200<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>quota_required_search</code></h4></td>
    <td rowspan="2"><p>Minimum GitHub Search API requests quota required to run</p>
<p>Action will cancel itself without any errors if requirements are not met</p>
<p>This option has no effect when <a href="/source/plugins/core/README.md#token"><code>token: NOT_NEEDED</code></a> is set</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 30)</i>
<br>
<b>default:</b> 0<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>notice_releases</code></h4></td>
    <td rowspan="2"><p>Notice about new releases of metrics</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>use_prebuilt_image</code></h4></td>
    <td rowspan="2"><p>Use pre-built docker image from <a href="https://github.com/lowlighter/metrics/pkgs/container/metrics">GitHub container registry</a></p>
<p>It allows to save build time and make job significantly faster, and there is almost no reason to disable this settings.
This option has no effects on forks (images will always be rebuilt from Dockerfile)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
üîß For development<br>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugins_errors_fatal</code></h4></td>
    <td rowspan="2"><p>Fatal plugin errors</p>
<p>When enabled, the job will fail in case of plugin errors, else it will be handled gracefully in output with an error message</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
üîß For development<br>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>debug</code></h4></td>
    <td rowspan="2"><p>Debug mode</p>
<p>This setting is automatically enable if a job fail (useful with <a href="/source/plugins/core/README.md#plugins_errors_fatal"><code>plugins_errors_fatal: yes</code></a>)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
üîß For development<br>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>verify</code></h4></td>
    <td rowspan="2"><p>SVG validity check</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
üîß For development<br>
üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.npm.optional.libxml2</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>debug_flags</code></h4></td>
    <td rowspan="2"><p>Debug flags</p>
<ul>
<li><code>--cakeday</code>: simulate registration anniversary</li>
<li><code>--halloween</code>: enable halloween colors <em>(only first color scheme will be applied if multiple are specified)</em></li>
<li><code>--winter</code>: enable winter colors <em>(only first color scheme will be applied if multiple are specified)</em></li>
<li><code>--error</code>: force render error</li>
<li><code>--puppeteer-debug</code>: enable puppeteer debug mode*</li>
<li><code>--puppeteer-disable-headless</code>: disable puppeteer headless mode <em>(requires a graphical environment)</em>*</li>
<li><code>--puppeteer-wait-load</code>: override puppeteer wait events*</li>
<li><code>--puppeteer-wait-domcontentloaded</code>: override puppeteer wait events*</li>
<li><code>--puppeteer-wait-networkidle0</code>: override puppeteer wait events*</li>
<li><code>--puppeteer-wait-networkidle2</code>: override puppeteer wait events*</li>
</ul>
<blockquote>
<p><em>* üåê Web instances needs to have <a href="/source/plugins/core/README.md#debug"><code>debug</code></a> set in <code>settings.json</code> for these flags to be supported.</em></p>
</blockquote>
<blockquote>
<p>‚ö†Ô∏è No backward compatibility is guaranteed for these features, they are only meant for debugging purposes.</p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
üîß For development<br>
<b>type:</b> <code>array</code>
<i>(space-separated)</i>
<br>
<b>allowed values:</b><ul><li>--cakeday</li><li>--halloween</li><li>--winter</li><li>--error</li><li>--puppeteer-debug</li><li>--puppeteer-disable-headless</li><li>--puppeteer-wait-load</li><li>--puppeteer-wait-domcontentloaded</li><li>--puppeteer-wait-networkidle0</li><li>--puppeteer-wait-networkidle2</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>debug_print</code></h4></td>
    <td rowspan="2"><p>Print output in console</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
üîß For development<br>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>dryrun</code></h4></td>
    <td rowspan="2"><p>Dry-run</p>
<blockquote>
<p>‚ö†Ô∏è Unlike <a href="/source/plugins/core/README.md#output_action"><code>output_action: none</code></a>, output file won&#39;t be available in <code>/metrics_renders</code> directory</p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
üîß For development<br>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>experimental_features</code></h4></td>
    <td rowspan="2"><p>Experimental features</p>
<blockquote>
<p>‚ö†Ô∏è No backward compatibility is guaranteed for these features</p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
üîß For development<br>
<b>type:</b> <code>array</code>
<i>(space-separated)</i>
<br>
<b>allowed values:</b><ul><li>--optimize-svg</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>use_mocked_data</code></h4></td>
    <td rowspan="2"><p>Use mocked data instead of live APIs</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
üîß For development<br>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
</table>
<!--/options-->
</file>

<file path="source/plugins/discussions/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üí¨ Discussions</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays GitHub discussions stats.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.discussions.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_discussions</code></h4></td>
    <td rowspan="2"><p>Enable discussions plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_discussions_categories</code></h4></td>
    <td rowspan="2"><p>Discussion categories</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_discussions_categories_limit</code></h4></td>
    <td rowspan="2"><p>Display limit (categories)</p>
<p>Note that categories are sorted from highest to lowest count</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 0<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: GitHub Discussions
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.discussions.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_discussions: yes
  plugin_discussions_categories_limit: 8

```
<!--/examples-->
</file>

<file path="source/plugins/followup/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üéüÔ∏è Follow-up of issues and pull requests</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays the ratio of open/closed issues and the ratio of open/merged pull requests across repositories.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Indepth analysis</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.followup.indepth.svg" alt=""></img></details>
      <details><summary>Created on a user's repositories</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.followup.svg" alt=""></img></details>
      <details><summary>Created by a user</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.followup.user.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_followup</code></h4></td>
    <td rowspan="2"><p>Enable followup plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_followup_sections</code></h4></td>
    <td rowspan="2"><p>Displayed sections</p>
<ul>
<li><code>repositories</code>: overall status of issues and pull requests on your repositories</li>
<li><code>user</code>: overall status of issues and pull requests you have created on GitHub</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> repositories<br>
<b>allowed values:</b><ul><li>repositories</li><li>user</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_followup_indepth</code></h4></td>
    <td rowspan="2"><p>Indepth analysis</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.api.github.overuse</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_followup_archived</code></h4></td>
    <td rowspan="2"><p>Include archived repositories</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
</table>
<!--/options-->

## üîé `indepth` mode

The `plugin_followup_indepth` option collects additional stats to differentiate issues and pull requests opened by maintainers and users.

It helps knowing whether repositories are also maintained by other users and give an overall health status of repositories.

> ‚ö†Ô∏è This mode will try to list users with push access to know who are the maintainers in order to place issues in the correct category, which requires a `repo` scope. If not available, it will consider that only the owner is a maintainer.

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Opened on user's repositories
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.followup.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_followup: yes

```
```yaml
name: Opened by user
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.followup.user.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_followup: yes
  plugin_followup_sections: user

```
```yaml
name: Indepth analysis
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.followup.indepth.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_followup: yes
  plugin_followup_indepth: yes

```
```yaml
name: Exclude Archived
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.followup.archived.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_followup: yes
  plugin_followup_archived: no

```
<!--/examples-->
</file>

<file path="source/plugins/gists/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üé´ Gists</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays <a href="https://gist.github.com">gists</a> stats.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/terminal/README.md"><code>üìô Terminal template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.gists.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_gists</code></h4></td>
    <td rowspan="2"><p>Enable gists plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Gists
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.gists.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_gists: yes

```
<!--/examples-->
</file>

<file path="source/plugins/habits/index.mjs">
//Legacy import
import { recent as recent_analyzer } from "./../languages/analyzers.mjs"

//Setup
export default async function({login, data, rest, imports, q, account}, {enabled = false, extras = false, ...defaults} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.habits) || (!imports.metadata.plugins.habits.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {from, days, facts, charts, "charts.type": _charts, trim, "languages.limit": limit, "languages.threshold": threshold, skipped = []} = imports.metadata.plugins.habits.inputs({data, account, q}, defaults)
    threshold = (Number(threshold.replace(/%$/, "")) || 0) / 100
    skipped.push(...data.shared["repositories.skipped"])

    //Initialization
    const habits = {facts, charts, trim, lines: {average: {chars: 0}}, commits: {fetched: 0, hour: NaN, hours: {}, day: NaN, days: {}}, indents: {style: "", spaces: 0, tabs: 0}, linguist: {available: false, ordered: [], languages: {}}}
    const pages = Math.ceil(from / 100)
    const offset = data.config.timezone?.offset ?? 0

    //Get user recent activity
    console.debug(`metrics/compute/${login}/plugins > habits > querying api`)
    const events = []
    try {
      for (let page = 1; page <= pages; page++) {
        console.debug(`metrics/compute/${login}/plugins > habits > loading page ${page}`)
        events.push(...(await rest.activity.listEventsForAuthenticatedUser({username: login, per_page: 100, page})).data)
      }
    }
    catch {
      console.debug(`metrics/compute/${login}/plugins > habits > no more page to load`)
    }
    console.debug(`metrics/compute/${login}/plugins > habits > ${events.length} events loaded`)

    //Get user recent commits
    const commits = events
      .filter(({type}) => type === "PushEvent")
      .filter(({actor}) => account === "organization" ? true : actor.login?.toLocaleLowerCase() === login.toLocaleLowerCase())
      .filter(({repo: {name: repo}}) => imports.filters.repo(repo, skipped))
      .filter(({created_at}) => new Date(created_at) > new Date(Date.now() - days * 24 * 60 * 60 * 1000))
    console.debug(`metrics/compute/${login}/plugins > habits > filtered out ${commits.length} push events over last ${days} days`)
    habits.commits.fetched = commits.length

    //Retrieve edited files and filter edited lines (those starting with +/-) from patches
    console.debug(`metrics/compute/${login}/plugins > habits > loading patches`)
    const patches = [
      ...await Promise.allSettled(
        commits
          .flatMap(({payload}) => payload.commits ?? []) // ‚Üê „Äê‰øÆÊ≠£ÁÇπ„Äë ?? [] „ÇíËøΩÂä†
          .filter(({author}) => data.shared["commits.authoring"].filter(authoring => author?.login?.toLocaleLowerCase().includes(authoring) || author?.email?.toLocaleLowerCase().includes(authoring) || author?.name?.toLocaleLowerCase().includes(authoring)).length)
          .map(async commit => (await rest.request(commit)).data.files),
      ),
    ]
      .filter(({status}) => status === "fulfilled")
      .map(({value}) => value)
      .flatMap(files => files.map(file => ({name: imports.paths.basename(file.filename), patch: file.patch ?? ""})))
      .map(({name, patch}) => ({name, patch: patch.split("\n").filter(line => /^[+]/.test(line)).map(line => line.substring(1)).join("\n")}))

    //Commit day
    {
      //Compute commit days
      console.debug(`metrics/compute/${login}/plugins > habits > searching most active day of week`)
      const days = commits.map(({created_at}) => (new Date(new Date(created_at).getTime() + offset)).getDay())
      for (const day of days)
        habits.commits.days[day] = (habits.commits.days[day] ?? 0) + 1
      habits.commits.days.max = Math.max(...Object.values(habits.commits.days))
      //Compute day with most commits
      habits.commits.day = days.length ? ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"][Object.entries(habits.commits.days).sort(([_an, a], [_bn, b]) => b - a).map(([day, _occurrence]) => day)[0]] ?? NaN : NaN
    }

    //Commit hour
    {
      //Compute commit hours
      console.debug(`metrics/compute/${login}/plugins > habits > searching most active time of day`)
      const hours = commits.map(({created_at}) => (new Date(new Date(created_at).getTime() + offset)).getHours())
      for (const hour of hours)
        habits.commits.hours[hour] = (habits.commits.hours[hour] ?? 0) + 1
      habits.commits.hours.max = Math.max(...Object.values(habits.commits.hours))
      //Compute hour with most commits
      habits.commits.hour = hours.length ? `${Object.entries(habits.commits.hours).sort(([_an, a], [_bn, b]) => b - a).map(([hour, _occurrence]) => hour)[0]}`.padStart(2, "0") : NaN
    }

    //Indent style
    {
      //Attempt to guess whether tabs or spaces are used in patches
      console.debug(`metrics/compute/${login}/plugins > habits > searching indent style`)
      patches
        .map(({patch}) => patch.match(/((?:\t)|(?:[ ]{2})) /gm) ?? [])
        .forEach(indent => habits.indents[/^\t/.test(indent) ? "tabs" : "spaces"]++)
      habits.indents.style = habits.indents.spaces > habits.indents.tabs ? "spaces" : habits.indents.tabs > habits.indents.spaces ? "tabs" : ""
    }

    //Average characters per line
    {
      //Compute average number of characters per line of code fetched
      console.debug(`metrics/compute/${login}/plugins > habits > computing average number of characters per line of code`)
      const lines = patches.flatMap(({patch}) => patch.split("\n").map(line => line.length))
      habits.lines.average.chars = lines.reduce((a, b) => a + b, 0) / lines.length
    }

    //Linguist
    if ((charts) && (imports.metadata.plugins.habits.extras("charts", {extras, error: false}))) {
      //Check if linguist exists
      console.debug(`metrics/compute/${login}/plugins > habits > searching recently used languages using linguist`)
      if (patches.length) {
        //Call language analyzer (note: using content from other plugin is usually disallowed, this is mostly for legacy purposes)
        habits.linguist.available = true
        const {total, stats, colors} = await recent_analyzer({login, data, imports, rest, account}, {days, load: from || 1000, tempdir: "habits"})
        habits.linguist.languages = Object.fromEntries(Object.entries(stats).map(([language, value]) => [language, value / total]))
        habits.linguist.ordered = Object.entries(habits.linguist.languages).sort(([_an, a], [_bn, b]) => b - a).filter(([_, value]) => value > threshold).slice(0, limit || Infinity)
        habits.linguist.colors = colors
      }
      else {
        console.debug(`metrics/compute/${login}/plugins > habits > linguist not available`)
      }
    }

    //Generating charts
    if ((["graph", "chartist"].includes(_charts)) && (imports.metadata.plugins.habits.extras("charts.type", {extras}))) {
      console.debug(`metrics/compute/${login}/plugins > habits > generating charts`)
      habits.charts = await Promise.all([
        {type: "line", data: {...empty(24), ...Object.fromEntries(Object.entries(habits.commits.hours).filter(([k]) => !Number.isNaN(+k)))}, ticks: 24, low: 0, high: habits.commits.hours.max},
        {type: "line", data: {...empty(7), ...Object.fromEntries(Object.entries(habits.commits.days).filter(([k]) => !Number.isNaN(+k)))}, ticks: 7, low: 0, high: habits.commits.days.max, labels: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"], half: true},
        {type: "pie", data: Object.fromEntries(Object.entries(habits.linguist.languages).map(([k, v]) => [k, (100 * v).toFixed(2)])), colors: habits.linguist.colors, half: true},
      ].map(({type, data, high, low, ticks, colors = null, labels = null, half = false}) => {
        const width = 480 * (half ? 0.45 : 1)
        const height = 160
        if (type === "line")
          return imports.Graph.line(Object.entries(data).map(([x, y]) => ({x: +x, y})), {low, high, ticks, labels, width, height})
        if (type === "pie")
          return imports.Graph.pie(data, {colors, width, height})
        return ""
      }))
    }

    //Results
    return habits
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}

/**Initialize an empty object with values from 0 to n */
function empty(n) {
  return Object.fromEntries(new Array(n).fill(0).map((_, i) => [i, 0]))
}
</file>

<file path="source/plugins/habits/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üí° Coding habits and activity</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays coding habits based on recent activity, such as active hours and languages recently used.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Recent activity charts</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.habits.charts.svg" alt=""></img></details>
      <details open><summary>Mildly interesting facts</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.habits.facts.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_habits</code></h4></td>
    <td rowspan="2"><p>Enable habits plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_habits_from</code></h4></td>
    <td rowspan="2"><p>Events to use</p>
<p>A higher number will increase stats accuracy</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 1000)</i>
<br>
<b>default:</b> 200<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_habits_skipped</code></h4></td>
    <td rowspan="2"><p>Skipped repositories</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è© Inherits <code>repositories_skipped</code><br>
<b>type:</b> <code>array</code>
<i>(newline-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_habits_days</code></h4></td>
    <td rowspan="2"><p>Event maximum age</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 30)</i>
<br>
<b>default:</b> 14<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_habits_facts</code></h4></td>
    <td rowspan="2"><p>Mildly interesting facts</p>
<p>It includes indentation type, average number of characters per line of code, and most active time and day</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_habits_charts</code></h4></td>
    <td rowspan="2"><p>Charts</p>
<p>It includes commit activity per hour of day and commit activity per day of week
Recent language activity may also displayed (it requires extras features to be enabled for web instances) for historical reasons</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.api.github.overuse</i></li>
<li><i>metrics.run.tempdir</i></li>
<li><i>metrics.run.git</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_habits_charts_type</code></h4></td>
    <td rowspan="2"><p>Charts display type</p>
<ul>
<li><code>classic</code>: <code>&lt;div&gt;</code> based charts, simple and lightweight</li>
<li><code>graph</code>: <code>&lt;svg&gt;</code> based charts, smooth</li>
</ul>
<blockquote>
<p>‚ö†Ô∏è <code>chartist</code> option has been deprecated and is now equivalent to <code>graph</code></p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.npm.optional.d3</i></li>
</ul>
<b>type:</b> <code>string</code>
<br>
<b>default:</b> classic<br>
<b>allowed values:</b><ul><li>classic</li><li>graph</li><li>chartist</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_habits_trim</code></h4></td>
    <td rowspan="2"><p>Trim unused hours on charts</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_habits_languages_limit</code></h4></td>
    <td rowspan="2"><p>Display limit (languages)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 8)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 8<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_habits_languages_threshold</code></h4></td>
    <td rowspan="2"><p>Display threshold (percentage)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> 0%<br></td>
  </tr>
</table>
<!--/options-->

## üåê Configure used timezone

By default, dates use Greenwich meridian (GMT/UTC).

Configure `config_timezone` (see [supported timezone](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)) to avoid time offsets.

*Example: configuring timezone*
```yaml
- uses: lowlighter/metrics@latest
  with:
    config_timezone: Europe/Paris
```

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Mildly interesting facts
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.habits.facts.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_habits: yes
  plugin_habits_facts: yes
  plugin_habits_charts: no
  config_timezone: Europe/Paris

```
```yaml
name: Recent activity charts
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.habits.charts.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_habits: yes
  plugin_habits_facts: no
  plugin_habits_charts: yes
  config_timezone: Europe/Paris

```
<!--/examples-->
</file>

<file path="source/plugins/introduction/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üôã Introduction</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays account bio or organization/repository description.</p>
<p>Since account bio is already displayed on account profile, this plugin is mostly intended for external usage.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>For a user or an organization</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.introduction.svg" alt=""></img></details>
      <details><summary>For a repository</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.introduction.repository.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_introduction</code></h4></td>
    <td rowspan="2"><p>Enable introduction plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_introduction_title</code></h4></td>
    <td rowspan="2"><p>Section title</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Organization introduction
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.introduction.svg
  token: ${{ secrets.METRICS_TOKEN }}
  user: github
  base: header
  plugin_introduction: yes

```
```yaml
name: Repository introduction
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.introduction.repository.svg
  token: ${{ secrets.METRICS_TOKEN }}
  template: repository
  repo: metrics
  base: header
  plugin_introduction: yes

```
<!--/examples-->
</file>

<file path="source/plugins/isocalendar/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üìÖ Isometric commit calendar</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays an isometric view of a user commit calendar along with a few additional statistics like current streak and average number of commit per day.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/terminal/README.md"><code>üìô Terminal template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Full year calendar</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.isocalendar.fullyear.svg" alt=""></img></details>
      <details><summary>Half year calendar</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.isocalendar.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_isocalendar</code></h4></td>
    <td rowspan="2"><p>Enable isocalendar plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_isocalendar_duration</code></h4></td>
    <td rowspan="2"><p>Time range</p>
<ul>
<li><code>half-year</code>: 180 days</li>
<li><code>full-year</code>: 1 year</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> half-year<br>
<b>allowed values:</b><ul><li>half-year</li><li>full-year</li></ul></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Half-year calendar
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.isocalendar.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_isocalendar: yes

```
```yaml
name: Full-year calendar
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.isocalendar.fullyear.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_isocalendar: yes
  plugin_isocalendar_duration: full-year

```
<!--/examples-->
</file>

<file path="source/plugins/languages/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üà∑Ô∏è Languages activity</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin can display which languages you use across all repositories you contributed to.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a> <a href="/source/templates/terminal/README.md"><code>üìô Terminal template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Indepth analysis (clone and analyze repositories)</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.languages.indepth.svg" alt=""></img></details>
      <details open><summary>Recently used (analyze recent activity events)</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.languages.recent.svg" alt=""></img></details>
      <details><summary>Default algorithm</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.languages.svg" alt=""></img></details>
      <details><summary>Default algorithm (with details)</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.languages.details.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages</code></h4></td>
    <td rowspan="2"><p>Enable languages plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_ignored</code></h4></td>
    <td rowspan="2"><p>Ignored languages</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_skipped</code></h4></td>
    <td rowspan="2"><p>Skipped repositories</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è© Inherits <code>repositories_skipped</code><br>
<b>type:</b> <code>array</code>
<i>(newline-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_limit</code></h4></td>
    <td rowspan="2"><p>Display limit</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 8)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 8<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_threshold</code></h4></td>
    <td rowspan="2"><p>Display threshold (percentage)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> 0%<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_other</code></h4></td>
    <td rowspan="2"><p>Group unknown, ignored and over-limit languages into &quot;Other&quot; category</p>
<p>If this option is enabled, &quot;Other&quot; category will not be subject to <a href="/source/plugins/languages/README.md#plugin_languages_threshold"><code>plugin_languages_threshold</code></a>.
It will be automatically hidden if empty.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_colors</code></h4></td>
    <td rowspan="2"><p>Custom languages colors</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> github<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_aliases</code></h4></td>
    <td rowspan="2"><p>Custom languages names</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_sections</code></h4></td>
    <td rowspan="2"><p>Displayed sections</p>
<p>Note that <code>recently-used</code> is only available when <a href="/source/plugins/languages/README.md#plugin_languages_indepth"><code>plugin_languages_indepth</code></a> is enabled</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> most-used<br>
<b>allowed values:</b><ul><li>most-used</li><li>recently-used</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_details</code></h4></td>
    <td rowspan="2"><p>Additional details</p>
<p>Note that <code>lines</code> is only available when <a href="/source/plugins/languages/README.md#plugin_languages_indepth"><code>plugin_languages_indepth</code></a> is enabled</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>allowed values:</b><ul><li>bytes-size</li><li>percentage</li><li>lines</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_indepth</code></h4></td>
    <td rowspan="2"><p>Indepth mode</p>
<blockquote>
<p>‚ö†Ô∏è read documentation first</p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.cpu.overuse</i></li>
<li><i>metrics.run.tempdir</i></li>
<li><i>metrics.run.git</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> false<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_indepth_custom</code></h4></td>
    <td rowspan="2"><p>Indepth mode - Custom repositories</p>
<p>Specify a list of additional repositories to analyze.</p>
<p>Below are the supported syntax formats:</p>
<ul>
<li><code>owner/repo</code> (e.g. <code>lowlighter/metrics</code>)</li>
<li><code>owner/repo@branch</code> (e.g. <code>lowlighter/metrics@main</code>)</li>
<li><code>owner/repo@branch:commits</code> (e.g. <code>lowlighter/metrics@main:v1.0..v1.1</code>)<ul>
<li>See <a href="https://git-scm.com/docs/git-rev-list#_description"><code>git rev-list</code></a> documentation for more information about <code>commits</code> syntax</li>
</ul>
</li>
</ul>
<p>It is possible to specify repositories that are not hosted on <a href="https://github.com">github.com</a> by passing a full url instead.
In this case the repository must be accessible directly.</p>
<blockquote>
<p>‚ÑπÔ∏è This option bypass <a href="/source/plugins/languages/README.md#plugin_languages_skipped"><code>plugin_languages_skipped</code></a></p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_analysis_timeout</code></h4></td>
    <td rowspan="2"><p>Indepth mode - Analysis timeout</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 60)</i>
<br>
<b>default:</b> 15<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_analysis_timeout_repositories</code></h4></td>
    <td rowspan="2"><p>Indepth mode - Analysis timeout (repositories)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 15)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 7.5<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_categories</code></h4></td>
    <td rowspan="2"><p>Indepth mode - Displayed categories (most-used section)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> markup, programming<br>
<b>allowed values:</b><ul><li>data</li><li>markup</li><li>programming</li><li>prose</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_recent_categories</code></h4></td>
    <td rowspan="2"><p>Indepth mode - Displayed categories (recently-used section)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> markup, programming<br>
<b>allowed values:</b><ul><li>data</li><li>markup</li><li>programming</li><li>prose</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_recent_load</code></h4></td>
    <td rowspan="2"><p>Indepth mode - Events to load (recently-used section)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(100 ‚â§
ùë•
‚â§ 1000)</i>
<br>
<b>default:</b> 300<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_languages_recent_days</code></h4></td>
    <td rowspan="2"><p>Indepth mode - Events maximum age (day, recently-used section)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 365)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 14<br></td>
  </tr>
</table>
<!--/options-->

## üîé `indepth` mode

The default algorithm uses the top languages from each repository you contributed to using GitHub GraphQL API (which is similar to the displayed languages bar on github.com). When working in collaborative projects with a lot of people, these numbers may be less representative of your actual work.

The `plugin_languages_indepth` option lets you use a more advanced algorithm for more accurate statistics.
Under the hood, it will clone your repositories, run [linguist-js](https://github.com/Nixinova/Linguist) (a JavaScript port of [GitHub linguist](https://github.com/github/linguist)) and iterate over patches matching your `commits_authoring` setting.

Since git lets you use any email and username for commits, *metrics* may not be able to detect a commit ownership if it isn't the same as your GitHub personal data. By default, it will use your GitHub username, but you can configure additional matching usernames and email addresses using `commits_authoring` option.

*Example: configuring `indepth` mode*
```yml
- uses: lowlighter/metrics@latest
  with:
    plugin_languages: yes
    plugin_languages_indepth: yes
    commits_authoring: firstname lastname, username, username@users.noreply.github.com
```

> üí° This feature unlocks the `lines` option in `plugin_languages_details`

> ‚ö†Ô∏è This feature significantly increase workflow time

> ‚ö†Ô∏è Since this mode iterates over **each matching commit of each repository**, it is not suited for large code base, especially those with a large amount of commits and the ones containing binaries. While `plugin_languages_analysis_timeout` and `plugin_languages_analysis_timeout_repositories` can be used to increase the default timeout for analysis, please be responsible and keep this feature disabled if it cannot work on your account to save GitHub resources and our planet üåè

> ‚ö†Ô∏è Although *metrics* does not send any code to external sources, repositories are temporarily cloned on the GitHub Action runner. It is advised to keep this option disabled when working with sensitive data or company code. Use at your own risk, *metrics* and its authors **cannot** be held responsible for any resulting code leaks. Source code is available for auditing at [analyzers.mjs](/source/plugins/languages/analyzers.mjs).

> üåê Web instances must enable this feature in `settings.json`

Below is a summary of the process used to compute indepth statistics:

## Most used mode

1. Fetch GPG keys linked to your GitHub account
  - automatically add attached emails to `commits_authoring`
  - *web-flow* (GitHub's public key for changes made through web-ui) is also fetched
2. Import GPG keys so they can be used to verify commits later
3. Iterate through repositories
  - early break if `plugin_languages_analysis_timeout` is reached
  - skip repository if it matches `plugin_languages_skipped`
  - include repositories from `plugin_languages_indepth_custom`
    - a specific branch and commit range can be used
    - a source other than github.com can be used
4. Clone repository
  - target branch is checkout
5. List of authored commits is computed
  - using `git log --author` and `commits_authoring` to search in commit headers
  - using `git log --grep` and `commits_authoring` to search in commit body
  - ensure these are within the range specified by `plugin_languages_indepth_custom` (if applicable)
6. Process authored commits
  - early break if `plugin_languages_analysis_timeout_repositories` is reached
  - using `git verify-commit` to check authenticity against imported GPG keys
  - using `git log --patch` to extract added/deleted lines/bytes from each file
  - using [GitHub linguist](https://github.com/github/linguist) ([linguist-js](https://github.com/Nixinova/LinguistJS)) to detect language for each file
    - respect `plugin_languages_categories` option
    - if a file has since been deleted or moved, checkout on the last commit file was present and run linguist again
7. Aggregate results

## Recently used mode

1. Fetch push events linked to your account (or target repository)
  - matching `plugin_languages_recent_load` and `plugin_languages_recent_days` options
  - matching committer emails from `commits_authoring`
2. Process authored commits
  - using [GitHub linguist](https://github.com/github/linguist) ([linguist-js](https://github.com/Nixinova/LinguistJS)) to detect language for each file
    - respect `plugin_languages_recent_categories` option
    - directly pass file content rather than performing I/O and simulating a git repository
3. Aggregate results

## üìÖ Recently used languages

This feature uses a similar algorithm as `indepth` mode, but uses patches from your events feed instead.
It will fetch a specified amount of recent push events and perform linguistic analysis on it.

> ‚ö†Ô∏è Note that *metrics* won't be able to use more events than GitHub API is able to provide

*Example: display recently used languages from 400 GitHub events from last 2 weeks*
```yml
- uses: lowlighter/metrics@latest
  with:
    plugin_languages: yes
    plugin_languages_sections: recently-used
    plugin_languages_recent_load: 400
    plugin_languages_recent_days: 14
```

> üåê Web instances must enable this feature in `settings.json`

## ü•Ω Controling which languages are displayed

Several options lets you customize which languages should be displayed.
It is possible to ignore completely languages or those lower than a given threshold, skip repositories, and filter by language categories.

*Example: hide HTML and CSS languages, skip lowlighter/metrics repository*
```yml
- uses: lowlighter/metrics@latest
  with:
    plugin_languages: yes
    plugin_languages_ignored: html, css
    plugin_languages_skipped: lowlighter/metrics
```

*Example: hide languages with less than 2% usage*
```yml
- uses: lowlighter/metrics@latest
  with:
    plugin_languages: yes
    plugin_languages_threshold: 2%
```

> üí° The threshold feature will automatically scale remaining languages so the total percentage is always 100%. However, other stats like bytes count and lines are not affected.

When using `indepth` mode, it is possible to hide languages per category.
Supported categories are `data`, `markup`, `programming` and `prose`.

*Example: hide data and prose languages from stats*
```yml
- uses: lowlighter/metrics@latest
  with:
    plugin_languages: yes
    plugin_languages_categories: data, prose
    plugin_languages_recent_categories: data, prose
```

## üé® Using custom colors

The plugin uses GitHub language colors, but it may be hard to distinguish them depending on which languages you use.
It is possible to use custom colors using `plugin_languages_colors` option.

The following syntaxes are supported:
- A predefined set from [colorsets.json](colorsets.json) *(support limited to 8 languages max)*
- `${language}:${color}` to change the color of a language *(case insensitive)*
- `${n}:${color}` to change the color of the n-th language

Both hexadecimal and [named color](https://developer.mozilla.org/en-US/docs/Web/CSS/color_value) are supported.

*Example: using a predefined color set*
```yml
- uses: lowlighter/metrics@latest
  with:
    plugin_languages: yes
    plugin_languages_colors: rainbow
    plugin_languages_limit: 8
```

*Example: setting JavaScript to red, the first language to blue and the second one to `#ff00aa`*
```yml
- uses: lowlighter/metrics@latest
  with:
    plugin_languages: yes
    plugin_languages_colors: javascript:red, 0:blue, 1:#ff00aa
```

## ‚úçÔ∏è Using custom languages name

This plugin is limited by [GitHub linguist](https://github.com/github/linguist) capabilities, meaning that some languages may be mislabeled in some cases.

To mitigate this, it is possible to use `plugin_languages_aliases` option and provide a list of overrides using the following syntax: `${language}:${alias}` *(case insensitive)*.

*Example: display JavaScript as JS and TypeScript as TS*
```yml
- uses: lowlighter/metrics@latest
  with:
    plugin_languages: yes
    plugin_languages_aliases: javascript:JS typescript:TS
```

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Most used
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.languages.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_languages: yes
  plugin_languages_ignored: >-
    html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell,
    gnuplot
  plugin_languages_limit: 4

```
```yaml
name: Most used (with details)
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.languages.details.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_languages: yes
  plugin_languages_ignored: >-
    html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell,
    gnuplot
  plugin_languages_details: bytes-size, percentage
  plugin_languages_limit: 4

```
```yaml
name: Recently used
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.languages.recent.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_languages: yes
  plugin_languages_ignored: >-
    html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell,
    gnuplot
  plugin_languages_sections: recently-used
  plugin_languages_details: bytes-size, percentage
  plugin_languages_limit: 4

```
```yaml
name: Indepth analysis
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.languages.indepth.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_languages: yes
  plugin_languages_ignored: >-
    html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell,
    gnuplot
  plugin_languages_indepth: yes
  plugin_languages_details: lines, bytes-size
  plugin_languages_limit: 4
  plugin_languages_analysis_timeout: 15

```
<!--/examples-->
</file>

<file path="source/plugins/licenses/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üìú Repository licenses</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin display repository license informations like permissions, limitations and conditions along with additional stats about dependencies.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr><th>‚Ñπ Additional notes</th><td><blockquote>
<p>‚ö†Ô∏è This is <strong>NOT</strong> legal advice, use at your own risk</p>
</blockquote>
<blockquote>
<p>üí£ This plugin <strong>SHOULD NOT</strong> be enabled on web instances, since it allows raw command injection.
This could result in compromised server!</p>
</blockquote>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a></td>
  </tr>
  <tr>
    <td><code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Permissions, limitations and conditions</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.licenses.svg" alt=""></img></details>
      <details open><summary>Licenses overview</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.licenses.ratio.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## üîé Licenses analysis

Use to `plugin_licenses_setup` command to setup project dependencies.

*Example: setup a NodeJS project using `npm ci`*
```yml
- name: Licenses and permissions
  with:
    repo: metrics
    plugin_licenses: yes
    plugin_licenses_setup: npm ci
```

Dependencies will be analyzed by [GitHub licensed](https://github.com/github/licensed) and compared against GitHub known licenses.

> ‚ö†Ô∏è This is **NOT** legal advice, use at your own risk

> üí£ This plugin **SHOULD NOT** be enabled on web instances, since it allows raw command injection.
> This could result in compromised server!


## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_licenses</code></h4></td>
    <td rowspan="2"><p>Enable licenses plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.cpu.overuse</i></li>
<li><i>metrics.run.tempdir</i></li>
<li><i>metrics.run.git</i></li>
<li><i>metrics.run.licensed</i></li>
<li><i>metrics.run.user.cmd</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_licenses_setup</code></h4></td>
    <td rowspan="2"><p>Setup command</p>
<blockquote>
<p>‚ÑπÔ∏è Depending on the project, this may not be required.
The example command is intended for NodeJs projects that use <code>npm</code> to install their dependencies.</p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_licenses_ratio</code></h4></td>
    <td rowspan="2"><p>Used licenses ratio</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_licenses_legal</code></h4></td>
    <td rowspan="2"><p>Permissions, limitations and conditions about used licenses</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Licenses and permissions
with:
  filename: metrics.plugin.licenses.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  template: repository
  repo: metrics
  plugin_licenses: yes
  plugin_licenses_setup: bash -c '[[ -f package.json ]] && npm ci || true'

```
```yaml
name: Licenses with open-source ratio graphs
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.licenses.ratio.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  template: repository
  repo: metrics
  plugin_licenses: yes
  plugin_licenses_setup: bash -c '[[ -f package.json ]] && npm ci || true'
  plugin_licenses_legal: no
  plugin_licenses_ratio: yes

```
<!--/examples-->
</file>

<file path="source/plugins/music/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üéº Music activity and suggestions</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin can display top and recently listened music tracks or titles from a random playlist.</p>
<p>Different music providers are supported.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with any of the supported provider.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code></td>
  </tr>
  <tr>
    <td><code>üóùÔ∏è plugin_music_token</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Random tracks from a playlist</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.music.playlist.svg" alt=""></img></details>
      <details open><summary>Recently listened</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.music.recent.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

#### ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_music</code></h4></td>
    <td rowspan="2"><p>Enable music plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.run.puppeteer.scrapping</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_music_provider</code></h4></td>
    <td rowspan="2"><p>Music provider</p>
<ul>
<li><code>apple</code>: Apple Music</li>
<li><code>spotify</code>: Spotify</li>
<li><code>lastfm</code>: Last.fm</li>
<li><code>youtube</code>: YouTube Music</li>
</ul>
<p>This setting is optional when using <a href="/source/plugins/music/README.md#plugin_music_mode"><code>plugin_music_mode: playlist</code></a> (provider will be auto-detected from <a href="/source/plugins/music/README.md#plugin_music_playlist"><code>plugin_music_playlist</code></a> URL)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>allowed values:</b><ul><li>apple</li><li>spotify</li><li>lastfm</li><li>youtube</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_music_token</code></h4></td>
    <td rowspan="2"><p>Music provider token</p>
<p>Below is the expected token format for each provider:</p>
<ul>
<li><code>apple</code>: <em>(not supported)</em></li>
<li><code>spotify</code>: &quot;client_id, client_secret, refresh_token&quot;</li>
<li><code>lastfm</code>: &quot;api_key&quot;</li>
<li><code>youtube</code>: &quot;cookie&quot;</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üîê Token<br>
üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.api.music.any</i></li>
</ul>
<b>type:</b> <code>token</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_music_user</code></h4></td>
    <td rowspan="2"><p>Music provider username</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>string</code>
<br>
<b>default:</b> <code>‚Üí User login</code><br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_music_mode</code></h4></td>
    <td rowspan="2"><p>Display mode</p>
<ul>
<li><code>playlist</code>: display random tracks from an URL playlist</li>
<li><code>recent</code>: display recently listened tracks</li>
<li><code>top</code>: display top listened artists/tracks</li>
</ul>
<p>If <a href="/source/plugins/music/README.md#plugin_music_playlist"><code>plugin_music_playlist</code></a> is specified, the default value is <code>playlist</code>, else it is <code>recent</code></p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>allowed values:</b><ul><li>playlist</li><li>recent</li><li>top</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_music_playlist</code></h4></td>
    <td rowspan="2"><p>Playlist URL</p>
<p>It must be from an &quot;embed url&quot; (i.e. music player iframes that can be integrated in other websites)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_music_limit</code></h4></td>
    <td rowspan="2"><p>Display limit</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 100)</i>
<br>
<b>default:</b> 4<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_music_played_at</code></h4></td>
    <td rowspan="2"><p>Recently played - Last played timestamp</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_music_time_range</code></h4></td>
    <td rowspan="2"><p>Top tracks - Time range</p>
<ul>
<li><code>short</code>: 4 weeks</li>
<li><code>medium</code>: 6 months</li>
<li><code>long</code>: several years</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> short<br>
<b>allowed values:</b><ul><li>short</li><li>medium</li><li>long</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_music_top_type</code></h4></td>
    <td rowspan="2"><p>Top tracks - Display type</p>
<ul>
<li><code>tracks</code>: display track</li>
<li><code>artists</code>: display artists</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> tracks<br>
<b>allowed values:</b><ul><li>tracks</li><li>artists</li></ul></td>
  </tr>
</table>
<!--/options-->

## üé∫ Configuring music provider

Select a music provider below for additional instructions.

## üéôÔ∏è Spotify

### üóùÔ∏è Obtaining a token

Spotify does not have *personal tokens*, so it makes the process a bit longer because it is required to follow the [authorization workflow](https://developer.spotify.com/documentation/general/guides/authorization-guide/)... Follow the instructions below for a *TL;DR* to obtain a `refresh_token`.

Sign in to the [developer dashboard](https://developer.spotify.com/dashboard/) and create a new app.
Keep your `client_id` and `client_secret` and let this tab open for now.

![Add a redirect url](/.github/readme/imgs/plugin_music_recent_spotify_token_0.png)

Open the settings and add a new *Redirect url*. Normally it is used to setup callbacks for apps, but just put `https://localhost` instead (it is mandatory as per the [authorization guide](https://developer.spotify.com/documentation/general/guides/authorization-guide/), even if not used).

Forge the authorization url with your `client_id` and the encoded `redirect_uri` you whitelisted, and access it from your browser:

```
https://accounts.spotify.com/authorize?client_id=********&response_type=code&scope=user-read-recently-played%20user-top-read&redirect_uri=https%3A%2F%2Flocalhost
```

When prompted, authorize application.

![Authorize application](/.github/readme/imgs/plugin_music_recent_spotify_token_1.png)

Once redirected to `redirect_uri`, extract the generated authorization `code` from your url bar.

![Extract authorization code from url](/.github/readme/imgs/plugin_music_recent_spotify_token_2.png)

Go back to developer dashboard tab, and open the web console of your browser to paste the following JavaScript code, with your own `client_id`, `client_secret`, authorization `code` and `redirect_uri`.

```js
(async () => {
  console.log(await (await fetch("https://accounts.spotify.com/api/token", {
    method:"POST",
    headers:{"Content-Type":"application/x-www-form-urlencoded"},
    body:new URLSearchParams({
      grant_type:"authorization_code",
      redirect_uri:"https://localhost",
      client_id:"********",
      client_secret:"********",
      code:"********",
    })
  })).json())
})()
```

It should return a JSON response with the following content:
```json
{
  "access_token":"********",
  "expires_in": 3600,
  "scope":"user-read-recently-played user-top-read",
  "token_type":"Bearer",
  "refresh_token":"********"
}
```

Register your `client_id`, `client_secret` and `refresh_token` in secrets to finish setup.

### üîó Get an embed playlist url for `plugin_music_playlist`

Connect to [spotify.com](https://www.spotify.com) and select the playlist you want to share.
From `...` menu, select `Share` and `Copy embed code`.

![Copy embed code of playlist](/.github/readme/imgs/plugin_music_playlist_spotify.png)

Extract the source link from the code pasted in your clipboard:
```html
<iframe src="https://open.spotify.com/embed/playlist/********" width="" height="" frameborder="0" allowtransparency="" allow=""></iframe>
```

## üçé Apple Music

### üóùÔ∏è Obtaining a token

*(Not available)*

> üò• Unfortunately I wasn't able to find a workaround to avoid paying the $99 fee for the developer program, even using workarounds like *smart playlists*, *shortcuts* and other stuff. However if you really want this feature, you could [sponsor me](github.com/sponsors/lowlighter) and I could eventually invest in a developer account with enough money, implement it and also eventually offer service on the shared instance

### üîó Get an embed playlist url for `plugin_music_playlist`

Connect to [music.apple.com](https://music.apple.com/) and select the playlist you want to share.
From `...` menu, select `Share` and `Copy embed code`.

![Copy embed code of playlist](/.github/readme/imgs/plugin_music_playlist_apple.png)

Extract the source link from the code pasted in your clipboard:
```html
<iframe allow="" frameborder="" height="" style="" sandbox="" src="https://embed.music.apple.com/**/playlist/********"></iframe>
```

## ‚èØÔ∏è Youtube Music

### üóùÔ∏è Obtaining a token

Login to [YouTube Music](https://music.youtube.com) on any modern browser.

Open the developer tools (Ctrl-Shift-I) and select the ‚ÄúNetwork‚Äù tab

![Open developer tools](/.github/readme/imgs/plugin_music_recent_youtube_cookie_1.png)

Find an authenticated POST request. The simplest way is to filter by /browse using the search bar of the developer tools. If you don‚Äôt see the request, try scrolling down a bit or clicking on the library button in the top bar.

Click on the Name of any matching request. In the ‚ÄúHeaders‚Äù tab, scroll to the ‚ÄúCookie‚Äù and copy this by right-clicking on it and selecting ‚ÄúCopy value‚Äù.

![Copy cookie value](/.github/readme/imgs/plugin_music_recent_youtube_cookie_2.png)

### üîó Get an embed playlist url for `plugin_music_playlist`

Extract the *playlist* URL of the playlist you want to share.

Connect to [music.youtube.com](https://music.youtube.com) and select the playlist you want to share.

Extract the source link from the code pasted in your clipboard:
```
https://music.youtube.com/playlist?list=********
```

## üìª Last.fm

### üóùÔ∏è Obtaining a token

[Create an API account](https://www.last.fm/api/account/create) or [use an existing one](https://www.last.fm/api/accounts) to obtain a Last.fm API key.

### üîó Get an embed playlist url for `plugin_music_playlist`

*(Not available)*

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Apple Music - Random track from playlist
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.music.playlist.svg
  token: NOT_NEEDED
  base: ""
  plugin_music: yes
  plugin_music_playlist: https://embed.music.apple.com/fr/playlist/usr-share/pl.u-V9D7m8Etjmjd0D
  plugin_music_limit: 2

```
```yaml
name: Spotify - Random track from playlist
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.music.playlist.spotify.svg
  token: NOT_NEEDED
  base: ""
  plugin_music: yes
  plugin_music_playlist: https://open.spotify.com/embed/playlist/3nfA87oeJw4LFVcUDjRcqi

```
```yaml
name: Spotify - Recently listed
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.music.recent.svg
  token: NOT_NEEDED
  base: ""
  plugin_music: yes
  plugin_music_provider: spotify
  plugin_music_mode: recent
  plugin_music_token: ${{ secrets.SPOTIFY_TOKENS }}
  plugin_music_limit: 2

```
```yaml
name: Spotify - Top tracks
uses: lowlighter/metrics@latest
with:
  token: NOT_NEEDED
  base: ""
  plugin_music: yes
  plugin_music_mode: top
  plugin_music_provider: spotify
  plugin_music_token: ${{ secrets.SPOTIFY_TOKENS }}
  plugin_music_time_range: short
  plugin_music_top_type: tracks

```
```yaml
name: Spotify - Top artists
uses: lowlighter/metrics@latest
with:
  token: NOT_NEEDED
  base: ""
  plugin_music: yes
  plugin_music_mode: top
  plugin_music_provider: spotify
  plugin_music_token: ${{ secrets.SPOTIFY_TOKENS }}
  plugin_music_time_range: long
  plugin_music_top_type: artists

```
```yaml
name: Youtube Music - Random track from playlist
uses: lowlighter/metrics@latest
with:
  token: NOT_NEEDED
  base: ""
  plugin_music: yes
  plugin_music_playlist: >-
    https://music.youtube.com/playlist?list=OLAK5uy_kU_uxp9TUOl9zVdw77xith8o9AknVwz9U

```
```yaml
name: Youtube Music - Recently listed
uses: lowlighter/metrics@latest
with:
  token: NOT_NEEDED
  base: ""
  plugin_music_token: ${{ secrets.YOUTUBE_MUSIC_TOKENS }}
  plugin_music: yes
  plugin_music_mode: recent
  plugin_music_provider: youtube

```
```yaml
name: Last.fm  - Recently listed
uses: lowlighter/metrics@latest
with:
  token: NOT_NEEDED
  base: ""
  plugin_music_token: ${{ secrets.LASTFM_TOKEN }}
  plugin_music: yes
  plugin_music_provider: lastfm
  plugin_music_user: RJ

```
<!--/examples-->
</file>

<file path="source/plugins/notable/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üé© Notable contributions</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays badges for notable contributions on repositories.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Indepth analysis</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.notable.indepth.svg" alt=""></img></details>
      <details><summary>Contributions in organizations only</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.notable.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_notable</code></h4></td>
    <td rowspan="2"><p>Enable notable plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_notable_filter</code></h4></td>
    <td rowspan="2"><p>Query filter</p>
<p>Based on <a href="https://docs.github.com/en/search-github/getting-started-with-searching-on-github/understanding-the-search-syntax">GitHub search syntax</a>.
Supported fields are <code>stars</code>, <code>forks</code> and <code>watchers</code></p>
<p>If <a href="/source/plugins/notable/README.md#plugin_notable_indepth"><code>plugin_notable_indepth</code></a> is enabled, <code>commits</code>, <code>commits.user</code>, <code>commits.user%</code> and <code>maintainer</code> fields are also supported.
Some repositories may not be able to reported advanced stats and in the case the default behaviour will be to bypass filtering</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_notable_skipped</code></h4></td>
    <td rowspan="2"><p>Skipped repositories</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è© Inherits <code>repositories_skipped</code><br>
<b>type:</b> <code>array</code>
<i>(newline-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_notable_from</code></h4></td>
    <td rowspan="2"><p>Repository owner account type filter</p>
<ul>
<li><code>all</code>: no filtering</li>
<li><code>organization</code>: only organization accounts repositories</li>
<li><code>user</code>: only user accounts repositories</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> organization<br>
<b>allowed values:</b><ul><li>all</li><li>organization</li><li>user</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_notable_repositories</code></h4></td>
    <td rowspan="2"><p>Repository name</p>
<p>Repositories hosted by user account will always have their full handle displayed</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_notable_indepth</code></h4></td>
    <td rowspan="2"><p>Indepth mode</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.api.github.overuse</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_notable_types</code></h4></td>
    <td rowspan="2"><p>Contribution types filter</p>
<p>Use a combination of below values to include repositories where:</p>
<ul>
<li><code>commit</code>: a commit on default branch was made</li>
<li><code>pull_request</code>: a pull request was opened</li>
<li><code>issue</code>: an issue was opened</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> commit<br>
<b>allowed values:</b><ul><li>commit</li><li>pull_request</li><li>issue</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_notable_self</code></h4></td>
    <td rowspan="2"><p>Include own repositories</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
</table>
<!--/options-->

## üîé `indepth` mode

The `plugin_notable_indepth` option collects additional stats about your contributions, such as:
- Total number of commits within a repository or organization.

For each of the above, a badge is awarded. Its color and progress depends of the associated value.

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Contributions
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.notable.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_notable: yes

```
```yaml
name: Indepth analysis
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.notable.indepth.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_notable: yes
  plugin_notable_indepth: yes
  plugin_notable_repositories: yes

```
<!--/examples-->
</file>

<file path="source/plugins/pagespeed/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>‚è±Ô∏è Google PageSpeed</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays performance statistics of a website.</p>
<p>It uses <a href="https://developers.google.com/speed/docs/insights/v5/get-started">Google&#39;s PageSpeed API</a> (same as <a href="https://web.dev">web.dev</a>), see <a href="https://web.dev/performance-scoring/">performance scoring</a> and <a href="https://googlechrome.github.io/lighthouse/scorecalc/">score calculator</a> for more informations about results.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://pagespeed.web.dev/">Google PageSpeed</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a> <a href="/source/templates/terminal/README.md"><code>üìô Terminal template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üóùÔ∏è plugin_pagespeed_token</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>PageSpeed scores</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.pagespeed.svg" alt=""></img></details>
      <details><summary>PageSpeed scores with detailed report</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.pagespeed.detailed.svg" alt=""></img></details>
      <details><summary>PageSpeed scores with a website screenshot</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.pagespeed.screenshot.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_pagespeed</code></h4></td>
    <td rowspan="2"><p>Enable pagespeed plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_pagespeed_token</code></h4></td>
    <td rowspan="2"><p>PageSpeed token</p>
<blockquote>
<p>‚ö†Ô∏è While not mandatory, it is strongly advised pass a token to avoid triggering the rate limiter. See <a href="https://developers.google.com/speed/docs/insights/v5/get-started">PageSpeed documentation</a> for more informations.</p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üîê Token<br>
üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.api.google.pagespeed</i></li>
</ul>
<b>type:</b> <code>token</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_pagespeed_url</code></h4></td>
    <td rowspan="2"><p>Audited website</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>string</code>
<br>
<b>default:</b> <code>‚Üí User attached website</code><br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_pagespeed_detailed</code></h4></td>
    <td rowspan="2"><p>Detailed results</p>
<p>The following additional stats will be displayed:</p>
<ul>
<li>First Contentful Paint</li>
<li>Speed Index</li>
<li>Largest Contentful Paint</li>
<li>Time to Interactive</li>
<li>Total Blocking Time</li>
<li>Cumulative Layout Shift</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_pagespeed_screenshot</code></h4></td>
    <td rowspan="2"><p>Website screenshot</p>
<p>Significantly increase filesize</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_pagespeed_pwa</code></h4></td>
    <td rowspan="2"><p>PWA Status</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Succinct report
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.pagespeed.svg
  token: NOT_NEEDED
  base: ""
  plugin_pagespeed: yes
  plugin_pagespeed_token: ${{ secrets.PAGESPEED_TOKEN }}
  plugin_pagespeed_url: https://lecoq.io

```
```yaml
name: Detailed report
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.pagespeed.detailed.svg
  token: NOT_NEEDED
  base: ""
  plugin_pagespeed: yes
  plugin_pagespeed_detailed: yes
  plugin_pagespeed_token: ${{ secrets.PAGESPEED_TOKEN }}
  plugin_pagespeed_url: https://lecoq.io

```
```yaml
name: Screenshot
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.pagespeed.screenshot.svg
  token: NOT_NEEDED
  base: ""
  plugin_pagespeed: yes
  plugin_pagespeed_screenshot: yes
  plugin_pagespeed_token: ${{ secrets.PAGESPEED_TOKEN }}
  plugin_pagespeed_url: https://lecoq.io

```
```yaml
name: Succinct report with PWA
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.pagespeed.svg
  token: NOT_NEEDED
  base: ""
  plugin_pagespeed: yes
  plugin_pagespeed_token: ${{ secrets.PAGESPEED_TOKEN }}
  plugin_pagespeed_url: https://lecoq.io
  plugin_pagespeed_pwa: yes

```
<!--/examples-->
</file>

<file path="source/plugins/people/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üßë‚Äçü§ù‚Äçüßë People</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin can display relationships with users, such as followers, sponsors, contributors, stargazers, watchers, members, etc.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Related to a user</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.people.followers.svg" alt=""></img></details>
      <details><summary>Related to a repository</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.people.repository.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_people</code></h4></td>
    <td rowspan="2"><p>Enable people plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_people_limit</code></h4></td>
    <td rowspan="2"><p>Display limit</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 24<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_people_identicons</code></h4></td>
    <td rowspan="2"><p>Force identicons pictures</p>
<p>Can be used to mask profile pictures for privacy</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_people_identicons_hide</code></h4></td>
    <td rowspan="2"><p>Hide identicons pictures</p>
<p>Can be used to mask users without a personal profile picture.</p>
<p>When used with <a href="/source/plugins/people/README.md#plugin_people_identicons"><code>plugin_people_identicons</code></a>, users without a personal profile picture will still be filtered out, but their picture will be replaced by an identicon instead</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_people_size</code></h4></td>
    <td rowspan="2"><p>Profile picture display size</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(8 ‚â§
ùë•
‚â§ 64)</i>
<br>
<b>default:</b> 28<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_people_types</code></h4></td>
    <td rowspan="2"><p>Displayed sections</p>
<p>User and organization accounts support the following values:</p>
<ul>
<li><code>followers</code></li>
<li><code>following</code>/<code>followed</code></li>
<li><code>sponsoring</code>/<code>sponsored</code></li>
<li><code>sponsors</code></li>
<li><code>members</code> (organization only)</li>
<li><code>thanks</code>(to be configured with <a href="/source/plugins/people/README.md#plugin_people_thanks"><code>plugin_people_thanks</code></a>)</li>
</ul>
<p>Repositories support the following values:</p>
<ul>
<li><code>sponsors</code> (same as owner sponsors)</li>
<li><code>contributors</code></li>
<li><code>stargazers</code></li>
<li><code>watchers</code></li>
<li><code>thanks</code>(to be configured with <a href="/source/plugins/people/README.md#plugin_people_thanks"><code>plugin_people_thanks</code></a>)</li>
</ul>
<p>Specified order is honored</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> followers, following<br>
<b>allowed values:</b><ul><li>followers</li><li>following</li><li>followed</li><li>sponsoring</li><li>members</li><li>sponsored</li><li>sponsors</li><li>contributors</li><li>stargazers</li><li>watchers</li><li>thanks</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_people_thanks</code></h4></td>
    <td rowspan="2"><p>Special thanks</p>
<p>Can be used to thank specific users</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_people_sponsors_custom</code></h4></td>
    <td rowspan="2"><p>Custom sponsors</p>
<p>This list can be used to add users from unsupported GitHub sponsors sources.
The option <a href="/source/plugins/people/README.md#plugin_people_types"><code>plugin_people_types</code></a> must contain the <code>sponsors</code> section in order for this setting to be effective</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_people_shuffle</code></h4></td>
    <td rowspan="2"><p>Shuffle data</p>
<p>Can be used to create varied outputs
This will fetch additional data (10 times <a href="/source/plugins/people/README.md#plugin_people_limit"><code>plugin_people_limit</code></a>) to ensure output is always different</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Followers
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.people.followers.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_people: yes
  plugin_people_types: followers

```
```yaml
name: Contributors and sponsors
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.people.repository.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  template: repository
  repo: metrics
  plugin_people: yes
  plugin_people_types: contributors, stargazers, watchers, sponsors

```
<!--/examples-->
</file>

<file path="source/plugins/posts/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>‚úíÔ∏è Recent posts</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays recent articles from a specified and supported external source.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/markdown/README.md"><code>üìí Markdown template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><i>No tokens are required for this plugin</i></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Latest posts width description and cover image</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.posts.full.svg" alt=""></img></details>
      <details><summary>Latest posts</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.posts.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_posts</code></h4></td>
    <td rowspan="2"><p>Enable posts plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_posts_source</code></h4></td>
    <td rowspan="2"><p>External source</p>
<ul>
<li><code>dev.to</code>: <a href="https://dev.to">dev.to</a></li>
<li><code>hashnode</code>: <a href="https://hashnode.com">hashnode.com</a></li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>allowed values:</b><ul><li>dev.to</li><li>hashnode</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_posts_user</code></h4></td>
    <td rowspan="2"><p>External source username</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>string</code>
<br>
<b>default:</b> <code>‚Üí User login</code><br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_posts_descriptions</code></h4></td>
    <td rowspan="2"><p>Posts descriptions</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_posts_covers</code></h4></td>
    <td rowspan="2"><p>Posts cover images</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_posts_limit</code></h4></td>
    <td rowspan="2"><p>Display limit</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 30)</i>
<br>
<b>default:</b> 4<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Recent posts
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.posts.svg
  token: NOT_NEEDED
  base: ""
  plugin_posts: yes
  plugin_posts_source: dev.to

```
```yaml
name: Recent posts with descriptions and cover images
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.posts.full.svg
  token: NOT_NEEDED
  base: ""
  plugin_posts: yes
  plugin_posts_source: dev.to
  plugin_posts_limit: 2
  plugin_posts_descriptions: yes
  plugin_posts_covers: yes

```
<!--/examples-->
</file>

<file path="source/plugins/projects/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üóÇÔ∏è GitHub projects</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays progress of profile and repository projects.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>üîë public_repo</code> <code>üîë read:project</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.projects.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_projects</code></h4></td>
    <td rowspan="2"><p>Enable projects plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_projects_limit</code></h4></td>
    <td rowspan="2"><p>Display limit</p>
<p>Projects defined by <a href="/source/plugins/projects/README.md#plugin_projects_repositories"><code>plugin_projects_repositories</code></a> are not affected by this option</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 100)</i>
<br>
<b>default:</b> 4<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_projects_repositories</code></h4></td>
    <td rowspan="2"><p>Featured repositories projects</p>
<p>Use the following syntax for each project <code>:user/:repo/projects/:project_id</code></p>
<blockquote>
<p>‚ÑπÔ∏è <a href="https://docs.github.com/en/issues/trying-out-the-new-projects-experience/about-projects">GitHub projects (beta)</a> needs to use the same syntax as above and repository must specified repository must be linked to given project.</p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_projects_descriptions</code></h4></td>
    <td rowspan="2"><p>Projects descriptions</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
</table>
<!--/options-->

## üîÑ Enabling progress tracking

By default, projects have progress tracking disabled.

To enable it, open the `‚â° Menu` from the project page and opt-in to `Track project progress`.

![Enable "Track project progress"](/.github/readme/imgs/plugin_projects_track_progress.png)

## üë§ Use personal projects

To create a personal project, select the `Projects` tab from your profile:
![Create a new project](/.github/readme/imgs/plugin_projects_create.png)

Fill informations and set visibility to *public*:
![Configure project](/.github/readme/imgs/plugin_projects_setup.png)

## üìì Use repositories projects

Repositories projects are created from the `Projects` tab of a repository.

To use it with this plugin, retrieve the last section of the project URL (it should match the format `:user/:repository/projects/:project_id`) and add it in the `plugin_projects_repositories`.

Be sure to tick `Track project progress` in project settings to display a progress bar.

![Add a repository project](/.github/readme/imgs/plugin_projects_repositories.png)

*Example: include a project repository*
```yml
- uses: lowlighter/metrics@latest
  with:
    plugin_projects: yes
    plugin_projects_repositories: lowlighter/metrics/projects/1
```

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Project from a repository
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.projects.svg
  token: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}
  base: ""
  plugin_projects: yes
  plugin_projects_repositories: lowlighter/metrics/projects/1
  plugin_projects_descriptions: yes

```
<!--/examples-->
</file>

<file path="source/plugins/reactions/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üé≠ Comment reactions</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays overall user reactions on recent issues, comments and discussions.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.reactions.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_reactions</code></h4></td>
    <td rowspan="2"><p>Enable reactions plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_reactions_limit</code></h4></td>
    <td rowspan="2"><p>Display limit (issues and pull requests comments)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 1000)</i>
<br>
<b>default:</b> 200<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_reactions_limit_issues</code></h4></td>
    <td rowspan="2"><p>Display limit (issues and pull requests, first comment)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 1000)</i>
<br>
<b>default:</b> 100<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_reactions_limit_discussions</code></h4></td>
    <td rowspan="2"><p>Display limit (discussions, first comment)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 1000)</i>
<br>
<b>default:</b> 100<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_reactions_limit_discussions_comments</code></h4></td>
    <td rowspan="2"><p>Display limit (discussions comments)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 1000)</i>
<br>
<b>default:</b> 100<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_reactions_days</code></h4></td>
    <td rowspan="2"><p>Comments maximum age</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 0<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_reactions_display</code></h4></td>
    <td rowspan="2"><p>Display mode</p>
<ul>
<li><code>absolute</code>: scale percentages using total reactions count</li>
<li><code>relative</code>: scale percentages using highest reaction count</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> absolute<br>
<b>allowed values:</b><ul><li>absolute</li><li>relative</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_reactions_details</code></h4></td>
    <td rowspan="2"><p>Additional details</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>allowed values:</b><ul><li>count</li><li>percentage</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_reactions_ignored</code></h4></td>
    <td rowspan="2"><p>Ignored users</p>
<p>Can be used to ignore bots activity</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è© Inherits <code>users_ignored</code><br>
<b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Comment reactions
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.reactions.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_reactions: yes
  plugin_reactions_limit: 100
  plugin_reactions_details: percentage

```
<!--/examples-->
</file>

<file path="source/plugins/repositories/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üìì Featured repositories</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays a list of chosen featured repositories.</p>
<p>Since it is possible to <a href="https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-profile/customizing-your-profile/pinning-items-to-your-profile">pin repositories</a> on GitHub, this plugin is mostly intended for external usage.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr><th>‚Ñπ Additional notes</th><td><blockquote>
<p>‚ö†Ô∏è Due to limitations of using SVG images inside <code>&lt;img&gt;</code> tags, clicking on a repository card will not redirect to repository page.</p>
</blockquote>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Featured</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.repositories.svg" alt=""></img></details>
      <details><summary>Pinned</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.repositories.pinned.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_repositories</code></h4></td>
    <td rowspan="2"><p>Enable repositories plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_repositories_featured</code></h4></td>
    <td rowspan="2"><p>Featured repositories</p>
<p>Current <a href="/source/plugins/core/README.md#user"><code>user</code></a> will be used when no owner is specified</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_repositories_pinned</code></h4></td>
    <td rowspan="2"><p>Pinned repositories</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 6)</i>
<br>
<b>default:</b> 0<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_repositories_starred</code></h4></td>
    <td rowspan="2"><p>Featured most starred repositories</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 100)</i>
<br>
<b>default:</b> 0<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_repositories_random</code></h4></td>
    <td rowspan="2"><p>Featured random repositories</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 100)</i>
<br>
<b>default:</b> 0<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_repositories_order</code></h4></td>
    <td rowspan="2"><p>Featured repositories display order</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<br>
<b>default:</b> featured, pinned, starred, random<br>
<b>allowed values:</b><ul><li>featured</li><li>pinned</li><li>starred</li><li>random</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_repositories_forks</code></h4></td>
    <td rowspan="2"><p>Include repositories forks</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_repositories_affiliations</code></h4></td>
    <td rowspan="2"><p>Repositories affiliations</p>
<ul>
<li><code>owner</code>: owned repositories</li>
<li><code>collaborator</code>: repositories with push access</li>
<li><code>organization_member</code>: repositories from an organization where user is a member</li>
</ul>
<p>Set to <code>&quot;&quot;</code> to disable and fetch all repositories related to given account.</p>
<p>This option changes which repositories will be fetched by <a href="/source/plugins/projects/README.md#plugin_repositories_starred"><code>plugin_repositories_starred</code></a> and <a href="/source/plugins/projects/README.md#plugin_repositories_random"><code>plugin_repositories_random</code></a> options</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> owner<br>
<b>allowed values:</b><ul><li>owner</li><li>collaborator</li><li>organization_member</li></ul></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Featured repositories
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.repositories.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_repositories: yes
  plugin_repositories_featured: lowlighter/metrics

```
```yaml
name: Pinned repositories
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.repositories.pinned.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_repositories: yes
  plugin_repositories_pinned: 2

```
<!--/examples-->
</file>

<file path="source/plugins/rss/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üóº Rss feed</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays news from a given RSS feed.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/markdown/README.md"><code>üìí Markdown template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><i>No tokens are required for this plugin</i></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.rss.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_rss</code></h4></td>
    <td rowspan="2"><p>Enable rss plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_rss_source</code></h4></td>
    <td rowspan="2"><p>RSS feed source</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_rss_limit</code></h4></td>
    <td rowspan="2"><p>Display limit</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 30)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 4<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: News from hackernews
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.rss.svg
  token: NOT_NEEDED
  base: ""
  plugin_rss: yes
  plugin_rss_source: https://news.ycombinator.com/rss
  plugin_rss_limit: 4

```
<!--/examples-->
</file>

<file path="source/plugins/skyline/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üåá GitHub Skyline</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays the 3D commits calendar from <a href="https://skyline.github.com/">skyline.github.com</a>.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr><th>‚Ñπ Additional notes</th><td><blockquote>
<p>‚ö†Ô∏è This plugin significantly increase file size, consider using it as standalone.</p>
</blockquote>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><i>No tokens are required for this plugin</i></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>GitHub Skyline</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.skyline.svg" alt=""></img></details>
      <details><summary>GitHub City</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.skyline.city.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_skyline</code></h4></td>
    <td rowspan="2"><p>Enable skyline plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.cpu.overuse</i></li>
<li><i>metrics.npm.optional.gifencoder</i></li>
<li><i>metrics.run.puppeteer.scrapping</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_skyline_year</code></h4></td>
    <td rowspan="2"><p>Displayed year</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(2008 ‚â§
ùë•)</i>
<br>
<b>default:</b> current-year<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_skyline_frames</code></h4></td>
    <td rowspan="2"><p>Frames count</p>
<p>Use 120 for a full-loop and 60 for a half-loop.
A higher number of frames will increase file size.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 120)</i>
<br>
<b>default:</b> 60<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_skyline_quality</code></h4></td>
    <td rowspan="2"><p>Image quality</p>
<p>A higher image quality will increase file size.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0.1 ‚â§
ùë•
‚â§ 1)</i>
<br>
<b>default:</b> 0.5<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_skyline_compatibility</code></h4></td>
    <td rowspan="2"><p>Compatibility mode</p>
<p>This uses CSS animations rather than embedded GIF to support a wider range of browsers, like Firefox and Safari.
Using this mode significantly increase file size as each frame is encoded separately</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_skyline_settings</code></h4></td>
    <td rowspan="2"><p>Advanced settings</p>
<p>Can be configured to use alternate skyline websites different from <a href="https://skyline.github.com">skyline.github.com</a>, such as <a href="https://github.com/honzaap/GithubCity">honzaap&#39;s GitHub City</a>.</p>
<ul>
<li><code>url</code>: Target URL (mandatory)</li>
<li><code>ready</code>: Readiness condition (A JS function that returns a boolean)</li>
<li><code>wait</code>: Time to wait after readiness condition is met (in seconds)</li>
<li><code>hide</code>: HTML elements to hide (A CSS selector)</li>
</ul>
<p>For <code>url</code> and <code>ready</code> options, <code>${login}</code> and <code>${year}</code> will be respectively templated to user&#39;s login and specified year</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.run.puppeteer.user.js</i></li>
</ul>
<b>type:</b> <code>json</code>
<br>
<b>default:</b> <details><summary>‚Üí Click to expand</summary><pre language="json"><code>{
  "url": "https://skyline.github.com/${login}/${year}",
  "ready": "[...document.querySelectorAll('span')].map(span => span.innerText).includes('Share on Twitter')",
  "wait": 1,
  "hide": "button, footer, a"
}
</code></pre></details><br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: GitHub Skyline
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.skyline.svg
  token: NOT_NEEDED
  base: ""
  plugin_skyline: yes
  plugin_skyline_year: 2020
  plugin_skyline_frames: 6
  plugin_skyline_quality: 1

```
```yaml
name: GitHub City
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.skyline.city.svg
  token: NOT_NEEDED
  base: ""
  plugin_skyline: yes
  plugin_skyline_year: 2020
  plugin_skyline_frames: 6
  plugin_skyline_quality: 1
  plugin_skyline_settings: |
    {
      "url": "https://honzaap.github.io/GithubCity?name=${login}&year=${year}",
      "ready": "[...document.querySelectorAll('.display-info span')].map(span => span.innerText).includes('${login}')",
      "wait": 4,
      "hide": ".github-corner, .footer-link, .buttons-options, .mobile-rotate, .display-info span:first-child"
    }

```
<!--/examples-->
</file>

<file path="source/plugins/sponsors/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üíï GitHub Sponsors</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays sponsors and introduction text from <a href="https://github.com/sponsors/">GitHub sponsors</a>.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üîë read:user</code> <code>üîë read:org</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>GitHub sponsors card</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.sponsors.svg" alt=""></img></details>
      <details><summary>GitHub sponsors full introduction</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.sponsors.full.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_sponsors</code></h4></td>
    <td rowspan="2"><p>Enable sponsors plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_sponsors_sections</code></h4></td>
    <td rowspan="2"><p>Displayed sections</p>
<ul>
<li><code>goal</code>: display GitHub active goal</li>
<li><code>about</code>: display GitHub sponsors introduction</li>
<li><code>list</code>: display GitHub sponsors list</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> goal, list, about<br>
<b>allowed values:</b><ul><li>goal</li><li>about</li><li>list</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_sponsors_past</code></h4></td>
    <td rowspan="2"><p>Past sponsorships</p>
<p>A <a href="/source/plugins/core/README.md#token"><code>token</code></a> from target <a href="/source/plugins/core/README.md#user"><code>user</code></a> must be specified to use this feature, as past sponsorships are gathered from sponsors activity which is private data.</p>
<blockquote>
<p>‚ö†Ô∏è Past sponsorships does not respect sponsors privacy because of current GitHub API limitations. This may be fixed in a future release.</p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_sponsors_size</code></h4></td>
    <td rowspan="2"><p>Profile picture display size</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(8 ‚â§
ùë•
‚â§ 64)</i>
<br>
<b>default:</b> 24<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_sponsors_title</code></h4></td>
    <td rowspan="2"><p>Title caption</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> Sponsor Me!<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Sponsors goal
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.sponsors.svg
  token: ${{ secrets.METRICS_TOKEN_PERSONAL }}
  base: ""
  plugin_sponsors: yes
  plugin_sponsors_sections: goal, list
  plugin_sponsors_past: yes

```
```yaml
name: Sponsors introduction
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.sponsors.full.svg
  token: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}
  base: ""
  plugin_sponsors: yes

```
<!--/examples-->
</file>

<file path="source/plugins/sponsorships/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üíù GitHub Sponsorships</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays sponsorships funded through <a href="https://github.com/sponsors/">GitHub sponsors</a>.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code></td>
  </tr>
  <tr>
    <td><code>üîë read:user</code> <code>üîë read:org</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.sponsorships.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_sponsorships</code></h4></td>
    <td rowspan="2"><p>Enable sponsorships plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_sponsorships_sections</code></h4></td>
    <td rowspan="2"><p>Displayed sections</p>
<ul>
<li><code>amount</code>: display total amount sponsored</li>
<li><code>sponsorships</code>: display GitHub sponsorships</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> amount, sponsorships<br>
<b>allowed values:</b><ul><li>amount</li><li>sponsorships</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_sponsorships_size</code></h4></td>
    <td rowspan="2"><p>Profile picture display size</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(8 ‚â§
ùë•
‚â§ 64)</i>
<br>
<b>default:</b> 24<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: üíù GitHub Sponsorships
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.sponsorships.svg
  token: ${{ secrets.METRICS_TOKEN_PERSONAL }}
  base: ""
  plugin_sponsorships: yes

```
<!--/examples-->
</file>

<file path="source/plugins/stackoverflow/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üó®Ô∏è Stack Overflow</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays stats, questions and answer from <a href="https://stackoverflow.com/">Stack Overflow</a>.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://stackoverflow.com/">Stack Overflow</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code></td>
  </tr>
  <tr>
    <td><i>No tokens are required for this plugin</i></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stackoverflow.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stackoverflow</code></h4></td>
    <td rowspan="2"><p>Enable stackoverflow plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stackoverflow_user</code></h4></td>
    <td rowspan="2"><p>Stackoverflow user id</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>number</code>
<br>
<b>default:</b> 0<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stackoverflow_sections</code></h4></td>
    <td rowspan="2"><p>Displayed sections</p>
<ul>
<li><code>answers-top</code>: display most popular answers</li>
<li><code>answers-recent</code>: display recent answers</li>
<li><code>questions-top</code>: display most popular questions</li>
<li><code>questions-recent</code>: display recent questions</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> answers-top, questions-recent<br>
<b>allowed values:</b><ul><li>answers-top</li><li>answers-recent</li><li>questions-top</li><li>questions-recent</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stackoverflow_limit</code></h4></td>
    <td rowspan="2"><p>Display limit (entries per section)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 30)</i>
<br>
<b>default:</b> 2<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stackoverflow_lines</code></h4></td>
    <td rowspan="2"><p>Display limit (lines per questions and answers)</p>
<p>Code snippets count as a single line and must be configured with <a href="/source/plugins/stackoverflow/README.md#plugin_stackoverflow_lines_snippet"><code>plugin_stackoverflow_lines_snippet</code></a> instead</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 4<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stackoverflow_lines_snippet</code></h4></td>
    <td rowspan="2"><p>Display limit (lines per code snippets)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 2<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Top answers from stackoverflow
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.stackoverflow.svg
  token: NOT_NEEDED
  base: ""
  plugin_stackoverflow: yes
  plugin_stackoverflow_user: 1
  plugin_stackoverflow_sections: answers-top
  plugin_stackoverflow_limit: 2

```
<!--/examples-->
</file>

<file path="source/plugins/starlists/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üí´ Star lists</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays star lists.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><i>No tokens are required for this plugin</i></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Repositories from star lists</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.starlists.svg" alt=""></img></details>
      <details open><summary>Languages from star lists</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.starlists.languages.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_starlists</code></h4></td>
    <td rowspan="2"><p>Enable starlists plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.run.puppeteer.scrapping</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_starlists_limit</code></h4></td>
    <td rowspan="2"><p>Display limit (star lists)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 100)</i>
<br>
<b>default:</b> 2<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_starlists_limit_repositories</code></h4></td>
    <td rowspan="2"><p>Display limit (repositories per star list)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 100)</i>
<br>
<b>default:</b> 2<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_starlists_languages</code></h4></td>
    <td rowspan="2"><p>Star lists languages statistics</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_starlists_limit_languages</code></h4></td>
    <td rowspan="2"><p>Display limit (languages per star list)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 8<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_starlists_languages_ignored</code></h4></td>
    <td rowspan="2"><p>Ignored languages in star lists</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_starlists_languages_aliases</code></h4></td>
    <td rowspan="2"><p>Custom languages names in star lists</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_starlists_shuffle_repositories</code></h4></td>
    <td rowspan="2"><p>Shuffle data</p>
<p>Can be used to create varied outputs</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_starlists_ignored</code></h4></td>
    <td rowspan="2"><p>Skipped star lists</p>
<p>Case and emojis insensitive</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_starlists_only</code></h4></td>
    <td rowspan="2"><p>Showcased star lists</p>
<p>Case and emojis insensitive.</p>
<p>Equivalent to <a href="/source/plugins/starlists/README.md#plugin_starlists_ignored"><code>plugin_starlists_ignored</code></a> with all star lists except the ones listed in this option</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Featured star list
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.starlists.svg
  token: NOT_NEEDED
  base: ""
  plugin_starlists: yes
  plugin_starlists_limit_repositories: 2
  plugin_starlists_only: TC39

```
```yaml
name: Featured star list languages
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.starlists.languages.svg
  token: NOT_NEEDED
  base: ""
  plugin_starlists: yes
  plugin_starlists_languages: yes
  plugin_starlists_limit_languages: 8
  plugin_starlists_limit_repositories: 0
  plugin_starlists_only: Awesome

```
<!--/examples-->
</file>

<file path="source/plugins/stars/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üåü Recently starred repositories</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays recently starred repositories.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stars.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stars</code></h4></td>
    <td rowspan="2"><p>Enable stars plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stars_limit</code></h4></td>
    <td rowspan="2"><p>Display limit</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 100)</i>
<br>
<b>default:</b> 4<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Recently starred
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.stars.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_stars: yes
  plugin_stars_limit: 3

```
<!--/examples-->
</file>

<file path="source/plugins/support/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üí≠ GitHub Community Support</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays statistics from a <a href="https://github.community/">GitHub Support Community</a> account.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Deprecated</th><td><p>GitHub Support Community has been moved to <a href="https://github.blog/2022-07-26-launching-github-community-powered-by-github-discussions">GitHub Discussions</a>.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><i>No tokens are required for this plugin</i></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.support.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_support</code></h4></td>
    <td rowspan="2"><p>Enable support plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.run.puppeteer.scrapping</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: GitHub Community Support
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.support.svg
  token: NOT_NEEDED
  base: ""
  plugin_support: yes

```
<!--/examples-->
</file>

<file path="source/plugins/topics/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üìå Starred topics</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays <a href="https://github.com/stars?filter=topics">starred topics</a>.</p>
<p>Check out <a href="https://github.com/topics">GitHub topics</a> to search interesting topics.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/markdown/README.md"><code>üìí Markdown template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><i>No tokens are required for this plugin</i></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>With icons</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.topics.icons.svg" alt=""></img></details>
      <details open><summary>With labels</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.topics.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_topics</code></h4></td>
    <td rowspan="2"><p>Enable topics plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.run.puppeteer.scrapping</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_topics_mode</code></h4></td>
    <td rowspan="2"><p>Display mode</p>
<ul>
<li><code>labels</code>: display labels</li>
<li><code>icons</code>: display icons <em>(topics without icons will not be displayed)</em></li>
<li><code>starred</code>: alias for <code>labels</code></li>
<li><code>mastered</code>: alias for <code>icons</code></li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> starred<br>
<b>allowed values:</b><ul><li>labels</li><li>icons</li><li>starred</li><li>mastered</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_topics_sort</code></h4></td>
    <td rowspan="2"><p>Sorting method</p>
<ul>
<li><code>stars</code>: sort by most stars</li>
<li><code>activity</code>: sort by recent activity</li>
<li><code>starred</code>: sort by starred date</li>
<li><code>random</code>: sort randomly</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> stars<br>
<b>allowed values:</b><ul><li>stars</li><li>activity</li><li>starred</li><li>random</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_topics_limit</code></h4></td>
    <td rowspan="2"><p>Display limit</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•
‚â§ 20)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 15<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Labels
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.topics.svg
  token: NOT_NEEDED
  base: ""
  plugin_topics: yes
  plugin_topics_limit: 12

```
```yaml
name: Icons
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.topics.icons.svg
  token: NOT_NEEDED
  base: ""
  plugin_topics: yes
  plugin_topics_limit: 0
  plugin_topics_mode: icons

```
<!--/examples-->
</file>

<file path="source/plugins/traffic/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üßÆ Repositories traffic</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays the number of page views across affiliated repositories.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a> <a href="/source/templates/terminal/README.md"><code>üìô Terminal template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üîë repo</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.traffic.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_traffic</code></h4></td>
    <td rowspan="2"><p>Enable traffic plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_traffic_skipped</code></h4></td>
    <td rowspan="2"><p>Skipped repositories</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è© Inherits <code>repositories_skipped</code><br>
<b>type:</b> <code>array</code>
<i>(newline-separated)</i>
<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Repositories traffic
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.traffic.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: repositories
  plugin_traffic: yes

```
<!--/examples-->
</file>

<file path="source/plugins/wakatime/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>‚è∞ WakaTime</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays statistics from a <a href="https://wakatime.com">WakaTime</a> account.</p>
<p>It is also compatible with self-hosted instances from <a href="https://github.com/muety/wakapi">wakapi</a>.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://wakatime.com">WakaTime</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><code>üóùÔ∏è plugin_wakatime_token</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.wakatime.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_wakatime</code></h4></td>
    <td rowspan="2"><p>Enable wakatime plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_wakatime_token</code></h4></td>
    <td rowspan="2"><p>WakaTime API token</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üîê Token<br>
<b>type:</b> <code>token</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_wakatime_url</code></h4></td>
    <td rowspan="2"><p>WakaTime URL</p>
<p>Can be used to specify a <a href="https://github.com/muety/wakapi">wakapi</a> instance</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> https://wakatime.com<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_wakatime_user</code></h4></td>
    <td rowspan="2"><p>WakaTime username</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>string</code>
<br>
<b>default:</b> current<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_wakatime_sections</code></h4></td>
    <td rowspan="2"><p>Displayed sections</p>
<ul>
<li><code>time</code>: show total coding time and daily average</li>
<li><code>projects</code>: show most time spent project</li>
<li><code>projects-graphs</code>: show most time spent projects graphs</li>
<li><code>languages</code>: show most used language</li>
<li><code>languages-graphs</code>: show languages graphs</li>
<li><code>editors</code>: show most used code editor</li>
<li><code>editors-graphs</code>: show code editors graphs</li>
<li><code>os</code>: show most used operating system</li>
<li><code>os-graphs</code>: show operating systems graphs</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<br>
<b>default:</b> time, projects, projects-graphs, languages, languages-graphs, editors, os<br>
<b>allowed values:</b><ul><li>time</li><li>projects</li><li>projects-graphs</li><li>languages</li><li>languages-graphs</li><li>editors</li><li>editors-graphs</li><li>os</li><li>os-graphs</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_wakatime_days</code></h4></td>
    <td rowspan="2"><p>Time range</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> 7<br>
<b>allowed values:</b><ul><li>7</li><li>30</li><li>180</li><li>365</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_wakatime_limit</code></h4></td>
    <td rowspan="2"><p>Display limit (entries per graph)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 5<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_wakatime_languages_other</code></h4></td>
    <td rowspan="2"><p>Other languages</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_wakatime_languages_ignored</code></h4></td>
    <td rowspan="2"><p>Ignored languages</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_wakatime_repositories_visibility</code></h4></td>
    <td rowspan="2"><p>Repositories visibility</p>
<p>Can be used to toggle private activity visibility</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br>
<b>default:</b> all<br>
<b>allowed values:</b><ul><li>public</li><li>all</li></ul></td>
  </tr>
</table>
<!--/options-->

## üóùÔ∏è Obtaining a WakaTime token

Create a [WakaTime account](https://wakatime.com) and retrieve API key in [Account settings](https://wakatime.com/settings/account).

![WakaTime API token](/.github/readme/imgs/plugin_wakatime_token.png)

Then setup [WakaTime plugins](https://wakatime.com/plugins) to be ready to go!

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: WakaTime
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.wakatime.svg
  token: NOT_NEEDED
  base: ""
  plugin_wakatime: yes
  plugin_wakatime_sections: time, projects, projects-graphs, languages, languages-graphs, editors, os
  plugin_wakatime_token: ${{ secrets.WAKATIME_TOKEN }}

```
<!--/examples-->
</file>

<file path="source/plugins/README.md">
## üß© Plugins

Plugins provide additional content and lets you customize rendered metrics.

**üì¶ Maintained by core team**

* **Core plugins**
  * [üóÉÔ∏è Base content <sub>`base`</sub>](/source/plugins/base/README.md)
  * [üß± Core <sub>`core`</sub>](/source/plugins/core/README.md)
* **GitHub plugins**
  * [üèÜ Achievements <sub>`achievements`</sub>](/source/plugins/achievements/README.md)
  * [üì∞ Recent activity <sub>`activity`</sub>](/source/plugins/activity/README.md)
  * [üìÜ Commit calendar <sub>`calendar`</sub>](/source/plugins/calendar/README.md)
  * [‚ôê Random code snippet <sub>`code`</sub>](/source/plugins/code/README.md)
  * [üèÖ Repository contributors <sub>`contributors`</sub>](/source/plugins/contributors/README.md)
  * [üí¨ Discussions <sub>`discussions`</sub>](/source/plugins/discussions/README.md)
  * [üéüÔ∏è Follow-up of issues and pull requests <sub>`followup`</sub>](/source/plugins/followup/README.md)
  * [üé´ Gists <sub>`gists`</sub>](/source/plugins/gists/README.md)
  * [üí° Coding habits and activity <sub>`habits`</sub>](/source/plugins/habits/README.md)
  * [üôã Introduction <sub>`introduction`</sub>](/source/plugins/introduction/README.md)
  * [üìÖ Isometric commit calendar <sub>`isocalendar`</sub>](/source/plugins/isocalendar/README.md)
  * [üà∑Ô∏è Languages activity <sub>`languages`</sub>](/source/plugins/languages/README.md)
  * [üìú Repository licenses <sub>`licenses`</sub>](/source/plugins/licenses/README.md)
  * [üë®‚Äçüíª Lines of code changed <sub>`lines`</sub>](/source/plugins/lines/README.md)
  * [üé© Notable contributions <sub>`notable`</sub>](/source/plugins/notable/README.md)
  * [üßë‚Äçü§ù‚Äçüßë People <sub>`people`</sub>](/source/plugins/people/README.md)
  * [üóÇÔ∏è GitHub projects <sub>`projects`</sub>](/source/plugins/projects/README.md)
  * [üé≠ Comment reactions <sub>`reactions`</sub>](/source/plugins/reactions/README.md)
  * [üìì Featured repositories <sub>`repositories`</sub>](/source/plugins/repositories/README.md)
  * [üåá GitHub Skyline <sub>`skyline`</sub>](/source/plugins/skyline/README.md)
  * [üíï GitHub Sponsors <sub>`sponsors`</sub>](/source/plugins/sponsors/README.md)
  * [üíù GitHub Sponsorships <sub>`sponsorships`</sub>](/source/plugins/sponsorships/README.md)
  * [‚ú® Stargazers <sub>`stargazers`</sub>](/source/plugins/stargazers/README.md)
  * [üí´ Star lists <sub>`starlists`</sub>](/source/plugins/starlists/README.md)
  * [üåü Recently starred repositories <sub>`stars`</sub>](/source/plugins/stars/README.md)
  * [üí≠ GitHub Community Support <sub>`support`</sub>](/source/plugins/support/README.md) <sub>`‚ö†Ô∏è deprecated`</sub>
  * [üìå Starred topics <sub>`topics`</sub>](/source/plugins/topics/README.md)
  * [üßÆ Repositories traffic <sub>`traffic`</sub>](/source/plugins/traffic/README.md)
* **Social plugins**
  * [üå∏ Anilist watch list and reading list <sub>`anilist`</sub>](/source/plugins/anilist/README.md)
  * [üó≥Ô∏è Leetcode <sub>`leetcode`</sub>](/source/plugins/leetcode/README.md)
  * [üéº Music activity and suggestions <sub>`music`</sub>](/source/plugins/music/README.md)
  * [‚è±Ô∏è Google PageSpeed <sub>`pagespeed`</sub>](/source/plugins/pagespeed/README.md)
  * [‚úíÔ∏è Recent posts <sub>`posts`</sub>](/source/plugins/posts/README.md)
  * [üóº Rss feed <sub>`rss`</sub>](/source/plugins/rss/README.md)
  * [üó®Ô∏è Stack Overflow <sub>`stackoverflow`</sub>](/source/plugins/stackoverflow/README.md)
  * [üïπÔ∏è Steam <sub>`steam`</sub>](/source/plugins/steam/README.md)
  * [üê§ Latest tweets <sub>`tweets`</sub>](/source/plugins/tweets/README.md) <sub>`‚ö†Ô∏è deprecated`</sub>
  * [‚è∞ WakaTime <sub>`wakatime`</sub>](/source/plugins/wakatime/README.md)

**üé≤ Maintained by community**
* **[Community plugins](/source/plugins/community/README.md)**
  * [üß† 16personalities <sub>`16personalities`</sub>](/source/plugins/community/16personalities/README.md) by [@lowlighter](https://github.com/lowlighter)
  * [‚ôüÔ∏è Chess <sub>`chess`</sub>](/source/plugins/community/chess/README.md) by [@lowlighter](https://github.com/lowlighter)
  * [ü™ô Crypto <sub>`crypto`</sub>](/source/plugins/community/crypto/README.md) by [@dajneem23](https://github.com/dajneem23)
  * [ü•† Fortune <sub>`fortune`</sub>](/source/plugins/community/fortune/README.md) by [@lowlighter](https://github.com/lowlighter)
  * [üíâ Nightscout <sub>`nightscout`</sub>](/source/plugins/community/nightscout/README.md) by [@legoandmars](https://github.com/legoandmars)
  * [üí© PoopMap plugin <sub>`poopmap`</sub>](/source/plugins/community/poopmap/README.md) by [@matievisthekat](https://github.com/matievisthekat)
  * [üì∏ Website screenshot <sub>`screenshot`</sub>](/source/plugins/community/screenshot/README.md) by [@lowlighter](https://github.com/lowlighter)
  * [ü¶ë Splatoon <sub>`splatoon`</sub>](/source/plugins/community/splatoon/README.md) by [@lowlighter](https://github.com/lowlighter)
  * [üíπ Stock prices <sub>`stock`</sub>](/source/plugins/community/stock/README.md) by [@lowlighter](https://github.com/lowlighter)
</file>

<file path="tests/mocks/api/axios/get/pagespeed.mjs">
/**Mocked data */
export default function({faker, url, options, login = faker.internet.userName()}) {
  //Tested url
  const tested = url.match(/&url=(?<tested>.*?)(?:&|$)/)?.groups?.tested ?? faker.internet.url()
  //Pagespeed api
  if (/^https:..www.googleapis.com.pagespeedonline.v5.*$/.test(url)) {
    //Pagespeed result
    if (/v5.runPagespeed.*&key=MOCKED_TOKEN/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking pagespeed api result > ${url}`)
      return ({
        status: 200,
        data: {
          captchaResult: "CAPTCHA_NOT_NEEDED",
          id: tested,
          lighthouseResult: {
            requestedUrl: tested,
            finalUrl: tested,
            lighthouseVersion: "6.3.0",
            audits: {
              "final-screenshot": {
                id: "final-screenshot",
                title: "Final Screenshot",
                score: null,
                details: {
                  data: null,
                  type: "screenshot",
                  timestamp: Date.now(),
                },
              },
              metrics: {
                id: "metrics",
                title: "Metrics",
                score: null,
                details: {
                  items: [
                    {
                      observedFirstContentfulPaint: faker.number.int(500),
                      observedFirstVisualChangeTs: faker.date.recent(),
                      observedFirstContentfulPaintTs: faker.date.recent(),
                      firstContentfulPaint: faker.number.int(500),
                      observedDomContentLoaded: faker.number.int(500),
                      observedFirstMeaningfulPaint: faker.number.int(1000),
                      maxPotentialFID: faker.number.int(500),
                      observedLoad: faker.number.int(500),
                      firstMeaningfulPaint: faker.number.int(500),
                      observedCumulativeLayoutShift: faker.number.float({max: 1}),
                      observedSpeedIndex: faker.number.int(1000),
                      observedSpeedIndexTs: faker.date.recent(),
                      observedTimeOriginTs: faker.date.recent(),
                      observedLargestContentfulPaint: faker.number.int(1000),
                      cumulativeLayoutShift: faker.number.float({max: 1}),
                      observedFirstPaintTs: faker.date.recent(),
                      observedTraceEndTs: faker.date.recent(),
                      largestContentfulPaint: faker.number.int(2000),
                      observedTimeOrigin: faker.number.int(10),
                      speedIndex: faker.number.int(1000),
                      observedTraceEnd: faker.number.int(2000),
                      observedDomContentLoadedTs: faker.date.recent(),
                      observedFirstPaint: faker.number.int(500),
                      totalBlockingTime: faker.number.int(500),
                      observedLastVisualChangeTs: faker.date.recent(),
                      observedFirstVisualChange: faker.number.int(500),
                      observedLargestContentfulPaintTs: faker.date.recent(),
                      estimatedInputLatency: faker.number.int(100),
                      observedLoadTs: faker.date.recent(),
                      observedLastVisualChange: faker.number.int(1000),
                      firstCPUIdle: faker.number.int(1000),
                      interactive: faker.number.int(1000),
                      observedNavigationStartTs: faker.date.recent(),
                      observedNavigationStart: faker.number.int(10),
                      observedFirstMeaningfulPaintTs: faker.date.recent(),
                    },
                  ],
                },
              },
            },
            categories: {
              "best-practices": {
                id: "best-practices",
                title: "Best Practices",
                score: faker.number.float({max: 1}),
              },
              seo: {
                id: "seo",
                title: "SEO",
                score: faker.number.float({max: 1}),
              },
              accessibility: {
                id: "accessibility",
                title: "Accessibility",
                score: faker.number.float({max: 1}),
              },
              performance: {
                id: "performance",
                title: "Performance",
                score: faker.number.float({max: 1}),
              },
              pwa: {
                id: "pwa",
                title: "PWA",
                score: faker.number.int({max: 1}),
              },
            },
          },
          analysisUTCTimestamp: `${faker.date.recent()}`,
        },
      })
    }
  }
}
</file>

<file path="tests/mocks/api/axios/get/twitter.mjs">
/**Mocked data */
export default function({faker, url, options, login = faker.internet.userName()}) {
  //Twitter api
  if (/^https:..api.twitter.com.*$/.test(url)) {
    //Get user profile
    if ((/users.by.username/.test(url)) && (options?.headers?.Authorization === "Bearer MOCKED_TOKEN")) {
      console.debug(`metrics/compute/mocks > mocking twitter api result > ${url}`)
      const username = url.match(/username[/](?<username>.*?)[?]/)?.groups?.username ?? faker.internet.userName()
      return ({
        status: 200,
        data: {
          data: {
            profile_image_url: faker.image.urlLoremFlickr({category: "people"}),
            name: faker.person.fullName(),
            verified: faker.datatype.boolean(),
            id: faker.number.int(1000000).toString(),
            username,
          },
        },
      })
    }
    //Get recent tweets
    if ((/tweets.search.recent/.test(url)) && (options?.headers?.Authorization === "Bearer MOCKED_TOKEN")) {
      console.debug(`metrics/compute/mocks > mocking twitter api result > ${url}`)
      return ({
        status: 200,
        data: {
          data: [
            {
              id: faker.number.int(100000000000000).toString(),
              created_at: `${faker.date.recent()}`,
              entities: {
                mentions: [
                  {start: 22, end: 33, username: "lowlighter"},
                ],
              },
              text: "Checkout metrics from @lowlighter ! #GitHub",
            },
            {
              id: faker.number.int(100000000000000).toString(),
              created_at: `${faker.date.recent()}`,
              text: faker.lorem.paragraph(),
            },
          ],
          includes: {
            users: [
              {
                id: faker.number.int(100000000000000).toString(),
                name: "lowlighter",
                username: "lowlighter",
              },
            ],
          },
          meta: {
            newest_id: faker.number.int(100000000000000).toString(),
            oldest_id: faker.number.int(100000000000000).toString(),
            result_count: 2,
            next_token: "MOCKED_CURSOR",
          },
        },
      })
    }
  }
}
</file>

<file path="tests/mocks/api/axios/post/anilist.mjs">
/**Mocked data */
export default function({faker, url, body, login = faker.internet.userName()}) {
  if (/^https:..graphql.anilist.co.*$/.test(url)) {
    //Initialization and media generator
    const {query} = body
    const media = ({type}) => ({
      title: {romaji: faker.lorem.words(), english: faker.lorem.words(), native: faker.lorem.words()},
      description: faker.lorem.paragraphs(),
      type,
      status: faker.helpers.arrayElement(["FINISHED", "RELEASING", "NOT_YET_RELEASED", "CANCELLED", "HIATUS"]),
      episodes: 100 + faker.number.int(100),
      volumes: faker.number.int(100),
      chapters: 100 + faker.number.int(1000),
      averageScore: faker.number.int(100),
      countryOfOrigin: "JP",
      genres: new Array(6).fill(null).map(_ => faker.lorem.word()),
      coverImage: {medium: null},
      startDate: {year: faker.date.past({years: 20}).getFullYear()},
    })
    //User statistics query
    if (/^query Statistics /.test(query)) {
      console.debug("metrics/compute/mocks > mocking anilist api result > Statistics")
      return ({
        status: 200,
        data: {
          data: {
            User: {
              id: faker.number.int(100000),
              name: faker.internet.userName(),
              about: null,
              statistics: {
                anime: {
                  count: faker.number.int(1000),
                  minutesWatched: faker.number.int(100000),
                  episodesWatched: faker.number.int(10000),
                  genres: new Array(4).fill(null).map(_ => ({genre: faker.lorem.word()})),
                },
                manga: {
                  count: faker.number.int(1000),
                  chaptersRead: faker.number.int(100000),
                  volumesRead: faker.number.int(10000),
                  genres: new Array(4).fill(null).map(_ => ({genre: faker.lorem.word()})),
                },
              },
            },
          },
        },
      })
    }
    //Favorites characters
    if (/^query FavoritesCharacters /.test(query)) {
      console.debug("metrics/compute/mocks > mocking anilist api result > Favorites characters")
      return ({
        status: 200,
        data: {
          data: {
            User: {
              favourites: {
                characters: {
                  nodes: new Array(2 + faker.number.int(16)).fill(null).map(_ => ({
                    name: {full: faker.person.fullName(), native: faker.person.fullName()},
                    image: {medium: null},
                  })),
                  pageInfo: {currentPage: 1, hasNextPage: false},
                },
              },
            },
          },
        },
      })
    }
    //Favorites anime/manga query
    if (/^query Favorites /.test(query)) {
      console.debug("metrics/compute/mocks > mocking anilist api result > Favorites")
      const type = /anime[(]/.test(query) ? "ANIME" : /manga[(]/.test(query) ? "MANGA" : "OTHER"
      return ({
        status: 200,
        data: {
          data: {
            User: {
              favourites: {
                [type.toLocaleLowerCase()]: {
                  nodes: new Array(16).fill(null).map(_ => media({type})),
                  pageInfo: {currentPage: 1, hasNextPage: false},
                },
              },
            },
          },
        },
      })
    }
    //Medias query
    if (/^query Medias /.test(query)) {
      console.debug("metrics/compute/mocks > mocking anilist api result > Medias")
      const {type} = body.variables
      return ({
        status: 200,
        data: {
          data: {
            MediaListCollection: {
              lists: [
                {
                  name: {ANIME: "Watching", MANGA: "Reading", OTHER: "Completed"}[type],
                  isCustomList: false,
                  entries: new Array(16).fill(null).map(_ => ({
                    status: faker.helpers.arrayElement(["CURRENT", "PLANNING", "COMPLETED", "DROPPED", "PAUSED", "REPEATING"]),
                    progress: faker.number.int(100),
                    progressVolumes: null,
                    score: 0,
                    startedAt: {year: null, month: null, day: null},
                    completedAt: {year: null, month: null, day: null},
                    media: media({type}),
                  })),
                },
              ],
            },
          },
        },
      })
    }
  }
}
</file>

<file path="tests/mocks/api/axios/post/leetcode.mjs">
/**Mocked data */
export default function({faker, url, body, login = faker.internet.userName()}) {
  if (/^https:..leetcode.com.graphql.*$/.test(url)) {
    const {query} = body
    //Languages query
    if (/^query Languages /.test(query)) {
      console.debug("metrics/compute/mocks > mocking leetcode api result > Languages")
      return ({
        status: 200,
        data: {
          data: {
            matchedUser: {
              languageProblemCount: new Array(6).fill(null).map(_ => ({
                languageName: faker.hacker.noun(),
                problemsSolved: faker.number.int(200),
              })),
            },
          },
        },
      })
    }
    //Skills query
    if (/^query Skills /.test(query)) {
      console.debug("metrics/compute/mocks > mocking leetcode api result > Skills")
      return ({
        status: 200,
        data: {
          data: {
            matchedUser: {
              tagProblemCounts: {
                advanced: new Array(6).fill(null).map(_ => ({
                  tagName: faker.hacker.noun(),
                  tagSlug: faker.lorem.slug(),
                  problemsSolved: faker.number.int(200),
                })),
                intermediate: new Array(6).fill(null).map(_ => ({
                  tagName: faker.hacker.noun(),
                  tagSlug: faker.lorem.slug(),
                  problemsSolved: faker.number.int(200),
                })),
                fundamental: new Array(6).fill(null).map(_ => ({
                  tagName: faker.hacker.noun(),
                  tagSlug: faker.lorem.slug(),
                  problemsSolved: faker.number.int(200),
                })),
              },
            },
          },
        },
      })
    }
    //Problems query
    if (/^query Problems /.test(query)) {
      console.debug("metrics/compute/mocks > mocking leetcode api result > Problems")
      return ({
        status: 200,
        data: {
          data: {
            allQuestionsCount: [
              {difficulty: "All", count: 2402},
              {difficulty: "Easy", count: 592},
              {difficulty: "Medium", count: 1283},
              {difficulty: "Hard", count: 527},
            ],
            matchedUser: {
              problemsSolvedBeatsStats: [
                {difficulty: "Easy", percentage: faker.number.float({max: 100})},
                {difficulty: "Medium", percentage: faker.number.float({max: 100})},
                {difficulty: "Hard", percentage: faker.number.float({max: 100})},
              ],
              submitStatsGlobal: {
                acSubmissionNum: [
                  {difficulty: "All", count: faker.number.int(2402)},
                  {difficulty: "Easy", count: faker.number.int(592)},
                  {difficulty: "Medium", count: faker.number.int(1283)},
                  {difficulty: "Hard", count: faker.number.int(527)},
                ],
              },
            },
          },
        },
      })
    }
    //Recent query
    if (/^query Recent /.test(query)) {
      console.debug("metrics/compute/mocks > mocking leetcode api result > Recent")
      return ({
        status: 200,
        data: {
          data: {
            recentAcSubmissionList: new Array(6).fill(null).map(_ => ({
              id: `${faker.number.int(10000)}`,
              title: faker.lorem.sentence(),
              titleSlug: faker.lorem.slug(),
              timestamp: `${Math.round(faker.date.recent().getTime() / 1000)}`,
            })),
          },
        },
      })
    }
  }
}
</file>

<file path="tests/mocks/api/github/graphql/base.user.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > base/user")
  return ({
    user: {
      databaseId: faker.number.int(10000000),
      name: faker.person.fullName(),
      login,
      createdAt: `${faker.date.past({years: 10})}`,
      avatarUrl: faker.image.urlLoremFlickr({category: "people"}),
      websiteUrl: faker.internet.url(),
      twitterUsername: login,
    },
  })
}
</file>

<file path="tests/mocks/api/github/graphql/stargazers.default.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > stargazers/default")
  return /after: "MOCKED_CURSOR"/m.test(query)
    ? ({
      repository: {
        stargazers: {
          edges: [],
        },
      },
    })
    : ({
      repository: {
        stargazers: {
          edges: new Array(faker.number.int({min: 50, max: 100})).fill(null).map(() => ({
            starredAt: `${faker.date.recent({days: 30})}`,
            cursor: "MOCKED_CURSOR",
            node: {
              location: faker.location.city(),
            },
          })),
        },
      },
    })
}
</file>

<file path="tests/mocks/api/github/graphql/stars.default.mjs">
/**Mocked data */
export default function({faker, query, login = faker.internet.userName()}) {
  console.debug("metrics/compute/mocks > mocking graphql api result > stars/default")
  return ({
    user: {
      starredRepositories: {
        edges: [
          {
            starredAt: `${faker.date.recent({days: 14})}`,
            node: {
              description: "üìä An image generator with 20+ metrics about your GitHub account such as activity, community, repositories, coding habits, website performances, music played, starred topics, etc. that you can put on your profile or elsewhere !",
              forkCount: faker.number.int(100),
              isFork: false,
              issues: {
                totalCount: faker.number.int(100),
              },
              nameWithOwner: "lowlighter/metrics",
              openGraphImageUrl: "https://repository-images.githubusercontent.com/293860197/7fd72080-496d-11eb-8fe0-238b38a0746a",
              pullRequests: {
                totalCount: faker.number.int(100),
              },
              stargazerCount: faker.number.int(10000),
              licenseInfo: {
                nickname: null,
                name: "MIT License",
              },
              primaryLanguage: {
                color: "#f1e05a",
                name: "JavaScript",
              },
            },
          },
        ],
      },
    },
  })
}
</file>

<file path="tests/mocks/api/github/rest/activity/listEventsForAuthenticatedUser.mjs">
/**Mocked data */
export default async function({faker}, target, that, [{username: login, page, per_page}]) {
  console.debug("metrics/compute/mocks > mocking rest api result > rest.activity.listEventsForAuthenticatedUser")
  return ({
    status: 200,
    url: `https://api.github.com/users/${login}/events?per_page=${per_page}&page=${page}`,
    headers: {
      server: "GitHub.com",
      status: "200 OK",
      "x-oauth-scopes": "repo",
    },
    data: page < 1 ? [] : [
      {
        id: "10000000000",
        type: "CommitCommentEvent",
        actor: {
          login,
        },
        repo: {
          name: `${faker.lorem.word()}/${faker.lorem.word()}`,
        },
        payload: {
          comment: {
            user: {
              login,
            },
            path: faker.system.fileName(),
            commit_id: "MOCKED_SHA",
            body: faker.lorem.sentence(),
          },
        },
        created_at: faker.date.recent({days: 7}),
        public: true,
      },
      {
        id: "10000000001",
        type: "PullRequestReviewCommentEvent",
        actor: {
          login,
        },
        repo: {
          name: `${faker.lorem.word()}/${faker.lorem.word()}`,
        },
        payload: {
          action: "created",
          comment: {
            user: {
              login,
            },
            body: faker.lorem.paragraph(),
          },
          pull_request: {
            title: faker.lorem.sentence(),
            number: 1,
            user: {
              login: faker.internet.userName(),
            },
            body: "",
          },
        },
        created_at: faker.date.recent({days: 7}),
        public: true,
      },
      {
        id: "10000000002",
        type: "IssuesEvent",
        actor: {
          login,
        },
        repo: {
          name: `${faker.lorem.word()}/${faker.lorem.word()}`,
        },
        payload: {
          action: faker.helpers.arrayElement(["opened", "closed", "reopened"]),
          issue: {
            number: 2,
            title: faker.lorem.sentence(),
            user: {
              login,
            },
            body: faker.lorem.paragraph(),
            performed_via_github_app: null,
          },
        },
        created_at: faker.date.recent({days: 7}),
        public: true,
      },
      {
        id: "10000000003",
        type: "GollumEvent",
        actor: {
          login,
        },
        repo: {
          name: `${faker.lorem.word()}/${faker.lorem.word()}`,
        },
        payload: {
          pages: [
            {
              page_name: faker.lorem.sentence(),
              title: faker.lorem.sentence(),
              summary: null,
              action: "created",
              sha: "MOCKED_SHA",
            },
          ],
        },
        created_at: faker.date.recent({days: 7}),
        public: true,
      },
      {
        id: "10000000004",
        type: "IssueCommentEvent",
        actor: {
          login,
        },
        repo: {
          name: `${faker.lorem.word()}/${faker.lorem.word()}`,
        },
        payload: {
          action: "created",
          issue: {
            number: 3,
            title: faker.lorem.sentence(),
            user: {
              login,
            },
            labels: [
              {
                name: "lorem ipsum",
                color: "d876e3",
              },
            ],
            state: "open",
          },
          comment: {
            body: faker.lorem.paragraph(),
            performed_via_github_app: null,
          },
        },
        created_at: faker.date.recent({days: 7}),
        public: true,
      },
      {
        id: "10000000005",
        type: "ForkEvent",
        actor: {
          login,
        },
        repo: {
          name: `${faker.lorem.word()}/${faker.lorem.word()}`,
        },
        payload: {
          forkee: {
            name: faker.lorem.word(),
            full_name: `${faker.lorem.word()}/${faker.lorem.word()}`,
          },
        },
        created_at: faker.date.recent({days: 7}),
        public: true,
      },
      {
        id: "10000000006",
        type: "PullRequestReviewEvent",
        actor: {
          login,
        },
        repo: {
          name: `${faker.lorem.word()}/${faker.lorem.word()}`,
        },
        payload: {
          action: "created",
          review: {
            user: {
              login,
            },
            state: "approved",
          },
          pull_request: {
            state: "open",
            number: 4,
            locked: false,
            title: faker.lorem.sentence(),
            user: {
              login: faker.internet.userName(),
            },
          },
        },
        created_at: faker.date.recent({days: 7}),
        public: true,
      },
      {
        id: "10000000007",
        type: "ReleaseEvent",
        actor: {
          login,
        },
        repo: {
          name: `${faker.lorem.word()}/${faker.lorem.word()}`,
        },
        payload: {
          action: "published",
          release: {
            tag_name: `v${faker.number.int()}.${faker.number.int()}`,
            name: faker.lorem.words(4),
            draft: faker.datatype.boolean(),
            prerelease: faker.datatype.boolean(),
          },
        },
        created_at: faker.date.recent({days: 7}),
        public: true,
      },
      {
        id: "10000000008",
        type: "CreateEvent",
        actor: {
          login,
        },
        repo: {
          name: `${faker.lorem.word()}/${faker.lorem.word()}`,
        },
        payload: {
          ref: faker.lorem.slug(),
          ref_type: faker.helpers.arrayElement(["tag", "branch"]),
          master_branch: "master",
        },
        created_at: faker.date.recent({days: 7}),
        public: true,
      },
      {
        id: "100000000009",
        type: "WatchEvent",
        actor: {
          login,
        },
        repo: {
          name: "lowlighter/metrics",
        },
        payload: {action: "started"},
        created_at: faker.date.recent({days: 7}),
        public: true,
      },
      {
        id: "10000000010",
        type: "DeleteEvent",
        actor: {
          login,
        },
        repo: {
          name: `${faker.lorem.word()}/${faker.lorem.word()}`,
        },
        payload: {
          ref: faker.lorem.slug(),
          ref_type: faker.helpers.arrayElement(["tag", "branch"]),
        },
        created_at: faker.date.recent({days: 7}),
        public: true,
      },
      {
        id: "10000000011",
        type: "PushEvent",
        actor: {
          login,
        },
        repo: {
          name: `${faker.lorem.word()}/${faker.lorem.word()}`,
        },
        payload: {
          size: 1,
          ref: "refs/heads/master",
          commits: [
            {
              sha: "MOCKED_SHA",
              message: faker.lorem.sentence(),
              url: "https://api.github.com/repos/lowlighter/metrics/commits/MOCKED_SHA",
              author: {
                email: faker.internet.email(),
              },
            },
          ],
        },
        created_at: faker.date.recent({days: 7}),
        public: true,
      },
      {
        id: "10000000012",
        type: "PullRequestEvent",
        actor: {
          login,
        },
        repo: {
          name: `${faker.lorem.word()}/${faker.lorem.word()}`,
        },
        payload: {
          action: faker.helpers.arrayElement(["opened", "closed"]),
          number: 5,
          pull_request: {
            user: {
              login,
            },
            state: "open",
            title: faker.lorem.sentence(),
            additions: faker.number.int(1000),
            deletions: faker.number.int(1000),
            changed_files: faker.number.int(10),
          },
        },
        created_at: faker.date.recent({days: 7}),
        public: true,
      },
      {
        id: "10000000013",
        type: "MemberEvent",
        actor: {
          login,
        },
        repo: {
          name: `${faker.lorem.word()}/${faker.lorem.word()}`,
        },
        payload: {
          member: {
            login: faker.internet.userName(),
          },
          action: "added",
        },
        created_at: faker.date.recent({days: 7}),
        public: true,
      },
      {
        id: "10000000014",
        type: "PublicEvent",
        actor: {
          login,
        },
        repo: {
          name: `${faker.lorem.word()}/${faker.lorem.word()}`,
        },
        payload: {},
        created_at: faker.date.recent({days: 7}),
        public: true,
      },
    ],
  })
}
</file>

<file path="tests/mocks/api/github/rest/repos/listCommits.mjs">
/**Mocked data */
export default async function({faker}, target, that, [{page, per_page, owner, repo}]) {
  console.debug("metrics/compute/mocks > mocking rest api result > rest.repos.listCommits")
  return ({
    status: 200,
    url: `https://api.github.com/repos/${owner}/${repo}/commits?per_page=${per_page}&page=${page}`,
    headers: {
      server: "GitHub.com",
      status: "200 OK",
      "x-oauth-scopes": "repo",
    },
    data: page < 2
      ? new Array(per_page).fill(null).map(() => ({
        sha: "MOCKED_SHA",
        get author() {
          return this.commit.author
        },
        commit: {
          message: faker.lorem.sentence(),
          author: {
            name: owner,
            login: faker.internet.userName(),
            avatar_url: null,
            date: `${faker.date.recent({days: 14})}`,
          },
          committer: {
            name: owner,
            login: faker.internet.userName(),
            avatar_url: null,
            date: `${faker.date.recent({days: 14})}`,
          },
        },
      }))
      : [],
  })
}
</file>

<file path="tests/mocks/api/github/rest/request.mjs">
/**Mocked data */
export default async function({faker}, target, that, args) {
  //Arguments
  const [url] = args
  //Head request
  if (/^HEAD .$/.test(url)) {
    console.debug("metrics/compute/mocks > mocking rest api result > rest.request HEAD")
    return ({
      status: 200,
      url: "https://api.github.com/",
      headers: {
        server: "GitHub.com",
        status: "200 OK",
        "x-oauth-scopes": "repo",
      },
      data: undefined,
    })
  }
  //Commit content
  if (/^https:..api.github.com.repos.lowlighter.metrics.commits.MOCKED_SHA/.test(url)) {
    console.debug(`metrics/compute/mocks > mocking rest api result > rest.request ${url}`)
    return ({
      status: 200,
      url: "https://api.github.com/repos/lowlighter/metrics/commits/MOCKED_SHA",
      data: {
        sha: "MOCKED_SHA",
        commit: {
          author: {
            name: faker.internet.userName(),
            email: faker.internet.email(),
            date: `${faker.date.recent({days: 7})}`,
          },
          committer: {
            name: faker.internet.userName(),
            email: faker.internet.email(),
            date: `${faker.date.recent({days: 7})}`,
          },
          url: "https://api.github.com/repos/lowlighter/metrics/commits/MOCKED_SHA",
        },
        author: {
          login: faker.internet.userName(),
          id: faker.number.int(100000000),
        },
        committer: {
          login: faker.internet.userName(),
          id: faker.number.int(100000000),
        },
        files: [
          {
            sha: "MOCKED_SHA",
            filename: faker.system.fileName(),
            patch: '@@ -0,0 +1,5 @@\n+//Imports\n+  import app from "./src/app.mjs"\n+\n+//Start app\n+  await app()\n\\ No newline at end of file',
          },
        ],
        parents: [],
      },
    })
  }

  return target(...args)
}
</file>

<file path="Dockerfile">
# Base image
FROM node:20-bookworm-slim

# Copy repository
COPY . /metrics
WORKDIR /metrics

# Setup
RUN chmod +x /metrics/source/app/action/index.mjs \
  # Install latest chrome dev package, fonts to support major charsets and skip chromium download on puppeteer install
  # Based on https://github.com/GoogleChrome/puppeteer/blob/master/docs/troubleshooting.md#running-puppeteer-in-docker
  && apt-get update \
  && apt-get install -y wget gnupg ca-certificates libgconf-2-4 \
  && wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add - \
  && sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list' \
  && apt-get update \
  && apt-get install -y google-chrome-stable fonts-ipafont-gothic fonts-wqy-zenhei fonts-thai-tlwg fonts-kacst fonts-freefont-ttf libxss1 libx11-xcb1 libxtst6 lsb-release --no-install-recommends \
  # Install deno for miscellaneous scripts
  && apt-get install -y curl unzip xz-utils \
  && curl -fsSL https://deno.land/x/install/install.sh | DENO_INSTALL=/usr/local sh \
  # Install ruby to support github licensed gem
  && apt-get install -y ruby-full git g++ cmake pkg-config libssl-dev \
  && gem install licensed \
  # Install python for node-gyp
  && apt-get install -y python3 \
  # Clean apt/lists
  && rm -rf /var/lib/apt/lists/* \
  # Install node modules and rebuild indexes
  && npm ci \
  && npm run build

# Environment variables
ENV PUPPETEER_SKIP_CHROMIUM_DOWNLOAD true
ENV PUPPETEER_BROWSER_PATH "google-chrome-stable"

# Execute GitHub action
ENTRYPOINT node /metrics/source/app/action/index.mjs
</file>

<file path="source/app/web/instance.mjs">
//Imports
import octokit from "@octokit/graphql"
import OctokitRest from "@octokit/rest"
import axios from "axios"
import compression from "compression"
import crypto from "crypto"
import express from "express"
import ratelimit from "express-rate-limit"
import cache from "memory-cache"
import url from "url"
import util from "util"
import mocks from "../../../tests/mocks/index.mjs"
import metrics from "../metrics/index.mjs"
import presets from "../metrics/presets.mjs"
import setup from "../metrics/setup.mjs"

/**App */
export default async function({sandbox = false} = {}) {
  //Load configuration settings
  const {conf, Plugins, Templates} = await setup({sandbox})
  //Sandbox mode
  if (sandbox) {
    console.debug("metrics/app > sandbox mode is specified, enabling advanced features")
    Object.assign(conf.settings, {sandbox: true, optimize: true, cached: 0, "plugins.default": true, extras: {default: true}})
  }
  const {token, maxusers = 0, restricted = [], debug = false, cached = 30 * 60 * 1000, port = 3000, ratelimiter = null, plugins = null} = conf.settings
  const mock = sandbox || conf.settings.mocked

  //Process mocking and default plugin state
  for (const plugin of Object.keys(Plugins).filter(x => !["base", "core"].includes(x))) {
    //Initialization
    const {settings} = conf
    if (!settings.plugins[plugin])
      settings.plugins[plugin] = {}
    //Auto-enable plugin if needed
    if (conf.settings["plugins.default"])
      settings.plugins[plugin].enabled = settings.plugins[plugin].enabled ?? (console.debug(`metrics/app > auto-enabling ${plugin}`), true)
    //Mock plugins tokens if they're undefined
    if (mock) {
      const tokens = Object.entries(conf.metadata.plugins[plugin].inputs).filter(([key, value]) => (!/^plugin_/.test(key)) && (value.type === "token")).map(([key]) => key)
      for (const token of tokens) {
        if ((!settings.plugins[plugin][token]) || (mock === "force")) {
          console.debug(`metrics/app > using mocked token for ${plugin}.${token}`)
          settings.plugins[plugin][token] = "MOCKED_TOKEN"
        }
      }
    }
  }
  if (((mock) && (!conf.settings.token)) || (mock === "force")) {
    console.debug("metrics/app > using mocked token")
    conf.settings.token = "MOCKED_TOKEN"
  }
  if (debug)
    console.debug(util.inspect(conf.settings, {depth: Infinity, maxStringLength: 256}))

  //Load octokits
  const api = {graphql: octokit.graphql.defaults({headers: {authorization: `token ${token}`}, baseUrl: conf.settings.api?.graphql ?? undefined}), rest: new OctokitRest.Octokit({auth: token, baseUrl: conf.settings.api?.rest ?? undefined})}
  //Apply mocking if needed
  if (mock)
    Object.assign(api, await mocks(api))
  //Custom user octokits sessions
  const authenticated = new Map()
  const uapi = session => {
    if (!/^[a-f0-9]+$/i.test(`${session}`))
      return null
    if (authenticated.has(session)) {
      const {login, token} = authenticated.get(session)
      console.debug(`metrics/app/session/${login} > authenticated with session ${session.substring(0, 6)}, using custom octokit`)
      return {login, graphql: octokit.graphql.defaults({headers: {authorization: `token ${token}`}}), rest: new OctokitRest.Octokit({auth: token})}
    }
    else if (session) {
      console.debug(`metrics/app/session > unknown session ${session.substring(0, 6)}, using default octokit`)
    }
    return null
  }

  //Setup server
  const app = express()
  app.use(compression())
  const middlewares = []
  //Rate limiter middleware
  if (ratelimiter) {
    app.set("trust proxy", 1)
    const disabled = ratelimiter.max === 0
    if (disabled)
      delete ratelimiter.max
    middlewares.push(ratelimit({
      skip(req, _res) {
        return (disabled) || (!!cache.get(req.params.login))
      },
      message: "Too many requests: retry later",
      headers: true,
      ...ratelimiter,
    }))
  }
  //Cache headers middleware
  middlewares.push((req, res, next) => {
    const maxage = Math.round(Number(req.query.cache))
    if ((cached) || (maxage > 0))
      res.header("Cache-Control", `public, max-age=${Math.round((maxage > 0 ? maxage : cached) / 1000)}`)
    else
      res.header("Cache-Control", "no-store, no-cache")
    next()
  })

  //Base routes
  const limiter = ratelimit({max: debug ? Number.MAX_SAFE_INTEGER : 60, windowMs: 60 * 1000, headers: false})
  const metadata = Object.fromEntries(
    Object.entries(conf.metadata.plugins)
      .map(([key, value]) => [key, Object.fromEntries(Object.entries(value).filter(([key]) => ["name", "icon", "category", "web", "supports", "scopes", "deprecated"].includes(key)))])
      .map(([key, value]) => [key, key === "core" ? {...value, web: Object.fromEntries(Object.entries(value.web).filter(([key]) => /^config[.]/.test(key)).map(([key, value]) => [key.replace(/^config[.]/, ""), value]))} : value]),
  )
  const enabled = Object.entries(metadata).filter(([_name, {category}]) => category !== "core").map(([name]) => ({name, category: metadata[name]?.category ?? "community", deprecated: metadata[name]?.deprecated ?? false, enabled: plugins[name]?.enabled ?? false}))
  const templates = Object.entries(Templates).map(([name]) => ({name, enabled: (conf.settings.templates.enabled.length ? conf.settings.templates.enabled.includes(name) : true) ?? false}))
  const actions = {flush: new Map()}
  const requests = {rest: {limit: 0, used: 0, remaining: 0, reset: NaN}, graphql: {limit: 0, used: 0, remaining: 0, reset: NaN}, search: {limit: 0, used: 0, remaining: 0, reset: NaN}}
  let _requests_refresh = false
  if (!conf.settings.notoken) {
    const refresh = async () => {
      try {
        const {resources} = (await api.rest.rateLimit.get()).data
        Object.assign(requests, {rest: resources.core, graphql: resources.graphql, search: resources.search})
      }
      catch {
        console.debug("metrics/app > failed to update remaining requests")
      }
    }
    await refresh()
    setInterval(refresh, 15 * 60 * 1000)
    setInterval(() => {
      if (_requests_refresh)
        refresh()
      _requests_refresh = false
    }, 15 * 1000)
  }
  //Web
  app.get("/", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/index.html`))
  app.get("/index.html", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/index.html`))
  app.get("/favicon.ico", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/favicon.png`))
  app.get("/.favicon.png", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/favicon.png`))
  app.get("/.opengraph.png", limiter, (req, res) => conf.settings.web?.opengraph ? res.redirect(conf.settings.web?.opengraph) : res.sendFile(`${conf.paths.statics}/opengraph.png`))
  //Plugins and templates
  app.get("/.plugins", limiter, (req, res) => res.status(200).json(enabled))
  app.get("/.plugins.base", limiter, (req, res) => res.status(200).json(conf.settings.plugins.base.parts))
  app.get("/.plugins.metadata", limiter, (req, res) => res.status(200).json(metadata))
  app.get("/.templates", limiter, (req, res) => res.status(200).json(templates))
  app.get("/.templates/:template", limiter, (req, res) => req.params.template in conf.templates ? res.status(200).json(conf.templates[req.params.template]) : res.sendStatus(404))
  for (const template in conf.templates)
    app.use(`/.templates/${template}/partials`, express.static(`${conf.paths.templates}/${template}/partials`))
  //Modes and extras
  app.get("/.modes", limiter, (req, res) => res.status(200).json(conf.settings.modes))
  app.get("/.extras", limiter, async (req, res) => {
    if ((authenticated.has(req.headers["x-metrics-session"])) && (conf.settings.extras?.logged)) {
      if (conf.settings.extras?.features !== true)
        return res.status(200).json([...conf.settings.extras.features, ...conf.settings.extras.logged])
    }
    res.status(200).json(conf.settings.extras?.features ?? conf.settings?.extras?.default ?? false)
  })
  app.get("/.extras.logged", limiter, async (req, res) => res.status(200).json(conf.settings.extras?.logged ?? []))
  //Styles
  app.get("/.css/style.css", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/style.css`))
  app.get("/.css/style.vars.css", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/style.vars.css`))
  app.get("/.css/style.prism.css", limiter, (req, res) => res.sendFile(`${conf.paths.node_modules}/prismjs/themes/prism-tomorrow.css`))
  //Scripts
  app.get("/.js/app.js", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/app.js`))
  app.get("/.js/ejs.min.js", limiter, (req, res) => res.sendFile(`${conf.paths.node_modules}/ejs/ejs.min.js`))
  app.get("/.js/faker.min.js", limiter, (req, res) => res.set({"Content-Type": "text/javascript"}).send("import {faker} from '/.js/faker/index.mjs';globalThis.faker=faker;globalThis.placeholder.init(globalThis)"))
  app.use("/.js/faker", express.static(`${conf.paths.node_modules}/@faker-js/faker/dist/esm`))
  app.get("/.js/axios.min.js", limiter, (req, res) => res.sendFile(`${conf.paths.node_modules}/axios/dist/axios.min.js`))
  app.get("/.js/axios.min.js.map", limiter, (req, res) => res.sendFile(`${conf.paths.node_modules}/axios/dist/axios.min.js.map`))
  app.get("/.js/vue.min.js", limiter, (req, res) => res.sendFile(`${conf.paths.node_modules}/vue/dist/vue.min.js`))
  app.get("/.js/vue.prism.min.js", limiter, (req, res) => res.sendFile(`${conf.paths.node_modules}/vue-prism-component/dist/vue-prism-component.min.js`))
  app.get("/.js/vue-prism-component.min.js.map", limiter, (req, res) => res.sendFile(`${conf.paths.node_modules}/vue-prism-component/dist/vue-prism-component.min.js.map`))
  app.get("/.js/prism.min.js", limiter, (req, res) => res.sendFile(`${conf.paths.node_modules}/prismjs/prism.js`))
  app.get("/.js/prism.yaml.min.js", limiter, (req, res) => res.sendFile(`${conf.paths.node_modules}/prismjs/components/prism-yaml.min.js`))
  app.get("/.js/prism.markdown.min.js", limiter, (req, res) => res.sendFile(`${conf.paths.node_modules}/prismjs/components/prism-markdown.min.js`))
  app.get("/.js/clipboard.min.js", limiter, (req, res) => res.sendFile(`${conf.paths.node_modules}/clipboard/dist/clipboard.min.js`))
  //Meta
  app.get("/.version", limiter, (req, res) => res.status(200).send(conf.package.version))
  app.get("/.requests", limiter, async (req, res) => {
    try {
      const session = req.headers["x-metrics-session"]
      const custom = uapi(session)
      if (custom) {
        try {
          const {data: {resources}} = await custom.rest.rateLimit.get()
          if (resources)
            return res.status(200).json({rest: resources.core, graphql: resources.graphql, search: resources.search, login: custom.login})
        }
        catch (error) {
          if (error.status === 401) {
            console.debug(`metrics/app/oauth > session ${session.substring(0, 6)} is not valid anymore, removing it from cache`)
            authenticated.delete(session)
          }
          throw error
        }
      }
    }
    catch {} //eslint-disable-line no-empty
    return res.status(200).json(requests)
  })
  app.get("/.hosted", limiter, (req, res) => res.status(200).json(conf.settings.hosted || null))
  //Cache
  app.get("/.uncache", limiter, (req, res) => {
    const {token, user} = req.query
    if (token) {
      if (actions.flush.has(token)) {
        console.debug(`metrics/app/${actions.flush.get(token)} > flushed cache`)
        cache.del(actions.flush.get(token))
        return res.sendStatus(200)
      }
      return res.sendStatus(400)
    }
    {
      const token = `${Math.random().toString(16).replace("0.", "")}${Math.random().toString(16).replace("0.", "")}`
      actions.flush.set(token, user)
      return res.json({token})
    }
  })

  //OAuth
  if (conf.settings.oauth) {
    console.debug("metrics/app/oauth > enabled")
    const states = new Map()
    app.get("/.oauth/", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/oauth/index.html`))
    app.get("/.oauth/index.html", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/oauth/index.html`))
    app.get("/.oauth/script.js", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/oauth/script.js`))
    app.get("/.oauth/authenticate", (req, res) => {
      //Create a state to protect against cross-site request forgery attacks
      const state = crypto.randomBytes(64).toString("hex")
      const scopes = new url.URLSearchParams(req.query).get("scopes")
      const from = new url.URLSearchParams(req.query).get("scopes")
      states.set(state, {from, scopes})
      console.debug(`metrics/app/oauth > request ${state}`)
      //OAuth through GitHub
      return res.redirect(`https://github.com/login/oauth/authorize?${new url.URLSearchParams({
        client_id: conf.settings.oauth.id,
        state,
        redirect_uri: `${conf.settings.oauth.url}/.oauth/authorize`,
        allow_signup: false,
        scope: scopes,
      })}`)
    })
    app.get("/.oauth/authorize", async (req, res) => {
      //Check state
      const {code, state} = req.query
      if ((!state) || (!states.has(state))) {
        console.debug("metrics/app/oauth > 400 (invalid state)")
        return res.status(400).send("Bad request: invalid state")
      }
      //OAuth
      try {
        //Authorize user
        console.debug("metrics/app/oauth > authorization")
        const {data} = await axios.post(
          "https://github.com/login/oauth/access_token",
          `${new url.URLSearchParams({
            client_id: conf.settings.oauth.id,
            client_secret: conf.settings.oauth.secret,
            code,
          })}`,
        )
        const token = new url.URLSearchParams(data).get("access_token")
        //Validate user
        const {data: {login}} = await axios.get("https://api.github.com/user", {headers: {Authorization: `token ${token}`}})
        console.debug(`metrics/app/oauth > authorization success for ${login}`)
        const session = crypto.randomBytes(128).toString("hex")
        authenticated.set(session, {login, token})
        console.debug(`metrics/app/oauth > created session ${session.substring(0, 6)}`)
        //Redirect user back
        const {from} = states.get(state)
        return res.redirect(`/.oauth/redirect?${new url.URLSearchParams({to: from, session})}`)
      }
      catch {
        console.debug("metrics/app/oauth > authorization failed")
        return res.status(401).send("Unauthorized: oauth failed")
      }
      finally {
        states.delete(state)
      }
    })
    app.get("/.oauth/revoke/:session", limiter, async (req, res) => {
      const session = req.params.session?.replace(/[\n\r]/g, "")
      if (authenticated.has(session)) {
        const {token} = authenticated.get(session)
        try {
          await axios.delete(`https://api.github.com/applications/${conf.settings.oauth.id}/grant`, {auth: {username: conf.settings.oauth.id, password: conf.settings.oauth.secret}, headers: {Accept: "application/vnd.github+json"}, data: {access_token: token}})
          authenticated.delete(session)
          console.debug(`metrics/app/oauth > deleted session ${session.substring(0, 6)}`)
          return res.redirect("/.oauth")
        }
        catch {} //eslint-disable-line no-empty
      }
      return res.status(400).send("Bad request: invalid session")
    })
    app.get("/.oauth/redirect", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/oauth/redirect.html`))
    app.get("/.oauth/enabled", limiter, (req, res) => res.json(true))
  }
  else {
    app.get("/.oauth/enabled", limiter, (req, res) => res.json(false))
  }

  //Pending requests
  const pending = new Map()

  //Metrics insights
  if (conf.settings.modes.includes("insights")) {
    console.debug("metrics/app > setup insights mode")
    //Legacy routes
    app.get("/about/*", (req, res) => res.redirect(req.path.replace("/about/", "/insights/")))
    //Static routes
    app.get("/insights/", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/insights/index.html`))
    app.get("/insights/index.html", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/insights/index.html`))
    app.use("/insights/.statics/", express.static(`${conf.paths.statics}/insights`))
    //App routes
    app.get("/insights/:login", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/insights/index.html`))
    app.get("/insights/query/:login/:plugin/", async (req, res) => {
      //Check username
      const login = req.params.login?.replace(/[\n\r]/g, "")
      if (!/^[-\w]+$/i.test(login)) {
        console.debug(`metrics/app/${login}/insights > 400 (invalid username)`)
        return res.status(400).send("Bad request: username seems invalid")
      }
      //Check plugin
      const plugin = req.params.plugin?.replace(/[\n\r]/g, "")
      if (!/^\w+$/i.test(plugin)) {
        console.debug(`metrics/app/${login}/insights > 400 (invalid plugin name)`)
        return res.status(400).send("Bad request: plugin name seems invalid")
      }
      if (cache.get(`insights.${login}.${plugin}`))
        return res.send(cache.get(`insights.${login}.${plugin}`))
      return res.status(204).send("No content: no data fetched yet")
    })
    app.get("/insights/query/:login/", ...middlewares, async (req, res) => {
      //Check username
      const login = req.params.login?.replace(/[\n\r]/g, "")
      if (!/^[-\w]+$/i.test(login)) {
        console.debug(`metrics/app/${login}/insights > 400 (invalid username)`)
        return res.status(400).send("Bad request: username seems invalid")
      }
      //Compute metrics
      let solve = null
      try {
        //Prevent multiples requests
        if ((!debug) && (!mock) && (pending.has(`insights.${login}`))) {
          console.debug(`metrics/app/${login}/insights > awaiting pending request`)
          await pending.get(`insights.${login}`)
        }
        else {
          pending.set(`insights.${login}`, new Promise(_solve => solve = _solve))
        }
        //Read cached data if possible
        if ((!debug) && (cached) && (cache.get(`insights.${login}`))) {
          console.debug(`metrics/app/${login}/insights > using cached results`)
          return res.send(cache.get(`insights.${login}`))
        }
        //Compute metrics
        console.debug(`metrics/app/${login}/insights > compute insights`)
        const callbacks = {
          async plugin(login, plugin, success, result) {
            console.debug(`metrics/app/${login}/insights/plugins > ${plugin} > ${success ? "success" : "failure"}`)
            cache.put(`insights.${login}.${plugin}`, result)
          },
        }
        ;(async () => {
          try {
            const json = await metrics.insights({login}, {...api, ...uapi(req.headers["x-metrics-session"]), conf, callbacks}, {Plugins, Templates})
            //Cache
            cache.put(`insights.${login}`, json)
            if ((!debug) && (cached)) {
              const maxage = Math.round(Number(req.query.cache))
              cache.put(`insights.${login}`, json, maxage > 0 ? maxage : cached)
            }
          }
          catch (error) {
            console.error(`metrics/app/${login}/insights > error > ${error}`)
          }
        })()
        console.debug(`metrics/app/${login}/insights > accepted request`)
        return res.status(202).json({processing: true, plugins: Object.keys(metrics.insights.plugins)})
      }
      //Internal error
      catch (error) {
        //Not found user
        if ((error instanceof Error) && (/^user not found$/.test(error.message))) {
          console.debug(`metrics/app/${login} > 404 (user/organization not found)`)
          return res.status(404).send("Not found: unknown user or organization")
        }
        //GitHub failed request
        if ((error instanceof Error) && (/this may be the result of a timeout, or it could be a GitHub bug/i.test(error.errors?.[0]?.message))) {
          console.debug(`metrics/app/${login} > 502 (bad gateway from GitHub)`)
          const request = encodeURIComponent(error.errors[0].message.match(/`(?<request>[\w:]+)`/)?.groups?.request ?? "").replace(/%3A/g, ":")
          return res.status(500).send(`Internal Server Error: failed to execute request ${request} (this may be the result of a timeout, or it could be a GitHub bug)`)
        }
        //General error
        console.error(error)
        return res.status(500).send("Internal Server Error: failed to process metrics correctly")
      }
      finally {
        solve?.()
        _requests_refresh = true
      }
    })
  }
  else {
    app.get("/about/*", (req, res) => res.redirect(req.path.replace("/about/", "/insights/")))
    app.get("/insights/*", (req, res) => res.status(405).send("Method not allowed: this endpoint is not available"))
  }

  //Metrics embed
  if (conf.settings.modes.includes("embed")) {
    console.debug("metrics/app > setup embed mode")
    //Static routes
    app.get("/embed/", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/embed/index.html`))
    app.get("/embed/index.html", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/embed/index.html`))
    app.use("/.placeholders", express.static(`${conf.paths.statics}/embed/placeholders`))
    app.get("/.js/embed/app.js", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/embed/app.js`))
    app.get("/.js/embed/app.placeholder.js", limiter, (req, res) => res.sendFile(`${conf.paths.statics}/embed/app.placeholder.js`))
    //App routes
    app.get("/:login/:repository?", ...middlewares, async (req, res, next) => {
      //Request params
      const login = req.params.login?.replace(/[\n\r]/g, "")
      const repository = req.params.repository?.replace(/[\n\r]/g, "")
      let solve = null
      //Check username
      if ((login.startsWith(".")) || (login.includes("/")))
        return next()
      if (!/^[-\w]+$/i.test(login)) {
        console.debug(`metrics/app/${login} > 400 (invalid username)`)
        return res.status(400).send("Bad request: username seems invalid")
      }
      //Allowed list check
      if ((restricted.length) && (!restricted.includes(login))) {
        console.debug(`metrics/app/${login} > 403 (not in allowed users)`)
        return res.status(403).send("Forbidden: username not in allowed list")
      }
      //Prevent multiples requests
      if ((!debug) && (!mock) && (pending.has(login))) {
        console.debug(`metrics/app/${login} > awaiting pending request`)
        await pending.get(login)
      }
      else {
        pending.set(login, new Promise(_solve => solve = _solve))
      }

      //Read cached data if possible
      if ((!debug) && (cached) && (cache.get(login))) {
        console.debug(`metrics/app/${login} > using cached image`)
        const {rendered, mime} = cache.get(login)
        res.header("Content-Type", mime)
        return res.send(rendered)
      }
      //Maximum simultaneous users
      if ((maxusers) && (cache.size() + 1 > maxusers)) {
        console.debug(`metrics/app/${login} > 503 (maximum users reached)`)
        return res.status(503).send("Service Unavailable: maximum number of users reached, only cached metrics are available")
      }
      //Repository alias
      if (repository) {
        console.debug(`metrics/app/${login} > compute repository metrics`)
        if (!req.query.template)
          req.query.template = "repository"
        req.query.repo = repository
      }

      //Compute rendering
      try {
        //Prepare settings
        const q = req.query
        console.debug(`metrics/app/${login} > ${util.inspect(q, {depth: Infinity, maxStringLength: 256})}`)
        const octokit = {...api, ...uapi(req.headers["x-metrics-session"])}
        let uconf = conf
        if ((octokit.login) && (conf.settings.extras?.logged) && (uconf.settings.extras?.features !== true)) {
          console.debug(`metrics/app/${login} > session is authenticated, adding additional permissions ${conf.settings.extras.logged}`)
          uconf = {...conf, settings: {...conf.settings, extras: {...conf.settings.extras}}}
          uconf.settings.extras.features = uconf.settings.extras.features ?? []
          uconf.settings.extras.features.push(...conf.settings.extras.logged)
        }
        //Preset
        if ((q["config.presets"]) && ((uconf.settings.extras?.features?.includes("metrics.setup.community.presets")) || (uconf.settings.extras?.features === true) || (uconf.settings.extras?.default))) {
          console.debug(`metrics/app/${login} > presets have been specified, loading them`)
          Object.assign(q, await presets(q["config.presets"]))
        }
        //Render
        const convert = uconf.settings.outputs.includes(q["config.output"]) ? q["config.output"] : uconf.settings.outputs[0]
        const {rendered, mime} = await metrics({login, q}, {
          ...octokit,
          plugins,
          conf: uconf,
          die: q["plugins.errors.fatal"] ?? false,
          verify: q.verify ?? false,
          convert: convert !== "auto" ? convert : null,
        }, {Plugins, Templates})
        //Cache
        if ((!debug) && (cached)) {
          const maxage = Math.round(Number(req.query.cache))
          cache.put(login, {rendered, mime}, maxage > 0 ? maxage : cached)
        }
        //Send response
        res.header("Content-Type", mime)
        return res.send(rendered)
      }
      //Internal error
      catch (error) {
        //Not found user
        if ((error instanceof Error) && (/^user not found$/.test(error.message))) {
          console.debug(`metrics/app/${login} > 404 (user/organization not found)`)
          return res.status(404).send("Not found: unknown user or organization")
        }
        //Invalid template
        if ((error instanceof Error) && (/^unsupported template$/.test(error.message))) {
          console.debug(`metrics/app/${login} > 400 (bad request)`)
          return res.status(400).send("Bad request: unsupported template")
        }
        //Unsupported output format or account type
        if ((error instanceof Error) && (/^not supported for: [\s\S]*$/.test(error.message))) {
          console.debug(`metrics/app/${login} > 406 (Not Acceptable)`)
          return res.status(406).send("Not Acceptable: unsupported output format or account type for specified parameters")
        }
        //GitHub failed request
        if ((error instanceof Error) && (/this may be the result of a timeout, or it could be a GitHub bug/i.test(error.errors?.[0]?.message))) {
          console.debug(`metrics/app/${login} > 502 (bad gateway from GitHub)`)
          const request = encodeURIComponent(error.errors[0].message.match(/`(?<request>[\w:]+)`/)?.groups?.request ?? "").replace(/%3A/g, ":")
          return res.status(500).send(`Internal Server Error: failed to execute request ${request} (this may be the result of a timeout, or it could be a GitHub bug)`)
        }
        //General error
        console.error(error)
        return res.status(500).send("Internal Server Error: failed to process metrics correctly")
      }
      finally {
        //After rendering
        solve?.()
        _requests_refresh = true
      }
    })
  }
  else {
    app.get("/embed/*", (req, res) => res.status(405).send("Method not allowed: this endpoint is not available"))
  }

  //Control endpoints
  if (conf.settings.control?.token) {
    const middleware = (req, res, next) => {
      console.debug(`metrics/app/control > ${req.url.replace(/[\n\r]/g, "")}`)
      if (req.headers.authorization === conf.settings.control.token) {
        next()
        return
      }
      return res.status(401).send("Unauthorized: invalid token")
    }
    app.post("/.control/stop", limiter, middleware, async (req, res) => {
      console.debug("metrics/app/control > instance will be stopped in a few seconds")
      res.status(202).send("Accepted: instance will be stopped in a few seconds")
      await new Promise(resolve => setTimeout(resolve, 5000))
      process.exit(1)
    })
  }

  //Listen
  app.listen(port, () =>
    console.log([
      "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ",
      "‚îÄ‚îÄ Server configuration ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ",
      `Listening on port         ‚îÇ ${port}`,
      `Modes                     ‚îÇ ${conf.settings.modes}`,
      "‚îÄ‚îÄ Server capacity ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ",
      `Restricted to users       ‚îÇ ${restricted.size ? [...restricted].join(", ") : "(unrestricted)"}`,
      `Max simultaneous users    ‚îÇ ${maxusers ? `${maxusers} users` : "(unrestricted)"}`,
      `Rate limiter              ‚îÇ ${ratelimiter ? util.inspect(ratelimiter, {depth: Infinity, maxStringLength: 256}) : "(enabled)"}`,
      `Max repositories per user ‚îÇ ${conf.settings.repositories}`,
      "‚îÄ‚îÄ Render settings ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ",
      `Cached time               ‚îÇ ${cached} seconds`,
      `SVG optimization          ‚îÇ ${conf.settings.optimize ?? false}`,
      `Allowed outputs           ‚îÇ ${conf.settings.outputs.join(", ")}`,
      `Padding                   ‚îÇ ${conf.settings.padding}`,
      "‚îÄ‚îÄ Sandbox ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ",
      `Debug                     ‚îÇ ${debug}`,
      `Debug (puppeteer)         ‚îÇ ${conf.settings["debug.headless"] ?? false}`,
      `Mocked data               ‚îÇ ${conf.settings.mocked ?? false}`,
      "‚îÄ‚îÄ Content ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ",
      `Plugins enabled           ‚îÇ ${enabled.map(({name}) => name).join(", ")}`,
      `Templates enabled         ‚îÇ ${templates.filter(({enabled}) => enabled).map(({name}) => name).join(", ")}`,
      "‚îÄ‚îÄ OAuth ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ",
      `Client id                 ‚îÇ ${conf.settings.oauth?.id ?? "(none)"}`,
      "‚îÄ‚îÄ Extras ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ",
      `Default                   ‚îÇ ${conf.settings.extras?.default ?? false}`,
      `Features                  ‚îÇ ${Array.isArray(conf.settings.extras?.features) ? conf.settings.extras.features?.length ? conf.settings.extras?.features : "(none)" : "(default)"}`,
      "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ",
      "Server ready !",
    ].join("\n")))
}
</file>

<file path="source/plugins/community/16personalities/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üß† 16personalities</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays personality profile from a <a href="https://www.16personalities.com/profile">16personalities profile</a>.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://www.16personalities.com">16personalities</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
<tr><th>Authors</th><td><a href="https://github.com/lowlighter">@lowlighter</a></td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><i>No tokens are required for this plugin</i></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.16personalities.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_16personalities</code></h4></td>
    <td rowspan="2"><p>Enable 16personalities plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.run.puppeteer.scrapping</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_16personalities_url</code></h4></td>
    <td rowspan="2"><p>Profile URL</p>
<p>This can be obtained after doing the <a href="https://www.16personalities.com/free-personality-test">test on 16personalities</a> and registering an email.
Login with the generated password received in your mailbox and copy the link that is displayed when sharing the profile.</p>
<img src="/.github/readme/imgs/plugin_16personalities_profile.png" width="800" />
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_16personalities_sections</code></h4></td>
    <td rowspan="2"><p>Displayed sections</p>
<ul>
<li><code>personality</code> will display personality type</li>
<li><code>profile</code> will display role and strategy</li>
<li><code>traits</code> will display mind, energy, nature, tactics and identity traits</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> personality<br>
<b>allowed values:</b><ul><li>personality</li><li>profile</li><li>traits</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_16personalities_scores</code></h4></td>
    <td rowspan="2"><p>Display traits scores</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: MBTI Personality profile
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.16personalities.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_16personalities: yes
  plugin_16personalities_url: ${{ secrets.SIXTEEN_PERSONALITIES_URL }}
  plugin_16personalities_sections: personality, traits
  plugin_16personalities_scores: no

```
<!--/examples-->
</file>

<file path="source/plugins/leetcode/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üó≥Ô∏è Leetcode</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays statistics from a <a href="https://leetcode.com">LeetCode</a> account.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://leetcode.com">LeetCode</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code></td>
  </tr>
  <tr>
    <td><i>No tokens are required for this plugin</i></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.leetcode.svg" alt=""></img>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_leetcode</code></h4></td>
    <td rowspan="2"><p>Enable leetcode plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_leetcode_user</code></h4></td>
    <td rowspan="2"><p>LeetCode login</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>string</code>
<br>
<b>default:</b> <code>‚Üí User login</code><br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_leetcode_sections</code></h4></td>
    <td rowspan="2"><p>Displayed sections</p>
<ul>
<li><code>solved</code> will display solved problems scores</li>
<li><code>skills</code> will display solved problems tagged skills</li>
<li><code>recent</code> will display recent submissions</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> solved<br>
<b>allowed values:</b><ul><li>solved</li><li>skills</li><li>recent</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_leetcode_limit_skills</code></h4></td>
    <td rowspan="2"><p>Display limit (skills)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 10<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_leetcode_ignored_skills</code></h4></td>
    <td rowspan="2"><p>Ignored skills</p>
<p>It is possible to ignore entires categories by passing <code>fundamental</code>, <code>intermediate</code> or <code>advanced</code></p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_leetcode_limit_recent</code></h4></td>
    <td rowspan="2"><p>Display limit (recent)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 15)</i>
<br>
<b>default:</b> 2<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: LeetCode
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.leetcode.svg
  token: NOT_NEEDED
  base: ""
  plugin_leetcode: yes
  plugin_leetcode_sections: solved, skills, recent

```
<!--/examples-->
</file>

<file path="source/plugins/stargazers/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>‚ú® Stargazers</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays stargazers evolution across affiliated repositories.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>üóùÔ∏è plugin_stargazers_worldmap_token</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Classic charts</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stargazers.svg" alt=""></img></details>
      <details><summary>Graph charts</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stargazers.graph.svg" alt=""></img></details>
      <details open><summary>Worldmap</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stargazers.worldmap.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## üóùÔ∏è Obtaining a Google Maps API token

Some features like `plugin_stagazers_worldmap` require a Google Geocoding API token.
Follow instructions from their [documentation](https://developers.google.com/maps/documentation/geocoding/get-api-key) for more informations.

> üí≥ A billing account is required to get a token. However a recurring [monthly credit](https://developers.google.com/maps/billing-credits#monthly) is offered which means you should not be charged if you don't exceed the free quota.
>
> It is advised to set the quota limit at 1200 requests per day
>
> Use at your own risk, *metrics* and its authors cannot be held responsible for anything charged.

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stargazers</code></h4></td>
    <td rowspan="2"><p>Enable stargazers plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stargazers_days</code></h4></td>
    <td rowspan="2"><p>Time range</p>
<p>If set to <code>0</code> the account registration date will be used.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> see description</br>
<b>default:</b> 14<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stargazers_charts</code></h4></td>
    <td rowspan="2"><p>Charts</p>
<p>It includes total number of stargazers evolution, along with the number of new stars per day over the last two weeks.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> yes<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stargazers_charts_type</code></h4></td>
    <td rowspan="2"><p>Charts display type</p>
<ul>
<li><code>classic</code>: <code>&lt;div&gt;</code> based charts, simple and lightweight</li>
<li><code>graph</code>: <code>&lt;svg&gt;</code> based charts, smooth</li>
</ul>
<blockquote>
<p>‚ö†Ô∏è <code>chartist</code> option has been deprecated and is now equivalent to <code>graph</code></p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.npm.optional.d3</i></li>
</ul>
<b>type:</b> <code>string</code>
<br>
<b>default:</b> classic<br>
<b>allowed values:</b><ul><li>classic</li><li>graph</li><li>chartist</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stargazers_worldmap</code></h4></td>
    <td rowspan="2"><p>Stargazers worldmap</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.api.google.maps</i></li>
<li><i>metrics.npm.optional.d3</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stargazers_worldmap_token</code></h4></td>
    <td rowspan="2"><p>Stargazers worldmap token</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üîê Token<br>
<b>type:</b> <code>token</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_stargazers_worldmap_sample</code></h4></td>
    <td rowspan="2"><p>Stargazers worldmap sample</p>
<p>Use this setting to randomly sample and limit your stargazers.
Helps to avoid consuming too much Google Geocoding API requests while still being representative.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 0<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Using classic charts
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.stargazers.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_stargazers: yes

```
```yaml
name: Using graph charts
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.stargazers.graph.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_stargazers: yes
  plugin_stargazers_charts_type: graph

```
```yaml
name: With worldmap
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.stargazers.worldmap.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_stargazers: yes
  plugin_stargazers_charts: no
  plugin_stargazers_worldmap: yes
  plugin_stargazers_worldmap_token: ${{ secrets.GOOGLE_MAP_TOKEN }}
  plugin_stargazers_worldmap_sample: 200

```
<!--/examples-->
</file>

<file path="source/plugins/steam/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üïπÔ∏è Steam</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin can display your player profile and played games from your Steam account.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://store.steampowered.com">Steam</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code></td>
  </tr>
  <tr>
    <td><code>üóùÔ∏è plugin_steam_token</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Recently played games</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.steam.svg" alt=""></img></details>
      <details><summary>Profile and detailed game history</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.steam.full.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_steam</code></h4></td>
    <td rowspan="2"><p>Enable steam plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_steam_token</code></h4></td>
    <td rowspan="2"><p>Steam token</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üîê Token<br>
üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.api.steam</i></li>
</ul>
<b>type:</b> <code>token</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_steam_sections</code></h4></td>
    <td rowspan="2"><p>Displayed sections</p>
<ul>
<li><code>player</code>: display profile</li>
<li><code>most-played</code>: display most played games</li>
<li><code>recently-played</code>: display recently played games</li>
</ul>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> player, most-played, recently-played<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_steam_user</code></h4></td>
    <td rowspan="2"><p>Steam user id</p>
<p>This can be found on your Steam user account details</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>string</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_steam_games_ignored</code></h4></td>
    <td rowspan="2"><p>Ignored games</p>
<p>Use App id as they are referenced in Steam catalog</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_steam_games_limit</code></h4></td>
    <td rowspan="2"><p>Display limit (Most played games)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 1<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_steam_recent_games_limit</code></h4></td>
    <td rowspan="2"><p>Display limit (Recently played games)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 1<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_steam_achievements_limit</code></h4></td>
    <td rowspan="2"><p>Display limit (Games achievements)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>default:</b> 2<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_steam_playtime_threshold</code></h4></td>
    <td rowspan="2"><p>Display threshold (Game playtime in hours)</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>default:</b> 2<br></td>
  </tr>
</table>
<!--/options-->

## üóùÔ∏è Obtaining a *Steam Web API* token

Go to [steamcommunity.com/dev/apikey](https://steamcommunity.com/dev/apikey) to obtain a Steam Web API token:

![Token](/.github/readme/imgs/plugin_steam_webtoken.png)

To retrieve your Steam ID, access your user account on [store.steampowered.com/account](https://store.steampowered.com/account) and copy the identifier located behind the header:

![User ID](/.github/readme/imgs/plugin_steam_userid.png)

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Recently played games
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.steam.svg
  token: NOT_NEEDED
  base: ""
  plugin_steam_token: ${{ secrets.STEAM_TOKEN }}
  plugin_steam: yes
  plugin_steam_user: "0"
  plugin_steam_sections: recently-played
  plugin_steam_achievements_limit: 0

```
```yaml
name: Profile and detailed game history
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.steam.full.svg
  token: NOT_NEEDED
  base: ""
  plugin_steam_token: ${{ secrets.STEAM_TOKEN }}
  plugin_steam: yes
  plugin_steam_user: "0"

```
<!--/examples-->
</file>

<file path="source/plugins/tweets/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üê§ Latest tweets</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays the latest tweets from a <a href="https://twitter.com">Twitter</a> account.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Deprecated</th><td><p>As <a href="https://twitter.com">Twitter</a> removed the ability to fetch tweets from their free API as part of their new <a href="https://developer.twitter.com/en/docs/twitter-api/getting-started/about-twitter-api">pricing policy</a>, this plugin is no longer maintained.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://twitter.com">Twitter</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/markdown/README.md"><code>üìí Markdown template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code></td>
  </tr>
  <tr>
    <td><code>üóùÔ∏è plugin_tweets_token</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Latest tweets with attachments</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.tweets.attachments.svg" alt=""></img></details>
      <details><summary>Latest tweets</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.tweets.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_tweets</code></h4></td>
    <td rowspan="2"><p>Enable tweets plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üåê Web instances must configure <code>settings.json</code>:
<ul>
<li><i>metrics.api.twitter.tweets</i></li>
</ul>
<b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_tweets_token</code></h4></td>
    <td rowspan="2"><p>Twitter API token</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">üîê Token<br>
<b>type:</b> <code>token</code>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_tweets_user</code></h4></td>
    <td rowspan="2"><p>Twitter username</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚èØÔ∏è Cannot be preset<br>
<b>type:</b> <code>string</code>
<br>
<b>default:</b> <code>‚Üí User attached twitter</code><br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_tweets_attachments</code></h4></td>
    <td rowspan="2"><p>Tweets attachments</p>
<p>Can be used to display linked images, video thumbnails, etc.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_tweets_limit</code></h4></td>
    <td rowspan="2"><p>Display limit</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(1 ‚â§
ùë•
‚â§ 10)</i>
<br>
<b>default:</b> 2<br></td>
  </tr>
</table>
<!--/options-->

## üóùÔ∏è Obtaining a Twitter token

To get a Twitter token, it is required to apply to the [developer program](https://apps.twitter.com).
It's a bit tedious, but requests seems to be approved quite quickly.

Create an app from the [developer dashboard](https://developer.twitter.com/en/portal/dashboard) and register your bearer token in repository secrets.

![Twitter token](/.github/readme/imgs/plugin_tweets_secrets.png)

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Latest tweets
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.tweets.svg
  token: NOT_NEEDED
  base: ""
  plugin_tweets: yes
  plugin_tweets_token: ${{ secrets.TWITTER_TOKEN }}
  plugin_tweets_user: github

```
```yaml
name: Latest tweets including attachments
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.tweets.attachments.svg
  token: NOT_NEEDED
  base: ""
  plugin_tweets: yes
  plugin_tweets_token: ${{ secrets.TWITTER_TOKEN }}
  plugin_tweets_attachments: yes
  plugin_tweets_user: github
  plugin_tweets_limit: 1

```
<!--/examples-->
</file>

<file path="tests/mocks/api/axios/get/lastfm.mjs">
/**Mocked data */
export default function({faker, url, options, login = faker.internet.userName()}) {
  //Last.fm api
  if (/^https:..ws.audioscrobbler.com.*$/.test(url)) {
    //Get recently played tracks
    if (/user.getrecenttracks/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking lastfm api result > ${url}`)
      const artist = faker.lorem.word()
      const album = faker.lorem.words(3)
      const track = faker.lorem.words(5)
      const date = faker.date.recent()
      return ({
        status: 200,
        data: {
          recenttracks: {
            "@attr": {
              page: "1",
              perPage: "1",
              user: "RJ",
              total: "100",
              pages: "100",
            },
            track: [
              {
                artist: {
                  mbid: "",
                  "#text": artist,
                },
                album: {
                  mbid: "",
                  "#text": album,
                },
                image: [
                  {
                    size: "small",
                    "#text": faker.image.urlLoremFlickr({category: "abstract"}),
                  },
                  {
                    size: "medium",
                    "#text": faker.image.urlLoremFlickr({category: "abstract"}),
                  },
                  {
                    size: "large",
                    "#text": faker.image.urlLoremFlickr({category: "abstract"}),
                  },
                  {
                    size: "extralarge",
                    "#text": faker.image.urlLoremFlickr({category: "abstract"}),
                  },
                ],
                streamable: "0",
                date: {
                  uts: Math.floor(date.getTime() / 1000),
                  "#text": date.toUTCString().slice(5, 22),
                },
                url: faker.internet.url(),
                name: track,
                mbid: "",
              },
            ],
          },
        },
      })
    }
    else if (/user.gettoptracks/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking lastfm api result > ${url}`)
      const artist = faker.lorem.word()
      const track = faker.lorem.words(5)
      return ({
        status: 200,
        data: {
          toptracks: {
            "@attr": {
              page: "1",
              perPage: "1",
              user: "RJ",
              total: "100",
              pages: "100",
            },
            track: [
              {
                artist: {
                  mbid: "",
                  name: artist,
                },
                image: [
                  {
                    size: "small",
                    "#text": faker.image.urlLoremFlickr({category: "abstract"}),
                  },
                  {
                    size: "medium",
                    "#text": faker.image.urlLoremFlickr({category: "abstract"}),
                  },
                  {
                    size: "large",
                    "#text": faker.image.urlLoremFlickr({category: "abstract"}),
                  },
                  {
                    size: "extralarge",
                    "#text": faker.image.urlLoremFlickr({category: "abstract"}),
                  },
                ],
                url: faker.internet.url(),
                name: track,
                mbid: "",
              },
            ],
          },
        },
      })
    }
    else if (/user.gettopartists/.test(url)) {
      console.debug(`metrics/compute/mocks > mocking lastfm api result > ${url}`)
      const artist = faker.lorem.word()
      const playcount = faker.random.number()
      return ({
        status: 200,
        data: {
          topartists: {
            "@attr": {
              page: "1",
              perPage: "1",
              user: "RJ",
              total: "100",
              pages: "100",
            },
            artist: [
              {
                image: [
                  {
                    size: "small",
                    "#text": faker.image.urlLoremFlickr({category: "abstract"}),
                  },
                  {
                    size: "medium",
                    "#text": faker.image.urlLoremFlickr({category: "abstract"}),
                  },
                  {
                    size: "large",
                    "#text": faker.image.urlLoremFlickr({category: "abstract"}),
                  },
                  {
                    size: "extralarge",
                    "#text": faker.image.urlLoremFlickr({category: "abstract"}),
                  },
                ],
                streamable: "0",
                playcount,
                url: faker.internet.url(),
                name: artist,
                mbid: "",
              },
            ],
          },
        },
      })
    }
  }
}
</file>

<file path="tests/mocks/api/axios/get/spotify.mjs">
/**Mocked data */
export default function({faker, url, options, login = faker.internet.userName()}) {
  //Spotify api
  if (/^https:..api.spotify.com.*$/.test(url)) {
    //Get recently played tracks
    if (/me.player.recently-played/.test(url) && (options?.headers?.Authorization === "Bearer MOCKED_TOKEN_ACCESS")) {
      console.debug(`metrics/compute/mocks > mocking spotify api result > ${url}`)
      const artist = faker.lorem.words()
      const track = faker.lorem.words(5)
      return ({
        status: 200,
        data: {
          items: [
            {
              track: {
                album: {
                  album_type: "single",
                  artists: [
                    {
                      name: artist,
                      type: "artist",
                    },
                  ],
                  images: [
                    {
                      height: 640,
                      url: faker.image.urlLoremFlickr({category: "abstract"}),
                      width: 640,
                    },
                    {
                      height: 300,
                      url: faker.image.urlLoremFlickr({category: "abstract"}),
                      width: 300,
                    },
                    {
                      height: 64,
                      url: faker.image.urlLoremFlickr({category: "abstract"}),
                      width: 64,
                    },
                  ],
                  name: track,
                  release_date: `${faker.date.past()}`.substring(0, 10),
                  type: "album",
                },
                artists: [
                  {
                    name: artist,
                    type: "artist",
                  },
                ],
                name: track,
                preview_url: faker.internet.url(),
                type: "track",
              },
              played_at: `${faker.date.recent()}`,
              context: {
                type: "album",
              },
            },
          ],
        },
      })
    }
    else if (/me.top.tracks/.test(url) && (options?.headers?.Authorization === "Bearer MOCKED_TOKEN_ACCESS")) {
      console.debug(`metrics/compute/mocks > mocking spotify api result > ${url}`)
      const artist = faker.lorem.words()
      const track = faker.lorem.words(5)
      return ({
        status: 200,
        data: {
          items: [
            {
              album: {
                album_type: "single",
                artists: [
                  {
                    name: artist,
                    type: "artist",
                  },
                ],
                images: [
                  {
                    height: 640,
                    url: faker.image.urlLoremFlickr({category: "abstract"}),
                    width: 640,
                  },
                  {
                    height: 300,
                    url: faker.image.urlLoremFlickr({category: "abstract"}),
                    width: 300,
                  },
                  {
                    height: 64,
                    url: faker.image.urlLoremFlickr({category: "abstract"}),
                    width: 64,
                  },
                ],
                name: track,
                release_date: `${faker.date.past()}`.substring(0, 10),
                type: "album",
              },
              artists: [
                {
                  name: artist,
                  type: "artist",
                },
              ],
              name: track,
              preview_url: faker.internet.url(),
              type: "track",
            },
          ],
        },
      })
    }
    else if (/me.top.artists/.test(url) && (options?.headers?.Authorization === "Bearer MOCKED_TOKEN_ACCESS")) {
      console.debug(`metrics/compute/mocks > mocking spotify api result > ${url}`)
      const genre = faker.lorem.words()
      const track = faker.lorem.words(5)
      return ({
        status: 200,
        data: {
          items: [
            {
              genres: [genre],
              images: [
                {
                  height: 640,
                  url: faker.image.urlLoremFlickr({category: "abstract"}),
                  width: 640,
                },
                {
                  height: 300,
                  url: faker.image.urlLoremFlickr({category: "abstract"}),
                  width: 300,
                },
                {
                  height: 64,
                  url: faker.image.urlLoremFlickr({category: "abstract"}),
                  width: 64,
                },
              ],
              name: track,
              type: "artist",
            },
          ],
        },
      })
    }
  }
}
</file>

<file path="source/app/web/statics/embed/app.placeholder.js">
;(function({axios, faker, ejs} = {axios: globalThis.axios, faker: globalThis.faker, ejs: globalThis.ejs}) {
  //Load assets
  const cached = new Map()
  async function load(url) {
    if (!cached.has(url))
      cached.set(url, (await axios.get(url)).data)
    return cached.get(url)
  }
  //Distribution function
  function distribution(length) {
    let probability = 1
    const values = []
    for (let i = 0; i < length - 1; i++) {
      const value = Math.random() * probability
      values.push(value)
      probability -= value
    }
    values.push(probability)
    return values.sort((a, b) => b - a)
  }
  //Escape partial
  function escape(partial) {
    return encodeURIComponent(partial).replace(/%2F/gi, "/")
  }
  //Static complex placeholder
  async function staticPlaceholder(condition, name) {
    if (!condition)
      return ""
    return await fetch(`/.placeholders/${name}`).then(response => response.text()).catch(() => "(could not render placeholder)")
  }
  //Placeholder function
  globalThis.placeholder = async function(set) {
    //Load templates informations
    let {image, style, fonts, partials} = await load(`/.templates/${set.templates.selected}`)
    await Promise.all(partials.map(async partial => await load(`/.templates/${set.templates.selected}/partials/${escape(partial)}.ejs`)))
    //Trap includes
    image = image.replace(/<%-\s*await include[(](`.*?[.]ejs`)[)]\s*%>/g, (m, g) => `<%- await $include(${g}) %>`)
    //Faked data
    const options = set.plugins.options
    const data = {
      //Template elements
      style,
      fonts,
      errors: [],
      warnings: [],
      partials: new Set([...(set.config.order || "").split(",").map(x => x.trim()).filter(x => partials.includes(x)), ...partials]),
      //Plural helper
      s(value, end = "") {
        return value !== 1 ? {y: "ies", "": "s"}[end] : end
      },
      //Formatter helper
      f(n, {sign = false} = {}) {
        for (const {u, v} of [{u: "b", v: 10 ** 9}, {u: "m", v: 10 ** 6}, {u: "k", v: 10 ** 3}]) {
          if (n / v >= 1)
            return `${(sign) && (n > 0) ? "+" : ""}${(n / v).toFixed(2).substr(0, 4).replace(/[.]0*$/, "")}${u}`
        }
        return `${(sign) && (n > 0) ? "+" : ""}${n}`
      },
      //Trap for includes
      async $include(path) {
        const partial = await load(`/.templates/${set.templates.selected}/${escape(path)}`)
        return await ejs.render(partial, data, {async: true, rmWhitespace: true})
      },
      //Meta-data
      meta: {version: set.version, author: "lowlighter", generated: new Date().toGMTString().replace(/GMT$/g, "").trim()},
      //Animated
      animated: false,
      //Display size
      large: set.config.display === "large",
      columns: set.config.display === "columns",
      //Config
      config: set.config,
      //Extras
      extras: {css: options["extras.css"] ?? ""},
      //Base elements
      base: set.plugins.enabled.base,
      //Computed elements
      computed: {
        commits: faker.number.int(10000),
        sponsorships: faker.number.int(10),
        licenses: {favorite: [""], used: {MIT: 1}, about: {}},
        token: {scopes: []},
        repositories: {
          watchers: faker.number.int(1000),
          stargazers: faker.number.int(10000),
          issues_open: faker.number.int(1000),
          issues_closed: faker.number.int(1000),
          pr_open: faker.number.int(1000),
          pr_closed: {totalCount: faker.number.int(100)},
          pr_merged: faker.number.int(1000),
          forks: faker.number.int(1000),
          releases: faker.number.int(1000),
        },
        diskUsage: `${faker.number.float({min: 1, max: 999}).toFixed(1)}MB`,
        registration: `${faker.number.int({min: 2, max: 10})} years ago`,
        cakeday: false,
        calendar: new Array(14).fill(null).map(_ => ({color: faker.helpers.arrayElement(["#ebedf0", "#9be9a8", "#40c463", "#30a14e", "#216e39"])})),
        avatar: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==",
      },
      //User data
      account: "user",
      user: {
        databaseId: faker.number.int(10000000),
        name: "(placeholder)",
        login: set.user || "metrics",
        createdAt: `${faker.date.past({years: 10})}`,
        avatarUrl: set.avatar,
        websiteUrl: options["pagespeed.url"] || "(attached website)",
        isHireable: options["base.hireable"],
        twitterUsername: options["tweets.user"] || "(attached Twitter account)",
        repositories: {totalCount: faker.number.int(100), totalDiskUsage: faker.number.int(100000), nodes: []},
        packages: {totalCount: faker.number.int(10)},
        starredRepositories: {totalCount: faker.number.int(1000)},
        watching: {totalCount: faker.number.int(100)},
        sponsorshipsAsSponsor: {totalCount: faker.number.int(10)},
        sponsorshipsAsMaintainer: {totalCount: faker.number.int(10)},
        contributionsCollection: {
          totalRepositoriesWithContributedCommits: faker.number.int(100),
          totalCommitContributions: faker.number.int(10000),
          restrictedContributionsCount: faker.number.int(10000),
          totalIssueContributions: faker.number.int(100),
          totalPullRequestContributions: faker.number.int(1000),
          totalPullRequestReviewContributions: faker.number.int(1000),
        },
        calendar: {contributionCalendar: {weeks: []}},
        repositoriesContributedTo: {totalCount: faker.number.int(100)},
        followers: {totalCount: faker.number.int(1000)},
        following: {totalCount: faker.number.int(1000)},
        issueComments: {totalCount: faker.number.int(1000)},
        organizations: {totalCount: faker.number.int(10)},
      },
      //Plugins
      plugins: {
        //Tweets
        ...(set.plugins.enabled.tweets
          ? ({
            tweets: {
              username: options["tweets.user"] || "(attached Twitter account)",
              profile: {
                profile_image_url: faker.image.urlLoremFlickr({category: "people"}),
                name: "",
                verified: false,
                id: faker.number.int(1000000).toString(),
                username: options["tweets.user"] || "(attached Twitter account)",
                profile_image: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==",
              },
              list: [
                {
                  id: faker.number.int(100000000000000).toString(),
                  created_at: faker.date.recent(),
                  entities: {
                    mentions: [{start: 22, end: 33, username: "lowlighter"}],
                  },
                  text: 'Checkout metrics from  <span class="mention">@lowlighter</span>  !  <span class="hashtag">#GitHub</span> ',
                  mentions: ["lowlighter"],
                },
                ...new Array(Number(options["tweets.limit"]) - 1).fill(null).map(_ => ({
                  id: faker.number.int(100000000000000).toString(),
                  created_at: faker.date.recent(),
                  text: faker.lorem.paragraph(),
                  mentions: [],
                })),
              ],
            },
          })
          : null),
        //Lines
        ...(set.plugins.enabled.lines
          ? ({
            lines: {
              added: faker.number.int(1000000),
              deleted: faker.number.int(1000000),
              changed: faker.number.int(1000000),
              sections: options["lines.sections"].split(",").map(x => x.trim()),
              repos: new Array(options["lines.repositories.limit"] || 4).fill(null).map(_ => ({
                handle: `${faker.lorem.word()}/${faker.lorem.word()}`,
                added: faker.number.int(10000),
                deleted: faker.number.int(10000),
                changed: faker.number.int(10000),
              })),
              history: await staticPlaceholder(set.plugins.enabled.lines, "lines.history.svg"),
            },
          })
          : null),
        //Traffic
        ...(set.plugins.enabled.traffic
          ? ({
            traffic: {
              views: {
                count: `${faker.number.int({min: 10, max: 100})}.${faker.number.int(9)}k`,
                uniques: `${faker.number.int(10)}.${faker.number.int(9)}k`,
              },
            },
          })
          : null),
        //Follow-up
        ...(set.plugins.enabled.followup
          ? ({
            followup: {
              sections: options["followup.sections"].split(",").map(x => x.trim()).filter(x => ["user", "repositories"].includes(x)),
              issues: {
                get count() {
                  return this.open + this.closed + this.drafts + this.skipped
                },
                open: faker.number.int(1000),
                closed: faker.number.int(1000),
                drafts: faker.number.int(100),
                skipped: faker.number.int(100),
                get collaborators() {
                  return {
                    open: faker.number.int(this.open),
                    closed: faker.number.int(this.closed),
                    drafts: faker.number.int(this.drafts),
                    skipped: faker.number.int(this.skipped),
                  }
                },
              },
              pr: {
                get count() {
                  return this.open + this.closed + this.merged + this.drafts
                },
                open: faker.number.int(1000),
                closed: faker.number.int(1000),
                merged: faker.number.int(1000),
                drafts: faker.number.int(100),
                get collaborators() {
                  return {
                    open: faker.number.int(this.open),
                    closed: faker.number.int(this.closed),
                    merged: faker.number.int(this.skipped),
                    drafts: faker.number.int(this.drafts),
                  }
                },
              },
              user: {
                issues: {
                  get count() {
                    return this.open + this.closed + this.drafts + this.skipped
                  },
                  open: faker.number.int(1000),
                  closed: faker.number.int(1000),
                  drafts: faker.number.int(100),
                  skipped: faker.number.int(100),
                },
                pr: {
                  get count() {
                    return this.open + this.closed + this.merged + this.drafts
                  },
                  open: faker.number.int(1000),
                  closed: faker.number.int(1000),
                  merged: faker.number.int(1000),
                  drafts: faker.number.int(100),
                },
              },
              indepth: options["followup.indepth"] ? {} : null,
            },
          })
          : null),
        //Notable
        ...(set.plugins.enabled.notable
          ? ({
            notable: {
              contributions: new Array(2 + faker.number.int(2)).fill(null).map(_ => ({
                get name() {
                  return options["notable.repositories"] ? this.handle : this.handle.split("/")[0]
                },
                handle: `${faker.lorem.slug()}/${faker.lorem.slug()}`,
                avatar: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==",
                organization: faker.datatype.boolean(),
                stars: faker.number.int(1000),
                aggregated: faker.number.int(100),
                history: faker.number.int(1000),
                ...(options["notable.indepth"]
                  ? {
                    user: {
                      commits: faker.number.int(100),
                      percentage: faker.number.float({max: 1}),
                      maintainer: false,
                      stars: faker.number.int(100),
                    },
                  }
                  : null),
              })),
            },
          })
          : null),
        //Gists
        ...(set.plugins.enabled.gists
          ? ({
            gists: {
              totalCount: faker.number.int(100),
              stargazers: faker.number.int(1000),
              forks: faker.number.int(100),
              files: faker.number.int(100),
              comments: faker.number.int(1000),
            },
          })
          : null),
        //Reactions
        ...(set.plugins.enabled.reactions
          ? ({
            reactions: {
              list: {
                HEART: {
                  value: faker.number.int(100),
                  get percentage() {
                    return this.score
                  },
                  score: faker.number.int(100) / 100,
                },
                THUMBS_UP: {
                  value: faker.number.int(100),
                  get percentage() {
                    return this.score
                  },
                  score: faker.number.int(100) / 100,
                },
                THUMBS_DOWN: {
                  value: faker.number.int(100),
                  get percentage() {
                    return this.score
                  },
                  score: faker.number.int(100) / 100,
                },
                LAUGH: {
                  value: faker.number.int(100),
                  get percentage() {
                    return this.score
                  },
                  score: faker.number.int(100) / 100,
                },
                CONFUSED: {
                  value: faker.number.int(100),
                  get percentage() {
                    return this.score
                  },
                  score: faker.number.int(100) / 100,
                },
                EYES: {
                  value: faker.number.int(100),
                  get percentage() {
                    return this.score
                  },
                  score: faker.number.int(100) / 100,
                },
                ROCKET: {
                  value: faker.number.int(100),
                  get percentage() {
                    return this.score
                  },
                  score: faker.number.int(100) / 100,
                },
                HOORAY: {
                  value: faker.number.int(100),
                  get percentage() {
                    return this.score
                  },
                  score: faker.number.int(100) / 100,
                },
              },
              comments: options["reactions.limit"],
              details: options["reactions.details"].split(",").map(x => x.trim()),
              days: options["reactions.days"],
            },
          })
          : null),
        //Achievements
        ...(set.plugins.enabled.achievements
          ? ({
            achievements: {
              display: options["achievements.display"],
              list: new Array(8).fill(null).map(_ => ({
                prefix: "",
                title: faker.lorem.word(),
                unlock: null,
                text: faker.lorem.sentence(),
                get icon() {
                  const colors = {S: ["#FF0000", "#FF8500"], A: ["#B59151", "#FFD576"], B: ["#7D6CFF", "#B2A8FF"], C: ["#2088FF", "#79B8FF"], $: ["#FF48BD", "#FF92D8"], X: ["#7A7A7A", "#B0B0B0"]}
                  return `<g xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-width="2" fill="none" fill-rule="evenodd"><g stroke-linejoin="round"><g stroke="#secondary"><path d="M8 43a3 3 0 100 6 3 3 0 000-6zm40 0a3.001 3.001 0 10.002 6.002A3.001 3.001 0 0048 43zm-18 3h-4.971m-11.045 0H11M45 46h-4"/></g><path stroke="#primary" d="M13 51h28M36.992 45.276l6.375-8.017c1.488.63 3.272.29 4.414-.977a3.883 3.883 0 00.658-4.193l-1.96 2.174-1.936-.151-.406-1.955 1.96-2.173a3.898 3.898 0 00-4.107 1.092 3.886 3.886 0 00-.512 4.485l-7.317 7.169c-1.32 1.314-.807 2.59-.236 3.105.67.601 1.888.845 3.067-.56z"/><g stroke="#primary"><path d="M12.652 31.063l9.442 12.578a.512.512 0 01-.087.716l-2.396 1.805a.512.512 0 01-.712-.114L9.46 33.47l-.176-3.557 3.37 1.15zM17.099 43.115l2.395-1.806"/></g></g><path d="M25.68 36.927v-2.54a2.227 2.227 0 01.37-1.265c-.526-.04-3.84-.371-3.84-4.302 0-1.013.305-1.839.915-2.477a4.989 4.989 0 01-.146-1.86c.087-.882.946-.823 2.577.178 1.277-.47 2.852-.47 4.725 0 .248-.303 2.434-1.704 2.658-.268.047.296.016.946-.093 1.95.516.524.776 1.358.78 2.501.007 2.261-1.26 3.687-3.8 4.278.24.436.355.857.346 1.264a117.57 117.57 0 000 2.614c2.43-.744 4.228-2.06 5.395-3.95.837-1.356 1.433-2.932 1.433-4.865 0-2.886-1.175-4.984-2.5-6.388C32.714 19.903 30.266 19 28 19a9.094 9.094 0 00-6.588 2.897C20.028 23.393 19 25.507 19 28.185c0 2.026.701 3.945 1.773 5.38 1.228 1.643 2.864 2.764 4.907 3.362zM52.98 25.002l-3.07 3.065-1.49-1.485M6.98 25.002l-3.07 3.065-1.49-1.485" stroke="#primary" stroke-linejoin="round"/><path d="M19.001 11V9a2 2 0 012-2h14a2 2 0 012 2v2m-21 12.028v-10.03a2 2 0 012-1.998h20a2 2 0 012 2v10.028" stroke="#secondary" stroke-linejoin="round"/><path stroke="#secondary" d="M28.001 7V3M15.039 7.797c-5.297 3.406-9.168 8.837-10.517 15.2m46.737-.936c-1.514-5.949-5.25-11.01-10.273-14.248"/></g>`
                    .replace(/#primary/g, colors[this.rank][0])
                    .replace(/#secondary/g, colors[this.rank][1])
                },
                rank: faker.helpers.arrayElement(["A", "B", "C", "X", "$"]),
                progress: faker.number.int(100) / 100,
                value: faker.number.int(1000),
              }))
                .filter(({rank}) => options["achievements.secrets"] ? true : rank !== "$")
                .filter(({rank}) => ({S: 5, A: 4, B: 3, C: 2, $: 1, X: 0}[rank] >= {S: 5, A: 4, B: 3, C: 2, $: 1, X: 0}[options["achievements.threshold"]]))
                .sort((a, b) => ({S: 5, A: 4, B: 3, C: 2, $: 1, X: 0}[b.rank] + b.progress * 0.99) - ({S: 5, A: 4, B: 3, C: 2, $: 1, X: 0}[a.rank] + a.progress * 0.99))
                .slice(0, options["achievements.limit"] || Infinity),
            },
          })
          : null),
        //Introduction
        ...(set.plugins.enabled.introduction
          ? ({
            introduction: {
              mode: "user",
              title: options["introduction.title"],
              text: faker.lorem.sentences(),
            },
          })
          : null),
        //Code snippet
        ...(set.plugins.enabled.code
          ? ({
            code: {
              snippet: {
                sha: faker.git.shortSha(),
                message: faker.lorem.sentence(),
                filename: "docs/specifications.html",
                status: "modified",
                additions: faker.number.int(50),
                deletions: faker.number.int(50),
                patch: `<span class="token coord">@@ -0,0 +1,5 @@</span><br>  //Imports<br><span class="token inserted">+  import app from "./src/app.mjs"</span><br><span class="token deleted">-  import app from "./src/app.js"</span><br>  //Start app<br>  await app()<br>\\ No newline at end of file`,
                repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                created: faker.date.recent(),
              },
            },
          })
          : null),
        //Sponsors
        ...(set.plugins.enabled.sponsors
          ? ({
            sponsors: {
              sections: options["sponsors.sections"].split(",").map(x => x.trim()),
              about: "A new way to contribute to open source",
              list: new Array(Number(faker.number.int(40))).fill(null).map(_ => ({
                login: faker.internet.userName(),
                amount: faker.number.int(10),
                avatar: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==",
                past: faker.datatype.boolean(),
              })),
              past: options["sponsors.past"],
              size: options["sponsors.size"],
              count: {
                total: {
                  count: faker.number.int(100),
                  user: faker.number.int(100),
                  organization: faker.number.int(100),
                },
                active: {
                  total: faker.number.int(100),
                  user: faker.number.int(100),
                  organization: faker.number.int(100),
                },
                past: {
                  total: faker.number.int(100),
                  user: faker.number.int(100),
                  organization: faker.number.int(100),
                },
              },
              goal: {
                progress: faker.number.int(100),
                title: `$${faker.number.int(100) * 10} per month`,
                description: "Invest in the software that powers your world",
              },
            },
          })
          : null),
        //Sponsorships
        ...(set.plugins.enabled.sponsorships
          ? ({
            sponsorships: {
              sections: options["sponsorships.sections"].split(",").map(x => x.trim()),
              amount: faker.number.int(1000),
              list: new Array(2 + faker.number.int(8)).fill(null).map(_ => ({
                login: faker.internet.userName(),
                avatar: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==",
                type: "user",
                tier: `$${faker.number.int(100) * 10} per month`,
                private: false,
                past: faker.datatype.boolean(),
              })),
              size: Number(options["sponsorships.size"]),
              image: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==",
              started: faker.date.recent(),
            },
          })
          : null),
        //Languages
        ...(set.plugins.enabled.languages
          ? ({
            languages: {
              unique: faker.number.int(50),
              sections: options["languages.sections"].split(", ").map(x => x.trim()).filter(x => /^(most-used|recently-used)$/.test(x)),
              details: options["languages.details"].split(",").map(x => x.trim()).filter(x => x),
              get colors() {
                return Object.fromEntries(Object.entries(this.favorites).map(([key, {color}]) => [key, color]))
              },
              total: faker.number.int(10000),
              get stats() {
                return Object.fromEntries(Object.entries(this.favorites).map(([key, {value}]) => [key, value]))
              },
              ["stats.recent"]: {
                total: faker.number.int(10000),
                get lines() {
                  return Object.fromEntries(Object.entries(this.recent).map(([key, {value}]) => [key, value]))
                },
                get stats() {
                  return Object.fromEntries(Object.entries(this.recent).map(([key, {value}]) => [key, value]))
                },
                commits: faker.number.int(500),
                files: faker.number.int(1000),
                days: Number(options["languages.recent.days"]),
              },
              favorites: distribution(options["languages.limit"] || 8).map((value, index, array) => ({name: (index + 1 === array.length) && (options["languages.other"]) ? "Other" : faker.lorem.word(), color: faker.internet.color(), value, size: faker.number.int(1000000), x: array.slice(0, index).reduce((a, b) => a + b, 0)})),
              recent: distribution(options["languages.limit"] || 8).map((value, index, array) => ({name: (index + 1 === array.length) && (options["languages.other"]) ? "Other" : faker.lorem.word(), color: faker.internet.color(), value, size: faker.number.int(1000000), x: array.slice(0, index).reduce((a, b) => a + b, 0)})),
              get verified() {
                return options["languages.indepth"] ? {signature: faker.number.int(this.commits)} : null
              },
              indepth: options["languages.indepth"],
              commits: faker.number.int(500),
              files: faker.number.int(1000),
            },
          })
          : null),
        //RSS
        ...(set.plugins.enabled.rss
          ? ({
            rss: {
              source: faker.lorem.words(),
              description: faker.lorem.paragraph(),
              link: options["rss.source"],
              feed: new Array(Number(options["rss.limit"])).fill(null).map(_ => ({
                title: faker.lorem.sentence(),
                date: faker.date.recent(),
              })),
            },
          })
          : null),
        //Stock price
        ...(set.plugins.enabled.stock
          ? ({
            stock: {
              chart: await staticPlaceholder(set.plugins.enabled.stock, "stock.svg"),
              currency: "USD",
              price: faker.number.int(10000) / 100,
              previous: faker.number.int(10000) / 100,
              get delta() {
                return this.price - this.previous
              },
              symbol: options["stock.symbol"],
              company: faker.company.name(),
              interval: options["stock.interval"],
              duration: options["stock.duration"],
            },
          })
          : null),
        //Habits
        ...(set.plugins.enabled.habits
          ? ({
            habits: {
              facts: options["habits.facts"],
              charts: options["habits.charts"],
              trim: options["habits.trim"],
              lines: {
                average: {
                  chars: faker.number.int(1000) / 10,
                },
              },
              commits: {
                get hour() {
                  return Object.keys(this.hours).filter(key => /^\d+$/.test(key)).map(key => [key, this.hours[key]]).sort((a, b) => b[1] - a[1]).shift()?.[0]
                },
                hours: {
                  [faker.number.int(24)]: faker.number.int(10),
                  [faker.number.int(24)]: faker.number.int(10),
                  [faker.number.int(24)]: faker.number.int(10),
                  [faker.number.int(24)]: faker.number.int(10),
                  [faker.number.int(24)]: faker.number.int(10),
                  [faker.number.int(24)]: faker.number.int(10),
                  [faker.number.int(24)]: faker.number.int(10),
                  get max() {
                    return Object.keys(this).filter(key => /^\d+$/.test(key)).map(key => [key, this[key]]).sort((a, b) => b[1] - a[1]).shift()?.[1]
                  },
                },
                get day() {
                  return ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"][Object.keys(this.days).filter(key => /^\d+$/.test(key)).map(key => [key, this.days[key]]).sort((a, b) => b[1] - a[1]).shift()?.[0]]
                },
                days: {
                  "0": faker.number.int(10),
                  "1": faker.number.int(10),
                  "2": faker.number.int(10),
                  "3": faker.number.int(10),
                  "4": faker.number.int(10),
                  "5": faker.number.int(10),
                  "6": faker.number.int(10),
                  get max() {
                    return Object.keys(this).filter(key => /^\d+$/.test(key)).map(key => [key, this[key]]).sort((a, b) => b[1] - a[1]).shift()?.[1]
                  },
                },
              },
              indents: {style: "spaces", spaces: 1, tabs: 0},
              linguist: {
                available: true,
                get ordered() {
                  return Object.entries(this.languages)
                },
                get languages() {
                  return Object.fromEntries(distribution(4).map(value => [faker.lorem.word(), value]))
                },
              },
            },
          })
          : null),
        //People
        ...(set.plugins.enabled.people
          ? ({
            get people() {
              const types = options["people.types"].split(",").map(x => x.trim())
                .map(x => ({followed: "following", sponsors: "sponsorshipsAsMaintainer", sponsored: "sponsorshipsAsSponsor", sponsoring: "sponsorshipsAsSponsor"})[x] ?? x)
                .filter(x => ["followers", "following", "sponsorshipsAsMaintainer", "sponsorshipsAsSponsor"].includes(x))
              return {
                types,
                size: options["people.size"],
                ...(Object.fromEntries(types.map(type => [
                  type,
                  new Array(Number(options["people.limit"])).fill(null).map(_ => ({
                    login: faker.internet.userName(),
                    avatar: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==",
                  })),
                ]))),
                thanks: options["people.thanks"].split(",").map(x => x.trim()).map(login => ({
                  login,
                  avatar: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==",
                })),
              }
            },
          })
          : null),
        //Music
        ...(set.plugins.enabled.music
          ? ({
            music: {
              provider: "(music provider)",
              mode: "Suggested tracks",
              played_at: options["music.played.at"],
              tracks: new Array(Number(options["music.limit"])).fill(null).map(_ => ({
                name: faker.lorem.words(5),
                artist: faker.lorem.words(),
                artwork: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==",
                played_at: options["music.played.at"] ? faker.date.recent() : null,
              })),
            },
          })
          : null),
        //Nightscout
        ...(set.plugins.enabled.nightscout
          ? ({
            nightscout: {
              url: options["nightscout.url"] != null && options["nightscout.url"] != "https://example.herokuapp.com" ? options["nightscout.url"] : "https://testapp.herokuapp.com/",
              data: new Array(12).fill(null).map(_ => ({
                timeUTCHumanReadable: `${new Date().getUTCHours()}:${new Date().getUTCMinutes()}`,
                color: faker.helpers.arrayElement(["#9be9a8", "#40c463", "#30a14e", "#216e39"]),
                sgv: faker.number.int({min: 40, max: 400}),
                delta: faker.number.int({min: -10, max: 10}),
                direction: faker.helpers.arrayElement(["SingleUp", "DoubleUp", "FortyFiveUp", "Flat", "FortyFiveDown", "SingleDown", "DoubleDown"]),
                alert: faker.helpers.arrayElement(["Normal", "Urgent High", "Urgent Low", "High", "Low"]),
                arrowHumanReadable: faker.helpers.arrayElement(["‚Üë‚Üë", "‚Üë", "‚Üó", "‚Üí", "‚Üò", "‚Üì", "‚Üì‚Üì"]),
              })),
            },
          })
          : null),
        //Fortune
        ...(set.plugins.enabled.fortune
          ? ({
            fortune: faker.helpers.arrayElement([
              {chance: .06, color: "#43FD3B", text: "Good news will come to you by mail"},
              {chance: .06, color: "#00CBB0", text: "ÔΩ∑ÔæÄ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ(Ôæü‚àÄÔæü)‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ !!!!"},
              {chance: 0.03, color: "#FD4D32", text: "Excellent Luck"},
            ]),
          })
          : null),
        //Pagespeed
        ...(set.plugins.enabled.pagespeed
          ? ({
            pagespeed: {
              url: options["pagespeed.url"] || "(attached website url)",
              detailed: options["pagespeed.detailed"] || false,
              scores: [
                {score: faker.number.float({max: 1}), title: "Performance"},
                {score: faker.number.float({max: 1}), title: "Accessibility"},
                {score: faker.number.float({max: 1}), title: "Best Practices"},
                {score: faker.number.float({max: 1}), title: "SEO"},
                ...options["pagespeed.pwa"] ? [{score: faker.number.int({max: 1}), title: "PWA"}] : [],
              ],
              metrics: {
                observedFirstContentfulPaint: faker.number.int(500),
                observedFirstVisualChangeTs: faker.date.recent(),
                observedFirstContentfulPaintTs: faker.date.recent(),
                firstContentfulPaint: faker.number.int(500),
                observedDomContentLoaded: faker.number.int(500),
                observedFirstMeaningfulPaint: faker.number.int(1000),
                maxPotentialFID: faker.number.int(500),
                observedLoad: faker.number.int(500),
                firstMeaningfulPaint: faker.number.int(500),
                observedCumulativeLayoutShift: faker.number.float({max: 1}),
                observedSpeedIndex: faker.number.int(1000),
                observedSpeedIndexTs: faker.date.recent(),
                observedTimeOriginTs: faker.date.recent(),
                observedLargestContentfulPaint: faker.number.int(1000),
                cumulativeLayoutShift: faker.number.float({max: 1}),
                observedFirstPaintTs: faker.date.recent(),
                observedTraceEndTs: faker.date.recent(),
                largestContentfulPaint: faker.number.int(2000),
                observedTimeOrigin: faker.number.int(10),
                speedIndex: faker.number.int(1000),
                observedTraceEnd: faker.number.int(2000),
                observedDomContentLoadedTs: faker.date.recent(),
                observedFirstPaint: faker.number.int(500),
                totalBlockingTime: faker.number.int(500),
                observedLastVisualChangeTs: faker.date.recent(),
                observedFirstVisualChange: faker.number.int(500),
                observedLargestContentfulPaintTs: faker.date.recent(),
                estimatedInputLatency: faker.number.int(100),
                observedLoadTs: faker.date.recent(),
                observedLastVisualChange: faker.number.int(1000),
                firstCPUIdle: faker.number.int(1000),
                interactive: faker.number.int(1000),
                observedNavigationStartTs: faker.date.recent(),
                observedNavigationStart: faker.number.int(10),
                observedFirstMeaningfulPaintTs: faker.date.recent(),
              },
              screenshot: options["pagespeed.screenshot"] ? "data:image/jpg;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==" : null,
            },
          })
          : null),
        //Projects
        ...(set.plugins.enabled.projects
          ? ({
            projects: {
              totalCount: options["projects.limit"] + faker.number.int(10),
              descriptions: options["projects.descriptions"],
              list: new Array(Number(options["projects.limit"])).fill(null).map(_ => ({
                name: faker.lorem.sentence(),
                description: faker.lorem.paragraph(),
                updated: `${2 + faker.number.int(8)} days ago`,
                ...(faker.datatype.boolean()
                  ? {
                    items: new Array(faker.number.int(4)).fill(null).map(() => ({type: faker.helpers.arrayElement(["DRAFT_ISSUE", "ISSUE", "PULL_REQUEST", "REDACTED"]), text: faker.lorem.sentence()})),
                    progress: {
                      enabled: false,
                      todo: NaN,
                      doing: NaN,
                      done: NaN,
                      total: faker.number.int(100),
                    },
                  }
                  : {
                    progress: {
                      enabled: true,
                      todo: faker.number.int(50),
                      doing: faker.number.int(50),
                      done: faker.number.int(50),
                      get total() {
                        return this.todo + this.doing + this.done
                      },
                    },
                  }),
              })),
            },
          })
          : null),
        //Discussions
        ...(set.plugins.enabled.discussions
          ? ({
            discussions: {
              categories: {
                stats: {"üôè Q&A": faker.number.int(100), "üì£ Announcements": faker.number.int(100), "üí° Ideas": faker.number.int(100), "üí¨ General": faker.number.int(100)},
                favorite: "üì£ Announcements",
              },
              upvotes: {discussions: faker.number.int(1000), comments: faker.number.int(1000)},
              started: faker.number.int(1000),
              comments: faker.number.int(1000),
              answers: faker.number.int(1000),
              display: {categories: options["discussions.categories"] ? {limit: options["discussions.categories.limit"] || Infinity} : null},
            },
          })
          : null),
        //Posts
        ...(set.plugins.enabled.posts
          ? ({
            posts: {
              source: options["posts.source"],
              descriptions: options["posts.descriptions"],
              covers: options["posts.covers"],
              list: new Array(Number(options["posts.limit"])).fill(null).map(_ => ({
                title: faker.lorem.sentence(),
                description: faker.lorem.paragraph(),
                date: faker.date.recent(),
                image: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==",
              })),
            },
          })
          : null),
        //Topics
        ...(set.plugins.enabled.topics
          ? ({
            topics: {
              mode: options["topics.mode"],
              type: {starred: "labels", labels: "labels", mastered: "icons", icons: "icons"}[options["topics.mode"]] || "labels",
              list: new Array(Number(options["topics.limit"]) || 20).fill(null).map(_ => ({
                name: faker.lorem.words(2),
                description: faker.lorem.sentence(),
                icon: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==",
              })),
            },
          })
          : null),
        //Stars
        ...(set.plugins.enabled.stars
          ? ({
            stars: {
              repositories: [
                {
                  starredAt: faker.date.recent(),
                  node: {
                    description: "üìä An image generator with 20+ metrics about your GitHub account such as activity, community, repositories, coding habits, website performances, music played, starred topics, etc. that you can put on your profile or elsewhere !",
                    forkCount: faker.number.int(100),
                    isFork: false,
                    issues: {
                      totalCount: faker.number.int(100),
                    },
                    nameWithOwner: "lowlighter/metrics",
                    openGraphImageUrl: "https://repository-images.githubusercontent.com/293860197/7fd72080-496d-11eb-8fe0-238b38a0746a",
                    pullRequests: {
                      totalCount: faker.number.int(100),
                    },
                    stargazerCount: faker.number.int(10000),
                    licenseInfo: {nickname: null, name: "MIT License"},
                    primaryLanguage: {color: "#f1e05a", name: "JavaScript"},
                  },
                  starred: "1 day ago",
                },
                ...new Array(Number(options["stars.limit"]) - 1).fill(null).map((_, i) => ({
                  starredAt: faker.date.recent(),
                  node: {
                    description: faker.lorem.sentence(),
                    forkCount: faker.number.int(100),
                    isFork: faker.datatype.boolean(),
                    issues: {
                      totalCount: faker.number.int(100),
                    },
                    nameWithOwner: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    openGraphImageUrl: faker.internet.url(),
                    pullRequests: {
                      totalCount: faker.number.int(100),
                    },
                    stargazerCount: faker.number.int(10000),
                    licenseInfo: {nickname: null, name: "License"},
                    primaryLanguage: {color: faker.internet.color(), name: faker.lorem.word()},
                  },
                  starred: `${i + 2} days ago`,
                })),
              ],
            },
          })
          : null),
        //Starlists
        ...(set.plugins.enabled.starlists
          ? ({
            starlists: {
              lists: new Array(Number(options["starlists.limit"])).fill(null).map(_ => ({
                link: faker.internet.url(),
                name: `${faker.helpers.arrayElement(["üòé", "ü•≥", "üßê", "üòÇ", "üòÅ"])} ${faker.lorem.word()}`,
                description: faker.lorem.sentence(),
                count: faker.number.int(100),
                repositories: new Array(Number(options["starlists.limit.repositories"])).fill(null).map((_, i) => ({
                  description: !i
                    ? "üìä An image generator with 20+ metrics about your GitHub account such as activity, community, repositories, coding habits, website performances, music played, starred topics, etc. that you can put on your profile or elsewhere !"
                    : faker.lorem.sentence(),
                  name: !i ? "lowlighter/metrics" : `${faker.lorem.word()}/${faker.lorem.word()}`,
                })),
              })),
            },
          })
          : null),
        //Repositories
        ...(set.plugins.enabled.repositories
          ? ({
            repositories: {
              list: new Array(Number(options["repositories.featured"].split(",").map(x => x.trim()).length)).fill(null).map((_, i) => ({
                created: faker.date.past(),
                description: faker.lorem.sentence(),
                forkCount: faker.number.int(100),
                isFork: faker.datatype.boolean(),
                issues: {
                  totalCount: faker.number.int(100),
                },
                nameWithOwner: `${faker.lorem.word()}/${faker.lorem.word()}`,
                openGraphImageUrl: faker.internet.url(),
                pullRequests: {
                  totalCount: faker.number.int(100),
                },
                stargazerCount: faker.number.int(10000),
                licenseInfo: {nickname: null, name: "License"},
                primaryLanguage: {color: faker.internet.color(), name: faker.lorem.word()},
              })),
            },
          })
          : null),
        //Stargazers
        ...(set.plugins.enabled.stargazers
          ? ({
            __stargazers: {
              worldmap: await staticPlaceholder(options["stargazers.worldmap"], "stargazers.worldmap.svg"),
            },
            get stargazers() {
              const dates = []
              let total = faker.number.int(1000)
              const result = {
                worldmap: this.__stargazers.worldmap,
                total: {
                  dates: {},
                  get max() {
                    return Math.max(...dates.map(date => this.dates[date]))
                  },
                  get min() {
                    return Math.min(...dates.map(date => this.dates[date]))
                  },
                },
                increments: {
                  dates: {},
                  get max() {
                    return Math.max(...dates.map(date => this.dates[date]))
                  },
                  get min() {
                    return Math.min(...dates.map(date => this.dates[date]))
                  },
                },
                months: ["", "Jan.", "Feb.", "Mar.", "Apr.", "May", "June", "July", "Aug.", "Sep.", "Oct.", "Nov.", "Dec."],
              }
              for (let d = -14; d <= 0; d++) {
                const date = new Date(Date.now() - d * 24 * 60 * 60 * 1000).toISOString().substring(0, 10)
                dates.push(date)
                result.total.dates[date] = total += result.increments.dates[date] = faker.number.int(100)
              }
              return result
            },
          })
          : null),
        //Wakatime
        ...(set.plugins.enabled.wakatime
          ? ({
            get wakatime() {
              const stats = array => {
                const elements = []
                let results = new Array(4 + faker.number.int(2)).fill(null).map(_ => ({
                  name: array ? faker.helpers.arrayElement(array) : faker.lorem.words(2).replace(/ /g, "-").toLocaleLowerCase(),
                  percent: 0,
                  total_seconds: faker.number.int(1000000),
                }))
                let percents = 100
                for (const result of results) {
                  result.percent = 1 + faker.number.int(percents - 1)
                  percents -= result.percent
                  result.percent /= 100
                }
                results.filter(({name}) => elements.includes(name) ? false : (elements.push(name), true))
                return results.sort((a, b) => b.percent - a.percent)
              }
              return {
                sections: options["wakatime.sections"].split(",").map(x => x.trim()).filter(x => x),
                days: Number(options["wakatime.days"]) || 7,
                time: {total: faker.number.int(100000), daily: faker.number.int(24)},
                editors: stats(["VS Code", "Chrome", "IntelliJ", "PhpStorm", "WebStorm", "Android Studio", "Visual Studio", "Sublime Text", "PyCharm", "Vim", "Atom", "Xcode"]),
                languages: stats(["JavaScript", "TypeScript", "PHP", "Java", "Python", "Vue.js", "HTML", "C#", "JSON", "Dart", "SCSS", "Kotlin", "JSX", "Go", "Ruby", "YAML"]),
                projects: stats(),
                os: stats(["Mac", "Windows", "Linux"]),
              }
            },
          })
          : null),
        //Anilist
        ...(set.plugins.enabled.anilist
          ? ({
            anilist: {
              user: {
                stats: {
                  anime: {
                    count: faker.number.int(1000),
                    minutesWatched: faker.number.int(100000),
                    episodesWatched: faker.number.int(10000),
                    genres: new Array(4).fill(null).map(_ => ({genre: faker.lorem.word()})),
                  },
                  manga: {
                    count: faker.number.int(1000),
                    chaptersRead: faker.number.int(100000),
                    volumesRead: faker.number.int(10000),
                    genres: new Array(4).fill(null).map(_ => ({genre: faker.lorem.word()})),
                  },
                },
                genres: new Array(4).fill(null).map(_ => ({genre: faker.lorem.word()})),
              },
              get lists() {
                const media = type => ({
                  name: faker.lorem.words(),
                  type,
                  status: faker.helpers.arrayElement(["FINISHED", "RELEASING", "NOT_YET_RELEASED", "CANCELLED", "HIATUS"]),
                  release: faker.date.past({years: 20}).getFullYear(),
                  genres: new Array(6).fill(null).map(_ => faker.lorem.word()),
                  progress: faker.number.int(100),
                  description: faker.lorem.paragraphs(),
                  scores: {user: faker.number.int(100), community: faker.number.int(100)},
                  released: 100 + faker.number.int(1000),
                  artwork: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==",
                })
                const sections = options["anilist.sections"].split(",").map(x => x.trim()).filter(x => x)
                const medias = options["anilist.medias"].split(",").map(x => x.trim()).filter(x => x)
                return {
                  ...(medias.includes("anime")
                    ? {
                      anime: {
                        ...(sections.includes("watching") ? {watching: new Array(Number(options["anilist.limit"]) || 4).fill(null).map(_ => media("ANIME"))} : {}),
                        ...(sections.includes("favorites") ? {favorites: new Array(Number(options["anilist.limit"]) || 4).fill(null).map(_ => media("ANIME"))} : {}),
                      },
                    }
                    : {}),
                  ...(medias.includes("manga")
                    ? {
                      manga: {
                        ...(sections.includes("reading") ? {reading: new Array(Number(options["anilist.limit"]) || 4).fill(null).map(_ => media("MANGA"))} : {}),
                        ...(sections.includes("favorites") ? {favorites: new Array(Number(options["anilist.limit"]) || 4).fill(null).map(_ => media("MANGA"))} : {}),
                      },
                    }
                    : {}),
                }
              },
              characters: new Array(11).fill(null).map(_ => ({
                name: faker.person.fullName(),
                artwork: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==",
              })),
              sections: options["anilist.sections"].split(",").map(x => x.trim()).filter(x => x),
            },
          })
          : null),
        //Steam
        ...(set.plugins.enabled.steam
          ? ({
            steam: {
              sections: options["steam.sections"].split(",").map(x => x.trim()).filter(x => x),
              player: {
                level: faker.number.int(100),
                avatar: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==",
                created: faker.date.recent({days: 10}).getTime(),
                name: faker.internet.userName(),
              },
              games: {
                count: 2,
                playtime: faker.number.int(1000),
                achievements: 0,
                "most-played": [
                  {
                    id: 524220,
                    name: "NieR:Automata‚Ñ¢",
                    icon:
                      "data:image/jpg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABAAEADASIAAhEBAxEB/8QAHAAAAgMBAQEBAAAAAAAAAAAABgcFCAkEAwEA/8QAMBAAAQMDAwEGBQQDAAAAAAAAAQIDBAAFEQYHITESExQiQVEjMkJhcQhSobEVgcH/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8ArPebk9cpIW+U8D0FcJUTj39q+Kxnjp6VN6N0zcdV3xi12lpTjzqgCoDIQPc0EKlZ6YJI6Yrvt1oudwIRAhPPqV+1NXb252F01pmHGfuDHjLoPMtazlGfbsmmoxZbXHwI9uhN4/aykH+qDNa5afvNsBE+3vsgj6k1EqKgeRhXTmtQXbTb3jh6BEcT7LZSo/yKXevNktKaqbkOGGIk5acNuMnsJSfwKCgXbUlWfqrpts12DLS8zgqB5yKJNydDXLQl9ct9xQe7J+G5jhQ9KEU/MMUH5XUZOR9qu1+l7Q8fS+jDfLk0lufLyVLWPlb6giqdaYgpueorfDI8rzoSRWhGpbZKe20MK15D6YiEoSnqSAKCMTuzZv8AMeFUy6Ifb7vx2fhAjqKYTD7chpDzCgttYCkqHQikM3fbEnbB6yqhpevThU34NKfi9vI82cUz9EKfs+lILd+eS24oAISRykY4BoC5RwCSQPzS9uu6tmgXZcRCHJEdo4elIPkb980R3iWLvZp8ayS21TO78uOopC27VtqsGjLzpm/2l1m8rU4UhxIKpBUrjBxQMHfPSkDX+3L8yEEPSmGy9GcQOSeOKoU60piQ404PM2opUPYjitDNl7XPg6Ebau6VBTqlLS2vqlB6CqQbsWtFn3AusZsdlJcLmPyTQRGkZibfqq2ynD5Wngo1ou5Pks6et8yE33iCyhS04z5SkVmecpWCnqORV7/0266Z1ZoliHJfQq5RPI40evYHAoCKdqvR0BwyViCLljPd9gBeag7rutF75pk2N98k+TBHP4rx3F2YiX68qvlqfVGuSQMIUSUEj7UAzdtNwo0pl+LLjPOtqzgNelAwY+58W3zA2rT8lhx35jkDipuJrLRV5mI8aICbik5Sh5sKXn84pSx9ttwrhOW7cJUdBUAAe66Ue6G2WhWq6ovF+f8AG3JGCgtkpQD9x60DMtEp+WHHFoCI2MN4GOKz73lnouW410eRyAstjHuCauzvNrGLonQ81/vEty3GyiMgcEqrPSXJXMmyJLxy68srJ+5OaDxX81EOhNWXHR1/YudsdUlTagVIB4UPYioi4wZEJ/upCCleM1yhJ59KC/8AtzvRpnV8NhLstuFcSACw6rlSvXFM5JT84UCFDg54rLZpx1hxLsdS2lJ6KScEf7ootm4OqbatCmLvJV2eneOFQ/ug0jzzyefzQDr3dfTOjWHRMnNPTUDiM2rzVR27bjaruR7Ui7SEk8ZbWU/9oXlyZEt0uS3nH3T9S1FR/mgLd0df3LXl9cmTVqEYKIaazwkenFBaeo9K+dk56V7w4zsqQGWkFS1dAKD/2Q==",
                    playtime: faker.number.int(100),
                    played: faker.date.recent({days: 10}).getTime(),
                    description: "NieR: Automata tells the story of androids 2B, 9S and A2 and their battle to reclaim the machine-driven dystopia overrun by powerful machines.",
                    genres: [
                      "Action",
                      "RPG",
                    ],
                    achievements: [
                      {
                        icon:
                          "data:image/jpg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAgACADASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAUGBwP/xAAmEAABAgQDCQAAAAAAAAAAAAABAAIDBAUGBxIUFiMxNVNhc5Gx/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAME/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8A6XVcM5QqlppTK+G4GJvSXEEngOyT7d1TpwPRRiVz5niH0qTWNVWbd1TpwPRTi1bhnK7UtNN5WQ2gRN0S0kg8D2Wdqsw158/xH6EBiVz5niH0qTWiXVb05XalqZTKyG0GHvQWkkHiOyT7CVTqQPZQSarMNefP8R+hGwlU6kD2U4tW3pyhVLUzeV8NwEPdAuIJPE9kH//Z",
                        achieved: true,
                        unlocked: faker.date.recent({days: 10}).getTime(),
                        name: "Transcendent Being",
                        description: "",
                        id: "ACH_BAD_END",
                      },
                      {
                        icon:
                          "data:image/jpg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAgACADASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAABQQDAAL/xAAtEAABAwMCBAQGAwAAAAAAAAABAgMEAAURBiISITFBExQjMlFhcYGRsRXB0f/EABcBAQEBAQAAAAAAAAAAAAAAAAABAwT/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwC3UF7lWeeY8bc2rLnqKJIJPT6VhE1BdpCgAhtORy2qJ/ArxqprxtRIB7IH7pixMJZfZWOQPEB+DXG1FSL/AHhj3soB64IINU6evMm8TvLytqEYX6aikkg9D8vlSmomEPcK8hWEYIznuaE0uz4N/cx3R/dQdqdt3+cDkfgUtLZ2LOAr4DPaqbOiDeZrcW4w5cd2Mkq3HiQVBW4Ajl7eX3OOlb3W2yLjMMiPxJSklO9JByDjP0q+2tzIiAlyO27j4k1QfdotvsD7zjEOa9Hkoy64yBhrh6de2P1U2mXmpN2W8wh5Dakjh8UYKh3OKcuKZUpspbitNkjBOT/tHWu3yLfN8xJClpWQnYkqIyeX2oP/2Q==",
                        achieved: true,
                        unlocked: faker.date.recent({days: 10}).getTime(),
                        name: "A Round by the Pond",
                        description: "20 different kinds of fish caught.",
                        id: "ACH_FISHING",
                      },
                    ],
                    rate: {
                      total: 47,
                      achieved: 2 + faker.number.int(45),
                    },
                  },
                ],
                "recently-played": [
                  {
                    id: 1113560,
                    name: "NieR Replicant ver.1.22474487139...",
                    icon:
                      "data:image/jpg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABAAEADASIAAhEBAxEB/8QAHAAAAgIDAQEAAAAAAAAAAAAABgcDBQEECAIA/8QAMBAAAQMDAgUCBgEFAQAAAAAAAQIDBAAFERIhBhMxQVEHYRQiIzJCcRUIJFJigcH/xAAYAQADAQEAAAAAAAAAAAAAAAABAgMABP/EAB8RAAICAwACAwAAAAAAAAAAAAABAhEDEiEEQSIxYf/aAAwDAQACEQMRAD8A6m228CgT1PmN/DtMDd1s6z+jRfebg3abVJnSN2mEa1fqubeKOOBxNcBYoTwTcpaylxfX6Z+0DwaWT9FsMbezNluY5e3Jdpt0hoMqRh94jIx4HvV9ZbVHs0NMa3r5YTuvmb6vcV9Bsjdkt6GorJ0gfMvuVd81aWpUfWEqBKldSqpHV+lhHZCmNTbqSfyFYdjoQgKdSS0fzHQVOuGIriXUk8rqfet55DcVkTYg5jB+9pW9YWynjKkR5BcjFL7H+o3o1tPEbbiEtyxy1dM0K3S2amhMthUjI1AZ2J8YrUtt6DTyBcGg2UnAKhso0U6BKCmi09dLkm3cEvLdUUtuZSrfqKQ/oPbbchM6+SAVzHCUoKznAB2xTj/qVZMn08faQkqdVnTjzQF6dQmWOD4fKQOcjdxI/VNJ0LiXxDNy5FlvXo5jRPzHskeTUciNFmR0vwZCQ71Tg7ZoUeW6J5nWtZkxSdDzIOdGKEo/FlxmcQqZiwHmilWFJ7Y84qd2X1G1br4/8O7BeSEuDrqGc/qpLZc+RJMaUfpObJBPehlm6KU+0uc1yXBsVEdRUvEENu5RNKlrQtr6jC0Kxk1vsDjQfEKjRgw25g5K0at+teNUG5RXTIbCHEjC09/2KHrRc0XaAwlSyHUfTO++1ef5Q2+4FqajY7ax0Ioi6tBd6o2r+QjxtassqUQR2G1IK4sXPh65MXC3zELjh0pcjAbhI710h6gsvOWlHJISkElRPakTxE6yxqclIPwh+Vah296M+MGDsFZZw1CU4LjDQYsh0AOxldFjyBWxHgMc9UlLaQ6vZeBUMN2JCjMhb6dKkhSD3welbLMqDJePwMlLjgGVpT2qTtnSlqZlRfiHmFLwW0KyoeR4qJUpLbHORlbTSjgf+VsPvKDiUspKlDqmhuXJ+HYfLSgVJJOj/I+KMX6Fkm+klhuTFr4mXHQomPJwUgncKO5ovvqorrzSJK0pc/An8vakxeHC1Li3SM5qTHXrUQe/cVf8cX1f8FAfOdThyhwHocU9E2unQ/EUkXO3PvNqKYUdOvmdnD4pK8ZRFOfGW6WOWmUyChRGwB3FP3iRtL1qctkZCUuSRpAA2T7mgj1UtammLNISxzQkhp9SR9oCetPJeyGGdcOd/TG4G7zXbBc1KE2EsqjLUdl74A99qawZgWNouTHWoh/LVjKjSC9WZbNt4nactWuNNbOoqScZHagGVcrlOK3JEyS7k5IU4SKDx7O0Os+q1as6Ru/FYkkpgILLWcKWo/cPY0u+LuNmYrzTMJfMcZOsqB2UT2pdyOILm+xyVu4RpCfl2OKqMkryrJPcmtHHTthyeTaqKDnh3idtiW9FkkqgSDqyo50LO5/5RFd7wzcOCp0DX/cxAXU7/iemKUmQVbZx4qQOuDOHFZIwd+o8GncVdkFmdas//9k=",
                    playtime: faker.number.int(100),
                    played: faker.date.recent({days: 10}).getTime(),
                    description: "The upgraded prequel of NieR:Automata. A kind young man sets out with Grimoire Weiss, a strange talking book, to search for the &quot;Sealed verses&quot; in order to save his sister Yonah, who fell terminally ill to the Black Scrawl.",
                    genres: [
                      "Action",
                      "Adventure",
                      "RPG",
                    ],
                    achievements: [
                      {
                        icon:
                          "data:image/jpg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAgACADASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAwUGBAL/xAAsEAACAgEDAwMDAwUAAAAAAAABAgMEBQAGERIhMSJBUQdhkRMUoRVDUnGz/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/xAAYEQEBAQEBAAAAAAAAAAAAAAABACERMf/aAAwDAQACEQMRAD8AsL+R3Jkd+5LEYnIrSr1Yo2QGFGDcqpJLEE88t4+2rbA08hXQDJ5N70jEDkxIgX/XSBzoWMxpr5vK3XPa08ZUD2CoF/PY6lZs7uaDaW9LmTr16NnHGT9nJGvVwvSCOxPq4DDhu3f21fcJ5a89nb8eKwVqKZ68mTtCoqxlAFLu3Qx6lbn0qPHzrNHlM5S3thcdcumercezDIpVCrGOIOGUhVIIblSD8ffSjIY3LZPZGzYzXS3LjpoLd4GRY1SJULBT1Hu3Qy/Y9/GqLH4dpc7jrP8ASWoVcfLI9UGRWLCVGMh4UkKvUV4HnudXCk+x+XisZ3IYz+9VCNz8hlB/jn+dSP1ZuGrs/dNeM8SW3pRIB5P6pCH/AJnXGWo7mxu/psvhKAvU7CKsimRF6V4UMOGYEN6fPfzphujZ1rPSLPDk7UD8wSiKZ+tVkicsvt7Bm4+CffUOCMYONyd/IboyG344QsVXJdVtyhCrVijjWNAf8pGX8Bu3fVVdz9SvuOhhnk5u3EeQIO5CgE8n8HSXBbZtbeny08Vy1dSy5siL9YiWWXjv1sex5+dI8Bh9yZL6hRbg3Jj4aaVYmihCOpBUhgPDE8+s8nto8Zt//9k=",
                        achieved: true,
                        unlocked: faker.date.recent({days: 10}).getTime(),
                        name: "e8 a8 98 e6 86 b6 e3 82 b5 e3 83 bc e3 83 90 e3 83 bc",
                        description: "",
                        id: "ACHIEVEMENT_0230",
                      },
                      {
                        icon:
                          "data:image/jpg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAgACADASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAABgQFBwP/xAAsEAACAQQBAwIFBAMAAAAAAAABAgMEBQYRABIhMSJBBxMUUaEVIzJhUnGC/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAC/8QAGhEAAwEBAQEAAAAAAAAAAAAAAAERIUExMv/aAAwDAQACEQMRAD8AXZJe7vT5DVJLe1sVvR1hgeeCN4JGIH8pvV0MdghXC/0TxvY6S4UsJ/Urm9fIwBBMSIF/10gb5Gp7LG9wvclZFHPTXAorQyKHR0EYUgg+ffgDNbZk2BWSeuw27O1hh0Xt9SonajUt5iZgT0bIBU9wD7+z9Yi8HGaV60ENKTkMVmknf5MRljV1lc6+4Ovbv4G+/CtFeMnt3xHtljvVfFU09XHI5VIkA0EYqdgAhtr48a4dseE5ZltTb8lya4W2qi6FqKairY2eKRWXYUqmgi999tkHR0eaHHZK2qyS23m809ujq6cMiCjeR+gFWB6mYAMNHQAUd/f244sDWW1vu8VRfbhbN/vUoRt/cMoP43+eTLxQpdLPX2+TulVTyQn/AKUgfnXM9yCgyy3ZrV3fG6GOtiqIgvTI6BV9KgjTMp36B3/vifFbvks88aX/AB40miCZ4qiNl2D/AIhiRzM6hp0+Gc/1Hw7xqQb39BErb9mUdJ/IPJtZfqSmyKgszODW1aNIqDyFAJ2fsPSeVCxX+wYvFQ2e3U1wrIzN8tvniNEBlZkBDaJPSwHkDY88O4xaMpuWd02QZVb4KN6WBoUETp0nYYDQDMd+o8YnWV4f/9k=",
                        achieved: true,
                        unlocked: faker.date.recent({days: 10}).getTime(),
                        name: "Daredevil",
                        description: "",
                        id: "ACHIEVEMENT_0460",
                      },
                    ],
                    rate: {
                      total: 47,
                      achieved: 2 + faker.number.int(45),
                    },
                  },
                ],
              },
            },
          })
          : null),
        //LeetCode
        ...(set.plugins.enabled.leetcode
          ? ({
            leetcode: {
              user: options["leetcode.user"],
              sections: options["leetcode.sections"].split(",").map(x => x.trim()).filter(x => x),
              languages: new Array(6).fill(null).map(_ => ({
                language: faker.hacker.noun(),
                solved: faker.number.int(200),
              })),
              skills: new Array(Number(options["leetcode.limit.skills"]) || 10).fill(null).map(_ => ({
                name: faker.hacker.noun(),
                category: faker.helpers.arrayElement(["advanced", "intermediate", "fundamental"]),
                solved: faker.number.int(30),
              })),
              problems: {
                All: {count: 2402, solved: faker.number.int(2402)},
                Easy: {count: 592, solved: faker.number.int(592)},
                Medium: {count: 1283, solved: faker.number.int(1283)},
                Hard: {count: 527, solved: faker.number.int(527)},
              },
              recent: new Array(Number(options["leetcode.limit.recent"]) || 2).fill(null).map(_ => ({
                title: faker.lorem.sentence(),
                date: faker.date.recent(),
              })),
            },
          })
          : null),
        //Chess
        ...(set.plugins.enabled.chess
          ? ({
            chess: {
              platform: options["chess.platform"] || "(chess platform)",
              meta: {
                Event: "Casual Correspondence game",
                Date: faker.date.recent().toISOString().substring(0, 10),
                White: options["chess.user"],
                Black: faker.internet.userName(),
                WhiteElo: faker.number.int(3000),
                BlackElo: faker.number.int(3000),
              },
              animation: {size: 40, delay: 3, duration: 0.6},
              result: {
                white: faker.number.int(3),
                get black() {
                  return this.white + faker.helpers.arrayElement([-1, +1])
                },
              },
              moves: [
                {color: "w", piece: "p", from: "f2", to: "f4", san: "f4", flags: "b"},
                {color: "b", piece: "p", from: "c7", to: "c5", san: "c5", flags: "b"},
                {color: "w", piece: "p", from: "e2", to: "e4", san: "e4", flags: "b"},
                {color: "b", piece: "p", from: "d7", to: "d6", san: "d6", flags: "n"},
              ],
            },
          })
          : null),
        //Activity
        ...(set.plugins.enabled.activity
          ? ({
            activity: {
              timestamps: options["activity.timestamps"],
              events: new Array(Number(options["activity.limit"])).fill(null).map(_ =>
                [
                  {
                    type: "push",
                    repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    size: 1,
                    branch: "master",
                    commits: [{sha: faker.git.shortSha(), message: faker.lorem.sentence()}],
                    timestamp: faker.date.recent(),
                  },
                  {
                    type: "comment",
                    on: "commit",
                    repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    content: faker.lorem.paragraph(),
                    user: set.user,
                    mobile: null,
                    number: faker.git.shortSha(),
                    title: "",
                    timestamp: faker.date.recent(),
                  },
                  {
                    type: "comment",
                    on: "pr",
                    repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    content: faker.lorem.sentence(),
                    user: set.user,
                    mobile: null,
                    number: faker.number.int(100),
                    title: faker.lorem.sentence(),
                    timestamp: faker.date.recent(),
                  },
                  {
                    type: "comment",
                    on: "issue",
                    repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    content: faker.lorem.sentence(),
                    user: set.user,
                    mobile: null,
                    number: faker.number.int(100),
                    title: faker.lorem.sentence(),
                    timestamp: faker.date.recent(),
                  },
                  {
                    type: "issue",
                    repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    action: faker.helpers.arrayElement(["opened", "closed", "reopened"]),
                    user: set.user,
                    number: faker.number.int(100),
                    title: faker.lorem.sentence(),
                    timestamp: faker.date.recent(),
                  },
                  {
                    type: "pr",
                    repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    action: faker.helpers.arrayElement(["opened", "closed"]),
                    user: set.user,
                    number: faker.number.int(100),
                    title: faker.lorem.sentence(),
                    lines: {added: faker.number.int(1000), deleted: faker.number.int(1000)},
                    files: {changed: faker.number.int(10)},
                    timestamp: faker.date.recent(),
                  },
                  {
                    type: "wiki",
                    repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    pages: [faker.lorem.sentence(), faker.lorem.sentence()],
                    timestamp: faker.date.recent(),
                  },
                  {
                    type: "fork",
                    repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    timestamp: faker.date.recent(),
                  },
                  {
                    type: "review",
                    repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    user: set.user,
                    number: faker.number.int(100),
                    title: faker.lorem.sentence(),
                    timestamp: faker.date.recent(),
                  },
                  {
                    type: "release",
                    repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    action: "published",
                    name: faker.lorem.words(4),
                    draft: faker.datatype.boolean(),
                    prerelease: faker.datatype.boolean(),
                    timestamp: faker.date.recent(),
                  },
                  {
                    type: "ref/create",
                    repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    ref: {name: faker.lorem.slug(), type: faker.helpers.arrayElement(["tag", "branch"])},
                    timestamp: faker.date.recent(),
                  },
                  {
                    type: "ref/delete",
                    repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    ref: {name: faker.lorem.slug(), type: faker.helpers.arrayElement(["tag", "branch"])},
                    timestamp: faker.date.recent(),
                  },
                  {
                    type: "member",
                    repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    user: set.user,
                    timestamp: faker.date.recent(),
                  },
                  {
                    type: "public",
                    repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    timestamp: faker.date.recent(),
                  },
                  {
                    type: "star",
                    repo: `${faker.lorem.word()}/${faker.lorem.word()}`,
                    action: "started",
                    timestamp: faker.date.recent(),
                  },
                ][Math.floor(Math.random() * 15)]
              ),
            },
          })
          : null),
        //Isocalendar
        ...(set.plugins.enabled.isocalendar
          ? ({
            isocalendar: {
              streak: {max: 30 + faker.number.int(20), current: faker.number.int(30)},
              max: 10 + faker.number.int(40),
              average: faker.number.float(10),
              svg: await staticPlaceholder(set.plugins.enabled.isocalendar, `isocalendar.${options["isocalendar.duration"]}.svg`),
              duration: options["isocalendar.duration"],
            },
          })
          : null),
        //Calendar
        ...(set.plugins.enabled.calendar
          ? ({
            calendar: {
              years: new Array(options["calendar.years"] || 2).fill(0).map((_, index) => ({
                year: new Date().getFullYear() - index,
                weeks: new Array(53).fill(0).map(() => ({
                  contributionDays: new Array(7).fill(0).map(() => ({
                    contributionCount: faker.number.int(10),
                    color: faker.helpers.arrayElement(["#ebedf0", "#ebedf0", "#ebedf0", "#ebedf0", "#ebedf0", "#ebedf0", "#9be9a8", "#9be9a8", "#9be9a8", "#40c463", "#40c463", "#30a14e", "#216e39"]),
                    date: faker.date.past({years: 1}),
                  })),
                })),
              })),
            },
          })
          : null),
        //Support
        ...(set.plugins.enabled.support
          ? ({
            support: {
              stats: {solutions: faker.number.int(100), posts: faker.number.int(1000), topics: faker.number.int(1000), received: faker.number.int(1000), hearts: faker.number.int(1000)},
              badges: {uniques: [], multiples: [], count: faker.number.int(1000)},
            },
          })
          : null),
        //Screenshot
        ...(set.plugins.enabled.screenshot
          ? ({
            screenshot: {
              image: "/.placeholders/screenshot.png",
              title: options["screenshot.title"],
              height: 440,
              width: 454,
            },
          })
          : null),
        //Skyline
        ...(set.plugins.enabled.skyline
          ? ({
            skyline: {
              animation: "/.placeholders/skyline.png",
              width: 454,
              height: 284,
              compatibility: false,
            },
          })
          : null),
        //Stackoverflow
        ...(set.plugins.enabled.stackoverflow
          ? ({
            stackoverflow: {
              sections: options["stackoverflow.sections"].split(",").map(x => x.trim()).filter(x => x),
              lines: options["stackoverflow.lines"],
              user: {
                reputation: faker.number.int(100000),
                badges: faker.number.int(1000),
                questions: faker.number.int(1000),
                answers: faker.number.int(1000),
                comments: faker.number.int(1000),
                views: faker.number.int(1000),
              },
              "answers-top": new Array(options["stackoverflow.limit"]).fill(null).map(_ => ({
                type: "answer",
                body: faker.lorem.paragraphs(),
                score: faker.number.int(1000),
                upvotes: faker.number.int(1000),
                downvotes: faker.number.int(1000),
                accepted: faker.datatype.boolean(),
                comments: faker.number.int(1000),
                author: set.user,
                created: "01/01/1970",
                link: null,
                id: faker.number.int(100000),
                question_id: faker.number.int(100000),
                question: {
                  title: faker.lorem.sentence(),
                  tags: [faker.lorem.slug(), faker.lorem.slug()],
                },
              })),
              get ["answers-recent"]() {
                return this["answers-top"]
              },
              "questions-top": new Array(options["stackoverflow.limit"]).fill(null).map(_ => ({
                type: "question",
                title: faker.lorem.sentence(),
                body: faker.lorem.paragraphs(),
                score: faker.number.int(1000),
                upvotes: faker.number.int(1000),
                downvotes: faker.number.int(1000),
                favorites: faker.number.int(1000),
                tags: [faker.lorem.slug(), faker.lorem.slug()],
                answered: faker.datatype.boolean(),
                answers: faker.number.int(1000),
                comments: faker.number.int(1000),
                views: faker.number.int(1000),
                author: set.user,
                created: "01/01/1970",
                link: null,
                id: faker.number.int(100000),
                accepted_answer_id: faker.number.int(100000),
                answer: null,
              })),
              get ["questions-recent"]() {
                return this["questions-top"]
              },
            },
          })
          : null),
      },
    }
    //Formatters
    data.f.bytes = function(n) {
      for (const {u, v} of [{u: "E", v: 10 ** 18}, {u: "P", v: 10 ** 15}, {u: "T", v: 10 ** 12}, {u: "G", v: 10 ** 9}, {u: "M", v: 10 ** 6}, {u: "k", v: 10 ** 3}]) {
        if (n / v >= 1)
          return `${(n / v).toFixed(2).substr(0, 4).replace(/[.]0*$/, "")} ${u}B`
      }
      return `${n} byte${n > 1 ? "s" : ""}`
    }
    data.f.percentage = function(n, {rescale = true} = {}) {
      return `${
        (n * (rescale ? 100 : 1)).toFixed(2)
          .replace(/[.]([1-9]*)(0+)$/, (m, a, b) => `.${a}`)
          .replace(/[.]$/, "")
      }%`
    }
    data.f.ellipsis = function(text, {length = 20} = {}) {
      text = `${text}`
      if (text.length < length)
        return text
      return `${text.substring(0, length)}‚Ä¶`
    }
    data.f.date = function(string, options) {
      if (options.date) {
        delete options.date
        Object.assign(options, {day: "numeric", month: "short", year: "numeric"})
      }
      if (options.time) {
        delete options.time
        Object.assign(options, {hour: "2-digit", minute: "2-digit", second: "2-digit"})
      }
      return new Intl.DateTimeFormat("en-GB", options).format(new Date(string))
    }
    data.f.license = function(text) {
      return text?.name ?? text
    }
    //Render
    return await ejs.render(image, data, {async: true, rmWhitespace: true})
  }
  //Reset globals contexts
  globalThis.placeholder.init = function(globals) {
    axios = globals.axios || axios
    faker = globals.faker || faker
    ejs = globals.ejs || ejs
  }
})()
</file>

<file path="source/plugins/lines/index.mjs">
//Setup
export default async function({login, data, imports, rest, q, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.lines) || (!imports.metadata.plugins.lines.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {skipped, sections, "repositories.limit": _repositories_limit, "history.limit": _history_limit, delay} = imports.metadata.plugins.lines.inputs({data, account, q})
    skipped.push(...data.shared["repositories.skipped"])

    //Context
    let context = {mode: "user"}
    if (data.account)
      context = {...context, mode: "organization"}
    else if (q.repo) {
      console.debug(`metrics/compute/${login}/plugins > people > switched to repository mode`)
      context = {...context, mode: "repository"}
    }

    //Repositories
    const repositories = data.user.repositories.nodes.map(({name: repo, owner: {login: owner}}) => ({repo, owner})).sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt)) ?? []

    //Get contributors stats from repositories
    console.debug(`metrics/compute/${login}/plugins > lines > querying api`)
    const repos = {}, weeks = {}
    let response = []
    for (let i = 0; i < (delay ? 2 : 1); i++) {
      response = [...await Promise.allSettled(repositories.map(async ({repo, owner}) => imports.filters.repo(`${owner}/${repo}`, skipped) ? {handle: `${owner}/${repo}`, stats: (await rest.repos.getContributorsStats({owner, repo})).data} : {}))].filter(({status}) => status === "fulfilled").map((
        {value},
      ) => value)
      if ((delay) && (!i)) {
        console.debug(`metrics/compute/${login}/plugins > lines > waiting ${delay}s while waiting for contributor stats to be updated`)
        await new Promise(resolve => setTimeout(resolve, delay * 1000))
      }
    }

    //Compute changed lines
    console.debug(`metrics/compute/${login}/plugins > lines > computing total diff`)
    response.map(({handle, stats}) => {
      //Check if data are available
      if (!Array.isArray(stats))
        return
      //Compute changes
      repos[handle] = {added: 0, deleted: 0, changed: 0}
      const contributors = stats.filter(({author}) => (context.mode === "repository") || (context.mode === "organization") ? true : author?.login?.toLocaleLowerCase() === login.toLocaleLowerCase())
      for (const contributor of contributors) {
        let added = 0, changed = 0, deleted = 0
        contributor.weeks.forEach(({a = 0, d = 0, c = 0, w}) => {
          added += a
          deleted += d
          changed += c
          //Compute changes per week
          const date = new Date(w * 1000).toISOString().substring(0, 10)
          if (!weeks[date])
            weeks[date] = {added: 0, deleted: 0, changed: 0}
          weeks[date].added += a
          weeks[date].deleted += d
          weeks[date].changed += c
        })
        console.debug(`metrics/compute/${login}/plugins > lines > ${handle}: @${contributor.author.login} +${added} -${deleted} ~${changed}`)
        repos[handle].added += added
        repos[handle].deleted += deleted
        repos[handle].changed += changed
      }
    })

    //Results
    const result = {
      sections,
      added: Object.entries(repos).map(([_, {added}]) => added).reduce((a, b) => a + b, 0),
      deleted: Object.entries(repos).map(([_, {deleted}]) => deleted).reduce((a, b) => a + b, 0),
      changed: Object.entries(repos).map(([_, {changed}]) => changed).reduce((a, b) => a + b, 0),
      repos: Object.entries(repos).map(([handle, stats]) => ({handle, ...stats})).sort((a, b) => (b.added + b.deleted + b.changed) - (a.added + a.deleted + a.changed)).slice(0, _repositories_limit),
      weeks: Object.entries(weeks).map(([date, stats]) => ({date, ...stats})).filter(({added, deleted, changed}) => added + deleted + changed).sort((a, b) => new Date(a.date) - new Date(b.date)),
    }

    //Diff graphs
    if (sections.includes("history")) {
      const weeks = result.weeks.filter(({date}) => !_history_limit ? true : new Date(date) > new Date(new Date().getFullYear() - _history_limit, 0, 0))
      if (weeks.length) {
        //Generate SVG
        const height = 315, width = 480
        const margin = 5, offset = 34
        const {d3} = imports
        const d3n = new imports.D3node()
        const svg = d3n.createSVG(width, height)

        //Time range
        const start = new Date(weeks.at(0).date)
        const end = new Date(weeks.at(-1).date)
        const x = d3.scaleTime()
          .domain([start, end])
          .range([margin + offset, width - (offset + margin)])
        svg.append("g")
          .attr("transform", `translate(0,${height - (offset + margin)})`)
          .call(d3.axisBottom(x))
          .selectAll("text")
          .attr("transform", "translate(-5,5) rotate(-45)")
          .style("text-anchor", "end")
          .style("font-size", 20)

        //Diff range
        const points = weeks.flatMap(({added, deleted, changed}) => [added + changed, deleted + changed])
        const extremum = Math.max(...points)
        const y = d3.scaleLinear()
          .domain([extremum, -extremum])
          .range([margin, height - (offset + margin)])
        svg.append("g")
          .attr("transform", `translate(${margin + offset},0)`)
          .call(d3.axisLeft(y).ticks(7).tickFormat(d3.format(".2s")))
          .selectAll("text")
          .style("font-size", 20)

        //Generate history
        for (const {type, sign, fill} of [{type: "added", sign: +1, fill: "rgb(63, 185, 80)"}, {type: "deleted", sign: -1, fill: "rgb(218, 54, 51)"}]) {
          svg.append("path")
            .datum(weeks.map(({date, ...diff}) => [new Date(date), sign * (diff[type] + diff.changed)]))
            .attr(
              "d",
              d3.area()
                .x(d => x(d[0]))
                .y0(d => y(d[1]))
                .y1(() => y(0)),
            )
            .attr("fill", fill)
        }
        result.history = d3n.svgString()
      }
      else {
        console.debug(`metrics/compute/${login}/plugins > lines > no history data`)
        result.history = null
      }
    }

    //Results
    return result
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}
</file>

<file path="tests/mocks/index.mjs">
//Imports
import { faker } from "@faker-js/faker"
import { Client as Gmap } from "@googlemaps/google-maps-services-js"
import axios from "axios"
import fs from "fs/promises"
import paths from "path"
import rss from "rss-parser"
import urls from "url"

//Mocked state
let mocked = false

//Mocking
export default async function({graphql, rest}) {
  //Check if already mocked
  if (mocked)
    return {graphql, rest}
  mocked = true
  process.env.METRICS_MOCKED = true
  console.debug("metrics/compute/mocks > mocking")

  //Load mocks
  const __mocks = paths.join(paths.dirname(urls.fileURLToPath(import.meta.url)))
  const mock = async ({directory, mocks}) => {
    for (const entry of await fs.readdir(directory)) {
      if ((await fs.lstat(paths.join(directory, entry))).isDirectory()) {
        if (!mocks[entry])
          mocks[entry] = {}
        await mock({directory: paths.join(directory, entry), mocks: mocks[entry]})
      }
      else {
        mocks[entry.replace(/[.]mjs$/, "")] = (await import(urls.pathToFileURL(paths.join(directory, entry)).href)).default
      }
    }
    return mocks
  }
  const mocks = await mock({directory: paths.join(__mocks, "api"), mocks: {}})

  //GraphQL API mocking
  {
    //Unmocked
    console.debug("metrics/compute/mocks > mocking graphql api")
    const unmocked = graphql
    //Mocked
    graphql = new Proxy(unmocked, {
      apply(target, that, args) {
        //Arguments
        const [query] = args
        const login = query.match(/login: "(?<login>.*?)"/)?.groups?.login ?? faker.internet.userName()

        //Search for mocked query
        for (const mocked of Object.keys(mocks.github.graphql)) {
          if (new RegExp(`^query ${mocked.replace(/([.]\w)/g, (_, g) => g.toLocaleUpperCase().substring(1)).replace(/^(\w)/g, (_, g) => g.toLocaleUpperCase())} `).test(query))
            return mocks.github.graphql[mocked]({faker, query, login})
        }

        //Unmocked call
        return target(...args)
      },
    })
  }

  //Rest API mocking
  {
    //Unmocked
    console.debug("metrics/compute/mocks > mocking rest api")
    const unmocked = rest

    //Mocked
    rest = new Proxy(unmocked, {
      get(target, section) {
        if (Reflect.has(mocks.github.rest, section)) {
          return new Proxy(target[section], {
            get(target, property) {
              if (mocks.github.rest?.[section]?.[property]) {
                return async function() {
                  console.debug(`metrics/mocking > rest.${section}.${property}`)
                  return mocks.github.rest[section][property]({faker}, target, null, arguments)
                }
              }
              return Reflect.get(target, property)
            },
          })
        }
        return Reflect.get(target, section)
      },
    })
  }

  //Axios mocking
  {
    //Unmocked
    console.debug("metrics/compute/mocks > mocking axios")
    const unmocked = {get: axios.get, post: axios.post}

    //Mocked post requests
    axios.post = new Proxy(unmocked.post, {
      apply(target, that, args) {
        //Arguments
        const [url, body] = args

        //Search for mocked request
        for (const service of Object.keys(mocks.axios.post)) {
          const mocked = mocks.axios.post[service]({faker, url, body})
          if (mocked)
            return mocked
        }

        //Unmocked call
        return target(...args)
      },
    })

    //Mocked get requests
    axios.get = new Proxy(unmocked.get, {
      apply(target, that, args) {
        //Arguments
        const [url, options] = args

        //Search for mocked request
        for (const service of Object.keys(mocks.axios.get)) {
          const mocked = mocks.axios.get[service]({faker, url, options})
          if (mocked)
            return mocked
        }

        //Unmocked call
        return target(...args)
      },
    })
  }

  //RSS mocking
  {
    //Unmocked
    console.debug("metrics/compute/mocks > mocking rss-parser")

    //Mock rss feed
    rss.prototype.parseURL = function(url) {
      console.debug(`metrics/compute/mocks > mocking rss feed result > ${url}`)
      return ({
        items: new Array(30).fill(null).map(_ => ({
          title: faker.lorem.sentence(),
          link: faker.internet.url(),
          content: faker.lorem.paragraphs(),
          contentSnippet: faker.lorem.paragraph(),
          isoDate: faker.date.recent(),
        })),
        title: faker.lorem.words(),
        description: faker.lorem.paragraph(),
        link: url,
      })
    }
  }

  //Google API mocking
  {
    //Unmocked
    console.debug("metrics/compute/mocks > mocking google-maps-services-js")

    //Mock geocode API
    Gmap.prototype.geocode = function() {
      console.debug("metrics/compute/mocks > mocking google maps geocode result")
      const lat = faker.location.latitude()
      const lng = faker.location.longitude()
      const city = faker.location.city()
      const country = faker.location.country()
      return {
        data: {
          results: [
            {
              address_components: [
                {
                  long_name: city,
                  short_name: city,
                  types: ["political"],
                },
                {
                  long_name: country,
                  short_name: faker.location.countryCode(),
                  types: ["country", "political"],
                },
              ],
              formatted_address: `${city}, ${country}`,
              geometry: {
                bounds: {
                  northeast: {lat, lng},
                  southwest: {lat, lng},
                },
                location: {lat, lng},
                location_type: "APPROXIMATE",
                viewport: {
                  northeast: {lat, lng},
                  southwest: {lat, lng},
                },
              },
              place_id: "ChIJu9FC7RXupzsR26dsAapFLgg",
              types: ["locality", "political"],
            },
          ],
        },
      }
    }
  }

  //Return mocked elements
  return {graphql, rest}
}
</file>

<file path=".github/workflows/examples.yml">
# THIS WORKFLOW IS AUTO-GENERATED
name: Publish examples
on:
  schedule:
    - cron: "0 8 1/2 * *"
  workflow_dispatch:
  workflow_call:
    secrets:
      METRICS_TOKEN:
        required: true
      METRICS_TOKEN_WITH_SCOPES:
        required: true
      METRICS_TOKEN_PERSONAL:
        required: true
      CHESS_TOKEN:
        required: true
      PAGESPEED_TOKEN:
        required: true
      GOOGLE_MAP_TOKEN:
        required: true
      SPLATOON_TOKEN:
        required: true
      SPLATOON_STATINK_TOKEN:
        required: true
      SIXTEEN_PERSONALITIES_URL:
        required: true
      SPOTIFY_TOKENS:
        required: true
      STOCK_TOKEN:
        required: true
      TWITTER_TOKEN:
        required: true
      WAKATIME_TOKEN:
        required: true
jobs:

# ======================================================================================
# Examples renders
# ======================================================================================

  examples:
    runs-on: ubuntu-latest
    if: "github.repository == 'lowlighter/metrics'"
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Checkout examples
        run: git checkout examples

      - name: üóÉÔ∏è Base content - Default metrics
        uses: lowlighter/metrics@master
        with:
          filename: metrics.base.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: header, activity, community, repositories, metadata
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üß± Core - Organization
        uses: lowlighter/metrics@master
        with:
          filename: metrics.organization.svg
          user: github
          token: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}
          base: header, repositories
          output_action: none
          delay: 120
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üß± Core - Large display
        uses: lowlighter/metrics@master
        with:
          filename: metrics.large.svg
          token: ${{ secrets.METRICS_TOKEN }}
          config_display: large
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üß± Core - JSON metrics
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@master
        with:
          filename: metrics.example.json
          token: ${{ secrets.METRICS_TOKEN }}
          config_output: json
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
      - name: üß± Core - PNG metrics
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@master
        with:
          filename: metrics.example.png
          token: ${{ secrets.METRICS_TOKEN }}
          config_output: png
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
      - name: üß± Core - Metrics insights
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@master
        with:
          filename: metrics.insights.html
          token: ${{ secrets.METRICS_TOKEN }}
          config_output: insights
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
      - name: üß± Core - Plugin error example
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.error.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_projects: yes
          plugins_errors_fatal: no
          output_action: none
          delay: 120
          user: lowlighter
        if: ${{ success() || failure() }}
      - name: üìÖ Isometric commit calendar - Half-year calendar
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.isocalendar.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_isocalendar: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìÖ Isometric commit calendar - Full-year calendar
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.isocalendar.fullyear.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_isocalendar: yes
          plugin_isocalendar_duration: full-year
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üà∑Ô∏è Languages activity - Most used
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.languages.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_languages: yes
          plugin_languages_ignored: >-
            html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell,
            gnuplot
          plugin_languages_limit: 4
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üà∑Ô∏è Languages activity - Most used (with details)
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.languages.details.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_languages: yes
          plugin_languages_ignored: >-
            html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell,
            gnuplot
          plugin_languages_details: bytes-size, percentage
          plugin_languages_limit: 4
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üà∑Ô∏è Languages activity - Recently used
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.languages.recent.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_languages: yes
          plugin_languages_ignored: >-
            html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell,
            gnuplot
          plugin_languages_sections: recently-used
          plugin_languages_details: bytes-size, percentage
          plugin_languages_limit: 4
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üà∑Ô∏è Languages activity - Indepth analysis
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.languages.indepth.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_languages: yes
          plugin_languages_ignored: >-
            html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell,
            gnuplot
          plugin_languages_indepth: yes
          plugin_languages_details: lines, bytes-size
          plugin_languages_limit: 4
          plugin_languages_analysis_timeout: 15
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: ‚ú® Stargazers - Using classic charts
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.stargazers.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_stargazers: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: ‚ú® Stargazers - Using graph charts
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.stargazers.graph.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_stargazers: yes
          plugin_stargazers_charts_type: graph
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: ‚ú® Stargazers - With worldmap
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.stargazers.worldmap.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_stargazers: yes
          plugin_stargazers_charts: no
          plugin_stargazers_worldmap: yes
          plugin_stargazers_worldmap_token: ${{ secrets.GOOGLE_MAP_TOKEN }}
          plugin_stargazers_worldmap_sample: 200
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üë®‚Äçüíª Lines of code changed - Compact display in base plugin
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.lines.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: repositories
          plugin_lines: yes
          plugin_lines_delay: 30
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üë®‚Äçüíª Lines of code changed - Repositories and diff history
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.lines.history.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_lines: yes
          plugin_lines_delay: 30
          plugin_lines_sections: repositories, history
          plugin_lines_repositories_limit: 2
          plugin_lines_history_limit: 1
          repositories_skipped: |
            @use.patterns
            */*
            +lowlighter/metrics
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìå Starred topics - Labels
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.topics.svg
          token: NOT_NEEDED
          base: ""
          plugin_topics: yes
          plugin_topics_limit: 12
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìå Starred topics - Icons
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.topics.icons.svg
          token: NOT_NEEDED
          base: ""
          plugin_topics: yes
          plugin_topics_limit: 0
          plugin_topics_mode: icons
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üåü Recently starred repositories - Recently starred
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.stars.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_stars: yes
          plugin_stars_limit: 3
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìú Repository licenses - Licenses and permissions
        with:
          filename: metrics.plugin.licenses.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          template: repository
          repo: metrics
          plugin_licenses: yes
          plugin_licenses_setup: bash -c '[[ -f package.json ]] && npm ci || true'
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@master
      - name: üìú Repository licenses - Licenses with open-source ratio graphs
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.licenses.ratio.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          template: repository
          repo: metrics
          plugin_licenses: yes
          plugin_licenses_setup: bash -c '[[ -f package.json ]] && npm ci || true'
          plugin_licenses_legal: no
          plugin_licenses_ratio: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üí° Coding habits and activity - Mildly interesting facts
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.habits.facts.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_habits: yes
          plugin_habits_facts: yes
          plugin_habits_charts: no
          config_timezone: Europe/Paris
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üí° Coding habits and activity - Recent activity charts
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.habits.charts.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_habits: yes
          plugin_habits_facts: no
          plugin_habits_charts: yes
          config_timezone: Europe/Paris
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üèÖ Repository contributors - Contributors with contributions count
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.contributors.contributions.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          template: repository
          repo: metrics
          plugin_contributors: yes
          plugin_contributors_contributions: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üèÖ Repository contributors - Contributors by categories
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.contributors.categories.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          template: repository
          repo: metrics
          plugin_contributors: yes
          plugin_contributors_sections: categories
          plugin_contributors_categories: |
            {
              "üß© Plugins / üñºÔ∏è templates":["source/plugins/**", "source/templates/**"],
              "üìö Documentation":["README.md", "**/README.md", "**/metadata.yml"],
              "üíª Code (other)":["source/**", "Dockerfile"]
            }
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üéüÔ∏è Follow-up of issues and pull requests - Opened on user's repositories
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.followup.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_followup: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üéüÔ∏è Follow-up of issues and pull requests - Opened by user
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.followup.user.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_followup: yes
          plugin_followup_sections: user
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üéüÔ∏è Follow-up of issues and pull requests - Indepth analysis
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.followup.indepth.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_followup: yes
          plugin_followup_indepth: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üé≠ Comment reactions - Comment reactions
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.reactions.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_reactions: yes
          plugin_reactions_limit: 100
          plugin_reactions_details: percentage
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üßë‚Äçü§ù‚Äçüßë People - Followers
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.people.followers.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_people: yes
          plugin_people_types: followers
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üßë‚Äçü§ù‚Äçüßë People - Contributors and sponsors
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.people.repository.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          template: repository
          repo: metrics
          plugin_people: yes
          plugin_people_types: contributors, stargazers, watchers, sponsors
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üíù GitHub Sponsorships - üíù GitHub Sponsorships
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.sponsorships.svg
          token: ${{ secrets.METRICS_TOKEN_PERSONAL }}
          base: ""
          plugin_sponsorships: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üíï GitHub Sponsors - Sponsors goal
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.sponsors.svg
          token: ${{ secrets.METRICS_TOKEN_PERSONAL }}
          base: ""
          plugin_sponsors: yes
          plugin_sponsors_sections: goal, list
          plugin_sponsors_past: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üíï GitHub Sponsors - Sponsors introduction
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.sponsors.full.svg
          token: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}
          base: ""
          plugin_sponsors: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìì Featured repositories - Featured repositories
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.repositories.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_repositories: yes
          plugin_repositories_featured: lowlighter/metrics
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìì Featured repositories - Pinned repositories
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.repositories.pinned.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_repositories: yes
          plugin_repositories_pinned: 2
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üí¨ Discussions - GitHub Discussions
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.discussions.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_discussions: yes
          plugin_discussions_categories_limit: 8
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üí´ Star lists - Featured star list
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.starlists.svg
          token: NOT_NEEDED
          base: ""
          plugin_starlists: yes
          plugin_starlists_limit_repositories: 2
          plugin_starlists_only: TC39
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üí´ Star lists - Featured star list languages
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.starlists.languages.svg
          token: NOT_NEEDED
          base: ""
          plugin_starlists: yes
          plugin_starlists_languages: yes
          plugin_starlists_limit_languages: 8
          plugin_starlists_limit_repositories: 0
          plugin_starlists_only: Awesome
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìÜ Commit calendar - Current year calendar
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.calendar.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_calendar: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìÜ Commit calendar - Full history calendar
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.calendar.full.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_calendar: yes
          plugin_calendar_limit: 0
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üèÜ Achievements - Detailed display
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.achievements.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_achievements: yes
          plugin_achievements_only: sponsor, maintainer, octonaut
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üèÜ Achievements - Compact display
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.achievements.compact.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_achievements: yes
          plugin_achievements_only: >-
            polyglot, stargazer, sponsor, deployer, member, maintainer, developer,
            scripter, packager, explorer, infographile, manager
          plugin_achievements_display: compact
          plugin_achievements_threshold: X
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üé© Notable contributions - Contributions
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.notable.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_notable: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üé© Notable contributions - Indepth analysis
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.notable.indepth.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_notable: yes
          plugin_notable_indepth: yes
          plugin_notable_repositories: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üì∞ Recent activity - Recent activity
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.activity.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_activity: yes
          plugin_activity_limit: 5
          plugin_activity_days: 0
          plugin_activity_filter: issue, pr, release, fork, review, ref/create
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üßÆ Repositories traffic - Repositories traffic
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.traffic.svg
          token: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}
          base: repositories
          plugin_traffic: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: ‚ôê Random code snippet - JavaScript or TypeScript snippet of the day
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.code.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_code: yes
          plugin_code_languages: javascript, typescript
          plugin_code_load: 400
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üé´ Gists - Gists
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.gists.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_gists: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üóÇÔ∏è GitHub projects - Project from a repository
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.projects.svg
          token: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}
          base: ""
          plugin_projects: yes
          plugin_projects_repositories: lowlighter/metrics/projects/1
          plugin_projects_descriptions: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üôã Introduction - Organization introduction
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.introduction.svg
          token: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}
          user: github
          base: header
          plugin_introduction: yes
          output_action: none
          delay: 120
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üôã Introduction - Repository introduction
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.introduction.repository.svg
          token: ${{ secrets.METRICS_TOKEN }}
          template: repository
          repo: metrics
          base: header
          plugin_introduction: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: ‚è±Ô∏è Google PageSpeed - Succinct report
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.pagespeed.svg
          token: NOT_NEEDED
          base: ""
          plugin_pagespeed: yes
          plugin_pagespeed_token: ${{ secrets.PAGESPEED_TOKEN }}
          plugin_pagespeed_url: https://lecoq.io
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: ‚è±Ô∏è Google PageSpeed - Detailed report
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.pagespeed.detailed.svg
          token: NOT_NEEDED
          base: ""
          plugin_pagespeed: yes
          plugin_pagespeed_detailed: yes
          plugin_pagespeed_token: ${{ secrets.PAGESPEED_TOKEN }}
          plugin_pagespeed_url: https://lecoq.io
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: ‚è±Ô∏è Google PageSpeed - Screenshot
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.pagespeed.screenshot.svg
          token: NOT_NEEDED
          base: ""
          plugin_pagespeed: yes
          plugin_pagespeed_screenshot: yes
          plugin_pagespeed_token: ${{ secrets.PAGESPEED_TOKEN }}
          plugin_pagespeed_url: https://lecoq.io
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üó®Ô∏è Stack Overflow - Top answers from stackoverflow
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.stackoverflow.svg
          token: NOT_NEEDED
          base: ""
          plugin_stackoverflow: yes
          plugin_stackoverflow_user: 1
          plugin_stackoverflow_sections: answers-top
          plugin_stackoverflow_limit: 2
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: >-
          üå∏ Anilist watch list and reading list - Favorites anime and currently
          watching
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.anilist.svg
          token: NOT_NEEDED
          base: ""
          plugin_anilist: yes
          plugin_anilist_medias: anime
          plugin_anilist_sections: favorites, watching
          plugin_anilist_limit: 1
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: >-
          üå∏ Anilist watch list and reading list - Favorites manga and currently
          reading
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.anilist.manga.svg
          token: NOT_NEEDED
          base: ""
          plugin_anilist: yes
          plugin_anilist_medias: manga
          plugin_anilist_sections: favorites, reading
          plugin_anilist_limit: 1
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üå∏ Anilist watch list and reading list - Favorites characters
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.anilist.characters.svg
          token: NOT_NEEDED
          base: ""
          plugin_anilist: yes
          plugin_anilist_sections: characters
          plugin_anilist_limit_characters: 22
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üéº Music activity and suggestions - Apple Music - Random track from playlist
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.music.playlist.svg
          token: NOT_NEEDED
          base: ""
          plugin_music: yes
          plugin_music_playlist: https://embed.music.apple.com/fr/playlist/usr-share/pl.u-V9D7m8Etjmjd0D
          plugin_music_limit: 2
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üéº Music activity and suggestions - Spotify - Random track from playlist
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.music.playlist.spotify.svg
          token: NOT_NEEDED
          base: ""
          plugin_music: yes
          plugin_music_playlist: https://open.spotify.com/embed/playlist/3nfA87oeJw4LFVcUDjRcqi
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üéº Music activity and suggestions - Spotify - Recently listed
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.music.recent.svg
          token: NOT_NEEDED
          base: ""
          plugin_music: yes
          plugin_music_provider: spotify
          plugin_music_mode: recent
          plugin_music_token: ${{ secrets.SPOTIFY_TOKENS }}
          plugin_music_limit: 2
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üéº Music activity and suggestions - Spotify - Top tracks
        uses: lowlighter/metrics@master
        with:
          token: NOT_NEEDED
          base: ""
          plugin_music: yes
          plugin_music_mode: top
          plugin_music_provider: spotify
          plugin_music_token: ${{ secrets.SPOTIFY_TOKENS }}
          plugin_music_time_range: short
          plugin_music_top_type: tracks
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üéº Music activity and suggestions - Spotify - Top artists
        uses: lowlighter/metrics@master
        with:
          token: NOT_NEEDED
          base: ""
          plugin_music: yes
          plugin_music_mode: top
          plugin_music_provider: spotify
          plugin_music_token: ${{ secrets.SPOTIFY_TOKENS }}
          plugin_music_time_range: long
          plugin_music_top_type: artists
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: >-
          üéº Music activity and suggestions - Youtube Music - Random track from
          playlist
        uses: lowlighter/metrics@master
        with:
          token: NOT_NEEDED
          base: ""
          plugin_music: yes
          plugin_music_playlist: >-
            https://music.youtube.com/playlist?list=OLAK5uy_kU_uxp9TUOl9zVdw77xith8o9AknVwz9U
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: ‚úíÔ∏è Recent posts - Recent posts
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.posts.svg
          token: NOT_NEEDED
          base: ""
          plugin_posts: yes
          plugin_posts_source: dev.to
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: ‚úíÔ∏è Recent posts - Recent posts with descriptions and cover images
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.posts.full.svg
          token: NOT_NEEDED
          base: ""
          plugin_posts: yes
          plugin_posts_source: dev.to
          plugin_posts_limit: 2
          plugin_posts_descriptions: yes
          plugin_posts_covers: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üóº Rss feed - News from hackernews
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.rss.svg
          token: NOT_NEEDED
          base: ""
          plugin_rss: yes
          plugin_rss_source: https://news.ycombinator.com/rss
          plugin_rss_limit: 4
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: ‚è∞ WakaTime - WakaTime
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.wakatime.svg
          token: NOT_NEEDED
          base: ""
          plugin_wakatime: yes
          plugin_wakatime_sections: time, projects, projects-graphs, languages, languages-graphs, editors, os
          plugin_wakatime_token: MOCKED_TOKEN
          use_mocked_data: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üó≥Ô∏è Leetcode - LeetCode
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.leetcode.svg
          token: NOT_NEEDED
          base: ""
          plugin_leetcode: yes
          plugin_leetcode_sections: solved, skills, recent
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üïπÔ∏è Steam - Recently played games
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.steam.svg
          token: NOT_NEEDED
          base: ""
          plugin_steam_token: MOCKED_TOKEN
          plugin_steam: yes
          plugin_steam_user: "0"
          plugin_steam_sections: recently-played
          plugin_steam_achievements_limit: 0
          use_mocked_data: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üïπÔ∏è Steam - Profile and detailed game history
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.steam.full.svg
          token: NOT_NEEDED
          base: ""
          plugin_steam_token: MOCKED_TOKEN
          plugin_steam: yes
          plugin_steam_user: "0"
          use_mocked_data: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üß† 16personalities - MBTI Personality profile
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.16personalities.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_16personalities: yes
          plugin_16personalities_url: ${{ secrets.SIXTEEN_PERSONALITIES_URL }}
          plugin_16personalities_sections: personality, traits
          plugin_16personalities_scores: no
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: ‚ôüÔ∏è Chess - Last chess game from lichess.org
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.chess.svg
          token: NOT_NEEDED
          base: ""
          plugin_chess: yes
          plugin_chess_token: ${{ secrets.CHESS_TOKEN }}
          plugin_chess_platform: lichess.org
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: ü•† Fortune - Fortune
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.fortune.svg
          token: NOT_NEEDED
          base: ""
          plugin_fortune: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üì∏ Website screenshot - XKCD of the day
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.screenshot.svg
          token: NOT_NEEDED
          base: ""
          plugin_screenshot: yes
          plugin_screenshot_title: XKCD of the day
          plugin_screenshot_url: https://xkcd.com
          plugin_screenshot_selector: "#comic img"
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üíπ Stock prices - Stock prices from Tesla
        uses: lowlighter/metrics@master
        with:
          filename: metrics.plugin.stock.svg
          token: NOT_NEEDED
          base: ""
          plugin_stock: yes
          plugin_stock_token: ${{ secrets.STOCK_TOKEN }}
          plugin_stock_symbol: TSLA
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìó Classic template - Example
        uses: lowlighter/metrics@master
        with:
          filename: metrics.classic.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: header, repositories
          plugin_lines: yes
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìò Repository template - Example
        uses: lowlighter/metrics@master
        with:
          template: repository
          filename: metrics.repository.svg
          token: ${{ secrets.METRICS_TOKEN_WITH_SCOPES }}
          user: lowlighter
          repo: metrics
          plugin_lines: yes
          plugin_followup: yes
          plugin_projects: yes
          plugin_projects_repositories: lowlighter/metrics/projects/1
          output_action: none
          delay: 120
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìô Terminal template - Example
        uses: lowlighter/metrics@master
        with:
          template: terminal
          filename: metrics.terminal.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: header, metadata
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìí Markdown template - Example
        uses: lowlighter/metrics@master
        with:
          template: markdown
          filename: metrics.markdown.md
          markdown: >-
            https://raw.githubusercontent.com/lowlighter/metrics/examples/metrics.markdown.template.md
          config_output: markdown
          token: ${{ secrets.METRICS_TOKEN }}
          output_action: commit
          committer_branch: examples
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìí Markdown template - Example with plugins configuration for embed use
        uses: lowlighter/metrics@master
        with:
          template: markdown
          filename: metrics.markdown.full.md
          markdown: >-
            https://raw.githubusercontent.com/lowlighter/metrics/master/source/templates/markdown/example.md
          config_output: markdown
          plugin_activity: yes
          plugin_activity_limit: 7
          plugin_activity_days: 0
          plugin_activity_filter: issue, pr, release, fork, review, ref/create
          plugin_posts: yes
          plugin_posts_source: dev.to
          plugin_posts_descriptions: yes
          plugin_posts_covers: yes
          plugin_posts_limit: 2
          plugin_rss: yes
          plugin_rss_source: https://news.ycombinator.com/rss
          plugin_rss_limit: 4
          plugin_topics: yes
          plugin_topics_limit: 24
          plugin_isocalendar: yes
          plugin_languages: yes
          token: ${{ secrets.METRICS_TOKEN }}
          output_action: commit
          committer_branch: examples
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìí Markdown template - Example (pdf output)
        uses: lowlighter/metrics@master
        with:
          template: markdown
          filename: metrics.markdown.pdf
          markdown: >-
            https://raw.githubusercontent.com/lowlighter/metrics/master/source/templates/markdown/example.pdf.md
          config_output: markdown-pdf
          plugin_rss: yes
          plugin_rss_source: https://news.ycombinator.com/rss
          plugin_rss_limit: 4
          plugin_isocalendar: yes
          config_twemoji: yes
          config_padding: 5%
          token: ${{ secrets.METRICS_TOKEN }}
          output_action: commit
          committer_branch: examples
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìï Community templates - Using a community template
        uses: lowlighter/metrics@master
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          template: "@classic"
          setup_community_templates: lowlighter/metrics@master:classic
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}
      - name: üìï Community templates - Using a trusted community template
        uses: lowlighter/metrics@master
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          template: "@terminal"
          setup_community_templates: lowlighter/metrics@master:terminal+trust
          output_action: none
          delay: 120
          user: lowlighter
          plugins_errors_fatal: yes
        if: ${{ success() || failure() }}


      - name: Screenshot markdown example
        if: ${{ success() || failure() }}
        run: |
          docker run --rm --entrypoint="" --volume=/tmp:/tmp ghcr.io/lowlighter/metrics:master node /metrics/.github/scripts/markdown_example.mjs
          sudo mv /tmp/metrics.markdown.png /metrics_renders/
      - name: Publish examples
        if: ${{ success() || failure() }}
        run: |
          set +e
          sudo rm -rf /metrics_renders/github-metrics.*
          sudo mv /metrics_renders/* ./
          git config user.name github-actions[bot]
          git config user.email 41898282+github-actions[bot]@users.noreply.github.com
          git pull
          git reset --soft c8d364ee752ad090945b7e104873d24d011b521e
          git add --all
          git commit -m "chore: update examples"
          git push --force

# ======================================================================================
# Special job used to render lowlighter/metrics repository assets
# ======================================================================================

  repository:
    runs-on: ubuntu-latest
    needs: [ examples ]
    if: "github.repository == 'lowlighter/metrics'"
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Checkout examples
        run: git checkout examples

      - name: Contributors
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@master
        with:
          filename: metrics.contributors.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          template: repository
          user: lowlighter
          repo: metrics
          plugin_people: yes
          plugin_people_types: contributors
          plugins_errors_fatal: yes
          config_display: large
          output_action: none
          delay: 120
      - name: Sponsors
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@master
        with:
          filename: metrics.sponsors.svg
          token: ${{ secrets.METRICS_TOKEN_PERSONAL }}
          base: ""
          user: lowlighter
          plugin_sponsors: yes
          plugin_sponsors_past: yes
          plugin_sponsors_sections: list
          plugin_sponsors_size: 32
          plugins_errors_fatal: yes
          config_display: large
          output_action: none
          delay: 120
      - name: Licenses
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@master
        with:
          filename: metrics.licenses.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          template: repository
          user: lowlighter
          repo: metrics
          plugin_licenses: yes
          plugin_licenses_setup: npm ci
          plugin_licenses_legal: yes
          plugin_licenses_ratio: yes
          plugins_errors_fatal: yes
          output_action: none
          delay: 120

      - name: Publish examples
        if: ${{ success() || failure() }}
        run: |
          set +e
          git config user.name github-actions[bot]
          git config user.email 41898282+github-actions[bot]@users.noreply.github.com
          git pull
          sudo cp /metrics_renders/* ./
          git add --all
          git commit -m "chore: update examples"
          git push --force
</file>

<file path="source/app/metrics/utils.mjs">
//Imports
import octicons from "@primer/octicons"
import twemojis from "@twemoji/parser"
import axios from "axios"
import processes from "child_process"
import crypto from "crypto"
import { minify as csso } from "csso"
import * as d3 from "d3"
import emoji from "emoji-name-map"
import { fileTypeFromBuffer } from "file-type"
import fss from "fs"
import fs from "fs/promises"
import { JSDOM } from "jsdom"
import linguist from "linguist-js"
import { marked } from "marked"
import { minimatch } from "minimatch"
import opengraph from "open-graph-scraper"
import os from "os"
import paths from "path"
import PNG from "png-js"
import prism from "prismjs"
import prism_lang from "prismjs/components/index.js"
import _puppeteer from "puppeteer"
import purgecss from "purgecss"
import readline from "readline"
import htmlsanitize from "sanitize-html"
import sharp from "sharp"
import git from "simple-git"
import SVGO from "svgo"
import url from "url"
import util from "util"
import xmlformat from "xml-formatter"
prism_lang()

//Exports
export { axios, d3, emoji, fs, git, minimatch, opengraph, os, paths, processes, sharp, url, util }

/**Returns module __dirname */
export function __module(module) {
  return paths.join(paths.dirname(url.fileURLToPath(module)))
}

/**Puppeteer instantier */
export const puppeteer = {
  async launch() {
    return _puppeteer.launch({
      headless: this.headless,
      executablePath: process.env.PUPPETEER_BROWSER_PATH,
      args: this.headless ? ["--no-sandbox", "--disable-extensions", "--disable-setuid-sandbox", "--disable-dev-shm-usage"] : [],
      ignoreDefaultArgs: ["--disable-extensions"],
    })
  },
  headless: "new",
  events: ["load", "domcontentloaded", "networkidle2"],
}

/**Plural formatter */
export function s(value, end = "") {
  return value !== 1 ? {y: "ies", "": "s"}[end] : end
}

/**Formatters */
export function formatters({timeZone} = {}) {
  //Check options
  try {
    new Date().toLocaleString("fr", {timeZoneName: "short", timeZone})
  }
  catch {
    timeZone = undefined
  }

  /**Formatter */
  const format = function(n, {sign = false, unit = true, fixed} = {}) {
    if (unit) {
      for (const {u, v} of [{u: "b", v: 10 ** 9}, {u: "m", v: 10 ** 6}, {u: "k", v: 10 ** 3}]) {
        if (n / v >= 1)
          return `${(sign) && (n > 0) ? "+" : ""}${(n / v).toFixed(fixed ?? 2).substr(0, 4).replace(/[.]0*$/, "")}${u}`
      }
    }
    return `${(sign) && (n > 0) ? "+" : ""}${fixed ? n.toFixed(fixed) : n}`
  }

  /**Bytes formatter */
  format.bytes = function(n) {
    for (const {u, v} of [{u: "E", v: 10 ** 18}, {u: "P", v: 10 ** 15}, {u: "T", v: 10 ** 12}, {u: "G", v: 10 ** 9}, {u: "M", v: 10 ** 6}, {u: "k", v: 10 ** 3}]) {
      if (n / v >= 1)
        return `${(n / v).toFixed(2).substr(0, 4).replace(/[.]0*$/, "")} ${u}B`
    }
    return `${n} byte${n > 1 ? "s" : ""}`
  }

  /**Percentage formatter */
  format.percentage = function(n, {rescale = true} = {}) {
    return `${
      (n * (rescale ? 100 : 1)).toFixed(2)
        .replace(/(?<=[.])(?<decimal>[1-9]*)0+$/, "$<decimal>")
        .replace(/[.]$/, "")
    }%`
  }

  /**Text ellipsis formatter */
  format.ellipsis = function(text, {length = 20} = {}) {
    text = `${text}`
    if (text.length < length)
      return text
    return `${text.substring(0, length)}‚Ä¶`
  }

  /**Date formatter */
  format.date = function(string, options) {
    if (options.date) {
      delete options.date
      Object.assign(options, {day: "numeric", month: "short", year: "numeric"})
    }
    if (options.time) {
      delete options.time
      Object.assign(options, {hour: "2-digit", minute: "2-digit", second: "2-digit"})
    }
    return new Intl.DateTimeFormat("en-GB", {timeZone, ...options}).format(new Date(string))
  }

  /**License formatter */
  format.license = function(license) {
    if (license.spdxId === "NOASSERTION")
      return license.name
    return license.nickname ?? license.spdxId ?? license.name
  }

  /**Error formatter */
  format.error = function(error, {descriptions = {}, ...attributes} = {}) {
    try {
      //Extras features or enable state error
      if ((error.extras) || (error.enabled))
        throw {error: {message: error.message, instance: error}}
      //Already formatted error
      if (error.error?.message)
        throw error
      //Custom description
      let message = "Unexpected error"
      if (descriptions.custom) {
        const description = descriptions.custom(error)
        if (description)
          message += ` (${description})`
      }
      //Axios error
      if (error.isAxiosError) {
        //Error code
        const status = error.response?.status
        message = `API error: ${status}`

        //Error description (optional)
        if ((descriptions) && (descriptions[status]))
          message += ` (${descriptions[status]})`
        else {
          const description = error.response?.data?.errors?.[0]?.message ?? error.response.data?.error_description ?? error.response?.data?.message ?? null
          if (description)
            message += ` (${description})`
        }

        //Error data
        console.debug(error.response.data)
        error = error.response?.data ?? null
        throw {error: {message, instance: error}}
      }
      throw {error: {message, instance: error}}
    }
    catch (error) {
      return Object.assign(error, attributes)
    }
  }

  return {format}
}

/**Array shuffler */
export function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1))
    ;[array[i], array[j]] = [array[j], array[i]]
  }
  return array
}

/**Escape html */
export function htmlescape(string, u = {"&": true, "<": true, ">": true, '"': true, "'": true}) {
  return string
    .replace(/&(?!(?:amp|lt|gt|quot|apos);)/g, u["&"] ? "&amp;" : "&")
    .replace(/</g, u["<"] ? "&lt;" : "<")
    .replace(/>/g, u[">"] ? "&gt;" : ">")
    .replace(/"/g, u['"'] ? "&quot;" : '"')
    .replace(/'/g, u["'"] ? "&apos;" : "'")
}

/**Unescape html */
export function htmlunescape(string, u = {"&": true, "<": true, ">": true, '"': true, "'": true}) {
  return string
    .replace(/&lt;/g, u["<"] ? "<" : "&lt;")
    .replace(/&gt;/g, u[">"] ? ">" : "&gt;")
    .replace(/&quot;/g, u['"'] ? '"' : "&quot;")
    .replace(/&(?:apos|#39);/g, u["'"] ? "'" : "&apos;")
    .replace(/&amp;/g, u["&"] ? "&" : "&amp;")
}

/**Strip emojis from string */
export function stripemojis(string) {
  return string.replace(/[^\p{L}\p{N}\p{P}\p{Z}^$\n]/gu, "")
}

/**Language analyzer (single file) */
export async function language({filename, patch}) {
  console.debug(`metrics/language > ${filename}`)
  const {files: {results}} = await linguist(filename, {fileContent: patch})
  const result = (results[filename] ?? "unknown").toLocaleLowerCase()
  console.debug(`metrics/language > ${filename} > result: ${result}`)
  return result
}

/**Run command (use this to execute commands and process whole output at once, may not be suitable for large outputs) */
export async function run(command, options, {prefixed = true, log = true, debug = true} = {}) {
  const prefix = {win32: "wsl"}[process.platform] ?? ""
  command = `${prefixed ? prefix : ""} ${command}`.trim()
  return new Promise((solve, reject) => {
    if (debug)
      console.debug(`metrics/command/run > ${command}`)
    const child = processes.exec(command, options)
    let [stdout, stderr] = ["", ""]
    child.stdout.on("data", data => stdout += data)
    child.stderr.on("data", data => stderr += data)
    child.on("close", code => {
      if (debug)
        console.debug(`metrics/command/run > ${command} > exited with code ${code}`)
      if (log) {
        console.debug(stdout)
        console.debug(stderr)
      }
      return code === 0 ? solve(stdout) : reject(stderr)
    })
  })
}

/**Spawn command (use this to execute commands and process output on the fly) */
export async function spawn(command, args = [], options = {}, {prefixed = true, timeout = 300 * 1000, stdout, debug = true} = {}) { //eslint-disable-line max-params
  const prefix = {win32: "wsl"}[process.platform] ?? ""
  if ((prefixed) && (prefix)) {
    args.unshift(command)
    command = prefix
  }
  if (!stdout)
    throw new Error("`stdout` argument was not provided, use run() instead of spawn() if processing output is not needed")
  return new Promise((solve, reject) => {
    if (debug)
      console.debug(`metrics/command/spawn > ${command} with ${args.join(" ")}`)
    const child = processes.spawn(command, args, {...options, shell: true, timeout})
    const reader = readline.createInterface({input: child.stdout})
    reader.on("line", stdout)
    const closed = new Promise(close => reader.on("close", close))
    child.on("close", async code => {
      if (debug)
        console.debug(`metrics/command/spawn > ${command} with ${args.join(" ")} > exited with code ${code}`)
      await closed
      if (debug)
        console.debug(`metrics/command/spawn > ${command} with ${args.join(" ")} > reader closed`)
      return code === 0 ? solve() : reject()
    })
  })
}

/**Check command existence */
export async function which(command) {
  try {
    console.debug(`metrics/command > checking existence of ${command}`)
    await run(`which ${command}`)
    return true
  }
  catch {
    console.debug(`metrics/command > checking existence of ${command} > failed`)
  }
  return false
}

/**Code highlighter */
export function highlight(code, lang) {
  return lang in prism.languages ? prism.highlight(code, prism.languages[lang]) : code
}

/**Markdown-html sanitizer-interpreter */
export async function markdown(text, {mode = "inline", codelines = Infinity} = {}) {
  //Sanitize user input once to prevent injections and parse into markdown
  let rendered = await marked.parse(htmlunescape(htmlsanitize(text)), {highlight, silent: true, xhtml: true})
  //Markdown mode
  switch (mode) {
    case "inline": {
      rendered = htmlsanitize(
        htmlsanitize(rendered, {
          allowedTags: ["h1", "h2", "h3", "h4", "h5", "h6", "br", "blockquote", "code", "span"],
          allowedAttributes: {code: ["class"], span: ["class"]},
        }),
        {
          allowedAttributes: {code: ["class"], span: ["class"]},
          transformTags: {h1: "b", h2: "b", h3: "b", h4: "b", h5: "b", h6: "b", blockquote: "i"},
        },
      )
      break
    }
    default:
      break
  }
  //Trim code snippets
  rendered = rendered.replace(/(?<open><code[\s\S]*?>)(?<code>[\s\S]*?)(?<close><\/code>)/g, (m, open, code, close) => { //eslint-disable-line max-params
    const lines = code.trim().split("\n")
    if (lines.length > 1) {
      if (/class=".*language-[\s\S]+?.*"/.test(open))
        open = open.replace(/>/g, ` class="language-multiline ${open.match(/class="(?<class>[\s\S]+)"/)?.groups.class}" xml:space="preserve">`)
      else if (!/class="[\s\S]*"/.test(open))
        open = open.replace(/>/g, ' class="language-multiline" xml:space="preserve">')
    }
    return `${open}${lines.slice(0, codelines).join("\n")}${lines.length > codelines ? `\n<span class="token trimmed">(${lines.length - codelines} more ${lines.length - codelines === 1 ? "line was" : "lines were"} trimmed)</span>` : ""}${close}`
  })
  return rendered
}

/**Filters */
export const filters = {
  /**GitHub query filter */
  github(text, object) {
    console.debug(`metrics/svg/ghquery > checking ${text} against ${JSON.stringify(object)}`)
    const result = text.split(/(?<!NOT) /).map(x => x.trim()).filter(x => x).map(criteria => {
      const [key, filters] = criteria.split(":")
      const value = object[/^NOT /.test(key) ? key.substring(3).trim() : /^-/.test(key) ? key.substring(1).trim() : key.trim()]
      console.debug(`metrics/svg/ghquery > checking ${criteria} against ${value}`)
      if (value === undefined) {
        console.debug(`metrics/svg/ghquery > value for ${criteria} is undefined, considering it truthy`)
        return true
      }
      return filters?.split(",").map(x => x.trim()).filter(x => x).map(filter => {
        if (!Number.isFinite(Number(value))) {
          if (/^NOT /.test(filter))
            return value !== filter.substring(3).trim()
          if (/^-/.test(key))
            return value !== filter
          return value === filter.trim()
        }
        switch (true) {
          case /^true$/.test(filter):
            return value === true
          case /^false$/.test(filter):
            return value === false
          case /^>\d+$/.test(filter):
            return value > Number(filter.substring(1))
          case /^>=\d+$/.test(filter):
            return value >= Number(filter.substring(2))
          case /^<\d+$/.test(filter):
            return value < Number(filter.substring(1))
          case /^<=\d+$/.test(filter):
            return value <= Number(filter.substring(2))
          case /^\d+$/.test(filter):
            return value === Number(filter)
          case /^\d+..\d+$/.test(filter): {
            const [a, b] = filter.split("..").map(Number)
            return (value >= a) && (value <= b)
          }
          default:
            return false
        }
      }).reduce((a, b) => a || b, false) ?? false
    }).reduce((a, b) => a && b, true)
    console.debug(`metrics/svg/ghquery > ${result ? "matching" : "not matching"}`)
    return result
  },
  /**Repository filter*/
  repo(repository, patterns, {debug = true} = {}) {
    //Disable filtering when no pattern is provided
    if (!patterns.length)
      return true

    //Normalize repository handle
    let repo, user
    if (repository.nameWithOwner)
      repository = repository.nameWithOwner
    if ((repository.name) && (repository.owner?.login)) {
      user = repository.owner.login
      repo = repository.name
    }
    user = (user ?? repository.split("/")[0]).toLocaleLowerCase()
    repo = (repo ?? repository.split("/")[1]).toLocaleLowerCase()
    const handle = `${user}/${repo}`

    let include = true
    //Advanced pattern matching
    if (patterns[0] === "@use.patterns") {
      if (debug)
        console.debug(`metrics/filters/repo > ${repo} > using advanced pattern matching`)
      const options = {nocase: true}
      for (let pattern of patterns) {
        if (pattern.startsWith("#"))
          continue
        let action = false
        if ((pattern.startsWith("+")) || (pattern.startsWith("-"))) {
          action = pattern.charAt(0) === "+"
          pattern = pattern.substring(1)
        }
        if (minimatch(handle, pattern, options)) {
          if (debug)
            console.debug(`metrics/filters/repo > ${repo} matches ${action ? "including" : "excluding"} pattern ${pattern}`)
          include = action
        }
      }
    }
    //Basic pattern matching
    else {
      if (debug)
        console.debug(`metrics/filters/repo > ${repo} > using basic pattern matching`)
      include = (!patterns.includes(repo)) && (!patterns.includes(handle))
    }

    if (debug)
      console.debug(`metrics/filters/repo > filter ${repo} (${include ? "included" : "excluded"})`)
    return include
  },
  /**Text filter*/
  text(text, patterns, {debug = true} = {}) {
    //Disable filtering when no pattern is provided
    if (!patterns.length)
      return true

    //Normalize text
    text = `${text}`.toLocaleLowerCase()

    //Basic pattern matching
    const include = !patterns.includes(text)
    if (debug)
      console.debug(`metrics/filters/text > filter ${text} (${include ? "included" : "excluded"})`)
    return include
  },
}

/**Image to base64 */
export async function imgb64(image, {width, height, fallback = true} = {}) {
  //Ignore already encoded-base 64
  if ((typeof image === "string") && (image.startsWith("data:image/png;base64")))
    return image
  //Undefined image
  if (!image)
    return fallback ? "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg==" : null
  //SVG image
  if ((typeof image === "string") && (image.endsWith(".svg")))
    return `data:image/svg+xml;base64,${Buffer.from(await fetch(image).then(response => response.arrayBuffer())).toString("base64")}`
  //Load image
  let ext = "png"
  try {
    if (image.startsWith("http://") || image.startsWith("https://")) {
      const buffer = Buffer.from(await fetch(image).then(response => response.arrayBuffer()))
      ext = (await fileTypeFromBuffer(buffer))?.ext ?? ext
      image = sharp(buffer)
    }
    else {
      image = sharp(image)
    }
  }
  catch (error) {
    console.debug(`metrics/imgb64 > error > ${error}${fallback ? " (using fallback image instead)" : ""}`)
    return imgb64(null, {fallback})
  }
  //Resize image
  if ((width) && (height))
    image = image.resize({width: width > 0 ? width : null, height: height > 0 ? height : null})
  return `data:image/${ext};base64,${(await image.toBuffer()).toString("base64")}`
}

/**SVG utils */
export const svg = {
  /**Render as pdf */
  async pdf(rendered, {paddings = "", style = "", twemojis = false, gemojis = false, octicons = false, rest = null, errors = []} = {}) {
    //Instantiate browser if needed
    if (!svg.resize.browser) {
      svg.resize.browser = await puppeteer.launch()
      console.debug(`metrics/svg/pdf > started ${await svg.resize.browser.version()}`)
    }
    //Additional transformations
    if (twemojis)
      rendered = await svg.twemojis(rendered, {custom: false})
    if ((gemojis) && (rest))
      rendered = await svg.gemojis(rendered, {rest})
    if (octicons)
      rendered = await svg.octicons(rendered)
    rendered = marked.parse(rendered)
    //Render through browser and print pdf
    console.debug("metrics/svg/pdf > loading svg")
    const page = await svg.resize.browser.newPage()
    page.on("console", ({_text: text}) => console.debug(`metrics/svg/pdf > puppeteer > ${text}`))
    await page.setContent(`<main class="markdown-body">${rendered}</main>`, {waitUntil: puppeteer.events})
    console.debug("metrics/svg/pdf > loaded svg successfully")
    const margins = (Array.isArray(paddings) ? paddings : paddings.split(",")).join(" ")
    console.debug(`metrics/svg/pdf > margins set to ${margins}`)
    await page.addStyleTag({
      content: `
        main { margin: ${margins}; }
        main svg { height: 1em; width: 1em; }
        ${await fs.readFile(paths.join(__module(import.meta.url), "../../../node_modules", "@primer/css/dist/markdown.css")).catch(_ => "")}${style}
      `,
    })
    rendered = await page.pdf()
    //Result
    await page.close()
    console.debug("metrics/svg/pdf > rendering complete")
    return {rendered, mime: "application/pdf", errors}
  },
  /**Render and resize svg */
  async resize(rendered, {paddings, convert, scripts = []}) {
    //Instantiate browser if needed
    if (!svg.resize.browser) {
      svg.resize.browser = await puppeteer.launch()
      console.debug(`metrics/svg/resize > started ${await svg.resize.browser.version()}`)
    }
    //Format padding
    const padding = {width: 1, height: 1, absolute: {width: 0, height: 0}}
    paddings = Array.isArray(paddings) ? paddings : `${paddings}`.split(",").map(x => x.trim())
    for (const [i, dimension] of [[0, "width"], [1, "height"]]) {
      let operands = paddings?.[i] ?? paddings[0]
      let {relative} = operands.match(/(?<relative>[+-]?[\d.]+)%$/)?.groups ?? {}
      operands = operands.replace(relative, "").trim()
      let {absolute} = operands.match(/^(?<absolute>[+-]?[\d.]+)/)?.groups ?? {}
      if (Number.isFinite(Number(absolute)))
        padding.absolute[dimension] = Number(absolute)
      if (Number.isFinite(Number(relative)))
        padding[dimension] = 1 + Number(relative / 100)
    }
    console.debug(`metrics/svg/resize > padding width*${padding.width}+${padding.absolute.width}, height*${padding.height}+${padding.absolute.height}`)
    //Render through browser and resize height
    console.debug("metrics/svg/resize > loading svg")
    const page = await svg.resize.browser.newPage()
    page.setViewport({width: 980, height: 980})
    page
      .on("console", message => console.debug(`metrics/svg/resize > puppeteer > ${message.text()}`))
      .on("pageerror", error => console.debug(`metrics/svg/resize > puppeteer > ${error.message}`))
    await page.setContent(rendered, {waitUntil: puppeteer.events})
    console.debug("metrics/svg/resize > loaded svg successfully")
    await page.addStyleTag({content: "body { margin: 0; padding: 0; }"})
    let mime = "image/svg+xml"
    console.debug("metrics/svg/resize > resizing svg")
    let height, resized, width
    try {
      ;({resized, width, height} = await page.evaluate(
        async (padding, scripts) => {
          //Execute additional JavaScript
          for (const script of scripts) {
            try {
              console.debug(`metrics/svg/resize > executing ${script}`)
              await new Function("document", `return (async () => {${script}})()`)(document) //eslint-disable-line no-new-func
              console.debug("metrics/svg/resize > successfully executed user javascript")
            }
            catch (error) {
              console.debug(`an error occurred while evaluating script: ${error}`)
            }
          }
          //Disable animations
          const animated = !document.querySelector("svg").classList.contains("no-animations")
          if (animated)
            document.querySelector("svg").classList.add("no-animations")
          console.debug(`animations are ${animated ? "enabled" : "disabled"}`)
          await new Promise(solve => setTimeout(solve, 2400))
          //Get bounds and resize
          let {y: height, width} = document.querySelector("svg #metrics-end").getBoundingClientRect()
          console.debug(`bounds width=${width}, height=${height}`)
          height = Math.max(1, Math.ceil(height * padding.height + padding.absolute.height))
          width = Math.max(1, Math.ceil(width * padding.width + padding.absolute.width))
          console.debug(`bounds after applying padding width=${width} (*${padding.width}+${padding.absolute.width}), height=${height} (*${padding.height}+${padding.absolute.height})`)
          //Resize svg
          if (document.querySelector("svg").getAttribute("height") === "auto")
            console.debug('skipped height resizing because it was set to "auto"')
          else
            document.querySelector("svg").setAttribute("height", height)
          //Enable animations
          if (animated)
            document.querySelector("svg").classList.remove("no-animations")
          //Result
          return {resized: new XMLSerializer().serializeToString(document.querySelector("svg")), height, width}
        },
        padding,
        scripts,
      ))
    }
    catch (error) {
      console.debug(`metrics/svg/resize > an error occurred: ${error}`)
      throw error
    }
    //Convert if required
    if (convert) {
      console.debug(`metrics/svg/resize > convert to ${convert}`)
      resized = await page.screenshot({type: convert, clip: {x: 0, y: 0, width, height}, omitBackground: true})
      mime = `image/${convert}`
    }
    //Result
    await page.close()
    console.debug("metrics/svg/resize > rendering complete")
    return {resized, mime}
  },
  /**Hash a SVG (removing its metadata first)*/
  async hash(rendered) {
    //Handle empty case
    if (!rendered)
      return null
    //Instantiate browser if needed
    if (!svg.resize.browser) {
      svg.resize.browser = await puppeteer.launch()
      console.debug(`metrics/svg/hash > started ${await svg.resize.browser.version()}`)
    }
    //Compute hash
    const page = await svg.resize.browser.newPage()
    await page.setContent(rendered, {waitUntil: puppeteer.events})
    const data = await page.evaluate(async () => {
      document.querySelector("footer")?.remove()
      return document.querySelector("svg").outerHTML
    })
    const hash = crypto.createHash("md5").update(data).digest("hex")
    //Result
    await page.close()
    console.debug(`metrics/svg/hash > MD5=${hash}`)
    return hash
  },
  /**Render twemojis */
  async twemojis(rendered, {custom = true} = {}) {
    //Load emojis
    console.debug("metrics/svg/twemojis > rendering twemojis")
    const emojis = new Map()
    for (const {text: emoji, url} of twemojis.parse(rendered)) {
      if (!emojis.has(emoji))
        emojis.set(emoji, (await axios.get(url)).data.replace(/^<svg /, '<svg class="twemoji" '))
    }
    //Apply replacements
    for (const [emoji, twemoji] of emojis) {
      if (custom)
        rendered = rendered.replace(new RegExp(`<metrics[ ]*(?<attributes>[^>]*)>${emoji}</metrics>`, "g"), twemoji.replace(/(<svg class="twemoji" [\s\S]+?)(>)/, "$1 $<attributes> $2"))
      rendered = rendered.replace(new RegExp(emoji, "g"), twemoji)
    }
    return rendered
  },
  /**Render github emojis */
  async gemojis(rendered, {rest}) {
    //Load gemojis
    console.debug("metrics/svg/gemojis > rendering gemojis")
    const emojis = new Map()
    try {
      for (const [emoji, url] of Object.entries((await rest.emojis.get().catch(() => ({data: {}}))).data).map(([key, value]) => [`:${key}:`, value])) {
        if ((!emojis.has(emoji)) && (new RegExp(emoji, "g").test(rendered)))
          emojis.set(emoji, `<img class="gemoji" src="${await imgb64(url)}" height="16" width="16" alt="" />`)
      }
    }
    catch (error) {
      console.debug("metrics/svg/gemojis > could not load gemojis")
      console.debug(error)
    }
    //Apply replacements
    for (const [emoji, gemoji] of emojis)
      rendered = rendered.replace(new RegExp(emoji, "g"), gemoji)
    return rendered
  },
  /**Render github octicons */
  async octicons(rendered) {
    //Load octicons
    console.debug("metrics/svg/octicons > rendering octicons")
    const icons = new Map()
    for (const {name, heights, toSVG} of Object.values(octicons)) {
      for (const size of Object.keys(heights)) {
        const octicon = `:octicon-${name}-${size}:`
        if (new RegExp(`:octicon-${name}(?:-[0-9]+)?:`, "g").test(rendered)) {
          icons.set(octicon, toSVG({height: size, width: size}))
          if (Number(size) === 16)
            icons.set(`:octicon-${name}:`, toSVG({height: size, width: size}))
        }
      }
    }
    //Apply replacements
    for (const [octicon, image] of icons)
      rendered = rendered.replace(new RegExp(octicon, "g"), image)
    return rendered
  },
  /**Optimizers */
  optimize: {
    /**CSS optimizer */
    async css(rendered) {
      //Extract styles
      console.debug("metrics/svg/optimize/css > optimizing")
      const regex = /<style data-optimizable="true">(?<style>[\s\S]*?)<\/style>/
      const cleaned = "<!-- (optimized css) -->"
      const css = []
      while (regex.test(rendered)) {
        const style = htmlunescape(rendered.match(regex)?.groups?.style ?? "")
        rendered = rendered.replace(regex, cleaned)
        css.push({raw: style})
      }
      const content = [{raw: rendered, extension: "html"}]

      //Purge CSS
      const purged = await new purgecss.PurgeCSS().purge({content, css})
      const optimized = `<style>${csso(purged.map(({css}) => css).join("\n")).css}</style>`
      return rendered.replace(cleaned, optimized)
    },
    /**XML optimizer */
    async xml(rendered, {raw = false} = {}) {
      console.debug("metrics/svg/optimize/xml > optimizing")
      if (raw) {
        console.debug("metrics/svg/optimize/xml > skipped as raw option is enabled")
        return rendered
      }
      return xmlformat(rendered, {lineSeparator: "\n", collapseContent: true})
    },
    /**SVG optimizer */
    async svg(rendered, {raw = false} = {}, experimental = new Set()) {
      console.debug("metrics/svg/optimize/svg > optimizing")
      if (raw) {
        console.debug("metrics/svg/optimize/svg > skipped as raw option is enabled")
        return rendered
      }
      if (!experimental.has("--optimize")) {
        console.debug("metrics/svg/optimize/svg > this feature require experimental feature flag --optimize-svg")
        return rendered
      }
      const {error, data: optimized} = await SVGO.optimize(rendered, {
        multipass: true,
        plugins: SVGO.extendDefaultPlugins([
          //Additional cleanup
          {name: "cleanupListOfValues"},
          {name: "removeRasterImages"},
          {name: "removeScriptElement"},
          //Force CSS style consistency
          {name: "inlineStyles", active: false},
          {name: "removeViewBox", active: false},
        ]),
      })
      if (error)
        throw new Error(`Could not optimize SVG: \n${error}`)
      return optimized
    },
  },
}

/**Wait */
export async function wait(seconds) {
  await new Promise(solve => setTimeout(solve, seconds * 1000))
}

/**Create record from puppeteer browser */
export async function record({page, width, height, frames, scale = 1, quality = 80, x = 0, y = 0, delay = 150, background = true}) {
  //Register images frames
  const images = []
  for (let i = 0; i < frames; i++) {
    images.push(await page.screenshot({type: "png", clip: {width, height, x, y}, omitBackground: background}))
    await wait(delay / 1000)
    if (i % 10 === 0)
      console.debug(`metrics/record > processed ${i}/${frames} frames`)
  }
  console.debug(`metrics/record > processed ${frames}/${frames} frames`)
  //Post-processing
  console.debug("metrics/record > applying post-processing")
  return Promise.all(images.map(async buffer => `data:image/png;base64,${(await (sharp(buffer).resize({width: Math.round(width * scale), height: Math.round(height * scale)}).png({quality}).toBuffer())).toString("base64")}`))
}

/**Create gif from puppeteer browser*/
export async function gif({page, width, height, frames, x = 0, y = 0, repeat = true, delay = 150, quality = 10}) {
  //Create temporary stream
  const path = paths.join(os.tmpdir(), `${Math.round(Math.random() * 1000000000)}.gif`)
  console.debug(`metrics/puppeteergif > set write stream to "${path}"`)
  if (fss.existsSync(path))
    await fs.unlink(path)
  //Create encoder
  try {
    const GIFEncoder = (await import("gifencoder")).default
    const encoder = new GIFEncoder(width, height)
    encoder.createWriteStream().pipe(fss.createWriteStream(path))
    encoder.start()
    encoder.setRepeat(repeat ? 0 : -1)
    encoder.setDelay(delay)
    encoder.setQuality(quality)
    //Register frames
    for (let i = 0; i < frames; i++) {
      const buffer = new PNG(await page.screenshot({clip: {width, height, x, y}}))
      encoder.addFrame(await new Promise(solve => buffer.decode(pixels => solve(pixels))))
      if (frames % 10 === 0)
        console.debug(`metrics/puppeteergif > processed ${i}/${frames} frames`)
    }
    console.debug(`metrics/puppeteergif > processed ${frames}/${frames} frames`)
    //Close encoder and convert to base64
    encoder.finish()
    const result = await fs.readFile(path, "base64")
    await fs.unlink(path)
    return `data:image/gif;base64,${result}`
  }
  catch (error) {
    console.debug(`metrics/puppeteergif > could not create gif: ${error}`)
    return "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcOnfpfwAGfgLYttYINwAAAABJRU5ErkJggg=="
  }
}

/**D3 node wrapper (loosely based on https://github.com/d3-node/d3-node)*/
export class D3node {
  constructor() {
    this.jsdom = new JSDOM()
    this.document = this.jsdom.window.document
  }

  get element() {
    return d3.select(this.document.body)
  }

  createSVG(width, height) {
    const svg = this.element.append("svg").attr("xmlns", "http://www.w3.org/2000/svg")
    if ((width) && (height))
      svg.attr("width", width).attr("height", height)
    return svg
  }

  svgString() {
    return this.element.select("svg").node()?.outerHTML || ""
  }
}

/**Graph utilities */
export const Graph = {
  /**Timeline graph */
  timeline() {
    return this.graph("time", ...arguments)
  },
  /**Line graph */
  line() {
    return this.graph("line", ...arguments)
  },
  /**Basic Graph */
  graph(type, data, {area = true, points = true, text = true, low = NaN, high = NaN, match = null, labels = null, width = 480, height = 315, ticks = 0} = {}) {
    //Generate SVG
    const margin = {top: 10, left: 10, right: 10, bottom: 45}
    const d3n = new D3node()
    const svg = d3n.createSVG(width, height)

    //Data
    const X = data.map(({x}) => x)
    const start = X.at(0)
    const end = X.at(-1)
    const Y = data.map(({y}) => y)
    const extremum = Math.max(...Y)
    high = !Number.isNaN(high) ? high : extremum
    low = !Number.isNaN(low) ? low : 0
    const T = data.map(({text}, i) => text ?? Y[i])

    //Time range
    const x = (type === "time" ? d3.scaleTime() : d3.scaleLinear())
      .domain([start, end])
      .range([margin.top, width - margin.left - margin.right])
    let xticks = d3.axisBottom(x).tickSizeOuter(0)
    if (labels)
      xticks = xticks.tickFormat((_, i) => labels[i])
    if (ticks)
      xticks = xticks.ticks(ticks)
    svg.append("g")
      .attr("transform", `translate(${margin.left},${height - margin.bottom})`)
      .call(xticks)
      .call(g => g.select(".domain").attr("stroke", "rgba(127, 127, 127, .8)"))
      .call(g => g.selectAll(".tick line").attr("stroke-opacity", 0.5))
      .selectAll("text")
      .attr("transform", "translate(-5,5) rotate(-45)")
      .style("text-anchor", "end")
      .style("font-size", 20)
      .attr("fill", "rgba(127, 127, 127, .8)")

    //Data range
    const y = d3.scaleLinear()
      .domain([high, low])
      .range([margin.left, height - margin.top - margin.bottom])
    svg.append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`)
      .call(d3.axisRight(y).ticks(Math.round(height / 50)).tickSize(width - margin.left - margin.right))
      .call(g => g.select(".domain").remove())
      .call(g => g.selectAll(".tick line").attr("stroke-opacity", 0.5).attr("stroke-dasharray", "2,2"))
      .call(g => g.selectAll(".tick text").attr("x", 0).attr("dy", -4))
      .selectAll("text")
      .style("font-size", 20)
      .attr("fill", "rgba(127, 127, 127, .8)")

    //Generate graph line
    const datum = Y.map((y, i) => [X.at(i), y])
    const tdatum = Y.map((y, i) => [X.at(i), y, T[i]])
    const xticked = xticks.scale().ticks(xticks.ticks()[0])
    const yticked = match?.(tdatum, xticked) ?? tdatum
    svg.append("path")
      .datum(datum)
      .attr("transform", `translate(${margin.left},${margin.top})`)
      .attr(
        "d",
        d3.line()
          .curve(d3.curveLinear)
          .x(d => x(d[0]))
          .y(d => y(d[1])),
      )
      .attr("fill", "transparent")
      .attr("stroke", "#87ceeb")
      .attr("stroke-width", 2)

    //Generate graph area
    if (area) {
      svg.append("path")
        .datum(datum)
        .attr("transform", `translate(${margin.left},${margin.top})`)
        .attr(
          "d",
          d3.area()
            .curve(d3.curveLinear)
            .x(d => x(d[0]))
            .y0(d => y(d[1]))
            .y1(() => y(low)),
        )
        .attr("fill", "rgba(88, 166, 255, .1)")
    }

    //Generate graph points
    if (points) {
      svg.append("g")
        .selectAll("circle")
        .data(yticked)
        .join("circle")
        .attr("transform", `translate(${margin.left},${margin.top})`)
        .attr("cx", d => x(d[0]))
        .attr("cy", d => y(d[1]))
        .attr("r", 2)
        .attr("fill", "#106cbc")
    }

    //Generate graph text
    if (text) {
      svg.append("g")
        .attr("fill", "currentColor")
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", 10)
        .attr("stroke", "rgba(88, 166, 255, .05)")
        .attr("stroke-linejoin", "round")
        .attr("stroke-width", 4)
        .attr("paint-order", "stroke fill")
        .selectAll("text")
        .data(yticked)
        .join("text")
        .attr("transform", `translate(${margin.left},${margin.top - 4})`)
        .attr("x", d => x(d[0]))
        .attr("y", d => y(d[1]))
        .text(d => d[2] ? d[2] : "")
        .attr("fill", "rgba(127, 127, 127, .8)")
    }

    return d3n.svgString()
  },
  /**Pie Graph */
  pie(data, {colors, width = 480, height = 315} = {}) {
    //Generate SVG
    const radius = Math.min(width, height) / 2
    const d3n = new D3node()
    const svg = d3n.createSVG(width, height)

    //Data
    const K = Object.keys(data)
    const V = Object.values(data)
    const I = d3.range(K.length).filter(i => !Number.isNaN(V[i]))

    //Colors
    const spectral = [...d3.schemeSpectral]
    spectral[0] = ["#000000"]
    spectral[1] = spectral[3].slice(0, 1)
    spectral[2] = spectral[3].slice(0, 2)

    //Construct arcs
    const color = d3.scaleOrdinal(K, spectral[K.length])
    const arcs = d3.pie().padAngle(1 / radius).sort(null).value(i => V[i])(I)
    const arc = d3.arc().innerRadius(0).outerRadius(radius)
    const labels = d3.arc().innerRadius(radius / 2).outerRadius(radius / 2)

    svg.append("g")
      .attr("transform", `translate(${width / 2},${height / 2})`)
      .attr("stroke", "white")
      .attr("stroke-width", 1)
      .attr("stroke-linejoin", "round")
      .selectAll("path")
      .data(arcs)
      .join("path")
      .attr("fill", d => colors?.[K[d.data]] ?? color(K[d.data]))
      .attr("d", arc)
      .append("title")
      .text(d => `${K[d.data]}\n${V[d.data]}`)

    svg.append("g")
      .attr("transform", `translate(${width / 2},${height / 2})`)
      .attr("font-family", "sans-serif")
      .attr("font-size", 12)
      .attr("text-anchor", "middle")
      .attr("fill", "white")
      .attr("stroke", "rbga(0,0,0,.9)")
      .attr("paint-order", "stroke fill")
      .selectAll("text")
      .data(arcs)
      .join("text")
      .attr("transform", d => `translate(${labels.centroid(d)})`)
      .selectAll("tspan")
      .data(d => {
        const lines = `${K[d.data]}\n${V[d.data]}`.split(/\n/)
        return (d.endAngle - d.startAngle) > 0.25 ? lines : lines.slice(0, 1)
      })
      .join("tspan")
      .attr("x", 0)
      .attr("y", (_, i) => `${i * 1.1}em`)
      .attr("font-weight", (_, i) => i ? null : "bold")
      .text(d => d)

    return d3n.svgString()
  },
}
</file>

<file path="source/plugins/achievements/index.mjs">
//Imports
import * as compute from "./list/index.mjs"

//Setup
export default async function({login, q, imports, data, computed, graphql, queries, rest, account}, {enabled = false, extras = false} = {}) {
  //Plugin execution
  try {
    //Check if plugin is enabled and requirements are met
    if ((!q.achievements) || (!imports.metadata.plugins.achievements.enabled(enabled, {extras})))
      return null

    //Load inputs
    let {threshold, secrets, only, ignored, limit, display} = imports.metadata.plugins.achievements.inputs({data, q, account})

    //Initialization
    const list = []
    await total({imports, graphql, queries})
    await compute[account]({list, login, data, computed, imports, graphql, queries, rest, rank, leaderboard})

    //Results
    const order = {S: 5, A: 4, B: 3, C: 2, $: 1, X: 0}
    const colors = {S: ["#EB355E", "#731237"], A: ["#B59151", "#FFD576"], B: ["#7D6CFF", "#B2A8FF"], C: ["#2088FF", "#79B8FF"], $: ["#FF48BD", "#FF92D8"], X: ["#7A7A7A", "#B0B0B0"]}
    const achievements = list
      .filter(a => (order[a.rank] >= order[threshold]) || ((a.rank === "$") && (secrets)))
      .filter(a => (!only.length) || ((only.length) && (only.includes(a.title.toLocaleLowerCase()))))
      .filter(a => imports.filters.text(a.title, ignored))
      .sort((a, b) => (order[b.rank] + b.progress * 0.99) - (order[a.rank] + a.progress * 0.99))
      .map(({title, unlock, ...achievement}) => ({
        prefix: ({S: "Master", A: "Super", B: "Great"}[achievement.rank] ?? ""),
        title,
        unlock: !/invalid date/i.test(unlock) ? `${imports.format.date(unlock, {time: true})} on ${imports.format.date(unlock, {date: true})}` : null,
        ...achievement,
      }))
      .map(({icon, ...achievement}) => ({icon: icon.replace(/#primary/g, colors[achievement.rank][0]).replace(/#secondary/g, colors[achievement.rank][1]), ...achievement}))
      .slice(0, limit || Infinity)
    return {list: achievements, display}
  }
  //Handle errors
  catch (error) {
    throw imports.format.error(error)
  }
}

/**Rank */
function rank(x, [c, b, a, s, m]) {
  if (x >= s)
    return {rank: "S", progress: (x - s) / (m - s)}
  if (x >= a)
    return {rank: "A", progress: (x - a) / (s - a)}
  else if (x >= b)
    return {rank: "B", progress: (x - b) / (a - b)}
  else if (x >= c)
    return {rank: "C", progress: (x - c) / (b - c)}
  return {rank: "X", progress: x / c}
}

/**Leaderboards */
function leaderboard({user, type, requirement}) {
  return requirement
    ? {
      user: 1 + user,
      total: total[type],
      type,
      get top() {
        return Number(`1${"0".repeat(Math.ceil(Math.log10(this.user)))}`)
      },
      get percentile() {
        return 100 * (this.user / this.top)
      },
    }
    : null
}

/**Total extracter */
async function total({imports, graphql, queries}) {
  if (!total.promise) {
    total.promise = new Promise(async (solve, reject) => {
      for (const method of ["graphql", "browser"]) {
        console.debug(`metrics/compute/plugins > achievements > setup using ${method}`)
        try {
          //Setup using GraphQL
          if (method === "graphql") {
            const queried = await graphql(queries.achievements.total())
            Object.assign(total, Object.fromEntries(Object.entries(queried).map(([key, {count: value}]) => [key, value])))
          }
          //Setup using browser
          if (method === "browser") {
            //Setup browser
            console.debug("metrics/compute/plugins > achievements > filling total from github.com/search")
            const browser = await imports.puppeteer.launch()
            console.debug(`metrics/compute/plugins > achievements > started ${await browser.version()}`)
            //Extracting total from github.com/search
            for (let i = 0; (i < 4) && ((!total.users) || (!total.repositories)); i++) {
              const page = await browser.newPage()
              await page.goto("https://github.com/search?q=created%3A%3E%3D1970")
              const results = await page.evaluate(() => [...[...document.querySelectorAll("h2")].filter(node => /Filter by/.test(node.innerText)).shift()?.nextSibling?.innerText.trim().matchAll(/(?<type>Repositories|Users|Issues)\n.*?(?<count>\d+)M/g) ?? []]) ?? null
              for (const result of results) {
                const type = result[1]?.toLowerCase()
                console.debug(`metrics/compute/plugins > achievements > setup found ${type ?? "(?)"}`)
                const count = result[2] ?? ""
                if ((count !== "") && (!total[type])) {
                  total[type] = Number(count) * 10e5
                  console.debug(`metrics/compute/plugins > achievements > set total.${type} to ${total[type]}`)
                }
              }
              await page.close()
              await imports.wait(10 * Math.random())
            }
          }
          //Check setup state
          if ((!total.users) || (!total.repositories))
            throw new Error("Uncomplete setup")
        }
        catch (error) {
          console.debug(`metrics/compute/plugins > achievements > setup error > ${error}`)
          continue
        }
      }
      if ((!total.users) || (!total.repositories))
        return reject("Failed to initiate total for achievement plugin")
      console.debug("metrics/compute/plugins > achievements > total setup complete")
      return solve()
    })
  }
  return total.promise
}
</file>

<file path="source/plugins/lines/README.md">
<!--header-->
<table>
  <tr><td colspan="2"><a href="/README.md#-plugins">‚Üê Back to plugins index</a></td></tr>
  <tr><th colspan="2"><h3>üë®‚Äçüíª Lines of code changed</h3></th></tr>
  <tr><td colspan="2" align="center"><p>This plugin displays the number of lines of code added and removed across repositories.</p>
</td></tr>
  <tr><th>‚ö†Ô∏è Disclaimer</th><td><p>This plugin is not affiliated, associated, authorized, endorsed by, or in any way officially connected with <a href="https://github.com">GitHub</a>.
All product and company names are trademarks‚Ñ¢ or registered¬Æ trademarks of their respective holders.</p>
</td></tr>
  <tr>
    <th rowspan="3">Supported features<br><sub><a href="metadata.yml">‚Üí Full specification</a></sub></th>
    <td><a href="/source/templates/classic/README.md"><code>üìó Classic template</code></a> <a href="/source/templates/repository/README.md"><code>üìò Repository template</code></a> <a href="/source/templates/terminal/README.md"><code>üìô Terminal template</code></a></td>
  </tr>
  <tr>
    <td><code>üë§ Users</code> <code>üë• Organizations</code> <code>üìì Repositories</code></td>
  </tr>
  <tr>
    <td><code>üîë (scopeless)</code> <code>read:org (optional)</code> <code>read:user (optional)</code> <code>read:packages (optional)</code> <code>repo (optional)</code></td>
  </tr>
  <tr>
    <td colspan="2" align="center">
      <details open><summary>Repositories and diff history</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.lines.history.svg" alt=""></img></details>
      <details><summary>Compact display in base plugin</summary><img src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.lines.svg" alt=""></img></details>
      <img width="900" height="1" alt="">
    </td>
  </tr>
</table>
<!--/header-->

## ‚û°Ô∏è Available options

<!--options-->
<table>
  <tr>
    <td align="center" nowrap="nowrap">Option</i></td><td align="center" nowrap="nowrap">Description</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_lines</code></h4></td>
    <td rowspan="2"><p>Enable lines plugin</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>boolean</code>
<br>
<b>default:</b> no<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_lines_skipped</code></h4></td>
    <td rowspan="2"><p>Skipped repositories</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap">‚è© Inherits <code>repositories_skipped</code><br>
<b>type:</b> <code>array</code>
<i>(newline-separated)</i>
<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_lines_sections</code></h4></td>
    <td rowspan="2"><p>Displayed sections</p>
<ul>
<li><code>base</code> will display the total lines added and removed in <code>base.repositories</code> section</li>
<li><code>repositories</code> will display repositories with the most lines added and removed</li>
<li><code>history</code> will display a graph displaying lines added and removed over time</li>
</ul>
<blockquote>
<p>‚ÑπÔ∏è <code>base</code> requires at least <a href="/source/plugins/base/README.md#base"><code>base: repositories</code></a> to be set</p>
</blockquote>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>array</code>
<i>(comma-separated)</i>
<br>
<b>default:</b> base<br>
<b>allowed values:</b><ul><li>base</li><li>repositories</li><li>history</li></ul></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_lines_repositories_limit</code></h4></td>
    <td rowspan="2"><p>Display limit</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>default:</b> 4<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_lines_history_limit</code></h4></td>
    <td rowspan="2"><p>Years to display</p>
<p>Will display the last <code>n</code> years, relative to current year</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 1<br></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><h4><code>plugin_lines_delay</code></h4></td>
    <td rowspan="2"><p>Delay before performing a second query</p>
<p>When non-zero, will perform a second query after specified delay (in seconds).
The GitHub endpoint used may return inaccurate results on first query (these values seems to be cached on the fly),
after returning correct results upon performing another query.</p>
<p>Using this option may mitigate the occurrence of weird values.</p>
<img width="900" height="1" alt=""></td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>type:</b> <code>number</code>
<i>(0 ‚â§
ùë•)</i>
<br>
<b>zero behaviour:</b> disable</br>
<b>default:</b> 0<br></td>
  </tr>
</table>
<!--/options-->

## ‚ÑπÔ∏è Examples workflows

<!--examples-->
```yaml
name: Compact display in base plugin
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.lines.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: repositories
  plugin_lines: yes
  plugin_lines_delay: 30

```
```yaml
name: Repositories and diff history
uses: lowlighter/metrics@latest
with:
  filename: metrics.plugin.lines.history.svg
  token: ${{ secrets.METRICS_TOKEN }}
  base: ""
  plugin_lines: yes
  plugin_lines_delay: 30
  plugin_lines_sections: repositories, history
  plugin_lines_repositories_limit: 2
  plugin_lines_history_limit: 1
  repositories_skipped: |
    @use.patterns
    */*
    +lowlighter/metrics

```
<!--/examples-->
</file>

<file path="README.md">
# üìä Metrics [<img src="https://api.producthunt.com/widgets/embed-image/v1/featured.svg?post_id=280144&theme=dark" alt="" align="right" width="190" height="41">](https://www.producthunt.com/posts/github-metrics?utm_source=badge-featured&utm_medium=badge&utm_source=badge-github-metrics)

[![Continuous integration](https://github.com/lowlighter/metrics/actions/workflows/ci.yml/badge.svg)](https://github.com/lowlighter/metrics/actions/workflows/ci.yml)

Generate metrics that can be embedded everywhere, including your GitHub profile readme! Supports users, organizations, and even repositories!

<table>
  <tr>
    <th align="center">For user accounts</th>
    <th align="center">For organization accounts</th>
  </tr>
  <tr>
    <td align="center">
<img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.classic.svg" alt=""></img>
</td>
<td align="center">
<img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.organization.svg" alt=""></img>
</td>
  </tr>
  <tr>
    <th colspan="2" align="center">
      <h3><a href="/README.md#-plugins">üß© Customizable with 47 plugins and 335 options!</a></h3>
    </th>
  </tr>
  <tr>
    <th><a href="source/plugins/isocalendar/README.md">üìÖ Isometric commit calendar</a></th>
    <th><a href="source/plugins/languages/README.md">üà∑Ô∏è Languages activity</a></th>
  </tr>
  <tr>
        <td  align="center">
        <details open><summary>Full year calendar</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.isocalendar.fullyear.svg" alt=""></img></details>
        <details><summary>Half year calendar</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.isocalendar.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <details open><summary>Indepth analysis (clone and analyze repositories)</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.languages.indepth.svg" alt=""></img></details>
        <details open><summary>Recently used (analyze recent activity events)</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.languages.recent.svg" alt=""></img></details>
        <details><summary>Default algorithm</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.languages.svg" alt=""></img></details>
        <details><summary>Default algorithm (with details)</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.languages.details.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/stargazers/README.md">‚ú® Stargazers</a></th>
    <th><a href="source/plugins/lines/README.md">üë®‚Äçüíª Lines of code changed</a></th>
  </tr>
  <tr>
        <td  align="center">
        <details open><summary>Classic charts</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stargazers.svg" alt=""></img></details>
        <details><summary>Graph charts</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stargazers.graph.svg" alt=""></img></details>
        <details open><summary>Worldmap</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stargazers.worldmap.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <details open><summary>Repositories and diff history</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.lines.history.svg" alt=""></img></details>
        <details><summary>Compact display in base plugin</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.lines.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/topics/README.md">üìå Starred topics</a></th>
    <th><a href="source/plugins/stars/README.md">üåü Recently starred repositories</a></th>
  </tr>
  <tr>
        <td  align="center">
        <details open><summary>With icons</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.topics.icons.svg" alt=""></img></details>
        <details open><summary>With labels</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.topics.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stars.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/licenses/README.md">üìú Repository licenses</a></th>
    <th><a href="source/plugins/habits/README.md">üí° Coding habits and activity</a></th>
  </tr>
  <tr>
        <td  align="center">
        <details open><summary>Permissions, limitations and conditions</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.licenses.svg" alt=""></img></details>
        <details open><summary>Licenses overview</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.licenses.ratio.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <details open><summary>Recent activity charts</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.habits.charts.svg" alt=""></img></details>
        <details open><summary>Mildly interesting facts</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.habits.facts.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/contributors/README.md">üèÖ Repository contributors</a></th>
    <th><a href="source/plugins/followup/README.md">üéüÔ∏è Follow-up of issues and pull requests</a></th>
  </tr>
  <tr>
        <td  align="center">
        <details open><summary>By contribution types</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.contributors.categories.svg" alt=""></img></details>
        <details><summary>By number of contributions</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.contributors.contributions.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <details open><summary>Indepth analysis</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.followup.indepth.svg" alt=""></img></details>
        <details><summary>Created on a user's repositories</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.followup.svg" alt=""></img></details>
        <details><summary>Created by a user</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.followup.user.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/reactions/README.md">üé≠ Comment reactions</a></th>
    <th><a href="source/plugins/people/README.md">üßë‚Äçü§ù‚Äçüßë People</a></th>
  </tr>
  <tr>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.reactions.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <details open><summary>Related to a user</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.people.followers.svg" alt=""></img></details>
        <details><summary>Related to a repository</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.people.repository.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/sponsorships/README.md">üíù GitHub Sponsorships</a></th>
    <th><a href="source/plugins/sponsors/README.md">üíï GitHub Sponsors</a></th>
  </tr>
  <tr>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.sponsorships.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <details open><summary>GitHub sponsors card</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.sponsors.svg" alt=""></img></details>
        <details><summary>GitHub sponsors full introduction</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.sponsors.full.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/repositories/README.md">üìì Featured repositories</a></th>
    <th><a href="source/plugins/discussions/README.md">üí¨ Discussions</a></th>
  </tr>
  <tr>
        <td  align="center">
        <details open><summary>Featured</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.repositories.svg" alt=""></img></details>
        <details><summary>Pinned</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.repositories.pinned.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.discussions.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/starlists/README.md">üí´ Star lists</a></th>
    <th><a href="source/plugins/calendar/README.md">üìÜ Commit calendar</a></th>
  </tr>
  <tr>
        <td  align="center">
        <details open><summary>Repositories from star lists</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.starlists.svg" alt=""></img></details>
        <details open><summary>Languages from star lists</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.starlists.languages.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <details><summary>Current year</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.calendar.svg" alt=""></img></details>
        <details open><summary>Full history</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.calendar.full.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/achievements/README.md">üèÜ Achievements</a></th>
    <th><a href="source/plugins/notable/README.md">üé© Notable contributions</a></th>
  </tr>
  <tr>
        <td  align="center">
        <details open><summary>Compact display</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.achievements.compact.svg" alt=""></img></details>
        <details><summary>Detailed display</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.achievements.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <details open><summary>Indepth analysis</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.notable.indepth.svg" alt=""></img></details>
        <details><summary>Contributions in organizations only</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.notable.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/activity/README.md">üì∞ Recent activity</a></th>
    <th><a href="source/plugins/traffic/README.md">üßÆ Repositories traffic</a></th>
  </tr>
  <tr>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.activity.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.traffic.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/code/README.md">‚ôê Random code snippet</a></th>
    <th><a href="source/plugins/gists/README.md">üé´ Gists</a></th>
  </tr>
  <tr>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.code.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.gists.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/projects/README.md">üóÇÔ∏è GitHub projects</a></th>
    <th><a href="source/plugins/introduction/README.md">üôã Introduction</a></th>
  </tr>
  <tr>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.projects.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <details open><summary>For a user or an organization</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.introduction.svg" alt=""></img></details>
        <details><summary>For a repository</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.introduction.repository.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/skyline/README.md">üåá GitHub Skyline</a></th>
    <th><a href="source/plugins/pagespeed/README.md">‚è±Ô∏è Google PageSpeed</a></th>
  </tr>
  <tr>
        <td  align="center">
        <details open><summary>GitHub Skyline</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.skyline.svg" alt=""></img></details>
        <details><summary>GitHub City</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.skyline.city.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <details open><summary>PageSpeed scores</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.pagespeed.svg" alt=""></img></details>
        <details><summary>PageSpeed scores with detailed report</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.pagespeed.detailed.svg" alt=""></img></details>
        <details><summary>PageSpeed scores with a website screenshot</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.pagespeed.screenshot.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/stackoverflow/README.md">üó®Ô∏è Stack Overflow</a></th>
    <th><a href="source/plugins/anilist/README.md">üå∏ Anilist watch list and reading list</a></th>
  </tr>
  <tr>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stackoverflow.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <details open><summary>For anime watchers</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.anilist.svg" alt=""></img></details>
        <details><summary>For manga readers</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.anilist.manga.svg" alt=""></img></details>
        <details open><summary>For waifus simp</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.anilist.characters.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/music/README.md">üéº Music activity and suggestions</a></th>
    <th><a href="source/plugins/posts/README.md">‚úíÔ∏è Recent posts</a></th>
  </tr>
  <tr>
        <td  align="center">
        <details open><summary>Random tracks from a playlist</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.music.playlist.svg" alt=""></img></details>
        <details open><summary>Recently listened</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.music.recent.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <details open><summary>Latest posts width description and cover image</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.posts.full.svg" alt=""></img></details>
        <details><summary>Latest posts</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.posts.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/rss/README.md">üóº Rss feed</a></th>
    <th><a href="source/plugins/wakatime/README.md">‚è∞ WakaTime</a></th>
  </tr>
  <tr>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.rss.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.wakatime.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="source/plugins/leetcode/README.md">üó≥Ô∏è Leetcode</a></th>
    <th><a href="source/plugins/steam/README.md">üïπÔ∏è Steam</a></th>
  </tr>
  <tr>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.leetcode.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <details open><summary>Recently played games</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.steam.svg" alt=""></img></details>
        <details><summary>Profile and detailed game history</summary><img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.steam.full.svg" alt=""></img></details>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th colspan="2" align="center">
      <a href="/source/plugins/community/README.md">üé≤ See also community plugins</a>
    </th>
  </tr>
  <tr>
    <th><a href="source/plugins/community/16personalities/README.md">üß† 16personalities</a><br><sup>by <a href="https://github.com/lowlighter">@lowlighter</a></sup>
      <details><summary>Render example</summary>
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.16personalities.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </details>
    </th>
    <th><a href="source/plugins/community/chess/README.md">‚ôüÔ∏è Chess</a><br><sup>by <a href="https://github.com/lowlighter">@lowlighter</a></sup>
      <details><summary>Render example</summary>
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.chess.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </details>
    </th>
  </tr>
  <tr>
    <th><a href="source/plugins/community/crypto/README.md">ü™ô Crypto</a><br><sup>by <a href="https://github.com/dajneem23">@dajneem23</a></sup>
      <details><summary>Render example</summary>
        <img alt="" width="400" src="https://via.placeholder.com/468x60?text=No%20preview%20available" alt=""></img>
        <img width="900" height="1" alt="">
      </details>
    </th>
    <th><a href="source/plugins/community/fortune/README.md">ü•† Fortune</a><br><sup>by <a href="https://github.com/lowlighter">@lowlighter</a></sup>
      <details><summary>Render example</summary>
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.fortune.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </details>
    </th>
  </tr>
  <tr>
    <th><a href="source/plugins/community/nightscout/README.md">üíâ Nightscout</a><br><sup>by <a href="https://github.com/legoandmars">@legoandmars</a></sup>
      <details><summary>Render example</summary>
        <img alt="" width="400" src="https://github.com/legoandmars/legoandmars/blob/master/metrics.plugin.nightscout.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </details>
    </th>
    <th><a href="source/plugins/community/poopmap/README.md">üí© PoopMap plugin</a><br><sup>by <a href="https://github.com/matievisthekat">@matievisthekat</a></sup>
      <details><summary>Render example</summary>
        <img alt="" width="400" src="https://github.com/matievisthekat/matievisthekat/blob/master/metrics.plugin.poopmap.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </details>
    </th>
  </tr>
  <tr>
    <th><a href="source/plugins/community/screenshot/README.md">üì∏ Website screenshot</a><br><sup>by <a href="https://github.com/lowlighter">@lowlighter</a></sup>
      <details><summary>Render example</summary>
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.screenshot.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </details>
    </th>
    <th><a href="source/plugins/community/splatoon/README.md">ü¶ë Splatoon</a><br><sup>by <a href="https://github.com/lowlighter">@lowlighter</a></sup>
      <details><summary>Render example</summary>
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.splatoon.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </details>
    </th>
  </tr>
  <tr>
    <th><a href="source/plugins/community/stock/README.md">üíπ Stock prices</a><br><sup>by <a href="https://github.com/lowlighter">@lowlighter</a></sup>
      <details><summary>Render example</summary>
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.plugin.stock.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </details>
    </th>
    <th>
    </th>
  </tr>
  <tr>
    <th colspan="2" align="center">
      <h3><a href="/README.md#%EF%B8%8F-templates">üñºÔ∏è And even more with 4+ templates!</a></h3>
    </th>
  </tr>
  <tr>
    <th><a href="/source/templates/classic/README.md">üìó Classic template</a></th>
    <th><a href="/source/templates/repository/README.md">üìò Repository template</a></th>
  </tr>
  <tr>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.classic.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.repository.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th><a href="/source/templates/terminal/README.md">üìô Terminal template</a></th>
    <th><a href="/source/templates/markdown/README.md">üìí Markdown template</a></th>
  </tr>
  <tr>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.terminal.svg" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
        <td  align="center">
        <img alt="" width="400" src="https://github.com/lowlighter/metrics/blob/examples/metrics.markdown.png" alt=""></img>
        <img width="900" height="1" alt="">
      </td>
  </tr>
  <tr>
    <th colspan="2"><a href="/source/templates/community/README.md">üìï See also community templates</a></th>
  </tr>
  <tr>
    <th colspan="2"><h2>ü¶ë Try it now!</h2></th>
  </tr>
  <tr>
    <th><a href="https://metrics.lecoq.io/embed">üìä Metrics embed</a></th>
    <th><a href="https://metrics.lecoq.io/insights">‚ú® Metrics insights</a></th>
  </tr>
  <tr>
    <td align="center">
      Embed metrics images on your profile or blog!<br>
      Use <a href="https://github.com/marketplace/actions/metrics-embed">GitHub actions</a> for even more features!<br>
      <img src="/.github/readme/imgs/features_embed.gif" width="360">
    </td>
    <td align="center">
      Share your metrics with friends and on social medias!<br>
      No configuration needed!<br>
      <img src="/.github/readme/imgs/features_insights.gif" width="360">
    </td>
  </tr>
  <tr>
    <td align="center" colspan="2">
      Test latest features and patches on <code><a href="https://beta-metrics.lecoq.io">üß™ Metrics beta</a></code>!
    </td>
  </tr>
  <tr>
    <td align="center" colspan="2">
      <b>Power user?</b><br>
      <a href="https://github.com/lowlighter/metrics/fork">Fork this repository</a> and edit HTML, CSS, JS and <a href="https://github.com/mde/ejs">EJS</a> for even more customization!
    </td>
  </tr>
</table>


# üìö Documentation


> <sup>*‚ö†Ô∏è This is the documentation of **v3.35-beta** (`@master`/`@main` branches) which includes [unreleased features](https://github.com/lowlighter/metrics/compare/latest...master) planned for next release. See documentation for current released version [**v3.34** (`@latest` branch) here](https://github.com/lowlighter/metrics/blob/latest/README.md).* </sup>



## ü¶Æ Setup

There are several ways to setup metrics, each having its advantages and disadvantages:

* [‚öôÔ∏è Using GitHub Action on a profile repository *(~10 min)*](/.github/readme/partials/documentation/setup/action.md)
  * ‚úîÔ∏è All features
  * ‚úîÔ∏è High availability (no downtimes)
  * ‚ûñ Configuration can be a bit time-consuming
* [üíï Using the shared instance *(~1 min)*](/.github/readme/partials/documentation/setup/shared.md)
  * ‚úîÔ∏è Easily configurable and previewable
  * ‚ûñ Limited features *(compute-intensive features are disabled)*
* [üèóÔ∏è Deploying a web instance *(~20 min)*](/.github/readme/partials/documentation/setup/web.md)
  * ‚úîÔ∏è Create another shared instance
  * ‚ûñ Requires some sysadmin knowledge
* [üê≥ Using command line with docker *(~2 min)*](/.github/readme/partials/documentation/setup/docker.md)
  * ‚úîÔ∏è Suited for one-time rendering
* [üîß Local setup for development *(~20 min)*](/.github/readme/partials/documentation/setup/local.md)

Additional resources for setup:
* [üè¶ Configure metrics for organizations](/.github/readme/partials/documentation/organizations.md)
* [üè† Run metrics on self-hosted runners](/.github/readme/partials/documentation/selfhosted.md)
* [üß∞ Template/Plugin compatibility matrix](/.github/readme/partials/documentation/compatibility.md)
## üñºÔ∏è Templates

Templates lets you change general appearance of rendered metrics.


* [üìó Classic template <sub>`classic`</sub>](/source/templates/classic/README.md)
* [üìò Repository template <sub>`repository`</sub>](/source/templates/repository/README.md)
* [üìô Terminal template <sub>`terminal`</sub>](/source/templates/terminal/README.md)
* [üìí Markdown template <sub>`markdown`</sub>](/source/templates/markdown/README.md)
* [üìï Community templates <sub>`community`</sub>](/source/templates/community/README.md)

## üß© Plugins

Plugins provide additional content and lets you customize rendered metrics.

**üì¶ Maintained by core team**

* **Core plugins**
  * [üóÉÔ∏è Base content <sub>`base`</sub>](/source/plugins/base/README.md)
  * [üß± Core <sub>`core`</sub>](/source/plugins/core/README.md)
* **GitHub plugins**
  * [üèÜ Achievements <sub>`achievements`</sub>](/source/plugins/achievements/README.md)
  * [üì∞ Recent activity <sub>`activity`</sub>](/source/plugins/activity/README.md)
  * [üìÜ Commit calendar <sub>`calendar`</sub>](/source/plugins/calendar/README.md)
  * [‚ôê Random code snippet <sub>`code`</sub>](/source/plugins/code/README.md)
  * [üèÖ Repository contributors <sub>`contributors`</sub>](/source/plugins/contributors/README.md)
  * [üí¨ Discussions <sub>`discussions`</sub>](/source/plugins/discussions/README.md)
  * [üéüÔ∏è Follow-up of issues and pull requests <sub>`followup`</sub>](/source/plugins/followup/README.md)
  * [üé´ Gists <sub>`gists`</sub>](/source/plugins/gists/README.md)
  * [üí° Coding habits and activity <sub>`habits`</sub>](/source/plugins/habits/README.md)
  * [üôã Introduction <sub>`introduction`</sub>](/source/plugins/introduction/README.md)
  * [üìÖ Isometric commit calendar <sub>`isocalendar`</sub>](/source/plugins/isocalendar/README.md)
  * [üà∑Ô∏è Languages activity <sub>`languages`</sub>](/source/plugins/languages/README.md)
  * [üìú Repository licenses <sub>`licenses`</sub>](/source/plugins/licenses/README.md)
  * [üë®‚Äçüíª Lines of code changed <sub>`lines`</sub>](/source/plugins/lines/README.md)
  * [üé© Notable contributions <sub>`notable`</sub>](/source/plugins/notable/README.md)
  * [üßë‚Äçü§ù‚Äçüßë People <sub>`people`</sub>](/source/plugins/people/README.md)
  * [üóÇÔ∏è GitHub projects <sub>`projects`</sub>](/source/plugins/projects/README.md)
  * [üé≠ Comment reactions <sub>`reactions`</sub>](/source/plugins/reactions/README.md)
  * [üìì Featured repositories <sub>`repositories`</sub>](/source/plugins/repositories/README.md)
  * [üåá GitHub Skyline <sub>`skyline`</sub>](/source/plugins/skyline/README.md)
  * [üíï GitHub Sponsors <sub>`sponsors`</sub>](/source/plugins/sponsors/README.md)
  * [üíù GitHub Sponsorships <sub>`sponsorships`</sub>](/source/plugins/sponsorships/README.md)
  * [‚ú® Stargazers <sub>`stargazers`</sub>](/source/plugins/stargazers/README.md)
  * [üí´ Star lists <sub>`starlists`</sub>](/source/plugins/starlists/README.md)
  * [üåü Recently starred repositories <sub>`stars`</sub>](/source/plugins/stars/README.md)
  * [üí≠ GitHub Community Support <sub>`support`</sub>](/source/plugins/support/README.md) <sub>`‚ö†Ô∏è deprecated`</sub>
  * [üìå Starred topics <sub>`topics`</sub>](/source/plugins/topics/README.md)
  * [üßÆ Repositories traffic <sub>`traffic`</sub>](/source/plugins/traffic/README.md)
* **Social plugins**
  * [üå∏ Anilist watch list and reading list <sub>`anilist`</sub>](/source/plugins/anilist/README.md)
  * [üó≥Ô∏è Leetcode <sub>`leetcode`</sub>](/source/plugins/leetcode/README.md)
  * [üéº Music activity and suggestions <sub>`music`</sub>](/source/plugins/music/README.md)
  * [‚è±Ô∏è Google PageSpeed <sub>`pagespeed`</sub>](/source/plugins/pagespeed/README.md)
  * [‚úíÔ∏è Recent posts <sub>`posts`</sub>](/source/plugins/posts/README.md)
  * [üóº Rss feed <sub>`rss`</sub>](/source/plugins/rss/README.md)
  * [üó®Ô∏è Stack Overflow <sub>`stackoverflow`</sub>](/source/plugins/stackoverflow/README.md)
  * [üïπÔ∏è Steam <sub>`steam`</sub>](/source/plugins/steam/README.md)
  * [üê§ Latest tweets <sub>`tweets`</sub>](/source/plugins/tweets/README.md) <sub>`‚ö†Ô∏è deprecated`</sub>
  * [‚è∞ WakaTime <sub>`wakatime`</sub>](/source/plugins/wakatime/README.md)

**üé≤ Maintained by community**
* **[Community plugins](/source/plugins/community/README.md)**
  * [üß† 16personalities <sub>`16personalities`</sub>](/source/plugins/community/16personalities/README.md) by [@lowlighter](https://github.com/lowlighter)
  * [‚ôüÔ∏è Chess <sub>`chess`</sub>](/source/plugins/community/chess/README.md) by [@lowlighter](https://github.com/lowlighter)
  * [ü™ô Crypto <sub>`crypto`</sub>](/source/plugins/community/crypto/README.md) by [@dajneem23](https://github.com/dajneem23)
  * [ü•† Fortune <sub>`fortune`</sub>](/source/plugins/community/fortune/README.md) by [@lowlighter](https://github.com/lowlighter)
  * [üíâ Nightscout <sub>`nightscout`</sub>](/source/plugins/community/nightscout/README.md) by [@legoandmars](https://github.com/legoandmars)
  * [üí© PoopMap plugin <sub>`poopmap`</sub>](/source/plugins/community/poopmap/README.md) by [@matievisthekat](https://github.com/matievisthekat)
  * [üì∏ Website screenshot <sub>`screenshot`</sub>](/source/plugins/community/screenshot/README.md) by [@lowlighter](https://github.com/lowlighter)
  * [ü¶ë Splatoon <sub>`splatoon`</sub>](/source/plugins/community/splatoon/README.md) by [@lowlighter](https://github.com/lowlighter)
  * [üíπ Stock prices <sub>`stock`</sub>](/source/plugins/community/stock/README.md) by [@lowlighter](https://github.com/lowlighter)


## üí™ Contributing

If you are interested in contributing, the following resources may interest you:

* [üí™ Contribution guide](/CONTRIBUTING.md)
* [üß¨ Architecture](/ARCHITECTURE.md)
* [üìú License](/LICENSE)
* **:octocat: GitHub resources**
  * [üìñ GitHub GraphQL API](https://docs.github.com/en/graphql)
  * [üìñ GitHub GraphQL Explorer](https://docs.github.com/en/free-pro-team@latest/graphql/overview/explorer)
  * [üìñ GitHub Rest API](https://docs.github.com/en/rest)
  * [üìñ GitHub Octicons](https://github.com/primer/octicons)

Use [`üí¨ discussions`](https://github.com/lowlighter/metrics/discussions) for feedback, new features suggestions, bugs reports or to request help for installation.


## üìú License

```
MIT License
Copyright (c) 2020-present lowlighter
```

![Sponsors](https://github.com/lowlighter/metrics/blob/examples/metrics.sponsors.svg)
</file>

<file path="action.yml">
# ====================================================================================
# Inputs and configuration

inputs:

  # ====================================================================================
  # üóÉÔ∏è Base content

  base:
    description: Base content
    default: <default-value>

  base_indepth:
    description: Indepth mode
    default: <default-value>

  base_hireable:
    description: Show `Available for hire!` in header section
    default: <default-value>

  base_skip:
    description: Skip base content
    default: <default-value>

  repositories:
    description: Fetched repositories
    default: <default-value>

  repositories_batch:
    description: Fetched repositories per query
    default: <default-value>

  repositories_forks:
    description: Include forks
    default: <default-value>

  repositories_affiliations:
    description: Repositories affiliations
    default: <default-value>

  repositories_skipped:
    description: Default skipped repositories
    default: <default-value>

  users_ignored:
    description: Default ignored users
    default: <default-value>

  commits_authoring:
    description: Identifiers that has been used for authoring commits
    default: <default-value>

  # ====================================================================================
  # üß± Core

  token:
    description: GitHub Personal Access Token
    required: true

  user:
    description: GitHub username
    default: <default-value>

  repo:
    description: GitHub repository
    default: <default-value>

  committer_token:
    description: GitHub Token used to commit metrics
    default: ${{ github.token }}

  committer_branch:
    description: Target branch
    default: <default-value>

  committer_message:
    description: Commit message
    default: <default-value>

  committer_gist:
    description: Gist id
    default: <default-value>

  filename:
    description: Output path
    default: <default-value>

  markdown:
    description: Markdown template path
    default: <default-value>

  markdown_cache:
    description: Markdown file cache
    default: <default-value>

  output_action:
    description: Output action
    default: <default-value>

  output_condition:
    description: Output condition
    default: <default-value>

  optimize:
    description: Optimization features
    default: <default-value>

  setup_community_templates:
    description: Community templates to setup
    default: <default-value>

  template:
    description: Template
    default: <default-value>

  query:
    description: Query parameters
    default: <default-value>

  extras_css:
    description: Extra CSS
    default: <default-value>

  extras_js:
    description: Extra JavaScript
    default: <default-value>

  github_api_rest:
    description: GitHub REST API endpoint
    default: <default-value>

  github_api_graphql:
    description: GitHub GraphQL API endpoint
    default: <default-value>

  config_timezone:
    description: Timezone for dates
    default: ""

  config_order:
    description: Plugin order
    default: <default-value>

  config_twemoji:
    description: Use twemojis
    default: <default-value>

  config_gemoji:
    description: Use GitHub custom emojis
    default: <default-value>

  config_octicon:
    description: Use GitHub octicons
    default: <default-value>

  config_display:
    description: Display width (for image output formats)
    default: <default-value>

  config_animations:
    description: Use CSS animations
    default: <default-value>

  config_base64:
    description: Base64-encoded images
    default: <default-value>

  config_padding:
    description: Output padding
    default: <default-value>

  config_output:
    description: Output format
    default: <default-value>

  config_presets:
    description: Configuration presets
    default: ""

  retries:
    description: Retries in case of failures (for rendering)
    default: <default-value>

  retries_delay:
    description: Delay between each retry (in seconds, for rendering)
    default: <default-value>

  retries_output_action:
    description: Retries in case of failures (for output action)
    default: <default-value>

  retries_delay_output_action:
    description: Delay between each retry (in seconds, for output action)
    default: <default-value>

  clean_workflows:
    description: Clean previous workflows jobs
    default: <default-value>

  delay:
    description: Job delay
    default: <default-value>

  quota_required_rest:
    description: Minimum GitHub REST API requests quota required to run
    default: <default-value>

  quota_required_graphql:
    description: Minimum GitHub GraphQL API requests quota required to run
    default: <default-value>

  quota_required_search:
    description: Minimum GitHub Search API requests quota required to run
    default: <default-value>

  notice_releases:
    description: Notice about new releases of metrics
    default: <default-value>

  use_prebuilt_image:
    description: >-
      Use pre-built docker image from [GitHub container
      registry](https://github.com/Funmatu/metrics/pkgs/container/metrics)
    default: yes

  plugins_errors_fatal:
    description: Fatal plugin errors
    default: <default-value>

  debug:
    description: Debug mode
    default: <default-value>

  verify:
    description: SVG validity check
    default: <default-value>

  debug_flags:
    description: Debug flags
    default: <default-value>

  debug_print:
    description: Print output in console
    default: <default-value>

  dryrun:
    description: Dry-run
    default: <default-value>

  experimental_features:
    description: Experimental features
    default: <default-value>

  use_mocked_data:
    description: Use mocked data instead of live APIs
    default: <default-value>

  # ====================================================================================
  # üìÖ Isometric commit calendar

  plugin_isocalendar:
    description: Enable isocalendar plugin
    default: <default-value>

  plugin_isocalendar_duration:
    description: Time range
    default: <default-value>

  # ====================================================================================
  # üà∑Ô∏è Languages activity

  plugin_languages:
    description: Enable languages plugin
    default: <default-value>

  plugin_languages_ignored:
    description: Ignored languages
    default: <default-value>

  plugin_languages_skipped:
    description: Skipped repositories
    default: <default-value>

  plugin_languages_limit:
    description: Display limit
    default: <default-value>

  plugin_languages_threshold:
    description: Display threshold (percentage)
    default: <default-value>

  plugin_languages_other:
    description: Group unknown, ignored and over-limit languages into "Other" category
    default: <default-value>

  plugin_languages_colors:
    description: Custom languages colors
    default: <default-value>

  plugin_languages_aliases:
    description: Custom languages names
    default: <default-value>

  plugin_languages_sections:
    description: Displayed sections
    default: <default-value>

  plugin_languages_details:
    description: Additional details
    default: <default-value>

  plugin_languages_indepth:
    description: Indepth mode
    default: <default-value>

  plugin_languages_indepth_custom:
    description: Indepth mode - Custom repositories
    default: <default-value>

  plugin_languages_analysis_timeout:
    description: Indepth mode - Analysis timeout
    default: "600" # <default-value>

  plugin_languages_analysis_timeout_repositories:
    description: Indepth mode - Analysis timeout (repositories)
    default: "180" # <default-value>

  plugin_languages_categories:
    description: Indepth mode - Displayed categories (most-used section)
    default: <default-value>

  plugin_languages_recent_categories:
    description: Indepth mode - Displayed categories (recently-used section)
    default: <default-value>

  plugin_languages_recent_load:
    description: Indepth mode - Events to load (recently-used section)
    default: <default-value>

  plugin_languages_recent_days:
    description: Indepth mode - Events maximum age (day, recently-used section)
    default: <default-value>

  # ====================================================================================
  # ‚ú® Stargazers

  plugin_stargazers:
    description: Enable stargazers plugin
    default: <default-value>

  plugin_stargazers_days:
    description: Time range
    default: <default-value>

  plugin_stargazers_charts:
    description: Charts
    default: <default-value>

  plugin_stargazers_charts_type:
    description: Charts display type
    default: <default-value>

  plugin_stargazers_worldmap:
    description: Stargazers worldmap
    default: <default-value>

  plugin_stargazers_worldmap_token:
    description: Stargazers worldmap token
    default: <default-value>

  plugin_stargazers_worldmap_sample:
    description: Stargazers worldmap sample
    default: <default-value>

  # ====================================================================================
  # üë®‚Äçüíª Lines of code changed

  plugin_lines:
    description: Enable lines plugin
    default: <default-value>

  plugin_lines_skipped:
    description: Skipped repositories
    default: <default-value>

  plugin_lines_sections:
    description: Displayed sections
    default: <default-value>

  plugin_lines_repositories_limit:
    description: Display limit
    default: <default-value>

  plugin_lines_history_limit:
    description: Years to display
    default: <default-value>

  plugin_lines_delay:
    description: Delay before performing a second query
    default: <default-value>

  # ====================================================================================
  # üìå Starred topics

  plugin_topics:
    description: Enable topics plugin
    default: <default-value>

  plugin_topics_mode:
    description: Display mode
    default: <default-value>

  plugin_topics_sort:
    description: Sorting method
    default: <default-value>

  plugin_topics_limit:
    description: Display limit
    default: <default-value>

  # ====================================================================================
  # üåü Recently starred repositories

  plugin_stars:
    description: Enable stars plugin
    default: <default-value>

  plugin_stars_limit:
    description: Display limit
    default: <default-value>

  # ====================================================================================
  # üìú Repository licenses

  plugin_licenses:
    description: Enable licenses plugin
    default: <default-value>

  plugin_licenses_setup:
    description: Setup command
    default: <default-value>

  plugin_licenses_ratio:
    description: Used licenses ratio
    default: <default-value>

  plugin_licenses_legal:
    description: Permissions, limitations and conditions about used licenses
    default: <default-value>

  # ====================================================================================
  # üí° Coding habits and activity

  plugin_habits:
    description: Enable habits plugin
    default: <default-value>

  plugin_habits_from:
    description: Events to use
    default: <default-value>

  plugin_habits_skipped:
    description: Skipped repositories
    default: <default-value>

  plugin_habits_days:
    description: Event maximum age
    default: <default-value>

  plugin_habits_facts:
    description: Mildly interesting facts
    default: <default-value>

  plugin_habits_charts:
    description: Charts
    default: <default-value>

  plugin_habits_charts_type:
    description: Charts display type
    default: <default-value>

  plugin_habits_trim:
    description: Trim unused hours on charts
    default: <default-value>

  plugin_habits_languages_limit:
    description: Display limit (languages)
    default: <default-value>

  plugin_habits_languages_threshold:
    description: Display threshold (percentage)
    default: <default-value>

  # ====================================================================================
  # üèÖ Repository contributors

  plugin_contributors:
    description: Enable contributors plugin
    default: <default-value>

  plugin_contributors_base:
    description: Base reference
    default: <default-value>

  plugin_contributors_head:
    description: Head reference
    default: <default-value>

  plugin_contributors_ignored:
    description: Ignored users
    default: <default-value>

  plugin_contributors_contributions:
    description: Contributions count
    default: <default-value>

  plugin_contributors_sections:
    description: Displayed sections
    default: <default-value>

  plugin_contributors_categories:
    description: Contribution categories
    default: <default-value>

  # ====================================================================================
  # üéüÔ∏è Follow-up of issues and pull requests

  plugin_followup:
    description: Enable followup plugin
    default: <default-value>

  plugin_followup_sections:
    description: Displayed sections
    default: <default-value>

  plugin_followup_indepth:
    description: Indepth analysis
    default: <default-value>

  plugin_followup_archived:
    description: Include archived repositories
    default: <default-value>

  # ====================================================================================
  # üé≠ Comment reactions

  plugin_reactions:
    description: Enable reactions plugin
    default: <default-value>

  plugin_reactions_limit:
    description: Display limit (issues and pull requests comments)
    default: <default-value>

  plugin_reactions_limit_issues:
    description: Display limit (issues and pull requests, first comment)
    default: <default-value>

  plugin_reactions_limit_discussions:
    description: Display limit (discussions, first comment)
    default: <default-value>

  plugin_reactions_limit_discussions_comments:
    description: Display limit (discussions comments)
    default: <default-value>

  plugin_reactions_days:
    description: Comments maximum age
    default: <default-value>

  plugin_reactions_display:
    description: Display mode
    default: <default-value>

  plugin_reactions_details:
    description: Additional details
    default: <default-value>

  plugin_reactions_ignored:
    description: Ignored users
    default: <default-value>

  # ====================================================================================
  # üßë‚Äçü§ù‚Äçüßë People

  plugin_people:
    description: Enable people plugin
    default: <default-value>

  plugin_people_limit:
    description: Display limit
    default: <default-value>

  plugin_people_identicons:
    description: Force identicons pictures
    default: <default-value>

  plugin_people_identicons_hide:
    description: Hide identicons pictures
    default: <default-value>

  plugin_people_size:
    description: Profile picture display size
    default: <default-value>

  plugin_people_types:
    description: Displayed sections
    default: <default-value>

  plugin_people_thanks:
    description: Special thanks
    default: <default-value>

  plugin_people_sponsors_custom:
    description: Custom sponsors
    default: <default-value>

  plugin_people_shuffle:
    description: Shuffle data
    default: <default-value>

  # ====================================================================================
  # üíù GitHub Sponsorships

  plugin_sponsorships:
    description: Enable sponsorships plugin
    default: <default-value>

  plugin_sponsorships_sections:
    description: Displayed sections
    default: <default-value>

  plugin_sponsorships_size:
    description: Profile picture display size
    default: <default-value>

  # ====================================================================================
  # üíï GitHub Sponsors

  plugin_sponsors:
    description: Enable sponsors plugin
    default: <default-value>

  plugin_sponsors_sections:
    description: Displayed sections
    default: <default-value>

  plugin_sponsors_past:
    description: Past sponsorships
    default: <default-value>

  plugin_sponsors_size:
    description: Profile picture display size
    default: <default-value>

  plugin_sponsors_title:
    description: Title caption
    default: <default-value>

  # ====================================================================================
  # üìì Featured repositories

  plugin_repositories:
    description: Enable repositories plugin
    default: <default-value>

  plugin_repositories_featured:
    description: Featured repositories
    default: <default-value>

  plugin_repositories_pinned:
    description: Pinned repositories
    default: <default-value>

  plugin_repositories_starred:
    description: Featured most starred repositories
    default: <default-value>

  plugin_repositories_random:
    description: Featured random repositories
    default: <default-value>

  plugin_repositories_order:
    description: Featured repositories display order
    default: <default-value>

  plugin_repositories_forks:
    description: Include repositories forks
    default: <default-value>

  plugin_repositories_affiliations:
    description: Repositories affiliations
    default: <default-value>

  # ====================================================================================
  # üí¨ Discussions

  plugin_discussions:
    description: Enable discussions plugin
    default: <default-value>

  plugin_discussions_categories:
    description: Discussion categories
    default: <default-value>

  plugin_discussions_categories_limit:
    description: Display limit (categories)
    default: <default-value>

  # ====================================================================================
  # üí´ Star lists

  plugin_starlists:
    description: Enable starlists plugin
    default: <default-value>

  plugin_starlists_limit:
    description: Display limit (star lists)
    default: <default-value>

  plugin_starlists_limit_repositories:
    description: Display limit (repositories per star list)
    default: <default-value>

  plugin_starlists_languages:
    description: Star lists languages statistics
    default: <default-value>

  plugin_starlists_limit_languages:
    description: Display limit (languages per star list)
    default: <default-value>

  plugin_starlists_languages_ignored:
    description: Ignored languages in star lists
    default: <default-value>

  plugin_starlists_languages_aliases:
    description: Custom languages names in star lists
    default: <default-value>

  plugin_starlists_shuffle_repositories:
    description: Shuffle data
    default: <default-value>

  plugin_starlists_ignored:
    description: Skipped star lists
    default: <default-value>

  plugin_starlists_only:
    description: Showcased star lists
    default: <default-value>

  # ====================================================================================
  # üìÜ Commit calendar

  plugin_calendar:
    description: Enable calendar plugin
    default: <default-value>

  plugin_calendar_limit:
    description: Years to display
    default: <default-value>

  # ====================================================================================
  # üèÜ Achievements

  plugin_achievements:
    description: Enable achievements plugin
    default: <default-value>

  plugin_achievements_threshold:
    description: Rank threshold filter
    default: <default-value>

  plugin_achievements_secrets:
    description: Secrets achievements
    default: <default-value>

  plugin_achievements_display:
    description: Display style
    default: <default-value>

  plugin_achievements_limit:
    description: Display limit
    default: <default-value>

  plugin_achievements_ignored:
    description: Ignored achievements
    default: <default-value>

  plugin_achievements_only:
    description: Showcased achievements
    default: <default-value>

  # ====================================================================================
  # üé© Notable contributions

  plugin_notable:
    description: Enable notable plugin
    default: <default-value>

  plugin_notable_filter:
    description: Query filter
    default: <default-value>

  plugin_notable_skipped:
    description: Skipped repositories
    default: <default-value>

  plugin_notable_from:
    description: Repository owner account type filter
    default: <default-value>

  plugin_notable_repositories:
    description: Repository name
    default: <default-value>

  plugin_notable_indepth:
    description: Indepth mode
    default: <default-value>

  plugin_notable_types:
    description: Contribution types filter
    default: <default-value>

  plugin_notable_self:
    description: Include own repositories
    default: <default-value>

  # ====================================================================================
  # üì∞ Recent activity

  plugin_activity:
    description: Enable activity plugin
    default: <default-value>

  plugin_activity_limit:
    description: Display limit
    default: <default-value>

  plugin_activity_load:
    description: Events to load
    default: <default-value>

  plugin_activity_days:
    description: Events maximum age
    default: <default-value>

  plugin_activity_visibility:
    description: Events visibility
    default: <default-value>

  plugin_activity_timestamps:
    description: Events timestamps
    default: <default-value>

  plugin_activity_skipped:
    description: Skipped repositories
    default: <default-value>

  plugin_activity_ignored:
    description: Ignored users
    default: <default-value>

  plugin_activity_filter:
    description: Events types
    default: <default-value>

  # ====================================================================================
  # üßÆ Repositories traffic

  plugin_traffic:
    description: Enable traffic plugin
    default: <default-value>

  plugin_traffic_skipped:
    description: Skipped repositories
    default: <default-value>

  # ====================================================================================
  # ‚ôê Random code snippet

  plugin_code:
    description: Enable code plugin
    default: <default-value>

  plugin_code_lines:
    description: Display limit (lines per code snippets)
    default: <default-value>

  plugin_code_load:
    description: Events to load
    default: <default-value>

  plugin_code_days:
    description: Events maximum age
    default: <default-value>

  plugin_code_visibility:
    description: Events visibility
    default: <default-value>

  plugin_code_skipped:
    description: Skipped repositories
    default: <default-value>

  plugin_code_languages:
    description: Showcased languages
    default: <default-value>

  # ====================================================================================
  # üé´ Gists

  plugin_gists:
    description: Enable gists plugin
    default: <default-value>

  # ====================================================================================
  # üóÇÔ∏è GitHub projects

  plugin_projects:
    description: Enable projects plugin
    default: <default-value>

  plugin_projects_limit:
    description: Display limit
    default: <default-value>

  plugin_projects_repositories:
    description: Featured repositories projects
    default: <default-value>

  plugin_projects_descriptions:
    description: Projects descriptions
    default: <default-value>

  # ====================================================================================
  # üôã Introduction

  plugin_introduction:
    description: Enable introduction plugin
    default: <default-value>

  plugin_introduction_title:
    description: Section title
    default: <default-value>

  # ====================================================================================
  # üåá GitHub Skyline

  plugin_skyline:
    description: Enable skyline plugin
    default: <default-value>

  plugin_skyline_year:
    description: Displayed year
    default: <default-value>

  plugin_skyline_frames:
    description: Frames count
    default: <default-value>

  plugin_skyline_quality:
    description: Image quality
    default: <default-value>

  plugin_skyline_compatibility:
    description: Compatibility mode
    default: <default-value>

  plugin_skyline_settings:
    description: Advanced settings
    default: <default-value>

  # ====================================================================================
  # üí≠ GitHub Community Support

  plugin_support:
    description: Enable support plugin
    default: <default-value>

  # ====================================================================================
  # ‚è±Ô∏è Google PageSpeed

  plugin_pagespeed:
    description: Enable pagespeed plugin
    default: <default-value>

  plugin_pagespeed_token:
    description: PageSpeed token
    default: <default-value>

  plugin_pagespeed_url:
    description: Audited website
    default: <default-value>

  plugin_pagespeed_detailed:
    description: Detailed results
    default: <default-value>

  plugin_pagespeed_screenshot:
    description: Website screenshot
    default: <default-value>

  plugin_pagespeed_pwa:
    description: PWA Status
    default: <default-value>

  # ====================================================================================
  # üê§ Latest tweets

  plugin_tweets:
    description: Enable tweets plugin
    default: <default-value>

  plugin_tweets_token:
    description: Twitter API token
    default: <default-value>

  plugin_tweets_user:
    description: Twitter username
    default: <default-value>

  plugin_tweets_attachments:
    description: Tweets attachments
    default: <default-value>

  plugin_tweets_limit:
    description: Display limit
    default: <default-value>

  # ====================================================================================
  # üó®Ô∏è Stack Overflow

  plugin_stackoverflow:
    description: Enable stackoverflow plugin
    default: <default-value>

  plugin_stackoverflow_user:
    description: Stackoverflow user id
    default: <default-value>

  plugin_stackoverflow_sections:
    description: Displayed sections
    default: <default-value>

  plugin_stackoverflow_limit:
    description: Display limit (entries per section)
    default: <default-value>

  plugin_stackoverflow_lines:
    description: Display limit (lines per questions and answers)
    default: <default-value>

  plugin_stackoverflow_lines_snippet:
    description: Display limit (lines per code snippets)
    default: <default-value>

  # ====================================================================================
  # üå∏ Anilist watch list and reading list

  plugin_anilist:
    description: Enable aniList plugin
    default: <default-value>

  plugin_anilist_user:
    description: AniList login
    default: <default-value>

  plugin_anilist_medias:
    description: Medias types
    default: <default-value>

  plugin_anilist_sections:
    description: Displayed sections
    default: <default-value>

  plugin_anilist_limit:
    description: Display limit (medias)
    default: <default-value>

  plugin_anilist_limit_characters:
    description: Display limit (characters)
    default: <default-value>

  plugin_anilist_shuffle:
    description: Shuffle data
    default: <default-value>

  # ====================================================================================
  # üéº Music activity and suggestions

  plugin_music:
    description: Enable music plugin
    default: <default-value>

  plugin_music_provider:
    description: Music provider
    default: <default-value>

  plugin_music_token:
    description: Music provider token
    default: <default-value>

  plugin_music_user:
    description: Music provider username
    default: <default-value>

  plugin_music_mode:
    description: Display mode
    default: <default-value>

  plugin_music_playlist:
    description: Playlist URL
    default: <default-value>

  plugin_music_limit:
    description: Display limit
    default: <default-value>

  plugin_music_played_at:
    description: Recently played - Last played timestamp
    default: <default-value>

  plugin_music_time_range:
    description: Top tracks - Time range
    default: <default-value>

  plugin_music_top_type:
    description: Top tracks - Display type
    default: <default-value>

  # ====================================================================================
  # ‚úíÔ∏è Recent posts

  plugin_posts:
    description: Enable posts plugin
    default: <default-value>

  plugin_posts_source:
    description: External source
    default: <default-value>

  plugin_posts_user:
    description: External source username
    default: <default-value>

  plugin_posts_descriptions:
    description: Posts descriptions
    default: <default-value>

  plugin_posts_covers:
    description: Posts cover images
    default: <default-value>

  plugin_posts_limit:
    description: Display limit
    default: <default-value>

  # ====================================================================================
  # üóº Rss feed

  plugin_rss:
    description: Enable rss plugin
    default: <default-value>

  plugin_rss_source:
    description: RSS feed source
    default: <default-value>

  plugin_rss_limit:
    description: Display limit
    default: <default-value>

  # ====================================================================================
  # ‚è∞ WakaTime

  plugin_wakatime:
    description: Enable wakatime plugin
    default: <default-value>

  plugin_wakatime_token:
    description: WakaTime API token
    default: <default-value>

  plugin_wakatime_url:
    description: WakaTime URL
    default: <default-value>

  plugin_wakatime_user:
    description: WakaTime username
    default: <default-value>

  plugin_wakatime_sections:
    description: Displayed sections
    default: <default-value>

  plugin_wakatime_days:
    description: Time range
    default: <default-value>

  plugin_wakatime_limit:
    description: Display limit (entries per graph)
    default: <default-value>

  plugin_wakatime_languages_other:
    description: Other languages
    default: <default-value>

  plugin_wakatime_languages_ignored:
    description: Ignored languages
    default: <default-value>

  plugin_wakatime_repositories_visibility:
    description: Repositories visibility
    default: <default-value>

  # ====================================================================================
  # üó≥Ô∏è Leetcode

  plugin_leetcode:
    description: Enable leetcode plugin
    default: <default-value>

  plugin_leetcode_user:
    description: LeetCode login
    default: <default-value>

  plugin_leetcode_sections:
    description: Displayed sections
    default: <default-value>

  plugin_leetcode_limit_skills:
    description: Display limit (skills)
    default: <default-value>

  plugin_leetcode_ignored_skills:
    description: Ignored skills
    default: <default-value>

  plugin_leetcode_limit_recent:
    description: Display limit (recent)
    default: <default-value>

  # ====================================================================================
  # üïπÔ∏è Steam

  plugin_steam:
    description: Enable steam plugin
    default: <default-value>

  plugin_steam_token:
    description: Steam token
    default: <default-value>

  plugin_steam_sections:
    description: Displayed sections
    default: <default-value>

  plugin_steam_user:
    description: Steam user id

  plugin_steam_games_ignored:
    description: Ignored games
    default: <default-value>

  plugin_steam_games_limit:
    description: Display limit (Most played games)
    default: <default-value>

  plugin_steam_recent_games_limit:
    description: Display limit (Recently played games)
    default: <default-value>

  plugin_steam_achievements_limit:
    description: Display limit (Games achievements)
    default: <default-value>

  plugin_steam_playtime_threshold:
    description: Display threshold (Game playtime in hours)
    default: <default-value>

  # ====================================================================================
  # üß† 16personalities

  plugin_16personalities:
    description: Enable 16personalities plugin
    default: <default-value>

  plugin_16personalities_url:
    description: Profile URL
    default: <default-value>

  plugin_16personalities_sections:
    description: Displayed sections
    default: <default-value>

  plugin_16personalities_scores:
    description: Display traits scores
    default: <default-value>

  # ====================================================================================
  # ‚ôüÔ∏è Chess

  plugin_chess:
    description: Enable chess plugin
    default: <default-value>

  plugin_chess_token:
    description: Chess platform token
    default: <default-value>

  plugin_chess_user:
    description: Chess platform login
    default: <default-value>

  plugin_chess_platform:
    description: Chess platform
    default: <default-value>

  plugin_chess_animation:
    description: Animation settings
    default: <default-value>

  # ====================================================================================
  # ü™ô Crypto

  plugin_crypto:
    description: Enable crypto plugin
    default: <default-value>

  plugin_crypto_id:
    description: Crypto id
    default: <default-value>

  plugin_crypto_vs_currency:
    description: The target currency of market data (usd, eur, jpy, etc.)
    default: <default-value>

  plugin_crypto_days:
    description: Data up to number of days ago (eg. 1,14,30,max)
    default: <default-value>

  plugin_crypto_precision:
    description: The number of decimal places to use
    default: <default-value>

  # ====================================================================================
  # ü•† Fortune

  plugin_fortune:
    description: Enable fortune plugin
    default: <default-value>

  # ====================================================================================
  # üíâ Nightscout

  plugin_nightscout:
    description: Enable nightscout plugin
    default: <default-value>

  plugin_nightscout_url:
    description: Nightscout URL
    default: <default-value>

  plugin_nightscout_datapoints:
    description: Number of datapoints shown the graph
    default: <default-value>

  plugin_nightscout_lowalert:
    description: Threshold for low blood sugar
    default: <default-value>

  plugin_nightscout_highalert:
    description: Threshold for high blood sugar
    default: <default-value>

  plugin_nightscout_urgentlowalert:
    description: Threshold for urgently low blood sugar
    default: <default-value>

  plugin_nightscout_urgenthighalert:
    description: Threshold for urgently high blood sugar
    default: <default-value>

  # ====================================================================================
  # üí© PoopMap plugin

  plugin_poopmap:
    description: Enable poopmap plugin
    default: <default-value>

  plugin_poopmap_token:
    description: PoopMap API token
    default: <default-value>

  plugin_poopmap_days:
    description: Time range
    default: <default-value>

  # ====================================================================================
  # üì∏ Website screenshot

  plugin_screenshot:
    description: Enable screenshot plugin
    default: <default-value>

  plugin_screenshot_title:
    description: Title caption
    default: <default-value>

  plugin_screenshot_url:
    description: Website URL
    default: <default-value>

  plugin_screenshot_selector:
    description: CSS Selector
    default: <default-value>

  plugin_screenshot_mode:
    description: Output mode
    default: <default-value>

  plugin_screenshot_viewport:
    description: Viewport options
    default: <default-value>

  plugin_screenshot_wait:
    description: Wait time before taking screenshot (ms)
    default: <default-value>

  plugin_screenshot_background:
    description: Background
    default: <default-value>

  # ====================================================================================
  # ü¶ë Splatoon

  plugin_splatoon:
    description: Enable splatoon plugin
    default: <default-value>

  plugin_splatoon_token:
    description: Splatnet token
    default: <default-value>

  plugin_splatoon_sections:
    description: Displayed sections
    default: <default-value>

  plugin_splatoon_versus_limit:
    description: Display limit (Versus)
    default: <default-value>

  plugin_splatoon_salmon_limit:
    description: Display limit (Salmon run)
    default: <default-value>

  plugin_splatoon_statink:
    description: stat.ink integration
    default: <default-value>

  plugin_splatoon_statink_token:
    description: stat.ink token
    default: <default-value>

  plugin_splatoon_source:
    description: Source
    default: <default-value>

  # ====================================================================================
  # üíπ Stock prices

  plugin_stock:
    description: Enable stock plugin
    default: <default-value>

  plugin_stock_token:
    description: Yahoo Finance token
    default: <default-value>

  plugin_stock_symbol:
    description: Company stock symbol
    default: <default-value>

  plugin_stock_duration:
    description: Time range
    default: <default-value>

  plugin_stock_interval:
    description: Time interval between points
    default: <default-value>


# ====================================================================================
# Action metadata
name: Metrics embed
author: lowlighter
description: An infographics generator with 40+ plugins and 300+ options to display stats about your GitHub account!
branding:
  icon: user-check
  color: gray-dark

# The action will parse its name to check if it's the official action or if it's a forked one
# On the official action, it'll use the docker image published on GitHub registry when using a released version, allowing faster runs
# On a forked action, it'll rebuild the docker image from Dockerfile to take into account changes you made
runs:
  using: composite
  steps:
    - run: |
        # Check runner compatibility
        echo "::group::Metrics docker image setup"
        echo "GitHub action: $METRICS_ACTION ($METRICS_ACTION_PATH)"
        cd $METRICS_ACTION_PATH
        for DEPENDENCY in docker jq; do
          if ! which $DEPENDENCY > /dev/null 2>&1; then
            echo "::error::\"$DEPENDENCY\" is not installed on current runner but is needed to run metrics"
            MISSING_DEPENDENCIES=1
          fi
        done
        if [[ $MISSING_DEPENDENCIES == "1" ]]; then
          echo "Runner compatibility: missing dependencies"
          exit 1
        else
          echo "Runner compatibility: compatible"
        fi

        # Create environment file from inputs and GitHub variables
        touch .env
        # for INPUT in $(echo $INPUTS | jq -r 'to_entries|map("INPUT_\(.key|ascii_upcase)=\(.value|@uri)")|.[]'); do
        #   echo $INPUT >> .env
        # done
        # 1. Ëá™ÂãïÂÖ•ÂäõÂ§âÊèõ (jq)
        for INPUT in $(echo $INPUTS | jq -r 'to_entries|map("INPUT_\(.key|ascii_upcase)=\(.value|tostring)")|.[]'); do
          echo "$INPUT" >> .env
        done

        # 2. „ÄêÊúÄÈáçË¶Å„Äë„É™„Éù„Ç∏„Éà„É™„Åî„Å®„ÅÆ„Çø„Ç§„É†„Ç¢„Ç¶„Éà„ÇíÂº∑Âà∂ÁöÑ„Å´Ê≥®ÂÖ•
        # INPUT_ „Éó„É¨„Éï„Ç£„ÉÉ„ÇØ„Çπ‰ªò„Åç„Å®„ÄÅ„Å™„Åó„ÅÆ‰∏°Êñπ„ÇíÂÖ•„Çå„Çã
        echo "INPUT_PLUGIN_LANGUAGES_ANALYSIS_TIMEOUT_REPOSITORIES=${{ inputs.plugin_languages_analysis_timeout_repositories }}" >> .env
        echo "PLUGIN_LANGUAGES_ANALYSIS_TIMEOUT_REPOSITORIES=${{ inputs.plugin_languages_analysis_timeout_repositories }}" >> .env
        
        # 3. Ê®ôÊ∫ñÁí∞Â¢ÉÂ§âÊï∞„ÅÆËøΩÂä†
        env | grep -E '^(GITHUB|ACTIONS|CI|TZ)' >> .env

        # 4. „Äê„Éá„Éê„ÉÉ„Ç∞Áî®„ÄëÊú¨ÂΩì„Å´Êõ∏„ÅçËæº„Åæ„Çå„Åü„Åã„É≠„Ç∞„Å´Âá∫„ÅôÔºà„Åì„Çå„ÅåÈáçË¶Å„Åß„ÅôÔºâ
        echo "üîç DEBUG: Checking .env content for REPOSITORIES timeout..."
        grep "REPOSITORIES" .env || echo "‚ùå ERROR: Variable missing in .env!"
        
        # ‚ñ≤‚ñ≤‚ñ≤ ‰øÆÊ≠£ÁÆáÊâÄÔºö„Åì„Åì„Åæ„Åß ‚ñ≤‚ñ≤‚ñ≤

        echo "Environment variables: loaded"

        # Renders output folder
        METRICS_RENDERS="/metrics_renders"
        sudo mkdir -p $METRICS_RENDERS
        echo "Renders output folder: $METRICS_RENDERS"

        # Source repository (picked from action name)
        METRICS_SOURCE=$(echo $METRICS_ACTION | sed -E 's/metrics.*?$//g' | sed -E 's/_//g')
        echo "Source: $METRICS_SOURCE"

        # --- „Éá„Éê„ÉÉ„Ç∞Áî®: ÂÆüÈöõ„Å´„Çª„ÉÉ„Éà„Åï„Çå„Åü„Çø„Ç§„É†„Ç¢„Ç¶„ÉàÂÄ§„Çí„É≠„Ç∞„Å´Âá∫„Åô ---
        echo "üîç DEBUG: Timeout Value Check"
        grep "ANALYSIS_TIMEOUT" .env || echo "‚ö†Ô∏è Warning: Timeout variable not found in .env"
        # -------------------------------------------------------

        # Version (picked from package.json)
        METRICS_VERSION=$(grep -Po '(?<="version": ").*(?=")' package.json)
        echo "Version: $METRICS_VERSION"

        # Image tag (extracted from version or from env)
        METRICS_TAG=v$(echo $METRICS_VERSION | sed -r 's/^([0-9]+[.][0-9]+).*/\1/')
        echo "Image tag: $METRICS_TAG"

        # Image name
        # Official action
        if [[ $METRICS_SOURCE == "lowlighter" ]]; then
          # Use registry with pre-built images
          if [[ ! $METRICS_USE_PREBUILT_IMAGE =~ ^([Ff]alse|[Oo]ff|[Nn]o|0)$ ]]; then
            # Is released version
            set +e
            METRICS_IS_RELEASED=$(expr $(expr match $METRICS_VERSION .*-beta) == 0)
            set -e
            echo "Is released version: $METRICS_IS_RELEASED"
            if [[ "$METRICS_IS_RELEASED" -eq "0" ]]; then
              METRICS_TAG="$METRICS_TAG-beta"
              echo "Image tag (updated): $METRICS_TAG"
            fi
            METRICS_IMAGE=ghcr.io/lowlighter/metrics:$METRICS_TAG
            echo "Using pre-built version $METRICS_TAG, will pull docker image from GitHub registry"
            if ! docker image pull $METRICS_IMAGE; then
              echo "Failed to fetch docker image from GitHub registry, will rebuild it locally"
              METRICS_IMAGE=metrics:$METRICS_VERSION
            fi
          # Rebuild image
          else
            echo "Using an unreleased version ($METRICS_VERSION)"
            METRICS_IMAGE=metrics:$METRICS_VERSION
          fi
        # Forked action
        else
          echo "Using a forked version (Funmatu)"
          # ‚ñº „Éï„Ç©„Éº„ÇØ„É™„Éù„Ç∏„Éà„É™„ÅÆ„Ç§„É°„Éº„Ç∏„ÇíÊåáÂÆö
          METRICS_IMAGE=ghcr.io/funmatu/metrics:master
          
          echo "Attempting to pull docker image: $METRICS_IMAGE"
          # ‚ñº „Ç§„É°„Éº„Ç∏„ÅÆPull„ÇíË©¶„Åø„Çã
          if ! docker image pull $METRICS_IMAGE; then
            echo "Failed to fetch docker image, will rebuild it locally"
            # Pull„Å´Â§±Êïó„Åó„Åü„Çâ„ÄÅ„É≠„Éº„Ç´„É´„Éì„É´„ÉâÁî®„ÅÆÂêçÂâç„Å´Êàª„ÅôÔºàÔºùÂæå„ÅÆÂá¶ÁêÜ„Åß„Éì„É´„Éâ„ÅåËµ∞„ÇãÔºâ
            METRICS_IMAGE=metrics:forked-$METRICS_VERSION
          fi
        fi
        echo "Image name: $METRICS_IMAGE"

        # Build image if necessary
        set +e
        docker image inspect $METRICS_IMAGE
        METRICS_IMAGE_NEEDS_BUILD="$?"
        set -e
        if [[ "$METRICS_IMAGE_NEEDS_BUILD" -gt "0" ]]; then
          echo "Image $METRICS_IMAGE is not present locally, rebuilding it from Dockerfile"
          docker build -t $METRICS_IMAGE .
        else
          echo "Image $METRICS_IMAGE is present locally"
        fi
        echo "::endgroup::"

        # Run docker image with current environment
        docker run --init --rm --volume $GITHUB_EVENT_PATH:$GITHUB_EVENT_PATH --volume $METRICS_RENDERS:/renders --env-file .env $METRICS_IMAGE
        rm .env
      shell: bash
      env:
        METRICS_ACTION: ${{ github.action }}
        METRICS_ACTION_PATH: ${{ github.action_path }}
        METRICS_USE_PREBUILT_IMAGE: ${{ inputs.use_prebuilt_image }}
        INPUTS: ${{ toJson(inputs) }}
        TZ: ${{ inputs.config_timezone }}
</file>

<file path="package.json">
{
  "name": "metrics",
  "version": "3.35.0-beta-patched",
  "private": true,
  "description": "An infographics generator with 40+ plugins and 300+ options to display stats about your GitHub account and render them as SVG, Markdown, PDF or JSON!",
  "main": "index.mjs",
  "scripts": {
    "start": "node source/app/web/index.mjs",
    "test": "jest --runInBand",
    "test-contrib": "jest --runInBand ci.test.js --noStackTrace",
    "test-presets": "jest --runInBand presets.test.js --noStackTrace",
    "test-metrics": "jest --runInBand metrics.test.js",
    "build": "node .github/scripts/build.mjs",
    "presets": "node .github/scripts/presets_examples.mjs",
    "quickstart": "node .github/scripts/quickstart/index.mjs",
    "preview": "node .github/scripts/preview.mjs",
    "linter": "eslint source/**/*.mjs --quiet",
    "dev": "nodemon source/app/web/index.mjs -e mjs,css,ejs,json",
    "postinstall": "node node_modules/puppeteer/install.js",
    "indepth": "node source/plugins/languages/analyzers.mjs"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/Funmatu/metrics.git"
  },
  "author": "lowlighter",
  "contributors": [
    {
      "name": "Funmatu",
      "url": "https://github.com/Funmatu"
    }
  ],
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/Funmatu/metrics/issues"
  },
  "homepage": "https://github.com/Funmatu/metrics#readme",
  "dependencies": {
    "@actions/core": "^1.10.1",
    "@actions/github": "^5.1.1",
    "@faker-js/faker": "^8.0.2",
    "@octokit/graphql": "^7.0.1",
    "@octokit/rest": "^20.0.1",
    "@primer/css": "^21.0.9",
    "@primer/octicons": "^19.7.0",
    "@twemoji/parser": "^14.1.0",
    "axios": "^1.5.0",
    "clipboard": "^2.0.11",
    "compression": "^1.7.4",
    "csso": "^5.0.5",
    "d3": "^7.8.5",
    "ejs": "^3.1.9",
    "emoji-name-map": "^1.2.9",
    "express": "^4.18.2",
    "express-rate-limit": "^7.0.0",
    "file-type": "^18.5.0",
    "js-yaml": "^4.1.0",
    "jsdom": "^22.1.0",
    "linguist-js": "^2.6.1",
    "marked": "^7.0.5",
    "memory-cache": "^0.2.0",
    "minimatch": "^9.0.3",
    "open-graph-scraper": "^6.2.2",
    "png-js": "^1.0.0",
    "prismjs": "^1.29.0",
    "puppeteer": "^21.2.1",
    "purgecss": "^5.0.0",
    "rss-parser": "^3.13.0",
    "sanitize-html": "^2.11.0",
    "sharp": "^0.32.3",
    "simple-git": "^3.19.1",
    "svgo": "^3.0.2",
    "vue": "^2.7.1",
    "vue-prism-component": "^1.2.0",
    "xml-formatter": "^3.5.0"
  },
  "devDependencies": {
    "dprint": "^0.41.0",
    "eslint": "^8.49.0",
    "jest": "^29.7.0"
  },
  "jest": {
    "testEnvironment": "node",
    "testTimeout": 60000,
    "transform": {}
  },
  "optionalDependencies": {
    "@googlemaps/google-maps-services-js": "^3.3.38",
    "chess.js": "^1.0.0-beta.6",
    "color": "^4.2.3",
    "gifencoder": "^2.0.1",
    "libxmljs2": "^0.32.0",
    "rss": "^1.2.2",
    "yargs-parser": "^21.1.1"
  }
}
</file>

</files>
